
import React, { useState, useMemo, useEffect, useReducer, createContext, useContext } from 'react';
import {
  Shield, FileText, Link2, ClipboardCheck, AlertTriangle,
  BarChart3, MessageSquare, TrendingUp, Building2,
  Search, Bell, User, Plus, Filter, Download, Eye, Edit,
  CheckCircle2, XCircle, Clock, Calendar, ArrowUpRight,
  Settings, LogOut, Menu, Home, FolderOpen, RefreshCw,
  FileCheck, Upload, File, ChevronDown, ChevronRight, ChevronUp,
  AlertCircle, BookOpen, Save, Send, Archive, History,
  Copy, CheckSquare, LayoutGrid, List, GitBranch, MoreVertical,
  Trash2, ExternalLink, PieChart, Layers, X, ChevronLeft,
  Users, Target, Zap, Activity, Check, Info, Scale, Briefcase, UserPlus,
  Building, Globe, Hash, Tag, UserCheck, UserX, RotateCcw,
  FileWarning, FilePlus, FileSearch, Table, LayoutList, Network, MapPin,
  Play, Inbox, LayoutDashboard, Mail, Link, MinusCircle, FolderPlus,
  ClipboardList, Lock, FileQuestion, HelpCircle, ArrowDownCircle, ArrowUpCircle,
  Package, Paperclip, PhoneCall, Minimize2, Maximize2, Square, ListChecks, DollarSign, Award,
  Lightbulb, ArrowUp, ArrowLeft, Database, FileUp, FileDown, Wallet, Rocket, Circle,
  Wrench, TrendingDown
} from 'lucide-react';

// Export Utilities - Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµØ¯ÙŠØ±

// Shared UI Components - Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø´ØªØ±ÙƒØ©
const GrcModal = ({ show, onClose, title, titleEn, icon: Icon, gradient = 'from-blue-600 to-indigo-700', size = 'max-w-6xl', children, footer }) => {
  if (!show) return null;
  return (
    <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && onClose()}>
      <div className={`bg-white rounded-3xl shadow-2xl w-full ${size} max-h-[95vh] overflow-hidden flex flex-col`}>
        <div className={`bg-gradient-to-l ${gradient} px-8 py-5 text-white`}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              {Icon && <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><Icon className="w-7 h-7" /></div>}
              <div><h2 className="text-2xl font-black">{title}</h2>{titleEn && <p className="text-white/70 text-sm">{titleEn}</p>}</div>
            </div>
            <button onClick={onClose} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button>
          </div> </div>
        <div className="flex-1 overflow-y-auto p-6">{children}</div>
        {footer && <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">{footer}</div>}
      </div> </div>);
};

const GrcConfirm = ({ show, onConfirm, onCancel, title = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù', message = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', type = 'danger' }) => {
  if (!show) return null;
  const colors = type === 'danger' ? 'from-red-500 to-rose-600' : 'from-amber-500 to-orange-600';
  return (
    <div className="fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
        <div className={`bg-gradient-to-r ${colors} px-6 py-4 text-white`}><h3 className="text-lg font-bold">{title}</h3></div>
        <div className="p-6"><p className="text-slate-600">{message}</p></div>
        <div className="px-6 py-4 bg-slate-50 flex gap-3 justify-end">
          <button onClick={onCancel} className="px-4 py-2 rounded-xl border-2 border-slate-200 text-slate-600 hover:bg-slate-100">Ø¥Ù„ØºØ§Ø¡</button>
          <button onClick={onConfirm} className={`px-4 py-2 rounded-xl bg-gradient-to-r ${colors} text-white font-bold hover:shadow-lg`}>ØªØ£ÙƒÙŠØ¯</button>
        </div> </div> </div>);
};

const GrcNotification = ({ notification, onClose }) => {
  if (!notification) return null;
  return (
    <div className={`fixed top-20 left-1/2 -translate-x-1/2 z-[70] px-6 py-3 rounded-xl shadow-2xl text-white font-bold animate-bounce ${notification.type === 'success' ? 'bg-emerald-500' : notification.type === 'error' ? 'bg-red-500' : 'bg-amber-500'}`}>
      {notification.message}
    </div>);
};

const GrcStatCard = ({ icon: Icon, label, value, color = 'blue', sub, onClick }) => {
  const colors = { blue: 'from-blue-500 to-indigo-600', emerald: 'from-emerald-500 to-teal-600', red: 'from-red-500 to-rose-600', amber: 'from-amber-500 to-orange-600', purple: 'from-purple-500 to-indigo-600', cyan: 'from-cyan-500 to-blue-600', slate: 'from-slate-600 to-slate-700' };
  return (
    <div onClick={onClick} className={`bg-gradient-to-br ${colors[color] || colors.blue} rounded-2xl p-5 text-white shadow-lg ${onClick ? 'cursor-pointer hover:shadow-xl' : ''}`}>
      <div className="flex items-center justify-between mb-3">
        {Icon && <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Icon className="w-6 h-6" /></div>}
        <span className="text-3xl font-black">{value}</span>
      </div>
      <p className="text-white/80 text-sm font-bold">{label}</p>
      {sub && <p className="text-white/60 text-xs mt-1">{sub}</p>}
    </div>);
};

const GrcEmptyState = ({ icon: Icon = Inbox, title = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', message, action, onAction }) => (
  <div className="text-center py-16">
    <div className="w-20 h-20 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4"><Icon className="w-10 h-10 text-slate-400" /></div>
    <h3 className="text-xl font-bold text-slate-600 mb-2">{title}</h3>
    {message && <p className="text-slate-500 mb-4">{message}</p>}
    {action && <button onClick={onAction} className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg">{action}</button>}
  </div>);
const GrcSearchBar = ({ value, onChange, placeholder = 'Ø¨Ø­Ø«...', filters, onFilterChange, filterValue }) => (
  <div className="flex items-center gap-3 flex-wrap">
    <div className="relative flex-1 min-w-[200px]">
      <Search className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5" />
      <input type="text" value={value} onChange={e => onChange(e.target.value)} placeholder={placeholder} className="w-full pr-10 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-300 focus:border-blue-400" />
    </div>
    {filters && (
      <select value={filterValue || 'all'} onChange={e => onFilterChange(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl">
        <option value="all">Ø§Ù„ÙƒÙ„</option>
        {filters.map(f => <option key={f.value} value={f.value}>{f.label}</option>)}
      </select>
    )}
  </div>);
const GrcFormField = ({ label, labelEn, required, children, hint }) => (
  <div>
    <label className="block text-xs font-bold text-slate-600 mb-2">
      {label} {labelEn && <span className="text-slate-400 font-normal">({labelEn})</span>} {required && <span className="text-red-500">*</span>}
    </label>
    {children}
    {hint && <p className="text-xs text-slate-400 mt-1">{hint}</p>}
  </div>);
const SeveritySelect = ({ value, onChange, className = '' }) => (
  <select value={value} onChange={onChange} className={`w-full px-4 py-3 border-2 border-slate-200 rounded-xl ${className}`}>
    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
  </select>
);

const StatusSelect = ({ value, onChange, className = '' }) => (
  <select value={value} onChange={onChange} className={`w-full px-4 py-3 border-2 border-slate-200 rounded-xl ${className}`}>
    <option value="Active">Ù†Ø´Ø·</option><option value="Inactive">ØºÙŠØ± Ù†Ø´Ø·</option><option value="Draft">Ù…Ø³ÙˆØ¯Ø©</option>
  </select>
);

const useGrcNotification = () => {
  const [notification, setNotification] = useState(null);
  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };
  return { notification, showNotification };
};

const ExportUtils = {
  // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV
  toCSV: (data, filename = 'export.csv') => {
    if (!data || data.length === 0) return;
    const headers = Object.keys(data[0]);
    const csvContent = [
      headers.join(','),
      ...data.map(row => headers.map(h => `"${row[h] || ''}"`).join(','))
    ].join('\n');
    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
  },

  // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ JSON
  toJSON: (data, filename = 'export.json') => {
    const jsonContent = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonContent], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
  },

  // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± PDF (Ù…Ø­Ø§ÙƒØ§Ø© - ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©)
  toPDF: (title, content) => {
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html dir="rtl">
        <head>
          <title>${title}</title>
          <style>
            body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 40px; direction: rtl; }
            h1 { color: #1e40af; border-bottom: 2px solid #1e40af; padding-bottom: 10px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
            th { background: #1e40af; color: white; }
            tr:nth-child(even) { background: #f8fafc; }
            .header { display: flex; justify-content: space-between; align-items: center; }
            .date { color: #64748b; }
            .footer { margin-top: 40px; text-align: center; color: #64748b; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>ğŸ“Š ${title}</h1>
            <span class="date">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}</span>
          </div>
          ${content}
          <div class="footer">
            <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ù†ØµØ© Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</p>
          </div>
        </body>
      </html>
    `);
    printWindow.document.close();
    setTimeout(() => printWindow.print(), 500);
  },

  // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ HTML Ù„Ù„ØªØµØ¯ÙŠØ±
  createTable: (headers, rows) => {
    return `
      <table>
        <thead>
          <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
        </thead>
        <tbody>
          ${rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}
        </tbody> </table>
    `;
  }
};

// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© (Reference Data)

// 1) Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© (Regulatory Authorities)
const AUTHORITIES = [
  { id: 1, code: 'SAMA', nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', nameEn: 'Saudi Central Bank', sector: 'Banking', country: 'SA', status: 'Active' },
  { id: 2, code: 'CMA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Capital Market Authority', sector: 'Capital', country: 'SA', status: 'Active' },
  { id: 3, code: 'NCA', nameAr: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'National Cybersecurity Authority', sector: 'Cybersecurity', country: 'SA', status: 'Active' },
  { id: 4, code: 'SDAIA', nameAr: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'Saudi Data & AI Authority', sector: 'Data', country: 'SA', status: 'Active' },
  { id: 5, code: 'ZATCA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', nameEn: 'Zakat, Tax and Customs Authority', sector: 'Tax', country: 'SA', status: 'Active' },
  { id: 6, code: 'CCHI', nameAr: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', nameEn: 'Council of Cooperative Health Insurance', sector: 'Health', country: 'SA', status: 'Active' },
  { id: 7, code: 'HRSD', nameAr: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', nameEn: 'Ministry of Human Resources', sector: 'Labor', country: 'SA', status: 'Active' },
  { id: 8, code: 'CITC', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'Communications & IT Commission', sector: 'Telecom', country: 'SA', status: 'Active' },
];

// 2) Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© (Regulatory Frameworks)
const FRAMEWORKS = [
  { id: 1, authorityId: 1, code: 'SAMA-AML', title: 'Ù‚ÙˆØ§Ø¹Ø¯ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', titleEn: 'Anti-Money Laundering Rules', version: '2.0', issueDate: '2023-01-15', effectiveDate: '2023-03-01', status: 'Active' },
  { id: 2, authorityId: 1, code: 'SAMA-CF', title: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©', titleEn: 'Compliance Framework', version: '1.5', issueDate: '2022-06-01', effectiveDate: '2022-09-01', status: 'Active' },
  { id: 3, authorityId: 1, code: 'SAMA-BCM', title: 'Ø¥Ø·Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', titleEn: 'Business Continuity Management', version: '1.0', issueDate: '2023-05-01', effectiveDate: '2023-08-01', status: 'Active' },
  { id: 4, authorityId: 1, code: 'SAMA-CSF', title: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Framework', version: '1.0', issueDate: '2022-01-01', effectiveDate: '2022-04-01', status: 'Active' },
  { id: 5, authorityId: 2, code: 'CMA-CGR', title: 'Ù„Ø§Ø¦Ø­Ø© Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª', titleEn: 'Corporate Governance Regulations', version: '3.0', issueDate: '2023-02-01', effectiveDate: '2023-05-01', status: 'Active' },
  { id: 6, authorityId: 2, code: 'CMA-AML', title: 'Ù‚ÙˆØ§Ø¹Ø¯ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', titleEn: 'AML Rules - Capital Market', version: '1.2', issueDate: '2022-08-01', effectiveDate: '2022-11-01', status: 'Active' },
  { id: 7, authorityId: 3, code: 'NCA-ECC', title: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', titleEn: 'Essential Cybersecurity Controls', version: '2.0', issueDate: '2023-01-01', effectiveDate: '2023-04-01', status: 'Active' },
  { id: 8, authorityId: 3, code: 'NCA-CCC', title: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', titleEn: 'Critical Systems Cybersecurity Controls', version: '1.0', issueDate: '2022-06-01', effectiveDate: '2022-09-01', status: 'Active' },
  { id: 9, authorityId: 4, code: 'SDAIA-PDPL', title: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', titleEn: 'Personal Data Protection Law', version: '1.0', issueDate: '2023-09-01', effectiveDate: '2023-09-14', status: 'Active' },
  { id: 10, authorityId: 5, code: 'ZATCA-VAT', title: 'Ù„Ø§Ø¦Ø­Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', titleEn: 'VAT Regulations', version: '2.1', issueDate: '2023-01-01', effectiveDate: '2023-01-01', status: 'Active' },
  { id: 11, authorityId: 5, code: 'ZATCA-EI', title: 'Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', titleEn: 'E-Invoicing Regulations', version: '1.0', issueDate: '2021-12-04', effectiveDate: '2021-12-04', status: 'Active' },
  { id: 12, authorityId: 6, code: 'CCHI-HI', title: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ', titleEn: 'Cooperative Health Insurance Law', version: '1.0', issueDate: '2020-01-01', effectiveDate: '2020-01-01', status: 'Active' },
  { id: 13, authorityId: 7, code: 'HRSD-WPS', title: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', titleEn: 'Wage Protection System', version: '2.0', issueDate: '2022-01-01', effectiveDate: '2022-01-01', status: 'Active' },
  { id: 14, authorityId: 7, code: 'HRSD-NTQ', title: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ø·Ø§Ù‚Ø§Øª', titleEn: 'Nitaqat Program', version: '3.0', issueDate: '2023-01-01', effectiveDate: '2023-01-01', status: 'Active' },
];

// 3) Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© (Regulatory Requirements)
const REQUIREMENTS = [
  // SAMA-AML Requirements
  { id: 1, frameworkId: 1, refCode: 'SAMA-AML-1.1', text: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ¶Ø¹ ÙˆØªÙ†ÙÙŠØ° Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡', category: 'Compliance', criticality: 'High', status: 'Active' },
  { id: 2, frameworkId: 1, refCode: 'SAMA-AML-1.2', text: 'ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„', category: 'Compliance', criticality: 'High', status: 'Active' },
  { id: 3, frameworkId: 1, refCode: 'SAMA-AML-2.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©', category: 'Compliance', criticality: 'High', status: 'Active' },
  { id: 4, frameworkId: 1, refCode: 'SAMA-AML-3.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù…Ø¯Ø© Ù„Ø§ ØªÙ‚Ù„ Ø¹Ù† 10 Ø³Ù†ÙˆØ§Øª', category: 'Compliance', criticality: 'Medium', status: 'Active' },
  { id: 5, frameworkId: 1, refCode: 'SAMA-AML-4.1', text: 'ÙŠØ¬Ø¨ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹', category: 'HR', criticality: 'Medium', status: 'Active' },

  // SAMA-CF Requirements
  { id: 6, frameworkId: 2, refCode: 'SAMA-CF-1.1', text: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù…ØªØ«Ø§Ù„ Ù…Ø¤Ù‡Ù„ ÙˆÙ…Ø³ØªÙ‚Ù„', category: 'Governance', criticality: 'High', status: 'Active' },
  { id: 7, frameworkId: 2, refCode: 'SAMA-CF-2.1', text: 'ÙŠØ¬Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ ÙˆØ±ÙØ¹Ù‡ Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', category: 'Governance', criticality: 'High', status: 'Active' },
  { id: 8, frameworkId: 2, refCode: 'SAMA-CF-3.1', text: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹', category: 'Risk', criticality: 'High', status: 'Active' },

  // NCA-ECC Requirements
  { id: 9, frameworkId: 7, refCode: 'NCA-ECC-1.1', text: 'ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§', category: 'Cybersecurity', criticality: 'High', status: 'Active' },
  { id: 10, frameworkId: 7, refCode: 'NCA-ECC-2.1', text: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', category: 'IT', criticality: 'High', status: 'Active' },
  { id: 11, frameworkId: 7, refCode: 'NCA-ECC-3.1', text: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', category: 'IT', criticality: 'High', status: 'Active' },
  { id: 12, frameworkId: 7, refCode: 'NCA-ECC-4.1', text: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø³Ù†ÙˆÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', category: 'IT', criticality: 'High', status: 'Active' },

  // SDAIA-PDPL Requirements
  { id: 13, frameworkId: 9, refCode: 'PDPL-1.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© Ù…Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø§Ù„Ø´Ø®ØµÙŠØ©', category: 'Data', criticality: 'High', status: 'Active' },
  { id: 14, frameworkId: 9, refCode: 'PDPL-2.1', text: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', category: 'Governance', criticality: 'High', status: 'Active' },
  { id: 15, frameworkId: 9, refCode: 'PDPL-3.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', category: 'Compliance', criticality: 'High', status: 'Active' },

  // ZATCA Requirements
  { id: 16, frameworkId: 10, refCode: 'VAT-1.1', text: 'ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', category: 'Tax', criticality: 'High', status: 'Active' },
  { id: 17, frameworkId: 11, refCode: 'EI-1.1', text: 'ÙŠØ¬Ø¨ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©', category: 'Tax', criticality: 'High', status: 'Active' },

  // CMA Requirements
  { id: 18, frameworkId: 5, refCode: 'CGR-1.1', text: 'ÙŠØ¬Ø¨ ØªØ´ÙƒÙŠÙ„ Ù„Ø¬Ù†Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØºÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠÙŠÙ†', category: 'Governance', criticality: 'High', status: 'Active' },
  { id: 19, frameworkId: 5, refCode: 'CGR-2.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥ÙØµØ§Ø­ Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠØ© ÙÙˆØ± Ø­Ø¯ÙˆØ«Ù‡Ø§', category: 'Governance', criticality: 'High', status: 'Active' },

  // HRSD Requirements
  { id: 20, frameworkId: 13, refCode: 'WPS-1.1', text: 'ÙŠØ¬Ø¨ ØµØ±Ù Ø£Ø¬ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', category: 'HR', criticality: 'High', status: 'Active' },
  { id: 21, frameworkId: 14, refCode: 'NTQ-1.1', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ø·Ø§Ù‚Ø§Øª', category: 'HR', criticality: 'High', status: 'Active' },
];

// 4) Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (Categories)
const CATEGORIES = [
  { code: 'Governance', nameAr: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', nameEn: 'Governance' },
  { code: 'Risk', nameAr: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk' },
  { code: 'Compliance', nameAr: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance' },
  { code: 'IT', nameAr: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'Information Technology' },
  { code: 'Cybersecurity', nameAr: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'Cybersecurity' },
  { code: 'Data', nameAr: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Protection' },
  { code: 'HR', nameAr: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', nameEn: 'Human Resources' },
  { code: 'Finance', nameAr: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Finance' },
  { code: 'Tax', nameAr: 'Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨', nameEn: 'Tax' },
  { code: 'Operations', nameAr: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', nameEn: 'Operations' },
];

// 5) Ø§Ù„Ø¯ÙˆØ±ÙŠØ© (Frequencies)
const FREQUENCIES = [
  { code: 'Adhoc', nameAr: 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©', nameEn: 'Ad-hoc' },
  { code: 'Daily', nameAr: 'ÙŠÙˆÙ…ÙŠ', nameEn: 'Daily' },
  { code: 'Weekly', nameAr: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', nameEn: 'Weekly' },
  { code: 'Monthly', nameAr: 'Ø´Ù‡Ø±ÙŠ', nameEn: 'Monthly' },
  { code: 'Quarterly', nameAr: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', nameEn: 'Quarterly' },
  { code: 'SemiAnnual', nameAr: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', nameEn: 'Semi-Annual' },
  { code: 'Annual', nameAr: 'Ø³Ù†ÙˆÙŠ', nameEn: 'Annual' },
  { code: 'EventDriven', nameAr: 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«', nameEn: 'Event-driven' },
];

// 6) Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø·Ø§Ù‚ (Scope Levels)
const SCOPE_LEVELS = [
  { code: 'Enterprise', nameAr: 'Ø§Ù„Ù…Ø¤Ø³Ø³Ø©', nameEn: 'Enterprise' },
  { code: 'BU', nameAr: 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„', nameEn: 'Business Unit' },
  { code: 'Department', nameAr: 'Ø¥Ø¯Ø§Ø±Ø©', nameEn: 'Department' },
  { code: 'Process', nameAr: 'Ø¹Ù…Ù„ÙŠØ©', nameEn: 'Process' },
  { code: 'System', nameAr: 'Ù†Ø¸Ø§Ù…', nameEn: 'System' },
  { code: 'Location', nameAr: 'Ù…ÙˆÙ‚Ø¹', nameEn: 'Location' },
];

// 7) Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© (Evidence Types)
const EVIDENCE_TYPES = [
  { code: 'Policy', nameAr: 'Ø³ÙŠØ§Ø³Ø©', nameEn: 'Policy' },
  { code: 'Procedure', nameAr: 'Ø¥Ø¬Ø±Ø§Ø¡', nameEn: 'Procedure' },
  { code: 'Report', nameAr: 'ØªÙ‚Ø±ÙŠØ±', nameEn: 'Report' },
  { code: 'Log', nameAr: 'Ø³Ø¬Ù„', nameEn: 'Log' },
  { code: 'Approval', nameAr: 'Ù…ÙˆØ§ÙÙ‚Ø©', nameEn: 'Approval' },
  { code: 'Config', nameAr: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', nameEn: 'Configuration' },
  { code: 'Screenshot', nameAr: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', nameEn: 'Screenshot' },
  { code: 'Certificate', nameAr: 'Ø´Ù‡Ø§Ø¯Ø©', nameEn: 'Certificate' },
  { code: 'Minutes', nameAr: 'Ù…Ø­Ø¶Ø± Ø§Ø¬ØªÙ…Ø§Ø¹', nameEn: 'Meeting Minutes' },
  { code: 'Contract', nameAr: 'Ø¹Ù‚Ø¯', nameEn: 'Contract' },
  { code: 'Other', nameAr: 'Ø£Ø®Ø±Ù‰', nameEn: 'Other' },
];

// 8) Ø£Ø«Ø± Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Regulatory Impacts)
const REGULATORY_IMPACTS = [
  { code: 'Penalty', nameAr: 'ØºØ±Ø§Ù…Ø© Ù…Ø§Ù„ÙŠØ©', nameEn: 'Financial Penalty' },
  { code: 'License', nameAr: 'ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø®ØµØ©', nameEn: 'License Impact' },
  { code: 'Reporting', nameAr: 'Ø¥Ù„Ø²Ø§Ù… Ø¨ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø¶Ø§ÙÙŠØ©', nameEn: 'Reporting Requirement' },
  { code: 'Reputation', nameAr: 'Ø¶Ø±Ø± Ø³Ù…Ø¹Ø©', nameEn: 'Reputation Damage' },
  { code: 'Operational', nameAr: 'ØªØ£Ø«ÙŠØ± ØªØ´ØºÙŠÙ„ÙŠ', nameEn: 'Operational Impact' },
  { code: 'Legal', nameAr: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', nameEn: 'Legal Liability' },
];

// 9) Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Users) - Ù„Ù„Ø¹Ø±Ø¶
const USERS = [
  { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'ComplianceOfficer', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
  { id: 2, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'ComplianceReviewer', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
  { id: 3, name: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', role: 'ComplianceApprover', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
  { id: 4, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'ComplianceOfficer', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
  { id: 5, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ', role: 'ObligationOwner', department: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±' },
  { id: 6, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', role: 'ObligationOwner', department: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
  { id: 7, name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', role: 'ComplianceAdmin', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
  { id: 8, name: 'Ø±ÙŠÙ… Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ', role: 'InternalAudit', department: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©' },
];

// 10) Ø­Ø§Ù„Ø§Øª Workflow
const WORKFLOW_STATES = {
  Draft: { code: 'Draft', nameAr: 'Ù…Ø³ÙˆØ¯Ø©', color: 'gray', icon: FileText },
  UnderReview: { code: 'UnderReview', nameAr: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: 'amber', icon: Clock },
  Returned: { code: 'Returned', nameAr: 'Ù…ÙØ¹Ø§Ø¯', color: 'orange', icon: RotateCcw },
  Approved: { code: 'Approved', nameAr: 'Ù…Ø¹ØªÙ…Ø¯', color: 'blue', icon: CheckCircle2 },
  Active: { code: 'Active', nameAr: 'Ù†Ø´Ø·', color: 'emerald', icon: CheckCircle2 },
  OnHold: { code: 'OnHold', nameAr: 'Ù…Ø¹Ù„Ù‘Ù‚', color: 'purple', icon: Clock },
  Retired: { code: 'Retired', nameAr: 'Ù…Ù„ØºÙŠ', color: 'red', icon: Archive },
};

// Module 4.2: Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± (Policies & Standards)
// Enterprise Policy Operating System - Better than Archer

// 11) Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª (Policy Types)
const POLICY_TYPES = [
  { code: 'Policy', nameAr: 'Ø³ÙŠØ§Ø³Ø©', nameEn: 'Policy', level: 1, icon: 'ğŸ“œ' },
  { code: 'Standard', nameAr: 'Ù…Ø¹ÙŠØ§Ø±', nameEn: 'Standard', level: 2, icon: 'ğŸ“‹' },
  { code: 'Procedure', nameAr: 'Ø¥Ø¬Ø±Ø§Ø¡', nameEn: 'Procedure', level: 3, icon: 'ğŸ“' },
  { code: 'Guideline', nameAr: 'Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ', nameEn: 'Guideline', level: 4, icon: 'ğŸ“–' },
  { code: 'Form', nameAr: 'Ù†Ù…ÙˆØ°Ø¬', nameEn: 'Form', level: 5, icon: 'ğŸ“„' },
];

// 12) Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø¥Ù„Ø²Ø§Ù… (Mandatory Levels)
const MANDATORY_LEVELS = [
  { code: 'Mandatory', nameAr: 'Ø¥Ù„Ø²Ø§Ù…ÙŠ', nameEn: 'Mandatory', color: 'red' },
  { code: 'ShouldComply', nameAr: 'ÙŠÙ†Ø¨ØºÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', nameEn: 'Should Comply', color: 'amber' },
  { code: 'BestPractice', nameAr: 'Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª', nameEn: 'Best Practice', color: 'blue' },
  { code: 'Optional', nameAr: 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ', nameEn: 'Optional', color: 'slate' },
];

// 13) Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± (Attestation Status)
const ATTESTATION_STATUS = [
  { code: 'Pending', nameAr: 'Ù…Ø¹Ù„Ù‚', nameEn: 'Pending', color: 'slate' },
  { code: 'Acknowledged', nameAr: 'ØªÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±', nameEn: 'Acknowledged', color: 'emerald' },
  { code: 'Overdue', nameAr: 'Ù…ØªØ£Ø®Ø±', nameEn: 'Overdue', color: 'red' },
  { code: 'Exempted', nameAr: 'Ù…Ø¹ÙÙ‰', nameEn: 'Exempted', color: 'purple' },
];

// 14) Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (Advanced Policies)
const POLICIES = [
  {
    id: 1, code: 'POL-001', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', titleEn: 'Regulatory Compliance Policy', type: 'Policy',
    category: 'Compliance', ownerId: 7, reviewerId: 3, approverId: 3, currentVersion: '2.0', effectiveDate: '2024-01-01',
    nextReviewDate: '2025-01-01', status: 'Active', impactLevel: 'High', linkedFrameworks: [1, 2],
    linkedObligations: [1, 2, 3, 6, 7], linkedControls: [1, 2, 3], linkedRisks: [1, 2], standardRequirements: [1, 2, 3, 4],
    attestationCampaigns: [1],
    summary: 'ØªØ­Ø¯Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¥Ø·Ø§Ø± Ø¹Ù…Ù„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù„Ù„Ù…Ø¤Ø³Ø³Ø© ÙˆØªØ¶Ø¹ Ø§Ù„Ø£Ø³Ø³ ÙˆØ§Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠØ© Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©',
    objectives: ['Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', 'ØªØ¹Ø²ÙŠØ² Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„'],
    createdAt: '2023-01-15', createdBy: 7, lastModifiedAt: '2024-01-01', lastModifiedBy: 7,
  },
  {
    id: 2, code: 'POL-002', title: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', titleEn: 'Anti-Money Laundering Policy', type: 'Policy',
    category: 'Compliance', ownerId: 1, reviewerId: 3, approverId: 3, currentVersion: '3.1', effectiveDate: '2024-03-01',
    nextReviewDate: '2025-03-01', status: 'Active', impactLevel: 'Critical', linkedFrameworks: [1],
    linkedObligations: [1, 2, 3, 4, 5], linkedControls: [1, 2, 3], linkedRisks: [1], standardRequirements: [5, 6, 7, 8, 9],
    attestationCampaigns: [2],
    summary: 'Ø³ÙŠØ§Ø³Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨ ØªØ¶Ø¹ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© ÙˆØ§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ù†ÙŠÙŠÙ†',
    objectives: ['Ù…Ù†Ø¹ ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', 'Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª SAMA'],
    createdAt: '2022-06-01', createdBy: 1, lastModifiedAt: '2024-03-01', lastModifiedBy: 1,
  },
  {
    id: 3, code: 'POL-003', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Policy', type: 'Policy',
    category: 'Cybersecurity', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.5',
    effectiveDate: '2024-02-15', nextReviewDate: '2025-02-15', status: 'Active', impactLevel: 'Critical',
    linkedFrameworks: [4, 7], linkedObligations: [9, 10, 11, 12], linkedControls: [4, 5], linkedRisks: [3, 4],
    standardRequirements: [10, 11, 12, 13], attestationCampaigns: [3],
    summary: 'ØªØ­Ø¯Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØ¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ø­Ù…Ø§ÙŠØ© Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©',
    objectives: ['Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ø¶ÙˆØ§Ø¨Ø· NCA'],
    createdAt: '2023-06-01', createdBy: 6, lastModifiedAt: '2024-02-15', lastModifiedBy: 6,
  },
  {
    id: 4, code: 'POL-004', title: 'Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', titleEn: 'Personal Data Protection Policy',
    type: 'Policy', category: 'Data', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2023-09-14', nextReviewDate: '2024-09-14', status: 'Active', impactLevel: 'High',
    linkedFrameworks: [9], linkedObligations: [13, 14, 15], linkedControls: [6, 7], linkedRisks: [5],
    standardRequirements: [14, 15, 16], attestationCampaigns: [4],
    summary: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© PDPL',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
    objectives: ['Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØ© Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù€ PDPL'],
    createdAt: '2023-09-01', createdBy: 6, lastModifiedAt: '2023-09-14', lastModifiedBy: 6,
  },
  {
    id: 5, code: 'STD-001', title: 'Ù…Ø¹ÙŠØ§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', titleEn: 'Identity & Access Management Standard',
    type: 'Standard', category: 'IT', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '2.0',
    effectiveDate: '2024-01-01', nextReviewDate: '2025-01-01', status: 'Active', impactLevel: 'High',
    linkedFrameworks: [7], linkedObligations: [11], linkedControls: [4], linkedRisks: [4],
    standardRequirements: [17, 18, 19], attestationCampaigns: [], summary: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø¸Ù…Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', objectives: ['Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡ ÙÙ‚Ø·'], createdAt: '2023-01-01', createdBy: 6,
    lastModifiedAt: '2024-01-01', lastModifiedBy: 6,
  },
  {
    id: 6, code: 'PRC-001', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
    titleEn: 'Suspicious Transaction Reporting Procedure', type: 'Procedure', category: 'Compliance', ownerId: 1,
    reviewerId: 2, approverId: 3, currentVersion: '2.3', effectiveDate: '2024-01-15', nextReviewDate: '2025-01-15',
    status: 'Active', impactLevel: 'Critical', linkedFrameworks: [1], linkedObligations: [3], linkedControls: [2],
    linkedRisks: [1], standardRequirements: [20, 21], attestationCampaigns: [],
    summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', scope: 'Ù…ÙˆØ¸ÙÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',
    objectives: ['Ø¶Ù…Ø§Ù† Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯'], createdAt: '2022-01-01', createdBy: 1, lastModifiedAt: '2024-01-15',
    lastModifiedBy: 1,
  },
  {
    id: 7, code: 'POL-005', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', titleEn: 'Corporate Governance Policy', type: 'Policy',
    category: 'Governance', ownerId: 7, reviewerId: 3, approverId: 3, currentVersion: '1.2', effectiveDate: '2024-05-01',
    nextReviewDate: '2025-05-01', status: 'Active', impactLevel: 'High', linkedFrameworks: [5],
    linkedObligations: [18, 19], linkedControls: [], linkedRisks: [], standardRequirements: [22, 23],
    attestationCampaigns: [5],
    summary: 'Ø³ÙŠØ§Ø³Ø© Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
    scope: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', objectives: ['ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ø­Ù…Ø§ÙŠØ© Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†'],
    createdAt: '2023-05-01', createdBy: 7, lastModifiedAt: '2024-05-01', lastModifiedBy: 7,
  },
  {
    id: 8, code: 'POL-006', title: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', titleEn: 'Human Resources Management Policy',
    type: 'Policy', category: 'HR', ownerId: 5, reviewerId: 3, approverId: 3, currentVersion: '2.1',
    effectiveDate: '2024-01-01', nextReviewDate: '2025-01-01', status: 'Active', impactLevel: 'Medium',
    linkedFrameworks: [13, 14], linkedObligations: [20, 21], linkedControls: [8], linkedRisks: [6],
    standardRequirements: [24, 25], attestationCampaigns: [], summary: 'Ø³ÙŠØ§Ø³Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªÙˆØ·ÙŠÙ†',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', objectives: ['Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„', 'ØªØ­Ù‚ÙŠÙ‚ Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ†'], createdAt: '2022-01-01',
    createdBy: 5, lastModifiedAt: '2024-01-01', lastModifiedBy: 5,
  },
  {
    id: 9, code: 'POL-007', title: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', titleEn: 'Business Continuity Management Policy',
    type: 'Policy', category: 'Operations', ownerId: 7, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-06-01', nextReviewDate: '2025-06-01', status: 'UnderReview', impactLevel: 'Critical',
    linkedFrameworks: [3], linkedObligations: [], linkedControls: [], linkedRisks: [], standardRequirements: [],
    attestationCampaigns: [], summary: 'Ø³ÙŠØ§Ø³Ø© Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©',
    objectives: ['Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', 'ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø·Ù„'], createdAt: '2024-05-01', createdBy: 7,
    lastModifiedAt: '2024-05-15', lastModifiedBy: 7,
  },
  {
    id: 10, code: 'POL-008', title: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', titleEn: 'Risk Management Policy', type: 'Policy',
    category: 'Risk', ownerId: 5, reviewerId: 3, approverId: 3, currentVersion: '1.5', effectiveDate: '2024-01-01',
    nextReviewDate: '2025-01-01', status: 'Draft', impactLevel: 'High', linkedFrameworks: [2], linkedObligations: [8],
    linkedControls: [], linkedRisks: [], standardRequirements: [], attestationCampaigns: [],
    summary: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª', objectives: ['ØªØ­Ø¯ÙŠØ¯ ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±'],
    createdAt: '2024-01-01', createdBy: 5, lastModifiedAt: '2024-01-10', lastModifiedBy: 5,
  },
  // Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Additional Standards)
  {
    id: 11, code: 'STD-002', title: 'Ù…Ø¹ÙŠØ§Ø± ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'Data Classification Standard', type: 'Standard',
    category: 'Data', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0', effectiveDate: '2024-03-01',
    nextReviewDate: '2025-03-01', status: 'Active', impactLevel: 'High', linkedFrameworks: [7, 9],
    linkedObligations: [13, 14], linkedControls: [6, 7], linkedRisks: [5], standardRequirements: [],
    attestationCampaigns: [], summary: 'Ù…Ø¹ÙŠØ§Ø± ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø³Ø±ÙŠØ©', scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©',
    objectives: ['ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', 'Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù€ PDPL'],
    createdAt: '2024-02-01', createdBy: 6, lastModifiedAt: '2024-03-01', lastModifiedBy: 6,
  },
  {
    id: 12, code: 'STD-003', title: 'Ù…Ø¹ÙŠØ§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', titleEn: 'Vulnerability Management Standard',
    type: 'Standard', category: 'Cybersecurity', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '2.1',
    effectiveDate: '2024-04-01', nextReviewDate: '2025-04-01', status: 'Active', impactLevel: 'Critical',
    linkedFrameworks: [4, 7], linkedObligations: [9, 10], linkedControls: [4, 5], linkedRisks: [3, 4],
    standardRequirements: [], attestationCampaigns: [],
    summary: 'Ù…Ø¹ÙŠØ§Ø± Ø§ÙƒØªØ´Ø§Ù ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª',
    objectives: ['Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø«ØºØ±Ø§Øª', 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯'],
    createdAt: '2024-01-15', createdBy: 6, lastModifiedAt: '2024-04-01', lastModifiedBy: 6,
  },
  {
    id: 13, code: 'STD-004', title: 'Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­', titleEn: 'Encryption & Key Management Standard',
    type: 'Standard', category: 'Cybersecurity', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.5',
    effectiveDate: '2024-02-01', nextReviewDate: '2025-02-01', status: 'Active', impactLevel: 'Critical',
    linkedFrameworks: [4, 7], linkedObligations: [11, 12], linkedControls: [4, 5], linkedRisks: [3],
    standardRequirements: [], attestationCampaigns: [],
    summary: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ´ÙÙŠØ± Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ÙØ±Ø©',
    objectives: ['ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†'],
    createdAt: '2024-01-01', createdBy: 6, lastModifiedAt: '2024-02-01', lastModifiedBy: 6,
  },
  {
    id: 14, code: 'STD-005', title: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª', titleEn: 'Network Security Standard', type: 'Standard',
    category: 'Cybersecurity', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-05-01', nextReviewDate: '2025-05-01', status: 'UnderReview', impactLevel: 'Critical',
    linkedFrameworks: [4, 7], linkedObligations: [9, 10], linkedControls: [4], linkedRisks: [3, 4],
    standardRequirements: [], attestationCampaigns: [], summary: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©',
    scope: 'Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ù„Ù„Ø´Ø¨ÙƒØ§Øª',
    objectives: ['Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø¨ÙƒØ§Øª', 'Ù…Ù†Ø¹ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª', 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'],
    createdAt: '2024-04-01', createdBy: 6, lastModifiedAt: '2024-04-15', lastModifiedBy: 6,
  },
  {
    id: 15, code: 'STD-006', title: 'Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©', titleEn: 'Backup & Recovery Standard',
    type: 'Standard', category: 'Operations', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-06-01', nextReviewDate: '2025-06-01', status: 'Draft', impactLevel: 'High',
    linkedFrameworks: [3, 7], linkedObligations: [], linkedControls: [], linkedRisks: [], standardRequirements: [],
    attestationCampaigns: [],
    summary: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©',
    objectives: ['Ø¶Ù…Ø§Ù† ØªÙˆÙØ± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¯ÙˆØ±ÙŠØ§Ù‹'],
    createdAt: '2024-05-15', createdBy: 6, lastModifiedAt: '2024-05-20', lastModifiedBy: 6,
  },
  // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Additional Procedures)
  {
    id: 16, code: 'PRC-002', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„', titleEn: 'Customer Identity Verification Procedure',
    type: 'Procedure', category: 'Compliance', ownerId: 1, reviewerId: 2, approverId: 3, currentVersion: '3.0',
    effectiveDate: '2024-02-01', nextReviewDate: '2025-02-01', status: 'Active', impactLevel: 'Critical',
    linkedFrameworks: [1], linkedObligations: [1, 2], linkedControls: [1, 2], linkedRisks: [1], standardRequirements: [],
    attestationCampaigns: [],
    summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (KYC) ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯ ÙˆØ§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†',
    objectives: ['Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©', 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„', 'ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'],
    createdAt: '2022-06-01', createdBy: 1, lastModifiedAt: '2024-02-01', lastModifiedBy: 1,
  },
  {
    id: 17, code: 'PRC-003', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©', titleEn: 'Security Incident Management Procedure',
    type: 'Procedure', category: 'Cybersecurity', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '2.0',
    effectiveDate: '2024-03-01', nextReviewDate: '2025-03-01', status: 'Active', impactLevel: 'Critical',
    linkedFrameworks: [4, 7], linkedObligations: [9, 10], linkedControls: [4, 5], linkedRisks: [3, 4],
    standardRequirements: [], attestationCampaigns: [], summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
    objectives: ['Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø³Ø±ÙŠØ¹', 'Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡', 'Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ ÙˆØ§Ù„ØªØ¹Ù„Ù…'],
    createdAt: '2023-06-01', createdBy: 6, lastModifiedAt: '2024-03-01', lastModifiedBy: 6,
  },
  {
    id: 18, code: 'PRC-004', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', titleEn: 'Change Management Procedure', type: 'Procedure',
    category: 'IT', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.5', effectiveDate: '2024-01-15',
    nextReviewDate: '2025-01-15', status: 'Active', impactLevel: 'High', linkedFrameworks: [7], linkedObligations: [11],
    linkedControls: [4], linkedRisks: [4], standardRequirements: [], attestationCampaigns: [],
    summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª', scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬',
    objectives: ['Ø¶Ù…Ø§Ù† Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¢Ù…Ù†', 'ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„'],
    createdAt: '2023-01-01', createdBy: 6, lastModifiedAt: '2024-01-15', lastModifiedBy: 6,
  },
  {
    id: 19, code: 'PRC-005', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø·Ù„Ø¨ Ø­Ù‚ÙˆÙ‚ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'Data Subject Rights Request Procedure',
    type: 'Procedure', category: 'Data', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-04-01', nextReviewDate: '2025-04-01', status: 'UnderReview', impactLevel: 'High',
    linkedFrameworks: [9], linkedObligations: [13, 14, 15], linkedControls: [6, 7], linkedRisks: [5],
    standardRequirements: [], attestationCampaigns: [], summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø·Ù„Ø¨Ø§Øª Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
    objectives: ['Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…', 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù€ PDPL'],
    createdAt: '2024-03-01', createdBy: 6, lastModifiedAt: '2024-03-15', lastModifiedBy: 6,
  },
  {
    id: 20, code: 'PRC-006', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø±Ø§Ø¬Ø¹Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„', titleEn: 'Access Rights Review Procedure',
    type: 'Procedure', category: 'IT', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-05-01', nextReviewDate: '2025-05-01', status: 'Draft', impactLevel: 'High', linkedFrameworks: [7],
    linkedObligations: [11], linkedControls: [4], linkedRisks: [4], standardRequirements: [], attestationCampaigns: [],
    summary: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', scope: 'Ø¬Ù…ÙŠØ¹ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
    objectives: ['Ù…Ø±Ø§Ø¬Ø¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©', 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©'],
    createdAt: '2024-04-15', createdBy: 6, lastModifiedAt: '2024-04-20', lastModifiedBy: 6,
  },
  // Ø³Ø¬Ù„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ (Additional Draft/UnderReview)
  {
    id: 21, code: 'POL-009', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯', titleEn: 'Remote Work Policy', type: 'Policy', category: 'HR',
    ownerId: 5, reviewerId: 3, approverId: 3, currentVersion: '1.0', effectiveDate: '2024-07-01',
    nextReviewDate: '2025-07-01', status: 'Draft', impactLevel: 'Medium', linkedFrameworks: [7], linkedObligations: [],
    linkedControls: [], linkedRisks: [], standardRequirements: [], attestationCampaigns: [],
    summary: 'Ø³ÙŠØ§Ø³Ø© ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯ ÙˆØ¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¹Ù† Ø¨ÙØ¹Ø¯', objectives: ['ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯', 'Ø¶Ù…Ø§Ù† Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'],
    createdAt: '2024-06-01', createdBy: 5, lastModifiedAt: '2024-06-10', lastModifiedBy: 5,
  },
  {
    id: 22, code: 'POL-010', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„', titleEn: 'Acceptable Use Policy', type: 'Policy',
    category: 'IT', ownerId: 6, reviewerId: 3, approverId: 3, currentVersion: '1.0', effectiveDate: '2024-06-01',
    nextReviewDate: '2025-06-01', status: 'UnderReview', impactLevel: 'Medium', linkedFrameworks: [7],
    linkedObligations: [], linkedControls: [4], linkedRisks: [], standardRequirements: [], attestationCampaigns: [],
    summary: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ù…ÙˆØ§Ø±Ø¯ ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', scope: 'Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³Ø©',
    objectives: ['ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„', 'Ø­Ù…Ø§ÙŠØ© Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©'],
    createdAt: '2024-05-01', createdBy: 6, lastModifiedAt: '2024-05-15', lastModifiedBy: 6,
  },
  {
    id: 23, code: 'POL-011', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©', titleEn: 'Third Party Management Policy',
    type: 'Policy', category: 'Compliance', ownerId: 1, reviewerId: 3, approverId: 3, currentVersion: '1.0',
    effectiveDate: '2024-07-01', nextReviewDate: '2025-07-01', status: 'Draft', impactLevel: 'High',
    linkedFrameworks: [1, 7], linkedObligations: [], linkedControls: [], linkedRisks: [], standardRequirements: [],
    attestationCampaigns: [], summary: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø© ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†',
    scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ù…Ø¹ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©',
    objectives: ['ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†', 'Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ÙŠ'],
    createdAt: '2024-06-15', createdBy: 1, lastModifiedAt: '2024-06-20', lastModifiedBy: 1,
  },
];

// 15) Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª (Policy Versions)
const POLICY_VERSIONS = [
  { id: 1, policyId: 1, version: '1.0', status: 'Superseded', effectiveDate: '2023-01-01', retiredDate: '2024-01-01', changeReason: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', changedBy: 7 },
  { id: 2, policyId: 1, version: '2.0', status: 'Active', effectiveDate: '2024-01-01', retiredDate: null, changeReason: 'ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª SAMA Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', changedBy: 7 },
  { id: 3, policyId: 2, version: '1.0', status: 'Superseded', effectiveDate: '2022-06-01', retiredDate: '2023-06-01', changeReason: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', changedBy: 1 },
  { id: 4, policyId: 2, version: '2.0', status: 'Superseded', effectiveDate: '2023-06-01', retiredDate: '2024-01-01', changeReason: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©', changedBy: 1 },
  { id: 5, policyId: 2, version: '3.0', status: 'Superseded', effectiveDate: '2024-01-01', retiredDate: '2024-03-01', changeReason: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª PEP', changedBy: 1 },
  { id: 6, policyId: 2, version: '3.1', status: 'Active', effectiveDate: '2024-03-01', retiredDate: null, changeReason: 'ØªØµØ­ÙŠØ­Ø§Øª Ø·ÙÙŠÙØ©', changedBy: 1 },
  { id: 7, policyId: 3, version: '1.0', status: 'Superseded', effectiveDate: '2023-06-01', retiredDate: '2024-02-15', changeReason: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', changedBy: 6 },
  { id: 8, policyId: 3, version: '1.5', status: 'Active', effectiveDate: '2024-02-15', retiredDate: null, changeReason: 'ØªØ­Ø¯ÙŠØ« Ø¶ÙˆØ§Ø¨Ø· NCA ECC 2.0', changedBy: 6 },
];

// 16) Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± (Standard Requirements)
const STANDARD_REQUIREMENTS = [
  // POL-001 Requirements
  { id: 1, policyId: 1, refCode: 'POL001-REQ-01', statement: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù…ØªØ«Ø§Ù„ Ù…Ø¹ØªÙ…Ø¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [6], linkedControls: [] },
  { id: 2, policyId: 1, refCode: 'POL001-REQ-02', statement: 'ÙŠØ¬Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø§Ù…ØªØ«Ø§Ù„ Ø³Ù†ÙˆÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [7], linkedControls: [] },
  { id: 3, policyId: 1, refCode: 'POL001-REQ-03', statement: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [8], linkedControls: [] },
  { id: 4, policyId: 1, refCode: 'POL001-REQ-04', statement: 'ÙŠÙ†Ø¨ØºÙŠ ØªÙˆÙÙŠØ± Ø¨Ø±Ø§Ù…Ø¬ ØªÙˆØ¹ÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†', mandatoryLevel: 'ShouldComply', evidenceRequired: true, testingFrequency: 'Quarterly', linkedObligations: [], linkedControls: [] },

  // POL-002 Requirements
  { id: 5, policyId: 2, refCode: 'POL002-REQ-01', statement: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ CDD', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Daily', linkedObligations: [1, 2], linkedControls: [1] },
  { id: 6, policyId: 2, refCode: 'POL002-REQ-02', statement: 'ÙŠØ¬Ø¨ ÙØ­Øµ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¶Ø¯ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'RealTime', linkedObligations: [1], linkedControls: [1] },
  { id: 7, policyId: 2, refCode: 'POL002-REQ-03', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'EventDriven', linkedObligations: [3], linkedControls: [2] },
  { id: 8, policyId: 2, refCode: 'POL002-REQ-04', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù…Ø¯Ø© 10 Ø³Ù†ÙˆØ§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [4], linkedControls: [] },
  { id: 9, policyId: 2, refCode: 'POL002-REQ-05', statement: 'ÙŠØ¬Ø¨ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [5], linkedControls: [3] },

  // POL-003 Requirements
  { id: 10, policyId: 3, refCode: 'POL003-REQ-01', statement: 'ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø£Ù…Ù† Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ø¹ØªÙ…Ø¯Ø©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [9], linkedControls: [] },
  { id: 11, policyId: 3, refCode: 'POL003-REQ-02', statement: 'ÙŠØ¬Ø¨ ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [10], linkedControls: [] },
  { id: 12, policyId: 3, refCode: 'POL003-REQ-03', statement: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Monthly', linkedObligations: [11], linkedControls: [4] },
  { id: 13, policyId: 3, refCode: 'POL003-REQ-04', statement: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø³Ù†ÙˆÙŠØ§Ù‹', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [12], linkedControls: [5] },

  // POL-004 Requirements
  { id: 14, policyId: 4, refCode: 'POL004-REQ-01', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© Ù‚Ø¨Ù„ Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'RealTime', linkedObligations: [13], linkedControls: [6] },
  { id: 15, policyId: 4, refCode: 'POL004-REQ-02', statement: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª DPO', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [14], linkedControls: [] },
  { id: 16, policyId: 4, refCode: 'POL004-REQ-03', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'EventDriven', linkedObligations: [15], linkedControls: [7] },

  // STD-001 Requirements
  { id: 17, policyId: 5, refCode: 'STD001-REQ-01', statement: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Monthly', linkedObligations: [11], linkedControls: [4] },
  { id: 18, policyId: 5, refCode: 'STD001-REQ-02', statement: 'ÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¯ÙˆØ±ÙŠØ§Ù‹', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Quarterly', linkedObligations: [11], linkedControls: [4] },
  { id: 19, policyId: 5, refCode: 'STD001-REQ-03', statement: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ MFA', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [11], linkedControls: [4] },

  // PRC-001 Requirements
  { id: 20, policyId: 6, refCode: 'PRC001-REQ-01', statement: 'ÙŠØ¬Ø¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø®Ù„Ø§Ù„ 4 Ø³Ø§Ø¹Ø§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'EventDriven', linkedObligations: [3], linkedControls: [2] },
  { id: 21, policyId: 6, refCode: 'PRC001-REQ-02', statement: 'ÙŠØ¬Ø¨ ØªÙˆØ«ÙŠÙ‚ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø£Ùˆ Ø¹Ø¯Ù…Ù‡ Ù…Ø¹ Ø§Ù„Ù…Ø¨Ø±Ø±Ø§Øª', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'EventDriven', linkedObligations: [3], linkedControls: [2] },

  // POL-005 Requirements
  { id: 22, policyId: 7, refCode: 'POL005-REQ-01', statement: 'ÙŠØ¬Ø¨ ØªØ´ÙƒÙŠÙ„ Ù„Ø¬Ø§Ù† Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù†Ø¸Ø§Ù…Ø§Ù‹', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Annual', linkedObligations: [18], linkedControls: [] },
  { id: 23, policyId: 7, refCode: 'POL005-REQ-02', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠØ©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'EventDriven', linkedObligations: [19], linkedControls: [] },

  // POL-006 Requirements
  { id: 24, policyId: 8, refCode: 'POL006-REQ-01', statement: 'ÙŠØ¬Ø¨ ØµØ±Ù Ø§Ù„Ø£Ø¬ÙˆØ± Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Monthly', linkedObligations: [20], linkedControls: [8] },
  { id: 25, policyId: 8, refCode: 'POL006-REQ-02', statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', mandatoryLevel: 'Mandatory', evidenceRequired: true, testingFrequency: 'Monthly', linkedObligations: [21], linkedControls: [] },
];

// 17) Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± (Attestation Campaigns)
const ATTESTATION_CAMPAIGNS = [
  {
    id: 1, policyId: 1, title: 'Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠØ© - Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ 2024', dueDate: '2024-02-28',
    reminderDays: [14, 7, 3, 1], escalationDays: 3,
    targetAudience: { type: 'All', departments: [], roles: [] },
    status: 'Active', totalRecipients: 150, acknowledged: 142, pending: 5, overdue: 3, exempted: 0,
    createdAt: '2024-01-15', createdBy: 7,
  },
  {
    id: 2, policyId: 2, title: 'Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± - Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ 2024', dueDate: '2024-04-15',
    reminderDays: [14, 7, 3, 1], escalationDays: 2,
    targetAudience: { type: 'Departments', departments: ['Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'], roles: [] },
    status: 'Completed', totalRecipients: 80, acknowledged: 80, pending: 0, overdue: 0, exempted: 0,
    createdAt: '2024-03-01', createdBy: 1,
  },
  {
    id: 3, policyId: 3, title: 'Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± - Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ 2024', dueDate: '2024-03-31',
    reminderDays: [14, 7, 3, 1], escalationDays: 3,
    targetAudience: { type: 'All', departments: [], roles: [] },
    status: 'Active', totalRecipients: 150, acknowledged: 115, pending: 20, overdue: 15, exempted: 0,
    createdAt: '2024-02-15', createdBy: 6,
  },
  {
    id: 4, policyId: 4, title: 'Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± - Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 2024', dueDate: '2024-10-31',
    reminderDays: [30, 14, 7, 3], escalationDays: 5,
    targetAudience: { type: 'All', departments: [], roles: [] },
    status: 'Active', totalRecipients: 150, acknowledged: 144, pending: 4, overdue: 2, exempted: 0,
    createdAt: '2023-09-20', createdBy: 6,
  },
  {
    id: 5, policyId: 7, title: 'Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± - Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© 2024', dueDate: '2024-06-30', reminderDays: [14, 7, 3],
    escalationDays: 3,
    targetAudience: { type: 'Roles', departments: [], roles: ['Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠÙˆÙ†', 'Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª'] },
    status: 'Active', totalRecipients: 25, acknowledged: 22, pending: 2, overdue: 1, exempted: 0, createdAt: '2024-05-01',
    createdBy: 7,
  },
];

// 18) Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ© (Attestation Records)
const ATTESTATION_RECORDS = [
  { id: 1, campaignId: 1, userId: 1, status: 'Acknowledged', acknowledgedAt: '2024-01-20', ipAddress: '192.168.1.100' },
  { id: 2, campaignId: 1, userId: 2, status: 'Acknowledged', acknowledgedAt: '2024-01-21', ipAddress: '192.168.1.101' },
  { id: 3, campaignId: 1, userId: 3, status: 'Overdue', acknowledgedAt: null, ipAddress: null },
  { id: 4, campaignId: 3, userId: 1, status: 'Acknowledged', acknowledgedAt: '2024-03-01', ipAddress: '192.168.1.100' },
  { id: 5, campaignId: 3, userId: 6, status: 'Pending', acknowledgedAt: null, ipAddress: null },
];

// 13) Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© (Controls)
const CONTROLS = [
  {
    id: 1, code: 'CTRL-001', title: 'Ù†Ø¸Ø§Ù… ÙØ­Øµ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¢Ù„ÙŠ', titleEn: 'Automated Customer Screening System',
    type: 'Preventive', category: 'IT', ownerId: 6, frequency: 'RealTime', status: 'Active', effectiveness: 'Effective',
    lastTestDate: '2024-11-15', linkedObligations: [1, 2], linkedRisks: [1, 2],
  },
  {
    id: 2, code: 'CTRL-002', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', titleEn: 'Daily Transaction Review',
    type: 'Detective', category: 'Compliance', ownerId: 1, frequency: 'Daily', status: 'Active',
    effectiveness: 'Effective', lastTestDate: '2024-12-01', linkedObligations: [3], linkedRisks: [1],
  },
  {
    id: 3, code: 'CTRL-003', title: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', titleEn: 'Annual AML Training Program',
    type: 'Preventive', category: 'HR', ownerId: 1, frequency: 'Annual', status: 'Active', effectiveness: 'Effective',
    lastTestDate: '2024-09-01', linkedObligations: [5], linkedRisks: [1],
  },
  {
    id: 4, code: 'CTRL-004', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', titleEn: 'Identity & Access Management System',
    type: 'Preventive', category: 'IT', ownerId: 6, frequency: 'RealTime', status: 'Active', effectiveness: 'Effective',
    lastTestDate: '2024-10-15', linkedObligations: [11], linkedRisks: [3, 4],
  },
  {
    id: 5, code: 'CTRL-005', title: 'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', titleEn: 'Periodic Penetration Testing',
    type: 'Detective', category: 'Cybersecurity', ownerId: 6, frequency: 'Annual', status: 'Active',
    effectiveness: 'Partially Effective', lastTestDate: '2024-08-01', linkedObligations: [12], linkedRisks: [3],
  },
  {
    id: 6, code: 'CTRL-006', title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'Data Consent Management System',
    type: 'Preventive', category: 'IT', ownerId: 6, frequency: 'RealTime', status: 'Active', effectiveness: 'Effective',
    lastTestDate: '2024-11-01', linkedObligations: [13], linkedRisks: [5],
  },
  {
    id: 7, code: 'CTRL-007', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'Data Breach Response Procedure',
    type: 'Corrective', category: 'Compliance', ownerId: 6, frequency: 'EventDriven', status: 'Active',
    effectiveness: 'Effective', lastTestDate: '2024-10-01', linkedObligations: [15], linkedRisks: [5],
  },
  {
    id: 8, code: 'CTRL-008', title: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ± WPS', titleEn: 'Wage Protection System', type: 'Preventive',
    category: 'HR', ownerId: 5, frequency: 'Monthly', status: 'Active', effectiveness: 'Effective',
    lastTestDate: '2024-12-01', linkedObligations: [20], linkedRisks: [6],
  },
];

// 14) Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Risks)
const RISKS = [
  {
    id: 1, code: 'RSK-001', title: 'Ù…Ø®Ø§Ø·Ø± ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨',
    titleEn: 'Money Laundering & Terrorism Financing Risk', category: 'Compliance', inherentRating: 'High',
    residualRating: 'Medium', ownerId: 1, status: 'Active', linkedObligations: [1, 2, 3, 4, 5], linkedControls: [1, 2, 3],
    impact: 'High', likelihood: 'Medium',
  },
  {
    id: 2, code: 'RSK-002', title: 'Ù…Ø®Ø§Ø·Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©', titleEn: 'CDD Non-Compliance Risk',
    category: 'Compliance', inherentRating: 'High', residualRating: 'Low', ownerId: 1, status: 'Active',
    linkedObligations: [1, 2], linkedControls: [1], impact: 'High', likelihood: 'Low',
  },
  {
    id: 3, code: 'RSK-003', title: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Risk', category: 'Cybersecurity',
    inherentRating: 'Critical', residualRating: 'Medium', ownerId: 6, status: 'Active', linkedObligations: [9, 10, 11, 12],
    linkedControls: [4, 5], impact: 'Critical', likelihood: 'Medium',
  },
  {
    id: 4, code: 'RSK-004', title: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡', titleEn: 'Unauthorized Access Risk', category: 'IT',
    inherentRating: 'High', residualRating: 'Low', ownerId: 6, status: 'Active', linkedObligations: [11],
    linkedControls: [4], impact: 'High', likelihood: 'Low',
  },
  {
    id: 5, code: 'RSK-005', title: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù†ØªÙ‡Ø§Ùƒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', titleEn: 'Personal Data Breach Risk', category: 'Data',
    inherentRating: 'High', residualRating: 'Medium', ownerId: 6, status: 'Active', linkedObligations: [13, 14, 15],
    linkedControls: [6, 7], impact: 'High', likelihood: 'Medium',
  },
  {
    id: 6, code: 'RSK-006', title: 'Ù…Ø®Ø§Ø·Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', titleEn: 'WPS Non-Compliance Risk',
    category: 'HR', inherentRating: 'Medium', residualRating: 'Low', ownerId: 5, status: 'Active', linkedObligations: [20],
    linkedControls: [8], impact: 'Medium', likelihood: 'Low',
  },
];

// 15) Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· (Control Types)
const CONTROL_TYPES = [
  { code: 'Preventive', nameAr: 'ÙˆÙ‚Ø§Ø¦ÙŠ', nameEn: 'Preventive', color: 'emerald' },
  { code: 'Detective', nameAr: 'ÙƒØ§Ø´Ù', nameEn: 'Detective', color: 'blue' },
  { code: 'Corrective', nameAr: 'ØªØµØ­ÙŠØ­ÙŠ', nameEn: 'Corrective', color: 'amber' },
];

// 16) Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±Ø¨Ø· (Mapping Records) - Golden Thread
const MAPPINGS = [
  // Obligation 1 â†’ Controls & Risks
  { id: 1, obligationId: 1, controlId: 1, riskId: 1, policyId: 2, coverageLevel: 'Full', status: 'Active' },
  { id: 2, obligationId: 2, controlId: 1, riskId: 2, policyId: 2, coverageLevel: 'Full', status: 'Active' },
  { id: 3, obligationId: 3, controlId: 2, riskId: 1, policyId: 2, coverageLevel: 'Full', status: 'Active' },
  { id: 4, obligationId: 5, controlId: 3, riskId: 1, policyId: 2, coverageLevel: 'Full', status: 'Active' },
  // Cybersecurity mappings
  { id: 5, obligationId: 11, controlId: 4, riskId: 4, policyId: 3, coverageLevel: 'Full', status: 'Active' },
  { id: 6, obligationId: 12, controlId: 5, riskId: 3, policyId: 3, coverageLevel: 'Partial', status: 'Active', justification: 'ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© ØªÙƒØ±Ø§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª' },
  // Data Protection mappings
  { id: 7, obligationId: 13, controlId: 6, riskId: 5, policyId: 4, coverageLevel: 'Full', status: 'Active' },
  { id: 8, obligationId: 15, controlId: 7, riskId: 5, policyId: 4, coverageLevel: 'Full', status: 'Active' },
  // HR mappings
  { id: 9, obligationId: 20, controlId: 8, riskId: 6, policyId: 8, coverageLevel: 'Full', status: 'Active' },
];

const INITIAL_OBLIGATIONS = [
  {
    id: 1, code: 'OBL-001', authorityId: 1, frameworkId: 1, requirementIds: [1, 2],
    title: 'ØªÙ†ÙÙŠØ° Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ (CDD)',
    statement: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯ ÙˆØ§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†ØŒ Ø¨Ù…Ø§ ÙŠØ´Ù…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆÙÙ‡Ù… Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±.',
    category: 'Compliance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3,
    escalationPath: 'ComplianceDirector', frequency: 'EventDriven', dueRule: null,
    triggerDescription: 'Ø¹Ù†Ø¯ ÙØªØ­ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙŠÙ„',
    evidenceRequired: true, evidenceTypes: ['Procedure', 'Log', 'Approval'], evidenceValidityDays: 365,
    acceptanceCriteria: 'ÙˆØ¬ÙˆØ¯ Ù†Ù…ÙˆØ°Ø¬ KYC Ù…ÙƒØªÙ…Ù„ ÙˆÙ…ÙˆÙ‚Ø¹ØŒ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
    retentionValue: 10, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'License', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
    linkedControls: [
      { controlId: 'CTL-001', controlName: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„', type: 'Primary', effectiveness: 85 },
      { controlId: 'CTL-002', controlName: 'Ø¶ÙˆØ§Ø¨Ø· ÙØ­Øµ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', type: 'Secondary', effectiveness: 90 },
      { controlId: 'CTL-003', controlName: 'Ø¶ÙˆØ§Ø¨Ø· ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„', type: 'Primary', effectiveness: 80 }
    ],
    linkedRisks: [
      { riskId: 'RSK-001', riskName: 'Ù…Ø®Ø§Ø·Ø± ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', riskLevel: 'High', mitigationLevel: 'Partial' },
      { riskId: 'RSK-002', riskName: 'Ù…Ø®Ø§Ø·Ø± ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨', riskLevel: 'Critical', mitigationLevel: 'Partial' }
    ],
    linkedPolicies: [
      { policyId: 'POL-001', policyName: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', version: '2.0', status: 'Active' },
      { policyId: 'POL-002', policyName: 'Ø³ÙŠØ§Ø³Ø© Ø§Ø¹Ø±Ù Ø¹Ù…ÙŠÙ„Ùƒ', version: '1.5', status: 'Active' }
    ],
    dependencies: [
      { obligationId: 2, obligationCode: 'OBL-002', type: 'Prerequisite', description: 'ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ CDD Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº' },
      { obligationId: 3, obligationCode: 'OBL-003', type: 'Related', description: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙŠØ´Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©' }
    ],
    conflicts: [],
    workflowStatus: 'Approved',
    workflowHistory: [
      { action: 'Created', by: 1, byName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', date: '2023-12-15', comments: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…' },
      { action: 'Submitted', by: 1, byName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', date: '2023-12-16', comments: 'Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
      { action: 'Reviewed', by: 2, byName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', date: '2023-12-18', comments: 'ØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
      { action: 'Approved', by: 3, byName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', date: '2023-12-20', comments: 'Ù…Ø¹ØªÙ…Ø¯' }
    ],
    nextReviewDate: '2025-01-01', reviewCycle: 'Annual', lastReviewDate: '2024-01-10',
    notificationRules: [
      { event: 'DueDateApproaching', daysBefore: 30, recipients: ['Owner', 'Reviewer'] },
      { event: 'DueDateApproaching', daysBefore: 7, recipients: ['Owner', 'Reviewer', 'Approver'] },
      { event: 'EvidenceExpiring', daysBefore: 30, recipients: ['Owner'] },
      { event: 'ReviewDue', daysBefore: 14, recipients: ['Owner', 'Reviewer'] }
    ],
    escalationRules: [
      { level: 1, condition: 'Overdue > 7 days', escalateTo: 'Reviewer', action: 'Notify' },
      { level: 2, condition: 'Overdue > 14 days', escalateTo: 'Approver', action: 'Notify' },
      { level: 3, condition: 'Overdue > 30 days', escalateTo: 'ComplianceDirector', action: 'Escalate' },
      { level: 4, condition: 'Overdue > 45 days', escalateTo: 'CEO', action: 'Escalate' }
    ],
    exceptions: [],
    complianceScore: 92, testingScore: 88, evidenceScore: 95, overallHealth: 'Good', lastTestDate: '2024-11-15',
    nextTestDate: '2025-02-15',
    testingFrequency: 'Quarterly'
  },
  {
    id: 2, code: 'OBL-002', authorityId: 1, frameworkId: 1, requirementIds: [3], title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
    statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© Ù…Ø´Ø¨ÙˆÙ‡Ø© Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙƒØªØ´Ø§ÙÙ‡Ø§ØŒ Ù…Ø¹ ØªÙˆØ«ÙŠÙ‚ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø¨Ø±Ø±Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©.',
    category: 'Compliance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'CEO',
    frequency: 'EventDriven', dueRule: null, triggerDescription: 'Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø¹Ù…Ù„ÙŠØ© Ù…Ø´Ø¨ÙˆÙ‡Ø©', evidenceRequired: true,
    evidenceTypes: ['Report', 'Log', 'Approval'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ù†Ù…ÙˆØ°Ø¬ STR Ù…ÙƒØªÙ…Ù„ØŒ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ø±ÙŠØ§ØªØŒ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ',
    retentionValue: 10, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'License', 'Legal'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
    linkedControls: [
      { controlId: 'CTL-004', controlName: 'Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', type: 'Primary', effectiveness: 88 },
      { controlId: 'CTL-005', controlName: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', type: 'Primary', effectiveness: 85 }
    ],
    linkedRisks: [
      { riskId: 'RSK-001', riskName: 'Ù…Ø®Ø§Ø·Ø± ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', riskLevel: 'High', mitigationLevel: 'Full' },
      { riskId: 'RSK-003', riskName: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', riskLevel: 'High', mitigationLevel: 'Partial' }
    ],
    linkedPolicies: [
      { policyId: 'POL-001', policyName: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', version: '2.0', status: 'Active' },
      { policyId: 'POL-003', policyName: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', version: '1.0', status: 'Active' }
    ],
    dependencies: [
      { obligationId: 1, obligationCode: 'OBL-001', type: 'Dependent', description: 'ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¥ØªÙ…Ø§Ù… CDD' }
    ],
    conflicts: [], workflowStatus: 'Approved',
    workflowHistory: [
      { action: 'Created', by: 1, byName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', date: '2023-12-15', comments: '' },
      { action: 'Approved', by: 3, byName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', date: '2023-12-20', comments: '' }
    ],
    nextReviewDate: '2025-01-01', reviewCycle: 'Annual', lastReviewDate: '2024-01-10',
    notificationRules: [
      { event: 'EventTriggered', daysBefore: 0, recipients: ['Owner', 'Approver'] },
      { event: 'Deadline24h', daysBefore: 0, recipients: ['Owner', 'Reviewer', 'Approver', 'CEO'] }
    ],
    escalationRules: [
      { level: 1, condition: 'Overdue > 12 hours', escalateTo: 'Approver', action: 'Escalate' },
      { level: 2, condition: 'Overdue > 20 hours', escalateTo: 'CEO', action: 'Escalate' }
    ],
    exceptions: [], complianceScore: 95, testingScore: 90, evidenceScore: 92, overallHealth: 'Good',
    lastTestDate: '2024-10-20', nextTestDate: '2025-01-20',
    testingFrequency: 'Quarterly'
  },
  {
    id: 3, code: 'OBL-003', authorityId: 1, frameworkId: 2, requirementIds: [6], title: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù…ØªØ«Ø§Ù„ Ù…Ø³ØªÙ‚Ù„',
    statement: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù…ØªØ«Ø§Ù„ Ù…Ø¤Ù‡Ù„ ÙˆÙ…Ø³ØªÙ‚Ù„ ÙŠØ±ÙØ¹ ØªÙ‚Ø§Ø±ÙŠØ±Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ùˆ Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ© Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª.',
    category: 'Governance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 7, reviewerId: 2, approverId: 3, escalationPath: 'Board',
    frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ© ÙÙŠ Q1', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Approval', 'Contract', 'Certificate'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ù‚Ø±Ø§Ø± ØªØ¹ÙŠÙŠÙ† Ù…Ø¹ØªÙ…Ø¯ØŒ Ø¹Ù‚Ø¯ Ø¹Ù…Ù„ØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ù‡Ù†ÙŠØ©ØŒ Ù‡ÙŠÙƒÙ„ ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙŠÙˆØ¶Ø­ Ø®Ø· Ø§Ù„Ø±ÙØ¹',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Reporting'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Partial', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
    linkedControls: [
      { controlId: 'CTL-006', controlName: 'Ø­ÙˆÙƒÙ…Ø© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', type: 'Primary', effectiveness: 90 }
    ],
    linkedRisks: [
      { riskId: 'RSK-004', riskName: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', riskLevel: 'Medium', mitigationLevel: 'Full' }
    ],
    linkedPolicies: [
      { policyId: 'POL-004', policyName: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', version: '3.0', status: 'Active' }
    ],
    dependencies: [], conflicts: [], workflowStatus: 'Approved',
    workflowHistory: [
      { action: 'Created', by: 1, byName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', date: '2023-12-15', comments: '' },
      { action: 'Approved', by: 3, byName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', date: '2023-12-20', comments: '' }
    ],
    nextReviewDate: '2025-03-31', reviewCycle: 'Annual', lastReviewDate: '2024-03-15',
    notificationRules: [
      { event: 'ReviewDue', daysBefore: 30, recipients: ['Owner', 'Reviewer'] },
      { event: 'ReviewDue', daysBefore: 7, recipients: ['Owner', 'Reviewer', 'Board'] }
    ],
    escalationRules: [
      { level: 1, condition: 'Review Overdue > 14 days', escalateTo: 'Approver', action: 'Notify' },
      { level: 2, condition: 'Review Overdue > 30 days', escalateTo: 'Board', action: 'Escalate' }
    ],
    exceptions: [], complianceScore: 100, testingScore: 95, evidenceScore: 100, overallHealth: 'Excellent',
    lastTestDate: '2024-09-01', nextTestDate: '2025-03-01',
    testingFrequency: 'SemiAnnual'
  },
  {
    id: 4, code: 'OBL-004', authorityId: 1, frameworkId: 2, requirementIds: [7], title: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ',
    statement: 'ÙŠØ¬Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ±ÙØ¹Ù‡ Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† ÙƒÙ„ Ø³Ù†Ø© Ù…Ø§Ù„ÙŠØ©ØŒ ÙŠØªØ¶Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ÙˆØ®Ø·Ø· Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.',
    category: 'Governance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 1, reviewerId: 2, approverId: 3,
    escalationPath: 'ComplianceDirector', frequency: 'Annual', dueRule: 'Ø¢Ø®Ø± ÙŠÙˆÙ… Ø¹Ù…Ù„ Ù…Ù† Ù…Ø§Ø±Ø³', triggerDescription: '',
    evidenceRequired: true, evidenceTypes: ['Report', 'Minutes', 'Approval'], evidenceValidityDays: 365,
    acceptanceCriteria: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„ Ù…ÙƒØªÙ…Ù„ØŒ Ù…Ø­Ø¶Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯',
    retentionValue: 7, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Reporting', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
    linkedControls: [
      { controlId: 'CTL-007', controlName: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', type: 'Primary', effectiveness: 85 }
    ],
    linkedRisks: [
      { riskId: 'RSK-005', riskName: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', riskLevel: 'High', mitigationLevel: 'Full' }
    ],
    linkedPolicies: [
      { policyId: 'POL-005', policyName: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', version: '2.0', status: 'Active' }
    ],
    dependencies: [
      { obligationId: 1, obligationCode: 'OBL-001', type: 'Input', description: 'Ø¨ÙŠØ§Ù†Ø§Øª CDD ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±' },
      { obligationId: 2, obligationCode: 'OBL-002', type: 'Input', description: 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª STR ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±' },
      { obligationId: 3, obligationCode: 'OBL-003', type: 'Input', description: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' }
    ],
    conflicts: [], workflowStatus: 'Approved',
    workflowHistory: [
      { action: 'Created', by: 1, byName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', date: '2023-12-15', comments: '' },
      { action: 'Approved', by: 3, byName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', date: '2023-12-20', comments: '' }
    ],
    nextReviewDate: '2025-03-31', reviewCycle: 'Annual', lastReviewDate: '2024-03-25',
    notificationRules: [
      { event: 'DueDateApproaching', daysBefore: 60, recipients: ['Owner'] },
      { event: 'DueDateApproaching', daysBefore: 30, recipients: ['Owner', 'Reviewer'] },
      { event: 'DueDateApproaching', daysBefore: 7, recipients: ['Owner', 'Reviewer', 'Approver', 'Board'] }
    ],
    escalationRules: [
      { level: 1, condition: 'Overdue > 3 days', escalateTo: 'Reviewer', action: 'Escalate' },
      { level: 2, condition: 'Overdue > 7 days', escalateTo: 'Board', action: 'Escalate' }
    ],
    exceptions: [], complianceScore: 88, testingScore: 82, evidenceScore: 90, overallHealth: 'Good',
    lastTestDate: '2024-04-01', nextTestDate: '2025-04-01',
    testingFrequency: 'Annual'
  },
  {
    id: 5, code: 'OBL-005', authorityId: 3, frameworkId: 7, requirementIds: [9],
    title: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
    statement: 'ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ØŒ ØªØªØ¶Ù…Ù† Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.',
    category: 'Cybersecurity', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 6, reviewerId: 2, approverId: 3, escalationPath: 'CISO',
    frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ© ÙÙŠ Q4', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Policy', 'Approval', 'Minutes'], evidenceValidityDays: 365,
    acceptanceCriteria: 'ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø©ØŒ Ù…Ø­Ø¶Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ØŒ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°',
    retentionValue: 5, retentionUnit: 'Years',
    regulatoryImpacts: ['Penalty', 'Operational', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 4, createdAt: '2023-12-20', updatedBy: 2, updatedAt: '2024-01-15',
  },
  {
    id: 6, code: 'OBL-006', authorityId: 3, frameworkId: 7, requirementIds: [12], title: 'ØªÙ†ÙÙŠØ° Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠØ©',
    statement: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ø®ØªØ±Ø§Ù‚ Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ø³Ù†ÙˆÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ Ù…Ù† Ù‚Ø¨Ù„ Ø¬Ù‡Ø© Ù…Ø³ØªÙ‚Ù„Ø© ÙˆÙ…Ø¹ØªÙ…Ø¯Ø©.',
    category: 'Cybersecurity', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'System',
    scopeValues: ['Core Banking', 'Internet Banking', 'Mobile App'],
    ownerId: 6, reviewerId: 2, approverId: 3, escalationPath: 'CISO', frequency: 'Annual', dueRule: 'Ø®Ù„Ø§Ù„ Q2 Ù…Ù† ÙƒÙ„ Ø³Ù†Ø©',
    triggerDescription: '', evidenceRequired: true, evidenceTypes: ['Report', 'Certificate', 'Log'],
    evidenceValidityDays: 365,
    acceptanceCriteria: 'ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ØŒ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ÙØ°Ø©ØŒ Ø®Ø·Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Operational'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Partial', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 4, createdAt: '2023-12-20', updatedBy: 2, updatedAt: '2024-01-15',
  },
  {
    id: 7, code: 'OBL-007', authorityId: 4, frameworkId: 9, requirementIds: [13],
    title: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
    statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© ÙˆÙ…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù‚Ø¨Ù„ Ø¬Ù…Ø¹ Ø£Ùˆ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ù…ØŒ Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.',
    category: 'Data', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 6, reviewerId: 2, approverId: 3, escalationPath: 'DPO',
    frequency: 'EventDriven', dueRule: null, triggerDescription: 'Ø¹Ù†Ø¯ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©', evidenceRequired: true,
    evidenceTypes: ['Approval', 'Log', 'Screenshot'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…ÙˆÙ‚Ø¹ØŒ Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Legal', 'Reputation'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'NotMapped', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 4, createdAt: '2023-12-25', updatedBy: 2, updatedAt: '2024-01-20',
  },
  {
    id: 8, code: 'OBL-008', authorityId: 4, frameworkId: 9, requirementIds: [15], title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
    statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø£ÙŠ Ø§Ù†ØªÙ‡Ø§Ùƒ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØµØ© Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙƒØªØ´Ø§ÙÙ‡ØŒ Ù…Ø¹ Ø¥Ø®Ø·Ø§Ø± Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†.',
    category: 'Data', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 6, reviewerId: 2, approverId: 3, escalationPath: 'DPO',
    frequency: 'EventDriven', dueRule: null, triggerDescription: 'Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø§Ù†ØªÙ‡Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª', evidenceRequired: true,
    evidenceTypes: ['Report', 'Log', 'Approval'], evidenceValidityDays: 365,
    acceptanceCriteria: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù†ØªÙ‡Ø§ÙƒØŒ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù„Ø¬Ù‡Ø©ØŒ Ø³Ø¬Ù„ Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†',
    retentionValue: 7, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Legal', 'Reputation'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'NotMapped', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 4, createdAt: '2023-12-25', updatedBy: 2, updatedAt: '2024-01-20',
  },
  {
    id: 9, code: 'OBL-009', authorityId: 5, frameworkId: 10, requirementIds: [16], title: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ',
    statement: 'ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ø¥Ù‚Ø±Ø§Ø± Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ø´Ù‡Ø±ÙŠ/Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ) Ø­Ø³Ø¨ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø´Ø£Ø©.',
    category: 'Tax', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'CFO',
    frequency: 'Monthly', dueRule: 'Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Report', 'Screenshot', 'Approval'], evidenceValidityDays: 30,
    acceptanceCriteria: 'Ø¥Ù‚Ø±Ø§Ø± Ù…Ù‚Ø¯Ù… Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©ØŒ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯ØŒ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©',
    retentionValue: 7, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Legal'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 1, createdAt: '2023-12-10', updatedBy: 2, updatedAt: '2024-01-05',
  },
  {
    id: 10, code: 'OBL-010', authorityId: 5, frameworkId: 11, requirementIds: [17], title: 'Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
    statement: 'ÙŠØ¬Ø¨ Ø¥ØµØ¯Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨ØµÙŠØºØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ù…ÙˆØ§ØµÙØ§Øª Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ (ÙØ§ØªÙˆØ±Ø©).',
    category: 'Tax', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'CFO',
    frequency: 'EventDriven', dueRule: null, triggerDescription: 'Ø¹Ù†Ø¯ Ø¥ØµØ¯Ø§Ø± Ø£ÙŠ ÙØ§ØªÙˆØ±Ø©', evidenceRequired: true,
    evidenceTypes: ['Config', 'Log', 'Certificate'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ ÙØ§ØªÙˆØ±Ø©ØŒ Ø¹ÙŠÙ†Ø© ÙÙˆØ§ØªÙŠØ± ØµØ§Ø¯Ø±Ø©ØŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©',
    retentionValue: 7, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Operational'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 1, createdAt: '2023-12-10', updatedBy: 2, updatedAt: '2024-01-05',
  },
  {
    id: 11, code: 'OBL-011', authorityId: 7, frameworkId: 13, requirementIds: [20], title: 'ØµØ±Ù Ø§Ù„Ø£Ø¬ÙˆØ± Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… WPS',
    statement: 'ÙŠØ¬Ø¨ ØµØ±Ù Ø¬Ù…ÙŠØ¹ Ø£Ø¬ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ† ÙˆØ§Ù„Ù…Ù‚ÙŠÙ…ÙŠÙ† Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯.',
    category: 'HR', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'HRDirector',
    frequency: 'Monthly', dueRule: 'Ø®Ù„Ø§Ù„ Ø£ÙˆÙ„ 5 Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Report', 'Log', 'Screenshot'], evidenceValidityDays: 30,
    acceptanceCriteria: 'Ù…Ù„Ù WPS Ø§Ù„Ù…Ø±ÙÙˆØ¹ØŒ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ø¨Ù†ÙƒØŒ ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚',
    retentionValue: 5, retentionUnit: 'Years',
    regulatoryImpacts: ['Penalty', 'Operational', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 1, createdAt: '2023-12-10', updatedBy: 2, updatedAt: '2024-01-05',
  },
  {
    id: 12, code: 'OBL-012', authorityId: 7, frameworkId: 14, requirementIds: [21],
    title: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ† (Ù†Ø·Ø§Ù‚Ø§Øª)',
    statement: 'ÙŠØ¬Ø¨ ØªØ­Ù‚ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹ Ù„Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø± Ø£Ùˆ Ø£Ø¹Ù„Ù‰.',
    category: 'HR', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'HRDirector',
    frequency: 'Quarterly', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ø±Ø¨Ø¹', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Report', 'Screenshot'], evidenceValidityDays: 90,
    acceptanceCriteria: 'Ø´Ù‡Ø§Ø¯Ø© Ù†Ø·Ø§Ù‚Ø§Øª Ù…Ù† Ù‚ÙˆÙ‰ØŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ·ÙŠÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØŒ Ø®Ø·Ø© Ø§Ù„ØªÙˆØ·ÙŠÙ†',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Operational', 'License'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Partial', status: 'Active',
    effectiveFrom: '2024-01-01', effectiveTo: null, createdBy: 1, createdAt: '2023-12-10', updatedBy: 2,
    updatedAt: '2024-01-05',
  },
  {
    id: 13, code: 'OBL-013', authorityId: 2, frameworkId: 5, requirementIds: [18], title: 'ØªØ´ÙƒÙŠÙ„ Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
    statement: 'ÙŠØ¬Ø¨ ØªØ´ÙƒÙŠÙ„ Ù„Ø¬Ù†Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØºÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠÙŠÙ†ØŒ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ù…Ù‡Ø§Ù…Ù‡Ø§ ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡Ø§.',
    category: 'Governance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 7, reviewerId: 2, approverId: 3, escalationPath: 'Board',
    frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„ Ø³Ù†ÙˆÙŠØ§Ù‹', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Approval', 'Minutes', 'Policy'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ù‚Ø±Ø§Ø± ØªØ´ÙƒÙŠÙ„ Ø§Ù„Ù„Ø¬Ù†Ø©ØŒ Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ù„Ø¬Ù†Ø©ØŒ Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª',
    retentionValue: 10, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'License', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Full', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 1, createdAt: '2023-12-05', updatedBy: 2, updatedAt: '2024-01-02',
  },
  {
    id: 14, code: 'OBL-014', authorityId: 1, frameworkId: 1, requirementIds: [5],
    title: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
    statement: 'ÙŠØ¬Ø¨ ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ø³Ù†ÙˆÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ù†ÙŠÙŠÙ† Ø¹Ù„Ù‰ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨.',
    category: 'HR', criticality: 'Medium', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3,
    escalationPath: 'ComplianceDirector', frequency: 'Annual', dueRule: 'Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ù†Ø©', triggerDescription: '',
    evidenceRequired: true, evidenceTypes: ['Report', 'Certificate', 'Log'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ØŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØºØ·ÙŠØ©',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Reporting'], inherentRisk: 'Medium',
    controlLinkRequired: false, mappingStatus: 'NotMapped', status: 'Active', effectiveFrom: '2024-01-01',
    effectiveTo: null, createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
  },
  {
    id: 15, code: 'OBL-015', authorityId: 1, frameworkId: 1, requirementIds: [4], title: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©',
    statement: 'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© ÙˆØ§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ù…Ø¯Ø© Ù„Ø§ ØªÙ‚Ù„ Ø¹Ù† 10 Ø³Ù†ÙˆØ§Øª Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©.',
    category: 'Compliance', criticality: 'Medium', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3,
    escalationPath: 'ComplianceDirector', frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ© Ù„Ù„Ø£Ø±Ø´ÙŠÙ', triggerDescription: '',
    evidenceRequired: true, evidenceTypes: ['Policy', 'Config', 'Report'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ø±Ø´ÙØ©ØŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø±Ø´ÙØ©ØŒ ØªÙ‚Ø±ÙŠØ± Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª',
    retentionValue: 10, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Legal'], inherentRisk: 'Medium',
    controlLinkRequired: false, mappingStatus: 'Partial', status: 'Active', effectiveFrom: '2024-01-01', effectiveTo: null,
    createdBy: 1, createdAt: '2023-12-15', updatedBy: 2, updatedAt: '2024-01-10',
  },
  // Draft obligations
  {
    id: 16, code: 'OBL-016', authorityId: 3, frameworkId: 7, requirementIds: [10], title: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©',
    statement: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ ÙˆØªØµÙ†ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø£Ù‡Ù…ÙŠØ©.',
    category: 'IT', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 6, reviewerId: 2, approverId: null, escalationPath: '',
    frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ©', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Report', 'Config'], evidenceValidityDays: 365, acceptanceCriteria: '', retentionValue: 5,
    retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Operational'], inherentRisk: 'High', controlLinkRequired: true,
    mappingStatus: 'NotMapped', status: 'Draft', effectiveFrom: null, effectiveTo: null, createdBy: 4,
    createdAt: '2024-01-20', updatedBy: 4, updatedAt: '2024-01-20',
  },
  {
    id: 17, code: 'OBL-017', authorityId: 3, frameworkId: 7, requirementIds: [11], title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„',
    statement: 'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©.',
    category: 'IT', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '', scopeLevel: 'System',
    scopeValues: ['Core Systems'], ownerId: 6, reviewerId: null, approverId: null, escalationPath: '',
    frequency: 'Quarterly', dueRule: '', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Config', 'Log', 'Report'], evidenceValidityDays: 90, acceptanceCriteria: '', retentionValue: 3,
    retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Operational'], inherentRisk: 'High', controlLinkRequired: true,
    mappingStatus: 'NotMapped', status: 'Draft', effectiveFrom: null, effectiveTo: null, createdBy: 4,
    createdAt: '2024-01-22', updatedBy: 4, updatedAt: '2024-01-22',
  },
  // Under Review
  {
    id: 18, code: 'OBL-018', authorityId: 4, frameworkId: 9, requirementIds: [14], title: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
    statement: 'ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© (DPO) Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª ÙˆØ§Ø¶Ø­Ø©.',
    category: 'Governance', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 7, reviewerId: 2, approverId: 3, escalationPath: 'CEO',
    frequency: 'Annual', dueRule: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ©', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Approval', 'Contract'], evidenceValidityDays: 365,
    acceptanceCriteria: 'Ù‚Ø±Ø§Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ†ØŒ Ø§Ù„ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªØ£Ù‡ÙŠÙ„',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Reporting'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'NotMapped', status: 'UnderReview', effectiveFrom: null, effectiveTo: null,
    createdBy: 4, createdAt: '2024-01-18', updatedBy: 4, updatedAt: '2024-01-25',
  },
  // Retired
  {
    id: 19, code: 'OBL-019', authorityId: 1, frameworkId: 2, requirementIds: [8], title: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ (Ù…Ù„ØºÙŠ)',
    statement: 'ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯ Ø£Ø´Ù…Ù„.', category: 'Risk', criticality: 'High', applicability: 'Applicable',
    applicabilityJustification: '', scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2,
    approverId: 3, escalationPath: 'ComplianceDirector', frequency: 'Annual', dueRule: 'Ø³Ù†ÙˆÙŠ', triggerDescription: '',
    evidenceRequired: true, evidenceTypes: ['Report'], evidenceValidityDays: 365, acceptanceCriteria: '',
    retentionValue: 5, retentionUnit: 'Years', regulatoryImpacts: ['Penalty'], inherentRisk: 'High',
    controlLinkRequired: true, mappingStatus: 'Full', status: 'Retired', effectiveFrom: '2023-01-01',
    effectiveTo: '2024-01-15', retireReason: 'ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ù„ØªØ²Ø§Ù… OBL-020 Ø§Ù„Ø£Ø´Ù…Ù„', replacementId: 20, createdBy: 1,
    createdAt: '2022-12-01', updatedBy: 3, updatedAt: '2024-01-15',
  },
  {
    id: 20, code: 'OBL-020', authorityId: 1, frameworkId: 2, requirementIds: [8], title: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„',
    statement: 'ÙŠØ¬Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹ ÙŠØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©.',
    category: 'Risk', criticality: 'High', applicability: 'Applicable', applicabilityJustification: '',
    scopeLevel: 'Enterprise', scopeValues: ['All'], ownerId: 5, reviewerId: 2, approverId: 3, escalationPath: 'CRO',
    frequency: 'Annual', dueRule: 'Ø®Ù„Ø§Ù„ Q1', triggerDescription: '', evidenceRequired: true,
    evidenceTypes: ['Report', 'Minutes', 'Approval'], evidenceValidityDays: 365,
    acceptanceCriteria: 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ù…Ø­Ø¶Ø± Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©',
    retentionValue: 7, retentionUnit: 'Years', regulatoryImpacts: ['Penalty', 'Reporting', 'Reputation'],
    inherentRisk: 'High', controlLinkRequired: true, mappingStatus: 'Partial', status: 'Active',
    effectiveFrom: '2024-01-15', effectiveTo: null, createdBy: 1, createdAt: '2024-01-10', updatedBy: 3,
    updatedAt: '2024-01-15',
  },
];

// Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Base Components)

// Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
const StatusBadge = ({ status }) => {
  const config = {
    Draft: { bg: 'bg-slate-100', text: 'text-slate-600', label: 'Ù…Ø³ÙˆØ¯Ø©' },
    UnderReview: { bg: 'bg-amber-100', text: 'text-amber-700', label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
    Returned: { bg: 'bg-orange-100', text: 'text-orange-700', label: 'Ù…ÙØ¹Ø§Ø¯' },
    Approved: { bg: 'bg-blue-100', text: 'text-blue-700', label: 'Ù…Ø¹ØªÙ…Ø¯' },
    Active: { bg: 'bg-emerald-100', text: 'text-emerald-700', label: 'Ù†Ø´Ø·' },
    OnHold: { bg: 'bg-purple-100', text: 'text-purple-700', label: 'Ù…Ø¹Ù„Ù‘Ù‚' },
    Retired: { bg: 'bg-red-100', text: 'text-red-700', label: 'Ù…Ù„ØºÙŠ' },
  };
  const c = config[status] || config.Draft;
  return <span className={`px-2.5 py-1 rounded-full text-xs font-semibold ${c.bg} ${c.text}`}>{c.label}</span>;
};

// Ø´Ø§Ø±Ø© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©
const CriticalityBadge = ({ level }) => {
  const config = {
    High: { bg: 'bg-red-500', label: 'Ø¹Ø§Ù„ÙŠØ©' }, Medium: { bg: 'bg-amber-500', label: 'Ù…ØªÙˆØ³Ø·Ø©' },
    Low: { bg: 'bg-slate-400', label: 'Ù…Ù†Ø®ÙØ¶Ø©' },
  };
  const c = config[level] || config.Medium;
  return <span className={`px-2 py-0.5 rounded text-xs font-bold text-white ${c.bg}`}>{c.label}</span>;
};

// Ø´Ø§Ø±Ø© Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
const ApplicabilityBadge = ({ value }) => {
  const config = {
    Applicable: { bg: 'bg-emerald-100', text: 'text-emerald-700', label: 'ÙŠÙ†Ø·Ø¨Ù‚' },
    NotApplicable: { bg: 'bg-slate-100', text: 'text-slate-600', label: 'Ù„Ø§ ÙŠÙ†Ø·Ø¨Ù‚' },
    Partially: { bg: 'bg-amber-100', text: 'text-amber-700', label: 'Ø¬Ø²Ø¦ÙŠ' },
  };
  const c = config[value] || config.Applicable;
  return <span className={`px-2 py-0.5 rounded text-xs font-medium ${c.bg} ${c.text}`}>{c.label}</span>;
};

// Ø´Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·
const MappingBadge = ({ status }) => {
  const config = {
    Full: { bg: 'bg-emerald-100', text: 'text-emerald-700', icon: CheckCircle2, label: 'Ù…ÙƒØªÙ…Ù„' },
    Partial: { bg: 'bg-amber-100', text: 'text-amber-700', icon: Clock, label: 'Ø¬Ø²Ø¦ÙŠ' },
    NotMapped: { bg: 'bg-red-100', text: 'text-red-700', icon: XCircle, label: 'ØºÙŠØ± Ù…Ø±ØªØ¨Ø·' },
  };
  const c = config[status] || config.NotMapped;
  const Icon = c.icon;
  return (
    <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${c.bg} ${c.text}`}>
      <Icon className="w-3 h-3" />
      {c.label}
    </span>);
};

// Ø´Ø§Ø´Ø© 4.1 Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©

// OBLIGATIONS REGISTRY - Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© (CRUD ÙƒØ§Ù…Ù„)

const ObligationsRegistry = () => {
  const { can, currentUser, guardAction } = useAuth();

  // Ø§Ù„Ø­Ø§Ù„Ø§Øª
  const [obligations, setObligations] = useState(INITIAL_OBLIGATIONS);
  const [viewMode, setViewMode] = useState('table');
  const [searchQuery, setSearchQuery] = useState('');
  const [filters, setFilters] = useState({
    authority: '', framework: '', category: '', criticality: '',
    status: '', applicability: '', owner: '', frequency: '', mappingStatus: '',
  });
  const [selectedObligation, setSelectedObligation] = useState(null);
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('view'); // view | create | edit
  const [modalTab, setModalTab] = useState('basic'); // basic | classification | priority | dates | responsibilities | links | audit
  const [modalSize, setModalSize] = useState({ width: 1150, height: 750 }); // Resizable modal - LARGER DEFAULT
  const [isResizing, setIsResizing] = useState(false);
  const [formData, setFormData] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteTarget, setDeleteTarget] = useState(null);
  const [selectedItems, setSelectedItems] = useState([]);
  const [showBulkModal, setShowBulkModal] = useState(false);
  const [notification, setNotification] = useState(null);

  const [showLinkingModal, setShowLinkingModal] = useState(false);
  const [linkingMode, setLinkingMode] = useState('controls'); // controls | risks | policies | dependencies
  const [showDependencyModal, setShowDependencyModal] = useState(false);
  const [showConflictModal, setShowConflictModal] = useState(false);
  const [detectedConflicts, setDetectedConflicts] = useState([]);

  const [showWorkflowModal, setShowWorkflowModal] = useState(false);
  const [workflowAction, setWorkflowAction] = useState('');
  const [showExceptionModal, setShowExceptionModal] = useState(false);
  const [exceptionForm, setExceptionForm] = useState({
    reason: '', justification: '', requestedBy: '', validFrom: '', validTo: '', approvedBy: '',
    status: 'Pending'
  });
  const [showNotificationRulesModal, setShowNotificationRulesModal] = useState(false);
  const [showEscalationModal, setShowEscalationModal] = useState(false);

  const [showReportsModal, setShowReportsModal] = useState(false);
  const [selectedReport, setSelectedReport] = useState('status'); // status | trend | aging | workload
  const [reportDateRange, setReportDateRange] = useState({ from: '', to: '' });

  const availableControls = [
    { id: 'CTL-001', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„', category: 'AML', effectiveness: 85 },
    { id: 'CTL-002', name: 'Ø¶ÙˆØ§Ø¨Ø· ÙØ­Øµ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', category: 'AML', effectiveness: 90 },
    { id: 'CTL-003', name: 'Ø¶ÙˆØ§Ø¨Ø· ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„', category: 'AML', effectiveness: 80 },
    { id: 'CTL-004', name: 'Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', category: 'AML', effectiveness: 88 },
    { id: 'CTL-005', name: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', category: 'AML', effectiveness: 85 },
    { id: 'CTL-006', name: 'Ø­ÙˆÙƒÙ…Ø© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', category: 'Governance', effectiveness: 90 },
    { id: 'CTL-007', name: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', category: 'Governance', effectiveness: 85 },
    { id: 'CTL-008', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ù‡ÙˆÙŠØ©', category: 'Cybersecurity', effectiveness: 92 },
    { id: 'CTL-009', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', category: 'Data Privacy', effectiveness: 88 },
    { id: 'CTL-010', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø£Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª', category: 'Cybersecurity', effectiveness: 90 }
  ];

  const availableRisks = [
    { id: 'RSK-001', name: 'Ù…Ø®Ø§Ø·Ø± ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', level: 'High', category: 'Compliance' },
    { id: 'RSK-002', name: 'Ù…Ø®Ø§Ø·Ø± ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨', level: 'Critical', category: 'Compliance' },
    { id: 'RSK-003', name: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', level: 'High', category: 'Regulatory' },
    { id: 'RSK-004', name: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', level: 'Medium', category: 'Governance' },
    { id: 'RSK-005', name: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', level: 'High', category: 'Regulatory' },
    { id: 'RSK-006', name: 'Ù…Ø®Ø§Ø·Ø± Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', level: 'High', category: 'Cybersecurity' },
    { id: 'RSK-007', name: 'Ù…Ø®Ø§Ø·Ø± Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', level: 'High', category: 'Data Privacy' },
    { id: 'RSK-008', name: 'Ù…Ø®Ø§Ø·Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', level: 'Medium', category: 'Operational' }
  ];

  const availablePolicies = [
    { id: 'POL-001', name: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', version: '2.0', status: 'Active' },
    { id: 'POL-002', name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ø¹Ø±Ù Ø¹Ù…ÙŠÙ„Ùƒ', version: '1.5', status: 'Active' },
    { id: 'POL-003', name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', version: '1.0', status: 'Active' },
    { id: 'POL-004', name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', version: '3.0', status: 'Active' },
    { id: 'POL-005', name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', version: '2.0', status: 'Active' },
    { id: 'POL-006', name: 'Ø³ÙŠØ§Ø³Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', version: '4.0', status: 'Active' },
    { id: 'POL-007', name: 'Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', version: '2.5', status: 'Active' },
    { id: 'POL-008', name: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', version: '3.0', status: 'Active' }
  ];

  const detectConflicts = (obligation) => {
    const conflicts = [];
    obligations.forEach(obl => {
      if (obl.id !== obligation.id) {
        if (obl.authorityId === obligation.authorityId && obl.scopeLevel === obligation.scopeLevel) {
          if (obl.frequency !== obligation.frequency && obl.category === obligation.category) {
            conflicts.push({
              type: 'Frequency Conflict', severity: 'Medium', obligationId: obl.id, obligationCode: obl.code,
              obligationTitle: obl.title,
              description: `ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ù„ØªÙƒØ±Ø§Ø±: ${obl.code} (${obl.frequency}) vs ${obligation.code} (${obligation.frequency})`
            });
          }
        }
        if (obl.dueRule && obligation.dueRule && obl.dueRule === obligation.dueRule) {
          if (obl.ownerId === obligation.ownerId) {
            conflicts.push({
              type: 'Deadline Overlap', severity: 'High', obligationId: obl.id, obligationCode: obl.code, obligationTitle: obl.title,
              description: `ØªØ¯Ø§Ø®Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙˆÙ†ÙØ³ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„`
            });
          }
        }
      }
    });
    return conflicts;
  };

  const handleLinkControl = (control) => {
    if (!selectedObligation) return;
    const link = { controlId: control.id, controlName: control.name, category: control.category, linkedAt: new Date().toISOString().split('T')[0] };
    const existingLinks = selectedObligation.linkedControls || [];
    if (existingLinks.some(l => l.controlId === control.id)) {
      showNotification('Ø§Ù„Ø¶Ø§Ø¨Ø· Ù…Ø±ØªØ¨Ø· Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
      return;
    }
    const updatedObligation = { ...selectedObligation, linkedControls: [...existingLinks, link], updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification(`ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¶Ø§Ø¨Ø· ${control.id}`, 'success');
  };

  const handleLinkRisk = (risk) => {
    if (!selectedObligation) return;
    const link = { riskId: risk.id, riskName: risk.name, level: risk.level, linkedAt: new Date().toISOString().split('T')[0] };
    const existingLinks = selectedObligation.linkedRisks || [];
    if (existingLinks.some(l => l.riskId === risk.id)) {
      showNotification('Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
      return;
    }
    const updatedObligation = { ...selectedObligation, linkedRisks: [...existingLinks, link], updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification(`ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ${risk.id}`, 'success');
  };

  const handleLinkPolicy = (policy) => {
    if (!selectedObligation) return;
    const link = { policyId: policy.id, policyName: policy.name, version: policy.version, linkedAt: new Date().toISOString().split('T')[0] };
    const existingLinks = selectedObligation.linkedPolicies || [];
    if (existingLinks.some(l => l.policyId === policy.id)) {
      showNotification('Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
      return;
    }
    const updatedObligation = { ...selectedObligation, linkedPolicies: [...existingLinks, link], updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification(`ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø³ÙŠØ§Ø³Ø© ${policy.id}`, 'success');
  };

  const handleLinkDependency = (targetObl, depType = 'depends-on') => {
    if (!selectedObligation) return;
    const link = { obligationId: targetObl.id, obligationCode: targetObl.code, type: depType, linkedAt: new Date().toISOString().split('T')[0] };
    const existingDeps = selectedObligation.dependencies || [];
    if (existingDeps.some(d => d.obligationId === targetObl.id)) {
      showNotification('Ø§Ù„ØªØ¨Ø¹ÙŠØ© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
      return;
    }
    const updatedObligation = { ...selectedObligation, dependencies: [...existingDeps, link], updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification(`ØªÙ… Ø±Ø¨Ø· Ø§Ù„ØªØ¨Ø¹ÙŠØ© ${targetObl.code}`, 'success');
  };

  const handleUnlinkControl = (controlId) => {
    if (!selectedObligation) return;
    const updatedObligation = { ...selectedObligation, linkedControls: (selectedObligation.linkedControls || []).filter(l => l.controlId !== controlId), updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·', 'success');
  };

  const handleUnlinkRisk = (riskId) => {
    if (!selectedObligation) return;
    const updatedObligation = { ...selectedObligation, linkedRisks: (selectedObligation.linkedRisks || []).filter(l => l.riskId !== riskId), updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·', 'success');
  };

  const handleUnlinkPolicy = (policyId) => {
    if (!selectedObligation) return;
    const updatedObligation = { ...selectedObligation, linkedPolicies: (selectedObligation.linkedPolicies || []).filter(l => l.policyId !== policyId), updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·', 'success');
  };

  const handleUnlinkDependency = (oblId) => {
    if (!selectedObligation) return;
    const updatedObligation = { ...selectedObligation, dependencies: (selectedObligation.dependencies || []).filter(d => d.obligationId !== oblId), updatedAt: new Date().toISOString().split('T')[0] };
    setObligations(prev => prev.map(o => o.id === selectedObligation.id ? updatedObligation : o));
    setSelectedObligation(updatedObligation);
    showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·', 'success');
  };

  const checkAllConflicts = () => {
    const allConflicts = [];
    obligations.forEach(obl => {
      const conflicts = detectConflicts(obl);
      if (conflicts.length > 0) {
        allConflicts.push({ obligation: obl, conflicts });
      }
    });
    setDetectedConflicts(allConflicts);
    if (allConflicts.length > 0) {
      setShowConflictModal(true);
    } else {
      showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶Ø§Øª', 'success');
    }
  };

  const openLinkingModal = (obligation) => {
    setSelectedObligation(obligation);
    setShowLinkingModal(true);
  };

  const openWorkflowModal = (obligation) => {
    setSelectedObligation(obligation);
    setShowWorkflowModal(true);
  };

  const openExceptionModal = (obligation) => {
    setSelectedObligation(obligation);
    setShowExceptionModal(true);
  };

  const handleWorkflowAction = (action, obligation, comments = '') => {
    const now = new Date().toISOString().split('T')[0];
    const historyEntry = {
      action: action, by: currentUser?.id || 1, byName: currentUser?.name || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ', date: now,
      comments: comments
    };

    const updatedObligation = {
      ...obligation,
      workflowHistory: [...(obligation.workflowHistory || []), historyEntry],
      workflowStatus: action === 'Approve' ? 'Approved' : action === 'Reject' ? 'Rejected' : action === 'Submit' ? 'Pending' : obligation.workflowStatus,
      status: action === 'Approve' ? 'Active' : action === 'Reject' ? 'Draft' : obligation.status,
      updatedAt: now
    };

    setObligations(prev => prev.map(o => o.id === obligation.id ? updatedObligation : o));
    showNotification(`ØªÙ… ${action === 'Approve' ? 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' : action === 'Reject' ? 'Ø§Ù„Ø±ÙØ¶' : action === 'Submit' ? 'Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' : 'Ø§Ù„ØªØ­Ø¯ÙŠØ«'} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
  };

  const handleExceptionRequest = (obligation) => {
    const now = new Date().toISOString().split('T')[0];
    const newException = {
      id: `EXC-${String(Date.now()).slice(-6)}`,
      ...exceptionForm,
      requestedAt: now,
      obligationId: obligation.id
    };

    const updatedObligation = {
      ...obligation,
      exceptions: [...(obligation.exceptions || []), newException],
      updatedAt: now
    };

    setObligations(prev => prev.map(o => o.id === obligation.id ? updatedObligation : o));
    setShowExceptionModal(false);
    setExceptionForm({ reason: '', justification: '', requestedBy: '', validFrom: '', validTo: '', approvedBy: '', status: 'Pending' });
    showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
  };

  const generateReport = (reportType) => {
    const now = new Date();
    switch (reportType) {
      case 'status':
        return {
          title: 'ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', date: now.toISOString().split('T')[0],
          data: {
            total: obligations.length,
            byStatus: {
              Active: obligations.filter(o => o.status === 'Active').length,
              Draft: obligations.filter(o => o.status === 'Draft').length,
              UnderReview: obligations.filter(o => o.status === 'UnderReview').length,
              Inactive: obligations.filter(o => o.status === 'Inactive').length
            },
            byCriticality: {
              Critical: obligations.filter(o => o.criticality === 'Critical').length,
              High: obligations.filter(o => o.criticality === 'High').length,
              Medium: obligations.filter(o => o.criticality === 'Medium').length,
              Low: obligations.filter(o => o.criticality === 'Low').length
            },
            complianceRate: Math.round(obligations.reduce((sum, o) => sum + (o.complianceScore || 0), 0) / obligations.length)
          }
        };
      case 'aging':
        const thirtyDaysAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);
        const sixtyDaysAgo = new Date(now - 60 * 24 * 60 * 60 * 1000);
        const ninetyDaysAgo = new Date(now - 90 * 24 * 60 * 60 * 1000);
        return {
          title: 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø§Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', date: now.toISOString().split('T')[0],
          data: {
            current: obligations.filter(o => new Date(o.updatedAt) >= thirtyDaysAgo).length,
            '30-60 days': obligations.filter(o => new Date(o.updatedAt) < thirtyDaysAgo && new Date(o.updatedAt) >= sixtyDaysAgo).length,
            '60-90 days': obligations.filter(o => new Date(o.updatedAt) < sixtyDaysAgo && new Date(o.updatedAt) >= ninetyDaysAgo).length,
            'Over 90 days': obligations.filter(o => new Date(o.updatedAt) < ninetyDaysAgo).length
          }
        };
      case 'workload':
        const ownerWorkload = {};
        obligations.forEach(o => {
          const owner = USERS.find(u => u.id === o.ownerId);
          const ownerName = owner?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          if (!ownerWorkload[ownerName]) {
            ownerWorkload[ownerName] = { total: 0, critical: 0, high: 0, pending: 0 };
          }
          ownerWorkload[ownerName].total++;
          if (o.criticality === 'Critical') ownerWorkload[ownerName].critical++;
          if (o.criticality === 'High') ownerWorkload[ownerName].high++;
          if (o.workflowStatus === 'Pending') ownerWorkload[ownerName].pending++;
        });
        return {
          title: 'ØªÙ‚Ø±ÙŠØ± Ø¹Ø¨Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', date: now.toISOString().split('T')[0],
          data: ownerWorkload
        };
      default:
        return null;
    }
  };

  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);
  const getFramework = (id) => FRAMEWORKS.find(f => f.id === id);
  const getUser = (id) => USERS.find(u => u.id === id);

  const handleMouseDown = (e, direction) => {
    e.preventDefault();
    setIsResizing(true);
    const startX = e.clientX;
    const startY = e.clientY;
    const startWidth = modalSize.width;
    const startHeight = modalSize.height;

    const handleMouseMove = (moveEvent) => {
      let newWidth = startWidth;
      let newHeight = startHeight;

      if (direction.includes('e')) newWidth = Math.max(600, Math.min(1400, startWidth + (moveEvent.clientX - startX)));
      if (direction.includes('w')) newWidth = Math.max(600, Math.min(1400, startWidth - (moveEvent.clientX - startX)));
      if (direction.includes('s')) newHeight = Math.max(400, Math.min(900, startHeight + (moveEvent.clientY - startY)));
      if (direction.includes('n')) newHeight = Math.max(400, Math.min(900, startHeight - (moveEvent.clientY - startY)));

      setModalSize({ width: newWidth, height: newHeight });
    };

    const handleMouseUp = () => {
      setIsResizing(false);
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };

    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
  };

  const createEmptyForm = () => ({
    id: null, code: `OBL-${String(obligations.length + 1).padStart(3, '0')}`,
    authorityId: '', frameworkId: '', title: '', statement: '',
    category: '', criticality: 'High', applicability: 'Applicable',
    applicabilityJustification: '', scopeLevel: 'Enterprise', ownerId: '', reviewerId: '', approverId: '', frequency: '',
    dueDate: '', evidenceRequired: true, evidenceTypes: [], evidenceValidityDays: 365, acceptanceCriteria: '',
    mappingStatus: 'NotMapped', status: 'Draft', createdAt: new Date().toISOString().split('T')[0],
    updatedAt: new Date().toISOString().split('T')[0],
  });

  const filteredObligations = useMemo(() => {
    return obligations.filter(obl => {
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        if (!obl.code?.toLowerCase().includes(q) && !obl.title?.toLowerCase().includes(q)) return false;
      }
      if (filters.authority && obl.authorityId !== parseInt(filters.authority)) return false;
      if (filters.status && obl.status !== filters.status) return false;
      if (filters.criticality && obl.criticality !== filters.criticality) return false;
      return true;
    });
  }, [obligations, searchQuery, filters]);

  const stats = useMemo(() => ({
    total: obligations.length,
    active: obligations.filter(o => o.status === 'Active').length,
    draft: obligations.filter(o => o.status === 'Draft').length,
    underReview: obligations.filter(o => o.status === 'UnderReview').length,
    mapped: obligations.filter(o => o.mappingStatus === 'FullyMapped').length,
    notMapped: obligations.filter(o => o.mappingStatus === 'NotMapped').length,
    high: obligations.filter(o => o.criticality === 'High' || o.criticality === 'Critical').length,
  }), [obligations]);

  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const handleCreate = () => {
    setFormData(createEmptyForm());
    setModalMode('create');
    setModalTab('basic');
    setShowModal(true);
  };

  const handleView = (obl) => {
    setSelectedObligation(obl);
    setFormData({ ...obl });
    setModalMode('view');
    setModalTab('basic');
    setShowModal(true);
  };

  const handleEdit = (obl, e) => {
    if (e) e.stopPropagation();
    setSelectedObligation(obl);
    setFormData({ ...obl });
    setModalMode('edit');
    setModalTab('basic');
    setShowModal(true);
  };

  const handleSave = () => {
    if (!formData.title || formData.title.length < 3) {
      showNotification('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨ (3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)', 'error');
      return;
    }

    const now = new Date().toISOString().split('T')[0];
    if (modalMode === 'create') {
      const newObl = { ...formData, id: Math.max(...obligations.map(o => o.id), 0) + 1, createdAt: now, updatedAt: now };
      setObligations([...obligations, newObl]);
      showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
    } else {
      setObligations(obligations.map(o => o.id === formData.id ? { ...formData, updatedAt: now } : o));
      showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
    }
    setShowModal(false);
    setFormData(null);
  };

  const handleDelete = (obl, e) => {
    if (e) e.stopPropagation();
    setDeleteTarget(obl);
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    setObligations(obligations.filter(o => o.id !== deleteTarget.id));
    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
    setShowDeleteConfirm(false);
    setDeleteTarget(null);
  };

  const handleDuplicate = (obl, e) => {
    if (e) e.stopPropagation();
    const newObl = {
      ...obl,
      id: Math.max(...obligations.map(o => o.id), 0) + 1,
      code: `OBL-${String(obligations.length + 1).padStart(3, '0')}`,
      title: `Ù†Ø³Ø®Ø© Ù…Ù†: ${obl.title}`, status: 'Draft', createdAt: new Date().toISOString().split('T')[0],
    };
    setObligations([...obligations, newObl]);
    showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
  };

  const toggleSelect = (id) => setSelectedItems(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
  const toggleSelectAll = () => setSelectedItems(selectedItems.length === filteredObligations.length ? [] : filteredObligations.map(o => o.id));

  const handleBulkStatusChange = (status) => {
    setObligations(obligations.map(o => selectedItems.includes(o.id) ? { ...o, status, updatedAt: new Date().toISOString().split('T')[0] } : o));
    showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« ${selectedItems.length} Ø§Ù„ØªØ²Ø§Ù…`);
    setSelectedItems([]);
    setShowBulkModal(false);
  };

  const handleBulkDelete = () => {
    setObligations(obligations.filter(o => !selectedItems.includes(o.id)));
    showNotification(`ØªÙ… Ø­Ø°Ù ${selectedItems.length} Ø§Ù„ØªØ²Ø§Ù…`);
    setSelectedItems([]);
    setShowBulkModal(false);
  };

  const clearFilters = () => {
    setFilters({ authority: '', framework: '', category: '', criticality: '', status: '', applicability: '', owner: '', frequency: '', mappingStatus: '' });
    setSearchQuery('');
  };

  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h1>
          <p className="text-slate-500">Regulatory Obligations Registry - Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</p>
        </div>
        <div className="flex items-center gap-3">
          {selectedItems.length > 0 && can('OBLIGATIONS_EDIT') && (
            <button onClick={() => setShowBulkModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-indigo-100 text-indigo-700 rounded-xl font-bold">
              <CheckSquare className="w-5 h-5" />Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ({selectedItems.length})
            </button>
          )}
          <button onClick={() => setShowReportsModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-purple-100 text-purple-700 rounded-xl font-bold hover:bg-purple-200">
            <BarChart3 className="w-5 h-5" />Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
          </button>
          {can('OBLIGATIONS_EXPORT') && (
            <button className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50">
              <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ±
            </button>
          )}
          {can('OBLIGATIONS_CREATE') && (
            <button onClick={handleCreate} className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg">
              <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ²Ø§Ù…
            </button>
          )}
        </div> </div>
      <div className="grid grid-cols-8 gap-3">
        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-4 text-white">
          <p className="text-indigo-100 text-xs">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
          <p className="text-3xl font-bold mt-1">{stats.total}</p>
        </div>
        {[
          { label: 'Ù†Ø´Ø·', value: stats.active, color: 'emerald' },
          { label: 'Ù…Ø³ÙˆØ¯Ø©', value: stats.draft, color: 'slate' },
          { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', value: stats.underReview, color: 'amber' },
          { label: 'Ù…Ø±Ø¨ÙˆØ·', value: stats.mapped, color: 'blue' },
          { label: 'ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·', value: stats.notMapped, color: 'red' },
          { label: 'Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©', value: stats.high, color: 'orange' },
        ].map((s, i) => (
          <div key={i} className={`bg-white rounded-2xl p-4 border-2 border-${s.color}-200`}>
            <p className="text-xs text-slate-500">{s.label}</p>
            <p className={`text-2xl font-bold text-${s.color}-600`}>{s.value}</p>
          </div>
        ))}
        <div className="bg-gradient-to-br from-teal-500 to-emerald-600 rounded-2xl p-4 text-white">
          <p className="text-teal-100 text-xs">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
          <p className="text-2xl font-bold mt-1">{Math.round(obligations.reduce((sum, o) => sum + (o.complianceScore || 85), 0) / obligations.length)}%</p>
        </div> </div>
      <div className="grid grid-cols-4 gap-4">
        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-blue-600 text-sm font-bold">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
              <p className="text-2xl font-black text-blue-800 mt-1">{obligations.reduce((sum, o) => sum + (o.linkedControls?.length || 0), 0)}</p>
            </div>
            <Shield className="w-10 h-10 text-blue-300" />
          </div> </div>
        <div className="bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-4 border border-red-200">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-red-600 text-sm font-bold">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
              <p className="text-2xl font-black text-red-800 mt-1">{obligations.reduce((sum, o) => sum + (o.linkedRisks?.length || 0), 0)}</p>
            </div>
            <AlertTriangle className="w-10 h-10 text-red-300" />
          </div> </div>
        <div className="bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-200">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-purple-600 text-sm font-bold">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
              <p className="text-2xl font-black text-purple-800 mt-1">{obligations.reduce((sum, o) => sum + (o.linkedPolicies?.length || 0), 0)}</p>
            </div>
            <FileText className="w-10 h-10 text-purple-300" />
          </div> </div>
        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-amber-600 text-sm font-bold">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
              <p className="text-2xl font-black text-amber-800 mt-1">{obligations.reduce((sum, o) => sum + (o.exceptions?.filter(e => e.status === 'Pending').length || 0), 0)}</p>
            </div>
            <AlertCircle className="w-10 h-10 text-amber-300" />
          </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
        <div className="flex flex-wrap items-center gap-3">
          <div className="flex-1 min-w-[250px] relative">
            <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
            <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500" />
          </div>
          <select value={filters.authority} onChange={(e) => setFilters({ ...filters, authority: e.target.value })} className="px-4 py-3 border-2 border-slate-200 rounded-xl">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
            {AUTHORITIES.map(a => <option key={a.id} value={a.id}>{a.code}</option>)}
          </select>
          <select value={filters.status} onChange={(e) => setFilters({ ...filters, status: e.target.value })} className="px-4 py-3 border-2 border-slate-200 rounded-xl">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            <option value="Draft">Ù…Ø³ÙˆØ¯Ø©</option>
            <option value="Active">Ù†Ø´Ø·</option>
            <option value="UnderReview">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
          </select>
          <select value={filters.criticality} onChange={(e) => setFilters({ ...filters, criticality: e.target.value })} className="px-4 py-3 border-2 border-slate-200 rounded-xl">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‡Ù…ÙŠØ§Øª</option>
            <option value="Critical">Ø­Ø±Ø¬</option>
            <option value="High">Ø¹Ø§Ù„ÙŠ</option>
            <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
          </select>
          <button onClick={checkAllConflicts} className="px-4 py-3 bg-orange-100 text-orange-700 rounded-xl font-bold hover:bg-orange-200 flex items-center gap-2">
            <AlertTriangle className="w-4 h-4" />ÙƒØ´Ù Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª
          </button>
          <div className="flex border-2 border-slate-200 rounded-xl overflow-hidden">
            <button onClick={() => setViewMode('table')} className={`p-3 ${viewMode === 'table' ? 'bg-indigo-500 text-white' : 'text-slate-500'}`}><Table className="w-5 h-5" /></button>
            <button onClick={() => setViewMode('cards')} className={`p-3 ${viewMode === 'cards' ? 'bg-indigo-500 text-white' : 'text-slate-500'}`}><LayoutGrid className="w-5 h-5" /></button>
          </div>
          {(searchQuery || Object.values(filters).some(v => v)) && (
            <button onClick={clearFilters} className="px-4 py-3 text-red-600 hover:bg-red-50 rounded-xl"><X className="w-4 h-4" /></button>
          )}
        </div> </div>
      {viewMode === 'table' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <table className="w-full">
            <thead>
              <tr className="bg-slate-50 border-b-2 border-slate-200">
                <th className="px-3 py-3 w-10"><input type="checkbox" checked={selectedItems.length === filteredObligations.length && filteredObligations.length > 0} onChange={toggleSelectAll} className="w-4 h-4" /></th>
                <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</th>
                <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</th>
                <th className="text-center px-4 py-3 font-bold text-slate-700 w-56">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr> </thead>
            <tbody>
              {filteredObligations.map(obl => {
                const auth = getAuthority(obl.authorityId);
                const owner = getUser(obl.ownerId);
                const linkedCount = (obl.linkedControls?.length || 0) + (obl.linkedRisks?.length || 0) + (obl.linkedPolicies?.length || 0);
                return (
                  <tr key={obl.id} className="border-b border-slate-100 hover:bg-slate-50 cursor-pointer" onClick={() => handleView(obl)}>
                    <td className="px-3 py-4" onClick={e => e.stopPropagation()}><input type="checkbox" checked={selectedItems.includes(obl.id)} onChange={() => toggleSelect(obl.id)} className="w-4 h-4" /></td>
                    <td className="px-4 py-4"><span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">{obl.code}</span></td>
                    <td className="px-4 py-4"><p className="font-medium text-slate-800 line-clamp-1">{obl.title}</p></td>
                    <td className="px-3 py-4 text-center"><span className={`px-2 py-1 rounded-lg text-xs font-bold ${auth?.code === 'SAMA' ? 'bg-emerald-100 text-emerald-700' : auth?.code === 'NCA' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}`}>{auth?.code || '-'}</span></td>
                    <td className="px-3 py-4 text-center"><span className={`px-2 py-1 rounded-lg text-xs font-bold ${obl.criticality === 'Critical' ? 'bg-red-100 text-red-700' : obl.criticality === 'High' ? 'bg-orange-100 text-orange-700' : 'bg-amber-100 text-amber-700'}`}>{obl.criticality === 'Critical' ? 'Ø­Ø±Ø¬' : obl.criticality === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span></td>
                    <td className="px-3 py-4 text-center">
                      <div className="flex items-center justify-center gap-1">
                        <span className={`px-2 py-1 rounded-lg text-xs font-bold ${obl.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : obl.status === 'Draft' ? 'bg-slate-100 text-slate-600' : 'bg-amber-100 text-amber-700'}`}>{obl.status === 'Active' ? 'Ù†Ø´Ø·' : obl.status === 'Draft' ? 'Ù…Ø³ÙˆØ¯Ø©' : 'Ù…Ø±Ø§Ø¬Ø¹Ø©'}</span>
                        {obl.workflowStatus === 'Pending' && <Clock className="w-3 h-3 text-amber-500" />}
                        {obl.workflowStatus === 'Approved' && <CheckCircle2 className="w-3 h-3 text-emerald-500" />}
                      </div> </td>
                    <td className="px-3 py-4 text-center">
                      <div className="flex items-center justify-center gap-1">
                        {linkedCount > 0 ? (
                          <span className="px-2 py-1 bg-teal-100 text-teal-700 rounded-lg text-xs font-bold">{linkedCount} Ø±Ø§Ø¨Ø·</span>
                        ) : (
                          <span className="px-2 py-1 bg-slate-100 text-slate-400 rounded-lg text-xs">ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·</span>
                        )}
                      </div> </td>
                    <td className="px-3 py-4 text-center">
                      <div className="flex items-center justify-center">
                        <div className="w-12 h-2 bg-slate-200 rounded-full">
                          <div className={`h-2 rounded-full ${(obl.complianceScore || 85) >= 80 ? 'bg-emerald-500' : (obl.complianceScore || 85) >= 60 ? 'bg-amber-500' : 'bg-red-500'}`} style={{ width: `${obl.complianceScore || 85}%` }}></div>
                        </div>
                        <span className="text-xs text-slate-600 mr-2">{obl.complianceScore || 85}%</span>
                      </div> </td>
                    <td className="px-4 py-4" onClick={e => e.stopPropagation()}>
                      <div className="flex items-center justify-center gap-1">
                        <button onClick={() => handleView(obl)} className="p-2 hover:bg-blue-50 rounded-lg" title="Ø¹Ø±Ø¶"><Eye className="w-4 h-4 text-blue-500" /></button>
                        {can('OBLIGATIONS_EDIT') && (
                          <button onClick={(e) => handleEdit(obl, e)} className="p-2 hover:bg-amber-50 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„"><Edit className="w-4 h-4 text-amber-500" /></button>
                        )}
                        <button onClick={() => openLinkingModal(obl)} className="p-2 hover:bg-teal-50 rounded-lg" title="Ø§Ù„Ø±Ø¨Ø·"><Link2 className="w-4 h-4 text-teal-500" /></button>
                        <button onClick={() => openWorkflowModal(obl)} className="p-2 hover:bg-indigo-50 rounded-lg" title="Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„"><GitBranch className="w-4 h-4 text-indigo-500" /></button>
                        <button onClick={() => openExceptionModal(obl)} className="p-2 hover:bg-orange-50 rounded-lg" title="Ø§Ø³ØªØ«Ù†Ø§Ø¡"><AlertCircle className="w-4 h-4 text-orange-500" /></button>
                        {can('OBLIGATIONS_ADMIN') && (
                          <button onClick={(e) => handleDelete(obl, e)} className="p-2 hover:bg-red-50 rounded-lg" title="Ø­Ø°Ù"><Trash2 className="w-4 h-4 text-red-500" /></button>
                        )}
                      </div> </td> </tr>);
              })}
            </tbody> </table>
          {filteredObligations.length === 0 && <div className="text-center py-16 text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>}
        </div>
      )}

      {viewMode === 'cards' && (
        <div className="grid grid-cols-3 gap-4">
          {filteredObligations.map(obl => {
            const auth = getAuthority(obl.authorityId);
            const linkedCount = (obl.linkedControls?.length || 0) + (obl.linkedRisks?.length || 0) + (obl.linkedPolicies?.length || 0);
            return (
              <div key={obl.id} className="bg-white rounded-xl border-2 border-slate-200 p-4 hover:shadow-lg cursor-pointer" onClick={() => handleView(obl)}>
                <div className="flex items-start justify-between mb-3">
                  <span className={`px-2 py-1 rounded-lg text-xs font-bold ${auth?.code === 'SAMA' ? 'bg-emerald-100 text-emerald-700' : 'bg-blue-100 text-blue-700'}`}>{auth?.code}</span>
                  <div className="flex items-center gap-1">
                    {linkedCount > 0 && <span className="px-2 py-0.5 bg-teal-100 text-teal-600 rounded text-xs">{linkedCount}</span>}
                    <span className={`px-2 py-1 rounded-lg text-xs font-bold ${obl.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>{obl.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø³ÙˆØ¯Ø©'}</span>
                  </div> </div>
                <span className="font-mono text-xs text-indigo-600">{obl.code}</span>
                <h4 className="font-bold text-slate-800 mt-2 line-clamp-2">{obl.title}</h4>
                <div className="mt-3">
                  <div className="w-full bg-slate-200 rounded-full h-1.5">
                    <div className={`h-1.5 rounded-full ${(obl.complianceScore || 85) >= 80 ? 'bg-emerald-500' : 'bg-amber-500'}`} style={{ width: `${obl.complianceScore || 85}%` }}></div>
                  </div>
                  <p className="text-xs text-slate-500 mt-1">{obl.complianceScore || 85}% Ø§Ù…ØªØ«Ø§Ù„</p>
                </div>
                <div className="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                  <span className="text-xs text-slate-500">{getUser(obl.ownerId)?.name?.split(' ')[0]}</span>
                  <div className="flex gap-1" onClick={e => e.stopPropagation()}>
                    <button onClick={() => openLinkingModal(obl)} className="p-1.5 hover:bg-teal-50 rounded" title="Ø§Ù„Ø±Ø¨Ø·"><Link2 className="w-3.5 h-3.5 text-teal-500" /></button>
                    <button onClick={() => openWorkflowModal(obl)} className="p-1.5 hover:bg-indigo-50 rounded" title="Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„"><GitBranch className="w-3.5 h-3.5 text-indigo-500" /></button>
                    {can('OBLIGATIONS_EDIT') && (
                      <button onClick={(e) => handleEdit(obl, e)} className="p-1.5 hover:bg-amber-50 rounded"><Edit className="w-3.5 h-3.5 text-amber-500" /></button>
                    )}
                    {can('OBLIGATIONS_ADMIN') && (
                      <button onClick={(e) => handleDelete(obl, e)} className="p-1.5 hover:bg-red-50 rounded"><Trash2 className="w-3.5 h-3.5 text-red-500" /></button>
                    )}
                  </div> </div> </div>);
          })}
        </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          WORLD-CLASS OBLIGATION MODAL - 7 TABS ENTERPRISE GRADE
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div
            className="bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col relative"
            style={{
              width: `${modalSize.width}px`, height: `${modalSize.height}px`, minWidth: '900px', maxWidth: '1500px',
              minHeight: '600px',
              maxHeight: '95vh'
            }}>

            <div onMouseDown={(e) => handleMouseDown(e, 'e')}
              className="absolute top-0 right-0 w-2 h-full cursor-ew-resize hover:bg-indigo-500/20 transition-colors z-10" />
            <div onMouseDown={(e) => handleMouseDown(e, 'w')}
              className="absolute top-0 left-0 w-2 h-full cursor-ew-resize hover:bg-indigo-500/20 transition-colors z-10" />
            <div onMouseDown={(e) => handleMouseDown(e, 's')}
              className="absolute bottom-0 left-0 w-full h-2 cursor-ns-resize hover:bg-indigo-500/20 transition-colors z-10" />
            <div onMouseDown={(e) => handleMouseDown(e, 'se')}
              className="absolute bottom-0 right-0 w-5 h-5 cursor-nwse-resize z-20 flex items-center justify-center">
              <div className="w-3 h-3 border-r-2 border-b-2 border-slate-400 hover:border-indigo-500 transition-colors" />
            </div>
            <div onMouseDown={(e) => handleMouseDown(e, 'sw')}
              className="absolute bottom-0 left-0 w-5 h-5 cursor-nesw-resize z-20" />

            <div className={`px-6 py-4 text-white ${modalMode === 'create' ? 'bg-gradient-to-l from-indigo-600 via-purple-600 to-violet-700' :
              modalMode === 'edit' ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500' :
                'bg-gradient-to-l from-blue-600 via-indigo-600 to-purple-700'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center shadow-lg backdrop-blur-sm">
                    {modalMode === 'create' ? <Plus className="w-6 h-6" /> : modalMode === 'edit' ? <Edit className="w-6 h-6" /> : <ClipboardCheck className="w-6 h-6" />}
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">
                      {modalMode === 'create' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ²Ø§Ù… ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø¬Ø¯ÙŠØ¯' : modalMode === 'edit' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ'}
                    </h2>
                    <div className="flex items-center gap-2 mt-0.5">
                      <span className="px-2 py-0.5 bg-white/20 rounded-lg text-xs font-bold">{formData.code}</span>
                      {formData.status && (
                        <span className={`px-2 py-0.5 rounded-lg text-xs font-bold ${formData.status === 'Active' ? 'bg-emerald-400/30' :
                          formData.status === 'Draft' ? 'bg-slate-400/30' :
                            'bg-amber-400/30'
                          }`}>
                          {formData.status === 'Active' ? 'Ù†Ø´Ø·' : formData.status === 'Draft' ? 'Ù…Ø³ÙˆØ¯Ø©' : formData.status}
                        </span>
                      )}
                    </div> </div> </div>
                <div className="flex items-center gap-2">
                  {modalMode === 'view' && (
                    <button onClick={() => setModalMode('edit')} className="flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition-all">
                      <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                    </button>
                  )}
                  <div className="flex items-center gap-1 bg-white/10 rounded-lg p-1">
                    <button onClick={() => setModalSize({ width: 900, height: 600 })} title="Ù…ØªÙˆØ³Ø·"
                      className={`w-7 h-7 flex items-center justify-center rounded-lg transition-all ${modalSize.width <= 950 ? 'bg-white/30' : 'hover:bg-white/20'}`}>
                      <Minimize2 className="w-3.5 h-3.5" />
                    </button>
                    <button onClick={() => setModalSize({ width: 1150, height: 750 })} title="ÙƒØ¨ÙŠØ±"
                      className={`w-7 h-7 flex items-center justify-center rounded-lg transition-all ${modalSize.width > 950 && modalSize.width < 1300 ? 'bg-white/30' : 'hover:bg-white/20'}`}>
                      <Square className="w-3.5 h-3.5" />
                    </button>
                    <button onClick={() => setModalSize({ width: 1400, height: 850 })} title="Ø£Ù‚ØµÙ‰"
                      className={`w-7 h-7 flex items-center justify-center rounded-lg transition-all ${modalSize.width >= 1300 ? 'bg-white/30' : 'hover:bg-white/20'}`}>
                      <Maximize2 className="w-3.5 h-3.5" />
                    </button> </div>
                  <button onClick={() => { setShowModal(false); setModalTab('basic'); setModalSize({ width: 1150, height: 750 }); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <X className="w-5 h-5" />
                  </button> </div> </div> </div>
            <div className="bg-gradient-to-r from-slate-100 to-slate-50 border-b-2 border-slate-200">
              <div className="flex overflow-x-auto">
                {[
                  { id: 'basic', label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', num: '1', color: 'indigo' },
                  { id: 'reference', label: 'Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', num: '2', color: 'purple' },
                  { id: 'program', label: 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆØ§Ù„ØªØµÙ†ÙŠÙ', num: '3', color: 'emerald' },
                  { id: 'applicability', label: 'Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', num: '4', color: 'amber' },
                  { id: 'evidence', label: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø©', num: '5', color: 'teal' },
                  { id: 'schedule', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…', num: '6', color: 'blue' },
                  { id: 'testing', label: 'Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', num: '7', color: 'cyan' },
                  { id: 'enforcement', label: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ø°', num: '8', color: 'red' },
                  { id: 'impact', label: 'Ø§Ù„ØªØ£Ø«ÙŠØ± ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', num: '9', color: 'orange' },
                  { id: 'audit', label: 'Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚', num: '10', color: 'violet' },
                ].map((tab, idx) => {
                  const isActive = modalTab === tab.id;
                  const tabsList = ['basic', 'reference', 'program', 'applicability', 'evidence', 'schedule', 'testing', 'enforcement', 'impact', 'audit'];
                  const currentIdx = tabsList.indexOf(modalTab);
                  const isPassed = tabsList.indexOf(tab.id) < currentIdx;
                  return (
                    <button key={tab.id} onClick={() => setModalTab(tab.id)}
                      className={`flex items-center gap-2 px-4 py-3.5 font-bold whitespace-nowrap border-b-3 transition-all ${isActive
                        ? `text-${tab.color}-700 border-${tab.color}-500 bg-white shadow-sm`
                        : isPassed
                          ? `text-${tab.color}-600 border-transparent bg-${tab.color}-50/50`
                          : 'text-slate-500 border-transparent hover:text-slate-700 hover:bg-white/70'
                        }`}>
                      <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-black ${isActive ? `bg-${tab.color}-500 text-white` :
                        isPassed ? `bg-${tab.color}-400 text-white` :
                          'bg-slate-300 text-slate-600'
                        }`}>{tab.num}</span>
                      <span className="text-sm">{tab.label}</span>
                      {isPassed && <CheckCircle2 className="w-4 h-4 text-emerald-500" />}
                    </button>);
                })}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">

              {modalTab === 'basic' && (
                <div className="space-y-5">
                  <div className="bg-indigo-50 border border-indigo-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-indigo-700">
                      <FileText className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                    </div>
                    <p className="text-indigo-600 text-sm mt-1">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¹Ø±Ù‘Ù Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                        ÙƒÙˆØ¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… <span className="text-red-500">*</span>
                      </label>
                      <input type="text" value={formData.code || ''} onChange={(e) => setFormData({ ...formData, code: e.target.value })} disabled={modalMode === 'view'}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-indigo-400 focus:outline-none font-mono"
                        placeholder="SHM-OBL-001, PDPL-ART-18" />
                    </div>
                    <div className="col-span-2">
                      <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                        Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… <span className="text-red-500">*</span>
                      </label>
                      <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })} disabled={modalMode === 'view'}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-indigo-400 focus:outline-none"
                        placeholder="Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­ ÙˆÙ…Ø­Ø¯Ø¯ Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØµÙŠØ§ØºØ© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© / Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                    <textarea rows={3} value={formData.statement || ''} onChange={(e) => setFormData({ ...formData, statement: e.target.value })} disabled={modalMode === 'view'}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 resize-none focus:border-indigo-400 focus:outline-none font-mono text-sm"
                      placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… ÙƒÙ…Ø§ ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…..." />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
                    <textarea rows={2} value={formData.notes || ''} onChange={(e) => setFormData({ ...formData, notes: e.target.value })} disabled={modalMode === 'view'}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 resize-none focus:border-indigo-400 focus:outline-none"
                      placeholder="Ø´Ø±Ø­ ØªÙØµÙŠÙ„ÙŠ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆÙƒÙŠÙÙŠØ© ØªØ·Ø¨ÙŠÙ‚Ù‡..." />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</label>
                      <select value={formData.criticality || 'Medium'} onChange={(e) => setFormData({ ...formData, criticality: e.target.value })} disabled={modalMode === 'view'}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-indigo-400">
                        <option value="Critical">ğŸ”´ Ø­Ø±Ø¬ (Critical)</option>
                        <option value="High">ğŸŸ  Ø¹Ø§Ù„ÙŠ (High)</option>
                        <option value="Medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø· (Medium)</option>
                        <option value="Low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶ (Low)</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© (Control Type)</label>
                      <select value={formData.controlType || 'Preventive'} onChange={(e) => setFormData({ ...formData, controlType: e.target.value })} disabled={modalMode === 'view'}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-indigo-400">
                        <option value="Preventive">ğŸ›¡ï¸ ÙˆÙ‚Ø§Ø¦ÙŠ (Preventive)</option>
                        <option value="Detective">ğŸ” ÙƒØ´ÙÙŠ (Detective)</option>
                        <option value="Corrective">ğŸ”§ ØªØµØ­ÙŠØ­ÙŠ (Corrective)</option>
                        <option value="Directive">ğŸ“‹ ØªÙˆØ¬ÙŠÙ‡ÙŠ (Directive)</option>
                        <option value="Compensating">âš–ï¸ ØªØ¹ÙˆÙŠØ¶ÙŠ (Compensating)</option>
                      </select>
                    </div> </div> </div>
              )}

              {modalTab === 'reference' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-purple-600 via-violet-600 to-indigo-600 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <BookOpen className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</h3>
                          <p className="text-purple-200 text-sm">Regulatory & Legal Reference</p>
                        </div> </div>
                      {formData.authorityId && (
                        <div className="text-left bg-white/10 rounded-xl px-4 py-2 backdrop-blur">
                          <p className="text-purple-200 text-xs">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
                          <p className="font-bold">{AUTHORITIES.find(a => a.id === formData.authorityId)?.code || '-'}</p>
                        </div>
                      )}
                    </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center justify-between">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <Building2 className="w-5 h-5 text-purple-500" />
                        Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© <span className="text-red-500">*</span>
                      </h4>
                      <span className="text-sm text-slate-500">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</span>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-4 gap-3">
                        {[
                          { id: 1, code: 'MOI', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', icon: 'ğŸ›ï¸', color: 'blue', sector: 'Ø£Ù…Ù†ÙŠ' },
                          { id: 2, code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', icon: 'ğŸ¦', color: 'green', sector: 'Ù…Ø§Ù„ÙŠ' },
                          { id: 3, code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: 'ğŸ›¡ï¸', color: 'red', sector: 'Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ' },
                          { id: 4, code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', icon: 'ğŸ¤–', color: 'indigo', sector: 'Ø¨ÙŠØ§Ù†Ø§Øª' },
                          { id: 5, code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø©', icon: 'ğŸ’°', color: 'amber', sector: 'Ø¶Ø±ÙŠØ¨ÙŠ' },
                          { id: 6, code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ“ˆ', color: 'purple', sector: 'Ù…Ø§Ù„ÙŠ' },
                          { id: 7, code: 'MHRSD', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', icon: 'ğŸ‘¥', color: 'cyan', sector: 'Ø¹Ù…Ø§Ù„ÙŠ' },
                          { id: 8, code: 'CBAHI', name: 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØµØ­ÙŠ', icon: 'ğŸ¥', color: 'pink', sector: 'ØµØ­ÙŠ' },
                        ].map(auth => {
                          const isSelected = formData.authorityId === auth.id;
                          return (
                            <button key={auth.id} type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, authorityId: auth.id, authorityCode: auth.code, frameworkId: '' })}
                              className={`p-4 rounded-xl border-2 text-center transition-all transform hover:scale-[1.02] ${isSelected
                                ? `bg-${auth.color}-50 border-${auth.color}-400 shadow-lg`
                                : 'bg-white border-slate-200 hover:border-slate-300'
                                }`}>
                              <span className="text-3xl block mb-2">{auth.icon}</span>
                              <p className={`font-bold text-sm ${isSelected ? `text-${auth.color}-700` : 'text-slate-700'}`}>{auth.code}</p>
                              <p className="text-xs text-slate-500 mt-1 line-clamp-1">{auth.name}</p>
                              <span className={`inline-block mt-2 px-2 py-0.5 rounded-full text-xs ${isSelected ? `bg-${auth.color}-100 text-${auth.color}-700` : 'bg-slate-100 text-slate-500'
                                }`}>{auth.sector}</span>
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-violet-50 px-5 py-3 border-b border-violet-100 flex items-center justify-between">
                      <h4 className="font-bold text-violet-700 flex items-center gap-2">
                        <FileText className="w-5 h-5" />
                        Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ / Ø§Ù„Ù„Ø§Ø¦Ø­Ø©
                      </h4>
                      {formData.frameworkId && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                    </div>
                    <div className="p-5">
                      {formData.authorityId ? (
                        <div className="grid grid-cols-3 gap-3">
                          {[
                            { id: 1, code: 'SHOMOOS', title: 'Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ Ø§Ù„Ø£Ù…Ù†ÙŠ', version: 'v3.0', year: '2024', authorityId: 1 },
                            { id: 2, code: 'SAMA-CSF', title: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', version: 'v2.0', year: '2023', authorityId: 2 },
                            { id: 3, code: 'ECC', title: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', version: 'v2.0', year: '2024', authorityId: 3 },
                            { id: 4, code: 'PDPL', title: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', version: 'v1.0', year: '2023', authorityId: 4 },
                            { id: 5, code: 'VAT-REG', title: 'Ù„Ø§Ø¦Ø­Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', version: 'v4.0', year: '2024', authorityId: 5 },
                            { id: 6, code: 'AML-REG', title: 'Ù„Ø§Ø¦Ø­Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', version: 'v3.0', year: '2023', authorityId: 6 },
                            { id: 7, code: 'LABOR-LAW', title: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„', version: 'v2.0', year: '2024', authorityId: 7 },
                            { id: 8, code: 'CBAHI-STD', title: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØµØ­ÙŠ', version: 'v5.0', year: '2024', authorityId: 8 },
                          ].filter(f => f.authorityId === formData.authorityId).map(framework => {
                            const isSelected = formData.frameworkId === framework.id;
                            return (
                              <button key={framework.id} type="button" disabled={modalMode === 'view'}
                                onClick={() => setFormData({ ...formData, frameworkId: framework.id, frameworkCode: framework.code })}
                                className={`p-4 rounded-xl border-2 text-right transition-all ${isSelected
                                  ? 'bg-violet-50 border-violet-400 shadow-md'
                                  : 'bg-white border-slate-200 hover:border-violet-300'
                                  }`}>
                                <div className="flex items-start justify-between">
                                  <span className={`px-2 py-1 rounded-lg text-xs font-bold ${isSelected ? 'bg-violet-500 text-white' : 'bg-slate-100 text-slate-600'
                                    }`}>{framework.code}</span>
                                  {isSelected && <CheckCircle2 className="w-5 h-5 text-violet-500" />}
                                </div>
                                <p className={`font-bold mt-2 ${isSelected ? 'text-violet-700' : 'text-slate-700'}`}>{framework.title}</p>
                                <div className="flex items-center gap-2 mt-2 text-xs text-slate-500">
                                  <span className="px-2 py-0.5 bg-slate-100 rounded">{framework.version}</span>
                                  <span>{framework.year}</span>
                                </div> </button>);
                          })}
                          {[].filter(f => f.authorityId === formData.authorityId).length === 0 && (
                            <div className="col-span-3 text-center py-8 text-slate-400">
                              <FileText className="w-12 h-12 mx-auto mb-2 opacity-50" />
                              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø·Ø± ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù‡Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                          )}
                        </div>
                      ) : (
                        <div className="text-center py-8 text-slate-400">
                          <Building2 className="w-12 h-12 mx-auto mb-2 opacity-50" />
                          <p>Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</p>
                        </div>
                      )}
                    </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-indigo-50 px-5 py-3 border-b border-indigo-100">
                      <h4 className="font-bold text-indigo-700 flex items-center gap-2">
                        <Hash className="w-5 h-5" />
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø¨Ù†Ø¯
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-4 gap-4">
                        <div className="bg-slate-50 rounded-xl p-4">
                          <label className="block text-xs font-bold text-slate-500 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                          <input type="text" value={formData.articleNumber || ''}
                            onChange={(e) => setFormData({ ...formData, articleNumber: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-center text-lg font-bold disabled:bg-white focus:border-indigo-400 focus:outline-none"
                            placeholder="18" />
                          <p className="text-center text-xs text-slate-400 mt-1">Article</p>
                        </div>
                        <div className="bg-slate-50 rounded-xl p-4">
                          <label className="block text-xs font-bold text-slate-500 mb-2">Ø±Ù‚Ù… Ø§Ù„ÙÙ‚Ø±Ø©</label>
                          <input type="text" value={formData.clauseNumber || ''}
                            onChange={(e) => setFormData({ ...formData, clauseNumber: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-center text-lg font-bold disabled:bg-white focus:border-indigo-400 focus:outline-none"
                            placeholder="3" />
                          <p className="text-center text-xs text-slate-400 mt-1">Clause</p>
                        </div>
                        <div className="bg-slate-50 rounded-xl p-4">
                          <label className="block text-xs font-bold text-slate-500 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ</label>
                          <input type="text" value={formData.subClauseNumber || ''}
                            onChange={(e) => setFormData({ ...formData, subClauseNumber: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-center text-lg font-bold disabled:bg-white focus:border-indigo-400 focus:outline-none"
                            placeholder="Ø£" />
                          <p className="text-center text-xs text-slate-400 mt-1">Sub-Clause</p>
                        </div>
                        <div className="bg-slate-50 rounded-xl p-4">
                          <label className="block text-xs font-bold text-slate-500 mb-2">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                          <input type="text" value={formData.regulationVersion || ''}
                            onChange={(e) => setFormData({ ...formData, regulationVersion: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-center text-lg font-bold disabled:bg-white focus:border-indigo-400 focus:outline-none"
                            placeholder="v2.0" />
                          <p className="text-center text-xs text-slate-400 mt-1">Version</p>
                        </div> </div>
                      {(formData.articleNumber || formData.clauseNumber) && (
                        <div className="mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200">
                          <p className="text-sm text-indigo-600 mb-1">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ:</p>
                          <p className="text-2xl font-black text-indigo-700 font-mono">
                            {formData.authorityCode || 'XXX'}-{formData.frameworkCode || 'XXX'}-ART{formData.articleNumber || '00'}.{formData.clauseNumber || '0'}{formData.subClauseNumber ? `.${formData.subClauseNumber}` : ''}
                          </p> </div>
                      )}
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-blue-50 px-5 py-3 border-b border-blue-100">
                        <h4 className="font-bold text-blue-700 flex items-center gap-2">
                          <Link2 className="w-5 h-5" />
                          Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ø³Ù…ÙŠØ©
                        </h4>
                      </div>
                      <div className="p-4 space-y-3">
                        <div>
                          <label className="block text-xs font-bold text-slate-500 mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                          <div className="flex gap-2">
                            <input type="url" value={formData.referenceUrl || ''}
                              onChange={(e) => setFormData({ ...formData, referenceUrl: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-blue-400 focus:outline-none text-sm"
                              placeholder="https://..." />
                            {formData.referenceUrl && (
                              <button type="button" className="px-3 py-2.5 bg-blue-500 text-white rounded-xl hover:bg-blue-600">
                                <ExternalLink className="w-5 h-5" />
                              </button>
                            )}
                          </div> </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-500 mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø§Ø¦Ø­Ø©</label>
                          <input type="url" value={formData.fullTextUrl || ''}
                            onChange={(e) => setFormData({ ...formData, fullTextUrl: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-blue-400 focus:outline-none text-sm"
                            placeholder="https://..." />
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-amber-50 px-5 py-3 border-b border-amber-100">
                        <h4 className="font-bold text-amber-700 flex items-center gap-2">
                          <Calendar className="w-5 h-5" />
                          ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù†ÙØ§Ø°
                        </h4>
                      </div>
                      <div className="p-4 space-y-3">
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-bold text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                            <input type="date" value={formData.issuanceDate || ''}
                              onChange={(e) => setFormData({ ...formData, issuanceDate: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400 focus:outline-none text-sm" />
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</label>
                            <input type="date" value={formData.effectiveDate || ''}
                              onChange={(e) => setFormData({ ...formData, effectiveDate: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400 focus:outline-none text-sm" />
                          </div> </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-500 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                          <input type="text" value={formData.applicationNotes || ''}
                            onChange={(e) => setFormData({ ...formData, applicationNotes: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400 focus:outline-none text-sm"
                            placeholder="Ù…Ø«Ø§Ù„: ÙŠØ³Ø±ÙŠ Ø¨Ø¹Ø¯ 90 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù†Ø´Ø±" />
                        </div> </div> </div> </div>
                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                      <BarChart3 className="w-5 h-5 text-purple-400" />
                      Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                    </h4>
                    <div className="grid grid-cols-5 gap-4">
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-1">ğŸ›ï¸</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø¬Ù‡Ø©</p>
                        <p className="font-bold text-sm mt-1">{formData.authorityCode || '-'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-1">ğŸ“‹</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø¥Ø·Ø§Ø±</p>
                        <p className="font-bold text-sm mt-1">{formData.frameworkCode || '-'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-1">ğŸ“„</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ù…Ø§Ø¯Ø©</p>
                        <p className="font-bold text-sm mt-1">{formData.articleNumber || '-'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-1">ğŸ“</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„ÙÙ‚Ø±Ø©</p>
                        <p className="font-bold text-sm mt-1">{formData.clauseNumber || '-'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-1">ğŸ”–</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</p>
                        <p className="font-bold text-sm mt-1">{formData.regulationVersion || '-'}</p>
                      </div> </div> </div> </div>
              )}

              {modalTab === 'program' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl p-5 text-white">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                        <Layers className="w-7 h-7" />
                      </div>
                      <div>
                        <h3 className="text-xl font-black">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ§Ù„ØªØµÙ†ÙŠÙ</h3>
                        <p className="text-emerald-100 text-sm">Regulatory Program & Classification</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <Building2 className="w-5 h-5 text-emerald-500" />
                        Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ <span className="text-red-500">*</span>
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-3 gap-3 mb-4">
                        {[
                          { id: 'shomoos', name: 'Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³', icon: 'ğŸ”', authority: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', color: 'blue' },
                          { id: 'sama-cyber', name: 'SAMA Cyber', icon: 'ğŸ¦', authority: 'Ø³Ø§Ù…Ø§', color: 'purple' },
                          { id: 'nca-ecc', name: 'NCA ECC', icon: 'ğŸ›¡ï¸', authority: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ©', color: 'red' },
                          { id: 'pdpl', name: 'PDPL', icon: 'ğŸ“‹', authority: 'SDAIA', color: 'indigo' },
                          { id: 'zatca-vat', name: 'ZATCA VAT', icon: 'ğŸ’°', authority: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø©', color: 'green' },
                          { id: 'cma-aml', name: 'CMA AML', icon: 'ğŸ›ï¸', authority: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚', color: 'amber' },
                          { id: 'mhrsd', name: 'MHRSD Labor', icon: 'ğŸ‘¥', authority: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'cyan' },
                          { id: 'civil-defense', name: 'Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', icon: 'ğŸš’', authority: 'Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', color: 'orange' },
                          { id: 'gahar', name: 'GAHAR', icon: 'ğŸ¥', authority: 'CBAHI', color: 'pink' },
                        ].map(prog => {
                          const isSelected = formData.programId === prog.id;
                          return (
                            <button key={prog.id} type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, programId: prog.id, programName: prog.name })}
                              className={`p-4 rounded-xl border-2 text-right transition-all transform hover:scale-[1.02] ${isSelected
                                ? `bg-${prog.color}-50 border-${prog.color}-400 shadow-lg`
                                : 'bg-white border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-center gap-3">
                                <span className="text-2xl">{prog.icon}</span>
                                <div className="flex-1">
                                  <p className={`font-bold ${isSelected ? `text-${prog.color}-700` : 'text-slate-700'}`}>{prog.name}</p>
                                  <p className="text-xs text-slate-500">{prog.authority}</p>
                                </div>
                                {isSelected && <CheckCircle2 className={`w-5 h-5 text-${prog.color}-500`} />}
                              </div> </button>);
                        })}
                      </div>

                      <div className="border-t border-slate-200 pt-4 mt-4">
                        <p className="text-sm font-bold text-slate-500 mb-3">ğŸŒ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</p>
                        <div className="grid grid-cols-4 gap-3">
                          {[
                            { id: 'iso27001', name: 'ISO 27001', icon: 'ğŸŒ' },
                            { id: 'gdpr', name: 'GDPR', icon: 'ğŸ‡ªğŸ‡º' },
                            { id: 'pci-dss', name: 'PCI DSS', icon: 'ğŸ’³' },
                            { id: 'soc2', name: 'SOC 2', icon: 'ğŸ“Š' },
                          ].map(prog => {
                            const isSelected = formData.programId === prog.id;
                            return (
                              <button key={prog.id} type="button" disabled={modalMode === 'view'}
                                onClick={() => setFormData({ ...formData, programId: prog.id, programName: prog.name })}
                                className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-violet-50 border-violet-400' : 'bg-white border-slate-200 hover:border-violet-300'
                                  }`}>
                                <span className="text-xl">{prog.icon}</span>
                                <p className={`text-sm font-bold mt-1 ${isSelected ? 'text-violet-700' : 'text-slate-600'}`}>{prog.name}</p>
                              </button>);
                          })}
                        </div> </div> </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-purple-50 px-5 py-3 border-b border-purple-100">
                        <h4 className="font-bold text-purple-700 flex items-center gap-2">
                          <Tag className="w-5 h-5" />
                          ØªØµÙ†ÙŠÙ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…
                        </h4>
                      </div>
                      <div className="p-4 space-y-2">
                        {[
                          { value: 'regulatory', label: 'ğŸ“‹ ØªÙ†Ø¸ÙŠÙ…ÙŠ', desc: 'Ù…ØªØ·Ù„Ø¨ Ù…Ù† Ø¬Ù‡Ø© Ø±Ù‚Ø§Ø¨ÙŠØ©' },
                          { value: 'legal', label: 'âš–ï¸ Ù‚Ø§Ù†ÙˆÙ†ÙŠ', desc: 'Ù†Øµ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù…Ù„Ø²Ù…' },
                          { value: 'contractual', label: 'ğŸ“ ØªØ¹Ø§Ù‚Ø¯ÙŠ', desc: 'Ø§Ù„ØªØ²Ø§Ù… ØªØ¹Ø§Ù‚Ø¯ÙŠ' },
                          { value: 'internal', label: 'ğŸ¢ Ø¯Ø§Ø®Ù„ÙŠ', desc: 'Ø³ÙŠØ§Ø³Ø© Ø¯Ø§Ø®Ù„ÙŠØ©' },
                          { value: 'industry', label: 'ğŸ­ ØµÙ†Ø§Ø¹ÙŠ', desc: 'Ù…Ø¹ÙŠØ§Ø± ØµÙ†Ø§Ø¹ÙŠ' },
                        ].map(cat => (
                          <button key={cat.value} type="button" disabled={modalMode === 'view'}
                            onClick={() => setFormData({ ...formData, obligationType: cat.value })}
                            className={`w-full p-3 rounded-xl border-2 text-right transition-all flex items-center justify-between ${formData.obligationType === cat.value ? 'bg-purple-50 border-purple-400' : 'bg-white border-slate-200 hover:border-purple-300'
                              }`}>
                            <div>
                              <p className="font-bold text-slate-700">{cat.label}</p>
                              <p className="text-xs text-slate-500">{cat.desc}</p>
                            </div>
                            {formData.obligationType === cat.value && <CheckCircle2 className="w-5 h-5 text-purple-500" />}
                          </button>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-blue-50 px-5 py-3 border-b border-blue-100">
                        <h4 className="font-bold text-blue-700 flex items-center gap-2">
                          <Shield className="w-5 h-5" />
                          Ù†ÙˆØ¹ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© (Control Type)
                        </h4>
                      </div>
                      <div className="p-4 space-y-2">
                        {[
                          { value: 'preventive', label: 'ğŸ›¡ï¸ ÙˆÙ‚Ø§Ø¦ÙŠ', desc: 'ÙŠÙ…Ù†Ø¹ Ø­Ø¯ÙˆØ« Ø§Ù„Ù…Ø®Ø§Ø·Ø±' },
                          { value: 'detective', label: 'ğŸ” ÙƒØ´ÙÙŠ', desc: 'ÙŠÙƒØªØ´Ù Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª' },
                          { value: 'corrective', label: 'ğŸ”§ ØªØµØ­ÙŠØ­ÙŠ', desc: 'ÙŠØµØ­Ø­ Ø§Ù„Ø§Ù†Ø­Ø±Ø§ÙØ§Øª' },
                          { value: 'directive', label: 'ğŸ“‹ ØªÙˆØ¬ÙŠÙ‡ÙŠ', desc: 'ÙŠÙˆØ¬Ù‡ Ø§Ù„Ø³Ù„ÙˆÙƒ' },
                          { value: 'compensating', label: 'âš–ï¸ ØªØ¹ÙˆÙŠØ¶ÙŠ', desc: 'ÙŠØ¹ÙˆØ¶ Ø¹Ù† Ø¶Ø§Ø¨Ø· Ø¢Ø®Ø±' },
                        ].map(ctrl => (
                          <button key={ctrl.value} type="button" disabled={modalMode === 'view'}
                            onClick={() => setFormData({ ...formData, controlType: ctrl.value })}
                            className={`w-full p-3 rounded-xl border-2 text-right transition-all flex items-center justify-between ${formData.controlType === ctrl.value ? 'bg-blue-50 border-blue-400' : 'bg-white border-slate-200 hover:border-blue-300'
                              }`}>
                            <div>
                              <p className="font-bold text-slate-700">{ctrl.label}</p>
                              <p className="text-xs text-slate-500">{ctrl.desc}</p>
                            </div>
                            {formData.controlType === ctrl.value && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                          </button>
                        ))}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-amber-50 px-5 py-3 border-b border-amber-100">
                      <h4 className="font-bold text-amber-700 flex items-center gap-2">
                        <Globe className="w-5 h-5" />
                        Ø§Ù„Ù…Ø¬Ø§Ù„ ÙˆØ§Ù„Ù†Ø·Ø§Ù‚
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-4 gap-3">
                        {[
                          { value: 'cybersecurity', label: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: 'ğŸ”’' },
                          { value: 'data_privacy', label: 'Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', icon: 'ğŸ”' },
                          { value: 'financial', label: 'Ù…Ø§Ù„ÙŠ ÙˆÙ…Ø­Ø§Ø³Ø¨ÙŠ', icon: 'ğŸ’°' },
                          { value: 'hr_labor', label: 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©', icon: 'ğŸ‘¥' },
                          { value: 'health_safety', label: 'ØµØ­Ø© ÙˆØ³Ù„Ø§Ù…Ø©', icon: 'ğŸ¥' },
                          { value: 'environment', label: 'Ø¨ÙŠØ¦Ø©', icon: 'ğŸŒ¿' },
                          { value: 'quality', label: 'Ø¬ÙˆØ¯Ø©', icon: 'âœ…' },
                          { value: 'operations', label: 'ØªØ´ØºÙŠÙ„', icon: 'âš™ï¸' },
                        ].map(domain => {
                          const isSelected = (formData.domains || []).includes(domain.value);
                          return (
                            <button key={domain.value} type="button" disabled={modalMode === 'view'}
                              onClick={() => {
                                if (isSelected) {
                                  setFormData({ ...formData, domains: (formData.domains || []).filter(d => d !== domain.value) });
                                } else {
                                  setFormData({ ...formData, domains: [...(formData.domains || []), domain.value] });
                                }
                              }}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-amber-50 border-amber-400' : 'bg-white border-slate-200 hover:border-amber-300'
                                }`}>
                              <span className="text-2xl">{domain.icon}</span>
                              <p className={`text-xs font-bold mt-1 ${isSelected ? 'text-amber-700' : 'text-slate-600'}`}>{domain.label}</p>
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <Hash className="w-5 h-5 text-slate-500" />
                        Ø§Ù„ÙˆØ³ÙˆÙ… ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
                      </h4>
                    </div>
                    <div className="p-4">
                      <div className="flex gap-2 mb-3">
                        <input type="text" id="tagInput" placeholder="Ø£Ø¶Ù ÙˆØ³Ù… Ø¬Ø¯ÙŠØ¯..."
                          disabled={modalMode === 'view'}
                          className="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter' && e.target.value.trim()) {
                              setFormData({ ...formData, tags: [...(formData.tags || []), e.target.value.trim()] });
                              e.target.value = '';
                            }
                          }} />
                        <button type="button" disabled={modalMode === 'view'}
                          onClick={() => {
                            const input = document.getElementById('tagInput');
                            if (input.value.trim()) {
                              setFormData({ ...formData, tags: [...(formData.tags || []), input.value.trim()] });
                              input.value = '';
                            }
                          }}
                          className="px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600 disabled:opacity-50">
                          <Plus className="w-5 h-5" />
                        </button> </div>
                      <div className="flex flex-wrap gap-2">
                        {(formData.tags || []).map((tag, idx) => (
                          <span key={idx} className="inline-flex items-center gap-1 px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-full text-sm font-bold">
                            #{tag}
                            {modalMode !== 'view' && (
                              <button type="button" onClick={() => setFormData({ ...formData, tags: formData.tags.filter((_, i) => i !== idx) })}
                                className="hover:bg-emerald-200 rounded-full p-0.5">
                                <X className="w-3 h-3" />
                              </button>
                            )}
                          </span>
                        ))}
                        {(!formData.tags || formData.tags.length === 0) && (
                          <p className="text-slate-400 text-sm">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØ³ÙˆÙ… Ø¨Ø¹Ø¯</p>
                        )}
                      </div> </div> </div>
                  {formData.programId && (
                    <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-5 border border-emerald-200">
                      <h4 className="font-bold text-emerald-700 mb-3 flex items-center gap-2">
                        <CheckCircle2 className="w-5 h-5" />
                        Ù…Ù„Ø®Øµ Ø§Ù„ØªØµÙ†ÙŠÙ
                      </h4>
                      <div className="grid grid-cols-4 gap-4">
                        <div className="bg-white rounded-xl p-3 text-center">
                          <p className="text-2xl mb-1">{formData.programId === 'shomoos' ? 'ğŸ”' : formData.programId === 'sama-cyber' ? 'ğŸ¦' : 'ğŸ“‹'}</p>
                          <p className="text-xs text-slate-500">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                          <p className="font-bold text-slate-700 text-sm">{formData.programName || formData.programId}</p>
                        </div>
                        <div className="bg-white rounded-xl p-3 text-center">
                          <p className="text-2xl mb-1">{formData.obligationType === 'regulatory' ? 'ğŸ“‹' : formData.obligationType === 'legal' ? 'âš–ï¸' : 'ğŸ“'}</p>
                          <p className="text-xs text-slate-500">Ø§Ù„ØªØµÙ†ÙŠÙ</p>
                          <p className="font-bold text-slate-700 text-sm">{formData.obligationType || '-'}</p>
                        </div>
                        <div className="bg-white rounded-xl p-3 text-center">
                          <p className="text-2xl mb-1">{formData.controlType === 'preventive' ? 'ğŸ›¡ï¸' : formData.controlType === 'detective' ? 'ğŸ”' : 'ğŸ”§'}</p>
                          <p className="text-xs text-slate-500">Ù†ÙˆØ¹ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©</p>
                          <p className="font-bold text-slate-700 text-sm">{formData.controlType || '-'}</p>
                        </div>
                        <div className="bg-white rounded-xl p-3 text-center">
                          <p className="text-2xl mb-1">ğŸ·ï¸</p>
                          <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</p>
                          <p className="font-bold text-slate-700 text-sm">{(formData.domains || []).length} Ù…Ø¬Ø§Ù„</p>
                        </div> </div> </div>
                  )}
                </div>
              )}

              {modalTab === 'applicability' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-amber-500 via-orange-500 to-yellow-500 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <CheckSquare className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª</h3>
                          <p className="text-amber-100 text-sm">Applicability & Exceptions Management</p>
                        </div> </div>
                      <div className={`px-4 py-2 rounded-xl ${formData.applicability === 'applicable' || !formData.applicability ? 'bg-emerald-500' :
                        formData.applicability === 'partial' ? 'bg-amber-600' : 'bg-red-500'
                        }`}>
                        <p className="text-xs opacity-80">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                        <p className="font-bold">
                          {formData.applicability === 'applicable' || !formData.applicability ? 'âœ… Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚' :
                            formData.applicability === 'partial' ? 'âš ï¸ Ø¬Ø²Ø¦ÙŠ' : 'âŒ ØºÙŠØ± Ù‚Ø§Ø¨Ù„'}
                        </p> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <Target className="w-5 h-5 text-amber-500" />
                        Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Applicability Status)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-3 gap-4">
                        <button type="button" disabled={modalMode === 'view'}
                          onClick={() => setFormData({ ...formData, applicability: 'applicable' })}
                          className={`p-6 rounded-2xl border-3 transition-all transform hover:scale-[1.02] ${formData.applicability === 'applicable' || !formData.applicability
                            ? 'bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-400 shadow-lg shadow-emerald-500/20'
                            : 'bg-white border-slate-200 hover:border-emerald-300'
                            }`}>
                          <div className={`w-20 h-20 mx-auto rounded-2xl flex items-center justify-center mb-4 ${formData.applicability === 'applicable' || !formData.applicability
                            ? 'bg-emerald-500 shadow-lg shadow-emerald-500/50' : 'bg-slate-100'
                            }`}>
                            <CheckCircle2 className={`w-10 h-10 ${formData.applicability === 'applicable' || !formData.applicability ? 'text-white' : 'text-slate-400'
                              }`} />
                          </div>
                          <p className={`font-black text-lg ${formData.applicability === 'applicable' || !formData.applicability ? 'text-emerald-700' : 'text-slate-700'
                            }`}>Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                          <p className="text-sm text-slate-500 mt-1">Fully Applicable</p>
                          <p className="text-xs text-slate-400 mt-2">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙŠÙ†Ø·Ø¨Ù‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</p>
                          {(formData.applicability === 'applicable' || !formData.applicability) && (
                            <div className="mt-3 px-3 py-1.5 bg-emerald-500 text-white rounded-full text-xs font-bold inline-block">
                              âœ“ Ù…Ø­Ø¯Ø¯
                            </div>
                          )}
                        </button>

                        <button type="button" disabled={modalMode === 'view'}
                          onClick={() => setFormData({ ...formData, applicability: 'partial' })}
                          className={`p-6 rounded-2xl border-3 transition-all transform hover:scale-[1.02] ${formData.applicability === 'partial'
                            ? 'bg-gradient-to-br from-amber-50 to-orange-50 border-amber-400 shadow-lg shadow-amber-500/20'
                            : 'bg-white border-slate-200 hover:border-amber-300'
                            }`}>
                          <div className={`w-20 h-20 mx-auto rounded-2xl flex items-center justify-center mb-4 ${formData.applicability === 'partial'
                            ? 'bg-amber-500 shadow-lg shadow-amber-500/50' : 'bg-slate-100'
                            }`}>
                            <AlertTriangle className={`w-10 h-10 ${formData.applicability === 'partial' ? 'text-white' : 'text-slate-400'
                              }`} />
                          </div>
                          <p className={`font-black text-lg ${formData.applicability === 'partial' ? 'text-amber-700' : 'text-slate-700'
                            }`}>ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø²Ø¦ÙŠ</p>
                          <p className="text-sm text-slate-500 mt-1">Partially Applicable</p>
                          <p className="text-xs text-slate-400 mt-2">Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙÙ‚Ø· ØªÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</p>
                          {formData.applicability === 'partial' && (
                            <div className="mt-3 px-3 py-1.5 bg-amber-500 text-white rounded-full text-xs font-bold inline-block">
                              âš  ÙŠØªØ·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡
                            </div>
                          )}
                        </button>

                        <button type="button" disabled={modalMode === 'view'}
                          onClick={() => setFormData({ ...formData, applicability: 'not_applicable' })}
                          className={`p-6 rounded-2xl border-3 transition-all transform hover:scale-[1.02] ${formData.applicability === 'not_applicable'
                            ? 'bg-gradient-to-br from-red-50 to-rose-50 border-red-400 shadow-lg shadow-red-500/20'
                            : 'bg-white border-slate-200 hover:border-red-300'
                            }`}>
                          <div className={`w-20 h-20 mx-auto rounded-2xl flex items-center justify-center mb-4 ${formData.applicability === 'not_applicable'
                            ? 'bg-red-500 shadow-lg shadow-red-500/50' : 'bg-slate-100'
                            }`}>
                            <XCircle className={`w-10 h-10 ${formData.applicability === 'not_applicable' ? 'text-white' : 'text-slate-400'
                              }`} />
                          </div>
                          <p className={`font-black text-lg ${formData.applicability === 'not_applicable' ? 'text-red-700' : 'text-slate-700'
                            }`}>ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                          <p className="text-sm text-slate-500 mt-1">Not Applicable</p>
                          <p className="text-xs text-slate-400 mt-2">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ø§ ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø·Ø¨ÙŠØ¹Ø© Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</p>
                          {formData.applicability === 'not_applicable' && (
                            <div className="mt-3 px-3 py-1.5 bg-red-500 text-white rounded-full text-xs font-bold inline-block">
                              âœ— ÙŠØªØ·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø±Ø³Ù…ÙŠ
                            </div>
                          )}
                        </button> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-blue-50 px-5 py-3 border-b border-blue-100">
                      <h4 className="font-bold text-blue-700 flex items-center gap-2">
                        <Building2 className="w-5 h-5" />
                        Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Scope of Application)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-4 gap-3">
                        {[
                          { value: 'all_org', label: 'ÙƒÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©', icon: 'ğŸ¢', desc: 'ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª' },
                          { value: 'it_dept', label: 'Ø¥Ø¯Ø§Ø±Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', icon: 'ğŸ’»', desc: 'IT Department' },
                          { value: 'hr_dept', label: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', icon: 'ğŸ‘¥', desc: 'HR Department' },
                          { value: 'finance', label: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ’°', desc: 'Finance Department' },
                          { value: 'operations', label: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', icon: 'âš™ï¸', desc: 'Operations' },
                          { value: 'legal', label: 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', icon: 'âš–ï¸', desc: 'Legal Affairs' },
                          { value: 'security', label: 'Ø§Ù„Ø£Ù…Ù†', icon: 'ğŸ”’', desc: 'Security' },
                          { value: 'compliance', label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', icon: 'âœ…', desc: 'Compliance' },
                        ].map(scope => {
                          const isSelected = (formData.applicationScope || ['all_org']).includes(scope.value);
                          return (
                            <button key={scope.value} type="button" disabled={modalMode === 'view'}
                              onClick={() => {
                                const current = formData.applicationScope || ['all_org'];
                                if (isSelected) {
                                  setFormData({ ...formData, applicationScope: current.filter(s => s !== scope.value) });
                                } else {
                                  setFormData({ ...formData, applicationScope: [...current.filter(s => s !== 'all_org'), scope.value] });
                                }
                              }}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-blue-50 border-blue-400' : 'bg-white border-slate-200 hover:border-blue-300'
                                }`}>
                              <span className="text-2xl">{scope.icon}</span>
                              <p className={`text-sm font-bold mt-1 ${isSelected ? 'text-blue-700' : 'text-slate-700'}`}>{scope.label}</p>
                              <p className="text-xs text-slate-400">{scope.desc}</p>
                            </button>);
                        })}
                      </div> </div> </div>
                  {(formData.applicability === 'not_applicable' || formData.applicability === 'partial') && (
                    <div className="bg-white rounded-2xl border-2 border-red-200 overflow-hidden">
                      <div className="bg-gradient-to-r from-red-500 to-rose-500 px-5 py-4 text-white">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center">
                            <AlertCircle className="w-6 h-6" />
                          </div>
                          <div>
                            <h4 className="font-bold">Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø±Ø³Ù…ÙŠ (Exception Request)</h4>
                            <p className="text-red-200 text-sm">ÙŠØ¬Ø¨ ØªÙˆØ«ÙŠÙ‚ Ù…Ø¨Ø±Ø±Ø§Øª Ø¹Ø¯Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© Ø±Ø³Ù…ÙŠØ©</p>
                          </div> </div> </div>
                      <div className="p-5 space-y-5">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">
                            Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ <span className="text-red-500">*</span>
                          </label>
                          <select value={formData.exceptionReason || ''}
                            onChange={(e) => setFormData({ ...formData, exceptionReason: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-red-400">
                            <option value="">Ø§Ø®ØªØ± Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡...</option>
                            <option value="not_in_scope">Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</option>
                            <option value="different_industry">Ù‚Ø·Ø§Ø¹ ØµÙ†Ø§Ø¹ÙŠ Ù…Ø®ØªÙ„Ù</option>
                            <option value="size_threshold">Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</option>
                            <option value="geographic">Ù‚ÙŠÙˆØ¯ Ø¬ØºØ±Ø§ÙÙŠØ©</option>
                            <option value="technical">Ù‚ÙŠÙˆØ¯ ØªÙ‚Ù†ÙŠØ©</option>
                            <option value="compensating_control">ÙŠÙˆØ¬Ø¯ Ø¶Ø§Ø¨Ø· ØªØ¹ÙˆÙŠØ¶ÙŠ Ø¨Ø¯ÙŠÙ„</option>
                            <option value="regulatory_exemption">Ø¥Ø¹ÙØ§Ø¡ ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø±Ø³Ù…ÙŠ</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                          </select>
                        </div>

                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">
                            Ø§Ù„Ù…Ø¨Ø±Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ <span className="text-red-500">*</span>
                          </label>
                          <textarea value={formData.exceptionJustification || ''}
                            onChange={(e) => setFormData({ ...formData, exceptionJustification: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-red-400 focus:outline-none h-28 resize-none"
                            placeholder="Ø§Ø´Ø±Ø­ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù†Ø·Ø¨Ø§Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© ÙˆÙ…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª..." />
                        </div>

                        <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                          <div className="flex items-center justify-between mb-3">
                            <label className="font-bold text-amber-700 flex items-center gap-2">
                              <Shield className="w-5 h-5" />
                              Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¶Ø§Ø¨Ø· ØªØ¹ÙˆÙŠØ¶ÙŠ Ø¨Ø¯ÙŠÙ„ØŸ
                            </label>
                            <label className="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" checked={formData.hasCompensatingControl || false}
                                onChange={(e) => setFormData({ ...formData, hasCompensatingControl: e.target.checked })}
                                disabled={modalMode === 'view'} className="sr-only peer" />
                              <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-amber-500"></div>
                            </label>
                          </div>
                          {formData.hasCompensatingControl && (
                            <textarea value={formData.compensatingControlDesc || ''}
                              onChange={(e) => setFormData({ ...formData, compensatingControlDesc: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl disabled:bg-white focus:border-amber-400 focus:outline-none h-20 resize-none"
                              placeholder="ØµÙ Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ø¨Ù‚..." />
                          )}
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</label>
                            <div className="flex gap-2">
                              {[
                                { value: 'low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'green' },
                                { value: 'medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                                { value: 'high', label: 'Ø¹Ø§Ù„ÙŠ', color: 'red' },
                              ].map(risk => (
                                <button key={risk.value} type="button" disabled={modalMode === 'view'}
                                  onClick={() => setFormData({ ...formData, residualRisk: risk.value })}
                                  className={`flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all ${formData.residualRisk === risk.value
                                    ? `bg-${risk.color}-100 border-${risk.color}-400 text-${risk.color}-700`
                                    : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'
                                    }`}>
                                  {risk.label}
                                </button>
                              ))}
                            </div> </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡</label>
                            <input type="date" value={formData.exceptionReviewDate || ''}
                              onChange={(e) => setFormData({ ...formData, exceptionReviewDate: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-red-400" />
                          </div> </div>
                        <div className="bg-slate-50 rounded-xl p-4">
                          <h5 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <UserCheck className="w-5 h-5 text-purple-500" />
                            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                          </h5>
                          <div className="grid grid-cols-3 gap-4">
                            <div>
                              <label className="block text-xs font-bold text-slate-500 mb-1">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Approver) *</label>
                              <input type="text" value={formData.exceptionApprover || ''}
                                onChange={(e) => setFormData({ ...formData, exceptionApprover: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-purple-400"
                                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯" />
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-500 mb-1">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                              <input type="text" value={formData.approverTitle || ''}
                                onChange={(e) => setFormData({ ...formData, approverTitle: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-purple-400"
                                placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…" />
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ *</label>
                              <input type="date" value={formData.exceptionDate || ''}
                                onChange={(e) => setFormData({ ...formData, exceptionDate: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-purple-400" />
                            </div> </div> </div>
                        <div className="flex items-center justify-between p-4 bg-slate-100 rounded-xl">
                          <div>
                            <p className="font-bold text-slate-700">Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
                            <p className="text-sm text-slate-500">Exception Request Status</p>
                          </div>
                          <select value={formData.exceptionStatus || 'pending'}
                            onChange={(e) => setFormData({ ...formData, exceptionStatus: e.target.value })}
                            disabled={modalMode === 'view'}
                            className={`px-4 py-2.5 rounded-xl font-bold border-2 ${formData.exceptionStatus === 'approved' ? 'bg-green-100 border-green-400 text-green-700' :
                              formData.exceptionStatus === 'rejected' ? 'bg-red-100 border-red-400 text-red-700' :
                                formData.exceptionStatus === 'under_review' ? 'bg-blue-100 border-blue-400 text-blue-700' :
                                  'bg-amber-100 border-amber-400 text-amber-700'
                              }`}>
                            <option value="pending">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="under_review">ğŸ” Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="approved">âœ… Ù…Ø¹ØªÙ…Ø¯</option>
                            <option value="rejected">âŒ Ù…Ø±ÙÙˆØ¶</option>
                          </select>
                        </div> </div> </div>
                  )}

                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                      <BarChart3 className="w-5 h-5 text-amber-400" />
                      Ù…Ù„Ø®Øµ Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                    </h4>
                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className={`text-4xl mb-2 ${formData.applicability === 'applicable' || !formData.applicability ? '' :
                          formData.applicability === 'partial' ? '' : ''
                          }`}>
                          {formData.applicability === 'applicable' || !formData.applicability ? 'âœ…' :
                            formData.applicability === 'partial' ? 'âš ï¸' : 'âŒ'}
                        </p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø­Ø§Ù„Ø©</p>
                        <p className="font-bold text-sm mt-1">
                          {formData.applicability === 'applicable' || !formData.applicability ? 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚' :
                            formData.applicability === 'partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ØºÙŠØ± Ù‚Ø§Ø¨Ù„'}
                        </p> </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-4xl mb-2">ğŸ¢</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ù†Ø·Ø§Ù‚</p>
                        <p className="font-bold text-sm mt-1">{(formData.applicationScope || ['all_org']).length} Ø¥Ø¯Ø§Ø±Ø©</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-4xl mb-2">ğŸ“‹</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
                        <p className="font-bold text-sm mt-1">
                          {formData.applicability === 'applicable' || !formData.applicability ? 'ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨' :
                            formData.exceptionStatus === 'approved' ? 'Ù…Ø¹ØªÙ…Ø¯' : 'Ù…Ø·Ù„ÙˆØ¨'}
                        </p> </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className={`text-4xl mb-2`}>
                          {formData.residualRisk === 'low' ? 'ğŸŸ¢' :
                            formData.residualRisk === 'medium' ? 'ğŸŸ¡' :
                              formData.residualRisk === 'high' ? 'ğŸ”´' : 'âšª'}
                        </p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</p>
                        <p className="font-bold text-sm mt-1">
                          {formData.residualRisk === 'low' ? 'Ù…Ù†Ø®ÙØ¶' :
                            formData.residualRisk === 'medium' ? 'Ù…ØªÙˆØ³Ø·' :
                              formData.residualRisk === 'high' ? 'Ø¹Ø§Ù„ÙŠ' : '-'}
                        </p> </div> </div> </div> </div>
              )}

              {modalTab === 'evidence' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-teal-500 to-cyan-500 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <FileCheck className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„Ø¥Ø«Ø¨Ø§Øª</h3>
                          <p className="text-teal-100 text-sm">Evidence Requirements & Attachments</p>
                        </div> </div>
                      <div className="text-left">
                        <p className="text-teal-200 text-xs">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø©</p>
                        <p className="text-4xl font-black">{(formData.attachments || []).length}</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="p-5 flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all ${formData.evidenceRequired !== false ? 'bg-teal-100' : 'bg-slate-100'
                          }`}>
                          <FileCheck className={`w-7 h-7 ${formData.evidenceRequired !== false ? 'text-teal-600' : 'text-slate-400'}`} />
                        </div>
                        <div>
                          <p className="font-bold text-slate-800 text-lg">Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø£Ø¯Ù„Ø© Ø¥Ø«Ø¨Ø§ØªØŸ</p>
                          <p className="text-slate-500 text-sm">ØªÙØ¹ÙŠÙ„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                        </div> </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked={formData.evidenceRequired !== false} onChange={(e) => setFormData({ ...formData, evidenceRequired: e.target.checked })}
                          disabled={modalMode === 'view'} className="sr-only peer" />
                        <div className="w-16 h-8 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-teal-500 shadow-inner"></div>
                        <span className="mr-3 text-lg font-black text-slate-700">{formData.evidenceRequired !== false ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</span>
                      </label>
                    </div> </div>
                  {formData.evidenceRequired !== false && (
                    <>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center justify-between">
                          <h4 className="font-bold text-slate-700 flex items-center gap-2">
                            <Layers className="w-5 h-5 text-teal-500" />
                            Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                          </h4>
                          <span className="px-3 py-1 bg-teal-100 text-teal-700 rounded-full text-sm font-bold">
                            {(formData.evidenceTypes || []).length} Ù†ÙˆØ¹ Ù…Ø­Ø¯Ø¯
                          </span> </div>
                        <div className="p-5">
                          <div className="grid grid-cols-3 gap-3">
                            {[
                              { value: 'certificate', label: 'Ø´Ù‡Ø§Ø¯Ø© Ø±Ø³Ù…ÙŠØ©', icon: 'ğŸ“œ', desc: 'Ø´Ù‡Ø§Ø¯Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø§Ø¹ØªÙ…Ø§Ø¯' },
                              { value: 'audit_report', label: 'ØªÙ‚Ø±ÙŠØ± ØªØ¯Ù‚ÙŠÙ‚', icon: 'ğŸ“Š', desc: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚' },
                              { value: 'system_log', label: 'Ø³Ø¬Ù„ Ù†Ø¸Ø§Ù…', icon: 'ğŸ’»', desc: 'Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©' },
                              { value: 'screenshot', label: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', icon: 'ğŸ“¸', desc: 'ØµÙˆØ± Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ¯Ù„ÙŠÙ„' },
                              { value: 'meeting_minutes', label: 'Ù…Ø­Ø¶Ø± Ø§Ø¬ØªÙ…Ø§Ø¹', icon: 'ğŸ“', desc: 'Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©' },
                              { value: 'policy_doc', label: 'ÙˆØ«ÙŠÙ‚Ø© Ø³ÙŠØ§Ø³Ø©', icon: 'ğŸ“‹', desc: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©' },
                              { value: 'contract', label: 'Ø¹Ù‚Ø¯/Ø§ØªÙØ§Ù‚ÙŠØ©', icon: 'ğŸ“„', desc: 'Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„Ø§ØªÙØ§Ù‚ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹Ø©' },
                              { value: 'photo', label: 'ØµÙˆØ±Ø© ÙÙˆØªÙˆØºØ±Ø§ÙÙŠØ©', icon: 'ğŸ“·', desc: 'ØµÙˆØ± ØªÙˆØ«ÙŠÙ‚ÙŠØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹' },
                              { value: 'video', label: 'ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ', icon: 'ğŸ¥', desc: 'ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù…ØµÙˆØ±Ø©' },
                              { value: 'email', label: 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', icon: 'ğŸ“§', desc: 'Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø±Ø³Ù…ÙŠØ© Ù…ÙˆØ«Ù‚Ø©' },
                              { value: 'approval', label: 'Ù…ÙˆØ§ÙÙ‚Ø© Ø±Ø³Ù…ÙŠØ©', icon: 'âœ…', desc: 'Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª ÙˆÙ…ÙˆØ§ÙÙ‚Ø§Øª' },
                              { value: 'training_record', label: 'Ø³Ø¬Ù„ ØªØ¯Ø±ÙŠØ¨', icon: 'ğŸ“', desc: 'Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨' },
                            ].map(type => {
                              const isSelected = (formData.evidenceTypes || []).includes(type.value);
                              return (
                                <button key={type.value} type="button" disabled={modalMode === 'view'}
                                  onClick={() => {
                                    if (isSelected) {
                                      setFormData({ ...formData, evidenceTypes: (formData.evidenceTypes || []).filter(t => t !== type.value) });
                                    } else {
                                      setFormData({ ...formData, evidenceTypes: [...(formData.evidenceTypes || []), type.value] });
                                    }
                                  }}
                                  className={`p-3 rounded-xl border-2 text-right transition-all transform hover:scale-[1.02] ${isSelected ? 'bg-teal-50 border-teal-400 shadow-md' : 'bg-white border-slate-200 hover:border-teal-300'
                                    }`}>
                                  <div className="flex items-center gap-3">
                                    <span className="text-2xl">{type.icon}</span>
                                    <div className="flex-1">
                                      <p className={`font-bold text-sm ${isSelected ? 'text-teal-700' : 'text-slate-700'}`}>{type.label}</p>
                                      <p className="text-xs text-slate-500">{type.desc}</p>
                                    </div>
                                    {isSelected && <CheckCircle2 className="w-5 h-5 text-teal-500" />}
                                  </div> </button>);
                            })}
                          </div> </div> </div>
                      <div className="grid grid-cols-3 gap-4">
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-blue-50 px-4 py-3 border-b border-blue-100">
                            <h4 className="font-bold text-blue-700 flex items-center gap-2 text-sm">
                              <Clock className="w-4 h-4" />
                              ÙØªØ±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                            </h4>
                          </div>
                          <div className="p-4">
                            <div className="flex items-center gap-2">
                              <input type="number" min="1" value={formData.evidenceValidityDays || 365}
                                onChange={(e) => setFormData({ ...formData, evidenceValidityDays: parseInt(e.target.value) || 365 })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-center text-2xl font-black disabled:bg-slate-50 focus:border-blue-400" />
                            </div>
                            <p className="text-center text-slate-500 text-sm mt-2">ÙŠÙˆÙ…</p>
                            <div className="flex gap-2 mt-3">
                              {[30, 90, 180, 365].map(days => (
                                <button key={days} type="button" disabled={modalMode === 'view'}
                                  onClick={() => setFormData({ ...formData, evidenceValidityDays: days })}
                                  className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${formData.evidenceValidityDays === days ? 'bg-blue-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                    }`}>
                                  {days}
                                </button>
                              ))}
                            </div> </div> </div>
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-purple-50 px-4 py-3 border-b border-purple-100">
                            <h4 className="font-bold text-purple-700 flex items-center gap-2 text-sm">
                              <Hash className="w-4 h-4" />
                              Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø£Ø¯Ù„Ø©
                            </h4>
                          </div>
                          <div className="p-4">
                            <div className="flex items-center justify-center gap-3">
                              <button type="button" disabled={modalMode === 'view' || (formData.minEvidenceCount || 1) <= 1}
                                onClick={() => setFormData({ ...formData, minEvidenceCount: Math.max(1, (formData.minEvidenceCount || 1) - 1) })}
                                className="w-12 h-12 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-black text-xl disabled:opacity-50">
                                -
                              </button>
                              <span className="text-4xl font-black text-purple-600 w-16 text-center">{formData.minEvidenceCount || 1}</span>
                              <button type="button" disabled={modalMode === 'view'}
                                onClick={() => setFormData({ ...formData, minEvidenceCount: (formData.minEvidenceCount || 1) + 1 })}
                                className="w-12 h-12 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-black text-xl disabled:opacity-50">
                                +
                              </button> </div>
                            <p className="text-center text-slate-500 text-sm mt-2">Ø¯Ù„ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨</p>
                          </div> </div>
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-amber-50 px-4 py-3 border-b border-amber-100">
                            <h4 className="font-bold text-amber-700 flex items-center gap-2 text-sm">
                              <AlertTriangle className="w-4 h-4" />
                              Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
                            </h4>
                          </div>
                          <div className="p-4 space-y-2">
                            {[
                              { value: 'mandatory', label: 'Ø¥Ù„Ø²Ø§Ù…ÙŠ', color: 'red' },
                              { value: 'recommended', label: 'Ù…ÙˆØµÙ‰ Ø¨Ù‡', color: 'amber' },
                              { value: 'optional', label: 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ', color: 'green' },
                            ].map(level => (
                              <button key={level.value} type="button" disabled={modalMode === 'view'}
                                onClick={() => setFormData({ ...formData, evidenceLevel: level.value })}
                                className={`w-full p-2.5 rounded-xl border-2 text-sm font-bold transition-all flex items-center justify-between ${formData.evidenceLevel === level.value ? `bg-${level.color}-50 border-${level.color}-400` : 'bg-white border-slate-200 hover:border-slate-300'
                                  }`}>
                                <span>{level.label}</span>
                                {formData.evidenceLevel === level.value && <CheckCircle2 className={`w-4 h-4 text-${level.color}-500`} />}
                              </button>
                            ))}
                          </div> </div> </div>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-gradient-to-r from-teal-50 to-cyan-50 px-5 py-3 border-b border-teal-100 flex items-center justify-between">
                          <h4 className="font-bold text-teal-700 flex items-center gap-2">
                            <Upload className="w-5 h-5" />
                            Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
                          </h4>
                          <span className="px-3 py-1 bg-teal-500 text-white rounded-full text-sm font-bold">
                            {(formData.attachments || []).length} Ù…Ù„Ù
                          </span> </div>
                        <div className="p-5">
                          <div className={`border-3 border-dashed rounded-2xl p-8 text-center transition-all ${modalMode === 'view' ? 'bg-slate-50 border-slate-200' : 'bg-teal-50/50 border-teal-300 hover:border-teal-400 hover:bg-teal-50 cursor-pointer'
                            }`}>
                            <div className="w-16 h-16 mx-auto rounded-2xl bg-teal-100 flex items-center justify-center mb-4">
                              <Upload className="w-8 h-8 text-teal-600" />
                            </div>
                            <p className="font-bold text-slate-700 mb-1">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„</p>
                            <p className="text-sm text-slate-500">PDF, DOC, DOCX, XLS, XLSX, PNG, JPG, ZIP (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 25MB Ù„ÙƒÙ„ Ù…Ù„Ù)</p>
                            <button type="button" disabled={modalMode === 'view'}
                              onClick={() => {
                                const newAttachment = {
                                  id: Date.now(),
                                  name: `Ù…Ø³ØªÙ†Ø¯_${(formData.attachments || []).length + 1}.pdf`,
                                  size: '2.5 MB', type: 'PDF', uploadedAt: new Date().toLocaleDateString('ar-SA'), uploadedBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ',
                                  status: 'pending'
                                };
                                setFormData({ ...formData, attachments: [...(formData.attachments || []), newAttachment] });
                              }}
                              className="mt-4 px-6 py-2.5 bg-teal-500 text-white rounded-xl font-bold hover:bg-teal-600 disabled:opacity-50 transition-all">
                              <span className="flex items-center gap-2">
                                <Plus className="w-5 h-5" />
                                Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù (Ù…Ø­Ø§ÙƒØ§Ø©)
                              </span> </button> </div>
                          {(formData.attachments || []).length > 0 && (
                            <div className="mt-5 space-y-3">
                              <p className="font-bold text-slate-700">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:</p>
                              {(formData.attachments || []).map((file, idx) => (
                                <div key={file.id || idx} className="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200 hover:border-teal-300 transition-all">
                                  <div className="flex items-center gap-4">
                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${file.type === 'PDF' ? 'bg-red-100 text-red-600' :
                                      file.type === 'DOC' || file.type === 'DOCX' ? 'bg-blue-100 text-blue-600' :
                                        file.type === 'XLS' || file.type === 'XLSX' ? 'bg-green-100 text-green-600' :
                                          'bg-slate-100 text-slate-600'
                                      }`}>
                                      <FileText className="w-6 h-6" />
                                    </div>
                                    <div>
                                      <p className="font-bold text-slate-800">{file.name}</p>
                                      <div className="flex items-center gap-3 text-sm text-slate-500">
                                        <span>{file.size}</span>
                                        <span>â€¢</span>
                                        <span>{file.uploadedAt}</span>
                                        <span>â€¢</span>
                                        <span>{file.uploadedBy}</span>
                                      </div> </div> </div>
                                  <div className="flex items-center gap-2">
                                    <span className={`px-3 py-1 rounded-full text-xs font-bold ${file.status === 'approved' ? 'bg-green-100 text-green-700' :
                                      file.status === 'rejected' ? 'bg-red-100 text-red-700' :
                                        'bg-amber-100 text-amber-700'
                                      }`}>
                                      {file.status === 'approved' ? 'âœ… Ù…Ø¹ØªÙ…Ø¯' : file.status === 'rejected' ? 'âŒ Ù…Ø±ÙÙˆØ¶' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                                    </span>
                                    <button type="button" className="p-2 text-blue-500 hover:bg-blue-50 rounded-lg">
                                      <Eye className="w-5 h-5" />
                                    </button>
                                    <button type="button" className="p-2 text-slate-500 hover:bg-slate-100 rounded-lg">
                                      <Download className="w-5 h-5" />
                                    </button>
                                    {modalMode !== 'view' && (
                                      <button type="button" onClick={() => setFormData({ ...formData, attachments: formData.attachments.filter((_, i) => i !== idx) })}
                                        className="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                                        <Trash2 className="w-5 h-5" />
                                      </button>
                                    )}
                                  </div> </div>
                              ))}
                            </div>
                          )}
                        </div> </div>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                          <h4 className="font-bold text-slate-700 flex items-center gap-2">
                            <BookOpen className="w-5 h-5 text-slate-500" />
                            Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©
                          </h4>
                        </div>
                        <div className="p-4">
                          <textarea value={formData.evidenceInstructions || ''}
                            onChange={(e) => setFormData({ ...formData, evidenceInstructions: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-teal-400 focus:outline-none h-24 resize-none"
                            placeholder="Ø£Ø¯Ø®Ù„ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©... Ù…Ø«Ø§Ù„: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø®ØªÙˆÙ…Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØ¯Ø±Ø© ÙˆÙ…ÙˆÙ‚Ø¹Ø© Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØµ..." />
                        </div> </div>
                      <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                        <h4 className="font-bold mb-4 flex items-center gap-2">
                          <BarChart3 className="w-5 h-5 text-teal-400" />
                          Ù…Ù„Ø®Øµ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø©
                        </h4>
                        <div className="grid grid-cols-5 gap-4">
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl font-black text-teal-400">{(formData.evidenceTypes || []).length}</p>
                            <p className="text-slate-300 text-xs mt-1">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl font-black text-blue-400">{formData.evidenceValidityDays || 365}</p>
                            <p className="text-slate-300 text-xs mt-1">ÙŠÙˆÙ… ØµÙ„Ø§Ø­ÙŠØ©</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl font-black text-purple-400">{formData.minEvidenceCount || 1}</p>
                            <p className="text-slate-300 text-xs mt-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl font-black text-cyan-400">{(formData.attachments || []).length}</p>
                            <p className="text-slate-300 text-xs mt-1">Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙ‚Ø©</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className={`text-3xl font-black ${formData.evidenceLevel === 'mandatory' ? 'text-red-400' :
                              formData.evidenceLevel === 'recommended' ? 'text-amber-400' : 'text-green-400'
                              }`}>
                              {formData.evidenceLevel === 'mandatory' ? 'âš ï¸' : formData.evidenceLevel === 'recommended' ? 'ğŸ“Œ' : 'âœ“'}
                            </p>
                            <p className="text-slate-300 text-xs mt-1">Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©</p>
                          </div> </div> </div>
                    </>
                  )}
                </div>
              )}

              {modalTab === 'schedule' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-blue-600 via-indigo-600 to-violet-600 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <Calendar className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…</h3>
                          <p className="text-blue-200 text-sm">Scheduling & Calendar Management</p>
                        </div> </div>
                      <div className="text-left bg-white/10 rounded-xl px-4 py-2 backdrop-blur">
                        <p className="text-blue-200 text-xs">Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                        <p className="font-bold text-lg">{FREQUENCIES.find(f => f.code === formData.frequency)?.nameAr || 'Ø´Ù‡Ø±ÙŠ'}</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <RefreshCw className="w-5 h-5 text-blue-500" />
                        Ø¯ÙˆØ±ÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø± (Frequency)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-5 gap-3">
                        {[
                          { code: 'Daily', name: 'ÙŠÙˆÙ…ÙŠ', icon: 'ğŸ“…', desc: 'ÙƒÙ„ ÙŠÙˆÙ…', color: 'red' },
                          { code: 'Weekly', name: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', icon: 'ğŸ“†', desc: 'Ù…Ø±Ø© Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', color: 'orange' },
                          { code: 'Monthly', name: 'Ø´Ù‡Ø±ÙŠ', icon: 'ğŸ—“ï¸', desc: 'Ù…Ø±Ø© Ø¨Ø§Ù„Ø´Ù‡Ø±', color: 'blue' },
                          { code: 'Quarterly', name: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', icon: 'ğŸ“Š', desc: 'ÙƒÙ„ 3 Ø£Ø´Ù‡Ø±', color: 'purple' },
                          { code: 'Annually', name: 'Ø³Ù†ÙˆÙŠ', icon: 'ğŸ¯', desc: 'Ù…Ø±Ø© Ø¨Ø§Ù„Ø³Ù†Ø©', color: 'green' },
                          { code: 'Biweekly', name: 'Ù†ØµÙ Ø´Ù‡Ø±ÙŠ', icon: 'ğŸ“‹', desc: 'ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†', color: 'cyan' },
                          { code: 'SemiAnnual', name: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', icon: 'ğŸ“ˆ', desc: 'ÙƒÙ„ 6 Ø£Ø´Ù‡Ø±', color: 'indigo' },
                          { code: 'OnDemand', name: 'Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨', icon: 'âš¡', desc: 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©', color: 'amber' },
                          { code: 'RealTime', name: 'ÙÙˆØ±ÙŠ', icon: 'ğŸ”´', desc: 'Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ…Ø±', color: 'rose' },
                          { code: 'Event', name: 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«', icon: 'ğŸª', desc: 'Ù…Ø±ØªØ¨Ø· Ø¨Ø­Ø¯Ø«', color: 'teal' },
                        ].map(freq => {
                          const isSelected = formData.frequency === freq.code;
                          return (
                            <button key={freq.code} type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, frequency: freq.code })}
                              className={`p-4 rounded-xl border-2 text-center transition-all transform hover:scale-[1.03] ${isSelected
                                ? `bg-${freq.color}-50 border-${freq.color}-400 shadow-lg`
                                : 'bg-white border-slate-200 hover:border-slate-300'
                                }`}>
                              <span className="text-2xl block mb-2">{freq.icon}</span>
                              <p className={`font-bold text-sm ${isSelected ? `text-${freq.color}-700` : 'text-slate-700'}`}>{freq.name}</p>
                              <p className="text-xs text-slate-500 mt-1">{freq.desc}</p>
                              {isSelected && (
                                <div className={`mt-2 w-6 h-6 mx-auto rounded-full bg-${freq.color}-500 flex items-center justify-center`}>
                                  <CheckCircle2 className="w-4 h-4 text-white" />
                                </div>
                              )}
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-indigo-50 px-5 py-3 border-b border-indigo-100">
                      <h4 className="font-bold text-indigo-700 flex items-center gap-2">
                        <Clock className="w-5 h-5" />
                        Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ (Due Rule Builder)
                      </h4>
                    </div>
                    <div className="p-5 space-y-5">
                      <div className="grid grid-cols-4 gap-3">
                        {[
                          { value: 'fixed', label: 'ÙŠÙˆÙ… Ø«Ø§Ø¨Øª', icon: 'ğŸ“Œ', desc: 'ØªØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯ Ø´Ù‡Ø±ÙŠØ§Ù‹/Ø³Ù†ÙˆÙŠØ§Ù‹' },
                          { value: 'relative', label: 'Ù†Ø³Ø¨ÙŠ', icon: 'â†”ï¸', desc: 'Ø¨Ø¹Ø¯ X Ø£ÙŠØ§Ù… Ù…Ù† Ø­Ø¯Ø« Ù…Ø¹ÙŠÙ†' },
                          { value: 'realtime', label: 'ÙÙˆØ±ÙŠ', icon: 'âš¡', desc: 'ÙŠØ¬Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ±Ø§Ù‹' },
                          { value: 'window', label: 'Ù†Ø§ÙØ°Ø© Ø²Ù…Ù†ÙŠØ©', icon: 'ğŸªŸ', desc: 'Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ù…Ø­Ø¯Ø¯Ø©' },
                        ].map(rule => {
                          const isSelected = formData.dueRuleType === rule.value;
                          return (
                            <button key={rule.value} type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, dueRuleType: rule.value })}
                              className={`p-4 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-indigo-50 border-indigo-400' : 'bg-white border-slate-200 hover:border-indigo-300'
                                }`}>
                              <span className="text-2xl">{rule.icon}</span>
                              <p className={`font-bold text-sm mt-2 ${isSelected ? 'text-indigo-700' : 'text-slate-700'}`}>{rule.label}</p>
                              <p className="text-xs text-slate-500 mt-1">{rule.desc}</p>
                            </button>);
                        })}
                      </div>

                      <div className="bg-slate-50 rounded-xl p-4">
                        {formData.dueRuleType === 'fixed' && (
                          <div className="grid grid-cols-3 gap-4">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø±</label>
                              <select value={formData.fixedDay || '1'}
                                onChange={(e) => setFormData({ ...formData, fixedDay: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400">
                                {[...Array(28)].map((_, i) => (
                                  <option key={i + 1} value={i + 1}>Ø§Ù„ÙŠÙˆÙ… {i + 1}</option>
                                ))}
                                <option value="last">Ø¢Ø®Ø± ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø±</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø´Ù‡Ø± (Ù„Ù„Ø³Ù†ÙˆÙŠ)</label>
                              <select value={formData.fixedMonth || ''}
                                onChange={(e) => setFormData({ ...formData, fixedMonth: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400">
                                <option value="">ÙƒÙ„ Ø´Ù‡Ø±</option>
                                <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
                                <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
                                <option value="3">Ù…Ø§Ø±Ø³</option>
                                <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
                                <option value="5">Ù…Ø§ÙŠÙˆ</option>
                                <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
                                <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
                                <option value="8">Ø£ØºØ³Ø·Ø³</option>
                                <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
                                <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
                                <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
                                <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙˆÙ‚Øª</label>
                              <input type="time" value={formData.fixedTime || '17:00'}
                                onChange={(e) => setFormData({ ...formData, fixedTime: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400" />
                            </div> </div>
                        )}

                        {formData.dueRuleType === 'relative' && (
                          <div className="grid grid-cols-3 gap-4">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</label>
                              <select value={formData.relativeEvent || 'period_start'}
                                onChange={(e) => setFormData({ ...formData, relativeEvent: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400">
                                <option value="period_start">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</option>
                                <option value="period_end">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</option>
                                <option value="fiscal_year">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                                <option value="contract_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù‚Ø¯</option>
                                <option value="incident">ÙˆÙ‚ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</option>
                                <option value="request">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…Ø¯Ø©</label>
                              <div className="flex gap-2">
                                <input type="number" min="1" value={formData.dueRuleValue || 5}
                                  onChange={(e) => setFormData({ ...formData, dueRuleValue: parseInt(e.target.value) || 1 })}
                                  disabled={modalMode === 'view'}
                                  className="w-20 px-3 py-3 border-2 border-slate-200 rounded-xl text-center font-bold disabled:bg-white focus:border-indigo-400" />
                                <select value={formData.dueRuleUnit || 'days'}
                                  onChange={(e) => setFormData({ ...formData, dueRuleUnit: e.target.value })}
                                  disabled={modalMode === 'view'}
                                  className="flex-1 px-3 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400">
                                  <option value="hours">Ø³Ø§Ø¹Ø©</option>
                                  <option value="days">ÙŠÙˆÙ…</option>
                                  <option value="weeks">Ø£Ø³Ø¨ÙˆØ¹</option>
                                  <option value="months">Ø´Ù‡Ø±</option>
                                </select>
                              </div> </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø§ØªØ¬Ø§Ù‡</label>
                              <select value={formData.relativeDirection || 'after'}
                                onChange={(e) => setFormData({ ...formData, relativeDirection: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400">
                                <option value="before">Ù‚Ø¨Ù„</option>
                                <option value="after">Ø¨Ø¹Ø¯</option>
                              </select>
                            </div> </div>
                        )}

                        {formData.dueRuleType === 'window' && (
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù†Ø§ÙØ°Ø©</label>
                              <input type="date" value={formData.windowStart || ''}
                                onChange={(e) => setFormData({ ...formData, windowStart: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400" />
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù†Ø§ÙØ°Ø©</label>
                              <input type="date" value={formData.windowEnd || ''}
                                onChange={(e) => setFormData({ ...formData, windowEnd: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-white focus:border-indigo-400" />
                            </div> </div>
                        )}

                        {formData.dueRuleType === 'realtime' && (
                          <div className="text-center py-6">
                            <div className="w-16 h-16 mx-auto rounded-full bg-red-100 flex items-center justify-center mb-3 animate-pulse">
                              <Zap className="w-8 h-8 text-red-500" />
                            </div>
                            <p className="font-bold text-slate-700">Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙˆØ±ÙŠ Ù…Ø·Ù„ÙˆØ¨</p>
                            <p className="text-sm text-slate-500 mt-1">ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙÙˆØ± ÙˆÙ‚ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø« Ø£Ùˆ Ø§Ù„Ù…ØªØ·Ù„Ø¨</p>
                          </div>
                        )}

                        <div className="mt-4 p-4 bg-indigo-100 rounded-xl">
                          <p className="text-sm text-indigo-600 mb-1">ğŸ“‹ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</p>
                          <p className="text-lg font-black text-indigo-700">
                            {formData.dueRuleType === 'fixed' ?
                              `ÙÙŠ Ø§Ù„ÙŠÙˆÙ… ${formData.fixedDay || '1'} ${formData.fixedMonth ? `Ù…Ù† Ø´Ù‡Ø± ${formData.fixedMonth}` : 'Ù…Ù† ÙƒÙ„ Ø´Ù‡Ø±'} Ø§Ù„Ø³Ø§Ø¹Ø© ${formData.fixedTime || '17:00'}` :
                              formData.dueRuleType === 'relative' ?
                                `${formData.dueRuleValue || 5} ${formData.dueRuleUnit === 'hours' ? 'Ø³Ø§Ø¹Ø§Øª' : formData.dueRuleUnit === 'days' ? 'Ø£ÙŠØ§Ù…' : formData.dueRuleUnit === 'weeks' ? 'Ø£Ø³Ø§Ø¨ÙŠØ¹' : 'Ø£Ø´Ù‡Ø±'} ${formData.relativeDirection === 'before' ? 'Ù‚Ø¨Ù„' : 'Ø¨Ø¹Ø¯'} ${formData.relativeEvent === 'period_start' ? 'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©' : formData.relativeEvent === 'period_end' ? 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©' : 'Ø§Ù„Ø­Ø¯Ø«'}` :
                                formData.dueRuleType === 'window' ?
                                  `Ù…Ù† ${formData.windowStart || '...'} Ø¥Ù„Ù‰ ${formData.windowEnd || '...'}` :
                                  'ÙÙˆØ±ÙŠ - ÙŠØ¬Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ° Ø­Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨'}
                          </p> </div> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-amber-50 px-5 py-3 border-b border-amber-100">
                      <h4 className="font-bold text-amber-700 flex items-center gap-2">
                        <Bell className="w-5 h-5" />
                        Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="space-y-3">
                        {[
                          { id: 'reminder1', label: 'ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ 7 Ø£ÙŠØ§Ù…', days: 7, enabled: true },
                          { id: 'reminder2', label: 'ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ 3 Ø£ÙŠØ§Ù…', days: 3, enabled: true },
                          { id: 'reminder3', label: 'ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯', days: 1, enabled: true },
                          { id: 'reminder4', label: 'ØªØ°ÙƒÙŠØ± ÙŠÙˆÙ… Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚', days: 0, enabled: true },
                          { id: 'reminder5', label: 'ØªØ°ÙƒÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ±', days: -1, enabled: false },
                        ].map(reminder => {
                          const isEnabled = (formData.reminders || []).includes(reminder.id) || reminder.enabled;
                          return (
                            <div key={reminder.id} className={`flex items-center justify-between p-3 rounded-xl border-2 transition-all ${isEnabled ? 'bg-amber-50 border-amber-200' : 'bg-white border-slate-200'
                              }`}>
                              <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${isEnabled ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-400'
                                  }`}>
                                  <Bell className="w-5 h-5" />
                                </div>
                                <div>
                                  <p className={`font-bold ${isEnabled ? 'text-amber-700' : 'text-slate-600'}`}>{reminder.label}</p>
                                  <p className="text-xs text-slate-500">
                                    {reminder.days > 0 ? `Ù‚Ø¨Ù„ ${reminder.days} ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯` :
                                      reminder.days === 0 ? 'ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚' : 'ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±'}
                                  </p> </div> </div>
                              <label className="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked={isEnabled}
                                  onChange={(e) => {
                                    const current = formData.reminders || [];
                                    if (e.target.checked) {
                                      setFormData({ ...formData, reminders: [...current, reminder.id] });
                                    } else {
                                      setFormData({ ...formData, reminders: current.filter(r => r !== reminder.id) });
                                    }
                                  }}
                                  disabled={modalMode === 'view'} className="sr-only peer" />
                                <div className="w-12 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500"></div>
                              </label>
                            </div>);
                        })}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-blue-200 overflow-hidden">
                    <div className="bg-gradient-to-r from-blue-500 to-indigo-500 px-5 py-4 text-white">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center">
                            <Zap className="w-6 h-6" />
                          </div>
                          <div>
                            <h4 className="font-bold">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Auto Task Generation)</h4>
                            <p className="text-blue-200 text-sm">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
                          </div> </div>
                        <label className="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" checked={formData.autoTaskGeneration !== false}
                            onChange={(e) => setFormData({ ...formData, autoTaskGeneration: e.target.checked })}
                            disabled={modalMode === 'view'} className="sr-only peer" />
                          <div className="w-16 h-8 bg-white/30 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-emerald-500"></div>
                        </label>
                      </div> </div>
                    {formData.autoTaskGeneration !== false && (
                      <div className="p-5 space-y-4">
                        <div className="grid grid-cols-3 gap-4">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
                            <select value={formData.defaultAssignee || ''}
                              onChange={(e) => setFormData({ ...formData, defaultAssignee: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-blue-400">
                              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„...</option>
                              <option value="compliance_officer">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</option>
                              <option value="department_head">Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                              <option value="it_manager">Ù…Ø¯ÙŠØ± ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                              <option value="risk_manager">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                            <select value={formData.taskPriority || 'medium'}
                              onChange={(e) => setFormData({ ...formData, taskPriority: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-blue-400">
                              <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                              <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                              <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                              <option value="critical">Ø­Ø±Ø¬Ø©</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</label>
                            <select value={formData.taskCreationTime || 'period_start'}
                              onChange={(e) => setFormData({ ...formData, taskCreationTime: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-blue-400">
                              <option value="period_start">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</option>
                              <option value="week_before">Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹</option>
                              <option value="month_before">Ù‚Ø¨Ù„ Ø´Ù‡Ø±</option>
                            </select>
                          </div> </div>
                        <div className="flex items-center gap-3 p-3 bg-blue-50 rounded-xl">
                          <CheckCircle2 className="w-5 h-5 text-blue-500" />
                          <p className="text-sm text-blue-700">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</p>
                        </div> </div>
                    )}
                  </div>

                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                      <BarChart3 className="w-5 h-5 text-blue-400" />
                      Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
                    </h4>
                    <div className="grid grid-cols-5 gap-4">
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ”„</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</p>
                        <p className="font-bold text-sm mt-1">{FREQUENCIES.find(f => f.code === formData.frequency)?.nameAr || 'Ø´Ù‡Ø±ÙŠ'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ“…</p>
                        <p className="text-slate-300 text-xs">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</p>
                        <p className="font-bold text-sm mt-1">
                          {formData.dueRuleType === 'fixed' ? 'ÙŠÙˆÙ… Ø«Ø§Ø¨Øª' :
                            formData.dueRuleType === 'relative' ? 'Ù†Ø³Ø¨ÙŠ' :
                              formData.dueRuleType === 'window' ? 'Ù†Ø§ÙØ°Ø©' : 'ÙÙˆØ±ÙŠ'}
                        </p> </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ””</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</p>
                        <p className="font-bold text-sm mt-1">{(formData.reminders || []).length || 4} ØªØ°ÙƒÙŠØ±</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">{formData.autoTaskGeneration !== false ? 'âš¡' : 'ğŸ”˜'}</p>
                        <p className="text-slate-300 text-xs">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
                        <p className="font-bold text-sm mt-1">{formData.autoTaskGeneration !== false ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ‘¤</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                        <p className="font-bold text-sm mt-1">{formData.defaultAssignee ? 'Ù…Ø­Ø¯Ø¯' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                      </div> </div> </div> </div>
              )}

              {modalTab === 'testing' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-cyan-500 via-teal-500 to-emerald-500 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <ClipboardList className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</h3>
                          <p className="text-cyan-100 text-sm">Compliance Testing Plan</p>
                        </div> </div>
                      <div className="text-left bg-white/10 rounded-xl px-4 py-2 backdrop-blur">
                        <p className="text-cyan-200 text-xs">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                        <p className="font-bold text-lg">{formData.testingRequired !== false ? 'âœ… Ù…Ø·Ù„ÙˆØ¨' : 'â¸ï¸ ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨'}</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="p-5 flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all ${formData.testingRequired !== false ? 'bg-cyan-100' : 'bg-slate-100'
                          }`}>
                          <ClipboardList className={`w-7 h-7 ${formData.testingRequired !== false ? 'text-cyan-600' : 'text-slate-400'}`} />
                        </div>
                        <div>
                          <p className="font-bold text-slate-800 text-lg">Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„ØŸ</p>
                          <p className="text-slate-500 text-sm">ØªÙØ¹ÙŠÙ„ Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¯ÙˆØ±ÙŠØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                        </div> </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked={formData.testingRequired !== false}
                          onChange={(e) => setFormData({ ...formData, testingRequired: e.target.checked })}
                          disabled={modalMode === 'view'} className="sr-only peer" />
                        <div className="w-16 h-8 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-cyan-500 shadow-inner"></div>
                        <span className="mr-3 text-lg font-black text-slate-700">{formData.testingRequired !== false ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</span>
                      </label>
                    </div> </div>
                  {formData.testingRequired !== false && (
                    <>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                          <h4 className="font-bold text-slate-700 flex items-center gap-2">
                            <Settings className="w-5 h-5 text-cyan-500" />
                            Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Test Type)
                          </h4>
                        </div>
                        <div className="p-5">
                          <div className="grid grid-cols-4 gap-4">
                            {[
                              { value: 'manual', label: 'Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ', icon: 'ğŸ‘¤', desc: 'ÙØ­Øµ ÙŠØ¯ÙˆÙŠ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø®ØªØµ', color: 'blue' },
                              { value: 'automated', label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø¢Ù„ÙŠ', icon: 'ğŸ¤–', desc: 'ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', color: 'purple' },
                              { value: 'sampling', label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø¹ÙŠÙ†Ø§Øª', icon: 'ğŸ“Š', desc: 'ÙØ­Øµ Ø¹ÙŠÙ†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©', color: 'amber' },
                              { value: 'walkthrough', label: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: 'ğŸš¶', desc: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©', color: 'green' },
                              { value: 'inspection', label: 'ØªÙØªÙŠØ´ Ù…ÙŠØ¯Ø§Ù†ÙŠ', icon: 'ğŸ”', desc: 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹', color: 'orange' },
                              { value: 'interview', label: 'Ù…Ù‚Ø§Ø¨Ù„Ø§Øª', icon: 'ğŸ¤', desc: 'Ù…Ù‚Ø§Ø¨Ù„Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ù†ÙŠÙŠÙ†', color: 'pink' },
                              { value: 'documentation', label: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ«Ø§Ø¦Ù‚', icon: 'ğŸ“„', desc: 'ÙØ­Øµ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª', color: 'indigo' },
                              { value: 'simulation', label: 'Ù…Ø­Ø§ÙƒØ§Ø©', icon: 'ğŸ®', desc: 'Ø§Ø®ØªØ¨Ø§Ø± Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', color: 'rose' },
                            ].map(test => {
                              const isSelected = formData.testType === test.value;
                              return (
                                <button key={test.value} type="button" disabled={modalMode === 'view'}
                                  onClick={() => setFormData({ ...formData, testType: test.value })}
                                  className={`p-4 rounded-xl border-2 text-center transition-all transform hover:scale-[1.02] ${isSelected
                                    ? `bg-${test.color}-50 border-${test.color}-400 shadow-lg`
                                    : 'bg-white border-slate-200 hover:border-slate-300'
                                    }`}>
                                  <span className="text-3xl block mb-2">{test.icon}</span>
                                  <p className={`font-bold text-sm ${isSelected ? `text-${test.color}-700` : 'text-slate-700'}`}>{test.label}</p>
                                  <p className="text-xs text-slate-500 mt-1">{test.desc}</p>
                                  {isSelected && (
                                    <div className={`mt-2 w-6 h-6 mx-auto rounded-full bg-${test.color}-500 flex items-center justify-center`}>
                                      <CheckCircle2 className="w-4 h-4 text-white" />
                                    </div>
                                  )}
                                </button>);
                            })}
                          </div> </div> </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-indigo-50 px-5 py-3 border-b border-indigo-100">
                            <h4 className="font-bold text-indigo-700 flex items-center gap-2">
                              <RefreshCw className="w-5 h-5" />
                              Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                            </h4>
                          </div>
                          <div className="p-4">
                            <div className="grid grid-cols-2 gap-2">
                              {[
                                { value: 'Monthly', label: 'Ø´Ù‡Ø±ÙŠ', icon: 'ğŸ“…' },
                                { value: 'Quarterly', label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', icon: 'ğŸ“Š' },
                                { value: 'SemiAnnual', label: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', icon: 'ğŸ“ˆ' },
                                { value: 'Annual', label: 'Ø³Ù†ÙˆÙŠ', icon: 'ğŸ¯' },
                              ].map(freq => {
                                const isSelected = formData.testFrequency === freq.value;
                                return (
                                  <button key={freq.value} type="button" disabled={modalMode === 'view'}
                                    onClick={() => setFormData({ ...formData, testFrequency: freq.value })}
                                    className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-indigo-50 border-indigo-400' : 'bg-white border-slate-200 hover:border-indigo-300'
                                      }`}>
                                    <span className="text-xl">{freq.icon}</span>
                                    <p className={`font-bold text-sm mt-1 ${isSelected ? 'text-indigo-700' : 'text-slate-600'}`}>{freq.label}</p>
                                  </button>);
                              })}
                            </div> </div> </div>
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-purple-50 px-5 py-3 border-b border-purple-100">
                            <h4 className="font-bold text-purple-700 flex items-center gap-2">
                              <Target className="w-5 h-5" />
                              Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©
                            </h4>
                          </div>
                          <div className="p-4 space-y-3">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                              <div className="flex items-center gap-3">
                                <input type="range" min="5" max="100" step="5"
                                  value={formData.sampleSize || 25}
                                  onChange={(e) => setFormData({ ...formData, sampleSize: parseInt(e.target.value) })}
                                  disabled={modalMode === 'view'}
                                  className="flex-1 h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer" />
                                <span className="w-16 text-center text-xl font-black text-purple-600">{formData.sampleSize || 25}%</span>
                              </div> </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹ÙŠÙ†Ø§Øª</label>
                              <input type="number" min="1" value={formData.minSamples || 5}
                                onChange={(e) => setFormData({ ...formData, minSamples: parseInt(e.target.value) })}
                                disabled={modalMode === 'view'}
                                className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-purple-400" />
                            </div> </div> </div> </div>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-teal-50 px-5 py-3 border-b border-teal-100 flex items-center justify-between">
                          <h4 className="font-bold text-teal-700 flex items-center gap-2">
                            <ListChecks className="w-5 h-5" />
                            Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Test Criteria)
                          </h4>
                          <span className="px-3 py-1 bg-teal-500 text-white rounded-full text-sm font-bold">
                            {(formData.testCriteria || []).length} Ù…Ø¹ÙŠØ§Ø±
                          </span> </div>
                        <div className="p-5">
                          <div className="grid grid-cols-3 gap-3 mb-4">
                            {[
                              { id: 'completeness', label: 'Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„', icon: 'âœ…', desc: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø³ØªÙˆÙØ§Ø©' },
                              { id: 'accuracy', label: 'Ø§Ù„Ø¯Ù‚Ø©', icon: 'ğŸ¯', desc: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø©' },
                              { id: 'timeliness', label: 'Ø§Ù„ØªÙˆÙ‚ÙŠØª', icon: 'â°', desc: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯' },
                              { id: 'authorization', label: 'Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', icon: 'ğŸ”', desc: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' },
                              { id: 'documentation', label: 'Ø§Ù„ØªÙˆØ«ÙŠÙ‚', icon: 'ğŸ“‹', desc: 'Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©' },
                              { id: 'effectiveness', label: 'Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©', icon: 'ğŸ“Š', desc: 'ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù' },
                            ].map(criteria => {
                              const isSelected = (formData.testCriteria || []).includes(criteria.id);
                              return (
                                <button key={criteria.id} type="button" disabled={modalMode === 'view'}
                                  onClick={() => {
                                    if (isSelected) {
                                      setFormData({ ...formData, testCriteria: (formData.testCriteria || []).filter(c => c !== criteria.id) });
                                    } else {
                                      setFormData({ ...formData, testCriteria: [...(formData.testCriteria || []), criteria.id] });
                                    }
                                  }}
                                  className={`p-3 rounded-xl border-2 text-right transition-all ${isSelected ? 'bg-teal-50 border-teal-400' : 'bg-white border-slate-200 hover:border-teal-300'
                                    }`}>
                                  <div className="flex items-center gap-2">
                                    <span className="text-xl">{criteria.icon}</span>
                                    <div>
                                      <p className={`font-bold text-sm ${isSelected ? 'text-teal-700' : 'text-slate-700'}`}>{criteria.label}</p>
                                      <p className="text-xs text-slate-500">{criteria.desc}</p>
                                    </div>
                                    {isSelected && <CheckCircle2 className="w-5 h-5 text-teal-500 mr-auto" />}
                                  </div> </button>);
                            })}
                          </div> </div> </div>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-amber-50 px-5 py-3 border-b border-amber-100">
                          <h4 className="font-bold text-amber-700 flex items-center gap-2">
                            <FileText className="w-5 h-5" />
                            Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                          </h4>
                        </div>
                        <div className="p-5 space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                            <select value={formData.testTemplate || ''}
                              onChange={(e) => setFormData({ ...formData, testTemplate: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400">
                              <option value="">Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</option>
                              <option value="soc2_template">SOC 2 Testing Template</option>
                              <option value="iso27001_template">ISO 27001 Audit Checklist</option>
                              <option value="pci_template">PCI DSS Testing Procedures</option>
                              <option value="gdpr_template">GDPR Compliance Checklist</option>
                              <option value="custom">Ù‚Ø§Ù„Ø¨ Ù…Ø®ØµØµ</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                            <textarea value={formData.testProcedure || ''}
                              onChange={(e) => setFormData({ ...formData, testProcedure: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400 h-28 resize-none"
                              placeholder="1. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª - 2. ÙØ­Øµ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª - 3. Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† - 4. ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª" />
                          </div> </div> </div>
                      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                        <div className="bg-blue-50 px-5 py-3 border-b border-blue-100">
                          <h4 className="font-bold text-blue-700 flex items-center gap-2">
                            <Users className="w-5 h-5" />
                            ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                          </h4>
                        </div>
                        <div className="p-5">
                          <div className="grid grid-cols-3 gap-4">
                            <div className="bg-slate-50 rounded-xl p-4">
                              <div className="flex items-center gap-3 mb-3">
                                <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                  <User className="w-5 h-5 text-blue-600" />
                                </div>
                                <div>
                                  <p className="text-xs text-slate-500">Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                                  <p className="font-bold text-slate-700">Test Lead</p>
                                </div> </div>
                              <input type="text" value={formData.testLead || ''}
                                onChange={(e) => setFormData({ ...formData, testLead: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm disabled:bg-white focus:border-blue-400"
                                placeholder="Ø§Ø³Ù… Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±" />
                            </div>

                            <div className="bg-slate-50 rounded-xl p-4">
                              <div className="flex items-center gap-3 mb-3">
                                <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                                  <Users className="w-5 h-5 text-purple-600" />
                                </div>
                                <div>
                                  <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙˆÙ†</p>
                                  <p className="font-bold text-slate-700">Testers</p>
                                </div> </div>
                              <input type="text" value={formData.testers || ''}
                                onChange={(e) => setFormData({ ...formData, testers: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm disabled:bg-white focus:border-purple-400"
                                placeholder="Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙŠÙ†" />
                            </div>

                            <div className="bg-slate-50 rounded-xl p-4">
                              <div className="flex items-center gap-3 mb-3">
                                <div className="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center">
                                  <CheckCircle2 className="w-5 h-5 text-emerald-600" />
                                </div>
                                <div>
                                  <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</p>
                                  <p className="font-bold text-slate-700">Reviewer</p>
                                </div> </div>
                              <input type="text" value={formData.testReviewer || ''}
                                onChange={(e) => setFormData({ ...formData, testReviewer: e.target.value })}
                                disabled={modalMode === 'view'}
                                className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm disabled:bg-white focus:border-emerald-400"
                                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹" />
                            </div> </div> </div> </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-emerald-50 px-5 py-3 border-b border-emerald-100">
                            <h4 className="font-bold text-emerald-700 flex items-center gap-2">
                              <CheckCircle2 className="w-5 h-5" />
                              Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­
                            </h4>
                          </div>
                          <div className="p-4 space-y-3">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                              <div className="flex items-center gap-3">
                                <input type="range" min="50" max="100" step="5"
                                  value={formData.passThreshold || 80}
                                  onChange={(e) => setFormData({ ...formData, passThreshold: parseInt(e.target.value) })}
                                  disabled={modalMode === 'view'}
                                  className="flex-1 h-2 bg-emerald-200 rounded-lg appearance-none cursor-pointer" />
                                <span className={`w-16 text-center text-xl font-black ${(formData.passThreshold || 80) >= 90 ? 'text-emerald-600' :
                                  (formData.passThreshold || 80) >= 70 ? 'text-amber-600' : 'text-red-600'
                                  }`}>{formData.passThreshold || 80}%</span>
                              </div> </div>
                            <div className="p-3 bg-emerald-50 rounded-xl">
                              <p className="text-sm text-emerald-700">
                                âœ… ÙŠØ¹ØªØ¨Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§Ø¬Ø­Ø§Ù‹ Ø¥Ø°Ø§ ØªØ­Ù‚Ù‚ {formData.passThreshold || 80}% Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±
                              </p> </div> </div> </div>
                        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                          <div className="bg-red-50 px-5 py-3 border-b border-red-100">
                            <h4 className="font-bold text-red-700 flex items-center gap-2">
                              <AlertTriangle className="w-5 h-5" />
                              Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙØ´Ù„
                            </h4>
                          </div>
                          <div className="p-4 space-y-2">
                            {[
                              { id: 'escalate', label: 'ØªØµØ¹ÙŠØ¯ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©', icon: 'ğŸ“¢' },
                              { id: 'remediate', label: 'Ø®Ø·Ø© Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: 'ğŸ”§' },
                              { id: 'retest', label: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: 'ğŸ”„' },
                              { id: 'document', label: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù', icon: 'ğŸ“' },
                            ].map(action => {
                              const isSelected = (formData.failureActions || []).includes(action.id);
                              return (
                                <button key={action.id} type="button" disabled={modalMode === 'view'}
                                  onClick={() => {
                                    if (isSelected) {
                                      setFormData({ ...formData, failureActions: (formData.failureActions || []).filter(a => a !== action.id) });
                                    } else {
                                      setFormData({ ...formData, failureActions: [...(formData.failureActions || []), action.id] });
                                    }
                                  }}
                                  className={`w-full p-2.5 rounded-xl border-2 text-right transition-all flex items-center gap-2 ${isSelected ? 'bg-red-50 border-red-300' : 'bg-white border-slate-200 hover:border-red-200'
                                    }`}>
                                  <span>{action.icon}</span>
                                  <span className={`font-bold text-sm ${isSelected ? 'text-red-700' : 'text-slate-600'}`}>{action.label}</span>
                                  {isSelected && <CheckCircle2 className="w-4 h-4 text-red-500 mr-auto" />}
                                </button>);
                            })}
                          </div> </div> </div>
                      <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                        <h4 className="font-bold mb-4 flex items-center gap-2">
                          <BarChart3 className="w-5 h-5 text-cyan-400" />
                          Ù…Ù„Ø®Øµ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </h4>
                        <div className="grid grid-cols-5 gap-4">
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl mb-2">
                              {formData.testType === 'manual' ? 'ğŸ‘¤' :
                                formData.testType === 'automated' ? 'ğŸ¤–' :
                                  formData.testType === 'sampling' ? 'ğŸ“Š' : 'ğŸ”'}
                            </p>
                            <p className="text-slate-300 text-xs">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                            <p className="font-bold text-sm mt-1">
                              {formData.testType === 'manual' ? 'ÙŠØ¯ÙˆÙŠ' :
                                formData.testType === 'automated' ? 'Ø¢Ù„ÙŠ' :
                                  formData.testType === 'sampling' ? 'Ø¹ÙŠÙ†Ø§Øª' : 'Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                            </p> </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl mb-2">ğŸ”„</p>
                            <p className="text-slate-300 text-xs">Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</p>
                            <p className="font-bold text-sm mt-1">
                              {formData.testFrequency === 'Monthly' ? 'Ø´Ù‡Ø±ÙŠ' :
                                formData.testFrequency === 'Quarterly' ? 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ' :
                                  formData.testFrequency === 'SemiAnnual' ? 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ' : 'Ø³Ù†ÙˆÙŠ'}
                            </p> </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl mb-2">ğŸ“Š</p>
                            <p className="text-slate-300 text-xs">Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</p>
                            <p className="font-bold text-sm mt-1">{formData.sampleSize || 25}%</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl mb-2">âœ…</p>
                            <p className="text-slate-300 text-xs">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­</p>
                            <p className="font-bold text-sm mt-1">{formData.passThreshold || 80}%</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                            <p className="text-3xl mb-2">ğŸ“‹</p>
                            <p className="text-slate-300 text-xs">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</p>
                            <p className="font-bold text-sm mt-1">{(formData.testCriteria || []).length} Ù…Ø¹ÙŠØ§Ø±</p>
                          </div> </div> </div>
                    </>
                  )}
                </div>
              )}

              {modalTab === 'enforcement' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-red-600 via-rose-600 to-pink-600 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <AlertTriangle className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ø° ÙˆÙ…Ø­ÙØ²Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚</h3>
                          <p className="text-red-200 text-sm">Enforcement Rules & Breach Triggers</p>
                        </div> </div>
                      <div className="text-left bg-white/10 rounded-xl px-4 py-2 backdrop-blur">
                        <p className="text-red-200 text-xs">Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©</p>
                        <p className="font-bold text-2xl">
                          {[formData.breachOnOverdue, formData.breachOnRejection, formData.breachOnMissing, formData.breachOnFailed, formData.autoEscalate].filter(Boolean).length} / 5
                        </p> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-red-50 px-5 py-3 border-b border-red-100">
                      <h4 className="font-bold text-red-700 flex items-center gap-2">
                        <Zap className="w-5 h-5" />
                        Ù…Ø­ÙØ²Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Auto Breach Triggers)
                      </h4>
                    </div>
                    <div className="p-5 space-y-4">
                      <div className={`p-4 rounded-xl border-2 transition-all ${formData.breachOnOverdue ? 'bg-red-50 border-red-300' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <button type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, breachOnOverdue: !formData.breachOnOverdue })}
                              className={`w-14 h-14 rounded-xl flex items-center justify-center text-2xl transition-all ${formData.breachOnOverdue ? 'bg-red-500 text-white shadow-lg' : 'bg-slate-100'
                                }`}>
                              {formData.breachOnOverdue ? 'ğŸš¨' : 'â°'}
                            </button>
                            <div>
                              <p className="font-bold text-slate-800 text-lg">Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®Ø±</p>
                              <p className="text-sm text-slate-500">Overdue â†’ Critical Breach</p>
                              <p className="text-xs text-slate-400 mt-1">ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ø§Ø®ØªØ±Ø§Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®Ø±</p>
                            </div> </div>
                          <div className="flex items-center gap-3">
                            <div className="text-center">
                              <p className="text-xs text-slate-500 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</p>
                              <div className="flex items-center gap-2">
                                <button type="button" disabled={modalMode === 'view' || !formData.breachOnOverdue}
                                  onClick={() => setFormData({ ...formData, overdueThreshold: Math.max(0, (formData.overdueThreshold || 0) - 1) })}
                                  className="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-bold disabled:opacity-50">-</button>
                                <span className={`w-12 h-10 flex items-center justify-center rounded-xl font-black text-xl ${formData.breachOnOverdue ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-400'
                                  }`}>{formData.overdueThreshold || 0}</span>
                                <button type="button" disabled={modalMode === 'view' || !formData.breachOnOverdue}
                                  onClick={() => setFormData({ ...formData, overdueThreshold: (formData.overdueThreshold || 0) + 1 })}
                                  className="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-bold disabled:opacity-50">+</button>
                              </div> </div>
                            <label className="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" checked={formData.breachOnOverdue || false}
                                onChange={(e) => setFormData({ ...formData, breachOnOverdue: e.target.checked })}
                                disabled={modalMode === 'view'} className="sr-only peer" />
                              <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-red-500"></div>
                            </label>
                          </div> </div> </div>
                      <div className={`p-4 rounded-xl border-2 transition-all ${formData.breachOnRejection ? 'bg-orange-50 border-orange-300' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <button type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, breachOnRejection: !formData.breachOnRejection })}
                              className={`w-14 h-14 rounded-xl flex items-center justify-center text-2xl transition-all ${formData.breachOnRejection ? 'bg-orange-500 text-white shadow-lg' : 'bg-slate-100'
                                }`}>
                              {formData.breachOnRejection ? 'âŒ' : 'ğŸ“‹'}
                            </button>
                            <div>
                              <p className="font-bold text-slate-800 text-lg">ØªØµØ¹ÙŠØ¯ Ø¹Ù†Ø¯ Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                              <p className="text-sm text-slate-500">Evidence Rejected â†’ Escalate</p>
                              <p className="text-xs text-slate-400 mt-1">Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø±ÙØ¶ Ø§Ù„Ø£Ø¯Ù„Ø© Ø¹Ø¯Ø© Ù…Ø±Ø§Øª</p>
                            </div> </div>
                          <div className="flex items-center gap-3">
                            <div className="text-center">
                              <p className="text-xs text-slate-500 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª</p>
                              <div className="flex items-center gap-2">
                                <button type="button" disabled={modalMode === 'view' || !formData.breachOnRejection}
                                  onClick={() => setFormData({ ...formData, rejectionThreshold: Math.max(1, (formData.rejectionThreshold || 2) - 1) })}
                                  className="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-bold disabled:opacity-50">-</button>
                                <span className={`w-12 h-10 flex items-center justify-center rounded-xl font-black text-xl ${formData.breachOnRejection ? 'bg-orange-100 text-orange-700' : 'bg-slate-100 text-slate-400'
                                  }`}>{formData.rejectionThreshold || 2}</span>
                                <button type="button" disabled={modalMode === 'view' || !formData.breachOnRejection}
                                  onClick={() => setFormData({ ...formData, rejectionThreshold: (formData.rejectionThreshold || 2) + 1 })}
                                  className="w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center font-bold disabled:opacity-50">+</button>
                              </div> </div>
                            <label className="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" checked={formData.breachOnRejection || false}
                                onChange={(e) => setFormData({ ...formData, breachOnRejection: e.target.checked })}
                                disabled={modalMode === 'view'} className="sr-only peer" />
                              <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-orange-500"></div>
                            </label>
                          </div> </div> </div>
                      <div className={`p-4 rounded-xl border-2 transition-all ${formData.breachOnMissing ? 'bg-purple-50 border-purple-300' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <button type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, breachOnMissing: !formData.breachOnMissing })}
                              className={`w-14 h-14 rounded-xl flex items-center justify-center text-2xl transition-all ${formData.breachOnMissing ? 'bg-purple-500 text-white shadow-lg' : 'bg-slate-100'
                                }`}>
                              {formData.breachOnMissing ? 'ğŸ“­' : 'ğŸ“„'}
                            </button>
                            <div>
                              <p className="font-bold text-slate-800 text-lg">Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ ÙÙ‚Ø¯ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                              <p className="text-sm text-slate-500">Missing Evidence â†’ Auto Breach</p>
                              <p className="text-xs text-slate-400 mt-1">ØªØ³Ø¬ÙŠÙ„ Ø§Ø®ØªØ±Ø§Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                            </div> </div>
                          <label className="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" checked={formData.breachOnMissing || false}
                              onChange={(e) => setFormData({ ...formData, breachOnMissing: e.target.checked })}
                              disabled={modalMode === 'view'} className="sr-only peer" />
                            <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-500"></div>
                          </label>
                        </div> </div>
                      <div className={`p-4 rounded-xl border-2 transition-all ${formData.breachOnFailed ? 'bg-rose-50 border-rose-300' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <button type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, breachOnFailed: !formData.breachOnFailed })}
                              className={`w-14 h-14 rounded-xl flex items-center justify-center text-2xl transition-all ${formData.breachOnFailed ? 'bg-rose-500 text-white shadow-lg' : 'bg-slate-100'
                                }`}>
                              {formData.breachOnFailed ? 'ğŸ”´' : 'âœ…'}
                            </button>
                            <div>
                              <p className="font-bold text-slate-800 text-lg">Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                              <p className="text-sm text-slate-500">Failed Test â†’ Breach</p>
                              <p className="text-xs text-slate-400 mt-1">ØªØ³Ø¬ÙŠÙ„ Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                            </div> </div>
                          <label className="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" checked={formData.breachOnFailed || false}
                              onChange={(e) => setFormData({ ...formData, breachOnFailed: e.target.checked })}
                              disabled={modalMode === 'view'} className="sr-only peer" />
                            <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-rose-500"></div>
                          </label>
                        </div> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-amber-50 px-5 py-3 border-b border-amber-100">
                      <h4 className="font-bold text-amber-700 flex items-center gap-2">
                        <ArrowUpCircle className="w-5 h-5" />
                        Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯ (Escalation Rules)
                      </h4>
                    </div>
                    <div className="p-5 space-y-4">
                      <div className={`p-4 rounded-xl border-2 transition-all ${formData.autoEscalate ? 'bg-amber-50 border-amber-300' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center gap-4">
                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl ${formData.autoEscalate ? 'bg-amber-500 text-white' : 'bg-slate-100'
                              }`}>
                              {formData.autoEscalate ? 'ğŸ“¢' : 'ğŸ”•'}
                            </div>
                            <div>
                              <p className="font-bold text-slate-800">Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
                              <p className="text-sm text-slate-500">Auto Escalation Enabled</p>
                            </div> </div>
                          <label className="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" checked={formData.autoEscalate || false}
                              onChange={(e) => setFormData({ ...formData, autoEscalate: e.target.checked })}
                              disabled={modalMode === 'view'} className="sr-only peer" />
                            <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-amber-500"></div>
                          </label>
                        </div>

                        {formData.autoEscalate && (
                          <div className="space-y-4 pt-4 border-t border-amber-200">
                            <div>
                              <p className="text-sm font-bold text-slate-700 mb-3">Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªØµØ¹ÙŠØ¯:</p>
                              <div className="flex items-center gap-2">
                                {[
                                  { level: 1, role: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', time: '24 Ø³Ø§Ø¹Ø©', icon: 'ğŸ‘¤' },
                                  { level: 2, role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', time: '48 Ø³Ø§Ø¹Ø©', icon: 'ğŸ‘”' },
                                  { level: 3, role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', time: '72 Ø³Ø§Ø¹Ø©', icon: 'ğŸ¯' },
                                  { level: 4, role: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§', time: '96 Ø³Ø§Ø¹Ø©', icon: 'ğŸ‘‘' },
                                ].map((item, idx) => (
                                  <React.Fragment key={item.level}>
                                    <div className="flex-1 bg-white rounded-xl p-3 border-2 border-amber-200 text-center">
                                      <span className="text-2xl block mb-1">{item.icon}</span>
                                      <p className="text-xs font-bold text-slate-700">{item.role}</p>
                                      <p className="text-xs text-amber-600">{item.time}</p>
                                    </div>
                                    {idx < 3 && <ChevronLeft className="w-5 h-5 text-amber-400" />}
                                  </React.Fragment>
                                ))}
                              </div> </div>
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <label className="block text-xs font-bold text-slate-600 mb-1">ÙˆÙ‚Øª Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„</label>
                                <select value={formData.firstEscalationHours || '24'}
                                  onChange={(e) => setFormData({ ...formData, firstEscalationHours: e.target.value })}
                                  disabled={modalMode === 'view'}
                                  className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400">
                                  <option value="12">12 Ø³Ø§Ø¹Ø©</option>
                                  <option value="24">24 Ø³Ø§Ø¹Ø©</option>
                                  <option value="48">48 Ø³Ø§Ø¹Ø©</option>
                                  <option value="72">72 Ø³Ø§Ø¹Ø©</option>
                                </select>
                              </div>
                              <div>
                                <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØµØ¹ÙŠØ¯Ø§Øª</label>
                                <select value={formData.escalationInterval || '24'}
                                  onChange={(e) => setFormData({ ...formData, escalationInterval: e.target.value })}
                                  disabled={modalMode === 'view'}
                                  className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-amber-400">
                                  <option value="12">12 Ø³Ø§Ø¹Ø©</option>
                                  <option value="24">24 Ø³Ø§Ø¹Ø©</option>
                                  <option value="48">48 Ø³Ø§Ø¹Ø©</option>
                                </select>
                              </div> </div> </div>
                        )}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-blue-50 px-5 py-3 border-b border-blue-100">
                      <h4 className="font-bold text-blue-700 flex items-center gap-2">
                        <Bell className="w-5 h-5" />
                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Notification Settings)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-2 gap-4">
                        {[
                          { id: 'notifyOwner', label: 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', desc: 'Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', icon: 'ğŸ‘¤', color: 'blue' },
                          { id: 'notifyManager', label: 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ±', desc: 'Ø¹Ù†Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯', icon: 'ğŸ‘”', color: 'indigo' },
                          { id: 'notifyCompliance', label: 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', desc: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª', icon: 'ğŸ¯', color: 'purple' },
                          { id: 'notifyExternal', label: 'Ø¥Ø´Ø¹Ø§Ø± Ø®Ø§Ø±Ø¬ÙŠ', desc: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: 'ğŸ›ï¸', color: 'red' },
                        ].map(item => {
                          const isEnabled = formData[item.id];
                          return (
                            <button key={item.id} type="button" disabled={modalMode === 'view'}
                              onClick={() => setFormData({ ...formData, [item.id]: !formData[item.id] })}
                              className={`p-4 rounded-xl border-2 text-right transition-all ${isEnabled ? `bg-${item.color}-50 border-${item.color}-300` : 'bg-white border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-center gap-3">
                                <span className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl ${isEnabled ? `bg-${item.color}-500 text-white` : 'bg-slate-100'
                                  }`}>{item.icon}</span>
                                <div className="flex-1">
                                  <p className={`font-bold ${isEnabled ? `text-${item.color}-700` : 'text-slate-700'}`}>{item.label}</p>
                                  <p className="text-xs text-slate-500">{item.desc}</p>
                                </div>
                                {isEnabled && <CheckCircle2 className={`w-6 h-6 text-${item.color}-500`} />}
                              </div> </button>);
                        })}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-emerald-50 px-5 py-3 border-b border-emerald-100">
                      <h4 className="font-bold text-emerald-700 flex items-center gap-2">
                        <Settings className="w-5 h-5" />
                        Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (Remediation Actions)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="grid grid-cols-3 gap-3">
                        {[
                          { id: 'autoCreateTask', label: 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…Ø© Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: 'ğŸ“‹' },
                          { id: 'requireRCA', label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ', icon: 'ğŸ”' },
                          { id: 'requireActionPlan', label: 'Ø®Ø·Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØµØ­ÙŠØ­ÙŠØ©', icon: 'ğŸ“' },
                          { id: 'requireApproval', label: 'Ù…ÙˆØ§ÙÙ‚Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚', icon: 'âœ…' },
                          { id: 'documentEvidence', label: 'ØªÙˆØ«ÙŠÙ‚ Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: 'ğŸ“' },
                          { id: 'scheduleRetest', label: 'Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: 'ğŸ”„' },
                        ].map(action => {
                          const isSelected = (formData.remediationActions || []).includes(action.id);
                          return (
                            <button key={action.id} type="button" disabled={modalMode === 'view'}
                              onClick={() => {
                                if (isSelected) {
                                  setFormData({ ...formData, remediationActions: (formData.remediationActions || []).filter(a => a !== action.id) });
                                } else {
                                  setFormData({ ...formData, remediationActions: [...(formData.remediationActions || []), action.id] });
                                }
                              }}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-emerald-50 border-emerald-400' : 'bg-white border-slate-200 hover:border-emerald-300'
                                }`}>
                              <span className="text-2xl block mb-1">{action.icon}</span>
                              <p className={`text-sm font-bold ${isSelected ? 'text-emerald-700' : 'text-slate-600'}`}>{action.label}</p>
                              {isSelected && <CheckCircle2 className="w-4 h-4 text-emerald-500 mx-auto mt-1" />}
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                      <BarChart3 className="w-5 h-5 text-red-400" />
                      Ù…Ù„Ø®Øµ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ø°
                    </h4>
                    <div className="grid grid-cols-5 gap-4">
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸš¨</p>
                        <p className="text-slate-300 text-xs">Ù…Ø­ÙØ²Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚</p>
                        <p className="font-bold text-lg mt-1">
                          {[formData.breachOnOverdue, formData.breachOnRejection, formData.breachOnMissing, formData.breachOnFailed].filter(Boolean).length}
                        </p> </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">{formData.autoEscalate ? 'ğŸ“¢' : 'ğŸ”•'}</p>
                        <p className="text-slate-300 text-xs">Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
                        <p className="font-bold text-lg mt-1">{formData.autoEscalate ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ””</p>
                        <p className="text-slate-300 text-xs">Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</p>
                        <p className="font-bold text-lg mt-1">
                          {[formData.notifyOwner, formData.notifyManager, formData.notifyCompliance, formData.notifyExternal].filter(Boolean).length}
                        </p> </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">ğŸ”§</p>
                        <p className="text-slate-300 text-xs">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                        <p className="font-bold text-lg mt-1">{(formData.remediationActions || []).length}</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-3xl mb-2">â±ï¸</p>
                        <p className="text-slate-300 text-xs">Ø£ÙˆÙ„ ØªØµØ¹ÙŠØ¯</p>
                        <p className="font-bold text-lg mt-1">{formData.firstEscalationHours || 24}h</p>
                      </div> </div> </div> </div>
              )}

              {modalTab === 'impact' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl p-5 text-white">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                          <Scale className="w-7 h-7" />
                        </div>
                        <div>
                          <h3 className="text-xl font-black">Ø§Ù„ØªØ£Ø«ÙŠØ± ÙˆØ§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</h3>
                          <p className="text-orange-100 text-sm">Impact & Regulatory Exposure Assessment</p>
                        </div> </div>
                      <div className="text-left">
                        <p className="text-orange-200 text-xs">Risk Score</p>
                        <p className="text-4xl font-black">{((formData.impactLevel || 3) * 2) + ((formData.exposureTypes || []).length * 1.5)}</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <TrendingUp className="w-5 h-5 text-orange-500" />
                        Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ£Ø«ÙŠØ± (Impact Level)
                      </h4>
                    </div>
                    <div className="p-5">
                      <div className="flex items-center gap-6">
                        <div className="flex-1">
                          <div className="flex justify-between mb-2">
                            {[1, 2, 3, 4, 5].map(level => (
                              <button key={level} type="button" disabled={modalMode === 'view'}
                                onClick={() => setFormData({ ...formData, impactLevel: level })}
                                className={`w-16 h-16 rounded-2xl font-black text-xl transition-all transform hover:scale-110 ${(formData.impactLevel || 3) === level
                                  ? level >= 4 ? 'bg-red-500 text-white shadow-lg shadow-red-500/50 scale-110' :
                                    level >= 3 ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/50 scale-110' :
                                      'bg-emerald-500 text-white shadow-lg shadow-emerald-500/50 scale-110'
                                  : 'bg-slate-100 text-slate-400 hover:bg-slate-200'
                                  }`}>
                                {level}
                              </button>
                            ))}
                          </div>
                          <div className="flex justify-between text-xs font-bold mt-3">
                            <span className="text-emerald-600">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹</span>
                            <span className="text-emerald-500">Ù…Ù†Ø®ÙØ¶</span>
                            <span className="text-amber-500">âš ï¸ Ù…ØªÙˆØ³Ø·</span>
                            <span className="text-orange-500">Ø¹Ø§Ù„ÙŠ</span>
                            <span className="text-red-600">ğŸ”´ Ø­Ø±Ø¬</span>
                          </div>
                          <div className="mt-4 h-3 bg-slate-200 rounded-full overflow-hidden">
                            <div className={`h-full transition-all duration-500 rounded-full ${(formData.impactLevel || 3) >= 4 ? 'bg-gradient-to-r from-orange-500 to-red-500' :
                              (formData.impactLevel || 3) >= 3 ? 'bg-gradient-to-r from-amber-400 to-amber-500' :
                                'bg-gradient-to-r from-emerald-400 to-emerald-500'
                              }`} style={{ width: `${((formData.impactLevel || 3) / 5) * 100}%` }} />
                          </div> </div>
                        <div className={`w-48 p-4 rounded-2xl text-center transition-all ${(formData.impactLevel || 3) >= 4 ? 'bg-red-50 border-2 border-red-300' :
                          (formData.impactLevel || 3) >= 3 ? 'bg-amber-50 border-2 border-amber-300' :
                            'bg-emerald-50 border-2 border-emerald-300'
                          }`}>
                          <div className={`text-5xl mb-2 ${(formData.impactLevel || 3) >= 4 ? 'animate-pulse' : ''
                            }`}>
                            {(formData.impactLevel || 3) >= 4 ? 'ğŸš¨' : (formData.impactLevel || 3) >= 3 ? 'âš ï¸' : 'âœ…'}
                          </div>
                          <p className={`text-lg font-black ${(formData.impactLevel || 3) >= 4 ? 'text-red-700' :
                            (formData.impactLevel || 3) >= 3 ? 'text-amber-700' : 'text-emerald-700'
                            }`}>
                            {(formData.impactLevel || 3) >= 4 ? 'ØªØ£Ø«ÙŠØ± Ø­Ø±Ø¬' :
                              (formData.impactLevel || 3) >= 3 ? 'ØªØ£Ø«ÙŠØ± Ù…ØªÙˆØ³Ø·' : 'ØªØ£Ø«ÙŠØ± Ù…Ù†Ø®ÙØ¶'}
                          </p>
                          <p className="text-sm text-slate-500 mt-1">
                            {(formData.impactLevel || 3) >= 4 ? 'ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ' :
                              (formData.impactLevel || 3) >= 3 ? 'ÙŠØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©' : 'Ø¶Ù…Ù† Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„'}
                          </p> </div> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center justify-between">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <AlertTriangle className="w-5 h-5 text-red-500" />
                        Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ (Regulatory Exposure)
                      </h4>
                      <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-bold">
                        {(formData.exposureTypes || []).length} Ù…Ø­Ø¯Ø¯
                      </span> </div>
                    <div className="p-5">
                      <div className="grid grid-cols-2 gap-4">
                        {[
                          { value: 'financial', label: 'Ù…Ø§Ù„ÙŠ', desc: 'ØºØ±Ø§Ù…Ø§Øª ÙˆØ¹Ù‚ÙˆØ¨Ø§Øª Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ’°', color: 'red', examples: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 5 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„' },
                          { value: 'license', label: 'ØªØ±Ø®ÙŠØµ', desc: 'Ø¥ÙŠÙ‚Ø§Ù Ø£Ùˆ Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ', icon: 'ğŸ“œ', color: 'purple', examples: 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø·ØŒ Ø³Ø­Ø¨ Ø§Ù„Ø±Ø®ØµØ©' },
                          { value: 'reputation', label: 'Ø³Ù…Ø¹Ø©', desc: 'Ø¶Ø±Ø± Ù„Ù„Ø³Ù…Ø¹Ø© ÙˆØ§Ù„Ø«Ù‚Ø©', icon: 'ğŸ¢', color: 'orange', examples: 'ØªØ´Ù‡ÙŠØ±ØŒ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø«Ù‚Ø©' },
                          { value: 'criminal', label: 'Ø¬Ù†Ø§Ø¦ÙŠ', desc: 'Ù…Ù„Ø§Ø­Ù‚Ø© Ø¬Ù†Ø§Ø¦ÙŠØ©', icon: 'âš–ï¸', color: 'slate', examples: 'Ø§Ù„Ø³Ø¬Ù†ØŒ Ø§Ù„Ù…Ù†Ø¹ Ù…Ù† Ø§Ù„Ø³ÙØ±' },
                          { value: 'operational', label: 'ØªØ´ØºÙŠÙ„ÙŠ', desc: 'ØªÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', icon: 'âš™ï¸', color: 'blue', examples: 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª' },
                          { value: 'contractual', label: 'ØªØ¹Ø§Ù‚Ø¯ÙŠ', desc: 'ÙØ³Ø® Ø§Ù„Ø¹Ù‚ÙˆØ¯', icon: 'ğŸ“‹', color: 'indigo', examples: 'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§ÙƒØ§ØªØŒ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡' },
                        ].map(exp => {
                          const isSelected = (formData.exposureTypes || []).includes(exp.value);
                          return (
                            <button key={exp.value} type="button" disabled={modalMode === 'view'}
                              onClick={() => {
                                if (isSelected) {
                                  setFormData({ ...formData, exposureTypes: (formData.exposureTypes || []).filter(t => t !== exp.value) });
                                } else {
                                  setFormData({ ...formData, exposureTypes: [...(formData.exposureTypes || []), exp.value] });
                                }
                              }}
                              className={`p-4 rounded-2xl border-2 text-right transition-all transform hover:scale-[1.02] ${isSelected
                                ? `bg-${exp.color}-50 border-${exp.color}-400 shadow-lg`
                                : 'bg-white border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-start gap-3">
                                <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-2xl ${isSelected ? `bg-${exp.color}-100` : 'bg-slate-100'
                                  }`}>
                                  {exp.icon}
                                </div>
                                <div className="flex-1">
                                  <div className="flex items-center justify-between">
                                    <p className={`font-bold ${isSelected ? `text-${exp.color}-700` : 'text-slate-700'}`}>{exp.label}</p>
                                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isSelected ? `bg-${exp.color}-500 border-${exp.color}-500` : 'border-slate-300'
                                      }`}>
                                      {isSelected && <CheckCircle2 className="w-4 h-4 text-white" />}
                                    </div> </div>
                                  <p className="text-sm text-slate-500 mt-1">{exp.desc}</p>
                                  <p className={`text-xs mt-2 px-2 py-1 rounded-lg inline-block ${isSelected ? `bg-${exp.color}-100 text-${exp.color}-600` : 'bg-slate-100 text-slate-500'
                                    }`}>{exp.examples}</p>
                                </div> </div> </button>);
                        })}
                      </div> </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-red-50 px-5 py-3 border-b border-red-100">
                        <h4 className="font-bold text-red-700 flex items-center gap-2">
                          <AlertCircle className="w-5 h-5" />
                          Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºØ±Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                        </h4>
                      </div>
                      <div className="p-4 space-y-3">
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (Ø±ÙŠØ§Ù„)</label>
                            <input type="number" value={formData.penaltyMin || 0} onChange={(e) => setFormData({ ...formData, penaltyMin: parseInt(e.target.value) || 0 })}
                              disabled={modalMode === 'view'} className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl text-sm disabled:bg-slate-50" placeholder="0" />
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (Ø±ÙŠØ§Ù„)</label>
                            <input type="number" value={formData.penaltyMax || 0} onChange={(e) => setFormData({ ...formData, penaltyMax: parseInt(e.target.value) || 0 })}
                              disabled={modalMode === 'view'} className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl text-sm disabled:bg-slate-50" placeholder="0" />
                          </div> </div>
                        {(formData.penaltyMin || formData.penaltyMax) && (
                          <div className="p-3 bg-red-50 rounded-xl">
                            <p className="text-red-700 text-sm font-bold">
                              ğŸ’° Ù†Ø·Ø§Ù‚ Ø§Ù„ØºØ±Ø§Ù…Ø©: {(formData.penaltyMin || 0).toLocaleString()} - {(formData.penaltyMax || 0).toLocaleString()} Ø±ÙŠØ§Ù„
                            </p> </div>
                        )}
                      </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-purple-50 px-5 py-3 border-b border-purple-100">
                        <h4 className="font-bold text-purple-700 flex items-center gap-2">
                          <Clock className="w-5 h-5" />
                          Ù…Ø¯Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù/Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©
                        </h4>
                      </div>
                      <div className="p-4 space-y-3">
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ù…Ø¯Ø©</label>
                            <input type="number" value={formData.suspensionDuration || 0} onChange={(e) => setFormData({ ...formData, suspensionDuration: parseInt(e.target.value) || 0 })}
                              disabled={modalMode === 'view'} className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl text-sm disabled:bg-slate-50" placeholder="0" />
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                            <select value={formData.suspensionUnit || 'days'} onChange={(e) => setFormData({ ...formData, suspensionUnit: e.target.value })}
                              disabled={modalMode === 'view'} className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl text-sm disabled:bg-slate-50">
                              <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                              <option value="days">Ø£ÙŠØ§Ù…</option>
                              <option value="months">Ø£Ø´Ù‡Ø±</option>
                              <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                            </select>
                          </div> </div>
                        {formData.suspensionDuration > 0 && (
                          <div className="p-3 bg-purple-50 rounded-xl">
                            <p className="text-purple-700 text-sm font-bold">
                              â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©: {formData.suspensionDuration} {formData.suspensionUnit === 'hours' ? 'Ø³Ø§Ø¹Ø©' : formData.suspensionUnit === 'days' ? 'ÙŠÙˆÙ…' : formData.suspensionUnit === 'months' ? 'Ø´Ù‡Ø±' : 'Ø³Ù†Ø©'}
                            </p> </div>
                        )}
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <FileText className="w-5 h-5 text-slate-500" />
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
                      </h4>
                    </div>
                    <div className="p-4">
                      <textarea value={formData.penaltyDetails || ''} onChange={(e) => setFormData({ ...formData, penaltyDetails: e.target.value })} disabled={modalMode === 'view'}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 focus:border-orange-400 focus:outline-none h-24 resize-none"
                        placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ø¨Ø´ÙƒÙ„ ØªÙØµÙŠÙ„ÙŠ... Ù…Ø«Ø§Ù„: ØºØ±Ø§Ù…Ø© Ù…Ø§Ù„ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ 100,000 Ø±ÙŠØ§Ù„ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ÙˆÙ…Ø¶Ø§Ø¹ÙØ© Ø§Ù„ØºØ±Ø§Ù…Ø© ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±ØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…..." />
                    </div> </div>
                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                      <BarChart3 className="w-5 h-5 text-orange-400" />
                      Ù…Ù„Ø®Øµ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±
                    </h4>
                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className={`text-4xl font-black ${(formData.impactLevel || 3) >= 4 ? 'text-red-400' :
                          (formData.impactLevel || 3) >= 3 ? 'text-amber-400' : 'text-emerald-400'
                          }`}>{formData.impactLevel || 3}/5</p>
                        <p className="text-slate-300 text-sm mt-1">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ£Ø«ÙŠØ±</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-4xl font-black text-orange-400">{(formData.exposureTypes || []).length}</p>
                        <p className="text-slate-300 text-sm mt-1">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ¹Ø±Ø¶</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className="text-4xl font-black text-red-400">
                          {formData.penaltyMax ? (formData.penaltyMax / 1000).toFixed(0) + 'K' : '0'}
                        </p>
                        <p className="text-slate-300 text-sm mt-1">Ø£Ù‚ØµÙ‰ ØºØ±Ø§Ù…Ø© (Ø£Ù„Ù)</p>
                      </div>
                      <div className="bg-white/10 rounded-xl p-4 text-center backdrop-blur">
                        <p className={`text-4xl font-black ${((formData.impactLevel || 3) * 2 + (formData.exposureTypes || []).length * 1.5) >= 10 ? 'text-red-400' :
                          ((formData.impactLevel || 3) * 2 + (formData.exposureTypes || []).length * 1.5) >= 6 ? 'text-amber-400' : 'text-emerald-400'
                          }`}>
                          {(((formData.impactLevel || 3) * 2 + (formData.exposureTypes || []).length * 1.5)).toFixed(1)}
                        </p>
                        <p className="text-slate-300 text-sm mt-1">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</p>
                      </div> </div> </div> </div>
              )}

              {modalTab === 'audit' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200">
                    <h3 className="text-lg font-bold text-purple-800 mb-4 flex items-center gap-2">
                      <Layers className="w-5 h-5" />Ø§Ù„ØªØµÙ†ÙŠÙ
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">ØªØµÙ†ÙŠÙ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label>
                        <div className="grid grid-cols-2 gap-2">
                          {CATEGORIES.map(cat => (
                            <button key={cat.code} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, category: cat.code })}
                              disabled={modalMode === 'view'}
                              className={`p-3 rounded-xl border-2 text-sm font-bold transition-all ${formData.category === cat.code
                                ? 'border-purple-500 bg-purple-100 text-purple-700'
                                : 'border-slate-200 bg-white hover:border-purple-300 text-slate-600'
                                } disabled:opacity-50`}>
                              {cat.nameAr}
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label>
                        <div className="space-y-2">
                          {[
                            { value: 'Mandatory', label: 'Ø¥Ù„Ø²Ø§Ù…ÙŠ', icon: AlertCircle, color: 'red' },
                            { value: 'Recommended', label: 'Ù…ÙˆØµÙ‰ Ø¨Ù‡', icon: CheckCircle2, color: 'amber' },
                            { value: 'Optional', label: 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ', icon: Info, color: 'blue' },
                          ].map(type => {
                            const TypeIcon = type.icon;
                            return (
                              <button key={type.value} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, obligationType: type.value })}
                                disabled={modalMode === 'view'}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.obligationType === type.value
                                  ? `border-${type.color}-500 bg-${type.color}-50`
                                  : 'border-slate-200 bg-white hover:border-slate-300'
                                  } disabled:opacity-50`}>
                                <TypeIcon className={`w-5 h-5 text-${type.color}-500`} />
                                <span className="font-bold">{type.label}</span>
                              </button>);
                          })}
                        </div> </div> </div> </div>
                  <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                    <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <Target className="w-5 h-5 text-emerald-500" />Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø·Ø§Ù‚</label>
                        <div className="space-y-2">
                          {[
                            { value: 'Enterprise', label: 'Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´Ø£Ø©', desc: 'ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ ÙƒØ§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª' },
                            { value: 'Department', label: 'Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', desc: 'ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø§Øª Ù…Ø­Ø¯Ø¯Ø©' },
                            { value: 'Process', label: 'Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', desc: 'ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø©' },
                          ].map(scope => (
                            <button key={scope.value} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, scopeLevel: scope.value })}
                              disabled={modalMode === 'view'}
                              className={`w-full text-right p-4 rounded-xl border-2 transition-all ${formData.scopeLevel === scope.value
                                ? 'border-emerald-500 bg-emerald-50'
                                : 'border-slate-200 bg-white hover:border-emerald-300'
                                } disabled:opacity-50`}>
                              <span className="font-bold block">{scope.label}</span>
                              <span className="text-sm text-slate-500">{scope.desc}</span>
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                        <div className="space-y-2">
                          {[
                            { value: 'Applicable', label: 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', color: 'emerald' },
                            { value: 'PartiallyApplicable', label: 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø²Ø¦ÙŠØ§Ù‹', color: 'amber' },
                            { value: 'NotApplicable', label: 'ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', color: 'red' },
                          ].map(app => (
                            <button key={app.value} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, applicability: app.value })}
                              disabled={modalMode === 'view'}
                              className={`w-full p-3 rounded-xl border-2 font-bold transition-all ${formData.applicability === app.value
                                ? `border-${app.color}-500 bg-${app.color}-50 text-${app.color}-700`
                                : 'border-slate-200 bg-white hover:border-slate-300 text-slate-600'
                                } disabled:opacity-50`}>
                              {app.label}
                            </button>
                          ))}
                        </div>
                        {formData.applicability !== 'Applicable' && (
                          <div className="mt-4">
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø¨Ø±Ø± Ø¹Ø¯Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                            <textarea rows={2} value={formData.applicabilityJustification || ''}
                              onChange={(e) => setFormData({ ...formData, applicabilityJustification: e.target.value })}
                              disabled={modalMode === 'view'}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 resize-none"
                              placeholder="Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø¹Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…..." />
                          </div>
                        )}
                      </div> </div> </div> </div>
              )}

              {modalTab === 'priority' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-6 border-2 border-red-200">
                    <h3 className="text-lg font-bold text-red-800 mb-4 flex items-center gap-2">
                      <AlertTriangle className="w-5 h-5" />Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© ÙˆØ§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                    </h3>
                    <div className="grid grid-cols-4 gap-4">
                      {[
                        { value: 'Critical', label: 'Ø­Ø±Ø¬', desc: 'ÙŠØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù… ÙÙˆØ±ÙŠ', color: 'red', icon: AlertCircle },
                        { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', desc: 'Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰', color: 'orange', icon: TrendingUp },
                        { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', desc: 'Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ø¹ØªØ¯Ù„Ø©', color: 'amber', icon: Activity },
                        { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', desc: 'ÙŠÙ…ÙƒÙ† Ø¬Ø¯ÙˆÙ„ØªÙ‡', color: 'emerald', icon: CheckCircle2 },
                      ].map(crit => {
                        const CritIcon = crit.icon;
                        const isSelected = formData.criticality === crit.value;
                        return (
                          <button key={crit.value} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, criticality: crit.value })}
                            disabled={modalMode === 'view'}
                            className={`p-4 rounded-2xl border-2 transition-all text-center ${isSelected
                              ? `border-${crit.color}-500 bg-${crit.color}-100 shadow-lg`
                              : 'border-slate-200 bg-white hover:border-slate-300'
                              } disabled:opacity-50`}>
                            <div className={`w-12 h-12 mx-auto rounded-xl flex items-center justify-center mb-2 ${isSelected ? `bg-${crit.color}-500 text-white` : 'bg-slate-100 text-slate-500'
                              }`}>
                              <CritIcon className="w-6 h-6" />
                            </div>
                            <span className={`font-bold block ${isSelected ? `text-${crit.color}-700` : 'text-slate-700'}`}>{crit.label}</span>
                            <span className="text-xs text-slate-500">{crit.desc}</span>
                          </button>);
                      })}
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <Scale className="w-5 h-5 text-purple-500" />ØªØ£Ø«ÙŠØ± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„
                      </h4>
                      <div className="space-y-2">
                        {[
                          { value: 'Financial', label: 'Ù…Ø§Ù„ÙŠ - ØºØ±Ø§Ù…Ø§Øª ÙˆØ¹Ù‚ÙˆØ¨Ø§Øª', icon: 'ğŸ’°' },
                          { value: 'Reputational', label: 'Ø³Ù…Ø¹Ø© - Ø¶Ø±Ø± Ù„Ù„Ø³Ù…Ø¹Ø©', icon: 'ğŸ“¢' },
                          { value: 'Operational', label: 'ØªØ´ØºÙŠÙ„ÙŠ - ØªÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', icon: 'âš™ï¸' },
                          { value: 'Legal', label: 'Ù‚Ø§Ù†ÙˆÙ†ÙŠ - Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù‚Ø¶Ø§Ø¦ÙŠØ©', icon: 'âš–ï¸' },
                          { value: 'Regulatory', label: 'ØªÙ†Ø¸ÙŠÙ…ÙŠ - Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ', icon: 'ğŸ›ï¸' },
                        ].map(impact => (
                          <label key={impact.value} className="flex items-center gap-3 p-3 rounded-xl border-2 border-slate-200 hover:bg-slate-50 cursor-pointer">
                            <input type="checkbox" checked={formData.impactTypes?.includes(impact.value) || false}
                              onChange={(e) => {
                                if (modalMode === 'view') return;
                                const current = formData.impactTypes || [];
                                setFormData({
                                  ...formData,
                                  impactTypes: e.target.checked
                                    ? [...current, impact.value]
                                    : current.filter(i => i !== impact.value)
                                });
                              }}
                              disabled={modalMode === 'view'}
                              className="w-5 h-5 rounded text-purple-500" />
                            <span className="text-xl">{impact.icon}</span>
                            <span className="font-bold text-slate-700">{impact.label}</span>
                          </label>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <AlertTriangle className="w-5 h-5 text-red-500" />ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±
                      </h4>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-600 mb-2">Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</label>
                          <div className="flex gap-2">
                            {['Low', 'Medium', 'High', 'VeryHigh'].map(level => (
                              <button key={level} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, riskLikelihood: level })}
                                disabled={modalMode === 'view'}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all ${formData.riskLikelihood === level
                                  ? level === 'Low' ? 'bg-emerald-500 text-white' :
                                    level === 'Medium' ? 'bg-amber-500 text-white' :
                                      level === 'High' ? 'bg-orange-500 text-white' :
                                        'bg-red-500 text-white'
                                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                  } disabled:opacity-50`}>
                                {level === 'Low' ? 'Ù…Ù†Ø®ÙØ¶' : level === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : level === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹'}
                              </button>
                            ))}
                          </div> </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-600 mb-2">Ø­Ø¬Ù… Ø§Ù„ØªØ£Ø«ÙŠØ±</label>
                          <div className="flex gap-2">
                            {['Low', 'Medium', 'High', 'VeryHigh'].map(level => (
                              <button key={level} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, riskImpact: level })}
                                disabled={modalMode === 'view'}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all ${formData.riskImpact === level
                                  ? level === 'Low' ? 'bg-emerald-500 text-white' :
                                    level === 'Medium' ? 'bg-amber-500 text-white' :
                                      level === 'High' ? 'bg-orange-500 text-white' :
                                        'bg-red-500 text-white'
                                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                  } disabled:opacity-50`}>
                                {level === 'Low' ? 'Ù…Ù†Ø®ÙØ¶' : level === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : level === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹'}
                              </button>
                            ))}
                          </div> </div>
                        {formData.riskLikelihood && formData.riskImpact && (
                          <div className={`p-4 rounded-xl text-center ${(formData.riskLikelihood === 'VeryHigh' || formData.riskImpact === 'VeryHigh') ? 'bg-red-100 border-2 border-red-300' :
                            (formData.riskLikelihood === 'High' || formData.riskImpact === 'High') ? 'bg-orange-100 border-2 border-orange-300' :
                              (formData.riskLikelihood === 'Medium' || formData.riskImpact === 'Medium') ? 'bg-amber-100 border-2 border-amber-300' :
                                'bg-emerald-100 border-2 border-emerald-300'
                            }`}>
                            <span className="text-sm font-bold">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙƒÙ„ÙŠ: </span>
                            <span className="text-lg font-bold">
                              {(formData.riskLikelihood === 'VeryHigh' || formData.riskImpact === 'VeryHigh') ? 'ğŸ”´ Ø­Ø±Ø¬' :
                                (formData.riskLikelihood === 'High' || formData.riskImpact === 'High') ? 'ğŸŸ  Ø¹Ø§Ù„ÙŠ' :
                                  (formData.riskLikelihood === 'Medium' || formData.riskImpact === 'Medium') ? 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·' :
                                    'ğŸŸ¢ Ù…Ù†Ø®ÙØ¶'}
                            </span> </div>
                        )}
                      </div> </div> </div> </div>
              )}

              {modalTab === 'dates' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-amber-50 to-yellow-50 rounded-2xl p-6 border-2 border-amber-200">
                    <h3 className="text-lg font-bold text-amber-800 mb-4 flex items-center gap-2">
                      <Calendar className="w-5 h-5" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-3 gap-6">
                      <div className="bg-white rounded-xl p-4 border border-amber-200">
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</label>
                        <input type="date" value={formData.effectiveDate || ''} onChange={(e) => setFormData({ ...formData, effectiveDate: e.target.value })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50" />
                        <p className="text-xs text-slate-500 mt-2">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø³Ø±ÙŠØ§Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border border-amber-200">
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                        <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50" />
                        <p className="text-xs text-slate-500 mt-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border border-amber-200">
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
                        <input type="date" value={formData.nextReviewDate || ''} onChange={(e) => setFormData({ ...formData, nextReviewDate: e.target.value })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50" />
                        <p className="text-xs text-slate-500 mt-2">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</p>
                      </div> </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <RefreshCw className="w-5 h-5 text-blue-500" />Ø¯ÙˆØ±ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚
                      </h4>
                      <div className="grid grid-cols-2 gap-2">
                        {FREQUENCIES.map(freq => (
                          <button key={freq.code} type="button" onClick={() => modalMode !== 'view' && setFormData({ ...formData, frequency: freq.code })}
                            disabled={modalMode === 'view'}
                            className={`p-3 rounded-xl border-2 text-sm font-bold transition-all ${formData.frequency === freq.code
                              ? 'border-blue-500 bg-blue-100 text-blue-700'
                              : 'border-slate-200 bg-white hover:border-blue-300 text-slate-600'
                              } disabled:opacity-50`}>
                            {freq.nameAr}
                          </button>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <Bell className="w-5 h-5 text-amber-500" />Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
                      </h4>
                      <div className="space-y-3">
                        <label className="flex items-center gap-3 p-3 rounded-xl border-2 border-slate-200 hover:bg-slate-50 cursor-pointer">
                          <input type="checkbox" checked={formData.reminderBefore30 || false}
                            onChange={(e) => modalMode !== 'view' && setFormData({ ...formData, reminderBefore30: e.target.checked })}
                            disabled={modalMode === 'view'} className="w-5 h-5 rounded text-amber-500" />
                          <span className="font-bold text-slate-700">Ù‚Ø¨Ù„ 30 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span>
                        </label>
                        <label className="flex items-center gap-3 p-3 rounded-xl border-2 border-slate-200 hover:bg-slate-50 cursor-pointer">
                          <input type="checkbox" checked={formData.reminderBefore14 || false}
                            onChange={(e) => modalMode !== 'view' && setFormData({ ...formData, reminderBefore14: e.target.checked })}
                            disabled={modalMode === 'view'} className="w-5 h-5 rounded text-amber-500" />
                          <span className="font-bold text-slate-700">Ù‚Ø¨Ù„ 14 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span>
                        </label>
                        <label className="flex items-center gap-3 p-3 rounded-xl border-2 border-slate-200 hover:bg-slate-50 cursor-pointer">
                          <input type="checkbox" checked={formData.reminderBefore7 || false}
                            onChange={(e) => modalMode !== 'view' && setFormData({ ...formData, reminderBefore7: e.target.checked })}
                            disabled={modalMode === 'view'} className="w-5 h-5 rounded text-amber-500" />
                          <span className="font-bold text-slate-700">Ù‚Ø¨Ù„ 7 Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span>
                        </label>
                        <label className="flex items-center gap-3 p-3 rounded-xl border-2 border-red-200 bg-red-50 hover:bg-red-100 cursor-pointer">
                          <input type="checkbox" checked={formData.reminderOnDue || false}
                            onChange={(e) => modalMode !== 'view' && setFormData({ ...formData, reminderOnDue: e.target.checked })}
                            disabled={modalMode === 'view'} className="w-5 h-5 rounded text-red-500" />
                          <span className="font-bold text-red-700">ÙŠÙˆÙ… Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span>
                        </label>
                      </div> </div> </div> </div>
              )}

              {modalTab === 'responsibilities' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 border-2 border-blue-200">
                    <h3 className="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
                      <Users className="w-5 h-5" />ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„
                    </h3>
                    <div className="grid grid-cols-3 gap-6">
                      <div className="bg-white rounded-xl p-5 border-2 border-blue-200">
                        <div className="flex items-center gap-3 mb-4">
                          <div className="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center">
                            <User className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <span className="font-bold text-slate-800 block">Ø§Ù„Ù…Ø§Ù„Ùƒ</span>
                            <span className="text-xs text-slate-500">Owner</span>
                          </div> </div>
                        <select value={formData.ownerId || ''} onChange={(e) => setFormData({ ...formData, ownerId: parseInt(e.target.value) })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ù„Ùƒ...</option>
                          {USERS.map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
                        </select>
                        <p className="text-xs text-slate-500 mt-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                      </div>
                      <div className="bg-white rounded-xl p-5 border-2 border-amber-200">
                        <div className="flex items-center gap-3 mb-4">
                          <div className="w-10 h-10 rounded-xl bg-amber-500 flex items-center justify-center">
                            <UserCheck className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <span className="font-bold text-slate-800 block">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</span>
                            <span className="text-xs text-slate-500">Reviewer</span>
                          </div> </div>
                        <select value={formData.reviewerId || ''} onChange={(e) => setFormData({ ...formData, reviewerId: parseInt(e.target.value) })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹...</option>
                          {USERS.map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
                        </select>
                        <p className="text-xs text-slate-500 mt-2">Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø©</p>
                      </div>
                      <div className="bg-white rounded-xl p-5 border-2 border-emerald-200">
                        <div className="flex items-center gap-3 mb-4">
                          <div className="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center">
                            <CheckCircle2 className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <span className="font-bold text-slate-800 block">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</span>
                            <span className="text-xs text-slate-500">Approver</span>
                          </div> </div>
                        <select value={formData.approverId || ''} onChange={(e) => setFormData({ ...formData, approverId: parseInt(e.target.value) })} disabled={modalMode === 'view'}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯...</option>
                          {USERS.map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
                        </select>
                        <p className="text-xs text-slate-500 mt-2">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                      <Building className="w-5 h-5 text-purple-500" />Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ©
                    </h4>
                    <div className="flex flex-wrap gap-2">
                      {['Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ'].map(dept => (
                        <button key={dept} type="button" onClick={() => {
                          if (modalMode === 'view') return;
                          const current = formData.departments || [];
                          setFormData({
                            ...formData,
                            departments: current.includes(dept)
                              ? current.filter(d => d !== dept)
                              : [...current, dept]
                          });
                        }}
                          disabled={modalMode === 'view'}
                          className={`px-4 py-2 rounded-xl font-bold transition-all ${formData.departments?.includes(dept)
                            ? 'bg-purple-500 text-white'
                            : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                            } disabled:opacity-50`}>
                          {dept}
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {modalTab === 'links' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-6 border-2 border-emerald-200">
                    <h3 className="text-lg font-bold text-emerald-800 mb-4 flex items-center gap-2">
                      <FileCheck className="w-5 h-5" />Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø©
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="flex items-center gap-3 mb-4">
                          <input type="checkbox" checked={formData.evidenceRequired !== false}
                            onChange={(e) => modalMode !== 'view' && setFormData({ ...formData, evidenceRequired: e.target.checked })}
                            disabled={modalMode === 'view'} className="w-5 h-5 rounded text-emerald-500" />
                          <span className="font-bold text-slate-700">ÙŠØªØ·Ù„Ø¨ Ø£Ø¯Ù„Ø© Ø¥Ø«Ø¨Ø§Øª</span>
                        </label>
                        {formData.evidenceRequired !== false && (
                          <div className="space-y-2">
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                            {[
                              { value: 'Document', label: 'Ù…Ø³ØªÙ†Ø¯Ø§Øª', icon: FileText },
                              { value: 'Screenshot', label: 'Ù„Ù‚Ø·Ø§Øª Ø´Ø§Ø´Ø©', icon: Eye },
                              { value: 'Report', label: 'ØªÙ‚Ø§Ø±ÙŠØ±', icon: BarChart3 },
                              { value: 'Log', label: 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', icon: History },
                              { value: 'Attestation', label: 'Ø¥Ù‚Ø±Ø§Ø±Ø§Øª', icon: CheckSquare },
                            ].map(type => {
                              const TypeIcon = type.icon;
                              return (
                                <label key={type.value} className="flex items-center gap-3 p-3 rounded-xl border border-slate-200 hover:bg-emerald-50 cursor-pointer">
                                  <input type="checkbox" checked={formData.evidenceTypes?.includes(type.value) || false}
                                    onChange={(e) => {
                                      if (modalMode === 'view') return;
                                      const current = formData.evidenceTypes || [];
                                      setFormData({
                                        ...formData,
                                        evidenceTypes: e.target.checked
                                          ? [...current, type.value]
                                          : current.filter(t => t !== type.value)
                                      });
                                    }}
                                    disabled={modalMode === 'view'} className="w-4 h-4 rounded text-emerald-500" />
                                  <TypeIcon className="w-4 h-4 text-slate-500" />
                                  <span className="text-sm font-bold text-slate-700">{type.label}</span>
                                </label>
                              );
                            })}
                          </div>
                        )}
                      </div>
                      <div>
                        <div className="mb-4">
                          <label className="block text-sm font-bold text-slate-700 mb-2">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ù„ÙŠÙ„ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                          <input type="number" value={formData.evidenceValidityDays || 365}
                            onChange={(e) => setFormData({ ...formData, evidenceValidityDays: parseInt(e.target.value) })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„</label>
                          <textarea rows={4} value={formData.acceptanceCriteria || ''}
                            onChange={(e) => setFormData({ ...formData, acceptanceCriteria: e.target.value })}
                            disabled={modalMode === 'view'}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl disabled:bg-slate-50 resize-none"
                            placeholder="Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ØªØ³ØªÙˆÙÙŠÙ‡Ø§ Ø§Ù„Ø£Ø¯Ù„Ø© Ù„ØªÙƒÙˆÙ† Ù…Ù‚Ø¨ÙˆÙ„Ø©..." />
                        </div> </div> </div> </div>
                  <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                      <Link2 className="w-5 h-5 text-indigo-500" />Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                    </h4>
                    <div className="grid grid-cols-3 gap-4">
                      <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                        <div className="flex items-center gap-2 mb-2">
                          <Shield className="w-5 h-5 text-indigo-500" />
                          <span className="font-bold text-indigo-700">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</span>
                        </div>
                        <p className="text-2xl font-bold text-indigo-600">{formData.linkedControls?.length || 0}</p>
                        <p className="text-xs text-indigo-500">Ø¶Ø§Ø¨Ø· Ù…Ø±ØªØ¨Ø·</p>
                      </div>
                      <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                        <div className="flex items-center gap-2 mb-2">
                          <FileText className="w-5 h-5 text-purple-500" />
                          <span className="font-bold text-purple-700">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</span>
                        </div>
                        <p className="text-2xl font-bold text-purple-600">{formData.linkedPolicies?.length || 0}</p>
                        <p className="text-xs text-purple-500">Ø³ÙŠØ§Ø³Ø© Ù…Ø±ØªØ¨Ø·Ø©</p>
                      </div>
                      <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                        <div className="flex items-center gap-2 mb-2">
                          <FileCheck className="w-5 h-5 text-emerald-500" />
                          <span className="font-bold text-emerald-700">Ø§Ù„Ø£Ø¯Ù„Ø©</span>
                        </div>
                        <p className="text-2xl font-bold text-emerald-600">{formData.linkedEvidence?.length || 0}</p>
                        <p className="text-xs text-emerald-500">Ø¯Ù„ÙŠÙ„ Ù…Ø±ÙÙ‚</p>
                      </div> </div>
                    {modalMode !== 'view' && (
                      <button className="mt-4 w-full flex items-center justify-center gap-2 p-3 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-xl hover:bg-indigo-50 font-bold">
                        <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø· Ø¬Ø¯ÙŠØ¯
                      </button>
                    )}
                  </div> </div>
              )}

              {modalTab === 'audit' && (
                <div className="space-y-6">
                  <div className="bg-gradient-to-r from-slate-50 to-gray-50 rounded-2xl p-6 border-2 border-slate-200">
                    <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <History className="w-5 h-5" />Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØªØ¨Ø¹
                    </h3>
                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                        <Calendar className="w-8 h-8 text-blue-500 mx-auto mb-2" />
                        <p className="text-xs text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</p>
                        <p className="font-bold text-slate-800">{formData.createdAt || '-'}</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                        <User className="w-8 h-8 text-emerald-500 mx-auto mb-2" />
                        <p className="text-xs text-slate-500 mb-1">Ø£Ù†Ø´Ø¦ Ø¨ÙˆØ§Ø³Ø·Ø©</p>
                        <p className="font-bold text-slate-800">{getUser(formData.createdBy)?.name || '-'}</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                        <RefreshCw className="w-8 h-8 text-amber-500 mx-auto mb-2" />
                        <p className="text-xs text-slate-500 mb-1">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</p>
                        <p className="font-bold text-slate-800">{formData.updatedAt || '-'}</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                        <Edit className="w-8 h-8 text-purple-500 mx-auto mb-2" />
                        <p className="text-xs text-slate-500 mb-1">Ø¹ÙØ¯Ù‘Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©</p>
                        <p className="font-bold text-slate-800">{getUser(formData.updatedBy)?.name || '-'}</p>
                      </div> </div> </div>
                  <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                      <History className="w-5 h-5 text-slate-500" />Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                    </h4>
                    {formData.auditTrail?.length > 0 ? (
                      <div className="space-y-3 max-h-64 overflow-y-auto">
                        {formData.auditTrail.map((entry, idx) => (
                          <div key={idx} className="flex items-start gap-4 p-3 bg-slate-50 rounded-xl">
                            <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0">
                              <History className="w-5 h-5 text-slate-500" />
                            </div>
                            <div className="flex-1">
                              <p className="font-bold text-slate-800">{entry.action}</p>
                              <p className="text-sm text-slate-500">{entry.details}</p>
                              <div className="flex items-center gap-2 mt-1 text-xs text-slate-400">
                                <span>{entry.user}</span>
                                <span>â€¢</span>
                                <span>{entry.date}</span>
                              </div> </div> </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-8 text-slate-400">
                        <History className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                      </div>
                    )}
                  </div> </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between">
              <div className="flex items-center gap-2">
                <button onClick={() => { setShowModal(false); setModalTab('basic'); }}
                  className="px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white transition-all text-sm">
                  {modalMode === 'view' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Ø¥Ù„ØºØ§Ø¡'}
                </button>
                {modalMode !== 'view' && (
                  <button onClick={() => setFormData(createEmptyForm())}
                    className="px-3 py-2.5 text-slate-500 hover:text-slate-700 font-bold transition-all">
                    <RotateCcw className="w-4 h-4" />
                  </button>
                )}
              </div>
              <div className="flex items-center gap-2">
                {modalTab !== 'basic' && (
                  <button onClick={() => {
                    const tabs = ['basic', 'reference', 'program', 'applicability', 'evidence', 'schedule', 'testing', 'enforcement', 'impact', 'audit'];
                    const currentIdx = tabs.indexOf(modalTab);
                    if (currentIdx > 0) setModalTab(tabs[currentIdx - 1]);
                  }} className="flex items-center gap-1.5 px-4 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white transition-all text-sm">
                    <ChevronRight className="w-4 h-4" />Ø§Ù„Ø³Ø§Ø¨Ù‚
                  </button>
                )}
                {modalTab !== 'audit' && modalMode !== 'view' && (
                  <button onClick={() => {
                    const tabs = ['basic', 'reference', 'program', 'applicability', 'evidence', 'schedule', 'testing', 'enforcement', 'impact', 'audit'];
                    const currentIdx = tabs.indexOf(modalTab);
                    if (currentIdx < tabs.length - 1) setModalTab(tabs[currentIdx + 1]);
                  }} className="flex items-center gap-1.5 px-4 py-2.5 bg-slate-700 text-white rounded-xl font-bold hover:bg-slate-800 transition-all text-sm">
                    Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                  </button>
                )}
                {modalMode !== 'view' && (
                  <button onClick={handleSave} disabled={!formData.title || !formData.authorityId}
                    className="flex items-center gap-1.5 px-6 py-2.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-violet-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all disabled:opacity-50 text-sm">
                    <Save className="w-4 h-4" />{modalMode === 'create' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                  </button>
                )}
              </div> </div> </div> </div>
      )}

      {showDeleteConfirm && deleteTarget && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Trash2 className="w-6 h-6" /></div>
                <div><h2 className="text-xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2><p className="text-red-200">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p></div>
              </div> </div>
            <div className="p-6">
              <p className="text-slate-600">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù:</p>
              <p className="font-bold text-slate-800 mt-2">{deleteTarget.code} - {deleteTarget.title}</p>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowDeleteConfirm(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={confirmDelete} className="flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-bold"><Trash2 className="w-5 h-5" />Ø­Ø°Ù</button>
            </div> </div> </div>
      )}

      {showBulkModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><CheckSquare className="w-6 h-6" /></div>
                <div><h2 className="text-xl font-bold">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©</h2><p className="text-indigo-200">{selectedItems.length} Ø¹Ù†ØµØ± Ù…Ø­Ø¯Ø¯</p></div>
              </div> </div>
            <div className="p-6 space-y-3">
              <button onClick={() => handleBulkStatusChange('Active')} className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-emerald-500 hover:bg-emerald-50">
                <CheckCircle2 className="w-6 h-6 text-emerald-500" /><span className="font-bold">ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙ„</span>
              </button>
              <button onClick={() => handleBulkStatusChange('Draft')} className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-slate-400 hover:bg-slate-50">
                <FileText className="w-6 h-6 text-slate-500" /><span className="font-bold">ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ø³ÙˆØ¯Ø©</span>
              </button>
              <button onClick={handleBulkDelete} className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-red-200 bg-red-50 hover:bg-red-100">
                <Trash2 className="w-6 h-6 text-red-500" /><span className="font-bold text-red-700">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</span>
              </button> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => { setShowBulkModal(false); setSelectedItems([]); }} className="w-full px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
            </div> </div> </div>
      )}

      {showReportsModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-purple-600 to-indigo-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    <BarChart3 className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h2>
                    <p className="text-purple-200">Obligations Reports & Analytics</p>
                  </div> </div>
                <button onClick={() => setShowReportsModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-4 gap-4">
                {[
                  { id: 'status', icon: PieChart, label: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©', desc: 'Ø­Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', color: 'blue' },
                  { id: 'trend', icon: TrendingUp, label: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª', desc: 'ØªØ·ÙˆØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', color: 'emerald' },
                  { id: 'aging', icon: Clock, label: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø¯Ù…', desc: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©', color: 'amber' },
                  { id: 'workload', icon: Users, label: 'Ø¹Ø¨Ø¡ Ø§Ù„Ø¹Ù…Ù„', desc: 'Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', color: 'purple' }
                ].map(report => (
                  <button key={report.id} onClick={() => setSelectedReport(report.id)}
                    className={`p-4 rounded-xl border-2 transition-all text-right ${selectedReport === report.id
                      ? `border-${report.color}-500 bg-${report.color}-50`
                      : 'border-slate-200 hover:border-slate-300'
                      }`}>
                    <report.icon className={`w-8 h-8 mb-2 text-${report.color}-500`} />
                    <p className="font-bold text-slate-800">{report.label}</p>
                    <p className="text-sm text-slate-500">{report.desc}</p>
                  </button>
                ))}
              </div>

              {selectedReport === 'status' && (
                <div className="space-y-4">
                  <h3 className="font-bold text-slate-800 text-lg">ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h3>
                  <div className="grid grid-cols-4 gap-4">
                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <p className="text-emerald-600 text-sm font-bold">Ù†Ø´Ø·</p>
                      <p className="text-3xl font-black text-emerald-700">{obligations.filter(o => o.status === 'Active').length}</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                      <p className="text-slate-600 text-sm font-bold">Ù…Ø³ÙˆØ¯Ø©</p>
                      <p className="text-3xl font-black text-slate-700">{obligations.filter(o => o.status === 'Draft').length}</p>
                    </div>
                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                      <p className="text-amber-600 text-sm font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                      <p className="text-3xl font-black text-amber-700">{obligations.filter(o => o.status === 'UnderReview').length}</p>
                    </div>
                    <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                      <p className="text-red-600 text-sm font-bold">ØºÙŠØ± Ù†Ø´Ø·</p>
                      <p className="text-3xl font-black text-red-700">{obligations.filter(o => o.status === 'Inactive').length}</p>
                    </div> </div>
                  <div className="bg-white rounded-xl border-2 border-slate-200 p-4">
                    <h4 className="font-bold mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</h4>
                    <div className="space-y-3">
                      {['Critical', 'High', 'Medium', 'Low'].map(level => {
                        const count = obligations.filter(o => o.criticality === level).length;
                        const pct = Math.round((count / obligations.length) * 100);
                        return (
                          <div key={level} className="flex items-center gap-4">
                            <span className="w-20 text-sm font-bold">{level === 'Critical' ? 'Ø­Ø±Ø¬' : level === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : level === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}</span>
                            <div className="flex-1 bg-slate-100 rounded-full h-4">
                              <div className={`h-4 rounded-full ${level === 'Critical' ? 'bg-red-500' : level === 'High' ? 'bg-orange-500' : level === 'Medium' ? 'bg-blue-500' : 'bg-slate-400'}`}
                                style={{ width: `${pct}%` }}></div>
                            </div>
                            <span className="w-16 text-sm font-bold text-left">{count} ({pct}%)</span>
                          </div>);
                      })}
                    </div> </div> </div>
              )}

              {selectedReport === 'aging' && (
                <div className="space-y-4">
                  <h3 className="font-bold text-slate-800 text-lg">ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø§Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h3>
                  <div className="grid grid-cols-4 gap-4">
                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <p className="text-emerald-600 text-sm font-bold">Ù…Ø­Ø¯Ù‘Ø« (Ø¢Ø®Ø± 30 ÙŠÙˆÙ…)</p>
                      <p className="text-3xl font-black text-emerald-700">{generateReport('aging')?.data?.current || 0}</p>
                    </div>
                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                      <p className="text-blue-600 text-sm font-bold">30-60 ÙŠÙˆÙ…</p>
                      <p className="text-3xl font-black text-blue-700">{generateReport('aging')?.data?.['30-60 days'] || 0}</p>
                    </div>
                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                      <p className="text-amber-600 text-sm font-bold">60-90 ÙŠÙˆÙ…</p>
                      <p className="text-3xl font-black text-amber-700">{generateReport('aging')?.data?.['60-90 days'] || 0}</p>
                    </div>
                    <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                      <p className="text-red-600 text-sm font-bold">Ø£ÙƒØ«Ø± Ù…Ù† 90 ÙŠÙˆÙ…</p>
                      <p className="text-3xl font-black text-red-700">{generateReport('aging')?.data?.['Over 90 days'] || 0}</p>
                    </div> </div> </div>
              )}

              {selectedReport === 'workload' && (
                <div className="space-y-4">
                  <h3 className="font-bold text-slate-800 text-lg">ØªÙ‚Ø±ÙŠØ± Ø¹Ø¨Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
                  <div className="bg-white rounded-xl border-2 border-slate-200 overflow-hidden">
                    <table className="w-full">
                      <thead>
                        <tr className="bg-slate-50">
                          <th className="text-right px-4 py-3 font-bold">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                          <th className="text-center px-4 py-3 font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                          <th className="text-center px-4 py-3 font-bold">Ø­Ø±Ø¬</th>
                          <th className="text-center px-4 py-3 font-bold">Ø¹Ø§Ù„ÙŠ</th>
                          <th className="text-center px-4 py-3 font-bold">Ù…Ø¹Ù„Ù‚</th>
                        </tr> </thead>
                      <tbody>
                        {Object.entries(generateReport('workload')?.data || {}).map(([owner, data]) => (
                          <tr key={owner} className="border-t border-slate-100">
                            <td className="px-4 py-3 font-bold">{owner}</td>
                            <td className="text-center px-4 py-3">{data.total}</td>
                            <td className="text-center px-4 py-3"><span className="px-2 py-1 bg-red-100 text-red-700 rounded text-sm font-bold">{data.critical}</span></td>
                            <td className="text-center px-4 py-3"><span className="px-2 py-1 bg-orange-100 text-orange-700 rounded text-sm font-bold">{data.high}</span></td>
                            <td className="text-center px-4 py-3"><span className="px-2 py-1 bg-amber-100 text-amber-700 rounded text-sm font-bold">{data.pending}</span></td>
                          </tr>
                        ))}
                      </tbody> </table> </div> </div>
              )}

              {selectedReport === 'trend' && (
                <div className="space-y-4">
                  <h3 className="font-bold text-slate-800 text-lg">ØªÙ‚Ø±ÙŠØ± Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</h3>
                  <div className="bg-emerald-50 rounded-xl p-6 border border-emerald-200 text-center">
                    <TrendingUp className="w-16 h-16 text-emerald-500 mx-auto mb-4" />
                    <p className="text-4xl font-black text-emerald-700">{Math.round(obligations.reduce((sum, o) => sum + (o.complianceScore || 85), 0) / obligations.length)}%</p>
                    <p className="text-emerald-600 font-bold mt-2">Ù…ØªÙˆØ³Ø· Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                  </div> </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowReportsModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="px-6 py-2.5 bg-purple-500 text-white rounded-xl font-bold flex items-center gap-2">
                <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button> </div> </div> </div>
      )}

      {showExceptionModal && selectedObligation && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <AlertCircle className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-lg font-bold">Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡</h2>
                    <p className="text-amber-200 text-sm">{selectedObligation.code} - Exception Request</p>
                  </div> </div>
                <button onClick={() => setShowExceptionModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ *</label>
                <select value={exceptionForm.reason} onChange={(e) => setExceptionForm({ ...exceptionForm, reason: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-400 focus:outline-none">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨Ø¨</option>
                  <option value="TechnicalLimitation">Ù‚ÙŠÙˆØ¯ ØªÙ‚Ù†ÙŠØ©</option>
                  <option value="BusinessReason">Ø£Ø³Ø¨Ø§Ø¨ ØªØ¬Ø§Ø±ÙŠØ©</option>
                  <option value="ResourceConstraint">Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</option>
                  <option value="RegulatoryChange">ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ</option>
                  <option value="Other">Ø£Ø®Ø±Ù‰</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¨Ø±Ø±Ø§Øª *</label>
                <textarea value={exceptionForm.justification} onChange={(e) => setExceptionForm({ ...exceptionForm, justification: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-400 focus:outline-none h-24 resize-none"
                  placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡..." />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                  <input type="date" value={exceptionForm.validFrom} onChange={(e) => setExceptionForm({ ...exceptionForm, validFrom: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-400 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                  <input type="date" value={exceptionForm.validTo} onChange={(e) => setExceptionForm({ ...exceptionForm, validTo: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-400 focus:outline-none" />
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowExceptionModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => handleExceptionRequest(selectedObligation)}
                disabled={!exceptionForm.reason || !exceptionForm.justification}
                className="px-6 py-2.5 bg-amber-500 text-white rounded-xl font-bold disabled:opacity-50 flex items-center gap-2">
                <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
              </button> </div> </div> </div>
      )}

      {showWorkflowModal && selectedObligation && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-blue-600 to-indigo-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <GitBranch className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-lg font-bold">Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</h2>
                    <p className="text-blue-200 text-sm">{selectedObligation.code} - Workflow</p>
                  </div> </div>
                <button onClick={() => setShowWorkflowModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className={`rounded-xl p-4 border-2 ${selectedObligation.workflowStatus === 'Approved' ? 'bg-emerald-50 border-emerald-200' :
                selectedObligation.workflowStatus === 'Rejected' ? 'bg-red-50 border-red-200' :
                  selectedObligation.workflowStatus === 'Pending' ? 'bg-amber-50 border-amber-200' : 'bg-slate-50 border-slate-200'
                }`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm font-bold">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                    <p className="text-xl font-black">{
                      selectedObligation.workflowStatus === 'Approved' ? 'Ù…Ø¹ØªÙ…Ø¯' :
                        selectedObligation.workflowStatus === 'Rejected' ? 'Ù…Ø±ÙÙˆØ¶' :
                          selectedObligation.workflowStatus === 'Pending' ? 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' : 'Ù…Ø³ÙˆØ¯Ø©'
                    }</p>
                  </div>
                  <div className={`w-12 h-12 rounded-full flex items-center justify-center ${selectedObligation.workflowStatus === 'Approved' ? 'bg-emerald-500' :
                    selectedObligation.workflowStatus === 'Rejected' ? 'bg-red-500' :
                      selectedObligation.workflowStatus === 'Pending' ? 'bg-amber-500' : 'bg-slate-400'
                    } text-white`}>
                    {selectedObligation.workflowStatus === 'Approved' ? <CheckCircle2 className="w-6 h-6" /> :
                      selectedObligation.workflowStatus === 'Rejected' ? <XCircle className="w-6 h-6" /> :
                        <Clock className="w-6 h-6" />}
                  </div> </div> </div>
              <div>
                <h4 className="font-bold text-slate-800 mb-4">Ø³Ø¬Ù„ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„</h4>
                <div className="space-y-3">
                  {(selectedObligation.workflowHistory || []).map((entry, idx) => (
                    <div key={idx} className="flex items-start gap-4 p-3 bg-slate-50 rounded-xl">
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${entry.action === 'Approved' ? 'bg-emerald-500' :
                        entry.action === 'Rejected' ? 'bg-red-500' :
                          entry.action === 'Submitted' ? 'bg-blue-500' : 'bg-slate-400'
                        } text-white`}>
                        {entry.action === 'Approved' ? <Check className="w-5 h-5" /> :
                          entry.action === 'Rejected' ? <X className="w-5 h-5" /> :
                            <Clock className="w-5 h-5" />}
                      </div>
                      <div className="flex-1">
                        <p className="font-bold text-slate-800">{entry.action}</p>
                        <p className="text-sm text-slate-500">Ø¨ÙˆØ§Ø³Ø·Ø©: {entry.byName} â€¢ {entry.date}</p>
                        {entry.comments && <p className="text-sm text-slate-600 mt-1">{entry.comments}</p>}
                      </div> </div>
                  ))}
                </div> </div>
              <div>
                <h4 className="font-bold text-slate-800 mb-4">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                <div className="space-y-2">
                  {(selectedObligation.notificationRules || []).map((rule, idx) => (
                    <div key={idx} className="flex items-center justify-between p-3 bg-blue-50 rounded-xl border border-blue-200">
                      <div className="flex items-center gap-3">
                        <Bell className="w-5 h-5 text-blue-500" />
                        <span className="text-sm">{rule.event} - Ù‚Ø¨Ù„ {rule.daysBefore} ÙŠÙˆÙ…</span>
                      </div>
                      <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">{rule.recipients.join(', ')}</span>
                    </div>
                  ))}
                </div> </div>
              <div>
                <h4 className="font-bold text-slate-800 mb-4">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯</h4>
                <div className="space-y-2">
                  {(selectedObligation.escalationRules || []).map((rule, idx) => (
                    <div key={idx} className="flex items-center justify-between p-3 bg-red-50 rounded-xl border border-red-200">
                      <div className="flex items-center gap-3">
                        <AlertTriangle className="w-5 h-5 text-red-500" />
                        <span className="text-sm">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {rule.level}: {rule.condition}</span>
                      </div>
                      <span className="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">{rule.escalateTo}</span>
                    </div>
                  ))}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowWorkflowModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-3">
                {selectedObligation.workflowStatus !== 'Approved' && (
                  <>
                    <button onClick={() => handleWorkflowAction('Submit', selectedObligation)}
                      className="px-4 py-2.5 bg-blue-500 text-white rounded-xl font-bold flex items-center gap-2">
                      <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                    </button>
                    <button onClick={() => handleWorkflowAction('Approve', selectedObligation)}
                      className="px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-bold flex items-center gap-2">
                      <Check className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯
                    </button>
                  </>
                )}
              </div> </div> </div> </div>
      )}

      {showLinkingModal && selectedObligation && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-teal-600 to-cyan-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <Link2 className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-lg font-bold">Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</h2>
                    <p className="text-teal-200 text-sm">{selectedObligation.code} - Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª</p>
                  </div> </div>
                <button onClick={() => setShowLinkingModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex border-b border-slate-200">
              {[
                { id: 'controls', label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: Shield, count: selectedObligation.linkedControls?.length || 0 },
                { id: 'risks', label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', icon: AlertTriangle, count: selectedObligation.linkedRisks?.length || 0 },
                { id: 'policies', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', icon: FileText, count: selectedObligation.linkedPolicies?.length || 0 },
                { id: 'dependencies', label: 'Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª', icon: GitBranch, count: selectedObligation.dependencies?.length || 0 }
              ].map(tab => (
                <button key={tab.id} onClick={() => setLinkingMode(tab.id)}
                  className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 font-bold transition-all ${linkingMode === tab.id ? 'bg-teal-50 text-teal-700 border-b-2 border-teal-500' : 'text-slate-600 hover:bg-slate-50'
                    }`}>
                  <tab.icon className="w-5 h-5" />{tab.label}
                  {tab.count > 0 && <span className="px-2 py-0.5 bg-teal-500 text-white rounded-full text-xs">{tab.count}</span>}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className="mb-4">
                <h4 className="font-bold text-slate-800 mb-3">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h4>
                <div className="flex flex-wrap gap-2">
                  {linkingMode === 'controls' && (selectedObligation.linkedControls || []).map((ctrl, idx) => (
                    <span key={idx} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold flex items-center gap-2">
                      <Shield className="w-4 h-4" />{ctrl.controlId} - {ctrl.controlName}
                      <button onClick={() => handleUnlinkControl(ctrl.controlId)} className="text-blue-500 hover:text-blue-700"><X className="w-4 h-4" /></button>
                    </span>
                  ))}
                  {linkingMode === 'risks' && (selectedObligation.linkedRisks || []).map((risk, idx) => (
                    <span key={idx} className="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-bold flex items-center gap-2">
                      <AlertTriangle className="w-4 h-4" />{risk.riskId} - {risk.riskName}
                      <button onClick={() => handleUnlinkRisk(risk.riskId)} className="text-red-500 hover:text-red-700"><X className="w-4 h-4" /></button>
                    </span>
                  ))}
                  {linkingMode === 'policies' && (selectedObligation.linkedPolicies || []).map((pol, idx) => (
                    <span key={idx} className="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm font-bold flex items-center gap-2">
                      <FileText className="w-4 h-4" />{pol.policyId} - {pol.policyName}
                      <button onClick={() => handleUnlinkPolicy(pol.policyId)} className="text-purple-500 hover:text-purple-700"><X className="w-4 h-4" /></button>
                    </span>
                  ))}
                  {linkingMode === 'dependencies' && (selectedObligation.dependencies || []).map((dep, idx) => (
                    <span key={idx} className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg text-sm font-bold flex items-center gap-2">
                      <GitBranch className="w-4 h-4" />{dep.obligationCode} ({dep.type})
                      <button onClick={() => handleUnlinkDependency(dep.obligationId)} className="text-amber-500 hover:text-amber-700"><X className="w-4 h-4" /></button>
                    </span>
                  ))}
                  {((linkingMode === 'controls' && (!selectedObligation.linkedControls || selectedObligation.linkedControls.length === 0)) ||
                    (linkingMode === 'risks' && (!selectedObligation.linkedRisks || selectedObligation.linkedRisks.length === 0)) ||
                    (linkingMode === 'policies' && (!selectedObligation.linkedPolicies || selectedObligation.linkedPolicies.length === 0)) ||
                    (linkingMode === 'dependencies' && (!selectedObligation.dependencies || selectedObligation.dependencies.length === 0))) && (
                      <span className="text-slate-400 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ø±ØªØ¨Ø·Ø©</span>
                    )}
                </div> </div>
              <div>
                <h4 className="font-bold text-slate-800 mb-3">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø±Ø¨Ø·</h4>
                <div className="space-y-2">
                  {linkingMode === 'controls' && availableControls.map(ctrl => (
                    <div key={ctrl.id} className={`flex items-center justify-between p-3 rounded-xl border hover:border-blue-300 ${(selectedObligation.linkedControls || []).some(l => l.controlId === ctrl.id) ? 'bg-blue-50 border-blue-300' : 'bg-slate-50 border-slate-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <Shield className="w-5 h-5 text-blue-500" />
                        <div>
                          <p className="font-bold text-slate-800">{ctrl.id} - {ctrl.name}</p>
                          <p className="text-sm text-slate-500">{ctrl.category} â€¢ ÙØ¹Ø§Ù„ÙŠØ©: {ctrl.effectiveness}%</p>
                        </div> </div>
                      {(selectedObligation.linkedControls || []).some(l => l.controlId === ctrl.id) ? (
                        <span className="px-3 py-1.5 bg-blue-500 text-white rounded-lg text-sm font-bold flex items-center gap-1"><Check className="w-4 h-4" />Ù…Ø±ØªØ¨Ø·</span>
                      ) : (
                        <button onClick={() => handleLinkControl(ctrl)} className="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600">Ø±Ø¨Ø·</button>
                      )}
                    </div>
                  ))}
                  {linkingMode === 'risks' && availableRisks.map(risk => (
                    <div key={risk.id} className={`flex items-center justify-between p-3 rounded-xl border hover:border-red-300 ${(selectedObligation.linkedRisks || []).some(l => l.riskId === risk.id) ? 'bg-red-50 border-red-300' : 'bg-slate-50 border-slate-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <AlertTriangle className={`w-5 h-5 ${risk.level === 'Critical' ? 'text-red-500' : risk.level === 'High' ? 'text-orange-500' : 'text-blue-500'}`} />
                        <div>
                          <p className="font-bold text-slate-800">{risk.id} - {risk.name}</p>
                          <p className="text-sm text-slate-500">{risk.category} â€¢ Ù…Ø³ØªÙˆÙ‰: {risk.level}</p>
                        </div> </div>
                      {(selectedObligation.linkedRisks || []).some(l => l.riskId === risk.id) ? (
                        <span className="px-3 py-1.5 bg-red-500 text-white rounded-lg text-sm font-bold flex items-center gap-1"><Check className="w-4 h-4" />Ù…Ø±ØªØ¨Ø·</span>
                      ) : (
                        <button onClick={() => handleLinkRisk(risk)} className="px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-bold hover:bg-red-600">Ø±Ø¨Ø·</button>
                      )}
                    </div>
                  ))}
                  {linkingMode === 'policies' && availablePolicies.map(pol => (
                    <div key={pol.id} className={`flex items-center justify-between p-3 rounded-xl border hover:border-purple-300 ${(selectedObligation.linkedPolicies || []).some(l => l.policyId === pol.id) ? 'bg-purple-50 border-purple-300' : 'bg-slate-50 border-slate-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <FileText className="w-5 h-5 text-purple-500" />
                        <div>
                          <p className="font-bold text-slate-800">{pol.id} - {pol.name}</p>
                          <p className="text-sm text-slate-500">Ø§Ù„Ø¥ØµØ¯Ø§Ø±: {pol.version} â€¢ {pol.status}</p>
                        </div> </div>
                      {(selectedObligation.linkedPolicies || []).some(l => l.policyId === pol.id) ? (
                        <span className="px-3 py-1.5 bg-purple-500 text-white rounded-lg text-sm font-bold flex items-center gap-1"><Check className="w-4 h-4" />Ù…Ø±ØªØ¨Ø·</span>
                      ) : (
                        <button onClick={() => handleLinkPolicy(pol)} className="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-bold hover:bg-purple-600">Ø±Ø¨Ø·</button>
                      )}
                    </div>
                  ))}
                  {linkingMode === 'dependencies' && obligations.filter(o => o.id !== selectedObligation.id).map(obl => (
                    <div key={obl.id} className={`flex items-center justify-between p-3 rounded-xl border hover:border-amber-300 ${(selectedObligation.dependencies || []).some(d => d.obligationId === obl.id) ? 'bg-amber-50 border-amber-300' : 'bg-slate-50 border-slate-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <GitBranch className="w-5 h-5 text-amber-500" />
                        <div>
                          <p className="font-bold text-slate-800">{obl.code} - {obl.title}</p>
                          <p className="text-sm text-slate-500">{obl.status}</p>
                        </div> </div>
                      {(selectedObligation.dependencies || []).some(d => d.obligationId === obl.id) ? (
                        <span className="px-3 py-1.5 bg-amber-500 text-white rounded-lg text-sm font-bold flex items-center gap-1"><Check className="w-4 h-4" />Ù…Ø±ØªØ¨Ø·</span>
                      ) : (
                        <button onClick={() => handleLinkDependency(obl)} className="px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-bold hover:bg-amber-600">Ø±Ø¨Ø·</button>
                      )}
                    </div>
                  ))}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowLinkingModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-2 text-sm text-slate-500">
                <Shield className="w-4 h-4 text-blue-500" />{selectedObligation.linkedControls?.length || 0}
                <AlertTriangle className="w-4 h-4 text-red-500" />{selectedObligation.linkedRisks?.length || 0}
                <FileText className="w-4 h-4 text-purple-500" />{selectedObligation.linkedPolicies?.length || 0}
                <GitBranch className="w-4 h-4 text-amber-500" />{selectedObligation.dependencies?.length || 0}
              </div> </div> </div> </div>
      )}

      {showConflictModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-orange-500 to-red-600 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <AlertTriangle className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-lg font-bold">Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª</h2>
                    <p className="text-orange-200 text-sm">Conflict Detection - ØªÙ… Ø§ÙƒØªØ´Ø§Ù {detectedConflicts.length} ØªØ¹Ø§Ø±Ø¶</p>
                  </div> </div>
                <button onClick={() => setShowConflictModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              {detectedConflicts.length === 0 ? (
                <div className="text-center py-12">
                  <CheckCircle2 className="w-16 h-16 text-emerald-500 mx-auto mb-4" />
                  <p className="text-xl font-bold text-emerald-700">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶Ø§Øª</p>
                  <p className="text-slate-500">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…ØªÙˆØ§ÙÙ‚Ø©</p>
                </div>
              ) : (
                detectedConflicts.map((item, idx) => (
                  <div key={idx} className="bg-red-50 rounded-xl p-4 border border-red-200">
                    <div className="flex items-center gap-3 mb-3">
                      <span className="font-mono text-sm font-bold text-red-600 bg-red-100 px-2 py-1 rounded">{item.obligation.code}</span>
                      <span className="font-bold text-slate-800">{item.obligation.title}</span>
                    </div>
                    <div className="space-y-2">
                      {item.conflicts.map((conflict, cIdx) => (
                        <div key={cIdx} className="flex items-center gap-3 p-2 bg-white rounded-lg border border-red-100">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${conflict.severity === 'High' ? 'bg-red-500 text-white' : 'bg-orange-100 text-orange-700'}`}>{conflict.severity}</span>
                          <span className="text-sm text-slate-700">{conflict.description}</span>
                        </div>
                      ))}
                    </div> </div>))
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowConflictModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="px-6 py-2.5 bg-orange-500 text-white rounded-xl font-bold flex items-center gap-2">
                <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button> </div> </div> </div>
      )}
    </div>);
};

// DASHBOARD - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©

const Dashboard = () => {
  const [timeRange, setTimeRange] = useState('month');
  const [showNotifications, setShowNotifications] = useState(false);
  const [liveTime, setLiveTime] = useState(new Date());

  // Live Clock
  useEffect(() => {
    const timer = setInterval(() => setLiveTime(new Date()), 1000);
    return () => clearInterval(timer);
  }, []);

  // Platform Statistics - Real-time Data
  const platformStats = useMemo(() => ({
    // Core Metrics
    complianceScore: 87.5, previousScore: 82.3, maturityLevel: 3.8, riskScore: 24, inspectionReadiness: 92,

    // Counts
    totalObligations: 127, activeObligations: 98, overdueObligations: 3, upcomingObligations: 12,

    totalPolicies: 45, activePolicies: 38, pendingApproval: 5,

    totalControls: 234, implementedControls: 198, partialControls: 28,

    totalEvidence: 456, validEvidence: 412, expiringEvidence: 18,

    totalIncidents: 23, activeIncidents: 3, criticalIncidents: 1,

    // By Authority
    authorities: [
      { code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', nameEn: 'Saudi Central Bank', obligations: 42, compliance: 92, color: 'emerald', icon: Building2 },
      { code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'National Cybersecurity Authority', obligations: 38, compliance: 87, color: 'purple', icon: Shield },
      { code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'SDAIA', obligations: 22, compliance: 95, color: 'indigo', icon: Database },
      { code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Capital Market Authority', obligations: 15, compliance: 78, color: 'blue', icon: TrendingUp },
      { code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø©', nameEn: 'ZATCA', obligations: 10, compliance: 100, color: 'amber', icon: FileCheck },
    ],

    // Monthly Trend
    monthlyTrend: [
      { month: 'Ø³Ø¨ØªÙ…Ø¨Ø±', score: 72 },
      { month: 'Ø£ÙƒØªÙˆØ¨Ø±', score: 76 },
      { month: 'Ù†ÙˆÙÙ…Ø¨Ø±', score: 79 },
      { month: 'Ø¯ÙŠØ³Ù…Ø¨Ø±', score: 82 },
      { month: 'ÙŠÙ†Ø§ÙŠØ±', score: 85 },
      { month: 'ÙØ¨Ø±Ø§ÙŠØ±', score: 87.5 },
    ],
  }), []);

  // Critical Alerts
  const criticalAlerts = [
    { id: 1, type: 'incident', severity: 'Critical', title: 'Ø­Ø§Ø¯Ø«Ø© Ø£Ù…Ù†ÙŠØ© - Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚', message: 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', time: '30 Ø¯Ù‚ÙŠÙ‚Ø©', deadline: '48 Ø³Ø§Ø¹Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº', action: 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©' },
    { id: 2, type: 'deadline', severity: 'High', title: 'Ù…ÙˆØ¹Ø¯ Ø¥Ø¨Ù„Ø§Øº NCA', message: 'Ø§Ù„Ø­Ø§Ø¯Ø«Ø© INC-2025-001 ØªØªØ·Ù„Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©', time: '2 Ø³Ø§Ø¹Ø©', deadline: '46 Ø³Ø§Ø¹Ø© Ù…ØªØ¨Ù‚ÙŠØ©', action: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¢Ù†' },
    { id: 3, type: 'inspection', severity: 'Medium', title: 'ØªÙØªÙŠØ´ SAMA Ù‚Ø§Ø¯Ù…', message: 'Ø²ÙŠØ§Ø±Ø© ØªÙØªÙŠØ´ Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 15 ÙŠÙˆÙ… - Ù…Ø·Ù„ÙˆØ¨ ØªØ­Ø¶ÙŠØ±', time: '1 ÙŠÙˆÙ…', deadline: '15 ÙŠÙˆÙ…', action: 'Ø®Ø·Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±' },
  ];

  // Upcoming Deadlines
  const upcomingDeadlines = [
    { id: 1, title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ÙŠ Q1', authority: 'SAMA', date: '2025-02-15', daysLeft: 11, priority: 'Critical', progress: 65 },
    { id: 2, title: 'ØªØ¬Ø¯ÙŠØ¯ Ø´Ù‡Ø§Ø¯Ø© ISO 27001', authority: 'ISO', date: '2025-02-28', daysLeft: 24, priority: 'High', progress: 80 },
    { id: 3, title: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', authority: 'SDAIA', date: '2025-03-01', daysLeft: 25, priority: 'High', progress: 45 },
    { id: 4, title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', authority: 'SAMA', date: '2025-03-10', daysLeft: 34, priority: 'Medium', progress: 20 },
    { id: 5, title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', authority: 'NCA', date: '2025-03-15', daysLeft: 39, priority: 'Medium', progress: 10 },
  ];

  // Recent Activities
  const recentActivities = [
    { id: 1, user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', avatar: 'Ø£', action: 'Ø£Ø¨Ù„Øº NCA Ø¹Ù† Ø­Ø§Ø¯Ø«Ø©', target: 'INC-2025-002', time: '15 Ø¯Ù‚ÙŠÙ‚Ø©', type: 'incident', status: 'success' },
    { id: 2, user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', avatar: 'Ù†', action: 'Ø±ÙØ¹Øª Ø¯Ù„ÙŠÙ„ Ø§Ù…ØªØ«Ø§Ù„', target: 'EVD-2025-089', time: '32 Ø¯Ù‚ÙŠÙ‚Ø©', type: 'evidence', status: 'success' },
    { id: 3, user: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', avatar: 'Ø®', action: 'Ø§Ø¹ØªÙ…Ø¯ Ø³ÙŠØ§Ø³Ø©', target: 'POL-IS-007', time: '1 Ø³Ø§Ø¹Ø©', type: 'policy', status: 'success' },
    { id: 4, user: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', avatar: 'Ø³', action: 'Ø£Ù†Ø´Ø£Øª Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯', target: 'NCA-ECC-5.2.1', time: '2 Ø³Ø§Ø¹Ø©', type: 'obligation', status: 'success' },
    { id: 5, user: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', avatar: 'Ù…', action: 'Ø£ÙƒÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„', target: 'TST-2025-034', time: '3 Ø³Ø§Ø¹Ø§Øª', type: 'test', status: 'success' },
    { id: 6, user: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', avatar: 'Ù', action: 'Ø­Ø¯Ù‘Ø«Øª ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¶Ø¬', target: 'MAT-SAMA-Q1', time: '4 Ø³Ø§Ø¹Ø§Øª', type: 'maturity', status: 'success' },
  ];

  // Platform Modules
  const platformModules = [
    { id: 1, name: 'Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', icon: FileText, count: 127, status: 'active', trend: '+12', color: 'emerald' },
    { id: 2, name: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: BookOpen, count: 45, status: 'active', trend: '+3', color: 'purple' },
    { id: 3, name: 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FolderOpen, count: 456, status: 'active', trend: '+28', color: 'blue' },
    { id: 4, name: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Shield, count: 234, status: 'active', trend: '+8', color: 'indigo' },
    { id: 5, name: 'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', icon: ClipboardCheck, count: 89, status: 'active', trend: '+5', color: 'teal' },
    { id: 6, name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', icon: Zap, count: 23, status: 'warning', trend: '+3', color: 'red' },
    { id: 7, name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', icon: AlertTriangle, count: 12, status: 'active', trend: '-2', color: 'amber' },
    { id: 8, name: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¶Ø¬', icon: TrendingUp, count: 5, status: 'active', trend: '+1', color: 'cyan' },
  ];

  // Certifications & Standards
  const certifications = [
    { name: 'NCA-ECC', fullName: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', status: 'Compliant', score: 94, icon: 'ğŸ›¡ï¸' },
    { name: 'ISO 27001', fullName: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', status: 'Certified', score: 100, icon: 'ğŸ…' },
    { name: 'SAMA-CSF', fullName: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', status: 'Compliant', score: 89, icon: 'ğŸ¦' },
    { name: 'PDPL', fullName: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', status: 'Compliant', score: 91, icon: 'ğŸ”' },
    { name: 'PCI-DSS', fullName: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª', status: 'Compliant', score: 96, icon: 'ğŸ’³' },
  ];

  return (
    <div className="space-y-6">
      <div className="relative overflow-hidden rounded-3xl">
        <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
          <div className="absolute inset-0 opacity-30">
            <div className="absolute inset-0" style={{ backgroundImage: 'radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0)', backgroundSize: '40px 40px' }}></div>
          </div>
          <div className="absolute -top-40 -right-40 w-80 h-80 bg-emerald-500/30 rounded-full blur-[100px] animate-pulse"></div>
          <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-purple-500/30 rounded-full blur-[100px] animate-pulse" style={{ animationDelay: '1s' }}></div>
          <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-blue-500/20 rounded-full blur-[120px]"></div>
        </div>

        <div className="relative p-8">
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center gap-6">
              <div className="relative">
                <div className="w-20 h-20 bg-gradient-to-br from-emerald-400 via-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-emerald-500/50 transform hover:scale-105 transition-transform">
                  <Shield className="w-10 h-10 text-white" />
                </div>
                <div className="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-slate-900 flex items-center justify-center">
                  <CheckCircle2 className="w-3 h-3 text-white" />
                </div> </div>
              <div>
                <div className="flex items-center gap-3 mb-1">
                  <h1 className="text-3xl font-black text-white tracking-tight">Ù…Ø±ÙƒØ² Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</h1>
                  <span className="px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs font-bold rounded-lg border border-emerald-500/30">LIVE</span>
                </div>
                <p className="text-slate-400 text-lg">Compliance Command Center - Enterprise GRC Platform</p>
                <div className="flex items-center gap-4 mt-3">
                  <span className="flex items-center gap-2 px-3 py-1.5 bg-white/5 backdrop-blur rounded-lg border border-white/10 text-sm">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span className="text-slate-300">Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø©</span>
                  </span>
                  <span className="text-slate-500 text-sm">
                    Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {liveTime.toLocaleTimeString('ar-SA')}
                  </span> </div> </div> </div>
            <div className="flex items-center gap-4">
              <div className="flex bg-white/5 backdrop-blur rounded-xl p-1 border border-white/10">
                {[
                  { id: 'week', label: 'Ø£Ø³Ø¨ÙˆØ¹' },
                  { id: 'month', label: 'Ø´Ù‡Ø±' },
                  { id: 'quarter', label: 'Ø±Ø¨Ø¹ Ø³Ù†Ø©' },
                  { id: 'year', label: 'Ø³Ù†Ø©' },
                ].map(t => (
                  <button key={t.id} onClick={() => setTimeRange(t.id)}
                    className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${timeRange === t.id
                      ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/30'
                      : 'text-slate-400 hover:text-white hover:bg-white/5'
                      }`}>
                    {t.label}
                  </button>
                ))}
              </div>

              <div className="relative">
                <button onClick={() => setShowNotifications(!showNotifications)}
                  className="relative p-3 bg-white/5 backdrop-blur rounded-xl border border-white/10 hover:bg-white/10 transition-all">
                  <Bell className="w-6 h-6 text-white" />
                  <span className="absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full text-white text-xs font-bold flex items-center justify-center animate-pulse">
                    {criticalAlerts.length}
                  </span> </button>
                {showNotifications && (
                  <div className="absolute left-0 top-full mt-3 w-[420px] bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-slate-700 shadow-2xl z-50 overflow-hidden">
                    <div className="px-5 py-4 bg-gradient-to-r from-red-500/20 to-orange-500/20 border-b border-slate-700">
                      <div className="flex items-center justify-between">
                        <span className="font-black text-white flex items-center gap-2">
                          <AlertTriangle className="w-5 h-5 text-red-400" />ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ø§Ø¬Ù„Ø©
                        </span>
                        <span className="text-xs text-slate-400">{criticalAlerts.length} ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</span>
                      </div> </div>
                    <div className="max-h-80 overflow-y-auto">
                      {criticalAlerts.map(alert => (
                        <div key={alert.id} className={`p-4 border-b border-slate-800 hover:bg-white/5 transition-all ${alert.severity === 'Critical' ? 'bg-red-500/10' : ''
                          }`}>
                          <div className="flex items-start gap-3">
                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${alert.severity === 'Critical' ? 'bg-red-500/20' :
                              alert.severity === 'High' ? 'bg-orange-500/20' : 'bg-amber-500/20'
                              }`}>
                              {alert.type === 'incident' ? <Zap className="w-5 h-5 text-red-400" /> :
                                alert.type === 'deadline' ? <Clock className="w-5 h-5 text-orange-400" /> :
                                  <Shield className="w-5 h-5 text-amber-400" />}
                            </div>
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${alert.severity === 'Critical' ? 'bg-red-500 text-white' :
                                  alert.severity === 'High' ? 'bg-orange-500 text-white' : 'bg-amber-500 text-white'
                                  }`}>{alert.severity === 'Critical' ? 'Ø­Ø±Ø¬' : alert.severity === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span>
                                <span className="text-xs text-slate-500">Ù…Ù†Ø° {alert.time}</span>
                              </div>
                              <p className="font-bold text-white text-sm">{alert.title}</p>
                              <p className="text-xs text-slate-400 mt-1">{alert.message}</p>
                              <div className="flex items-center justify-between mt-2">
                                <span className="text-xs text-red-400 font-bold">{alert.deadline}</span>
                                <button className="px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-xs font-bold text-white transition-all">
                                  {alert.action}
                                </button> </div> </div> </div> </div>
                      ))}
                    </div> </div>
                )}
              </div>

              <button className="flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/30 hover:shadow-emerald-500/50 hover:scale-105 transition-all">
                <Download className="w-5 h-5" />
                <span>ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</span>
              </button> </div> </div>
          <div className="grid grid-cols-6 gap-4">
            <div className="col-span-2 relative overflow-hidden bg-gradient-to-br from-emerald-500/20 to-teal-500/10 backdrop-blur-xl rounded-2xl p-6 border border-emerald-500/30">
              <div className="absolute top-0 right-0 w-32 h-32 bg-emerald-500/20 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl"></div>
              <div className="relative flex items-center justify-between">
                <div>
                  <p className="text-emerald-300 font-medium mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
                  <div className="flex items-baseline gap-2">
                    <span className="text-6xl font-black text-white">{platformStats.complianceScore}</span>
                    <span className="text-2xl text-emerald-400">%</span>
                  </div>
                  <div className="flex items-center gap-2 mt-3">
                    <span className="flex items-center gap-1 px-2 py-1 bg-emerald-500/30 rounded-lg text-emerald-300 text-sm font-bold">
                      <ArrowUpRight className="w-4 h-4" />
                      +{(platformStats.complianceScore - platformStats.previousScore).toFixed(1)}%
                    </span>
                    <span className="text-slate-400 text-sm">Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</span>
                  </div> </div>
                <div className="relative w-32 h-32">
                  <svg className="w-32 h-32 transform -rotate-90">
                    <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.1)" strokeWidth="12" fill="none" />
                    <circle cx="64" cy="64" r="56" stroke="url(#complianceGradient)" strokeWidth="12" fill="none"
                      strokeDasharray={`${(platformStats.complianceScore / 100) * 352} 352`} strokeLinecap="round" />
                    <defs>
                      <linearGradient id="complianceGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stopColor="#10b981" />
                        <stop offset="100%" stopColor="#14b8a6" />
                      </linearGradient>
                    </defs>
                  </svg>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <Target className="w-12 h-12 text-emerald-400" />
                  </div> </div> </div> </div>
            <div className="bg-gradient-to-br from-purple-500/20 to-violet-500/10 backdrop-blur-xl rounded-2xl p-5 border border-purple-500/30">
              <div className="flex items-center gap-2 mb-3">
                <TrendingUp className="w-5 h-5 text-purple-400" />
                <span className="text-purple-300 font-medium text-sm">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¶Ø¬</span>
              </div>
              <div className="flex items-baseline gap-1 mb-3">
                <span className="text-4xl font-black text-white">L{Math.floor(platformStats.maturityLevel)}</span>
                <span className="text-purple-400 text-lg">.{String(platformStats.maturityLevel).split('.')[1] || '0'}</span>
              </div>
              <div className="flex gap-1 mb-2">
                {[1, 2, 3, 4, 5].map(l => (
                  <div key={l} className={`flex-1 h-2.5 rounded-full transition-all ${l <= Math.floor(platformStats.maturityLevel) ? 'bg-gradient-to-r from-purple-500 to-violet-500' :
                    l === Math.ceil(platformStats.maturityLevel) ? 'bg-purple-500/50' : 'bg-white/10'
                    }`} />
                ))}
              </div>
              <p className="text-slate-400 text-xs">Ù…Ù† 5.0 - Ù…Ø¹Ø§ÙŠÙŠØ± CMMI</p>
            </div>

            <div className="bg-gradient-to-br from-amber-500/20 to-orange-500/10 backdrop-blur-xl rounded-2xl p-5 border border-amber-500/30">
              <div className="flex items-center gap-2 mb-3">
                <AlertTriangle className="w-5 h-5 text-amber-400" />
                <span className="text-amber-300 font-medium text-sm">Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø®Ø§Ø·Ø±</span>
              </div>
              <div className="flex items-baseline gap-1 mb-3">
                <span className="text-4xl font-black text-white">{platformStats.riskScore}</span>
                <span className="text-amber-400 text-sm">/100</span>
              </div>
              <div className="h-2.5 bg-white/10 rounded-full overflow-hidden mb-2">
                <div className="h-full bg-gradient-to-r from-green-500 via-amber-500 to-red-500 rounded-full"
                  style={{ width: `${platformStats.riskScore}%` }} />
              </div>
              <p className="text-emerald-400 text-xs font-bold">Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø© âœ“</p>
            </div>

            <div className="bg-gradient-to-br from-blue-500/20 to-cyan-500/10 backdrop-blur-xl rounded-2xl p-5 border border-blue-500/30">
              <div className="flex items-center gap-2 mb-3">
                <Shield className="w-5 h-5 text-blue-400" />
                <span className="text-blue-300 font-medium text-sm">Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªÙØªÙŠØ´</span>
              </div>
              <div className="flex items-baseline gap-1 mb-3">
                <span className="text-4xl font-black text-white">{platformStats.inspectionReadiness}</span>
                <span className="text-blue-400 text-lg">%</span>
              </div>
              <div className="h-2.5 bg-white/10 rounded-full overflow-hidden mb-2">
                <div className="h-full bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full"
                  style={{ width: `${platformStats.inspectionReadiness}%` }} />
              </div>
              <p className="text-blue-400 text-xs font-bold">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙØªÙŠØ´ âœ“</p>
            </div>

            <div className={`relative overflow-hidden backdrop-blur-xl rounded-2xl p-5 border ${platformStats.criticalIncidents > 0
              ? 'bg-gradient-to-br from-red-500/30 to-rose-500/20 border-red-500/50'
              : 'bg-gradient-to-br from-slate-500/20 to-slate-600/10 border-slate-500/30'
              }`}>
              {platformStats.criticalIncidents > 0 && (
                <div className="absolute inset-0 bg-red-500/10 animate-pulse"></div>
              )}
              <div className="relative">
                <div className="flex items-center gap-2 mb-3">
                  <Zap className={`w-5 h-5 ${platformStats.criticalIncidents > 0 ? 'text-red-400' : 'text-slate-400'}`} />
                  <span className={`font-medium text-sm ${platformStats.criticalIncidents > 0 ? 'text-red-300' : 'text-slate-300'}`}>Ø­ÙˆØ§Ø¯Ø« Ù†Ø´Ø·Ø©</span>
                </div>
                <div className="flex items-baseline gap-2 mb-3">
                  <span className="text-4xl font-black text-white">{platformStats.activeIncidents}</span>
                  <span className="text-slate-400 text-sm">Ù…Ù† {platformStats.totalIncidents}</span>
                </div>
                <div className="flex gap-2">
                  {platformStats.criticalIncidents > 0 && (
                    <span className="px-2 py-1 bg-red-500/30 text-red-300 rounded text-xs font-bold animate-pulse">
                      {platformStats.criticalIncidents} Ø­Ø±Ø¬
                    </span>
                  )}
                  <span className="px-2 py-1 bg-amber-500/30 text-amber-300 rounded text-xs font-bold">
                    {platformStats.activeIncidents - platformStats.criticalIncidents} Ø¹Ø§Ù„ÙŠ
                  </span> </div> </div> </div> </div> </div>
      </div>
      <div className="grid grid-cols-5 gap-4">
        {platformStats.authorities.map(auth => (
          <div key={auth.code} className={`group relative overflow-hidden bg-white rounded-2xl border-2 border-slate-200 p-5 hover:border-${auth.color}-400 hover:shadow-xl hover:shadow-${auth.color}-500/10 transition-all cursor-pointer`}>
            <div className={`absolute inset-0 bg-gradient-to-br from-${auth.color}-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity`}></div>
            <div className="relative">
              <div className="flex items-center justify-between mb-4">
                <div className={`w-12 h-12 rounded-xl bg-${auth.color}-100 flex items-center justify-center group-hover:scale-110 transition-transform`}>
                  <auth.icon className={`w-6 h-6 text-${auth.color}-600`} />
                </div>
                <div className={`px-3 py-1.5 rounded-xl font-black text-lg ${auth.compliance >= 90 ? 'bg-emerald-100 text-emerald-700' :
                  auth.compliance >= 70 ? 'bg-amber-100 text-amber-700' :
                    'bg-red-100 text-red-700'
                  }`}>{auth.compliance}%</div>
              </div>
              <h4 className="font-black text-slate-800 text-lg">{auth.code}</h4>
              <p className="text-slate-500 text-sm mt-0.5 line-clamp-1">{auth.name}</p>
              <div className="mt-4">
                <div className="flex items-center justify-between text-sm mb-2">
                  <span className="text-slate-400">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</span>
                  <span className="font-bold text-slate-700">{auth.obligations}</span>
                </div>
                <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                  <div className={`h-full rounded-full bg-gradient-to-r ${auth.compliance >= 90 ? 'from-emerald-400 to-emerald-500' :
                    auth.compliance >= 70 ? 'from-amber-400 to-amber-500' :
                      'from-red-400 to-red-500'
                    }`} style={{ width: `${auth.compliance}%` }} />
                </div> </div> </div> </div>
        ))}
      </div>

      <div className="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 rounded-2xl p-6 border border-slate-700">
        <div className="flex items-center justify-between mb-6">
          <div className="flex items-center gap-3">
            <Award className="w-6 h-6 text-amber-400" />
            <h3 className="text-xl font-black text-white">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h3>
          </div>
          <span className="text-slate-400 text-sm">{certifications.length} Ø´Ù‡Ø§Ø¯Ø§Øª Ù†Ø´Ø·Ø©</span>
        </div>
        <div className="grid grid-cols-5 gap-4">
          {certifications.map(cert => (
            <div key={cert.name} className="bg-white/5 backdrop-blur rounded-xl p-4 border border-white/10 hover:border-white/30 hover:bg-white/10 transition-all cursor-pointer group">
              <div className="flex items-center justify-between mb-3">
                <span className="text-3xl group-hover:scale-110 transition-transform">{cert.icon}</span>
                <span className={`px-2 py-1 rounded-lg text-xs font-bold ${cert.status === 'Certified' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-blue-500/20 text-blue-400'
                  }`}>{cert.status === 'Certified' ? 'Ù…Ø¹ØªÙ…Ø¯' : 'Ù…Ù„ØªØ²Ù…'}</span>
              </div>
              <h4 className="font-black text-white text-lg">{cert.name}</h4>
              <p className="text-slate-400 text-xs mt-1 line-clamp-1">{cert.fullName}</p>
              <div className="mt-3 flex items-center gap-2">
                <div className="flex-1 h-1.5 bg-white/10 rounded-full overflow-hidden">
                  <div className="h-full bg-gradient-to-r from-emerald-400 to-teal-400 rounded-full" style={{ width: `${cert.score}%` }} />
                </div>
                <span className="text-emerald-400 text-sm font-bold">{cert.score}%</span>
              </div> </div>
          ))}
        </div> </div>
      <div className="grid grid-cols-12 gap-6">
        <div className="col-span-4 space-y-6">
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-5 py-4 bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
              <div className="flex items-center justify-between">
                <h3 className="font-black text-slate-800 flex items-center gap-2">
                  <Layers className="w-5 h-5 text-slate-600" />
                  ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©
                </h3>
                <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold">
                  {platformModules.length} ÙˆØ­Ø¯Ø©
                </span> </div> </div>
            <div className="p-4 space-y-2">
              {platformModules.map((module, idx) => (
                <div key={module.id} className="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-all cursor-pointer group">
                  <span className="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-sm font-bold text-slate-600 group-hover:bg-slate-200 transition-colors">
                    {idx + 1}
                  </span>
                  <div className={`w-10 h-10 rounded-xl bg-${module.color}-100 flex items-center justify-center group-hover:scale-110 transition-transform`}>
                    <module.icon className={`w-5 h-5 text-${module.color}-600`} />
                  </div>
                  <div className="flex-1">
                    <p className="font-bold text-slate-800 text-sm">{module.name}</p>
                  </div>
                  <span className={`px-2.5 py-1 rounded-lg text-sm font-bold ${module.status === 'warning' ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-700'
                    }`}>{module.count}</span>
                  <span className={`text-xs font-bold ${module.trend.startsWith('+') ? 'text-emerald-600' : 'text-red-600'}`}>
                    {module.trend}
                  </span> </div>
              ))}
            </div> </div>
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
              <FileText className="w-8 h-8 text-emerald-600 mb-3" />
              <p className="text-3xl font-black text-slate-800">{platformStats.totalObligations}</p>
              <p className="text-emerald-700 font-medium">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</p>
              <p className="text-sm text-emerald-600 mt-1">{platformStats.activeObligations} Ù†Ø´Ø·</p>
            </div>
            <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-5 border-2 border-purple-200">
              <BookOpen className="w-8 h-8 text-purple-600 mb-3" />
              <p className="text-3xl font-black text-slate-800">{platformStats.totalPolicies}</p>
              <p className="text-purple-700 font-medium">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</p>
              <p className="text-sm text-purple-600 mt-1">{platformStats.activePolicies} Ù…Ø¹ØªÙ…Ø¯Ø©</p>
            </div>
            <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
              <Shield className="w-8 h-8 text-blue-600 mb-3" />
              <p className="text-3xl font-black text-slate-800">{platformStats.totalControls}</p>
              <p className="text-blue-700 font-medium">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</p>
              <p className="text-sm text-blue-600 mt-1">{platformStats.implementedControls} Ù…ÙØ·Ø¨Ù‘Ù‚</p>
            </div>
            <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
              <FolderOpen className="w-8 h-8 text-amber-600 mb-3" />
              <p className="text-3xl font-black text-slate-800">{platformStats.totalEvidence}</p>
              <p className="text-amber-700 font-medium">Ø§Ù„Ø£Ø¯Ù„Ø©</p>
              <p className="text-sm text-amber-600 mt-1">{platformStats.validEvidence} ØµØ§Ù„Ø­</p>
            </div> </div> </div>
        <div className="col-span-4 space-y-6">
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-5 py-4 bg-gradient-to-r from-amber-50 to-orange-50 border-b-2 border-slate-200">
              <div className="flex items-center justify-between">
                <h3 className="font-black text-slate-800 flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-amber-600" />
                  Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ø§Øª
                </h3>
                <button className="text-amber-600 text-sm font-bold hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
              </div> </div>
            <div className="p-4 space-y-3">
              {upcomingDeadlines.map(deadline => (
                <div key={deadline.id} className={`p-4 rounded-xl border-2 ${deadline.priority === 'Critical' ? 'border-red-200 bg-red-50' :
                  deadline.priority === 'High' ? 'border-amber-200 bg-amber-50' :
                    'border-slate-200 bg-slate-50'
                  }`}>
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex-1">
                      <p className="font-bold text-slate-800 text-sm">{deadline.title}</p>
                      <div className="flex items-center gap-2 mt-1">
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${deadline.authority === 'SAMA' ? 'bg-emerald-100 text-emerald-700' :
                          deadline.authority === 'NCA' ? 'bg-purple-100 text-purple-700' :
                            deadline.authority === 'SDAIA' ? 'bg-indigo-100 text-indigo-700' :
                              'bg-blue-100 text-blue-700'
                          }`}>{deadline.authority}</span>
                        <span className="text-xs text-slate-500">{deadline.date}</span>
                      </div> </div>
                    <div className={`px-3 py-1.5 rounded-xl text-center ${deadline.daysLeft <= 7 ? 'bg-red-500 text-white' :
                      deadline.daysLeft <= 14 ? 'bg-amber-500 text-white' :
                        deadline.daysLeft <= 30 ? 'bg-blue-500 text-white' :
                          'bg-emerald-500 text-white'
                      }`}>
                      <span className="text-lg font-black">{deadline.daysLeft}</span>
                      <span className="text-[10px] block">ÙŠÙˆÙ…</span>
                    </div> </div>
                  <div className="flex items-center gap-2">
                    <div className="flex-1 h-2 bg-white rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${deadline.progress >= 70 ? 'bg-emerald-500' :
                        deadline.progress >= 40 ? 'bg-amber-500' : 'bg-red-500'
                        }`} style={{ width: `${deadline.progress}%` }} />
                    </div>
                    <span className="text-xs font-bold text-slate-600">{deadline.progress}%</span>
                  </div> </div>
              ))}
            </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-5 py-4 bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
              <h3 className="font-black text-slate-800 flex items-center gap-2">
                <BarChart3 className="w-5 h-5 text-slate-600" />
                ØªØ·ÙˆØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„
              </h3>
            </div>
            <div className="p-5">
              <div className="flex items-end gap-3 h-40">
                {platformStats.monthlyTrend.map((m, idx) => (
                  <div key={idx} className="flex-1 flex flex-col items-center gap-2">
                    <span className="text-xs font-bold text-slate-600">{m.score}%</span>
                    <div className="w-full bg-slate-100 rounded-t-lg overflow-hidden" style={{ height: '120px' }}>
                      <div className={`w-full rounded-t-lg transition-all ${idx === platformStats.monthlyTrend.length - 1
                        ? 'bg-gradient-to-t from-emerald-500 to-emerald-400'
                        : 'bg-gradient-to-t from-slate-400 to-slate-300'
                        }`} style={{ height: `${m.score}%`, marginTop: `${100 - m.score}%` }} />
                    </div>
                    <span className="text-[10px] text-slate-500">{m.month}</span>
                  </div>
                ))}
              </div> </div> </div> </div>
        <div className="col-span-4 space-y-6">
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-5 py-4 bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
              <div className="flex items-center justify-between">
                <h3 className="font-black text-slate-800 flex items-center gap-2">
                  <Activity className="w-5 h-5 text-slate-600" />
                  Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©
                </h3>
                <span className="text-xs text-slate-400">Ù…Ø¨Ø§Ø´Ø±</span>
              </div> </div>
            <div className="p-4 space-y-2">
              {recentActivities.map(activity => (
                <div key={activity.id} className="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-all">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white ${activity.type === 'incident' ? 'bg-red-500' :
                    activity.type === 'evidence' ? 'bg-blue-500' :
                      activity.type === 'policy' ? 'bg-purple-500' :
                        activity.type === 'obligation' ? 'bg-emerald-500' :
                          activity.type === 'test' ? 'bg-amber-500' : 'bg-indigo-500'
                    }`}>{activity.avatar}</div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm text-slate-800 truncate">
                      <span className="font-bold">{activity.user}</span> {activity.action}
                    </p>
                    <p className="text-xs text-slate-500">{activity.target} â€¢ {activity.time}</p>
                  </div>
                  <CheckCircle2 className="w-5 h-5 text-emerald-500 flex-shrink-0" />
                </div>
              ))}
            </div> </div>
          <div className="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl overflow-hidden">
            <div className="px-5 py-4 border-b border-slate-700">
              <h3 className="font-black text-white flex items-center gap-2">
                <Zap className="w-5 h-5 text-amber-400" />
                Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
              </h3>
            </div>
            <div className="p-4 grid grid-cols-2 gap-3">
              {[
                { icon: Plus, label: 'Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯', color: 'emerald', bg: 'bg-emerald-500' },
                { icon: FileText, label: 'Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©', color: 'purple', bg: 'bg-purple-500' },
                { icon: Upload, label: 'Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„', color: 'blue', bg: 'bg-blue-500' },
                { icon: Zap, label: 'ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø«Ø©', color: 'red', bg: 'bg-red-500' },
                { icon: ClipboardCheck, label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„', color: 'amber', bg: 'bg-amber-500' },
                { icon: TrendingUp, label: 'ØªÙ‚ÙŠÙŠÙ… Ù†Ø¶Ø¬', color: 'indigo', bg: 'bg-indigo-500' },
                { icon: MessageSquare, label: 'Ù…Ø±Ø§Ø³Ù„Ø© Ø¬Ù‡Ø©', color: 'teal', bg: 'bg-teal-500' },
                { icon: BarChart3, label: 'ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯', color: 'cyan', bg: 'bg-cyan-500' },
              ].map((action, idx) => (
                <button key={idx} className="flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all group">
                  <div className={`w-10 h-10 ${action.bg} rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg`}>
                    <action.icon className="w-5 h-5 text-white" />
                  </div>
                  <span className="text-sm font-bold text-white">{action.label}</span>
                </button>
              ))}
            </div> </div>
          <div className="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl p-5 text-white relative overflow-hidden">
            <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl"></div>
            <div className="relative">
              <div className="flex items-center gap-3 mb-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <Eye className="w-6 h-6" />
                </div>
                <div>
                  <p className="text-indigo-200 text-sm">Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ù‚Ø§Ø¯Ù…</p>
                  <p className="font-black text-xl">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</p>
                </div> </div>
              <div className="flex items-center justify-between bg-white/10 rounded-xl p-4">
                <div>
                  <p className="text-indigo-200 text-xs">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                  <p className="font-bold text-lg">19 ÙØ¨Ø±Ø§ÙŠØ± 2025</p>
                </div>
                <div className="text-center bg-white/20 rounded-xl px-5 py-2">
                  <p className="text-3xl font-black">15</p>
                  <p className="text-xs text-indigo-200">ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</p>
                </div> </div>
              <button className="w-full mt-4 py-3 bg-white text-indigo-700 rounded-xl font-bold hover:bg-indigo-50 transition-all flex items-center justify-center gap-2">
                <Shield className="w-5 h-5" />
                Ø¹Ø±Ø¶ Ø®Ø·Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±
              </button> </div> </div> </div> </div> </div>
  );
};

const PlaceholderScreen = ({ title, subtitle }) => (
  <div className="flex flex-col items-center justify-center h-96 bg-gradient-to-br from-slate-50 to-slate-100 rounded-3xl border-2 border-dashed border-slate-300">
    <Shield className="w-10 h-10 text-emerald-600" />
    <h2 className="text-xl font-bold text-slate-700 mt-4">{title}</h2>
    <p className="text-slate-500 mt-1">{subtitle}</p>
  </div>);
const PoliciesStandards = () => {
  const [view, setView] = useState('dashboard');
  const [selectedPolicyId, setSelectedPolicyId] = useState(null);
  const [activeTab, setActiveTab] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategory, setFilterCategory] = useState('');
  const [filterType, setFilterType] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [viewMode, setViewMode] = useState('table');
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [createData, setCreateData] = useState(null);
  // Attestation Manager State
  const [showAttestationManager, setShowAttestationManager] = useState(false);
  const [selectedCampaign, setSelectedCampaign] = useState(null);
  const [selectedPolicyForAttestation, setSelectedPolicyForAttestation] = useState(null);
  // Edit & Delete State
  const [showEditModal, setShowEditModal] = useState(false);
  const [editingPolicy, setEditingPolicy] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deletingPolicy, setDeletingPolicy] = useState(null);

  // EDIT & DELETE HANDLERS
  const handleEditPolicy = (policy, e) => {
    e?.stopPropagation();
    setEditingPolicy({ ...policy });
    setShowEditModal(true);
  };

  const handleSaveEdit = () => {
    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ API
    alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø³Ø©: ${editingPolicy.title}`);
    setShowEditModal(false);
    setEditingPolicy(null);
  };

  const handleDeletePolicy = (policy, e) => {
    e?.stopPropagation();
    setDeletingPolicy(policy);
    setShowDeleteConfirm(true);
  };

  const confirmDelete = () => {
    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ API
    const typeLabel = deletingPolicy.type === 'Standard' ? 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø±' : deletingPolicy.type === 'Procedure' ? 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©';
    alert(`ØªÙ… Ø­Ø°Ù ${typeLabel}: ${deletingPolicy.title}`);
    setShowDeleteConfirm(false);
    setDeletingPolicy(null);
  };

  // ATTESTATION HELPERS
  const getAttestationSummary = (policyId) => {
    const campaign = ATTESTATION_CAMPAIGNS.find(c => c.policyId === policyId);
    if (!campaign) return { status: 'NotLaunched', completionPercent: 0, overdueCount: 0, campaign: null };
    const completionPercent = campaign.totalRecipients > 0 ? Math.round((campaign.acknowledged / campaign.totalRecipients) * 100) : 0;
    return {
      status: campaign.status === 'Completed' ? 'Closed' : campaign.status,
      completionPercent,
      overdueCount: campaign.overdue || 0, pendingCount: campaign.pending || 0,
      campaign,
    };
  };

  const handleLaunchAttestation = (policyId) => {
    const policy = POLICIES.find(p => p.id === policyId);
    setSelectedPolicyForAttestation(policy);
    setSelectedCampaign(null);
    setShowAttestationManager(true);
  };

  const handleManageAttestation = (campaign) => {
    const policy = POLICIES.find(p => p.id === campaign.policyId);
    setSelectedPolicyForAttestation(policy);
    setSelectedCampaign(campaign);
    setShowAttestationManager(true);
  };

  // COMPUTED KPIs
  const kpis = useMemo(() => {
    const today = new Date().toISOString().split('T')[0];
    const in30Days = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    return {
      total: POLICIES.length,
      active: POLICIES.filter(p => p.status === 'Active').length,
      draft: POLICIES.filter(p => p.status === 'Draft').length,
      underReview: POLICIES.filter(p => p.status === 'UnderReview').length,
      dueReviews: POLICIES.filter(p => p.nextReviewDate && p.nextReviewDate <= in30Days && p.status === 'Active').length,
      overdueReviews: POLICIES.filter(p => p.nextReviewDate && p.nextReviewDate < today && p.status === 'Active').length,
      critical: POLICIES.filter(p => p.impactLevel === 'Critical').length,
      highImpact: POLICIES.filter(p => ['UnderReview', 'Draft'].includes(p.status) && ['Critical', 'High'].includes(p.impactLevel)).length,
      overdueAttestations: ATTESTATION_CAMPAIGNS.reduce((s, c) => s + c.overdue, 0),
      pendingAttestations: ATTESTATION_CAMPAIGNS.reduce((s, c) => s + c.pending, 0),
      totalReqs: STANDARD_REQUIREMENTS.length,
      policies: POLICIES.filter(p => p.type === 'Policy').length,
      standards: POLICIES.filter(p => p.type === 'Standard').length,
      procedures: POLICIES.filter(p => p.type === 'Procedure').length,
    };
  }, []);

  // FILTERED DATA
  const filtered = useMemo(() => {
    return POLICIES.filter(p => {
      const matchSearch = !searchTerm || p.title.includes(searchTerm) || p.code.includes(searchTerm);
      const matchCategory = !filterCategory || p.category === filterCategory;
      const matchType = !filterType || p.type === filterType;
      const matchStatus = !filterStatus || p.status === filterStatus;
      const matchTab = activeTab === 'all' ||
        (activeTab === 'policies' && p.type === 'Policy') ||
        (activeTab === 'standards' && p.type === 'Standard') ||
        (activeTab === 'procedures' && p.type === 'Procedure') ||
        (activeTab === 'pending' && ['Draft', 'UnderReview'].includes(p.status)) ||
        (activeTab === 'review' && p.nextReviewDate && p.nextReviewDate <= new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]);
      return matchSearch && matchCategory && matchType && matchStatus && matchTab;
    });
  }, [searchTerm, filterCategory, filterType, filterStatus, activeTab]);

  const getUser = (id) => USERS.find(u => u.id === id);
  const getCat = (c) => CATEGORIES.find(x => x.code === c);

  // HANDLERS
  const openWorkspace = (id) => { setSelectedPolicyId(id); setView('workspace'); };
  const closeWorkspace = () => { setSelectedPolicyId(null); setView('dashboard'); };

  const handleCreate = () => {
    setCreateData({
      id: null, code: `POL-${String(POLICIES.length + 1).padStart(3, '0')}`,
      title: '', titleEn: '', type: 'Policy', category: 'Compliance',
      ownerId: null, reviewerId: null, approverId: null, currentVersion: '1.0',
      effectiveDate: '', nextReviewDate: '', status: 'Draft', impactLevel: 'Medium',
      summary: '', scope: '', objectives: [],
    });
    setShowCreateModal(true);
  };

  // RENDER WORKSPACE VIEW
  if (view === 'workspace' && selectedPolicyId) {
    return <PolicyWorkspace policyId={selectedPolicyId} onClose={closeWorkspace} />;
  }

  // RENDER COMMAND CENTER DASHBOARD - PREMIUM EDITION
  return (
    <div className="space-y-6">
      <div className="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 rounded-3xl p-6 text-white shadow-2xl shadow-emerald-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-5">
            <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center">
              <FileText className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-2xl font-black">Ù…Ø±ÙƒØ² Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</h1>
              <p className="text-emerald-100 text-sm mt-1">Policy & Standards Command Center - Enterprise Edition</p>
            </div> </div>
          <div className="flex items-center gap-3">
            <div className="bg-white/10 backdrop-blur rounded-xl px-5 py-3 text-center">
              <p className="text-emerald-200 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚</p>
              <p className="text-3xl font-black">{kpis.total}</p>
            </div>
            <div className="bg-white/10 backdrop-blur rounded-xl px-5 py-3 text-center">
              <p className="text-emerald-200 text-xs">Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
              <p className="text-3xl font-black">{Math.round((kpis.active / kpis.total) * 100)}%</p>
            </div>
            <button className="flex items-center gap-2 px-4 py-3 bg-white/10 backdrop-blur rounded-xl text-sm hover:bg-white/20 transition-all">
              <Download className="w-5 h-5" />
              ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button onClick={handleCreate} className="flex items-center gap-2 px-5 py-3 bg-white text-emerald-700 rounded-xl text-sm font-bold hover:bg-emerald-50 transition-all shadow-lg">
              <Plus className="w-5 h-5" />
              Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button> </div> </div> </div>
      <div className="grid grid-cols-8 gap-4">
        <div className="col-span-1 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 text-white shadow-lg shadow-emerald-500/20">
          <div className="flex items-center justify-between mb-3">
            <CheckCircle2 className="w-8 h-8 opacity-80" />
            <span className="text-3xl font-black">{kpis.active}</span>
          </div>
          <p className="text-sm font-medium text-emerald-100">Ø³ÙŠØ§Ø³Ø§Øª Ù†Ø´Ø·Ø©</p>
          <p className="text-xs text-emerald-200 mt-1">Active Policies</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-amber-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <Clock className="w-8 h-8 text-amber-500" />
            <span className="text-3xl font-black text-amber-600">{kpis.underReview}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
          <p className="text-xs text-slate-500 mt-1">Under Review</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-blue-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <FileText className="w-8 h-8 text-blue-500" />
            <span className="text-3xl font-black text-blue-600">{kpis.draft}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ù…Ø³ÙˆØ¯Ø§Øª</p>
          <p className="text-xs text-slate-500 mt-1">Drafts</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-orange-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <Calendar className="w-8 h-8 text-orange-500" />
            <span className="text-3xl font-black text-orange-600">{kpis.dueReviews}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø³ØªØ­Ù‚Ø©</p>
          <p className="text-xs text-slate-500 mt-1">Due Reviews</p>
        </div>

        <div className="col-span-1 bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-4 text-white shadow-lg shadow-red-500/20">
          <div className="flex items-center justify-between mb-3">
            <AlertTriangle className="w-8 h-8 opacity-80" />
            <span className="text-3xl font-black">{kpis.overdueReviews}</span>
          </div>
          <p className="text-sm font-medium text-red-100">Ù…ØªØ£Ø®Ø±Ø©</p>
          <p className="text-xs text-red-200 mt-1">Overdue</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-purple-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <CheckSquare className="w-8 h-8 text-purple-500" />
            <span className="text-3xl font-black text-purple-600">{kpis.pendingAttestations}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
          <p className="text-xs text-slate-500 mt-1">Pending</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-rose-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <Zap className="w-8 h-8 text-rose-500" />
            <span className="text-3xl font-black text-rose-600">{kpis.critical}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ø­Ø±Ø¬Ø©</p>
          <p className="text-xs text-slate-500 mt-1">Critical</p>
        </div>

        <div className="col-span-1 bg-white rounded-2xl p-4 border-2 border-indigo-200 shadow-lg">
          <div className="flex items-center justify-between mb-3">
            <ClipboardCheck className="w-8 h-8 text-indigo-500" />
            <span className="text-3xl font-black text-indigo-600">{kpis.totalReqs}</span>
          </div>
          <p className="text-sm font-medium text-slate-700">Ù…ØªØ·Ù„Ø¨Ø§Øª</p>
          <p className="text-xs text-slate-500 mt-1">Requirements</p>
        </div> </div>
      <div className="grid grid-cols-3 gap-4">
        <div className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:border-emerald-300 hover:shadow-lg transition-all cursor-pointer group"
          onClick={() => setActiveTab('policies')}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-14 h-14 rounded-2xl bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition-all">
                <span className="text-3xl group-hover:scale-110 transition-transform">ğŸ“œ</span>
              </div>
              <div>
                <h3 className="text-lg font-bold text-slate-800">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</h3>
                <p className="text-sm text-slate-500">Policies</p>
              </div> </div>
            <div className="text-left">
              <p className="text-4xl font-black text-emerald-600">{kpis.policies}</p>
              <p className="text-xs text-slate-400">ÙˆØ«ÙŠÙ‚Ø©</p>
            </div> </div>
          <div className="mt-4 flex items-center gap-2">
            <div className="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
              <div className="h-full bg-emerald-500 rounded-full" style={{ width: `${(kpis.policies / kpis.total) * 100}%` }} />
            </div>
            <span className="text-sm font-bold text-emerald-600">{Math.round((kpis.policies / kpis.total) * 100)}%</span>
          </div> </div>
        <div className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:border-blue-300 hover:shadow-lg transition-all cursor-pointer group"
          onClick={() => setActiveTab('standards')}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-14 h-14 rounded-2xl bg-blue-100 flex items-center justify-center group-hover:bg-blue-500 transition-all">
                <span className="text-3xl group-hover:scale-110 transition-transform">ğŸ“‹</span>
              </div>
              <div>
                <h3 className="text-lg font-bold text-slate-800">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</h3>
                <p className="text-sm text-slate-500">Standards</p>
              </div> </div>
            <div className="text-left">
              <p className="text-4xl font-black text-blue-600">{kpis.standards}</p>
              <p className="text-xs text-slate-400">ÙˆØ«ÙŠÙ‚Ø©</p>
            </div> </div>
          <div className="mt-4 flex items-center gap-2">
            <div className="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
              <div className="h-full bg-blue-500 rounded-full" style={{ width: `${(kpis.standards / kpis.total) * 100}%` }} />
            </div>
            <span className="text-sm font-bold text-blue-600">{Math.round((kpis.standards / kpis.total) * 100)}%</span>
          </div> </div>
        <div className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:border-purple-300 hover:shadow-lg transition-all cursor-pointer group"
          onClick={() => setActiveTab('procedures')}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-14 h-14 rounded-2xl bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition-all">
                <span className="text-3xl group-hover:scale-110 transition-transform">ğŸ“</span>
              </div>
              <div>
                <h3 className="text-lg font-bold text-slate-800">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
                <p className="text-sm text-slate-500">Procedures</p>
              </div> </div>
            <div className="text-left">
              <p className="text-4xl font-black text-purple-600">{kpis.procedures}</p>
              <p className="text-xs text-slate-400">ÙˆØ«ÙŠÙ‚Ø©</p>
            </div> </div>
          <div className="mt-4 flex items-center gap-2">
            <div className="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
              <div className="h-full bg-purple-500 rounded-full" style={{ width: `${(kpis.procedures / kpis.total) * 100}%` }} />
            </div>
            <span className="text-sm font-bold text-purple-600">{Math.round((kpis.procedures / kpis.total) * 100)}%</span>
          </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex items-center justify-between border-b border-slate-200 px-4 bg-slate-50">
          <div className="flex">
            {[
              { id: 'all', label: 'Ø§Ù„ÙƒÙ„', count: kpis.total },
              { id: 'policies', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', count: kpis.policies, icon: 'ğŸ“œ' },
              { id: 'standards', label: 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±', count: kpis.standards, icon: 'ğŸ“‹' },
              { id: 'procedures', label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', count: kpis.procedures, icon: 'ğŸ“' },
              { id: 'pending', label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„', count: kpis.draft + kpis.underReview, badge: 'amber' },
              { id: 'review', label: 'ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©', count: kpis.dueReviews, badge: 'red' },
            ].map(tab => (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-5 py-4 font-medium border-b-2 transition-all ${activeTab === tab.id ? 'border-emerald-500 text-emerald-700 bg-white -mb-px' : 'border-transparent text-slate-500 hover:text-slate-700'
                  }`}>
                {tab.icon && <span>{tab.icon}</span>}
                {tab.label}
                <span className={`px-2 py-0.5 rounded-lg text-xs font-bold ${tab.badge === 'amber' ? 'bg-amber-100 text-amber-700' :
                  tab.badge === 'red' ? 'bg-red-100 text-red-700' :
                    activeTab === tab.id ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'
                  }`}>{tab.count}</span>
              </button>
            ))}
          </div>
          <div className="flex items-center gap-2">
            <button onClick={() => setViewMode('table')} className={`p-2.5 rounded-lg ${viewMode === 'table' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-400'}`}>
              <LayoutList className="w-5 h-5" />
            </button>
            <button onClick={() => setViewMode('cards')} className={`p-2.5 rounded-lg ${viewMode === 'cards' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-400'}`}>
              <LayoutGrid className="w-5 h-5" />
            </button> </div> </div>
        <div className="flex items-center gap-4 p-4 border-b border-slate-100">
          <div className="flex-1 relative">
            <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
            <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pr-12 pl-4 py-2.5 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500" />
          </div>
          <select value={filterType} onChange={(e) => setFilterType(e.target.value)}
            className="px-4 py-2.5 border-2 border-slate-200 rounded-xl bg-white">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
            {POLICY_TYPES.map(t => <option key={t.code} value={t.code}>{t.icon} {t.nameAr}</option>)}
          </select>
          <select value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}
            className="px-4 py-2.5 border-2 border-slate-200 rounded-xl bg-white">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
            {CATEGORIES.map(c => <option key={c.code} value={c.code}>{c.nameAr}</option>)}
          </select>
          <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
            className="px-4 py-2.5 border-2 border-slate-200 rounded-xl bg-white">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            <option value="Active">Ù†Ø´Ø·</option>
            <option value="Draft">Ù…Ø³ÙˆØ¯Ø©</option>
            <option value="UnderReview">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
          </select>
        </div>

        {viewMode === 'table' ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-slate-50 border-b border-slate-200">
                  <th className="text-right px-5 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                  <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø£Ø«Ø±</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700 w-24">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr> </thead>
              <tbody>
                {filtered.map((p, idx) => {
                  const owner = getUser(p.ownerId);
                  const isOverdue = p.nextReviewDate && p.nextReviewDate < new Date().toISOString().split('T')[0];
                  return (
                    <tr key={p.id} onClick={() => openWorkspace(p.id)}
                      className={`border-b border-slate-100 hover:bg-emerald-50/50 cursor-pointer ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/30'}`}>
                      <td className="px-5 py-4">
                        <span className="font-mono text-sm font-bold text-emerald-600 bg-emerald-50 px-2.5 py-1 rounded-lg">{p.code}</span>
                      </td>
                      <td className="px-4 py-4">
                        <p className="font-semibold text-slate-900">{p.title}</p>
                        <p className="text-xs text-slate-500">{p.titleEn}</p>
                      </td>
                      <td className="px-4 py-4 text-center text-lg">{POLICY_TYPES.find(t => t.code === p.type)?.icon}</td>
                      <td className="px-4 py-4 text-center"><span className="font-mono text-sm font-bold text-blue-600">v{p.currentVersion}</span></td>
                      <td className="px-4 py-4 text-center">
                        <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${p.impactLevel === 'Critical' ? 'bg-red-100 text-red-700' :
                          p.impactLevel === 'High' ? 'bg-orange-100 text-orange-700' :
                            p.impactLevel === 'Medium' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-600'
                          }`}>
                          {p.impactLevel === 'Critical' ? 'Ø­Ø±Ø¬' : p.impactLevel === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : p.impactLevel === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}
                        </span> </td>
                      <td className="px-4 py-4 text-center">
                        <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${p.status === 'Active' ? 'bg-emerald-100 text-emerald-700' :
                          p.status === 'Draft' ? 'bg-slate-100 text-slate-600' :
                            p.status === 'UnderReview' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                          }`}>
                          {p.status === 'Active' ? 'â— Ù†Ø´Ø·' : p.status === 'Draft' ? 'â—‹ Ù…Ø³ÙˆØ¯Ø©' : p.status === 'UnderReview' ? 'â— Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : p.status}
                        </span> </td>
                      <td className="px-4 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                        {(() => {
                          const att = getAttestationSummary(p.id);
                          if (att.status === 'NotLaunched') {
                            return (
                              <div className="flex items-center justify-center gap-2">
                                <span className="px-2.5 py-1 bg-slate-100 text-slate-500 rounded-lg text-xs font-medium">Ù„Ù… ØªÙØ·Ù„Ù‚</span>
                                <button onClick={() => handleLaunchAttestation(p.id)} className="px-2 py-1 bg-emerald-50 text-emerald-600 rounded text-xs font-bold hover:bg-emerald-100">Ø¥Ø·Ù„Ø§Ù‚</button>
                              </div>);
                          }
                          if (att.status === 'Draft') {
                            return (
                              <div className="flex items-center justify-center gap-2">
                                <span className="px-2.5 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-medium">â—‹ Ù…Ø³ÙˆØ¯Ø©</span>
                                <button onClick={() => handleManageAttestation(att.campaign)} className="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs font-bold hover:bg-blue-100">Ø¥Ø¯Ø§Ø±Ø©</button>
                              </div>);
                          }
                          if (att.status === 'Active' && att.overdueCount > 0) {
                            return (
                              <div className="flex items-center justify-center gap-2">
                                <div className="flex flex-col items-center">
                                  <span className="px-2.5 py-1 bg-red-100 text-red-700 rounded-lg text-xs font-bold flex items-center gap-1">
                                    <AlertTriangle className="w-3 h-3" /> Ù…ØªØ£Ø®Ø± {att.overdueCount}
                                  </span>
                                  <span className="text-xs text-slate-500 mt-0.5">{att.completionPercent}%</span>
                                </div>
                                <button onClick={() => handleManageAttestation(att.campaign)} className="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs font-bold hover:bg-blue-100">Ø¥Ø¯Ø§Ø±Ø©</button>
                              </div>);
                          }
                          if (att.status === 'Active') {
                            return (
                              <div className="flex items-center justify-center gap-2">
                                <div className="flex flex-col items-center">
                                  <span className="px-2.5 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium">Ø¬Ø§Ø±Ù {att.completionPercent}%</span>
                                  <div className="w-14 h-1.5 bg-slate-200 rounded-full mt-1 overflow-hidden">
                                    <div className="h-full bg-blue-500 rounded-full" style={{ width: `${att.completionPercent}%` }} />
                                  </div> </div>
                                <button onClick={() => handleManageAttestation(att.campaign)} className="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs font-bold hover:bg-blue-100">Ø¥Ø¯Ø§Ø±Ø©</button>
                              </div>);
                          }
                          if (att.status === 'Closed' && att.completionPercent === 100) {
                            return (
                              <div className="flex items-center justify-center gap-2">
                                <span className="px-2.5 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold flex items-center gap-1">
                                  <CheckCircle2 className="w-3 h-3" /> Ù…ÙƒØªÙ…Ù„Ø©
                                </span>
                                <button onClick={() => handleManageAttestation(att.campaign)} className="px-2 py-1 bg-slate-50 text-slate-600 rounded text-xs font-bold hover:bg-slate-100">Ø¹Ø±Ø¶</button>
                              </div>);
                          }
                          return (
                            <div className="flex items-center justify-center gap-2">
                              <span className="px-2.5 py-1 bg-slate-200 text-slate-700 rounded-lg text-xs font-medium">Ù…ØºÙ„Ù‚Ø© {att.completionPercent}%</span>
                              <button onClick={() => handleManageAttestation(att.campaign)} className="px-2 py-1 bg-slate-50 text-slate-600 rounded text-xs font-bold hover:bg-slate-100">Ø¹Ø±Ø¶</button>
                            </div>);
                        })()}
                      </td>
                      <td className="px-4 py-4 text-center">
                        <span className={`text-sm ${isOverdue ? 'text-red-600 font-bold' : 'text-slate-600'}`}>
                          {p.nextReviewDate || '-'}
                          {isOverdue && <AlertTriangle className="w-4 h-4 inline mr-1" />}
                        </span> </td>
                      <td className="px-4 py-4 text-center text-sm text-slate-600">{owner?.name}</td>
                      <td className="px-4 py-4 text-center">
                        <div className="flex items-center justify-center gap-1">
                          <button onClick={(e) => { e.stopPropagation(); openWorkspace(p.id); }}
                            className="p-2 hover:bg-blue-50 rounded-lg group/btn transition-all" title="Ø§Ø³ØªØ¹Ø±Ø§Ø¶">
                            <Eye className="w-4 h-4 text-blue-500 group-hover/btn:text-blue-700" />
                          </button>
                          <button onClick={(e) => handleEditPolicy(p, e)}
                            className="p-2 hover:bg-emerald-50 rounded-lg group/btn transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                            <Edit className="w-4 h-4 text-emerald-500 group-hover/btn:text-emerald-700" />
                          </button>
                          <button onClick={(e) => handleDeletePolicy(p, e)}
                            className="p-2 hover:bg-red-50 rounded-lg group/btn transition-all" title="Ø­Ø°Ù">
                            <Trash2 className="w-4 h-4 text-red-500 group-hover/btn:text-red-700" />
                          </button> </div> </td> </tr>);
                })}
              </tbody> </table> </div>
        ) : (
          /* Cards View */
          <div className="grid grid-cols-3 gap-5 p-6">
            {filtered.map(p => {
              const owner = getUser(p.ownerId);
              const reqCount = p.standardRequirements?.length || 0;
              const oblCount = p.linkedObligations?.length || 0;
              const ctrlCount = p.linkedControls?.length || 0;
              return (
                <div key={p.id} className="bg-white rounded-2xl border-2 border-slate-200 hover:border-emerald-400 hover:shadow-xl cursor-pointer group overflow-hidden">
                  <div className={`px-5 py-3 flex items-center justify-between ${p.impactLevel === 'Critical' ? 'bg-red-50 border-b border-red-200' :
                    p.impactLevel === 'High' ? 'bg-orange-50 border-b border-orange-200' : 'bg-slate-50 border-b border-slate-200'
                    }`}>
                    <div className="flex items-center gap-2">
                      <span className="text-xl">{POLICY_TYPES.find(t => t.code === p.type)?.icon}</span>
                      <span className="font-mono text-sm font-bold text-emerald-600">{p.code}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="text-xs font-bold text-blue-600 bg-blue-100 px-2 py-0.5 rounded">v{p.currentVersion}</span>
                      <span className={`w-2.5 h-2.5 rounded-full ${p.status === 'Active' ? 'bg-emerald-500' : p.status === 'Draft' ? 'bg-slate-400' : 'bg-amber-500'
                        }`} />
                    </div> </div>
                  <div className="p-5" onClick={() => openWorkspace(p.id)}>
                    <h3 className="font-bold text-slate-900 mb-2 line-clamp-2 group-hover:text-emerald-600">{p.title}</h3>
                    <p className="text-sm text-slate-500 mb-4 line-clamp-2">{p.summary}</p>
                    <div className="flex items-center gap-2 text-sm text-slate-500 mb-4">
                      <User className="w-4 h-4" />
                      <span>{owner?.name}</span>
                    </div>
                    <div className="flex items-center gap-3">
                      <span className="text-xs bg-purple-50 text-purple-700 px-2.5 py-1.5 rounded-lg">{reqCount} Ù…ØªØ·Ù„Ø¨</span>
                      <span className="text-xs bg-blue-50 text-blue-700 px-2.5 py-1.5 rounded-lg">{oblCount} Ø§Ù„ØªØ²Ø§Ù…</span>
                      <span className="text-xs bg-emerald-50 text-emerald-700 px-2.5 py-1.5 rounded-lg">{ctrlCount} Ø¶Ø§Ø¨Ø·</span>
                    </div> </div>
                  <div className="px-5 py-3 border-t border-slate-100 flex items-center justify-between bg-slate-50/50">
                    <div className="flex items-center gap-1">
                      <button onClick={(e) => { e.stopPropagation(); openWorkspace(p.id); }}
                        className="flex items-center gap-1.5 px-3 py-1.5 text-blue-600 hover:bg-blue-50 rounded-lg text-sm font-medium transition-all">
                        <Eye className="w-4 h-4" /> Ø§Ø³ØªØ¹Ø±Ø§Ø¶
                      </button>
                      <button onClick={(e) => handleEditPolicy(p, e)}
                        className="flex items-center gap-1.5 px-3 py-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg text-sm font-medium transition-all">
                        <Edit className="w-4 h-4" /> ØªØ¹Ø¯ÙŠÙ„
                      </button> </div>
                    <button onClick={(e) => handleDeletePolicy(p, e)}
                      className="flex items-center gap-1.5 px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition-all">
                      <Trash2 className="w-4 h-4" /> Ø­Ø°Ù
                    </button> </div> </div>);
            })}
          </div>
        )}

        {filtered.length === 0 && (
          <div className="text-center py-16">
            <div className="w-20 h-20 mx-auto mb-4 rounded-2xl bg-slate-100 flex items-center justify-center">
              <FileSearch className="w-10 h-10 text-slate-400" />
            </div>
            <h3 className="text-lg font-bold text-slate-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
            <p className="text-slate-500">Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
          </div>
        )}
      </div>

      <div className="grid grid-cols-3 gap-6">
        <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
          <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
            <ClipboardCheck className="w-5 h-5 text-purple-600" />
            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
          </h3>
          <div className="space-y-3">
            {[
              { label: 'Ø¥Ù„Ø²Ø§Ù…ÙŠ', count: STANDARD_REQUIREMENTS.filter(r => r.mandatoryLevel === 'Mandatory').length, color: 'bg-red-500' },
              { label: 'ÙŠÙ†Ø¨ØºÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', count: STANDARD_REQUIREMENTS.filter(r => r.mandatoryLevel === 'ShouldComply').length, color: 'bg-amber-500' },
              { label: 'Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª', count: STANDARD_REQUIREMENTS.filter(r => r.mandatoryLevel === 'BestPractice').length, color: 'bg-blue-500' },
            ].map(item => (
              <div key={item.label} className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <span className={`w-3 h-3 rounded-full ${item.color}`} />
                  <span className="text-sm text-slate-600">{item.label}</span>
                </div>
                <span className="font-bold text-slate-800">{item.count}</span>
              </div>
            ))}
          </div> </div>
        <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
          <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
            <CheckSquare className="w-5 h-5 text-emerald-600" />
            Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª
          </h3>
          <div className="space-y-3">
            {ATTESTATION_CAMPAIGNS.filter(c => c.status === 'Active').slice(0, 4).map(c => {
              const pol = POLICIES.find(p => p.id === c.policyId);
              const pct = Math.round((c.acknowledged / c.totalRecipients) * 100);
              return (
                <div key={c.id} className="p-3 bg-slate-50 rounded-xl">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-slate-700 truncate flex-1">{pol?.code}</span>
                    <span className={`text-xs font-bold px-2 py-0.5 rounded ${pct === 100 ? 'bg-emerald-100 text-emerald-700' : c.overdue > 0 ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'
                      }`}>{pct}%</span>
                  </div>
                  <div className="h-1.5 bg-slate-200 rounded-full overflow-hidden">
                    <div className={`h-full rounded-full ${pct === 100 ? 'bg-emerald-500' : 'bg-amber-500'}`} style={{ width: `${pct}%` }} />
                  </div> </div>);
            })}
          </div> </div>
        <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
          <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
            <History className="w-5 h-5 text-blue-600" />
            Ø¢Ø®Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          </h3>
          <div className="space-y-3">
            {POLICY_VERSIONS.filter(v => v.status === 'Active').slice(0, 4).map(v => {
              const pol = POLICIES.find(p => p.id === v.policyId);
              const usr = getUser(v.changedBy);
              return (
                <div key={v.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl">
                  <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                    <GitBranch className="w-5 h-5 text-blue-600" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-medium text-slate-800 truncate">{pol?.code} â†’ v{v.version}</p>
                    <p className="text-xs text-slate-500">{usr?.name} â€¢ {v.effectiveDate}</p>
                  </div> </div>);
            })}
          </div> </div> </div>
      {showCreateModal && createData && (
        <PolicyFormModal
          data={createData}
          mode="create"
          onClose={() => { setShowCreateModal(false); setCreateData(null); }}
          onUpdate={(field, value) => setCreateData(prev => ({ ...prev, [field]: value }))}
        />
      )}

      {showEditModal && editingPolicy && (
        <PolicyFormModal
          data={editingPolicy}
          mode="edit"
          onClose={() => { setShowEditModal(false); setEditingPolicy(null); }}
          onUpdate={(field, value) => setEditingPolicy(prev => ({ ...prev, [field]: value }))}
        />
      )}

      {showAttestationManager && (
        <AttestationCampaignManager
          campaign={selectedCampaign}
          policy={selectedPolicyForAttestation}
          onClose={() => { setShowAttestationManager(false); setSelectedCampaign(null); setSelectedPolicyForAttestation(null); }}
        />
      )}
      {showDeleteConfirm && deletingPolicy && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Trash2 className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
                  <p className="text-white/80 text-sm">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-4 mb-6">
                <p className="text-slate-700 mb-2">
                  Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù {deletingPolicy.type === 'Standard' ? 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø±' : deletingPolicy.type === 'Procedure' ? 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©'} Ø§Ù„ØªØ§Ù„ÙŠØŸ
                </p>
                <div className="bg-white rounded-xl p-4 border border-red-100">
                  <div className="flex items-center gap-3">
                    <span className="text-2xl">{POLICY_TYPES.find(t => t.code === deletingPolicy.type)?.icon}</span>
                    <div>
                      <p className="font-bold text-slate-800">{deletingPolicy.code}</p>
                      <p className="text-sm text-slate-600">{deletingPolicy.title}</p>
                    </div> </div> </div> </div>
              <div className="bg-amber-50 border-2 border-amber-200 rounded-2xl p-4">
                <div className="flex items-start gap-3">
                  <AlertTriangle className="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-amber-800">
                    <p className="font-bold mb-1">ØªØ­Ø°ÙŠØ±:</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</li>
                      <li>Ø³ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©</li>
                      <li>Ù„Ù† ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</li>
                    </ul>
                  </div> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowDeleteConfirm(false); setDeletingPolicy(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={confirmDelete}
                className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-xl font-bold hover:from-red-600 hover:to-rose-600 shadow-lg shadow-red-500/30">
                <Trash2 className="w-5 h-5" />
                Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù {deletingPolicy.type === 'Standard' ? 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø±' : deletingPolicy.type === 'Procedure' ? 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©'}
              </button> </div> </div> </div>
      )}
    </div>);
};

// ATTESTATION VALIDATION RULES & API CONTRACTS

/**
 * API CONTRACT SIGNATURES:
 * 
 * GET /policies - Response: { policies: Policy[], attestationSummary: { policyId, status, completionPercent, overdueCount }[] }
 * GET /policies/:id/attestation-campaign - Response: { campaign: AttestationCampaign | null }
 * POST /policies/:id/attestation-campaign - Body: { title, dueDate } - Response: { campaign }
 * POST /attestation-campaign/:id/launch - Response: { success, campaign }
 * POST /attestation-campaign/:id/close - Response: { success, campaign }
 * POST /attestation-campaign/:id/audience - Body: { targetType, selections[], includeNewJoiners }
 * POST /attestation-campaign/:id/schedule - Body: { reminderDays[], escalationLevels[] }
 * GET /attestation-campaign/:id/recipients - Response: { recipients[] }
 * POST /attestation-campaign/:id/export - Response: { downloadUrl, auditTrailId }
 */

const ATTESTATION_VALIDATION = {
  canLaunch: (campaign) => {
    const errors = [];
    if (!campaign.dueDate) errors.push('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚');
    if (!campaign.targetAudience || (campaign.targetAudience.type !== 'All' && !campaign.targetAudience.selections?.length)) {
      errors.push('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù');
    }
    if (campaign.dueDate && new Date(campaign.dueDate) <= new Date()) errors.push('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„');
    return { valid: errors.length === 0, errors };
  },
  canDecline: (comment) => {
    if (!comment || comment.trim().length < 20) return { valid: false, error: 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (20 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)' };
    return { valid: true };
  },
  canTransition: (from, to) => ({ 'Draft': ['Active'], 'Active': ['Closed'], 'Closed': [] }[from]?.includes(to) || false),
  isEditable: (c) => c?.status === 'Draft',
  isReadOnly: (c) => c?.status === 'Closed',
};

// Mock Data for Recipients
const ATTESTATION_RECIPIENTS = [
  { id: 1, campaignId: 1, userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', status: 'Acknowledged', acknowledgedAt: '2024-01-20 09:30', ipAddress: '192.168.1.100', comment: null },
  { id: 2, campaignId: 1, userId: 2, userName: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', department: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', status: 'Acknowledged', acknowledgedAt: '2024-01-21 14:15', ipAddress: '192.168.1.101', comment: null },
  { id: 3, campaignId: 1, userId: 3, userName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', department: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', status: 'Overdue', acknowledgedAt: null, ipAddress: null, comment: null },
  { id: 4, campaignId: 1, userId: 4, userName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø³Ø§Ù„Ù…', department: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', status: 'Pending', acknowledgedAt: null, ipAddress: null, comment: null },
  { id: 5, campaignId: 1, userId: 5, userName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„ÙÙ‡Ø¯', department: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', status: 'Declined', acknowledgedAt: '2024-01-22 11:00', ipAddress: '192.168.1.105', comment: 'Ø£Ø­ØªØ§Ø¬ ØªÙˆØ¶ÙŠØ­ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±' },
  { id: 6, campaignId: 3, userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', status: 'Acknowledged', acknowledgedAt: '2024-03-01 10:00', ipAddress: '192.168.1.100', comment: null },
  { id: 7, campaignId: 3, userId: 8, userName: 'Ø±ÙŠÙ… Ø§Ù„Ø´Ù…Ø±ÙŠ', department: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', status: 'Overdue', acknowledgedAt: null, ipAddress: null, comment: null },
];

const BUSINESS_UNITS = [
  { id: 1, code: 'HQ', name: 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' },
  { id: 2, code: 'RETAIL', name: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¬Ø²Ø¦Ø©' },
  { id: 3, code: 'CORP', name: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª' },
];

const LOCATIONS = [
  { id: 1, code: 'RUH', name: 'Ø§Ù„Ø±ÙŠØ§Ø¶' },
  { id: 2, code: 'JED', name: 'Ø¬Ø¯Ø©' },
  { id: 3, code: 'DMM', name: 'Ø§Ù„Ø¯Ù…Ø§Ù…' },
];

const ROLE_OPTIONS = [
  { id: 1, code: 'EXEC', name: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©' },
  { id: 2, code: 'MGR', name: 'Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡' },
  { id: 3, code: 'EMP', name: 'Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†' },
];

// ATTESTATION CAMPAIGN MANAGER COMPONENT

const AttestationCampaignManager = ({ campaign, policy, onClose }) => {
  const [activeTab, setActiveTab] = useState(0);
  const [campaignData, setCampaignData] = useState(campaign || {
    id: null, policyId: policy?.id,
    title: `Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± - ${policy?.title} ${new Date().getFullYear()}`,
    status: 'Draft', dueDate: '', startDate: '',
    targetAudience: { type: 'All', selections: [], includeNewJoiners: false },
    reminderDays: [14, 7, 3, 1],
    escalationLevels: [{ afterDays: 1, notifyRole: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±' }, { afterDays: 3, notifyRole: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' }],
    totalRecipients: 0, acknowledged: 0, pending: 0, overdue: 0,
  });
  const [validationErrors, setValidationErrors] = useState([]);
  const [recipients, setRecipients] = useState([]);
  const [recipientFilter, setRecipientFilter] = useState('');
  const [recipientSearch, setRecipientSearch] = useState('');

  useEffect(() => {
    if (activeTab === 3 && campaign?.id) {
      setRecipients(ATTESTATION_RECIPIENTS.filter(r => r.campaignId === campaign.id));
    }
  }, [activeTab, campaign?.id]);

  const isReadOnly = ATTESTATION_VALIDATION.isReadOnly(campaignData);
  const isEditable = ATTESTATION_VALIDATION.isEditable(campaignData);
  const completionPercent = campaignData.totalRecipients > 0 ? Math.round((campaignData.acknowledged / campaignData.totalRecipients) * 100) : 0;

  const tabs = [
    { id: 0, label: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', icon: Eye },
    { id: 1, label: 'Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±', icon: Users },
    { id: 2, label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©', icon: Calendar },
    { id: 3, label: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', icon: Activity },
    { id: 4, label: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', icon: FileCheck },
  ];

  const handleLaunch = () => {
    const validation = ATTESTATION_VALIDATION.canLaunch(campaignData);
    if (!validation.valid) { setValidationErrors(validation.errors); return; }
    setCampaignData(prev => ({ ...prev, status: 'Active', startDate: new Date().toISOString().split('T')[0] }));
    setValidationErrors([]);
  };

  const handleCloseCampaign = () => {
    if (window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©ØŸ Ù„Ù† ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­Ù‡Ø§.')) {
      setCampaignData(prev => ({ ...prev, status: 'Closed' }));
    }
  };

  const updateAudience = (field, value) => {
    setCampaignData(prev => ({ ...prev, targetAudience: { ...prev.targetAudience, [field]: value } }));
  };

  const filteredRecipients = recipients.filter(r => {
    const matchFilter = !recipientFilter || r.status === recipientFilter;
    const matchSearch = !recipientSearch || r.userName.includes(recipientSearch);
    return matchFilter && matchSearch;
  });

  return (
    <div className="fixed inset-0 bg-black/50 z-50 flex justify-end backdrop-blur-sm">
      <div className="w-[850px] bg-white h-full flex flex-col shadow-2xl">
        <div className={`px-6 py-5 text-white ${isReadOnly ? 'bg-gradient-to-l from-slate-500 to-slate-600' :
          campaignData.status === 'Active' ? 'bg-gradient-to-l from-blue-500 to-indigo-600' :
            'bg-gradient-to-l from-emerald-500 to-teal-600'
          }`}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                <CheckSquare className="w-6 h-6" />
              </div>
              <div>
                <h2 className="text-xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±</h2>
                <p className="text-white/80 text-sm">{policy?.code} - {policy?.title}</p>
              </div> </div>
            <div className="flex items-center gap-3">
              <span className={`px-3 py-1.5 rounded-lg text-sm font-bold ${campaignData.status === 'Draft' ? 'bg-white/20' : campaignData.status === 'Active' ? 'bg-white/30' : 'bg-white/20'}`}>
                {campaignData.status === 'Draft' ? 'â—‹ Ù…Ø³ÙˆØ¯Ø©' : campaignData.status === 'Active' ? 'â— Ù†Ø´Ø·Ø©' : 'â–  Ù…ØºÙ„Ù‚Ø©'}
              </span>
              <button onClick={onClose} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                <X className="w-5 h-5" />
              </button> </div> </div> </div>
        {validationErrors.length > 0 && (
          <div className="px-6 py-3 bg-red-50 border-b border-red-200">
            <div className="flex items-start gap-2">
              <AlertTriangle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
              <div>{validationErrors.map((err, i) => <p key={i} className="text-sm text-red-700">{err}</p>)}</div>
            </div> </div>
        )}

        <div className="flex border-b border-slate-200 px-4 bg-slate-50">
          {tabs.map((tab) => {
            const Icon = tab.icon;
            return (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-5 py-3 font-medium border-b-2 transition-all ${activeTab === tab.id ? 'border-emerald-500 text-emerald-700 bg-white -mb-px' : 'border-transparent text-slate-500 hover:text-slate-700'
                  }`}>
                <Icon className="w-4 h-4" />
                {tab.label}
              </button>);
          })}
        </div>

        <div className="flex-1 overflow-y-auto p-6">
          {activeTab === 0 && (
            <div className="space-y-6">
              <div className="grid grid-cols-4 gap-4">
                <div className="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200">
                  <div className="text-2xl font-bold text-emerald-600">{campaignData.acknowledged}</div>
                  <div className="text-sm text-emerald-700">Ø£Ù‚Ø±Ù‘ÙˆØ§</div>
                </div>
                <div className="bg-amber-50 rounded-xl p-4 border-2 border-amber-200">
                  <div className="text-2xl font-bold text-amber-600">{campaignData.pending}</div>
                  <div className="text-sm text-amber-700">Ù…Ø¹Ù„Ù‚</div>
                </div>
                <div className="bg-red-50 rounded-xl p-4 border-2 border-red-200">
                  <div className="text-2xl font-bold text-red-600">{campaignData.overdue}</div>
                  <div className="text-sm text-red-700">Ù…ØªØ£Ø®Ø±</div>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 border-2 border-slate-200">
                  <div className="text-2xl font-bold text-slate-600">{campaignData.totalRecipients}</div>
                  <div className="text-sm text-slate-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div> </div>
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <div className="flex items-center justify-between mb-3">
                  <h3 className="font-bold text-slate-800">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h3>
                  <span className="text-2xl font-bold text-emerald-600">{completionPercent}%</span>
                </div>
                <div className="h-4 bg-slate-200 rounded-full overflow-hidden">
                  <div className={`h-full rounded-full transition-all ${completionPercent === 100 ? 'bg-emerald-500' : 'bg-blue-500'}`} style={{ width: `${completionPercent}%` }} />
                </div> </div>
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø©</h3>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù…Ù„Ø©</label>
                    <input type="text" value={campaignData.title} onChange={(e) => !isReadOnly && setCampaignData(prev => ({ ...prev, title: e.target.value }))}
                      disabled={!isEditable} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 disabled:bg-slate-50" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                      <input type="date" value={campaignData.startDate || ''} disabled className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl bg-slate-50" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                      <input type="date" value={campaignData.dueDate} onChange={(e) => !isReadOnly && setCampaignData(prev => ({ ...prev, dueDate: e.target.value }))}
                        disabled={!isEditable} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 disabled:bg-slate-50" />
                    </div> </div> </div> </div> </div>
          )}

          {activeTab === 1 && (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</h3>
                <div className="grid grid-cols-5 gap-3">
                  {[
                    { type: 'All', label: 'Ø§Ù„Ø¬Ù…ÙŠØ¹', icon: Users },
                    { type: 'Users', label: 'Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†', icon: User },
                    { type: 'Roles', label: 'Ø£Ø¯ÙˆØ§Ø±', icon: Shield },
                    { type: 'BusinessUnits', label: 'ÙˆØ­Ø¯Ø§Øª', icon: Building2 },
                    { type: 'Locations', label: 'Ù…ÙˆØ§Ù‚Ø¹', icon: MapPin },
                  ].map(item => {
                    const Icon = item.icon;
                    return (
                      <button key={item.type} onClick={() => !isReadOnly && updateAudience('type', item.type)} disabled={!isEditable}
                        className={`p-4 rounded-xl border-2 transition-all ${campaignData.targetAudience?.type === item.type ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 hover:border-slate-300'
                          } ${!isEditable ? 'opacity-50 cursor-not-allowed' : ''}`}>
                        <Icon className={`w-6 h-6 mx-auto mb-2 ${campaignData.targetAudience?.type === item.type ? 'text-emerald-600' : 'text-slate-400'}`} />
                        <p className="text-sm font-medium text-slate-700">{item.label}</p>
                      </button>);
                  })}
                </div> </div>
              {campaignData.targetAudience?.type !== 'All' && (
                <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4">
                    {campaignData.targetAudience?.type === 'Users' && 'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'}
                    {campaignData.targetAudience?.type === 'Roles' && 'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Ø±'}
                    {campaignData.targetAudience?.type === 'BusinessUnits' && 'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ­Ø¯Ø§Øª'}
                    {campaignData.targetAudience?.type === 'Locations' && 'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹'}
                  </h3>
                  <div className="space-y-2 max-h-60 overflow-y-auto">
                    {(campaignData.targetAudience?.type === 'Roles' ? ROLE_OPTIONS :
                      campaignData.targetAudience?.type === 'BusinessUnits' ? BUSINESS_UNITS :
                        campaignData.targetAudience?.type === 'Locations' ? LOCATIONS : USERS).map(item => (
                          <label key={item.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                            <input type="checkbox" checked={campaignData.targetAudience?.selections?.includes(item.id)}
                              onChange={(e) => {
                                if (isReadOnly) return;
                                const selections = campaignData.targetAudience?.selections || [];
                                updateAudience('selections', e.target.checked ? [...selections, item.id] : selections.filter(s => s !== item.id));
                              }}
                              disabled={!isEditable} className="w-5 h-5 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                            <span className="font-medium text-slate-700">{item.name}</span>
                          </label>
                        ))}
                  </div> </div>
              )}

              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <label className="flex items-center gap-3 cursor-pointer">
                  <input type="checkbox" checked={campaignData.targetAudience?.includeNewJoiners || false}
                    onChange={(e) => !isReadOnly && updateAudience('includeNewJoiners', e.target.checked)}
                    disabled={!isEditable} className="w-5 h-5 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <div>
                    <p className="font-medium text-slate-800">ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                    <p className="text-sm text-slate-500">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ù„Ù„Ø­Ù…Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                  </div>
                </label>
              </div> </div>
          )}

          {activeTab === 2 && (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <Bell className="w-5 h-5 text-amber-600" />
                  Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
                </h3>
                <p className="text-sm text-slate-500 mb-4">Ø­Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</p>
                <div className="flex flex-wrap gap-2">
                  {[30, 14, 7, 3, 1].map(day => (
                    <button key={day}
                      onClick={() => {
                        if (isReadOnly) return;
                        const days = campaignData.reminderDays || [];
                        setCampaignData(prev => ({ ...prev, reminderDays: days.includes(day) ? days.filter(d => d !== day) : [...days, day].sort((a, b) => b - a) }));
                      }}
                      disabled={!isEditable}
                      className={`px-4 py-2 rounded-xl border-2 font-medium transition-all ${campaignData.reminderDays?.includes(day) ? 'border-amber-500 bg-amber-50 text-amber-700' : 'border-slate-200 text-slate-600 hover:border-slate-300'
                        } ${!isEditable ? 'opacity-50 cursor-not-allowed' : ''}`}>
                      Ù‚Ø¨Ù„ {day} ÙŠÙˆÙ…
                    </button>
                  ))}
                </div> </div>
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <TrendingUp className="w-5 h-5 text-red-600" />
                  Ø§Ù„ØªØµØ¹ÙŠØ¯
                </h3>
                <p className="text-sm text-slate-500 mb-4">Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</p>
                <div className="space-y-3">
                  {campaignData.escalationLevels?.map((level, idx) => (
                    <div key={idx} className="flex items-center gap-4 p-4 bg-slate-50 rounded-xl">
                      <span className="w-8 h-8 rounded-full bg-red-100 text-red-600 flex items-center justify-center font-bold text-sm">{idx + 1}</span>
                      <div className="flex-1 grid grid-cols-2 gap-4">
                        <div>
                          <label className="text-xs text-slate-500">Ø¨Ø¹Ø¯ (Ø£ÙŠØ§Ù…)</label>
                          <input type="number" value={level.afterDays}
                            onChange={(e) => {
                              if (isReadOnly) return;
                              const levels = [...campaignData.escalationLevels];
                              levels[idx].afterDays = parseInt(e.target.value);
                              setCampaignData(prev => ({ ...prev, escalationLevels: levels }));
                            }}
                            disabled={!isEditable} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                        </div>
                        <div>
                          <label className="text-xs text-slate-500">Ø¥Ø¨Ù„Ø§Øº</label>
                          <input type="text" value={level.notifyRole}
                            onChange={(e) => {
                              if (isReadOnly) return;
                              const levels = [...campaignData.escalationLevels];
                              levels[idx].notifyRole = e.target.value;
                              setCampaignData(prev => ({ ...prev, escalationLevels: levels }));
                            }}
                            disabled={!isEditable} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                        </div> </div>
                      {isEditable && (
                        <button onClick={() => {
                          const levels = campaignData.escalationLevels.filter((_, i) => i !== idx);
                          setCampaignData(prev => ({ ...prev, escalationLevels: levels }));
                        }} className="p-2 hover:bg-red-50 rounded-lg text-red-500">
                          <X className="w-4 h-4" />
                        </button>
                      )}
                    </div>
                  ))}
                  {isEditable && (
                    <button onClick={() => setCampaignData(prev => ({ ...prev, escalationLevels: [...(prev.escalationLevels || []), { afterDays: 5, notifyRole: '' }] }))}
                      className="w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 hover:border-slate-400 hover:text-slate-600">
                      + Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆÙ‰ ØªØµØ¹ÙŠØ¯
                    </button>
                  )}
                </div> </div> </div>
          )}

          {activeTab === 3 && (
            <div className="space-y-4">
              <div className="flex items-center gap-3">
                <select value={recipientFilter} onChange={(e) => setRecipientFilter(e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl bg-white text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="Acknowledged">Ø£Ù‚Ø±Ù‘</option>
                  <option value="Pending">Ù…Ø¹Ù„Ù‚</option>
                  <option value="Overdue">Ù…ØªØ£Ø®Ø±</option>
                  <option value="Declined">Ø±ÙØ¶</option>
                  <option value="Exempted">Ù…Ø¹ÙÙ‰</option>
                </select>
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." value={recipientSearch} onChange={(e) => setRecipientSearch(e.target.value)}
                  className="flex-1 px-4 py-2 border-2 border-slate-200 rounded-xl text-sm" />
              </div>

              <div className="bg-white rounded-xl border-2 border-slate-200 overflow-hidden">
                <table className="w-full">
                  <thead>
                    <tr className="bg-slate-50 border-b border-slate-200">
                      <th className="text-right px-4 py-3 font-bold text-slate-700 text-sm">Ø§Ù„Ù…ÙˆØ¸Ù</th>
                      <th className="text-right px-4 py-3 font-bold text-slate-700 text-sm">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700 text-sm">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-right px-4 py-3 font-bold text-slate-700 text-sm">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                      <th className="text-right px-4 py-3 font-bold text-slate-700 text-sm">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredRecipients.map(r => (
                      <tr key={r.id} className="border-b border-slate-100 hover:bg-slate-50">
                        <td className="px-4 py-3 font-medium text-slate-800">{r.userName}</td>
                        <td className="px-4 py-3 text-slate-600 text-sm">{r.department}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${r.status === 'Acknowledged' ? 'bg-emerald-100 text-emerald-700' :
                            r.status === 'Pending' ? 'bg-amber-100 text-amber-700' :
                              r.status === 'Overdue' ? 'bg-red-100 text-red-700' :
                                r.status === 'Declined' ? 'bg-purple-100 text-purple-700' : 'bg-slate-100 text-slate-600'
                            }`}>
                            {r.status === 'Acknowledged' ? 'Ø£Ù‚Ø±Ù‘' : r.status === 'Pending' ? 'Ù…Ø¹Ù„Ù‚' : r.status === 'Overdue' ? 'Ù…ØªØ£Ø®Ø±' : r.status === 'Declined' ? 'Ø±ÙØ¶' : 'Ù…Ø¹ÙÙ‰'}
                          </span> </td>
                        <td className="px-4 py-3 text-slate-500 text-sm">{r.acknowledgedAt || '-'}</td>
                        <td className="px-4 py-3 text-slate-500 text-sm max-w-[200px] truncate" title={r.comment}>{r.comment || '-'}</td>
                      </tr>
                    ))}
                    {filteredRecipients.length === 0 && (
                      <tr><td colSpan={5} className="px-4 py-8 text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>
                    )}
                  </tbody> </table> </div> </div>
          )}

          {activeTab === 4 && (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <FileCheck className="w-5 h-5 text-emerald-600" />
                  ØªØµØ¯ÙŠØ± Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
                </h3>
                <p className="text-slate-600 mb-6">ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª ÙŠØªØ¶Ù…Ù†: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø¹Ù†ÙˆØ§Ù† IPØŒ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
                <div className="flex gap-4">
                  <button className="flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                    <Download className="w-5 h-5" />
                    ØªØµØ¯ÙŠØ± PDF
                  </button>
                  <button className="flex items-center gap-2 px-6 py-3 border-2 border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50">
                    <Download className="w-5 h-5" />
                    ØªØµØ¯ÙŠØ± Excel
                  </button> </div> </div>
              <div className="bg-white rounded-xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <History className="w-5 h-5 text-blue-600" />
                  Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ (Immutable Audit Trail)
                </h3>
                <div className="space-y-3">
                  {[
                    { action: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©', user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', date: campaign?.createdAt || new Date().toISOString().split('T')[0], time: '09:00' },
                    ...(campaign?.status !== 'Draft' ? [{ action: 'ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©', user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', date: campaign?.startDate || '', time: '08:00' }] : []),
                    ...(campaign?.status === 'Closed' ? [{ action: 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©', user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', date: new Date().toISOString().split('T')[0], time: '16:00' }] : []),
                  ].map((log, idx) => (
                    <div key={idx} className="flex items-center gap-4 p-3 bg-slate-50 rounded-xl">
                      <div className="w-2 h-2 rounded-full bg-blue-500" />
                      <div className="flex-1">
                        <p className="text-sm font-medium text-slate-800">{log.action}</p>
                        <p className="text-xs text-slate-500">{log.user}</p>
                      </div>
                      <span className="text-xs text-slate-400">{log.date} {log.time}</span>
                    </div>
                  ))}
                </div> </div>
              <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                <p className="text-sm text-blue-700 flex items-center gap-2">
                  <Shield className="w-5 h-5" />
                  Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ø­Ù…ÙŠØ© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø£Ùˆ Ø­Ø°ÙÙ‡Ø§ (Immutable Audit Trail)
                </p> </div> </div>
          )}
        </div>

        <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
          <div className="flex items-center justify-between">
            <button onClick={onClose} className="px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
              {isReadOnly ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Ø¥Ù„ØºØ§Ø¡'}
            </button>
            <div className="flex items-center gap-3">
              {campaignData.status === 'Draft' && (
                <>
                  <button className="px-5 py-2.5 bg-slate-700 text-white rounded-xl font-bold hover:bg-slate-800">Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©</button>
                  <button onClick={handleLaunch} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold hover:from-emerald-600 hover:to-teal-600 shadow-lg shadow-emerald-500/30">
                    <Send className="w-5 h-5" />
                    Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©
                  </button>
                </>
              )}
              {campaignData.status === 'Active' && (
                <button onClick={handleCloseCampaign} className="flex items-center gap-2 px-6 py-2.5 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                  <XCircle className="w-5 h-5" />
                  Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©
                </button>
              )}
            </div> </div> </div> </div> </div>);
};

// POLICY WORKSPACE - SINGLE POLICY LIFECYCLE VIEW

// Policy Rules Helper
const POLICY_RULES = {
  canEdit: (policy) => policy && ['Draft', 'UnderReview', 'Active'].includes(policy.status),
  canApprove: (policy) => policy && policy.status === 'UnderReview',
  canArchive: (policy) => policy && policy.status === 'Active',
  requiresImpactAnalysis: (policy) => policy && ['UnderReview', 'Active'].includes(policy.status),
  canDelete: (policy) => policy && policy.status === 'Draft',
};

const PolicyWorkspace = ({ policyId, onClose }) => {
  const [activeTab, setActiveTab] = useState(0);
  const [isEditing, setIsEditing] = useState(false);
  const [editData, setEditData] = useState(null);
  const [showVersionModal, setShowVersionModal] = useState(false);
  const policy = POLICIES.find(p => p.id === policyId);
  if (!policy) return null;

  // Initialize edit data
  const startEdit = () => {
    setEditData({ ...policy });
    setIsEditing(true);
  };

  const cancelEdit = () => {
    setEditData(null);
    setIsEditing(false);
  };

  const saveEdit = () => {
    // In real app, would call API
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    setIsEditing(false);
  };

  const handleExportPDF = () => {
    alert('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± PDF...');
  };

  const handleNewVersion = () => {
    setShowVersionModal(true);
  };

  const getUser = (id) => USERS.find(u => u.id === id);
  const owner = getUser(policy.ownerId);
  const reviewer = getUser(policy.reviewerId);
  const approver = getUser(policy.approverId);

  const requirements = STANDARD_REQUIREMENTS.filter(r => policy.standardRequirements?.includes(r.id));
  const versions = POLICY_VERSIONS.filter(v => v.policyId === policy.id).sort((a, b) => b.id - a.id);
  const campaigns = ATTESTATION_CAMPAIGNS.filter(c => c.policyId === policy.id);
  const obligations = INITIAL_OBLIGATIONS.filter(o => policy.linkedObligations?.includes(o.id));
  const controls = CONTROLS.filter(c => policy.linkedControls?.includes(c.id));
  const risks = RISKS.filter(r => policy.linkedRisks?.includes(r.id));

  const tabs = [
    { id: 0, label: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', icon: Eye },
    { id: 1, label: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª', icon: GitBranch },
    { id: 2, label: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª', icon: ClipboardCheck, count: requirements.length },
    { id: 3, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', icon: Link2, count: obligations.length },
    { id: 4, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: Shield, count: controls.length },
    { id: 5, label: 'Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª', icon: CheckSquare, count: campaigns.length },
    { id: 6, label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±', icon: TrendingUp },
    { id: 7, label: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FileCheck },
  ];

  return (
    <div className="min-h-screen bg-slate-50">
      <div className={`text-white px-8 py-6 ${policy.impactLevel === 'Critical' ? 'bg-gradient-to-l from-red-500 to-rose-600' :
        policy.impactLevel === 'High' ? 'bg-gradient-to-l from-orange-500 to-amber-600' :
          'bg-gradient-to-l from-emerald-500 to-teal-600'
        }`}>
        <div className="flex items-center justify-between mb-4">
          <button onClick={onClose} className="flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl">
            <ChevronRight className="w-5 h-5" />
            Ø§Ù„Ø¹ÙˆØ¯Ø©
          </button>
          <div className="flex items-center gap-3">
            {POLICY_RULES.canEdit(policy) && !isEditing && (
              <button onClick={startEdit} className="flex items-center gap-2 px-5 py-2.5 bg-white/20 hover:bg-white/30 rounded-xl font-medium transition-all">
                <Edit className="w-5 h-5" />
                ØªØ¹Ø¯ÙŠÙ„
              </button>
            )}
            {isEditing && (
              <>
                <button onClick={cancelEdit} className="flex items-center gap-2 px-5 py-2.5 bg-white/20 hover:bg-white/30 rounded-xl font-medium transition-all">
                  <X className="w-5 h-5" />
                  Ø¥Ù„ØºØ§Ø¡
                </button>
                <button onClick={saveEdit} className="flex items-center gap-2 px-5 py-2.5 bg-white text-emerald-600 rounded-xl font-bold hover:bg-emerald-50 transition-all">
                  <Save className="w-5 h-5" />
                  Ø­ÙØ¸
                </button>
              </>
            )}
            {policy.status === 'Active' && !isEditing && (
              <button onClick={handleNewVersion} className="flex items-center gap-2 px-5 py-2.5 bg-white/20 hover:bg-white/30 rounded-xl font-medium transition-all">
                <Copy className="w-5 h-5" />
                Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯
              </button>
            )}
            <button onClick={handleExportPDF} className="flex items-center gap-2 px-5 py-2.5 bg-white text-slate-800 rounded-xl font-bold hover:bg-slate-100 transition-all">
              <Download className="w-5 h-5" />
              ØªØµØ¯ÙŠØ± PDF
            </button> </div> </div>
        <div className="flex items-start gap-6">
          <div className="w-20 h-20 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center text-4xl">
            {POLICY_TYPES.find(t => t.code === policy.type)?.icon}
          </div>
          <div className="flex-1">
            <div className="flex items-center gap-3 mb-2">
              <span className="px-4 py-1.5 bg-white/20 rounded-xl font-mono font-bold">{policy.code}</span>
              <span className="px-3 py-1 bg-white/20 rounded-lg text-sm">v{policy.currentVersion}</span>
              <span className={`px-3 py-1 rounded-lg text-sm font-bold ${policy.status === 'Active' ? 'bg-white/30' : 'bg-white/20'}`}>
                {policy.status === 'Active' ? 'â— Ù†Ø´Ø·' : policy.status === 'Draft' ? 'â—‹ Ù…Ø³ÙˆØ¯Ø©' : policy.status}
              </span>
              <span className="px-3 py-1 bg-white/20 rounded-lg text-sm font-bold">
                âš¡ {policy.impactLevel === 'Critical' ? 'Ø­Ø±Ø¬' : policy.impactLevel === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}
              </span> </div>
            <h1 className="text-3xl font-bold mb-2">{policy.title}</h1>
            <p className="text-white/80">{policy.titleEn}</p>
          </div> </div> </div>
      <div className="bg-white border-b border-slate-200 px-8">
        <div className="flex overflow-x-auto">
          {tabs.map((tab) => {
            const Icon = tab.icon;
            return (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-6 py-4 font-medium whitespace-nowrap border-b-2 ${activeTab === tab.id ? 'border-emerald-500 text-emerald-700 bg-emerald-50/50' : 'border-transparent text-slate-500 hover:text-slate-700'
                  }`}>
                <Icon className="w-5 h-5" />
                {tab.label}
                {tab.count !== undefined && (
                  <span className={`px-2 py-0.5 rounded-lg text-xs font-bold ${activeTab === tab.id ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'
                    }`}>{tab.count}</span>
                )}
              </button>);
          })}
        </div> </div>
      <div className="p-8">
        {activeTab === 0 && (
          <div className="grid grid-cols-3 gap-6">
            <div className="col-span-2 space-y-6">
              <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <BookOpen className="w-5 h-5 text-emerald-600" />
                  Ù…Ù„Ø®Øµ Ø§Ù„Ø³ÙŠØ§Ø³Ø©
                </h3>
                <p className="text-slate-700 leading-relaxed">{policy.summary}</p>
              </div>

              <div className="grid grid-cols-2 gap-6">
                <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <Target className="w-5 h-5 text-blue-600" />
                    Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                  </h3>
                  <p className="text-slate-600">{policy.scope}</p>
                </div>
                <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <CheckCircle2 className="w-5 h-5 text-emerald-600" />
                    Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
                  </h3>
                  <ul className="space-y-2">
                    {policy.objectives?.map((obj, i) => (
                      <li key={i} className="flex items-center gap-2 text-slate-600">
                        <Check className="w-4 h-4 text-emerald-500" />
                        {obj}
                      </li>
                    ))}
                  </ul>
                </div> </div>
              <div className="grid grid-cols-4 gap-4">
                <div onClick={() => setActiveTab(2)} className="bg-purple-50 rounded-2xl p-5 border-2 border-purple-200 cursor-pointer hover:border-purple-400 hover:shadow-lg transition-all">
                  <div className="text-3xl font-bold text-purple-600 mb-1">{requirements.length}</div>
                  <div className="text-sm text-purple-700">Ù…ØªØ·Ù„Ø¨</div>
                </div>
                <div onClick={() => setActiveTab(3)} className="bg-blue-50 rounded-2xl p-5 border-2 border-blue-200 cursor-pointer hover:border-blue-400 hover:shadow-lg transition-all">
                  <div className="text-3xl font-bold text-blue-600 mb-1">{obligations.length}</div>
                  <div className="text-sm text-blue-700">Ø§Ù„ØªØ²Ø§Ù…</div>
                </div>
                <div onClick={() => setActiveTab(4)} className="bg-emerald-50 rounded-2xl p-5 border-2 border-emerald-200 cursor-pointer hover:border-emerald-400 hover:shadow-lg transition-all">
                  <div className="text-3xl font-bold text-emerald-600 mb-1">{controls.length}</div>
                  <div className="text-sm text-emerald-700">Ø¶Ø§Ø¨Ø·</div>
                </div>
                <div onClick={() => setActiveTab(6)} className="bg-amber-50 rounded-2xl p-5 border-2 border-amber-200 cursor-pointer hover:border-amber-400 hover:shadow-lg transition-all">
                  <div className="text-3xl font-bold text-amber-600 mb-1">{risks.length}</div>
                  <div className="text-sm text-amber-700">Ù…Ø®Ø§Ø·Ø±</div>
                </div> </div> </div>
            <div className="space-y-6">
              <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</h3>
                <div className="space-y-4">
                  <div className="flex items-center gap-3 p-3 bg-emerald-50 rounded-xl">
                    <div className="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center">
                      <User className="w-5 h-5 text-emerald-600" />
                    </div>
                    <div>
                      <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø§Ù„Ùƒ</p>
                      <p className="font-medium text-slate-800">{owner?.name}</p>
                    </div> </div>
                  <div className="flex items-center gap-3 p-3 bg-blue-50 rounded-xl">
                    <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                      <UserCheck className="w-5 h-5 text-blue-600" />
                    </div>
                    <div>
                      <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</p>
                      <p className="font-medium text-slate-800">{reviewer?.name}</p>
                    </div> </div>
                  <div className="flex items-center gap-3 p-3 bg-purple-50 rounded-xl">
                    <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                      <Shield className="w-5 h-5 text-purple-600" />
                    </div>
                    <div>
                      <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</p>
                      <p className="font-medium text-slate-800">{approver?.name}</p>
                    </div> </div> </div> </div>
              <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h3>
                <div className="space-y-3">
                  <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                    <span className="text-sm text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†ÙØ§Ø°</span>
                    <span className="font-bold text-slate-800">{policy.effectiveDate}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                    <span className="text-sm text-slate-600">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
                    <span className={`font-bold ${policy.nextReviewDate < new Date().toISOString().split('T')[0] ? 'text-red-600' : 'text-slate-800'}`}>
                      {policy.nextReviewDate}
                    </span> </div> </div> </div> </div> </div>
        )}

        {activeTab === 1 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-200 flex items-center justify-between">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <GitBranch className="w-5 h-5 text-blue-600" />
                Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
              </h3>
              {policy.status === 'Active' && (
                <button className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600">
                  <Plus className="w-5 h-5" />
                  Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯
                </button>
              )}
            </div>
            <div className="divide-y divide-slate-100">
              {versions.map((v, idx) => {
                const usr = getUser(v.changedBy);
                return (
                  <div key={v.id} className={`p-5 flex items-center gap-6 ${idx === 0 ? 'bg-emerald-50/50' : ''}`}>
                    <div className={`w-14 h-14 rounded-xl flex items-center justify-center ${v.status === 'Active' ? 'bg-emerald-100' : 'bg-slate-100'}`}>
                      <span className={`text-lg font-bold ${v.status === 'Active' ? 'text-emerald-600' : 'text-slate-500'}`}>v{v.version}</span>
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-1">
                        <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${v.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'
                          }`}>{v.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ø³Ø§Ø¨Ù‚'}</span>
                        <span className="text-sm text-slate-500">{v.effectiveDate}</span>
                      </div>
                      <p className="font-medium text-slate-800">{v.changeReason}</p>
                      <p className="text-sm text-slate-500 mt-1">Ø¨ÙˆØ§Ø³Ø·Ø©: {usr?.name}</p>
                    </div>
                    <button className="p-2 hover:bg-slate-100 rounded-lg"><Eye className="w-5 h-5 text-slate-500" /></button>
                  </div>);
              })}
            </div> </div>
        )}

        {activeTab === 2 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-200 flex items-center justify-between">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <ClipboardCheck className="w-5 h-5 text-purple-600" />
                Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ({requirements.length})
              </h3>
              {POLICY_RULES.canEdit(policy) && (
                <button className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-xl font-medium hover:bg-purple-600">
                  <Plus className="w-5 h-5" />
                  Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨
                </button>
              )}
            </div>
            <table className="w-full">
              <thead>
                <tr className="bg-slate-50 border-b border-slate-200">
                  <th className="text-right px-5 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                  <th className="text-right px-4 py-4 font-bold text-slate-700">Ù†Øµ Ø§Ù„Ù…ØªØ·Ù„Ø¨</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¥Ù„Ø²Ø§Ù…</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø¯Ù„ÙŠÙ„</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø±Ø¨Ø·</th>
                </tr> </thead>
              <tbody>
                {requirements.map(req => (
                  <tr key={req.id} className="border-b border-slate-100 hover:bg-slate-50">
                    <td className="px-5 py-4">
                      <span className="font-mono text-sm font-bold text-purple-600 bg-purple-50 px-2.5 py-1 rounded-lg">{req.refCode}</span>
                    </td>
                    <td className="px-4 py-4 text-slate-700">{req.statement}</td>
                    <td className="px-4 py-4 text-center">
                      <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${req.mandatoryLevel === 'Mandatory' ? 'bg-red-100 text-red-700' :
                        req.mandatoryLevel === 'ShouldComply' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                        }`}>{MANDATORY_LEVELS.find(l => l.code === req.mandatoryLevel)?.nameAr}</span>
                    </td>
                    <td className="px-4 py-4 text-center">
                      {req.evidenceRequired ? <CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto" /> : <XCircle className="w-5 h-5 text-slate-300 mx-auto" />}
                    </td>
                    <td className="px-4 py-4 text-center text-sm text-slate-600">
                      {FREQUENCIES.find(f => f.code === req.testingFrequency)?.nameAr || req.testingFrequency}
                    </td>
                    <td className="px-4 py-4 text-center">
                      <div className="flex items-center justify-center gap-2">
                        <span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-bold">{req.linkedObligations?.length || 0}</span>
                        <span className="px-2 py-1 bg-emerald-50 text-emerald-700 rounded text-xs font-bold">{req.linkedControls?.length || 0}</span>
                      </div> </td> </tr>
                ))}
              </tbody> </table> </div>
        )}

        {activeTab === 3 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-200">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <Link2 className="w-5 h-5 text-blue-600" />
                Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ({obligations.length})
              </h3>
            </div>
            <div className="divide-y divide-slate-100">
              {obligations.map(obl => (
                <div key={obl.id} className="p-5 flex items-center gap-4 hover:bg-slate-50">
                  <span className="font-mono text-sm font-bold text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-lg">{obl.code}</span>
                  <div className="flex-1"><p className="font-medium text-slate-800">{obl.title}</p></div>
                  <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${obl.criticality === 'High' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'
                    }`}>{obl.criticality === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span>
                </div>
              ))}
            </div> </div>
        )}

        {activeTab === 4 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-200">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <Shield className="w-5 h-5 text-emerald-600" />
                Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ({controls.length})
              </h3>
            </div>
            <div className="divide-y divide-slate-100">
              {controls.map(ctrl => (
                <div key={ctrl.id} className="p-5 flex items-center gap-4 hover:bg-slate-50">
                  <span className="font-mono text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg">{ctrl.code}</span>
                  <div className="flex-1"><p className="font-medium text-slate-800">{ctrl.title}</p></div>
                  <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${ctrl.type === 'Preventive' ? 'bg-emerald-100 text-emerald-700' :
                    ctrl.type === 'Detective' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'
                    }`}>{ctrl.type === 'Preventive' ? 'ÙˆÙ‚Ø§Ø¦ÙŠ' : ctrl.type === 'Detective' ? 'ÙƒØ§Ø´Ù' : 'ØªØµØ­ÙŠØ­ÙŠ'}</span>
                </div>
              ))}
            </div> </div>
        )}

        {activeTab === 5 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-200 flex items-center justify-between">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <CheckSquare className="w-5 h-5 text-emerald-600" />
                Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±
              </h3>
              <button className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-medium hover:bg-emerald-600">
                <Plus className="w-5 h-5" />
                Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="divide-y divide-slate-100">
              {campaigns.map(c => {
                const pct = Math.round((c.acknowledged / c.totalRecipients) * 100);
                return (
                  <div key={c.id} className="p-6">
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h4 className="font-bold text-slate-800">{c.title}</h4>
                        <p className="text-sm text-slate-500 mt-1">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: {c.dueDate}</p>
                      </div>
                      <span className={`px-3 py-1.5 rounded-xl text-sm font-bold ${c.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' :
                        c.status === 'Active' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'
                        }`}>{c.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„Ø©' : c.status === 'Active' ? 'Ù†Ø´Ø·Ø©' : 'Ù…Ø³ÙˆØ¯Ø©'}</span>
                    </div>

                    <div className="grid grid-cols-4 gap-4 mb-4">
                      <div className="bg-slate-50 rounded-xl p-4 text-center">
                        <div className="text-2xl font-bold text-slate-800">{c.totalRecipients}</div>
                        <div className="text-xs text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                      </div>
                      <div className="bg-emerald-50 rounded-xl p-4 text-center">
                        <div className="text-2xl font-bold text-emerald-600">{c.acknowledged}</div>
                        <div className="text-xs text-emerald-700">ØªÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±</div>
                      </div>
                      <div className="bg-amber-50 rounded-xl p-4 text-center">
                        <div className="text-2xl font-bold text-amber-600">{c.pending}</div>
                        <div className="text-xs text-amber-700">Ù…Ø¹Ù„Ù‚</div>
                      </div>
                      <div className="bg-red-50 rounded-xl p-4 text-center">
                        <div className="text-2xl font-bold text-red-600">{c.overdue}</div>
                        <div className="text-xs text-red-700">Ù…ØªØ£Ø®Ø±</div>
                      </div> </div>
                    <div className="h-3 bg-slate-200 rounded-full overflow-hidden flex">
                      <div className="bg-emerald-500 h-full" style={{ width: `${(c.acknowledged / c.totalRecipients) * 100}%` }} />
                      <div className="bg-amber-500 h-full" style={{ width: `${(c.pending / c.totalRecipients) * 100}%` }} />
                      <div className="bg-red-500 h-full" style={{ width: `${(c.overdue / c.totalRecipients) * 100}%` }} />
                    </div> </div>);
              })}
            </div> </div>
        )}

        {activeTab === 6 && (
          <div className="space-y-6">
            <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-6 border-2 border-purple-200">
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-purple-600" />
                ØªØ­Ù„ÙŠÙ„ Ø£Ø«Ø± Ø§Ù„ØªØºÙŠÙŠØ±
              </h3>
              <p className="text-slate-600 mb-6">Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø©ØŒ Ø³ØªØªØ£Ø«Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>

              <div className="grid grid-cols-3 gap-6">
                <div className="bg-white rounded-2xl p-5 border border-purple-200">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                      <Link2 className="w-5 h-5 text-blue-600" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold text-blue-600">{obligations.length}</p>
                      <p className="text-xs text-slate-500">Ø§Ù„ØªØ²Ø§Ù… Ù…ØªØ£Ø«Ø±</p>
                    </div> </div>
                  <div className="space-y-2">
                    {obligations.slice(0, 3).map(o => (
                      <div key={o.id} className="text-sm text-slate-600 truncate">â€¢ {o.code}</div>
                    ))}
                  </div> </div>
                <div className="bg-white rounded-2xl p-5 border border-purple-200">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center">
                      <Shield className="w-5 h-5 text-emerald-600" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold text-emerald-600">{controls.length}</p>
                      <p className="text-xs text-slate-500">Ø¶Ø§Ø¨Ø· Ù…ØªØ£Ø«Ø±</p>
                    </div> </div>
                  <div className="space-y-2">
                    {controls.slice(0, 3).map(c => (
                      <div key={c.id} className="text-sm text-slate-600 truncate">â€¢ {c.code}</div>
                    ))}
                  </div> </div>
                <div className="bg-white rounded-2xl p-5 border border-purple-200">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center">
                      <AlertTriangle className="w-5 h-5 text-amber-600" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold text-amber-600">{risks.length}</p>
                      <p className="text-xs text-slate-500">Ù…Ø®Ø§Ø·Ø± Ù…ØªØ£Ø«Ø±Ø©</p>
                    </div> </div>
                  <div className="space-y-2">
                    {risks.slice(0, 3).map(r => (
                      <div key={r.id} className="text-sm text-slate-600 truncate">â€¢ {r.code}</div>
                    ))}
                  </div> </div> </div> </div>
            {POLICY_RULES.requiresImpactAnalysis(policy) && (
              <div className="bg-amber-50 rounded-2xl p-6 border-2 border-amber-200">
                <div className="flex items-start gap-4">
                  <AlertTriangle className="w-6 h-6 text-amber-600 flex-shrink-0 mt-1" />
                  <div>
                    <h4 className="font-bold text-amber-800 mb-2">ØªÙ†Ø¨ÙŠÙ‡: ÙŠØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„</h4>
                    <p className="text-amber-700">Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø§Ø±ØªØ¨Ø§Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¨Ù€ {obligations.length} Ø§Ù„ØªØ²Ø§Ù… Ùˆ {controls.length} Ø¶Ø§Ø¨Ø·ØŒ ÙŠØ¬Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù‚Ø¨Ù„ ØªÙØ¹ÙŠÙ„ Ø£ÙŠ ØªØºÙŠÙŠØ±.</p>
                  </div> </div> </div>
            )}
          </div>
        )}

        {activeTab === 7 && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 p-8 text-center">
            <div className="w-20 h-20 mx-auto mb-4 rounded-2xl bg-emerald-100 flex items-center justify-center">
              <FileCheck className="w-10 h-10 text-emerald-600" />
            </div>
            <h3 className="text-xl font-bold text-slate-800 mb-2">Ù…ÙˆÙ„Ù‘Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„Ø£Ø¯Ù„Ø©</h3>
            <p className="text-slate-500 mb-6">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø£Ø¯Ù„Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚</p>
            <div className="flex items-center justify-center gap-4">
              <button className="flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                <Download className="w-5 h-5" />
                ØªØ­Ù…ÙŠÙ„ PDF
              </button>
              <button className="flex items-center gap-2 px-6 py-3 border-2 border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50">
                <FileText className="w-5 h-5" />
                ØªØµØ¯ÙŠØ± Excel
              </button> </div> </div>
        )}
      </div> </div>);
};

// POLICY CREATE MODAL
// PolicyFormModal - World-Class Enterprise Edition v3.0
// ÙŠØªÙÙˆÙ‚ Ø¹Ù„Ù‰: Archer, ServiceNow, MetricStream, SAP GRC, IBM OpenPages
//            OneTrust, LogicGate, Workiva, Diligent, NAVEX Global
// 10 Tabs Ø´Ø§Ù…Ù„Ø© | SoD Validation | RACI Matrix | Dynamic Regulatory Mapping
// Document Hierarchy | Exception Management | Attestation Campaigns
// Cross-Framework Mapping | Impact Analysis | Audit Trail

const PolicyFormModal = ({ data, onClose, onUpdate, mode = 'create' }) => {
  const [activeTab, setActiveTab] = useState(0);
  const [validationErrors, setValidationErrors] = useState({});
  const [showPreview, setShowPreview] = useState(false);
  const [expandedSections, setExpandedSections] = useState({});

  const isEditMode = mode === 'edit';
  const isViewMode = mode === 'view';
  const isReadOnly = isViewMode;

  // ğŸ¯ COMPREHENSIVE REFERENCE DATA

  // 8 Ø¬Ù‡Ø§Øª Ø±Ù‚Ø§Ø¨ÙŠØ© Ø³Ø¹ÙˆØ¯ÙŠØ© + Ø£Ø·Ø± Ø¯ÙˆÙ„ÙŠØ©
  const REGULATORY_AUTHORITIES_DATA = [
    { id: 'sama', code: 'SAMA', nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', nameEn: 'Saudi Central Bank', color: 'emerald', icon: 'ğŸ¦', sector: 'Ù…Ø§Ù„ÙŠ', priority: 1 },
    { id: 'cma', code: 'CMA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Capital Market Authority', color: 'blue', icon: 'ğŸ“ˆ', sector: 'Ù…Ø§Ù„ÙŠ', priority: 2 },
    { id: 'nca', code: 'NCA', nameAr: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'National Cybersecurity Authority', color: 'purple', icon: 'ğŸ›¡ï¸', sector: 'Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', priority: 1 },
    { id: 'sdaia', code: 'SDAIA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'Saudi Data & AI Authority', color: 'cyan', icon: 'ğŸ¤–', sector: 'Ø¨ÙŠØ§Ù†Ø§Øª', priority: 2 },
    { id: 'citc', code: 'CITC', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'Communications & IT Commission', color: 'indigo', icon: 'ğŸ“¡', sector: 'Ø§ØªØµØ§Ù„Ø§Øª', priority: 3 },
    { id: 'mhrsd', code: 'MHRSD', nameAr: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', nameEn: 'Ministry of Human Resources', color: 'teal', icon: 'ğŸ‘¥', sector: 'Ø¹Ù…Ø§Ù„ÙŠ', priority: 3 },
    { id: 'cchi', code: 'CCHI', nameAr: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', nameEn: 'Council of Health Insurance', color: 'rose', icon: 'ğŸ¥', sector: 'ØµØ­ÙŠ', priority: 4 },
    { id: 'zatca', code: 'ZATCA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', nameEn: 'Zakat, Tax & Customs', color: 'amber', icon: 'ğŸ’°', sector: 'Ø¶Ø±ÙŠØ¨ÙŠ', priority: 2 },
  ];

  // Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„ÙƒÙ„ Ø¬Ù‡Ø©
  const REGULATORY_FRAMEWORKS_DATA = {
    sama: [
      { code: 'SAMA-CSF', nameAr: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'Cybersecurity Framework', version: '1.0', year: 2017, controls: 86, domains: 4 },
      { code: 'SAMA-BCM', nameAr: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', nameEn: 'Business Continuity Management', version: '2.0', year: 2020, controls: 45, domains: 5 },
      { code: 'SAMA-AML', nameAr: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', nameEn: 'Anti-Money Laundering', version: '3.0', year: 2021, controls: 62, domains: 6 },
      { code: 'SAMA-ITGF', nameAr: 'Ø­ÙˆÙƒÙ…Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'IT Governance Framework', version: '1.5', year: 2019, controls: 78, domains: 5 },
      { code: 'SAMA-ORF', nameAr: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', nameEn: 'Operational Risk Framework', version: '2.0', year: 2022, controls: 55, domains: 4 },
      { code: 'SAMA-TPR', nameAr: 'Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«', nameEn: 'Third Party Risk', version: '1.0', year: 2023, controls: 38, domains: 3 },
    ],
    cma: [
      { code: 'CMA-CGR', nameAr: 'Ù„Ø§Ø¦Ø­Ø© Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª', nameEn: 'Corporate Governance Regulations', version: '2021', year: 2021, controls: 95, domains: 8 },
      { code: 'CMA-MAR', nameAr: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø³ÙˆÙ‚', nameEn: 'Market Rules', version: '2023', year: 2023, controls: 120, domains: 7 },
      { code: 'CMA-AML', nameAr: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', nameEn: 'AML Rules', version: '2022', year: 2022, controls: 55, domains: 4 },
      { code: 'CMA-DIS', nameAr: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­', nameEn: 'Disclosure Requirements', version: '2023', year: 2023, controls: 42, domains: 3 },
    ],
    nca: [
      { code: 'NCA-ECC', nameAr: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'Essential Cybersecurity Controls', version: '2.0', year: 2024, controls: 114, domains: 5 },
      { code: 'NCA-CSCC', nameAr: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', nameEn: 'Critical Systems Controls', version: '1.0', year: 2022, controls: 75, domains: 4 },
      { code: 'NCA-DCC', nameAr: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Cybersecurity Controls', version: '1.0', year: 2023, controls: 48, domains: 3 },
      { code: 'NCA-CCC', nameAr: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', nameEn: 'Cloud Cybersecurity Controls', version: '1.0', year: 2023, controls: 65, domains: 4 },
      { code: 'NCA-TCC', nameAr: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù† Ø¨Ø¹Ø¯', nameEn: 'Telework Cybersecurity Controls', version: '1.0', year: 2020, controls: 32, domains: 2 },
      { code: 'NCA-OT', nameAr: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', nameEn: 'OT Security Controls', version: '1.0', year: 2024, controls: 58, domains: 4 },
    ],
    sdaia: [
      { code: 'PDPL', nameAr: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', nameEn: 'Personal Data Protection Law', version: '2023', year: 2023, controls: 43, domains: 5 },
      { code: 'NDMO', nameAr: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ©', nameEn: 'National Data Classification', version: '1.0', year: 2022, controls: 28, domains: 3 },
      { code: 'AI-ETH', nameAr: 'Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'AI Ethics Guidelines', version: '1.0', year: 2023, controls: 35, domains: 4 },
      { code: 'DG-FW', nameAr: 'Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Governance Framework', version: '1.0', year: 2024, controls: 52, domains: 5 },
    ],
    citc: [
      { code: 'CRF', nameAr: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù„Ù„Ø§ØªØµØ§Ù„Ø§Øª', nameEn: 'Communications Regulatory Framework', version: '2022', year: 2022, controls: 88, domains: 6 },
      { code: 'IOT-SEC', nameAr: 'Ø£Ù…Ù† Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡', nameEn: 'IoT Security Framework', version: '1.0', year: 2023, controls: 42, domains: 3 },
    ],
    mhrsd: [
      { code: 'LABOR', nameAr: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„', nameEn: 'Labor Law', version: '2023', year: 2023, controls: 156, domains: 12 },
      { code: 'WPS', nameAr: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', nameEn: 'Wage Protection System', version: '2.0', year: 2022, controls: 18, domains: 2 },
      { code: 'NITAQAT', nameAr: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ø·Ø§Ù‚Ø§Øª', nameEn: 'Nitaqat Program', version: '3.0', year: 2023, controls: 22, domains: 3 },
      { code: 'QIWA', nameAr: 'Ù…Ù†ØµØ© Ù‚ÙˆÙ‰', nameEn: 'Qiwa Platform', version: '2.0', year: 2024, controls: 35, domains: 4 },
    ],
    cchi: [
      { code: 'CHI', nameAr: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', nameEn: 'Cooperative Health Insurance', version: '2023', year: 2023, controls: 67, domains: 5 },
      { code: 'NPHIES', nameAr: 'Ù…Ù†ØµØ© ØµØ­ÙŠ', nameEn: 'NPHIES Platform', version: '1.0', year: 2022, controls: 45, domains: 4 },
    ],
    zatca: [
      { code: 'VAT', nameAr: 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', nameEn: 'Value Added Tax', version: '2023', year: 2023, controls: 89, domains: 7 },
      { code: 'FATOORA', nameAr: 'Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', nameEn: 'E-Invoicing', version: '2.0', year: 2023, controls: 34, domains: 3 },
      { code: 'ZAKAT', nameAr: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø²ÙƒØ§Ø©', nameEn: 'Zakat Regulations', version: '2022', year: 2022, controls: 42, domains: 4 },
      { code: 'CUSTOMS', nameAr: 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ', nameEn: 'Customs Law', version: '2023', year: 2023, controls: 68, domains: 5 },
    ],
  };

  // Ø§Ù„Ø£Ø·Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ù„Ù„Ù€ Cross-Mapping
  const INTERNATIONAL_FRAMEWORKS = [
    { code: 'ISO27001', nameAr: 'Ø¢ÙŠØ²Ùˆ 27001', nameEn: 'ISO 27001:2022', icon: 'ğŸ”', controls: 93 },
    { code: 'ISO22301', nameAr: 'Ø¢ÙŠØ²Ùˆ 22301', nameEn: 'ISO 22301:2019', icon: 'ğŸ”„', controls: 54 },
    { code: 'NIST-CSF', nameAr: 'Ø¥Ø·Ø§Ø± NIST', nameEn: 'NIST CSF 2.0', icon: 'ğŸ‡ºğŸ‡¸', controls: 108 },
    { code: 'COBIT', nameAr: 'ÙƒÙˆØ¨Øª', nameEn: 'COBIT 2019', icon: 'ğŸ“Š', controls: 40 },
    { code: 'PCI-DSS', nameAr: 'Ù…Ø¹ÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹', nameEn: 'PCI DSS 4.0', icon: 'ğŸ’³', controls: 253 },
    { code: 'SOC2', nameAr: 'Ù…Ø¹Ø§ÙŠÙŠØ± SOC2', nameEn: 'SOC 2 Type II', icon: 'âœ…', controls: 64 },
    { code: 'GDPR', nameAr: 'Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ©', nameEn: 'GDPR', icon: 'ğŸ‡ªğŸ‡º', controls: 99 },
    { code: 'SWIFT-CSP', nameAr: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø³ÙˆÙŠÙØª', nameEn: 'SWIFT CSP', icon: 'ğŸ’±', controls: 32 },
  ];

  // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ (Document Hierarchy)
  const DOCUMENT_TYPES = [
    { code: 'Policy', level: 1, nameAr: 'Ø³ÙŠØ§Ø³Ø©', nameEn: 'Policy', icon: 'ğŸ“œ', color: 'emerald', description: 'ÙˆØ«ÙŠÙ‚Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ØªØ­Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø¦ ÙˆØ§Ù„ØªÙˆØ¬Ù‡Ø§Øª' },
    { code: 'Standard', level: 2, nameAr: 'Ù…Ø¹ÙŠØ§Ø±', nameEn: 'Standard', icon: 'ğŸ“‹', color: 'blue', description: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³' },
    { code: 'Procedure', level: 3, nameAr: 'Ø¥Ø¬Ø±Ø§Ø¡', nameEn: 'Procedure', icon: 'ğŸ“', color: 'purple', description: 'Ø®Ø·ÙˆØ§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„ØªÙ†ÙÙŠØ° ÙˆØ§Ù„ØªØ´ØºÙŠÙ„' },
    { code: 'Guideline', level: 3, nameAr: 'Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ', nameEn: 'Guideline', icon: 'ğŸ“–', color: 'cyan', description: 'ØªÙˆØµÙŠØ§Øª ÙˆØ£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª ØºÙŠØ± Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©' },
    { code: 'Baseline', level: 2, nameAr: 'Ø®Ø· Ø£Ø³Ø§Ø³', nameEn: 'Baseline', icon: 'ğŸ“Š', color: 'amber', description: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©' },
    { code: 'Playbook', level: 4, nameAr: 'Ø¯Ù„ÙŠÙ„ ØªØ´ØºÙŠÙ„ÙŠ', nameEn: 'Playbook', icon: 'ğŸ“•', color: 'rose', description: 'Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«' },
  ];

  // Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© (5 Ù…Ø³ØªÙˆÙŠØ§Øª)
  const CLASSIFICATION_LEVELS = [
    { code: 'Public', level: 1, nameAr: 'Ø¹Ø§Ù…', nameEn: 'Public', color: 'emerald', icon: 'ğŸŒ', description: 'ÙŠÙ…ÙƒÙ† Ù†Ø´Ø±Ù‡ Ù„Ù„Ø¹Ù…ÙˆÙ…' },
    { code: 'Internal', level: 2, nameAr: 'Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal', color: 'blue', icon: 'ğŸ¢', description: 'Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·' },
    { code: 'Confidential', level: 3, nameAr: 'Ø³Ø±ÙŠ', nameEn: 'Confidential', color: 'amber', icon: 'ğŸ”’', description: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø³Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© Ø§Ù„ÙˆØµÙˆÙ„' },
    { code: 'Restricted', level: 4, nameAr: 'Ù…Ø­Ø¯ÙˆØ¯', nameEn: 'Restricted', color: 'orange', icon: 'âš ï¸', description: 'ÙˆØµÙˆÙ„ Ù…Ù‚ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' },
    { code: 'TopSecret', level: 5, nameAr: 'Ø³Ø±ÙŠ Ù„Ù„ØºØ§ÙŠØ©', nameEn: 'Top Secret', color: 'red', icon: 'ğŸš«', description: 'Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù…Ù† Ø§Ù„Ø³Ø±ÙŠØ©' },
  ];

  // Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ù‡Ù…ÙŠØ©/Ø§Ù„Ø­Ø±Ø¬ÙŠØ©
  const CRITICALITY_LEVELS = [
    { code: 'Low', score: 1, nameAr: 'Ù…Ù†Ø®ÙØ¶', nameEn: 'Low', color: 'emerald', sla: 30, description: 'ØªØ£Ø«ÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' },
    { code: 'Medium', score: 2, nameAr: 'Ù…ØªÙˆØ³Ø·', nameEn: 'Medium', color: 'amber', sla: 14, description: 'ØªØ£Ø«ÙŠØ± Ù…ØªÙˆØ³Ø·' },
    { code: 'High', score: 3, nameAr: 'Ø¹Ø§Ù„ÙŠ', nameEn: 'High', color: 'orange', sla: 7, description: 'ØªØ£Ø«ÙŠØ± ÙƒØ¨ÙŠØ±' },
    { code: 'Critical', score: 4, nameAr: 'Ø­Ø±Ø¬', nameEn: 'Critical', color: 'red', sla: 1, description: 'ØªØ£Ø«ÙŠØ± Ø®Ø·ÙŠØ±' },
  ];

  // Ø­Ø§Ù„Ø§Øª Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø© (8 Ø­Ø§Ù„Ø§Øª)
  const LIFECYCLE_STATES = [
    { code: 'Draft', nameAr: 'Ù…Ø³ÙˆØ¯Ø©', nameEn: 'Draft', color: 'slate', icon: 'âœï¸', next: ['PendingReview', 'Cancelled'] },
    { code: 'PendingReview', nameAr: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', nameEn: 'Pending Review', color: 'blue', icon: 'ğŸ‘ï¸', next: ['PendingApproval', 'Draft', 'Rejected'] },
    { code: 'PendingApproval', nameAr: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', nameEn: 'Pending Approval', color: 'purple', icon: 'âœï¸', next: ['Approved', 'PendingReview', 'Rejected'] },
    { code: 'Approved', nameAr: 'Ù…Ø¹ØªÙ…Ø¯', nameEn: 'Approved', color: 'indigo', icon: 'âœ…', next: ['Published'] },
    { code: 'Published', nameAr: 'Ù…Ù†Ø´ÙˆØ±', nameEn: 'Published', color: 'emerald', icon: 'ğŸ“¢', next: ['UnderRevision', 'Retired'] },
    { code: 'UnderRevision', nameAr: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«', nameEn: 'Under Revision', color: 'amber', icon: 'ğŸ”„', next: ['PendingReview'] },
    { code: 'Retired', nameAr: 'Ù…ØªÙ‚Ø§Ø¹Ø¯', nameEn: 'Retired', color: 'gray', icon: 'ğŸ“¦', next: ['Archived'] },
    { code: 'Archived', nameAr: 'Ù…Ø¤Ø±Ø´Ù', nameEn: 'Archived', color: 'gray', icon: 'ğŸ—„ï¸', next: [] },
  ];

  // Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  const REVIEW_FREQUENCIES = [
    { code: 'Monthly', nameAr: 'Ø´Ù‡Ø±ÙŠ', nameEn: 'Monthly', days: 30, icon: 'ğŸ“…' },
    { code: 'Quarterly', nameAr: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', nameEn: 'Quarterly', days: 90, icon: 'ğŸ“Š' },
    { code: 'SemiAnnual', nameAr: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', nameEn: 'Semi-Annual', days: 180, icon: 'ğŸ“ˆ' },
    { code: 'Annual', nameAr: 'Ø³Ù†ÙˆÙŠ', nameEn: 'Annual', days: 365, icon: 'ğŸ“†' },
    { code: 'Biennial', nameAr: 'ÙƒÙ„ Ø³Ù†ØªÙŠÙ†', nameEn: 'Biennial', days: 730, icon: 'ğŸ—“ï¸' },
    { code: 'Triennial', nameAr: 'ÙƒÙ„ 3 Ø³Ù†ÙˆØ§Øª', nameEn: 'Triennial', days: 1095, icon: 'ğŸ“‹' },
    { code: 'EventDriven', nameAr: 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«', nameEn: 'Event-Driven', days: null, icon: 'âš¡' },
  ];

  // Ù…Ø­ÙØ²Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  const REVIEW_TRIGGERS = [
    { code: 'RegulatoryChange', nameAr: 'ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: 'ğŸ“œ' },
    { code: 'SecurityIncident', nameAr: 'Ø­Ø§Ø¯Ø« Ø£Ù…Ù†ÙŠ', icon: 'ğŸš¨' },
    { code: 'AuditFinding', nameAr: 'Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ¯Ù‚ÙŠÙ‚', icon: 'ğŸ”' },
    { code: 'BusinessChange', nameAr: 'ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', icon: 'ğŸ¢' },
    { code: 'TechnologyChange', nameAr: 'ØªØºÙŠÙŠØ± ØªÙ‚Ù†ÙŠ', icon: 'ğŸ’»' },
    { code: 'RiskAssessment', nameAr: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø±', icon: 'âš ï¸' },
    { code: 'ManagementRequest', nameAr: 'Ø·Ù„Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ', icon: 'ğŸ‘”' },
  ];

  // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©
  const EVIDENCE_TYPES = [
    { code: 'Document', nameAr: 'Ù…Ø³ØªÙ†Ø¯', nameEn: 'Document', icon: FileText },
    { code: 'Screenshot', nameAr: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', nameEn: 'Screenshot', icon: Eye },
    { code: 'Report', nameAr: 'ØªÙ‚Ø±ÙŠØ±', nameEn: 'Report', icon: BarChart3 },
    { code: 'Log', nameAr: 'Ø³Ø¬Ù„ Ù†Ø¸Ø§Ù…', nameEn: 'System Log', icon: FileCheck },
    { code: 'Attestation', nameAr: 'Ø¥Ù‚Ø±Ø§Ø±', nameEn: 'Attestation', icon: CheckSquare },
    { code: 'Audit', nameAr: 'ØªØ¯Ù‚ÙŠÙ‚', nameEn: 'Audit Report', icon: ClipboardCheck },
    { code: 'Config', nameAr: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', nameEn: 'Configuration', icon: Settings },
    { code: 'Email', nameAr: 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', nameEn: 'Email', icon: Mail },
  ];

  // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±
  const ATTESTATION_TYPES = [
    { code: 'ReadAcknowledge', nameAr: 'Ù‚Ø±Ø§Ø¡Ø© ÙˆØ¥Ù‚Ø±Ø§Ø±', icon: Eye, description: 'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙˆØ§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø¨ÙÙ‡Ù…Ù‡Ø§' },
    { code: 'TrainingComplete', nameAr: 'Ø¥ØªÙ…Ø§Ù… ØªØ¯Ø±ÙŠØ¨', icon: BookOpen, description: 'Ø¥ÙƒÙ…Ø§Ù„ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ù…Ø±ØªØ¨Ø·' },
    { code: 'AnnualCertification', nameAr: 'Ø´Ù‡Ø§Ø¯Ø© Ø³Ù†ÙˆÙŠØ©', icon: CheckCircle2, description: 'Ø¥Ù‚Ø±Ø§Ø± Ø³Ù†ÙˆÙŠ Ø¨Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
    { code: 'ComplianceDeclaration', nameAr: 'Ø¥Ù‚Ø±Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„', icon: Shield, description: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª' },
    { code: 'QuizPassed', nameAr: 'Ø§Ø¬ØªÙŠØ§Ø² Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardCheck, description: 'Ø§Ø¬ØªÙŠØ§Ø² Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…' },
  ];

  // Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡
  const EXCEPTION_APPROVAL_LEVELS = [
    { code: 'Manager', level: 1, nameAr: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', nameEn: 'Direct Manager', maxDays: 30 },
    { code: 'Director', level: 2, nameAr: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', nameEn: 'Director', maxDays: 90 },
    { code: 'VP', level: 3, nameAr: 'Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³', nameEn: 'Vice President', maxDays: 180 },
    { code: 'CXO', level: 4, nameAr: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', nameEn: 'C-Level Executive', maxDays: 365 },
    { code: 'Board', level: 5, nameAr: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', nameEn: 'Board of Directors', maxDays: null },
  ];

  // Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª
  const DEPARTMENTS = [
    { code: 'IT', nameAr: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', color: 'blue' },
    { code: 'HR', nameAr: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'teal' },
    { code: 'Finance', nameAr: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', color: 'emerald' },
    { code: 'Legal', nameAr: 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', color: 'purple' },
    { code: 'Operations', nameAr: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', color: 'amber' },
    { code: 'Compliance', nameAr: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', color: 'indigo' },
    { code: 'Risk', nameAr: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', color: 'orange' },
    { code: 'Audit', nameAr: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', color: 'rose' },
    { code: 'Security', nameAr: 'Ø§Ù„Ø£Ù…Ù†', color: 'red' },
    { code: 'Procurement', nameAr: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª', color: 'cyan' },
    { code: 'Marketing', nameAr: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', color: 'pink' },
    { code: 'Sales', nameAr: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', color: 'lime' },
    { code: 'CustomerService', nameAr: 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', color: 'sky' },
    { code: 'All', nameAr: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª', color: 'slate' },
  ];

  // ğŸ“‘ 10 TABS CONFIGURATION

  const tabs = [
    { id: 0, code: 'basic', labelAr: 'Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', labelEn: 'Basic', icon: FileText, color: 'emerald' },
    { id: 1, code: 'regulatory', labelAr: 'Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', labelEn: 'Regulatory', icon: Scale, color: 'blue' },
    { id: 2, code: 'scope', labelAr: 'Ø§Ù„Ù†Ø·Ø§Ù‚', labelEn: 'Scope', icon: Target, color: 'cyan' },
    { id: 3, code: 'accountability', labelAr: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª', labelEn: 'RACI', icon: Users, color: 'purple' },
    { id: 4, code: 'requirements', labelAr: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª', labelEn: 'Requirements', icon: ClipboardCheck, color: 'amber' },
    { id: 5, code: 'schedule', labelAr: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©', labelEn: 'Schedule', icon: Calendar, color: 'indigo' },
    { id: 6, code: 'attestation', labelAr: 'Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª', labelEn: 'Attestation', icon: CheckSquare, color: 'rose' },
    { id: 7, code: 'exceptions', labelAr: 'Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', labelEn: 'Exceptions', icon: AlertTriangle, color: 'orange' },
    { id: 8, code: 'linkages', labelAr: 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø·', labelEn: 'Linkages', icon: Network, color: 'teal' },
    { id: 9, code: 'publish', labelAr: 'Ø§Ù„Ù†Ø´Ø±', labelEn: 'Publish', icon: Send, color: 'green' },
  ];

  // ğŸ“Š COMPUTED VALUES

  // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
  const completionChecks = useMemo(() => [
    { field: 'title', check: data?.title?.length >= 5, label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', tab: 0, weight: 2 },
    { field: 'titleEn', check: data?.titleEn?.length >= 5, label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (EN)', tab: 0, weight: 1 },
    { field: 'type', check: !!data?.type, label: 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©', tab: 0, weight: 2 },
    { field: 'summary', check: data?.summary?.length >= 20, label: 'Ø§Ù„ÙˆØµÙ', tab: 0, weight: 1 },
    { field: 'classification', check: !!data?.classification, label: 'Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ù…Ù†ÙŠ', tab: 0, weight: 1 },
    { field: 'impactLevel', check: !!data?.impactLevel, label: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±', tab: 0, weight: 1 },
    { field: 'primaryAuthority', check: !!data?.primaryAuthority, label: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', tab: 1, weight: 2 },
    { field: 'primaryFramework', check: !!data?.primaryFramework, label: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', tab: 1, weight: 2 },
    { field: 'scopeType', check: !!data?.scopeType, label: 'Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚', tab: 2, weight: 1 },
    { field: 'applicableDepartments', check: data?.applicableDepartments?.length > 0, label: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ©', tab: 2, weight: 1 },
    { field: 'ownerId', check: !!data?.ownerId, label: 'Ø§Ù„Ù…Ø§Ù„Ùƒ', tab: 3, weight: 2 },
    { field: 'reviewerId', check: !!data?.reviewerId, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', tab: 3, weight: 2 },
    { field: 'approverId', check: !!data?.approverId, label: 'Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', tab: 3, weight: 1 },
    { field: 'effectiveDate', check: !!data?.effectiveDate, label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†', tab: 5, weight: 2 },
    { field: 'reviewFrequency', check: !!data?.reviewFrequency, label: 'Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', tab: 5, weight: 1 },
  ], [data]);

  const progressPct = useMemo(() => {
    const totalWeight = completionChecks.reduce((sum, c) => sum + c.weight, 0);
    const completedWeight = completionChecks.filter(c => c.check).reduce((sum, c) => sum + c.weight, 0);
    return Math.round((completedWeight / totalWeight) * 100);
  }, [completionChecks]);

  // Ø­Ø³Ø§Ø¨ Ø§ÙƒØªÙ…Ø§Ù„ ÙƒÙ„ ØªØ§Ø¨
  const tabCompletion = useMemo(() => {
    const result = {};
    tabs.forEach(tab => {
      const tabChecks = completionChecks.filter(c => c.tab === tab.id);
      if (tabChecks.length === 0) {
        result[tab.id] = 100;
      } else {
        const completed = tabChecks.filter(c => c.check).length;
        result[tab.id] = Math.round((completed / tabChecks.length) * 100);
      }
    });
    return result;
  }, [completionChecks]);

  // SoD Validation
  const sodValidation = useMemo(() => {
    const violations = [];
    if (data?.ownerId && data?.reviewerId && data?.ownerId === data?.reviewerId) {
      violations.push({ type: 'owner-reviewer', msg: 'Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', severity: 'error' });
    }
    if (data?.ownerId && data?.approverId && data?.ownerId === data?.approverId) {
      violations.push({ type: 'owner-approver', msg: 'Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', severity: 'error' });
    }
    if (data?.reviewerId && data?.approverId && data?.reviewerId === data?.approverId) {
      violations.push({ type: 'reviewer-approver', msg: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', severity: 'warning' });
    }
    return { isValid: violations.filter(v => v.severity === 'error').length === 0, violations };
  }, [data?.ownerId, data?.reviewerId, data?.approverId]);

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
  const documentTypeInfo = useMemo(() => {
    const typeMap = {
      'Policy': {
        nameAr: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', nameArIndefinite: 'Ø³ÙŠØ§Ø³Ø©', icon: 'ğŸ“œ', color: 'emerald',
        gradientCreate: 'from-emerald-600 via-teal-600 to-cyan-600',
        gradientEdit: 'from-emerald-600 via-emerald-500 to-teal-500'
      },
      'Standard': {
        nameAr: 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø±', nameArIndefinite: 'Ù…Ø¹ÙŠØ§Ø±', icon: 'ğŸ“‹', color: 'blue',
        gradientCreate: 'from-blue-600 via-indigo-600 to-purple-600',
        gradientEdit: 'from-blue-600 via-blue-500 to-indigo-500'
      },
      'Procedure': {
        nameAr: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', nameArIndefinite: 'Ø¥Ø¬Ø±Ø§Ø¡', icon: 'ğŸ“', color: 'purple',
        gradientCreate: 'from-purple-600 via-violet-600 to-indigo-600',
        gradientEdit: 'from-purple-600 via-purple-500 to-violet-500'
      },
      'Guideline': {
        nameAr: 'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠ', nameArIndefinite: 'Ø¯Ù„ÙŠÙ„ Ø¥Ø±Ø´Ø§Ø¯ÙŠ', icon: 'ğŸ“–', color: 'cyan',
        gradientCreate: 'from-cyan-600 via-teal-600 to-emerald-600',
        gradientEdit: 'from-cyan-600 via-cyan-500 to-teal-500'
      },
      'Baseline': {
        nameAr: 'Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³', nameArIndefinite: 'Ø®Ø· Ø£Ø³Ø§Ø³', icon: 'ğŸ“Š', color: 'amber',
        gradientCreate: 'from-amber-600 via-orange-600 to-red-600',
        gradientEdit: 'from-amber-600 via-amber-500 to-orange-500'
      },
      'Playbook': {
        nameAr: 'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ', nameArIndefinite: 'Ø¯Ù„ÙŠÙ„ ØªØ´ØºÙŠÙ„ÙŠ', icon: 'ğŸ“•', color: 'rose',
        gradientCreate: 'from-rose-600 via-pink-600 to-fuchsia-600',
        gradientEdit: 'from-rose-600 via-rose-500 to-pink-500'
      },
    };
    return typeMap[data?.type] || typeMap['Policy'];
  }, [data?.type]);

  // Ø§Ù„Ø£Ø·Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
  const availableFrameworks = useMemo(() => {
    if (!data?.primaryAuthority) return [];
    return REGULATORY_FRAMEWORKS_DATA[data.primaryAuthority] || [];
  }, [data?.primaryAuthority]);

  // ğŸ”§ HANDLERS

  const handleFieldChange = (field, value) => {
    onUpdate(field, value);
    if (validationErrors[field]) setValidationErrors(prev => ({ ...prev, [field]: null }));
  };

  const handleSave = (asDraft = false) => {
    const errors = {};
    if (!data?.title || data.title.length < 5) errors.title = 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨ (5 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
    if (!data?.type) errors.type = 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ù…Ø·Ù„ÙˆØ¨';
    if (!asDraft && !sodValidation.isValid) errors.sod = 'ÙŠÙˆØ¬Ø¯ Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª ÙÙŠ ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª';
    if (Object.keys(errors).length > 0) { setValidationErrors(errors); setActiveTab(0); return; }

    const typeNames = {
      'Policy': 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', 'Standard': 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø±', 'Procedure': 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', 'Guideline': 'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠ',
      'Baseline': 'Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³', 'Playbook': 'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ',
    };
    const typeName = typeNames[data?.type] || 'Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©';
    const action = isEditMode ? 'ØªØ¹Ø¯ÙŠÙ„' : (asDraft ? 'Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©' : 'Ø¥Ù†Ø´Ø§Ø¡');
    alert(`ØªÙ… ${action} ${typeName}: ${data.title}`);
    onClose();
  };

  const toggleSection = (section) => {
    setExpandedSections(prev => ({ ...prev, [section]: !prev[section] }));
  };

  // ğŸ¨ RENDER HELPERS

  const renderFieldLabel = (labelAr, labelEn, required = false, hint = null) => (
    <div className="flex items-center justify-between mb-2">
      <label className="text-sm font-bold text-slate-700">
        {labelAr}
        {required && <span className="text-red-500 mr-1">*</span>}
      </label>
      <div className="flex items-center gap-2">
        {hint && (
          <span className="text-xs text-slate-400 flex items-center gap-1">
            <Info className="w-3 h-3" />
            {hint}
          </span>
        )}
        <span className="text-xs text-slate-400">{labelEn}</span>
      </div> </div>);
  const renderSectionHeader = (titleAr, titleEn, IconComponent, expanded, onToggle, count = null) => (
    <button
      type="button"
      onClick={onToggle}
      className="w-full flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl border border-slate-200 hover:border-slate-300 transition-all"
    >
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-lg bg-white shadow-sm flex items-center justify-center">
          <IconComponent className="w-5 h-5 text-slate-600" />
        </div>
        <div className="text-right">
          <h4 className="font-bold text-slate-800">{titleAr}</h4>
          <p className="text-xs text-slate-500">{titleEn}</p>
        </div>
        {count !== null && (
          <span className="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded-lg">{count}</span>
        )}
      </div>
      <ChevronDown className={`w-5 h-5 text-slate-400 transition-transform ${expanded ? 'rotate-180' : ''}`} />
    </button>);
  const getColorClasses = (color, isSelected) => {
    const colors = {
      emerald: isSelected ? 'bg-emerald-50 border-emerald-400 text-emerald-700' : 'border-slate-200 hover:border-emerald-300',
      blue: isSelected ? 'bg-blue-50 border-blue-400 text-blue-700' : 'border-slate-200 hover:border-blue-300',
      purple: isSelected ? 'bg-purple-50 border-purple-400 text-purple-700' : 'border-slate-200 hover:border-purple-300',
      cyan: isSelected ? 'bg-cyan-50 border-cyan-400 text-cyan-700' : 'border-slate-200 hover:border-cyan-300',
      indigo: isSelected ? 'bg-indigo-50 border-indigo-400 text-indigo-700' : 'border-slate-200 hover:border-indigo-300',
      teal: isSelected ? 'bg-teal-50 border-teal-400 text-teal-700' : 'border-slate-200 hover:border-teal-300',
      rose: isSelected ? 'bg-rose-50 border-rose-400 text-rose-700' : 'border-slate-200 hover:border-rose-300',
      amber: isSelected ? 'bg-amber-50 border-amber-400 text-amber-700' : 'border-slate-200 hover:border-amber-300',
      orange: isSelected ? 'bg-orange-50 border-orange-400 text-orange-700' : 'border-slate-200 hover:border-orange-300',
      red: isSelected ? 'bg-red-50 border-red-400 text-red-700' : 'border-slate-200 hover:border-red-300',
      slate: isSelected ? 'bg-slate-100 border-slate-400 text-slate-700' : 'border-slate-200 hover:border-slate-300',
      gray: isSelected ? 'bg-gray-100 border-gray-400 text-gray-700' : 'border-slate-200 hover:border-gray-300',
    };
    return colors[color] || colors.slate;
  };

  // ğŸ“ TAB 1: Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - BASIC INFORMATION

  const renderTabBasic = () => (
    <div className="space-y-6">
      <div className="grid grid-cols-2 gap-6">
        <div>
          {renderFieldLabel('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ§Ø³Ø©', 'Policy Title (Arabic)', true)}
          <input
            type="text"
            value={data?.title || ''}
            onChange={(e) => handleFieldChange('title', e.target.value)}
            disabled={isReadOnly}
            className={`w-full px-4 py-3 border-2 rounded-xl focus:outline-none focus:border-emerald-500 text-lg ${validationErrors.title ? 'border-red-400 bg-red-50' : 'border-slate-200'
              }`}
            placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©..."
          />
          {validationErrors.title && <p className="text-red-500 text-sm mt-1">{validationErrors.title}</p>}
        </div>
        <div>
          {renderFieldLabel('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', 'Policy Title (English)')}
          <input
            type="text"
            value={data?.titleEn || ''}
            onChange={(e) => handleFieldChange('titleEn', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 text-lg"
            placeholder="Enter policy title in English..."
            dir="ltr"
          />
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', 'Executive Summary', true, 'Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 20 Ø­Ø±Ù')}
        <textarea
          value={data?.summary || ''}
          onChange={(e) => handleFieldChange('summary', e.target.value)}
          disabled={isReadOnly}
          rows={4}
          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 resize-none"
          placeholder="Ù…Ù„Ø®Øµ Ù…ÙˆØ¬Ø² Ù„Ù„Ø³ÙŠØ§Ø³Ø© ÙŠÙˆØ¶Ø­ Ø§Ù„ØºØ±Ø¶ ÙˆØ§Ù„Ù†Ø·Ø§Ù‚..."
        />
        <div className="flex justify-between mt-1">
          <span className="text-xs text-slate-400">{data?.summary?.length || 0} Ø­Ø±Ù</span>
          <span className={`text-xs ${(data?.summary?.length || 0) >= 20 ? 'text-emerald-600' : 'text-amber-600'}`}>
            {(data?.summary?.length || 0) >= 20 ? 'âœ“ Ù…ÙƒØªÙ…Ù„' : `${20 - (data?.summary?.length || 0)} Ø­Ø±Ù Ù…ØªØ¨Ù‚ÙŠ`}
          </span> </div> </div>
      <div>
        {renderFieldLabel('Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©', 'Document Type', true)}
        <div className="grid grid-cols-6 gap-3">
          {DOCUMENT_TYPES.map(type => {
            const isSelected = data?.type === type.code;
            return (
              <button
                key={type.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => handleFieldChange('type', type.code)}
                className={`p-4 rounded-xl border-2 text-center transition-all group relative ${isSelected
                  ? `${getColorClasses(type.color, true)} shadow-md`
                  : 'bg-white border-slate-200 hover:border-slate-300 hover:shadow'
                  }`}>
                <span className="text-3xl block mb-2">{type.icon}</span>
                <span className={`text-sm font-bold block ${isSelected ? '' : 'text-slate-700'}`}>{type.nameAr}</span>
                <span className="text-xs text-slate-400 block">L{type.level}</span>
                <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                  {type.description}
                </div> </button>);
          })}
        </div> </div>
      <div className="grid grid-cols-2 gap-6">
        <div>
          {renderFieldLabel('Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ù…Ù†ÙŠ', 'Security Classification', true)}
          <div className="grid grid-cols-5 gap-2">
            {CLASSIFICATION_LEVELS.map(level => {
              const isSelected = data?.classification === level.code;
              return (
                <button
                  key={level.code}
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('classification', level.code)}
                  className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? `${getColorClasses(level.color, true)} shadow-md` : 'bg-white border-slate-200 hover:border-slate-300'
                    }`}>
                  <span className="text-xl block mb-1">{level.icon}</span>
                  <span className={`text-xs font-bold block ${isSelected ? '' : 'text-slate-600'}`}>{level.nameAr}</span>
                </button>);
            })}
          </div> </div>
        <div>
          {renderFieldLabel('Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±', 'Impact Level')}
          <div className="grid grid-cols-4 gap-3">
            {CRITICALITY_LEVELS.map(level => {
              const isSelected = data?.impactLevel === level.code;
              return (
                <button
                  key={level.code}
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('impactLevel', level.code)}
                  className={`p-4 rounded-xl border-2 text-center transition-all ${isSelected ? `${getColorClasses(level.color, true)} shadow-md` : 'bg-white border-slate-200 hover:border-slate-300'
                    }`}>
                  <div className={`text-2xl font-black mb-1 ${isSelected ? '' : 'text-slate-400'}`}>{level.score}</div>
                  <div className={`text-sm font-bold ${isSelected ? '' : 'text-slate-600'}`}>{level.nameAr}</div>
                  <div className="text-xs text-slate-400 mt-1">SLA: {level.sla}d</div>
                </button>);
            })}
          </div> </div> </div>
      <div className="grid grid-cols-2 gap-6">
        <div>
          {renderFieldLabel('Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ', 'Functional Category')}
          <select
            value={data?.category || 'Compliance'}
            onChange={(e) => handleFieldChange('category', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 bg-white">
            <option value="Compliance">ğŸ¯ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</option>
            <option value="IT">ğŸ’» ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
            <option value="Security">ğŸ” Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
            <option value="HR">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
            <option value="Finance">ğŸ’° Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
            <option value="Operations">âš™ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option>
            <option value="Risk">âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
            <option value="Legal">âš–ï¸ Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</option>
            <option value="Privacy">ğŸ”’ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</option>
            <option value="BCM">ğŸ”„ Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
          </select>
        </div>
        <div>
          {renderFieldLabel('Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…', 'Parent Policy', false, 'Ù„Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ')}
          <select
            value={data?.parentPolicyId || ''}
            onChange={(e) => handleFieldChange('parentPolicyId', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 bg-white">
            <option value="">-- Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ§Ø³Ø© Ø£Ù… (ÙˆØ«ÙŠÙ‚Ø© Ù…Ø³ØªÙ‚Ù„Ø©) --</option>
            <option value="POL-001">ğŸ“œ POL-001 - Ø³ÙŠØ§Ø³Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
            <option value="POL-002">ğŸ“œ POL-002 - Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</option>
            <option value="POL-003">ğŸ“œ POL-003 - Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
          </select>
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©', 'Tags / Keywords', false, 'Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©')}
        <input
          type="text"
          value={data?.tags?.join(', ') || ''}
          onChange={(e) => handleFieldChange('tags', e.target.value.split(',').map(t => t.trim()).filter(Boolean))}
          disabled={isReadOnly}
          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500"
          placeholder="Ø£Ù…Ù† Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ, Ø­ÙˆÙƒÙ…Ø©, Ø®ØµÙˆØµÙŠØ©, SAMA, NCA..."
        />
        {data?.tags?.length > 0 && (
          <div className="flex flex-wrap gap-2 mt-2">
            {data.tags.map((tag, idx) => (
              <span key={idx} className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                #{tag}
              </span>
            ))}
          </div>
        )}
      </div> </div>);
  // ğŸ“ TAB 2: Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ - REGULATORY REFERENCE

  const renderTabRegulatory = () => {
    const selectedAuth = REGULATORY_AUTHORITIES_DATA.find(a => a.id === data?.primaryAuthority);

    return (
      <div className="space-y-6">
        <div>
          {renderFieldLabel('Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'Primary Regulatory Authority', true)}
          <div className="grid grid-cols-4 gap-3">
            {REGULATORY_AUTHORITIES_DATA.map(auth => {
              const isSelected = data?.primaryAuthority === auth.id;
              return (
                <button
                  key={auth.id}
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => {
                    handleFieldChange('primaryAuthority', auth.id);
                    handleFieldChange('primaryFramework', '');
                  }}
                  className={`p-4 rounded-xl border-2 text-center transition-all ${isSelected ? `${getColorClasses(auth.color, true)} shadow-lg` : 'bg-white border-slate-200 hover:border-slate-300 hover:shadow'
                    }`}>
                  <span className="text-3xl block mb-2">{auth.icon}</span>
                  <span className={`text-sm font-bold block ${isSelected ? '' : 'text-slate-700'}`}>{auth.code}</span>
                  <span className="text-xs text-slate-500 block mt-1">{auth.sector}</span>
                </button>);
            })}
          </div> </div>
        {selectedAuth && availableFrameworks.length > 0 && (
          <div>
            {renderFieldLabel('Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', 'Regulatory Framework', true)}
            <div className="grid grid-cols-2 gap-3">
              {availableFrameworks.map(fw => {
                const isSelected = data?.primaryFramework === fw.code;
                return (
                  <button
                    key={fw.code}
                    type="button"
                    disabled={isReadOnly}
                    onClick={() => handleFieldChange('primaryFramework', fw.code)}
                    className={`p-4 rounded-xl border-2 text-right transition-all ${isSelected ? `${getColorClasses(selectedAuth.color, true)} shadow-md` : 'bg-white border-slate-200 hover:border-slate-300'
                      }`}>
                    <div className="flex items-center justify-between mb-2">
                      <span className={`px-2 py-1 rounded text-xs font-bold ${isSelected ? 'bg-white/50' : 'bg-slate-100 text-slate-600'
                        }`}>{fw.code}</span>
                      <span className="text-xs text-slate-400">v{fw.version} ({fw.year})</span>
                    </div>
                    <p className={`font-bold ${isSelected ? '' : 'text-slate-700'}`}>{fw.nameAr}</p>
                    <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                      <span>ğŸ“Š {fw.controls} Ø¶Ø§Ø¨Ø·</span>
                      <span>ğŸ“ {fw.domains} Ù†Ø·Ø§Ù‚</span>
                    </div> </button>);
              })}
            </div> </div>
        )}

        <div>
          {renderFieldLabel('Ø¬Ù‡Ø§Øª Ø±Ù‚Ø§Ø¨ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©', 'Additional Authorities', false, 'Ø§Ø®ØªØ± Ù…ØªØ¹Ø¯Ø¯')}
          <div className="flex flex-wrap gap-2">
            {REGULATORY_AUTHORITIES_DATA.filter(a => a.id !== data?.primaryAuthority).map(auth => {
              const isSelected = data?.additionalAuthorities?.includes(auth.id);
              return (
                <button
                  key={auth.id}
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => {
                    const current = data?.additionalAuthorities || [];
                    handleFieldChange('additionalAuthorities',
                      isSelected ? current.filter(id => id !== auth.id) : [...current, auth.id]
                    );
                  }}
                  className={`px-4 py-2 rounded-xl border-2 transition-all flex items-center gap-2 ${isSelected ? `${getColorClasses(auth.color, true)}` : 'bg-white border-slate-200 hover:border-slate-300'
                    }`}>
                  <span>{auth.icon}</span>
                  <span className={`text-sm font-bold ${isSelected ? '' : 'text-slate-600'}`}>{auth.code}</span>
                </button>);
            })}
          </div> </div>
        <div>
          {renderFieldLabel('Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø£Ø·Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©', 'International Framework Mapping')}
          <div className="flex flex-wrap gap-2">
            {INTERNATIONAL_FRAMEWORKS.map(fw => {
              const isSelected = data?.internationalFrameworks?.includes(fw.code);
              return (
                <button
                  key={fw.code}
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => {
                    const current = data?.internationalFrameworks || [];
                    handleFieldChange('internationalFrameworks',
                      isSelected ? current.filter(c => c !== fw.code) : [...current, fw.code]
                    );
                  }}
                  className={`px-4 py-2 rounded-xl border-2 transition-all flex items-center gap-2 ${isSelected ? 'bg-indigo-50 border-indigo-400 text-indigo-700' : 'bg-white border-slate-200 hover:border-slate-300'
                    }`}>
                  <span>{fw.icon}</span>
                  <span className={`text-sm font-bold ${isSelected ? '' : 'text-slate-600'}`}>{fw.code}</span>
                </button>);
            })}
          </div> </div>
        <div className="grid grid-cols-2 gap-6">
          <div>
            {renderFieldLabel('Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø© / Ø§Ù„Ø¨Ù†Ø¯', 'Article Reference')}
            <input
              type="text"
              value={data?.articleNumber || ''}
              onChange={(e) => handleFieldChange('articleNumber', e.target.value)}
              disabled={isReadOnly}
              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-blue-500"
              placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø§Ø¯Ø© 5-2-1 Ø£Ùˆ Control 3.4.2"
            />
          </div>
          <div>
            {renderFieldLabel('Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ', 'Official Reference URL')}
            <input
              type="url"
              value={data?.referenceUrl || ''}
              onChange={(e) => handleFieldChange('referenceUrl', e.target.value)}
              disabled={isReadOnly}
              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-blue-500"
              placeholder="https://..."
              dir="ltr"
            />
          </div> </div>
        {selectedAuth && data?.primaryFramework && (
          <div className={`p-5 rounded-2xl border-2 ${getColorClasses(selectedAuth.color, true)}`}>
            <div className="flex items-center gap-4">
              <span className="text-5xl">{selectedAuth.icon}</span>
              <div className="flex-1">
                <p className="font-bold text-lg">{selectedAuth.nameAr}</p>
                <p className="text-sm opacity-80">{selectedAuth.nameEn}</p>
                <div className="mt-2 flex items-center gap-3">
                  <span className="px-3 py-1 bg-white/50 rounded-lg text-sm font-bold">{data.primaryFramework}</span>
                  {data?.additionalAuthorities?.length > 0 && (
                    <span className="text-sm">+ {data.additionalAuthorities.length} Ø¬Ù‡Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
                  )}
                  {data?.internationalFrameworks?.length > 0 && (
                    <span className="text-sm">| {data.internationalFrameworks.length} Ø£Ø·Ø± Ø¯ÙˆÙ„ÙŠØ©</span>
                  )}
                </div> </div> </div> </div>
        )}
      </div>);
  };

  // ğŸ“ TAB 3: Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„Ø£Ù‡Ø¯Ø§Ù - SCOPE & OBJECTIVES

  const renderTabScope = () => (
    <div className="space-y-6">
      <div>
        {renderFieldLabel('Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚', 'Scope Type', true)}
        <div className="grid grid-cols-3 gap-4">
          {[
            { code: 'Enterprise', nameAr: 'Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©', nameEn: 'Enterprise-wide', icon: Building2, description: 'ØªØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª ÙˆØ§Ù„ÙØ±ÙˆØ¹' },
            { code: 'BusinessUnit', nameAr: 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯Ø¯Ø©', nameEn: 'Business Unit', icon: Briefcase, description: 'ØªØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ù‚Ø·Ø§Ø¹ Ø£Ùˆ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ø¯Ø¯Ø©' },
            { code: 'FunctionSpecific', nameAr: 'ÙˆØ¸ÙŠÙØ© Ù…Ø­Ø¯Ø¯Ø©', nameEn: 'Function Specific', icon: Target, description: 'ØªØ·Ø¨Ù‚ Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ© Ø£Ùˆ Ù†Ø´Ø§Ø· Ù…Ø¹ÙŠÙ†' },
          ].map(scope => {
            const isSelected = data?.scopeType === scope.code;
            const Icon = scope.icon;
            return (
              <button
                key={scope.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => handleFieldChange('scopeType', scope.code)}
                className={`p-5 rounded-xl border-2 transition-all text-right ${isSelected ? 'bg-cyan-50 border-cyan-400 shadow-md' : 'bg-white border-slate-200 hover:border-slate-300'
                  }`}>
                <Icon className={`w-8 h-8 mb-3 ${isSelected ? 'text-cyan-600' : 'text-slate-400'}`} />
                <h4 className={`font-bold ${isSelected ? 'text-cyan-700' : 'text-slate-700'}`}>{scope.nameAr}</h4>
                <p className="text-xs text-slate-500 mt-1">{scope.description}</p>
              </button>);
          })}
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ©', 'Applicable Departments', true, 'Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªØ·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„Ø³ÙŠØ§Ø³Ø©')}
        <div className="flex flex-wrap gap-2">
          {DEPARTMENTS.map(dept => {
            const isSelected = data?.applicableDepartments?.includes(dept.code);
            return (
              <button
                key={dept.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => {
                  const current = data?.applicableDepartments || [];
                  if (dept.code === 'All') {
                    handleFieldChange('applicableDepartments', isSelected ? [] : ['All']);
                  } else {
                    const newDepts = isSelected
                      ? current.filter(d => d !== dept.code)
                      : [...current.filter(d => d !== 'All'), dept.code];
                    handleFieldChange('applicableDepartments', newDepts);
                  }
                }}
                className={`px-4 py-2 rounded-xl border-2 transition-all ${isSelected ? `${getColorClasses(dept.color, true)} font-bold` : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'
                  }`}>
                {dept.nameAr}
              </button>);
          })}
        </div> </div>
      <div>
        {renderFieldLabel('ÙˆØµÙ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ', 'Detailed Scope Description')}
        <textarea
          value={data?.scopeDescription || ''}
          onChange={(e) => handleFieldChange('scopeDescription', e.target.value)}
          disabled={isReadOnly}
          rows={3}
          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-cyan-500 resize-none"
          placeholder="ØªÙ†Ø·Ø¨Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ù…ØªØ¹Ø§Ù‚Ø¯ÙŠÙ† Ø§Ù„Ø°ÙŠÙ†..."
        />
      </div>

      <div>
        {renderFieldLabel('Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©', 'Strategic Objectives')}
        <div className="space-y-2">
          {(data?.objectives || []).map((obj, idx) => (
            <div key={idx} className="flex items-center gap-2">
              <span className="w-8 h-8 rounded-lg bg-cyan-100 text-cyan-700 flex items-center justify-center font-bold text-sm">{idx + 1}</span>
              <input
                type="text"
                value={obj}
                onChange={(e) => {
                  const newObjs = [...(data?.objectives || [])];
                  newObjs[idx] = e.target.value;
                  handleFieldChange('objectives', newObjs);
                }}
                disabled={isReadOnly}
                className="flex-1 px-4 py-2 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-cyan-500"
                placeholder="Ù‡Ø¯Ù..."
              />
              {!isReadOnly && (
                <button type="button" onClick={() => handleFieldChange('objectives', data.objectives.filter((_, i) => i !== idx))}
                  className="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                  <Trash2 className="w-5 h-5" />
                </button>
              )}
            </div>
          ))}
          {!isReadOnly && (
            <button type="button" onClick={() => handleFieldChange('objectives', [...(data?.objectives || []), ''])}
              className="flex items-center gap-2 px-4 py-2 text-cyan-600 hover:bg-cyan-50 rounded-xl font-medium">
              <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù
            </button>
          )}
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚', 'Scope Exclusions')}
        <textarea
          value={data?.scopeExclusions || ''}
          onChange={(e) => handleFieldChange('scopeExclusions', e.target.value)}
          disabled={isReadOnly}
          rows={2}
          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-cyan-500 resize-none"
          placeholder="Ù„Ø§ ØªØ·Ø¨Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¹Ù„Ù‰..."
        />
      </div> </div>);
  // ğŸ“ TAB 4: Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª - ACCOUNTABILITY & RACI

  const renderTabAccountability = () => (
    <div className="space-y-6">
      {!sodValidation.isValid && (
        <div className="p-4 bg-red-50 border-2 border-red-200 rounded-xl">
          <div className="flex items-center gap-3">
            <AlertTriangle className="w-6 h-6 text-red-500 flex-shrink-0" />
            <div>
              <p className="font-bold text-red-700">âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù†ØªÙ‡Ø§Ùƒ ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Segregation of Duties)</p>
              <ul className="text-sm text-red-600 mt-1 space-y-1">
                {sodValidation.violations.map((v, i) => (
                  <li key={i} className="flex items-center gap-2">
                    <span className={`w-2 h-2 rounded-full ${v.severity === 'error' ? 'bg-red-500' : 'bg-amber-500'}`}></span>
                    {v.msg}
                  </li>
                ))}
              </ul>
            </div> </div> </div>
      )}

      <div className="grid grid-cols-3 gap-6">
        <div>
          {renderFieldLabel('Ø§Ù„Ù…Ø§Ù„Ùƒ (Owner)', 'Policy Owner', true)}
          <select
            value={data?.ownerId || ''}
            onChange={(e) => handleFieldChange('ownerId', parseInt(e.target.value) || null)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-purple-500 bg-white">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ù„Ùƒ...</option>
            {USERS?.map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
          </select>
          <p className="text-xs text-slate-500 mt-1">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØµÙŠØ§ØºØ© ÙˆØµÙŠØ§Ù†Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø©</p>
        </div>

        <div>
          {renderFieldLabel('Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (Reviewer)', 'Reviewer', true)}
          <select
            value={data?.reviewerId || ''}
            onChange={(e) => handleFieldChange('reviewerId', parseInt(e.target.value) || null)}
            disabled={isReadOnly}
            className={`w-full px-4 py-3 border-2 rounded-xl focus:outline-none bg-white ${data?.ownerId && data?.reviewerId && data.ownerId === data.reviewerId
              ? 'border-red-400 bg-red-50' : 'border-slate-200 focus:border-purple-500'
              }`}>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹...</option>
            {USERS?.filter(u => u.id !== data?.ownerId).map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
          </select>
          <p className="text-xs text-slate-500 mt-1">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
        </div>

        <div>
          {renderFieldLabel('Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Approver)', 'Approver')}
          <select
            value={data?.approverId || ''}
            onChange={(e) => handleFieldChange('approverId', parseInt(e.target.value) || null)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-purple-500 bg-white">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯...</option>
            {USERS?.filter(u => u.id !== data?.ownerId && u.id !== data?.reviewerId).map(u => <option key={u.id} value={u.id}>{u.name} - {u.department}</option>)}
          </select>
          <p className="text-xs text-slate-500 mt-1">ØµØ§Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
        </div> </div>
      <div className="p-5 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl border-2 border-purple-200">
        <div className="flex items-center justify-between mb-4">
          <h4 className="font-bold text-purple-800 flex items-center gap-2">
            <Users className="w-5 h-5" /> Ù…ØµÙÙˆÙØ© RACI Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª
          </h4>
          <span className="text-xs text-purple-600 bg-purple-100 px-3 py-1 rounded-full">
            Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø®Ù„ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
          </span> </div>
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className="border-b-2 border-purple-200">
                <th className="text-right py-3 px-4 text-purple-700 font-bold w-48">Ø§Ù„Ù†Ø´Ø§Ø· / Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                <th className="text-center py-3 px-2">
                  <div className="p-2 bg-blue-100 rounded-lg">
                    <span className="font-black text-blue-700 text-lg">R</span>
                    <p className="text-xs text-blue-600">Responsible</p>
                    <p className="text-xs text-blue-500">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                  </div>
                </th>
                <th className="text-center py-3 px-2">
                  <div className="p-2 bg-red-100 rounded-lg">
                    <span className="font-black text-red-700 text-lg">A</span>
                    <p className="text-xs text-red-600">Accountable</p>
                    <p className="text-xs text-red-500">ØµØ§Ø­Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø±</p>
                  </div>
                </th>
                <th className="text-center py-3 px-2">
                  <div className="p-2 bg-amber-100 rounded-lg">
                    <span className="font-black text-amber-700 text-lg">C</span>
                    <p className="text-xs text-amber-600">Consulted</p>
                    <p className="text-xs text-amber-500">Ù…Ø³ØªØ´Ø§Ø±</p>
                  </div>
                </th>
                <th className="text-center py-3 px-2">
                  <div className="p-2 bg-emerald-100 rounded-lg">
                    <span className="font-black text-emerald-700 text-lg">I</span>
                    <p className="text-xs text-emerald-600">Informed</p>
                    <p className="text-xs text-emerald-500">Ù…ÙØ¨Ù„ÙÙ‘Øº</p>
                  </div>
                </th>
              </tr> </thead>
            <tbody>
              {[
                { id: 'drafting', activity: 'ØµÙŠØ§ØºØ© Ø§Ù„Ø³ÙŠØ§Ø³Ø©', activityEn: 'Policy Drafting' },
                { id: 'technicalReview', activity: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙÙ†ÙŠØ©', activityEn: 'Technical Review' },
                { id: 'approval', activity: 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', activityEn: 'Final Approval' },
                { id: 'publishing', activity: 'Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹', activityEn: 'Publishing' },
                { id: 'periodicReview', activity: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', activityEn: 'Periodic Review' },
                { id: 'exceptionMgmt', activity: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', activityEn: 'Exception Management' },
                { id: 'update', activity: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø³Ø©', activityEn: 'Policy Update' },
                { id: 'training', activity: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©', activityEn: 'Training & Awareness' },
              ].map((row) => {
                const raciData = data?.raciMatrix?.[row.id] || {};
                const ownerName = USERS?.find(u => u.id === data?.ownerId)?.name?.split(' ')[0] || 'Ø§Ù„Ù…Ø§Ù„Ùƒ';
                const reviewerName = USERS?.find(u => u.id === data?.reviewerId)?.name?.split(' ')[0] || 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹';
                const approverName = USERS?.find(u => u.id === data?.approverId)?.name?.split(' ')[0] || 'Ø§Ù„Ù…Ø¹ØªÙ…Ø¯';

                const roleOptions = [
                  { value: 'owner', label: ownerName, color: 'purple' },
                  { value: 'reviewer', label: reviewerName, color: 'blue' },
                  { value: 'approver', label: approverName, color: 'indigo' },
                  { value: 'compliance', label: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', color: 'teal' },
                  { value: 'legal', label: 'Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', color: 'slate' },
                  { value: 'risk', label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', color: 'orange' },
                  { value: 'audit', label: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', color: 'rose' },
                  { value: 'it', label: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', color: 'cyan' },
                  { value: 'hr', label: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'green' },
                  { value: 'all', label: 'Ø§Ù„Ø¬Ù…ÙŠØ¹', color: 'gray' },
                  { value: 'depts', label: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ©', color: 'amber' },
                  { value: 'experts', label: 'Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡', color: 'violet' },
                  { value: 'none', label: '-', color: 'slate' },
                ];

                const getDisplayValue = (role) => {
                  if (role === 'owner') return ownerName;
                  if (role === 'reviewer') return reviewerName;
                  if (role === 'approver') return approverName;
                  return roleOptions.find(r => r.value === role)?.label || '-';
                };

                const getCellColor = (role, type) => {
                  const baseColors = {
                    R: { bg: 'bg-blue-50', hover: 'hover:bg-blue-100', text: 'text-blue-700', border: 'border-blue-200' },
                    A: { bg: 'bg-red-50', hover: 'hover:bg-red-100', text: 'text-red-700', border: 'border-red-200' },
                    C: { bg: 'bg-amber-50', hover: 'hover:bg-amber-100', text: 'text-amber-700', border: 'border-amber-200' },
                    I: { bg: 'bg-emerald-50', hover: 'hover:bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-200' },
                  };
                  return baseColors[type] || baseColors.R;
                };

                return (
                  <tr key={row.id} className="border-b border-purple-100">
                    <td className="py-2 px-4">
                      <div className="font-medium text-slate-700">{row.activity}</div>
                      <div className="text-xs text-slate-400">{row.activityEn}</div>
                    </td>
                    {['R', 'A', 'C', 'I'].map((type) => {
                      const cellColors = getCellColor(null, type);
                      const currentValue = raciData[type] || (
                        type === 'R' ? (row.id === 'drafting' ? 'owner' : row.id === 'technicalReview' ? 'reviewer' : row.id === 'approval' ? 'approver' : 'owner') :
                          type === 'A' ? (row.id === 'drafting' ? 'approver' : row.id === 'approval' ? 'approver' : 'owner') :
                            type === 'C' ? (row.id === 'drafting' ? 'reviewer' : row.id === 'approval' ? 'legal' : 'experts') :
                              (row.id === 'publishing' ? 'all' : 'depts')
                      );

                      return (
                        <td key={type} className={`py-2 px-1 ${cellColors.bg}`}>
                          <select
                            value={currentValue}
                            onChange={(e) => {
                              const newMatrix = { ...(data?.raciMatrix || {}) };
                              if (!newMatrix[row.id]) newMatrix[row.id] = {};
                              newMatrix[row.id][type] = e.target.value;
                              handleFieldChange('raciMatrix', newMatrix);
                            }}
                            disabled={isReadOnly}
                            className={`w-full px-2 py-2 text-xs font-bold rounded-lg border-2 ${cellColors.border} ${cellColors.bg} ${cellColors.text} ${cellColors.hover} focus:outline-none focus:ring-2 focus:ring-purple-300 cursor-pointer transition-all text-center`}
                          >
                            {roleOptions.map(opt => (
                              <option key={opt.value} value={opt.value}>{opt.label}</option>
                            ))}
                          </select>
                        </td>);
                    })}
                  </tr>);
              })}
            </tbody> </table> </div>
        <div className="mt-4 p-3 bg-white/50 rounded-xl">
          <div className="grid grid-cols-4 gap-2 text-xs">
            <div className="flex items-center gap-2">
              <span className="w-6 h-6 rounded bg-blue-500 text-white flex items-center justify-center font-bold">R</span>
              <span className="text-slate-600">Ù…Ù† ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø¹Ù…Ù„</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="w-6 h-6 rounded bg-red-500 text-white flex items-center justify-center font-bold">A</span>
              <span className="text-slate-600">Ù…Ù† ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="w-6 h-6 rounded bg-amber-500 text-white flex items-center justify-center font-bold">C</span>
              <span className="text-slate-600">Ù…Ù† ÙŠÙØ³ØªØ´Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="w-6 h-6 rounded bg-emerald-500 text-white flex items-center justify-center font-bold">I</span>
              <span className="text-slate-600">Ù…Ù† ÙŠÙØ¨Ù„Ù‘Øº Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±</span>
            </div> </div> </div> </div>
      <div>
        {renderFieldLabel('Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯', 'Escalation Rules')}
        <div className="grid grid-cols-3 gap-4">
          {[
            { level: 1, title: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„', days: 3, role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', color: 'emerald' },
            { level: 2, title: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ', days: 7, role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', color: 'amber' },
            { level: 3, title: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«', days: 14, role: 'Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³', color: 'red' },
          ].map(esc => (
            <div key={esc.level} className={`p-4 rounded-xl border-2 ${getColorClasses(esc.color, false)}`}>
              <div className="flex items-center justify-between mb-2">
                <span className={`px-2 py-1 rounded text-xs font-bold bg-${esc.color}-100 text-${esc.color}-700`}>L{esc.level}</span>
                <span className="text-xs text-slate-500">Ø¨Ø¹Ø¯ {esc.days} Ø£ÙŠØ§Ù…</span>
              </div>
              <p className="font-bold text-slate-700">{esc.title}</p>
              <p className="text-sm text-slate-500">{esc.role}</p>
            </div>
          ))}
        </div> </div> </div>);
  // ğŸ“ TAB 5: Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· - REQUIREMENTS & CONTROLS

  const renderTabRequirements = () => (
    <div className="space-y-6">
      <div>
        {renderFieldLabel('Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Linked Regulatory Obligations')}
        <div className="border-2 border-slate-200 rounded-xl overflow-hidden">
          <div className="p-4 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
            <span className="text-sm text-slate-600">
              {data?.linkedObligations?.length || 0} Ø§Ù„ØªØ²Ø§Ù… Ù…Ø±ØªØ¨Ø·
            </span>
            {!isReadOnly && (
              <button type="button" className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-bold hover:bg-amber-600">
                <Link2 className="w-4 h-4" />Ø±Ø¨Ø· Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
              </button>
            )}
          </div>
          {(data?.linkedObligations?.length || 0) === 0 ? (
            <div className="p-8 text-center">
              <Link2 className="w-12 h-12 mx-auto text-slate-300 mb-3" />
              <p className="text-slate-500">Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ø£ÙŠ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø¹Ø¯</p>
              <p className="text-xs text-slate-400 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø³Ø©</p>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
            </div>
          )}
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Linked Controls')}
        <div className="border-2 border-slate-200 rounded-xl overflow-hidden">
          <div className="p-4 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
            <span className="text-sm text-slate-600">
              {data?.linkedControls?.length || 0} Ø¶Ø§Ø¨Ø· Ù…Ø±ØªØ¨Ø·
            </span>
            {!isReadOnly && (
              <button type="button" className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-bold hover:bg-purple-600">
                <Shield className="w-4 h-4" />Ø±Ø¨Ø· Ø¶ÙˆØ§Ø¨Ø·
              </button>
            )}
          </div>
          {(data?.linkedControls?.length || 0) === 0 ? (
            <div className="p-8 text-center">
              <Shield className="w-12 h-12 mx-auto text-slate-300 mb-3" />
              <p className="text-slate-500">Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ø£ÙŠ Ø¶ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯</p>
            </div>
          ) : null}
        </div> </div>
      <div>
        {renderFieldLabel('Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'Required Evidence Types')}
        <div className="flex flex-wrap gap-2">
          {EVIDENCE_TYPES.map(type => {
            const isSelected = data?.requiredEvidenceTypes?.includes(type.code);
            const Icon = type.icon;
            return (
              <button
                key={type.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => {
                  const current = data?.requiredEvidenceTypes || [];
                  handleFieldChange('requiredEvidenceTypes',
                    isSelected ? current.filter(c => c !== type.code) : [...current, type.code]
                  );
                }}
                className={`px-4 py-2 rounded-xl border-2 transition-all flex items-center gap-2 ${isSelected ? 'bg-amber-50 border-amber-400 text-amber-700' : 'bg-white border-slate-200 hover:border-slate-300'
                  }`}>
                <Icon className="w-4 h-4" />
                <span className={`text-sm font-bold ${isSelected ? '' : 'text-slate-600'}`}>{type.nameAr}</span>
              </button>);
          })}
        </div> </div>
      <div>
        {renderFieldLabel('Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„', 'Acceptance Criteria')}
        <textarea
          value={data?.acceptanceCriteria || ''}
          onChange={(e) => handleFieldChange('acceptanceCriteria', e.target.value)}
          disabled={isReadOnly}
          rows={3}
          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-amber-500 resize-none"
          placeholder="Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ ØªØ­Ù‚ÙŠÙ‚Ù‡Ø§ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„..."
        />
      </div> </div>);
  // ğŸ“ TAB 6: Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ø¯ÙˆØ±ÙŠØ© - SCHEDULING & LIFECYCLE

  const renderTabSchedule = () => (
    <div className="space-y-6">
      <div className="grid grid-cols-3 gap-6">
        <div>
          {renderFieldLabel('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†', 'Effective Date', true)}
          <input
            type="date"
            value={data?.effectiveDate || ''}
            onChange={(e) => handleFieldChange('effectiveDate', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500"
          />
        </div>
        <div>
          {renderFieldLabel('Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©', 'Next Review Date')}
          <input
            type="date"
            value={data?.nextReviewDate || ''}
            onChange={(e) => handleFieldChange('nextReviewDate', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500"
          />
        </div>
        <div>
          {renderFieldLabel('ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©', 'Sunset Date', false, 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ')}
          <input
            type="date"
            value={data?.sunsetDate || ''}
            onChange={(e) => handleFieldChange('sunsetDate', e.target.value)}
            disabled={isReadOnly}
            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500"
          />
        </div> </div>
      <div>
        {renderFieldLabel('Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Review Frequency', true)}
        <div className="grid grid-cols-7 gap-2">
          {REVIEW_FREQUENCIES.map(freq => {
            const isSelected = data?.reviewFrequency === freq.code;
            return (
              <button
                key={freq.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => handleFieldChange('reviewFrequency', freq.code)}
                className={`p-3 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-indigo-50 border-indigo-400 shadow-md' : 'bg-white border-slate-200 hover:border-slate-300'
                  }`}>
                <span className="text-xl block mb-1">{freq.icon}</span>
                <div className={`text-xs font-bold ${isSelected ? 'text-indigo-700' : 'text-slate-700'}`}>{freq.nameAr}</div>
                {freq.days && <div className="text-xs text-slate-400 mt-1">{freq.days}d</div>}
              </button>);
          })}
        </div> </div>
      <div>
        {renderFieldLabel('Ù…Ø­ÙØ²Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©', 'Review Triggers')}
        <div className="flex flex-wrap gap-2">
          {REVIEW_TRIGGERS.map(trigger => {
            const isSelected = data?.reviewTriggers?.includes(trigger.code);
            return (
              <button
                key={trigger.code}
                type="button"
                disabled={isReadOnly}
                onClick={() => {
                  const current = data?.reviewTriggers || [];
                  handleFieldChange('reviewTriggers',
                    isSelected ? current.filter(c => c !== trigger.code) : [...current, trigger.code]
                  );
                }}
                className={`px-4 py-2 rounded-xl border-2 transition-all flex items-center gap-2 ${isSelected ? 'bg-indigo-50 border-indigo-400 text-indigo-700' : 'bg-white border-slate-200 hover:border-slate-300'
                  }`}>
                <span>{trigger.icon}</span>
                <span className={`text-sm font-bold ${isSelected ? '' : 'text-slate-600'}`}>{trigger.nameAr}</span>
              </button>);
          })}
        </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'Automatic Reminders', false, 'Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')}
        <div className="flex flex-wrap gap-2">
          {[90, 60, 30, 14, 7, 3, 1].map(days => {
            const isSelected = data?.reminderDays?.includes(days);
            return (
              <button
                key={days}
                type="button"
                disabled={isReadOnly}
                onClick={() => {
                  const current = data?.reminderDays || [];
                  handleFieldChange('reminderDays',
                    isSelected ? current.filter(d => d !== days) : [...current, days].sort((a, b) => b - a)
                  );
                }}
                className={`px-4 py-2 rounded-xl border-2 transition-all ${isSelected ? 'bg-indigo-100 border-indigo-400 text-indigo-700 font-bold' : 'bg-white border-slate-200 text-slate-600'
                  }`}>
                {days} ÙŠÙˆÙ…
              </button>);
          })}
        </div> </div>
      <div className="p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border-2 border-indigo-200">
        <h4 className="font-bold text-indigo-800 mb-4">Ù…Ø±Ø§Ø­Ù„ Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø©</h4>
        <div className="flex items-center justify-between">
          {LIFECYCLE_STATES.slice(0, 6).map((state, idx) => (
            <div key={state.code} className="flex items-center">
              <div className={`w-10 h-10 rounded-full flex items-center justify-center text-lg ${data?.status === state.code
                ? `bg-${state.color}-500 text-white`
                : 'bg-slate-200 text-slate-500'
                }`}>
                {state.icon}
              </div>
              {idx < 5 && <div className="w-8 h-0.5 bg-slate-200"></div>}
            </div>
          ))}
        </div>
        <div className="flex items-center justify-between mt-2">
          {LIFECYCLE_STATES.slice(0, 6).map(state => (
            <span key={state.code} className="text-xs text-slate-600">{state.nameAr}</span>
          ))}
        </div> </div> </div>);
  // ğŸ“ TAB 7: Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ - ATTESTATION & TRAINING

  const renderTabAttestation = () => (
    <div className="space-y-6">
      <div>
        {renderFieldLabel('Ù‡Ù„ ØªØªØ·Ù„Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¥Ù‚Ø±Ø§Ø±Ø§Ù‹ØŸ', 'Requires Attestation')}
        <div className="grid grid-cols-2 gap-4">
          <button
            type="button"
            disabled={isReadOnly}
            onClick={() => handleFieldChange('requiresAttestation', true)}
            className={`p-5 rounded-xl border-2 text-center transition-all ${data?.requiresAttestation === true ? 'bg-emerald-50 border-emerald-400 shadow-md' : 'bg-white border-slate-200'
              }`}>
            <CheckCircle2 className={`w-10 h-10 mx-auto mb-2 ${data?.requiresAttestation === true ? 'text-emerald-600' : 'text-slate-400'}`} />
            <span className={`font-bold ${data?.requiresAttestation === true ? 'text-emerald-700' : 'text-slate-600'}`}>Ù†Ø¹Ù…ØŒ ÙŠØªØ·Ù„Ø¨ Ø¥Ù‚Ø±Ø§Ø±</span>
            <p className="text-xs text-slate-500 mt-1">ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø¨Ù‚Ø±Ø§Ø¡Ø© ÙˆÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ø³Ø©</p>
          </button>
          <button
            type="button"
            disabled={isReadOnly}
            onClick={() => handleFieldChange('requiresAttestation', false)}
            className={`p-5 rounded-xl border-2 text-center transition-all ${data?.requiresAttestation === false ? 'bg-slate-100 border-slate-400 shadow-md' : 'bg-white border-slate-200'
              }`}>
            <XCircle className={`w-10 h-10 mx-auto mb-2 ${data?.requiresAttestation === false ? 'text-slate-600' : 'text-slate-400'}`} />
            <span className={`font-bold ${data?.requiresAttestation === false ? 'text-slate-700' : 'text-slate-600'}`}>Ù„Ø§ØŒ Ù„Ù„Ù…Ø¹Ø±ÙØ© ÙÙ‚Ø·</span>
            <p className="text-xs text-slate-500 mt-1">Ø³ÙŠØ§Ø³Ø© Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ù‚Ø±Ø§Ø± Ø±Ø³Ù…ÙŠ</p>
          </button> </div> </div>
      {data?.requiresAttestation && (
        <>
          <div>
            {renderFieldLabel('Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±', 'Attestation Type')}
            <div className="grid grid-cols-5 gap-3">
              {ATTESTATION_TYPES.map(type => {
                const isSelected = data?.attestationType === type.code;
                const Icon = type.icon;
                return (
                  <button
                    key={type.code}
                    type="button"
                    disabled={isReadOnly}
                    onClick={() => handleFieldChange('attestationType', type.code)}
                    className={`p-4 rounded-xl border-2 transition-all ${isSelected ? 'bg-rose-50 border-rose-400 shadow-md' : 'bg-white border-slate-200 hover:border-slate-300'
                      }`}>
                    <Icon className={`w-6 h-6 mx-auto mb-2 ${isSelected ? 'text-rose-600' : 'text-slate-400'}`} />
                    <span className={`text-xs font-bold block ${isSelected ? 'text-rose-700' : 'text-slate-600'}`}>{type.nameAr}</span>
                  </button>);
              })}
            </div> </div>
          <div>
            {renderFieldLabel('Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©', 'Target Audience')}
            <div className="flex flex-wrap gap-2">
              {[
                { code: 'AllEmployees', nameAr: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†' },
                { code: 'NewJoiners', nameAr: 'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯' },
                { code: 'Managers', nameAr: 'Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡' },
                { code: 'ITStaff', nameAr: 'Ù…ÙˆØ¸ÙÙŠ ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
                { code: 'FinanceStaff', nameAr: 'Ù…ÙˆØ¸ÙÙŠ Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
                { code: 'Contractors', nameAr: 'Ø§Ù„Ù…ØªØ¹Ø§Ù‚Ø¯ÙŠÙ†' },
                { code: 'ThirdParty', nameAr: 'Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©' },
              ].map(aud => {
                const isSelected = data?.targetAudience?.includes(aud.code);
                return (
                  <button
                    key={aud.code}
                    type="button"
                    disabled={isReadOnly}
                    onClick={() => {
                      const current = data?.targetAudience || [];
                      handleFieldChange('targetAudience',
                        isSelected ? current.filter(c => c !== aud.code) : [...current, aud.code]
                      );
                    }}
                    className={`px-4 py-2 rounded-xl border-2 transition-all ${isSelected ? 'bg-rose-50 border-rose-400 text-rose-700 font-bold' : 'bg-white border-slate-200 text-slate-600'
                      }`}>
                    {aud.nameAr}
                  </button>);
              })}
            </div> </div>
          <div className="grid grid-cols-2 gap-6">
            <div>
              {renderFieldLabel('Ù…Ù‡Ù„Ø© Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±', 'Attestation Deadline (Days)')}
              <input
                type="number"
                value={data?.attestationDeadlineDays || 14}
                onChange={(e) => handleFieldChange('attestationDeadlineDays', parseInt(e.target.value))}
                disabled={isReadOnly}
                min={1}
                max={90}
                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-rose-500"
              />
            </div>
            <div>
              {renderFieldLabel('Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ø§Ø®ØªØ¨Ø§Ø±ØŸ', 'Requires Quiz')}
              <div className="flex gap-4">
                <button
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('requiresQuiz', true)}
                  className={`flex-1 p-3 rounded-xl border-2 text-center ${data?.requiresQuiz === true ? 'bg-rose-50 border-rose-400 text-rose-700 font-bold' : 'bg-white border-slate-200'
                    }`}>Ù†Ø¹Ù…</button>
                <button
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('requiresQuiz', false)}
                  className={`flex-1 p-3 rounded-xl border-2 text-center ${data?.requiresQuiz === false ? 'bg-slate-100 border-slate-400 text-slate-700 font-bold' : 'bg-white border-slate-200'
                    }`}>Ù„Ø§</button>
              </div> </div> </div>
          <div>
            {renderFieldLabel('Ù†Øµ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±', 'Attestation Statement')}
            <textarea
              value={data?.attestationText || 'Ø£Ù‚Ø± Ø¨Ø£Ù†Ù†ÙŠ Ù‚Ø¯ Ù‚Ø±Ø£Øª ÙˆÙÙ‡Ù…Øª Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø©ØŒ ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù‡Ø§ ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ ÙÙŠ Ø¹Ù…Ù„ÙŠ.'}
              onChange={(e) => handleFieldChange('attestationText', e.target.value)}
              disabled={isReadOnly}
              rows={3}
              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-rose-500 resize-none"
            />
          </div>
        </>
      )}
    </div>);
  // ğŸ“ TAB 8: Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª - EXCEPTIONS & WAIVERS

  const renderTabExceptions = () => (
    <div className="space-y-6">
      <div>
        {renderFieldLabel('Ù‡Ù„ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§ØªØŸ', 'Allow Exceptions')}
        <div className="grid grid-cols-3 gap-4">
          <button
            type="button"
            disabled={isReadOnly}
            onClick={() => handleFieldChange('allowExceptions', 'Yes')}
            className={`p-5 rounded-xl border-2 text-center transition-all ${data?.allowExceptions === 'Yes' ? 'bg-emerald-50 border-emerald-400 shadow-md' : 'bg-white border-slate-200'
              }`}>
            <CheckCircle2 className={`w-8 h-8 mx-auto mb-2 ${data?.allowExceptions === 'Yes' ? 'text-emerald-600' : 'text-slate-400'}`} />
            <span className={`font-bold ${data?.allowExceptions === 'Yes' ? 'text-emerald-700' : 'text-slate-600'}`}>Ù†Ø¹Ù…</span>
            <p className="text-xs text-slate-500 mt-1">ÙŠÙ…ÙƒÙ† Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª</p>
          </button>
          <button
            type="button"
            disabled={isReadOnly}
            onClick={() => handleFieldChange('allowExceptions', 'Limited')}
            className={`p-5 rounded-xl border-2 text-center transition-all ${data?.allowExceptions === 'Limited' ? 'bg-amber-50 border-amber-400 shadow-md' : 'bg-white border-slate-200'
              }`}>
            <AlertTriangle className={`w-8 h-8 mx-auto mb-2 ${data?.allowExceptions === 'Limited' ? 'text-amber-600' : 'text-slate-400'}`} />
            <span className={`font-bold ${data?.allowExceptions === 'Limited' ? 'text-amber-700' : 'text-slate-600'}`}>Ù…Ø­Ø¯ÙˆØ¯</span>
            <p className="text-xs text-slate-500 mt-1">Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ù…Ù‚ÙŠØ¯Ø©</p>
          </button>
          <button
            type="button"
            disabled={isReadOnly}
            onClick={() => handleFieldChange('allowExceptions', 'No')}
            className={`p-5 rounded-xl border-2 text-center transition-all ${data?.allowExceptions === 'No' ? 'bg-red-50 border-red-400 shadow-md' : 'bg-white border-slate-200'
              }`}>
            <XCircle className={`w-8 h-8 mx-auto mb-2 ${data?.allowExceptions === 'No' ? 'text-red-600' : 'text-slate-400'}`} />
            <span className={`font-bold ${data?.allowExceptions === 'No' ? 'text-red-700' : 'text-slate-600'}`}>Ù„Ø§</span>
            <p className="text-xs text-slate-500 mt-1">Ø³ÙŠØ§Ø³Ø© ØµØ§Ø±Ù…Ø©</p>
          </button> </div> </div>
      {data?.allowExceptions !== 'No' && (
        <>
          <div>
            {renderFieldLabel('Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'Required Approval Level')}
            <div className="grid grid-cols-5 gap-3">
              {EXCEPTION_APPROVAL_LEVELS.map(level => {
                const isSelected = data?.exceptionApprovalLevel === level.code;
                return (
                  <button
                    key={level.code}
                    type="button"
                    disabled={isReadOnly}
                    onClick={() => handleFieldChange('exceptionApprovalLevel', level.code)}
                    className={`p-4 rounded-xl border-2 text-center transition-all ${isSelected ? 'bg-orange-50 border-orange-400 shadow-md' : 'bg-white border-slate-200 hover:border-slate-300'
                      }`}>
                    <div className={`text-xl font-black mb-1 ${isSelected ? 'text-orange-600' : 'text-slate-400'}`}>L{level.level}</div>
                    <div className={`text-xs font-bold ${isSelected ? 'text-orange-700' : 'text-slate-600'}`}>{level.nameAr}</div>
                    {level.maxDays && <div className="text-xs text-slate-400 mt-1">â‰¤{level.maxDays}d</div>}
                  </button>);
              })}
            </div> </div>
          <div className="grid grid-cols-2 gap-6">
            <div>
              {renderFieldLabel('Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡', 'Maximum Exception Duration (Days)')}
              <input
                type="number"
                value={data?.maxExceptionDays || 90}
                onChange={(e) => handleFieldChange('maxExceptionDays', parseInt(e.target.value))}
                disabled={isReadOnly}
                min={1}
                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-orange-500"
              />
            </div>
            <div>
              {renderFieldLabel('Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ø¶ÙˆØ§Ø¨Ø· ØªØ¹ÙˆÙŠØ¶ÙŠØ©ØŸ', 'Requires Compensating Controls')}
              <div className="flex gap-4">
                <button
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('requiresCompensatingControls', true)}
                  className={`flex-1 p-3 rounded-xl border-2 text-center ${data?.requiresCompensatingControls === true ? 'bg-orange-50 border-orange-400 text-orange-700 font-bold' : 'bg-white border-slate-200'
                    }`}>Ù†Ø¹Ù…</button>
                <button
                  type="button"
                  disabled={isReadOnly}
                  onClick={() => handleFieldChange('requiresCompensatingControls', false)}
                  className={`flex-1 p-3 rounded-xl border-2 text-center ${data?.requiresCompensatingControls === false ? 'bg-slate-100 border-slate-400 text-slate-700 font-bold' : 'bg-white border-slate-200'
                    }`}>Ù„Ø§</button>
              </div> </div> </div>
          <div>
            {renderFieldLabel('Ù…Ø¹Ø§ÙŠÙŠØ± Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Risk Acceptance Criteria')}
            <textarea
              value={data?.riskAcceptanceCriteria || ''}
              onChange={(e) => handleFieldChange('riskAcceptanceCriteria', e.target.value)}
              disabled={isReadOnly}
              rows={3}
              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-orange-500 resize-none"
              placeholder="Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ ØªÙˆØ§ÙØ±Ù‡Ø§ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡..."
            />
          </div>
        </>
      )}
    </div>);
  // ğŸ“ TAB 9: Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª - LINKAGES & RELATIONS

  const renderTabLinkages = () => (
    <div className="space-y-6">
      <div className="grid grid-cols-4 gap-4">
        {[
          { label: 'Ø³ÙŠØ§Ø³Ø§Øª Ù…Ø±ØªØ¨Ø·Ø©', count: data?.relatedPolicies?.length || 0, icon: FileText, color: 'emerald' },
          { label: 'Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', count: data?.linkedObligations?.length || 0, icon: Scale, color: 'blue' },
          { label: 'Ø¶ÙˆØ§Ø¨Ø·', count: data?.linkedControls?.length || 0, icon: Shield, color: 'purple' },
          { label: 'Ù…Ø®Ø§Ø·Ø±', count: data?.linkedRisks?.length || 0, icon: AlertTriangle, color: 'red' },
        ].map((item, idx) => {
          const Icon = item.icon;
          return (
            <div key={idx} className={`p-4 rounded-xl border-2 ${getColorClasses(item.color, false)}`}>
              <div className="flex items-center justify-between mb-2">
                <Icon className={`w-6 h-6 text-${item.color}-500`} />
                <span className={`text-2xl font-black text-${item.color}-600`}>{item.count}</span>
              </div>
              <p className="text-sm text-slate-600">{item.label}</p>
            </div>);
        })}
      </div>

      <div>
        {renderFieldLabel('Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Related Policies & Standards')}
        <div className="border-2 border-slate-200 rounded-xl overflow-hidden">
          <div className="p-4 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
            <span className="text-sm text-slate-600">{data?.relatedPolicies?.length || 0} ÙˆØ«ÙŠÙ‚Ø© Ù…Ø±ØªØ¨Ø·Ø©</span>
            {!isReadOnly && (
              <button type="button" className="flex items-center gap-2 px-4 py-2 bg-teal-500 text-white rounded-lg text-sm font-bold hover:bg-teal-600">
                <Link className="w-4 h-4" />Ø±Ø¨Ø· ÙˆØ«Ø§Ø¦Ù‚
              </button>
            )}
          </div>
          <div className="p-8 text-center">
            <Network className="w-12 h-12 mx-auto text-slate-300 mb-3" />
            <p className="text-slate-500">ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø°Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø³Ø©</p>
          </div> </div> </div>
      <div>
        {renderFieldLabel('Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Linked Risks')}
        <div className="border-2 border-slate-200 rounded-xl overflow-hidden">
          <div className="p-4 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
            <span className="text-sm text-slate-600">{data?.linkedRisks?.length || 0} Ø®Ø·Ø± Ù…Ø±ØªØ¨Ø·</span>
            {!isReadOnly && (
              <button type="button" className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-bold hover:bg-red-600">
                <AlertTriangle className="w-4 h-4" />Ø±Ø¨Ø· Ù…Ø®Ø§Ø·Ø±
              </button>
            )}
          </div>
          <div className="p-8 text-center">
            <AlertTriangle className="w-12 h-12 mx-auto text-slate-300 mb-3" />
            <p className="text-slate-500">ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø°Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø³Ø©</p>
          </div> </div> </div>
      <div className="grid grid-cols-2 gap-6">
        <div>
          {renderFieldLabel('Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Linked Contracts')}
          <div className="p-4 border-2 border-slate-200 rounded-xl text-center">
            <Briefcase className="w-8 h-8 mx-auto text-slate-300 mb-2" />
            <p className="text-sm text-slate-500">{data?.linkedContracts?.length || 0} Ø¹Ù‚Ø¯</p>
          </div> </div>
        <div>
          {renderFieldLabel('Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', 'Linked Assets')}
          <div className="p-4 border-2 border-slate-200 rounded-xl text-center">
            <Package className="w-8 h-8 mx-auto text-slate-300 mb-2" />
            <p className="text-sm text-slate-500">{data?.linkedAssets?.length || 0} Ø£ØµÙ„</p>
          </div> </div> </div> </div>);
  // ğŸ“ TAB 10: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù†Ø´Ø± - REVIEW & PUBLISH

  const renderTabPublish = () => (
    <div className="space-y-6">
      <div className="p-6 bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 rounded-2xl border-2 border-green-200">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h3 className="font-bold text-green-800 text-xl">Ù…Ù„Ø®Øµ Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„</h3>
            <p className="text-green-600 text-sm">Completion Summary</p>
          </div>
          <div className="text-center">
            <span className="text-5xl font-black text-green-600">{progressPct}%</span>
            <p className="text-xs text-green-500">Ù…ÙƒØªÙ…Ù„</p>
          </div> </div>
        <div className="h-4 bg-green-200 rounded-full overflow-hidden mb-4">
          <div
            className={`h-full rounded-full transition-all ${progressPct >= 80 ? 'bg-green-500' : progressPct >= 50 ? 'bg-amber-500' : 'bg-red-500'}`}
            style={{ width: `${progressPct}%` }}
          />
        </div>
        <div className="grid grid-cols-4 gap-2">
          {completionChecks.map((check, idx) => (
            <div key={idx} className={`p-2 rounded-lg text-xs text-center transition-all ${check.check ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
              }`}>
              <span className="font-bold">{check.check ? 'âœ“' : 'âœ—'}</span> {check.label}
            </div>
          ))}
        </div> </div>
      <div>
        {renderFieldLabel('Ø§ÙƒØªÙ…Ø§Ù„ ÙƒÙ„ Ù‚Ø³Ù…', 'Section Completion')}
        <div className="grid grid-cols-5 gap-2">
          {tabs.map((tab, idx) => {
            const completion = tabCompletion[tab.id] || 0;
            const Icon = tab.icon;
            return (
              <button
                key={tab.id}
                type="button"
                onClick={() => setActiveTab(idx)}
                className={`p-3 rounded-xl border-2 transition-all ${completion === 100 ? 'bg-green-50 border-green-300' :
                  completion > 0 ? 'bg-amber-50 border-amber-300' : 'bg-slate-50 border-slate-200'
                  }`}>
                <Icon className={`w-5 h-5 mx-auto mb-1 ${completion === 100 ? 'text-green-600' : 'text-slate-400'
                  }`} />
                <p className="text-xs font-bold text-slate-700">{tab.labelAr}</p>
                <p className={`text-xs font-bold mt-1 ${completion === 100 ? 'text-green-600' : completion > 0 ? 'text-amber-600' : 'text-slate-400'
                  }`}>{completion}%</p>
              </button>);
          })}
        </div> </div>
      <div className={`p-4 rounded-xl border-2 ${sodValidation.isValid ? 'bg-emerald-50 border-emerald-200' : 'bg-red-50 border-red-200'}`}>
        <div className="flex items-center gap-3">
          {sodValidation.isValid
            ? <CheckCircle2 className="w-8 h-8 text-emerald-600" />
            : <AlertTriangle className="w-8 h-8 text-red-600" />
          }
          <div>
            <span className={`font-bold text-lg ${sodValidation.isValid ? 'text-emerald-700' : 'text-red-700'}`}>
              {sodValidation.isValid ? 'âœ“ ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (SoD) Ø³Ù„ÙŠÙ…' : 'âš ï¸ Ø§Ù†ØªÙ‡Ø§Ùƒ ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª!'}
            </span>
            {!sodValidation.isValid && (
              <ul className="text-sm text-red-600 mt-1">
                {sodValidation.violations.map((v, i) => <li key={i}>â€¢ {v.msg}</li>)}
              </ul>
            )}
          </div> </div> </div>
      <div className="p-4 bg-slate-50 rounded-xl border-2 border-slate-200">
        <h4 className="font-bold text-slate-800 mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„</h4>
        <div className="flex items-center gap-3">
          <button type="button" className="flex items-center gap-2 px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300">
            <Eye className="w-4 h-4" />Ù…Ø¹Ø§ÙŠÙ†Ø©
          </button>
          <button type="button" className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">
            <Send className="w-4 h-4" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
          </button>
          <button type="button" className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg font-bold hover:bg-purple-600">
            <CheckSquare className="w-4 h-4" />Ø§Ø¹ØªÙ…Ø§Ø¯
          </button>
          <button type="button" className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg font-bold hover:bg-emerald-600">
            <Globe className="w-4 h-4" />Ù†Ø´Ø±
          </button> </div> </div> </div>);
  // ğŸ¨ MAIN RENDER

  return (
    <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
      <div className="bg-white rounded-3xl w-full max-w-6xl max-h-[95vh] flex flex-col shadow-2xl overflow-hidden">

        <div className={`text-white px-8 py-5 bg-gradient-to-l ${isEditMode ? documentTypeInfo.gradientEdit : documentTypeInfo.gradientCreate}`}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center text-3xl">
                {documentTypeInfo.icon}
              </div>
              <div>
                <h2 className="text-2xl font-black">
                  {isEditMode ? `ØªØ¹Ø¯ÙŠÙ„ ${documentTypeInfo.nameAr}` : `Ø¥Ø¶Ø§ÙØ© ${documentTypeInfo.nameArIndefinite} ${data?.type === 'Policy' ? 'Ø¬Ø¯ÙŠØ¯Ø©' : 'Ø¬Ø¯ÙŠØ¯'}`}
                </h2>
                <p className="text-white/80 text-sm">
                  {data?.code || (data?.type === 'Policy' ? 'POL' : data?.type === 'Standard' ? 'STD' : data?.type === 'Procedure' ? 'PRC' : 'DOC') + '-XXX'} | {progressPct}% Ù…ÙƒØªÙ…Ù„
                </p> </div> </div>
            <div className="flex items-center gap-3">
              <div className="text-center px-4 py-2 bg-white/10 backdrop-blur rounded-xl">
                <p className="text-white/80 text-xs">Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„</p>
                <p className="text-2xl font-black">{progressPct}%</p>
              </div>
              <button onClick={onClose} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                <X className="w-6 h-6" />
              </button> </div> </div>
          <div className="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
            <div className={`h-full rounded-full transition-all ${progressPct >= 80 ? 'bg-white' : progressPct >= 50 ? 'bg-amber-300' : 'bg-red-300'}`} style={{ width: `${progressPct}%` }} />
          </div> </div>
        <div className="flex border-b border-slate-200 px-2 bg-slate-50 overflow-x-auto">
          {tabs.map((tab, idx) => {
            const Icon = tab.icon;
            const isActive = activeTab === idx;
            const isPassed = tabCompletion[tab.id] === 100;
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(idx)}
                className={`flex items-center gap-2 px-4 py-3 font-medium border-b-2 whitespace-nowrap transition-all ${isActive
                  ? 'border-emerald-500 text-emerald-700 bg-white -mb-px rounded-t-xl shadow-sm'
                  : isPassed
                    ? 'border-transparent text-emerald-600'
                    : 'border-transparent text-slate-500 hover:text-slate-700'
                  }`}>
                <span className={`w-7 h-7 rounded-lg flex items-center justify-center text-xs font-bold ${isActive ? 'bg-emerald-500 text-white' :
                  isPassed ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-200 text-slate-500'
                  }`}>
                  {isPassed ? 'âœ“' : idx + 1}
                </span>
                {tab.labelAr}
              </button>);
          })}
        </div>

        <div className="flex-1 overflow-y-auto p-8">
          {activeTab === 0 && renderTabBasic()}
          {activeTab === 1 && renderTabRegulatory()}
          {activeTab === 2 && renderTabScope()}
          {activeTab === 3 && renderTabAccountability()}
          {activeTab === 4 && renderTabRequirements()}
          {activeTab === 5 && renderTabSchedule()}
          {activeTab === 6 && renderTabAttestation()}
          {activeTab === 7 && renderTabExceptions()}
          {activeTab === 8 && renderTabLinkages()}
          {activeTab === 9 && renderTabPublish()}
        </div>

        <div className="border-t-2 border-slate-200 px-8 py-5 bg-gradient-to-t from-slate-100 to-white">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <button
                onClick={() => activeTab > 0 && setActiveTab(activeTab - 1)}
                disabled={activeTab === 0}
                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 0 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'
                  }`}>
                <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
              </button>
              <button
                onClick={() => activeTab < tabs.length - 1 && setActiveTab(activeTab + 1)}
                disabled={activeTab === tabs.length - 1}
                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${activeTab === tabs.length - 1 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-slate-800 text-white hover:bg-slate-900'
                  }`}>
                Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
              </button>
              <span className="text-sm text-slate-500 mr-4 font-medium">{activeTab + 1} / {tabs.length}</span>
            </div>
            <div className="flex items-center gap-3">
              <button onClick={onClose} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white transition-all">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => handleSave(true)} className="flex items-center gap-2 px-6 py-3 bg-slate-700 text-white rounded-xl font-bold hover:bg-slate-800 transition-all">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©
              </button>
              <button
                onClick={() => handleSave(false)}
                disabled={progressPct < 50 || !sodValidation.isValid}
                className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold shadow-lg transition-all ${progressPct >= 50 && sodValidation.isValid
                  ? `bg-gradient-to-r ${documentTypeInfo.gradientCreate} hover:opacity-90 shadow-${documentTypeInfo.color}-500/30`
                  : 'bg-slate-300 cursor-not-allowed'
                  }`}>
                {isEditMode ? <Save className="w-5 h-5" /> : <Send className="w-5 h-5" />}
                {isEditMode ? `Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª ${documentTypeInfo.nameAr}` : `Ø¥Ù†Ø´Ø§Ø¡ ${documentTypeInfo.nameAr}`}
              </button> </div> </div> </div> </div> </div>
  );
};

// Module 4.3: Ù…ØµÙÙˆÙØ© Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±
const ObligationsMapping = () => {
  const [selectedObligation, setSelectedObligation] = useState(null);
  const [filterAuthority, setFilterAuthority] = useState('');
  const [filterCoverage, setFilterCoverage] = useState('');
  const [viewMode, setViewMode] = useState('matrix');

  const [showFormModal, setShowFormModal] = useState(false);
  const [formMode, setFormMode] = useState('create'); // 'create' | 'edit'
  const [showViewModal, setShowViewModal] = useState(false);
  const [formData, setFormData] = useState({
    id: null, obligationId: null, controlId: null, riskId: null, policyId: null, coverageLevel: 'Full',
    effectiveness: 'Effective', notes: '',
    activeGoldenTab: 0
  });

  const [showVisualMappingTool, setShowVisualMappingTool] = useState(false);
  const [showAutoSuggestModal, setShowAutoSuggestModal] = useState(false);
  const [showCoverageAnalysis, setShowCoverageAnalysis] = useState(false);
  const [showOrphanDetection, setShowOrphanDetection] = useState(false);
  const [draggedItem, setDraggedItem] = useState(null);
  const [dropTarget, setDropTarget] = useState(null);
  const [autoSuggestions, setAutoSuggestions] = useState([]);

  const orphanAnalysis = useMemo(() => {
    const orphanObligations = INITIAL_OBLIGATIONS.filter(obl => !MAPPINGS.some(m => m.obligationId === obl.id));
    const orphanControls = CONTROLS.filter(ctrl => !MAPPINGS.some(m => m.controlId === ctrl.id));
    const orphanRisks = RISKS.filter(risk => !MAPPINGS.some(m => m.riskId === risk.id));
    const orphanPolicies = POLICIES.filter(pol => !MAPPINGS.some(m => m.policyId === pol.id));
    return {
      obligations: orphanObligations, controls: orphanControls, risks: orphanRisks, policies: orphanPolicies,
      total: orphanObligations.length + orphanControls.length + orphanRisks.length + orphanPolicies.length
    };
  }, []);

  const circularDependencies = useMemo(() => {
    const deps = [];
    MAPPINGS.forEach(m1 => {
      MAPPINGS.forEach(m2 => {
        if (m1.id !== m2.id && m1.controlId === m2.controlId && m1.obligationId !== m2.obligationId && m1.riskId === m2.riskId) {
          deps.push({ type: 'control-risk-loop', items: [m1, m2], description: `Ø§Ù„Ø¶Ø§Ø¨Ø· ${m1.controlId} Ù…Ø±ØªØ¨Ø· Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ©` });
        }
      });
    });
    return deps;
  }, []);

  const generateAutoSuggestions = (obligation) => {
    if (!obligation) return [];
    const keywords = obligation.title.split(' ').filter(w => w.length > 3);
    const suggestions = [];
    CONTROLS.forEach(ctrl => {
      const matchScore = keywords.filter(kw => ctrl.name.includes(kw) || (ctrl.description && ctrl.description.includes(kw))).length;
      if (matchScore > 0) suggestions.push({ type: 'control', item: ctrl, score: matchScore, reason: `ØªØ·Ø§Ø¨Ù‚ ${matchScore} ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©` });
    });
    RISKS.forEach(risk => {
      const matchScore = keywords.filter(kw => risk.name.includes(kw) || (risk.description && risk.description.includes(kw))).length;
      if (matchScore > 0) suggestions.push({ type: 'risk', item: risk, score: matchScore, reason: `ØªØ·Ø§Ø¨Ù‚ ${matchScore} ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©` });
    });
    POLICIES.forEach(pol => {
      const matchScore = keywords.filter(kw => pol.title.includes(kw) || (pol.description && pol.description.includes(kw))).length;
      if (matchScore > 0) suggestions.push({ type: 'policy', item: pol, score: matchScore, reason: `ØªØ·Ø§Ø¨Ù‚ ${matchScore} ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©` });
    });
    return suggestions.sort((a, b) => b.score - a.score).slice(0, 10);
  };

  const coverageAnalysis = useMemo(() => {
    const byAuthority = {};
    const byFramework = {};
    const byCriticality = { High: { total: 0, covered: 0 }, Medium: { total: 0, covered: 0 }, Low: { total: 0, covered: 0 } };
    INITIAL_OBLIGATIONS.forEach(obl => {
      const auth = AUTHORITIES.find(a => a.id === obl.authorityId);
      const fw = FRAMEWORKS.find(f => f.id === obl.frameworkId);
      const hasCoverage = MAPPINGS.some(m => m.obligationId === obl.id);
      if (auth) {
        if (!byAuthority[auth.code]) byAuthority[auth.code] = { total: 0, covered: 0, name: auth.nameAr };
        byAuthority[auth.code].total++;
        if (hasCoverage) byAuthority[auth.code].covered++;
      }
      if (fw) {
        if (!byFramework[fw.code]) byFramework[fw.code] = { total: 0, covered: 0, name: fw.nameAr };
        byFramework[fw.code].total++;
        if (hasCoverage) byFramework[fw.code].covered++;
      }
      if (byCriticality[obl.criticality]) {
        byCriticality[obl.criticality].total++;
        if (hasCoverage) byCriticality[obl.criticality].covered++;
      }
    });
    return { byAuthority, byFramework, byCriticality };
  }, []);

  const handleDragStart = (e, item, type) => {
    setDraggedItem({ item, type });
    e.dataTransfer.effectAllowed = 'link';
  };
  const handleDragOver = (e, target, targetType) => {
    e.preventDefault();
    setDropTarget({ target, targetType });
  };
  const handleDrop = (e, target, targetType) => {
    e.preventDefault();
    if (draggedItem && dropTarget) {
      alert(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¨Ø· Ø¬Ø¯ÙŠØ¯: ${draggedItem.type} â†’ ${targetType}`);
    }
    setDraggedItem(null);
    setDropTarget(null);
  };

  const resetFormData = () => setFormData({
    id: null, obligationId: null, controlId: null, riskId: null, policyId: null, coverageLevel: 'Full', effectiveness: 'Effective', notes: '', activeGoldenTab: 0
  });

  // Handlers - Ù…ÙˆØ­Ø¯Ø©
  const handleAddMapping = (obl) => {
    setSelectedObligation(obl);
    setFormData({ ...formData, obligationId: obl?.id });
    setFormMode('create');
    setShowFormModal(true);
  };

  const handleEditMapping = (obl, mapping) => {
    setSelectedObligation(obl);
    setFormData({
      id: mapping?.id, obligationId: obl?.id, controlId: mapping?.controlId || null, riskId: mapping?.riskId || null,
      policyId: mapping?.policyId || null, coverageLevel: mapping?.coverageLevel || 'Full',
      notes: mapping?.notes || ''
    });
    setFormMode('edit');
    setShowFormModal(true);
  };

  const handleViewDetails = (obl) => {
    setSelectedObligation(obl);
    setShowViewModal(true);
  };

  const handleSaveForm = () => {
    if (formMode === 'create') {
      alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø§Ù„ØªØ²Ø§Ù…: ${selectedObligation?.title}`);
    } else {
      alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­`);
    }
    setShowFormModal(false);
    resetFormData();
  };

  const handleCloseForm = () => {
    setShowFormModal(false);
    resetFormData();
  };

  const handleDeleteMapping = (obl) => {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø·ØŸ')) {
      alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
    }
  };

  // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØºØ·ÙŠØ© Ù„ÙƒÙ„ Ø§Ù„ØªØ²Ø§Ù…
  const obligationsWithCoverage = useMemo(() => {
    return INITIAL_OBLIGATIONS.map(obl => {
      const mappings = MAPPINGS.filter(m => m.obligationId === obl.id);
      const controls = mappings.map(m => CONTROLS.find(c => c.id === m.controlId)).filter(Boolean);
      const risks = mappings.map(m => RISKS.find(r => r.id === m.riskId)).filter(Boolean);
      const policies = mappings.map(m => POLICIES.find(p => p.id === m.policyId)).filter(Boolean);

      const coverageStatus = mappings.length === 0 ? 'None' :
        mappings.every(m => m.coverageLevel === 'Full') ? 'Full' : 'Partial';

      return {
        ...obl,
        mappings,
        controls: [...new Set(controls)], risks: [...new Set(risks)], policies: [...new Set(policies)],
        coverageStatus,
        controlCount: controls.length, riskCount: risks.length,
      };
    });
  }, []);

  const stats = useMemo(() => {
    const total = obligationsWithCoverage.length;
    const fullCoverage = obligationsWithCoverage.filter(o => o.coverageStatus === 'Full').length;
    const partialCoverage = obligationsWithCoverage.filter(o => o.coverageStatus === 'Partial').length;
    const noCoverage = obligationsWithCoverage.filter(o => o.coverageStatus === 'None').length;
    const highPriorityGaps = obligationsWithCoverage.filter(o => o.criticality === 'High' && o.coverageStatus === 'None').length;

    return {
      total,
      fullCoverage,
      partialCoverage,
      noCoverage,
      highPriorityGaps,
      coveragePercent: Math.round((fullCoverage / total) * 100),
    };
  }, [obligationsWithCoverage]);

  const filteredObligations = useMemo(() => {
    return obligationsWithCoverage.filter(o => {
      const matchAuthority = !filterAuthority || o.authorityId === parseInt(filterAuthority);
      const matchCoverage = !filterCoverage || o.coverageStatus === filterCoverage;
      return matchAuthority && matchCoverage;
    });
  }, [obligationsWithCoverage, filterAuthority, filterCoverage]);

  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);
  const getFramework = (id) => FRAMEWORKS.find(f => f.id === id);

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Ù…ØµÙÙˆÙØ© Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h1>
          <p className="text-slate-500">Golden Thread: Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… â†’ Ø§Ù„Ø¶Ø§Ø¨Ø· â†’ Ø§Ù„Ù…Ø®Ø§Ø·Ø± â†’ Ø§Ù„Ø³ÙŠØ§Ø³Ø© - Module 4.3</p>
        </div>
        <div className="flex items-center gap-3">
          <button className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50 transition-all">
            <Download className="w-5 h-5" />
            ØªØµØ¯ÙŠØ±
          </button>
          <button onClick={() => handleAddMapping(null)} className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold hover:from-emerald-600 hover:to-teal-600 transition-all shadow-lg shadow-emerald-500/30">
            <Plus className="w-5 h-5" />
            Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø·
          </button> </div> </div>
      <div className="grid grid-cols-6 gap-4">
        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
          <p className="text-sm text-slate-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</p>
          <p className="text-3xl font-bold text-slate-900">{stats.total}</p>
        </div>
        <div className="bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl p-5 text-white">
          <p className="text-sm text-emerald-100 mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºØ·ÙŠØ©</p>
          <p className="text-3xl font-bold">{stats.coveragePercent}%</p>
        </div>
        <div className="bg-white rounded-2xl p-5 border-2 border-emerald-200">
          <div className="flex items-center gap-2 mb-1">
            <span className="w-3 h-3 rounded-full bg-emerald-500" />
            <p className="text-sm text-slate-500">ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</p>
          </div>
          <p className="text-3xl font-bold text-emerald-600">{stats.fullCoverage}</p>
        </div>
        <div className="bg-white rounded-2xl p-5 border-2 border-amber-200">
          <div className="flex items-center gap-2 mb-1">
            <span className="w-3 h-3 rounded-full bg-amber-500" />
            <p className="text-sm text-slate-500">ØªØºØ·ÙŠØ© Ø¬Ø²Ø¦ÙŠØ©</p>
          </div>
          <p className="text-3xl font-bold text-amber-600">{stats.partialCoverage}</p>
        </div>
        <div className="bg-white rounded-2xl p-5 border-2 border-red-200">
          <div className="flex items-center gap-2 mb-1">
            <span className="w-3 h-3 rounded-full bg-red-500" />
            <p className="text-sm text-slate-500">Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ©</p>
          </div>
          <p className="text-3xl font-bold text-red-600">{stats.noCoverage}</p>
        </div>
        <div className="bg-red-50 rounded-2xl p-5 border-2 border-red-200">
          <div className="flex items-center gap-2 mb-1">
            <AlertTriangle className="w-4 h-4 text-red-500" />
            <p className="text-sm text-red-600">ÙØ¬ÙˆØ§Øª Ø­Ø±Ø¬Ø©</p>
          </div>
          <p className="text-3xl font-bold text-red-600">{stats.highPriorityGaps}</p>
        </div> </div>
      <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
        <div className="flex items-center justify-between mb-3">
          <h3 className="font-bold text-slate-800">Ù…Ø¤Ø´Ø± Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3>
          <span className="text-sm text-slate-500">{stats.fullCoverage} Ù…Ù† {stats.total} Ø§Ù„ØªØ²Ø§Ù… Ù…ØºØ·Ù‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</span>
        </div>
        <div className="h-4 bg-slate-100 rounded-full overflow-hidden flex">
          <div
            className="h-full bg-emerald-500"
            style={{ width: `${(stats.fullCoverage / stats.total) * 100}%` }}
          />
          <div
            className="h-full bg-amber-500"
            style={{ width: `${(stats.partialCoverage / stats.total) * 100}%` }}
          />
          <div
            className="h-full bg-red-500"
            style={{ width: `${(stats.noCoverage / stats.total) * 100}%` }}
          />
        </div>
        <div className="flex items-center justify-center gap-6 mt-3 text-sm">
          <div className="flex items-center gap-2">
            <span className="w-3 h-3 rounded-full bg-emerald-500" />
            <span className="text-slate-600">ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="w-3 h-3 rounded-full bg-amber-500" />
            <span className="text-slate-600">ØªØºØ·ÙŠØ© Ø¬Ø²Ø¦ÙŠØ©</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="w-3 h-3 rounded-full bg-red-500" />
            <span className="text-slate-600">Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ©</span>
          </div> </div> </div>
      <div className="flex items-center gap-4">
        <select
          value={filterAuthority}
          onChange={(e) => setFilterAuthority(e.target.value)}
          className="px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 bg-white"
        >
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</option>
          {AUTHORITIES.map(a => (
            <option key={a.id} value={a.id}>{a.nameAr}</option>
          ))}
        </select>
        <select
          value={filterCoverage}
          onChange={(e) => setFilterCoverage(e.target.value)}
          className="px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 bg-white"
        >
          <option value="">Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØºØ·ÙŠØ©</option>
          <option value="Full">ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</option>
          <option value="Partial">ØªØºØ·ÙŠØ© Ø¬Ø²Ø¦ÙŠØ©</option>
          <option value="None">Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ©</option>
        </select>
        <div className="flex-1" />

        <div className="flex items-center gap-2 ml-4">
          <button onClick={() => setShowVisualMappingTool(true)} className="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl text-sm font-bold hover:from-purple-600 hover:to-indigo-600 shadow-lg shadow-purple-500/20">
            <Network className="w-4 h-4" />
            Ø£Ø¯Ø§Ø© Ø§Ù„Ø±Ø¨Ø·
          </button>
          <button onClick={() => { setAutoSuggestions(generateAutoSuggestions(selectedObligation || INITIAL_OBLIGATIONS[0])); setShowAutoSuggestModal(true); }} className="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl text-sm font-bold hover:from-cyan-600 hover:to-blue-600 shadow-lg shadow-cyan-500/20">
            <Zap className="w-4 h-4" />
            Ø§Ù‚ØªØ±Ø§Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠ
          </button>
          <button onClick={() => setShowCoverageAnalysis(true)} className="flex items-center gap-2 px-3 py-2 border-2 border-emerald-300 text-emerald-700 rounded-xl text-sm font-bold hover:bg-emerald-50">
            <PieChart className="w-4 h-4" />
            ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØºØ·ÙŠØ©
          </button>
          <button onClick={() => setShowOrphanDetection(true)} className={`flex items-center gap-2 px-3 py-2 border-2 rounded-xl text-sm font-bold ${orphanAnalysis.total > 0 ? 'border-red-300 text-red-700 hover:bg-red-50' : 'border-slate-300 text-slate-600 hover:bg-slate-50'}`}>
            <AlertCircle className="w-4 h-4" />
            ÙŠØªÙŠÙ…Ø© ({orphanAnalysis.total})
          </button> </div>
        <div className="flex items-center gap-1 bg-slate-100 rounded-xl p-1">
          <button onClick={() => setViewMode('matrix')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'matrix' ? 'bg-white shadow-sm text-emerald-700' : 'text-slate-600'}`}>
            <LayoutGrid className="w-4 h-4" />
            Ù…ØµÙÙˆÙØ©
          </button>
          <button onClick={() => setViewMode('list')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'list' ? 'bg-white shadow-sm text-emerald-700' : 'text-slate-600'}`}>
            <List className="w-4 h-4" />
            Ù‚Ø§Ø¦Ù…Ø©
          </button>
          <button onClick={() => setViewMode('tree')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'tree' ? 'bg-white shadow-sm text-purple-700' : 'text-slate-600'}`}>
            <GitBranch className="w-4 h-4" />
            Ø´Ø¬Ø±ÙŠ
          </button>
          <button onClick={() => setViewMode('graph')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'graph' ? 'bg-white shadow-sm text-blue-700' : 'text-slate-600'}`}>
            <Network className="w-4 h-4" />
            Ø´Ø¨ÙƒØ©
          </button>
          <button onClick={() => setViewMode('sankey')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'sankey' ? 'bg-white shadow-sm text-cyan-700' : 'text-slate-600'}`}>
            <Activity className="w-4 h-4" />
            Ø³Ø§Ù†ÙƒÙŠ
          </button>
          <button onClick={() => setViewMode('gaps')} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'gaps' ? 'bg-white shadow-sm text-red-600' : 'text-slate-600'}`}>
            <AlertTriangle className="w-4 h-4" />
            ÙØ¬ÙˆØ§Øª
          </button> </div> </div>
      {viewMode === 'matrix' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-slate-50 border-b-2 border-slate-200">
                  <th className="text-right px-5 py-4 font-bold text-slate-700 w-64">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">
                    <div className="flex items-center justify-center gap-2">
                      <Shield className="w-4 h-4 text-blue-600" />
                      Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·
                    </div>
                  </th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">
                    <div className="flex items-center justify-center gap-2">
                      <AlertTriangle className="w-4 h-4 text-amber-600" />
                      Ø§Ù„Ù…Ø®Ø§Ø·Ø±
                    </div>
                  </th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">
                    <div className="flex items-center justify-center gap-2">
                      <FileText className="w-4 h-4 text-purple-600" />
                      Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
                    </div>
                  </th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ØªØºØ·ÙŠØ©</th>
                  <th className="text-center px-4 py-4 font-bold text-slate-700 w-32">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr> </thead>
              <tbody>
                {filteredObligations.slice(0, 15).map((obl) => {
                  const authority = getAuthority(obl.authorityId);
                  return (
                    <tr key={obl.id} className={`border-b border-slate-100 hover:bg-slate-50 transition-colors ${obl.coverageStatus === 'None' && obl.criticality === 'High' ? 'bg-red-50/50' : ''}`}>
                      <td className="px-5 py-4">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-sm font-bold text-emerald-600">{obl.code}</span>
                        </div>
                        <p className="text-sm text-slate-700 line-clamp-2">{obl.title}</p>
                      </td>
                      <td className="px-4 py-4 text-center">
                        <span className="px-2.5 py-1 bg-slate-100 rounded-lg text-xs font-bold text-slate-600">{authority?.code}</span>
                      </td>
                      <td className="px-4 py-4 text-center">
                        <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${obl.criticality === 'High' ? 'bg-red-100 text-red-700' : obl.criticality === 'Medium' ? 'bg-amber-100 text-amber-700' : 'bg-green-100 text-green-700'}`}>
                          {obl.criticality === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : obl.criticality === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}
                        </span> </td>
                      <td className="px-4 py-4 text-center">
                        {obl.controlCount > 0 ? (
                          <span className="w-8 h-8 bg-blue-100 text-blue-700 rounded-lg flex items-center justify-center font-bold mx-auto">{obl.controlCount}</span>
                        ) : <span className="text-red-500 text-xl">â€”</span>}
                      </td>
                      <td className="px-4 py-4 text-center">
                        {obl.riskCount > 0 ? (
                          <span className="w-8 h-8 bg-amber-100 text-amber-700 rounded-lg flex items-center justify-center font-bold mx-auto">{obl.riskCount}</span>
                        ) : <span className="text-slate-400 text-xl">â€”</span>}
                      </td>
                      <td className="px-4 py-4 text-center">
                        {obl.policies?.length > 0 ? (
                          <span className="w-8 h-8 bg-purple-100 text-purple-700 rounded-lg flex items-center justify-center font-bold mx-auto">{obl.policies.length}</span>
                        ) : <span className="text-slate-400 text-xl">â€”</span>}
                      </td>
                      <td className="px-4 py-4 text-center">
                        <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${obl.coverageStatus === 'Full' ? 'bg-emerald-100 text-emerald-700' : obl.coverageStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'}`}>
                          {obl.coverageStatus === 'Full' ? 'âœ“ ÙƒØ§Ù…Ù„Ø©' : obl.coverageStatus === 'Partial' ? 'â— Ø¬Ø²Ø¦ÙŠØ©' : 'âœ— ÙØ¬ÙˆØ©'}
                        </span> </td>
                      <td className="px-4 py-4 text-center">
                        <div className="flex items-center justify-center gap-1">
                          <button onClick={() => handleViewDetails(obl)} className="p-2 hover:bg-blue-50 rounded-lg" title="Ø¹Ø±Ø¶"><Eye className="w-4 h-4 text-blue-500" /></button>
                          <button onClick={() => handleAddMapping(obl)} className="p-2 hover:bg-emerald-50 rounded-lg" title="Ø¥Ø¶Ø§ÙØ©"><Plus className="w-4 h-4 text-emerald-500" /></button>
                          <button onClick={() => handleEditMapping(obl, obl.mappings?.[0])} className="p-2 hover:bg-amber-50 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„"><Edit className="w-4 h-4 text-amber-500" /></button>
                          <button onClick={() => handleDeleteMapping(obl)} className="p-2 hover:bg-red-50 rounded-lg" title="Ø­Ø°Ù"><Trash2 className="w-4 h-4 text-red-500" /></button>
                        </div> </td> </tr>);
                })}
              </tbody> </table> </div> </div>
      )}

      {viewMode === 'list' && (
        <div className="space-y-3">
          {filteredObligations.map((obl) => {
            const authority = getAuthority(obl.authorityId);
            return (
              <div key={obl.id} className={`bg-white rounded-xl border-2 p-4 hover:shadow-lg transition-all cursor-pointer ${obl.coverageStatus === 'None' ? 'border-red-200 bg-red-50/30' : obl.coverageStatus === 'Partial' ? 'border-amber-200' : 'border-slate-200'}`}
                onClick={() => handleViewDetails(obl)}>
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <span className="font-mono text-sm font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">{obl.code}</span>
                      <span className="px-2 py-1 bg-slate-100 rounded text-xs font-bold text-slate-600">{authority?.code}</span>
                      <span className={`px-2 py-1 rounded text-xs font-bold ${obl.criticality === 'High' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>
                        {obl.criticality === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}
                      </span> </div>
                    <h3 className="font-bold text-slate-800 mb-1">{obl.title}</h3>
                    <p className="text-sm text-slate-500 line-clamp-2">{obl.statement}</p>
                  </div>
                  <div className="flex items-center gap-4 mr-4">
                    <div className="text-center">
                      <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mb-1">
                        <span className="font-bold text-blue-600">{obl.controlCount}</span>
                      </div>
                      <span className="text-xs text-slate-500">Ø¶ÙˆØ§Ø¨Ø·</span>
                    </div>
                    <div className="text-center">
                      <div className="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mb-1">
                        <span className="font-bold text-amber-600">{obl.riskCount}</span>
                      </div>
                      <span className="text-xs text-slate-500">Ù…Ø®Ø§Ø·Ø±</span>
                    </div>
                    <span className={`px-4 py-2 rounded-xl text-sm font-bold ${obl.coverageStatus === 'Full' ? 'bg-emerald-100 text-emerald-700' : obl.coverageStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'}`}>
                      {obl.coverageStatus === 'Full' ? 'âœ“ ÙƒØ§Ù…Ù„Ø©' : obl.coverageStatus === 'Partial' ? 'â— Ø¬Ø²Ø¦ÙŠØ©' : 'âœ— ÙØ¬ÙˆØ©'}
                    </span> </div> </div>
                <div className="flex items-center gap-2 mt-3 pt-3 border-t border-slate-100">
                  <button onClick={(e) => { e.stopPropagation(); handleAddMapping(obl); }} className="flex items-center gap-1 px-3 py-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg text-sm font-medium">
                    <Plus className="w-4 h-4" /> Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø·
                  </button>
                  <button onClick={(e) => { e.stopPropagation(); handleEditMapping(obl, obl.mappings?.[0]); }} className="flex items-center gap-1 px-3 py-1.5 text-blue-600 hover:bg-blue-50 rounded-lg text-sm font-medium">
                    <Edit className="w-4 h-4" /> ØªØ¹Ø¯ÙŠÙ„
                  </button>
                  <button onClick={(e) => { e.stopPropagation(); handleDeleteMapping(obl); }} className="flex items-center gap-1 px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium">
                    <Trash2 className="w-4 h-4" /> Ø­Ø°Ù
                  </button> </div> </div>);
          })}
        </div>
      )}

      {viewMode === 'gaps' && (
        <div className="space-y-4">
          <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-4">
            <div className="flex items-center gap-3 mb-3">
              <AlertTriangle className="w-6 h-6 text-red-600" />
              <h3 className="font-bold text-red-800">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ© ({obligationsWithCoverage.filter(o => o.coverageStatus === 'None').length})</h3>
            </div>
            <p className="text-sm text-red-700">Ù‡Ø°Ù‡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø±Ø¨Ø· Ø¨Ø¶ÙˆØ§Ø¨Ø· ÙˆÙ…Ø®Ø§Ø·Ø± ÙˆØ³ÙŠØ§Ø³Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„.</p>
          </div>

          {obligationsWithCoverage.filter(o => o.coverageStatus === 'None').map((obl) => {
            const authority = getAuthority(obl.authorityId);
            return (
              <div key={obl.id} className="bg-white rounded-xl border-2 border-red-300 p-5 hover:shadow-lg transition-all">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <span className="font-mono text-sm font-bold text-red-600 bg-red-100 px-2 py-1 rounded">{obl.code}</span>
                      <span className="px-2 py-1 bg-slate-100 rounded text-xs font-bold">{authority?.code}</span>
                      {obl.criticality === 'High' && (
                        <span className="px-2 py-1 bg-red-500 text-white rounded text-xs font-bold flex items-center gap-1">
                          <AlertTriangle className="w-3 h-3" /> Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©
                        </span>
                      )}
                    </div>
                    <h3 className="font-bold text-slate-800 mb-2">{obl.title}</h3>
                    <p className="text-sm text-slate-600">{obl.statement}</p>
                  </div>
                  <button onClick={() => handleAddMapping(obl)} className="flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold hover:from-emerald-600 hover:to-teal-600 shadow-lg mr-4">
                    <Plus className="w-5 h-5" />
                    Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙØ¬ÙˆØ©
                  </button> </div> </div>);
          })}

          {obligationsWithCoverage.filter(o => o.coverageStatus === 'None').length === 0 && (
            <div className="bg-emerald-50 border-2 border-emerald-200 rounded-2xl p-8 text-center">
              <CheckCircle2 className="w-16 h-16 text-emerald-500 mx-auto mb-4" />
              <h3 className="text-xl font-bold text-emerald-800 mb-2">Ù…Ù…ØªØ§Ø²! Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ§Øª</h3>
              <p className="text-emerald-700">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù„Ø¯ÙŠÙ‡Ø§ ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ø£Ùˆ Ø¬Ø²Ø¦ÙŠØ©.</p>
            </div>
          )}
        </div>
      )}

      {viewMode === 'tree' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
              <GitBranch className="w-5 h-5 text-purple-600" />
              Ø¹Ø±Ø¶ Ø´Ø¬Ø±ÙŠ - Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ Ù„Ù„Ø±Ø¨Ø·
            </h3>
          </div>
          <div className="space-y-4">
            {AUTHORITIES.slice(0, 4).map(auth => {
              const authObligations = filteredObligations.filter(o => o.authorityId === auth.id);
              if (authObligations.length === 0) return null;
              return (
                <div key={auth.id} className="border-2 border-slate-200 rounded-xl overflow-hidden">
                  <div className="bg-gradient-to-r from-slate-100 to-slate-50 px-4 py-3 flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                      <Building2 className="w-5 h-5 text-purple-600" />
                    </div>
                    <div className="flex-1">
                      <h4 className="font-bold text-slate-800">{auth.nameAr}</h4>
                      <p className="text-xs text-slate-500">{auth.code} â€¢ {authObligations.length} Ø§Ù„ØªØ²Ø§Ù…</p>
                    </div>
                    <ChevronDown className="w-5 h-5 text-slate-400" />
                  </div>
                  <div className="p-4 space-y-3">
                    {authObligations.slice(0, 5).map(obl => (
                      <div key={obl.id} className="mr-6 border-r-2 border-purple-200 pr-4">
                        <div className="flex items-start gap-3">
                          <div className="w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center flex-shrink-0">
                            <FileText className="w-4 h-4 text-emerald-600" />
                          </div>
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <span className="font-mono text-sm font-bold text-emerald-600">{obl.code}</span>
                              <span className={`px-2 py-0.5 rounded text-xs font-bold ${obl.coverageStatus === 'Full' ? 'bg-emerald-100 text-emerald-700' : obl.coverageStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'}`}>
                                {obl.coverageStatus === 'Full' ? 'Ù…ØºØ·Ù‰' : obl.coverageStatus === 'Partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ÙØ¬ÙˆØ©'}
                              </span> </div>
                            <p className="text-sm text-slate-700 mb-2">{obl.title}</p>
                            {obl.controls && obl.controls.length > 0 && (
                              <div className="mr-4 border-r-2 border-blue-200 pr-3 mt-2 space-y-1">
                                {obl.controls.slice(0, 2).map(ctrl => (
                                  <div key={ctrl.id} className="flex items-center gap-2 py-1">
                                    <Shield className="w-4 h-4 text-blue-500" />
                                    <span className="text-sm text-slate-600">{ctrl.name}</span>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div> </div> </div>
                    ))}
                  </div> </div>);
            })}
          </div> </div>
      )}

      {viewMode === 'graph' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <div className="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4 text-white">
            <div className="flex items-center gap-3">
              <Network className="w-6 h-6" />
              <div>
                <h3 className="font-bold">Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ© - Network View</h3>
                <p className="text-blue-200 text-sm">ØªØµÙˆØ± Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±</p>
              </div> </div> </div>
          <div className="p-8 min-h-[500px] bg-gradient-to-br from-slate-50 to-blue-50 relative flex items-center justify-center">
            <div className="relative w-full h-full max-w-4xl flex items-center justify-center">
              <div className="w-32 h-32 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 shadow-xl flex items-center justify-center text-white absolute">
                <div className="text-center">
                  <FileText className="w-8 h-8 mx-auto mb-1" />
                  <span className="text-sm font-bold">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</span>
                  <span className="block text-xs opacity-80">{stats.total}</span>
                </div> </div>
              <div className="w-24 h-24 rounded-full bg-gradient-to-br from-blue-400 to-indigo-500 shadow-lg flex items-center justify-center text-white absolute top-20 right-40">
                <div className="text-center">
                  <Shield className="w-6 h-6 mx-auto mb-1" />
                  <span className="text-xs font-bold">Ø¶ÙˆØ§Ø¨Ø·</span>
                  <span className="block text-xs opacity-80">{CONTROLS.length}</span>
                </div> </div>
              <div className="w-24 h-24 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 shadow-lg flex items-center justify-center text-white absolute top-20 left-40">
                <div className="text-center">
                  <AlertTriangle className="w-6 h-6 mx-auto mb-1" />
                  <span className="text-xs font-bold">Ù…Ø®Ø§Ø·Ø±</span>
                  <span className="block text-xs opacity-80">{RISKS.length}</span>
                </div> </div>
              <div className="w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-violet-500 shadow-lg flex items-center justify-center text-white absolute bottom-20 left-60">
                <div className="text-center">
                  <BookOpen className="w-6 h-6 mx-auto mb-1" />
                  <span className="text-xs font-bold">Ø³ÙŠØ§Ø³Ø§Øª</span>
                  <span className="block text-xs opacity-80">{POLICIES.length}</span>
                </div> </div> </div> </div> </div>
      )}

      {viewMode === 'sankey' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <div className="bg-gradient-to-r from-cyan-600 to-teal-600 px-6 py-4 text-white">
            <div className="flex items-center gap-3">
              <Activity className="w-6 h-6" />
              <div>
                <h3 className="font-bold">Ù…Ø®Ø·Ø· Ø³Ø§Ù†ÙƒÙŠ - Sankey Diagram</h3>
                <p className="text-cyan-200 text-sm">ØªØ¯ÙÙ‚ Ø§Ù„Ø±Ø¨Ø· Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</p>
              </div> </div> </div>
          <div className="p-8 min-h-[400px]">
            <div className="flex items-stretch gap-2 h-80">
              <div className="flex-1 flex flex-col justify-center gap-2">
                <h4 className="text-center font-bold text-slate-600 mb-2 text-sm">Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h4>
                {AUTHORITIES.slice(0, 4).map(auth => {
                  const count = INITIAL_OBLIGATIONS.filter(o => o.authorityId === auth.id).length;
                  const height = Math.max(40, stats.total > 0 ? (count / stats.total) * 200 : 40);
                  return (
                    <div key={auth.id} className="bg-gradient-to-r from-slate-500 to-slate-600 rounded-lg text-white px-3 py-2 text-center text-sm font-bold shadow-lg flex items-center justify-center" style={{ height: `${height}px` }}>
                      {auth.code} ({count})
                    </div>);
                })}
              </div>
              <div className="w-16 flex items-center justify-center">
                <div className="w-full h-48 relative">
                  {[0, 1, 2, 3].map(i => (<div key={i} className="absolute w-full h-1 bg-gradient-to-r from-slate-400 to-emerald-400 rounded opacity-50" style={{ top: `${i * 25}%` }}></div>))}
                </div> </div>
              <div className="flex-1 flex flex-col justify-center gap-2">
                <h4 className="text-center font-bold text-slate-600 mb-2 text-sm">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h4>
                <div className="bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg text-white px-3 py-3 text-center font-bold shadow-lg flex items-center justify-center" style={{ minHeight: '50px' }}>
                  Ù…ØºØ·Ù‰ ({stats.fullCoverage})
                </div>
                <div className="bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg text-white px-3 py-3 text-center font-bold shadow-lg flex items-center justify-center" style={{ minHeight: '40px' }}>
                  Ø¬Ø²Ø¦ÙŠ ({stats.partialCoverage})
                </div>
                <div className="bg-gradient-to-r from-red-500 to-rose-500 rounded-lg text-white px-3 py-3 text-center font-bold shadow-lg flex items-center justify-center" style={{ minHeight: '30px' }}>
                  ÙØ¬ÙˆØ© ({stats.noCoverage})
                </div> </div>
              <div className="w-16 flex items-center justify-center">
                <div className="w-full h-1 bg-gradient-to-r from-emerald-400 to-blue-400 rounded opacity-50"></div>
              </div>
              <div className="flex-1 flex flex-col justify-center gap-2">
                <h4 className="text-center font-bold text-slate-600 mb-2 text-sm">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</h4>
                <div className="bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg text-white px-3 py-4 text-center font-bold shadow-lg flex-1 flex items-center justify-center">
                  <div><Shield className="w-6 h-6 mx-auto mb-1" />{CONTROLS.length} Ø¶Ø§Ø¨Ø·</div>
                </div> </div>
              <div className="w-16 flex items-center justify-center">
                <div className="w-full h-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded opacity-50"></div>
              </div>
              <div className="flex-1 flex flex-col justify-center gap-2">
                <h4 className="text-center font-bold text-slate-600 mb-2 text-sm">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</h4>
                <div className="bg-gradient-to-r from-purple-500 to-violet-500 rounded-lg text-white px-3 py-4 text-center font-bold shadow-lg flex-1 flex items-center justify-center">
                  <div><BookOpen className="w-6 h-6 mx-auto mb-1" />{POLICIES.length} Ø³ÙŠØ§Ø³Ø©</div>
                </div> </div> </div> </div> </div>
      )}

      <div className="bg-slate-50 rounded-2xl p-5 border border-slate-200">
        <h4 className="font-bold text-slate-700 mb-3">Golden Thread - Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø¨Ø·</h4>
        <div className="flex items-center gap-8 text-sm">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
              <Shield className="w-4 h-4 text-blue-600" />
            </div>
            <span className="text-slate-600">Ø¶ÙˆØ§Ø¨Ø· Ø±Ù‚Ø§Ø¨ÙŠØ© (Controls)</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">
              <AlertTriangle className="w-4 h-4 text-amber-600" />
            </div>
            <span className="text-slate-600">Ù…Ø®Ø§Ø·Ø± (Risks)</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
              <FileText className="w-4 h-4 text-purple-600" />
            </div>
            <span className="text-slate-600">Ø³ÙŠØ§Ø³Ø§Øª (Policies)</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
              <CheckCircle2 className="w-4 h-4 text-emerald-600" />
            </div>
            <span className="text-slate-600">ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
              <XCircle className="w-4 h-4 text-red-600" />
            </div>
            <span className="text-slate-600">ÙØ¬ÙˆØ© ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
          </div> </div> </div>
      {showFormModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className={`px-8 py-5 text-white ${formMode === 'edit' ? 'bg-gradient-to-l from-blue-600 via-indigo-600 to-purple-700' : 'bg-gradient-to-l from-emerald-600 via-teal-600 to-cyan-700'}`}>
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    {formMode === 'edit' ? <Edit className="w-8 h-8" /> : <Link2 className="w-8 h-8" />}
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">{formMode === 'edit' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø·' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¨Ø· Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="text-white/80 text-sm">Golden Thread: Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… â† Ø§Ù„Ø¶Ø§Ø¨Ø· â† Ø§Ù„Ù…Ø®Ø§Ø·Ø± â† Ø§Ù„Ø³ÙŠØ§Ø³Ø© â† Ø§Ù„Ø£Ø¯Ù„Ø©</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="text-center px-4 py-2 bg-white/10 backdrop-blur rounded-xl">
                    <p className="text-white/80 text-xs">Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</p>
                    <p className="text-2xl font-black">
                      {[selectedObligation || formData.obligationId, formData.controlId, formData.riskId, formData.policyId].filter(Boolean).length}/4
                    </p> </div>
                  <button onClick={handleCloseForm} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="flex items-center justify-between py-3 px-4 bg-white/10 rounded-2xl">
                {[
                  { id: 'obligation', label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', labelEn: 'Obligation', icon: FileText, color: 'emerald', isComplete: selectedObligation || formData.obligationId },
                  { id: 'control', label: 'Ø§Ù„Ø¶Ø§Ø¨Ø·', labelEn: 'Control', icon: Shield, color: 'blue', isComplete: formData.controlId },
                  { id: 'risk', label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', labelEn: 'Risk', icon: AlertTriangle, color: 'amber', isComplete: formData.riskId },
                  { id: 'policy', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', labelEn: 'Policy', icon: BookOpen, color: 'purple', isComplete: formData.policyId },
                ].map((item, idx, arr) => (
                  <React.Fragment key={item.id}>
                    <div className={`flex-1 flex flex-col items-center gap-1 p-3 rounded-xl transition-all ${item.isComplete ? 'bg-white/20' : 'bg-white/5'}`}>
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${item.isComplete ? 'bg-white/30' : 'bg-white/10'}`}>
                        {item.isComplete ? <CheckCircle2 className="w-5 h-5" /> : <item.icon className="w-5 h-5 opacity-60" />}
                      </div>
                      <span className="text-sm font-bold">{item.label}</span>
                      <span className="text-xs opacity-70">{item.labelEn}</span>
                    </div>
                    {idx < arr.length - 1 && (
                      <div className="flex items-center">
                        <div className={`w-8 h-1 rounded ${item.isComplete ? 'bg-white/50' : 'bg-white/20'}`}></div>
                        <ChevronLeft className={`w-5 h-5 ${item.isComplete ? 'text-white' : 'text-white/30'}`} />
                      </div>
                    )}
                  </React.Fragment>
                ))}
              </div> </div>
            <div className="flex border-b border-slate-200 px-4 bg-slate-50">
              {[
                { id: 'obligation', label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', icon: FileText, color: 'emerald', isComplete: selectedObligation || formData.obligationId },
                { id: 'control', label: 'Ø§Ù„Ø¶Ø§Ø¨Ø·', icon: Shield, color: 'blue', isComplete: formData.controlId, required: true },
                { id: 'risk', label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', icon: AlertTriangle, color: 'amber', isComplete: formData.riskId },
                { id: 'policy', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', icon: BookOpen, color: 'purple', isComplete: formData.policyId },
                { id: 'settings', label: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', icon: Settings, color: 'slate', isComplete: formData.coverageLevel },
              ].map((tab, idx) => {
                const isActive = (formData.activeGoldenTab || 0) === idx;
                const Icon = tab.icon;
                return (
                  <button
                    key={tab.id}
                    onClick={() => setFormData({ ...formData, activeGoldenTab: idx })}
                    className={`flex items-center gap-2 px-5 py-3 font-medium border-b-2 transition-all ${isActive
                      ? `border-${tab.color}-500 text-${tab.color}-700 bg-white -mb-px rounded-t-xl`
                      : 'border-transparent text-slate-500 hover:text-slate-700'
                      }`}>
                    <span className={`w-7 h-7 rounded-lg flex items-center justify-center ${isActive ? `bg-${tab.color}-500 text-white` :
                      tab.isComplete ? `bg-${tab.color}-100 text-${tab.color}-600` : 'bg-slate-200 text-slate-500'
                      }`}>
                      {tab.isComplete ? <Check className="w-4 h-4" /> : <Icon className="w-4 h-4" />}
                    </span>
                    <span className="text-sm">{tab.label}</span>
                    {tab.required && !tab.isComplete && <span className="text-red-500 text-lg">*</span>}
                  </button>);
              })}
            </div>

            <div className="flex-1 overflow-y-auto p-6">

              {(formData.activeGoldenTab || 0) === 0 && (
                <div className="space-y-4">
                  {(selectedObligation || formData.obligationId) && (
                    <div className="p-5 bg-gradient-to-r from-emerald-50 via-teal-50 to-cyan-50 rounded-2xl border-2 border-emerald-200">
                      <div className="flex items-start justify-between">
                        <div className="flex items-start gap-4">
                          <div className="w-14 h-14 rounded-2xl bg-emerald-500 flex items-center justify-center flex-shrink-0 shadow-lg shadow-emerald-500/30">
                            <FileText className="w-7 h-7 text-white" />
                          </div>
                          <div>
                            <div className="flex items-center gap-2 mb-2">
                              <span className="font-mono text-lg font-black text-emerald-600 bg-emerald-100 px-3 py-1 rounded-lg">{selectedObligation?.code}</span>
                              <span className="px-3 py-1 bg-slate-200 rounded-lg text-sm font-bold text-slate-600">{getAuthority(selectedObligation?.authorityId)?.code}</span>
                              <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedObligation?.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>
                                {selectedObligation?.status === 'Active' ? 'âœ“ Ù†Ø´Ø·' : selectedObligation?.status}
                              </span> </div>
                            <p className="font-bold text-slate-800 text-lg mb-1">{selectedObligation?.title}</p>
                            <p className="text-slate-500 text-sm">{selectedObligation?.description?.substring(0, 100)}...</p>
                          </div> </div>
                        {formMode === 'create' && (
                          <button onClick={() => { setSelectedObligation(null); setFormData({ ...formData, obligationId: null }); }}
                            className="text-slate-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-xl transition-all">
                            <X className="w-5 h-5" />
                          </button>
                        )}
                      </div> </div>
                  )}

                  {!selectedObligation && formMode === 'create' && (
                    <>
                      <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <span className="w-10 h-10 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-lg font-black">1</span>
                          <div>
                            <h3 className="font-bold text-slate-800 text-lg">Ø§Ø®ØªØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</h3>
                            <p className="text-slate-500 text-sm">Ø­Ø¯Ø¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</p>
                          </div> </div>
                        <span className="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm font-bold">Ù…Ø·Ù„ÙˆØ¨ *</span>
                      </div>

                      <div className="flex gap-3 mb-4">
                        <div className="flex-1 relative">
                          <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                          <input type="text" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†..."
                            className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" />
                        </div>
                        <select className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white focus:border-emerald-400 focus:outline-none">
                          <option value="">ÙƒÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                          {AUTHORITIES.map(auth => (
                            <option key={auth.id} value={auth.id}>{auth.code}</option>
                          ))}
                        </select>
                        <select className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white focus:border-emerald-400 focus:outline-none">
                          <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                          <option value="gap">ÙØ¬ÙˆØ§Øª ÙÙ‚Ø·</option>
                          <option value="covered">Ù…ØºØ·Ù‰</option>
                        </select>
                      </div>

                      <div className="grid grid-cols-2 gap-2 max-h-[200px] overflow-y-auto pr-2">
                        {obligationsWithCoverage.map(obl => {
                          const auth = getAuthority(obl.authorityId);
                          return (
                            <button key={obl.id} type="button"
                              onClick={() => { setSelectedObligation(obl); setFormData({ ...formData, obligationId: obl.id }); }}
                              className={`flex items-center gap-2 p-2.5 rounded-xl border-2 text-right transition-all hover:shadow group ${obl.coverageStatus === 'None'
                                ? 'border-red-200 bg-red-50/50 hover:border-red-400'
                                : 'border-slate-200 bg-white hover:border-emerald-400'
                                }`}>
                              <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${obl.coverageStatus === 'None' ? 'bg-red-100' : 'bg-emerald-100'
                                }`}>
                                <FileText className={`w-4 h-4 ${obl.coverageStatus === 'None' ? 'text-red-600' : 'text-emerald-600'}`} />
                              </div>
                              <div className="flex-1 min-w-0">
                                <div className="flex items-center gap-1.5 mb-0.5">
                                  <span className="font-mono text-xs font-bold text-emerald-600">{obl.code}</span>
                                  <span className="px-1.5 py-0.5 bg-slate-200 rounded text-xs font-bold text-slate-600">{auth?.code}</span>
                                  {obl.coverageStatus === 'None' && (
                                    <span className="px-1.5 py-0.5 bg-red-500 text-white rounded text-xs font-bold">ÙØ¬ÙˆØ©</span>
                                  )}
                                </div>
                                <p className="text-xs text-slate-700 truncate">{obl.title}</p>
                              </div>
                              <ChevronLeft className="w-4 h-4 text-slate-400 flex-shrink-0" />
                            </button>);
                        })}
                      </div>
                    </>
                  )}
                </div>
              )}

              {(formData.activeGoldenTab || 0) === 1 && (
                <div className="space-y-4">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="w-10 h-10 rounded-xl bg-blue-500 text-white flex items-center justify-center text-lg font-black">2</span>
                      <div>
                        <h3 className="font-bold text-slate-800 text-lg">Ø§Ø®ØªØ± Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ</h3>
                        <p className="text-slate-500 text-sm">Ø­Ø¯Ø¯ Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ÙŠØºØ·ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                      </div> </div>
                    <span className="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm font-bold">Ù…Ø·Ù„ÙˆØ¨ *</span>
                  </div>

                  <div className="flex gap-3 mb-4">
                    <div className="flex-1 relative">
                      <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                      <input type="text" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·..."
                        className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none" />
                    </div>
                    <select className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                      <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                      <option value="Preventive">ÙˆÙ‚Ø§Ø¦ÙŠ</option>
                      <option value="Detective">Ø§Ø³ØªÙƒØ´Ø§ÙÙŠ</option>
                      <option value="Corrective">ØªØµØ­ÙŠØ­ÙŠ</option>
                    </select>
                  </div>

                  <div className="grid grid-cols-3 gap-2 max-h-[200px] overflow-y-auto pr-2">
                    {CONTROLS.map(ctrl => {
                      const isSelected = formData.controlId === ctrl.id;
                      return (
                        <button key={ctrl.id} type="button"
                          onClick={() => setFormData({ ...formData, controlId: ctrl.id })}
                          className={`flex items-center gap-2 p-2.5 rounded-xl border-2 text-right transition-all ${isSelected
                            ? 'border-blue-500 bg-blue-50 shadow-md'
                            : 'border-slate-200 bg-white hover:border-blue-300'
                            }`}>
                          <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-blue-500 text-white' : 'bg-blue-100 text-blue-600'
                            }`}>
                            {isSelected ? <CheckCircle2 className="w-4 h-4" /> : <Shield className="w-4 h-4" />}
                          </div>
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-1.5 mb-0.5">
                              <span className={`font-mono text-xs font-bold ${isSelected ? 'text-blue-700' : 'text-blue-600'}`}>{ctrl.code}</span>
                              <span className={`px-1.5 py-0.5 rounded text-xs font-bold ${ctrl.type === 'Preventive' ? 'bg-emerald-100 text-emerald-700' :
                                ctrl.type === 'Detective' ? 'bg-amber-100 text-amber-700' : 'bg-purple-100 text-purple-700'
                                }`}>
                                {ctrl.type === 'Preventive' ? 'ÙˆÙ‚Ø§Ø¦ÙŠ' : ctrl.type === 'Detective' ? 'Ø§Ø³ØªÙƒØ´Ø§ÙÙŠ' : 'ØªØµØ­ÙŠØ­ÙŠ'}
                              </span> </div>
                            <p className={`text-xs truncate ${isSelected ? 'text-blue-800 font-bold' : 'text-slate-600'}`}>{ctrl.title}</p>
                          </div> </button>);
                    })}
                  </div> </div>
              )}

              {(formData.activeGoldenTab || 0) === 2 && (
                <div className="space-y-4">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="w-10 h-10 rounded-xl bg-amber-500 text-white flex items-center justify-center text-lg font-black">3</span>
                      <div>
                        <h3 className="font-bold text-slate-800 text-lg">Ø±Ø¨Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
                        <p className="text-slate-500 text-sm">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙŠ ÙŠØ¹Ø§Ù„Ø¬Ù‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø¶Ø§Ø¨Ø·</p>
                      </div> </div>
                    <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm font-bold">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span>
                  </div>

                  <div className="relative mb-4">
                    <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                    <input type="text" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±..."
                      className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-400 focus:outline-none" />
                  </div>

                  <div className="grid grid-cols-3 gap-2 max-h-[200px] overflow-y-auto pr-2">
                    {RISKS.map(risk => {
                      const isSelected = formData.riskId === risk.id;
                      return (
                        <button key={risk.id} type="button"
                          onClick={() => setFormData({ ...formData, riskId: isSelected ? null : risk.id })}
                          className={`flex items-center gap-2 p-2.5 rounded-xl border-2 text-right transition-all ${isSelected
                            ? 'border-amber-500 bg-amber-50 shadow-md'
                            : 'border-slate-200 bg-white hover:border-amber-300'
                            }`}>
                          <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-amber-500 text-white' : 'bg-amber-100 text-amber-600'
                            }`}>
                            {isSelected ? <CheckCircle2 className="w-4 h-4" /> : <AlertTriangle className="w-4 h-4" />}
                          </div>
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-1.5 mb-0.5">
                              <span className={`font-mono text-xs font-bold ${isSelected ? 'text-amber-700' : 'text-amber-600'}`}>{risk.code}</span>
                              <span className={`px-1.5 py-0.5 rounded text-xs font-bold ${risk.level === 'Critical' ? 'bg-red-100 text-red-700' :
                                risk.level === 'High' ? 'bg-orange-100 text-orange-700' :
                                  risk.level === 'Medium' ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'
                                }`}>
                                {risk.level === 'Critical' ? 'Ø­Ø±Ø¬' : risk.level === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : risk.level === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}
                              </span> </div>
                            <p className={`text-xs truncate ${isSelected ? 'text-amber-800 font-bold' : 'text-slate-600'}`}>{risk.title}</p>
                          </div> </button>);
                    })}
                  </div> </div>
              )}

              {(formData.activeGoldenTab || 0) === 3 && (
                <div className="space-y-4">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="w-10 h-10 rounded-xl bg-purple-500 text-white flex items-center justify-center text-lg font-black">4</span>
                      <div>
                        <h3 className="font-bold text-slate-800 text-lg">Ø±Ø¨Ø· Ø§Ù„Ø³ÙŠØ§Ø³Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
                        <p className="text-slate-500 text-sm">Ø­Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·</p>
                      </div> </div>
                    <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm font-bold">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span>
                  </div>

                  <div className="flex gap-3 mb-4">
                    <div className="flex-1 relative">
                      <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                      <input type="text" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±..."
                        className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none" />
                    </div>
                    <select className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                      <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                      <option value="Policy">Ø³ÙŠØ§Ø³Ø©</option>
                      <option value="Standard">Ù…Ø¹ÙŠØ§Ø±</option>
                      <option value="Procedure">Ø¥Ø¬Ø±Ø§Ø¡</option>
                    </select>
                  </div>

                  <div className="grid grid-cols-3 gap-2 max-h-[200px] overflow-y-auto pr-2">
                    {POLICIES.map(policy => {
                      const isSelected = formData.policyId === policy.id;
                      const typeInfo = policy.type === 'Policy'
                        ? { label: 'Ø³ÙŠØ§Ø³Ø©', color: 'emerald' }
                        : policy.type === 'Standard'
                          ? { label: 'Ù…Ø¹ÙŠØ§Ø±', color: 'blue' }
                          : { label: 'Ø¥Ø¬Ø±Ø§Ø¡', color: 'purple' };
                      return (
                        <button key={policy.id} type="button"
                          onClick={() => setFormData({ ...formData, policyId: isSelected ? null : policy.id })}
                          className={`flex items-center gap-2 p-2.5 rounded-xl border-2 text-right transition-all ${isSelected
                            ? 'border-purple-500 bg-purple-50 shadow-md'
                            : 'border-slate-200 bg-white hover:border-purple-300'
                            }`}>
                          <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isSelected ? 'bg-purple-500 text-white' : 'bg-purple-100 text-purple-600'
                            }`}>
                            {isSelected ? <CheckCircle2 className="w-4 h-4" /> : <BookOpen className="w-4 h-4" />}
                          </div>
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-1.5 mb-0.5">
                              <span className={`font-mono text-xs font-bold ${isSelected ? 'text-purple-700' : 'text-purple-600'}`}>{policy.code}</span>
                              <span className={`px-1.5 py-0.5 rounded text-xs font-bold bg-${typeInfo.color}-100 text-${typeInfo.color}-700`}>
                                {typeInfo.label}
                              </span> </div>
                            <p className={`text-xs truncate ${isSelected ? 'text-purple-800 font-bold' : 'text-slate-600'}`}>{policy.title}</p>
                          </div> </button>);
                    })}
                  </div> </div>
              )}

              {(formData.activeGoldenTab || 0) === 4 && (
                <div className="space-y-6">
                  <div className="flex items-center gap-3 mb-4">
                    <span className="w-10 h-10 rounded-xl bg-slate-500 text-white flex items-center justify-center text-lg font-black">5</span>
                    <div>
                      <h3 className="font-bold text-slate-800 text-lg">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                      <p className="text-slate-500 text-sm">Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØºØ·ÙŠØ© ÙˆÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶Ø§Ø¨Ø·</p>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="p-5 bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl border-2 border-slate-200">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <Target className="w-5 h-5 text-slate-600" />
                        Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØºØ·ÙŠØ©
                      </h4>
                      <div className="grid grid-cols-3 gap-3">
                        {[
                          { value: 'Full', label: 'ÙƒØ§Ù…Ù„Ø©', desc: '100%', icon: CheckCircle2, color: 'emerald' },
                          { value: 'Partial', label: 'Ø¬Ø²Ø¦ÙŠØ©', desc: '50%', icon: Clock, color: 'amber' },
                          { value: 'None', label: 'Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ©', desc: '0%', icon: XCircle, color: 'red' }
                        ].map(opt => {
                          const isSelected = formData.coverageLevel === opt.value;
                          return (
                            <button key={opt.value} type="button"
                              onClick={() => setFormData({ ...formData, coverageLevel: opt.value })}
                              className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${isSelected
                                ? `border-${opt.color}-500 bg-${opt.color}-50 shadow-lg`
                                : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <opt.icon className={`w-8 h-8 ${isSelected ? `text-${opt.color}-600` : 'text-slate-400'}`} />
                              <span className={`text-sm font-bold ${isSelected ? `text-${opt.color}-700` : 'text-slate-600'}`}>{opt.label}</span>
                              <span className={`text-2xl font-black ${isSelected ? `text-${opt.color}-600` : 'text-slate-400'}`}>{opt.desc}</span>
                            </button>);
                        })}
                      </div> </div>
                    <div className="p-5 bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl border-2 border-slate-200">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <Activity className="w-5 h-5 text-slate-600" />
                        ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶Ø§Ø¨Ø·
                      </h4>
                      <div className="grid grid-cols-3 gap-3">
                        {[
                          { value: 'Effective', label: 'ÙØ¹Ø§Ù„', desc: 'ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', color: 'emerald' },
                          { value: 'PartiallyEffective', label: 'ÙØ¹Ø§Ù„ Ø¬Ø²Ø¦ÙŠØ§Ù‹', desc: 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†', color: 'amber' },
                          { value: 'Ineffective', label: 'ØºÙŠØ± ÙØ¹Ø§Ù„', desc: 'ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙ…ÙŠÙ…', color: 'red' }
                        ].map(opt => {
                          const isSelected = formData.effectiveness === opt.value;
                          return (
                            <button key={opt.value} type="button"
                              onClick={() => setFormData({ ...formData, effectiveness: opt.value })}
                              className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${isSelected
                                ? `border-${opt.color}-500 bg-${opt.color}-50 shadow-lg`
                                : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <div className={`w-4 h-4 rounded-full ${isSelected ? `bg-${opt.color}-500` : 'bg-slate-300'}`}></div>
                              <span className={`text-sm font-bold ${isSelected ? `text-${opt.color}-700` : 'text-slate-600'}`}>{opt.label}</span>
                              <span className="text-xs text-slate-500 text-center">{opt.desc}</span>
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="p-5 bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl border-2 border-slate-200">
                    <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                      <FileText className="w-5 h-5 text-slate-600" />
                      Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØªØ¹Ù„ÙŠÙ‚Ø§Øª
                    </h4>
                    <textarea
                      value={formData.notes || ''}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      rows={4}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-emerald-500 resize-none"
                      placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø·ØŒ Ù…Ø«Ù„: Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¨Ø·ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ØŒ Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†..."
                    />
                  </div>

                  <div className="p-5 bg-gradient-to-r from-emerald-50 via-blue-50 to-purple-50 rounded-2xl border-2 border-emerald-200">
                    <h4 className="font-bold text-slate-800 mb-4">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø¨Ø·</h4>
                    <div className="grid grid-cols-4 gap-4">
                      {[
                        { label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', value: selectedObligation?.code, color: 'emerald', icon: FileText },
                        { label: 'Ø§Ù„Ø¶Ø§Ø¨Ø·', value: CONTROLS.find(c => c.id === formData.controlId)?.code, color: 'blue', icon: Shield },
                        { label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', value: RISKS.find(r => r.id === formData.riskId)?.code || 'Ù„Ù… ÙŠØ­Ø¯Ø¯', color: 'amber', icon: AlertTriangle },
                        { label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', value: POLICIES.find(p => p.id === formData.policyId)?.code || 'Ù„Ù… ÙŠØ­Ø¯Ø¯', color: 'purple', icon: BookOpen },
                      ].map((item, idx) => {
                        const Icon = item.icon;
                        return (
                          <div key={idx} className={`p-3 bg-white rounded-xl border-2 border-${item.color}-200`}>
                            <div className="flex items-center gap-2 mb-1">
                              <Icon className={`w-4 h-4 text-${item.color}-600`} />
                              <span className="text-xs text-slate-500">{item.label}</span>
                            </div>
                            <p className={`font-mono font-bold text-${item.color}-700`}>{item.value || '-'}</p>
                          </div>);
                      })}
                    </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <button onClick={handleCloseForm} className="px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white transition-all">
                  Ø¥Ù„ØºØ§Ø¡
                </button> </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setFormData({ ...formData, activeGoldenTab: Math.max(0, (formData.activeGoldenTab || 0) - 1) })}
                  disabled={(formData.activeGoldenTab || 0) === 0}
                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold transition-all ${(formData.activeGoldenTab || 0) === 0
                    ? 'bg-slate-100 text-slate-300 cursor-not-allowed'
                    : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-emerald-500 hover:text-emerald-700'
                    }`}>
                  <ChevronRight className="w-5 h-5" />
                  <span>Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
                </button>

                <div className="flex items-center gap-1 px-4 py-2 bg-white border-2 border-slate-200 rounded-xl">
                  {[0, 1, 2, 3, 4].map(idx => (
                    <button
                      key={idx}
                      onClick={() => setFormData({ ...formData, activeGoldenTab: idx })}
                      className={`w-8 h-8 rounded-lg font-bold text-sm transition-all ${(formData.activeGoldenTab || 0) === idx
                        ? 'bg-emerald-500 text-white'
                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                        }`}>
                      {idx + 1}
                    </button>
                  ))}
                </div>

                <button
                  onClick={() => setFormData({ ...formData, activeGoldenTab: Math.min(4, (formData.activeGoldenTab || 0) + 1) })}
                  disabled={(formData.activeGoldenTab || 0) === 4}
                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold transition-all ${(formData.activeGoldenTab || 0) === 4
                    ? 'bg-slate-100 text-slate-300 cursor-not-allowed'
                    : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-emerald-500 hover:text-emerald-700'
                    }`}>
                  <span>Ø§Ù„ØªØ§Ù„ÙŠ</span>
                  <ChevronLeft className="w-5 h-5" />
                </button> </div>
              <div className="flex items-center gap-3">
                <div className="flex items-center gap-1.5 text-xs">
                  {(selectedObligation || formData.obligationId) && <span className="flex items-center gap-1 px-2 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg font-bold"><FileText className="w-3.5 h-3.5" /> Ø§Ù„ØªØ²Ø§Ù…</span>}
                  {formData.controlId && <span className="flex items-center gap-1 px-2 py-1.5 bg-blue-100 text-blue-700 rounded-lg font-bold"><Shield className="w-3.5 h-3.5" /> Ø¶Ø§Ø¨Ø·</span>}
                  {formData.riskId && <span className="flex items-center gap-1 px-2 py-1.5 bg-amber-100 text-amber-700 rounded-lg font-bold"><AlertTriangle className="w-3.5 h-3.5" /> Ø®Ø·Ø±</span>}
                  {formData.policyId && <span className="flex items-center gap-1 px-2 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold"><BookOpen className="w-3.5 h-3.5" /> Ø³ÙŠØ§Ø³Ø©</span>}
                </div>

                <button
                  onClick={handleSaveForm}
                  disabled={!formData.controlId || (!selectedObligation && !formData.obligationId)}
                  className={`flex items-center gap-2 px-6 py-2.5 text-white rounded-xl font-bold shadow-lg transition-all ${!formData.controlId || (!selectedObligation && !formData.obligationId)
                    ? 'bg-slate-300 cursor-not-allowed'
                    : formMode === 'edit'
                      ? 'bg-gradient-to-r from-blue-500 to-indigo-600 hover:shadow-xl hover:scale-105'
                      : 'bg-gradient-to-r from-emerald-500 to-teal-600 hover:shadow-xl hover:scale-105'
                    }`}>
                  <Save className="w-5 h-5" />
                  {formMode === 'edit' ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø·'}
                </button> </div> </div> </div> </div>
      )}

      {showViewModal && selectedObligation && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-slate-600 to-slate-800 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <Eye className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</h2>
                    <p className="text-slate-300 text-sm">{selectedObligation.code}</p>
                  </div> </div>
                <button onClick={() => setShowViewModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5 max-h-[70vh] overflow-y-auto">
              <div className="bg-slate-50 rounded-xl p-4">
                <h3 className="font-bold text-slate-800 mb-2">{selectedObligation.title}</h3>
                <p className="text-slate-600 text-sm">{selectedObligation.statement}</p>
              </div>

              <div className="grid grid-cols-3 gap-4">
                <div className="bg-blue-50 rounded-xl p-4 text-center">
                  <Shield className="w-8 h-8 text-blue-600 mx-auto mb-2" />
                  <p className="text-2xl font-bold text-blue-600">{selectedObligation.controlCount}</p>
                  <p className="text-sm text-blue-700">Ø¶ÙˆØ§Ø¨Ø· Ù…Ø±ØªØ¨Ø·Ø©</p>
                </div>
                <div className="bg-amber-50 rounded-xl p-4 text-center">
                  <AlertTriangle className="w-8 h-8 text-amber-600 mx-auto mb-2" />
                  <p className="text-2xl font-bold text-amber-600">{selectedObligation.riskCount}</p>
                  <p className="text-sm text-amber-700">Ù…Ø®Ø§Ø·Ø± Ù…Ø±ØªØ¨Ø·Ø©</p>
                </div>
                <div className="bg-purple-50 rounded-xl p-4 text-center">
                  <FileText className="w-8 h-8 text-purple-600 mx-auto mb-2" />
                  <p className="text-2xl font-bold text-purple-600">{selectedObligation.policies?.length || 0}</p>
                  <p className="text-sm text-purple-700">Ø³ÙŠØ§Ø³Ø§Øª Ù…Ø±ØªØ¨Ø·Ø©</p>
                </div> </div>
              {selectedObligation.controls?.length > 0 && (
                <div>
                  <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <Shield className="w-5 h-5 text-blue-600" />
                    Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                  </h4>
                  <div className="space-y-2">
                    {selectedObligation.controls.map(ctrl => (
                      <div key={ctrl.id} className="flex items-center justify-between p-3 bg-blue-50 rounded-xl">
                        <div className="flex items-center gap-3">
                          <span className="px-2.5 py-1 bg-blue-500 text-white rounded-lg text-xs font-bold">{ctrl.code}</span>
                          <span className="text-sm text-slate-700">{ctrl.title}</span>
                        </div>
                        <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${ctrl.effectiveness === 'Effective' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>
                          {ctrl.effectiveness === 'Effective' ? 'ÙØ¹Ø§Ù„' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
                        </span> </div>
                    ))}
                  </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowViewModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-3">
                <button onClick={() => { setShowViewModal(false); handleEditMapping(selectedObligation, selectedObligation.mappings?.[0]); }} className="flex items-center gap-2 px-6 py-3 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600">
                  <Edit className="w-5 h-5" />
                  ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button onClick={() => { setShowViewModal(false); handleAddMapping(selectedObligation); }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold">
                  <Plus className="w-5 h-5" />
                  Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø·
                </button> </div> </div> </div> </div>
      )}

      {showVisualMappingTool && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><Network className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø£Ø¯Ø§Ø© Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø±Ø¦ÙŠ</h2>
                    <p className="text-purple-200 text-sm">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· - Visual Drag & Drop Mapping</p>
                  </div> </div>
                <button onClick={() => setShowVisualMappingTool(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 p-6 overflow-hidden">
              <div className="grid grid-cols-4 gap-6 h-full">
                <div className="bg-emerald-50 rounded-2xl border-2 border-emerald-200 flex flex-col">
                  <div className="p-4 border-b border-emerald-200 bg-emerald-100 rounded-t-2xl">
                    <div className="flex items-center gap-2 mb-2"><FileText className="w-5 h-5 text-emerald-600" /><h3 className="font-bold text-emerald-800">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h3></div>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-full px-3 py-2 rounded-lg border border-emerald-300 text-sm" />
                  </div>
                  <div className="flex-1 overflow-y-auto p-3 space-y-2">
                    {INITIAL_OBLIGATIONS.slice(0, 10).map(obl => (
                      <div key={obl.id} draggable onDragStart={(e) => handleDragStart(e, obl, 'obligation')} className={`p-3 bg-white rounded-xl border-2 cursor-grab active:cursor-grabbing transition-all hover:shadow-lg hover:scale-[1.02] ${draggedItem?.item?.id === obl.id && draggedItem?.type === 'obligation' ? 'border-emerald-500 shadow-lg' : 'border-emerald-200'}`}>
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-xs font-bold text-emerald-600 bg-emerald-100 px-1.5 py-0.5 rounded">{obl.code}</span>
                          {!MAPPINGS.some(m => m.obligationId === obl.id) && <span className="text-xs bg-red-500 text-white px-1.5 py-0.5 rounded">ÙØ¬ÙˆØ©</span>}
                        </div>
                        <p className="text-xs text-slate-700 line-clamp-2">{obl.title}</p>
                      </div>
                    ))}
                  </div> </div>
                <div className="bg-blue-50 rounded-2xl border-2 border-blue-200 flex flex-col" onDragOver={(e) => handleDragOver(e, null, 'control')} onDrop={(e) => handleDrop(e, null, 'control')}>
                  <div className="p-4 border-b border-blue-200 bg-blue-100 rounded-t-2xl">
                    <div className="flex items-center gap-2 mb-2"><Shield className="w-5 h-5 text-blue-600" /><h3 className="font-bold text-blue-800">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</h3></div>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-full px-3 py-2 rounded-lg border border-blue-300 text-sm" />
                  </div>
                  <div className="flex-1 overflow-y-auto p-3 space-y-2">
                    {CONTROLS.slice(0, 10).map(ctrl => (
                      <div key={ctrl.id} draggable onDragStart={(e) => handleDragStart(e, ctrl, 'control')} className={`p-3 bg-white rounded-xl border-2 cursor-grab active:cursor-grabbing transition-all hover:shadow-lg hover:scale-[1.02] ${dropTarget?.targetType === 'control' ? 'border-blue-500 bg-blue-50' : 'border-blue-200'}`}>
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-xs font-bold text-blue-600 bg-blue-100 px-1.5 py-0.5 rounded">{ctrl.id}</span>
                          <span className={`text-xs px-1.5 py-0.5 rounded ${ctrl.type === 'Preventive' ? 'bg-emerald-100 text-emerald-700' : ctrl.type === 'Detective' ? 'bg-amber-100 text-amber-700' : 'bg-purple-100 text-purple-700'}`}>{ctrl.type === 'Preventive' ? 'ÙˆÙ‚Ø§Ø¦ÙŠ' : ctrl.type === 'Detective' ? 'Ø§Ø³ØªÙƒØ´Ø§ÙÙŠ' : 'ØªØµØ­ÙŠØ­ÙŠ'}</span>
                        </div>
                        <p className="text-xs text-slate-700 line-clamp-2">{ctrl.name}</p>
                      </div>
                    ))}
                  </div> </div>
                <div className="bg-amber-50 rounded-2xl border-2 border-amber-200 flex flex-col" onDragOver={(e) => handleDragOver(e, null, 'risk')} onDrop={(e) => handleDrop(e, null, 'risk')}>
                  <div className="p-4 border-b border-amber-200 bg-amber-100 rounded-t-2xl">
                    <div className="flex items-center gap-2 mb-2"><AlertTriangle className="w-5 h-5 text-amber-600" /><h3 className="font-bold text-amber-800">Ø§Ù„Ù…Ø®Ø§Ø·Ø±</h3></div>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-full px-3 py-2 rounded-lg border border-amber-300 text-sm" />
                  </div>
                  <div className="flex-1 overflow-y-auto p-3 space-y-2">
                    {RISKS.slice(0, 10).map(risk => (
                      <div key={risk.id} draggable onDragStart={(e) => handleDragStart(e, risk, 'risk')} className="p-3 bg-white rounded-xl border-2 border-amber-200 cursor-grab active:cursor-grabbing transition-all hover:shadow-lg hover:scale-[1.02]">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-xs font-bold text-amber-600 bg-amber-100 px-1.5 py-0.5 rounded">{risk.id}</span>
                          <span className={`text-xs px-1.5 py-0.5 rounded ${risk.severity === 'Critical' ? 'bg-red-500 text-white' : risk.severity === 'High' ? 'bg-orange-100 text-orange-700' : 'bg-yellow-100 text-yellow-700'}`}>{risk.severity === 'Critical' ? 'Ø­Ø±Ø¬' : risk.severity === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span>
                        </div>
                        <p className="text-xs text-slate-700 line-clamp-2">{risk.name}</p>
                      </div>
                    ))}
                  </div> </div>
                <div className="bg-purple-50 rounded-2xl border-2 border-purple-200 flex flex-col" onDragOver={(e) => handleDragOver(e, null, 'policy')} onDrop={(e) => handleDrop(e, null, 'policy')}>
                  <div className="p-4 border-b border-purple-200 bg-purple-100 rounded-t-2xl">
                    <div className="flex items-center gap-2 mb-2"><BookOpen className="w-5 h-5 text-purple-600" /><h3 className="font-bold text-purple-800">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</h3></div>
                    <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-full px-3 py-2 rounded-lg border border-purple-300 text-sm" />
                  </div>
                  <div className="flex-1 overflow-y-auto p-3 space-y-2">
                    {POLICIES.slice(0, 10).map(pol => (
                      <div key={pol.id} draggable onDragStart={(e) => handleDragStart(e, pol, 'policy')} className="p-3 bg-white rounded-xl border-2 border-purple-200 cursor-grab active:cursor-grabbing transition-all hover:shadow-lg hover:scale-[1.02]">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-xs font-bold text-purple-600 bg-purple-100 px-1.5 py-0.5 rounded">{pol.code}</span>
                          <span className={`text-xs px-1.5 py-0.5 rounded ${pol.status === 'Published' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>{pol.status === 'Published' ? 'Ù…Ù†Ø´ÙˆØ±' : pol.status}</span>
                        </div>
                        <p className="text-xs text-slate-700 line-clamp-2">{pol.title}</p>
                      </div>
                    ))}
                  </div> </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <p className="text-sm text-slate-600">Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</p>
              <button onClick={() => setShowVisualMappingTool(false)} className="px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
            </div> </div> </div>
      )}

      {showAutoSuggestModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-cyan-600 to-blue-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><Zap className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h2>
                    <p className="text-cyan-200 text-sm">Ø±ÙˆØ§Ø¨Ø· Ù…Ù‚ØªØ±Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©</p>
                  </div> </div>
                <button onClick={() => setShowAutoSuggestModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="p-6 border-b border-slate-200">
              <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</label>
              <select onChange={(e) => { const obl = INITIAL_OBLIGATIONS.find(o => o.id === parseInt(e.target.value)); if (obl) { setAutoSuggestions(generateAutoSuggestions(obl)); setSelectedObligation(obl); } }} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØ²Ø§Ù… --</option>
                {INITIAL_OBLIGATIONS.map(obl => (<option key={obl.id} value={obl.id}>{obl.code} - {obl.title}</option>))}
              </select>
            </div>
            <div className="flex-1 overflow-y-auto p-6">
              {autoSuggestions.length > 0 ? (
                <div className="space-y-4">
                  <h4 className="font-bold text-slate-800 mb-4"><span className="text-cyan-600">{autoSuggestions.length}</span> Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ø±Ø¨Ø·</h4>
                  {autoSuggestions.map((suggestion, idx) => (
                    <div key={idx} className={`p-4 rounded-xl border-2 ${suggestion.type === 'control' ? 'bg-blue-50 border-blue-200' : suggestion.type === 'risk' ? 'bg-amber-50 border-amber-200' : 'bg-purple-50 border-purple-200'}`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${suggestion.type === 'control' ? 'bg-blue-500 text-white' : suggestion.type === 'risk' ? 'bg-amber-500 text-white' : 'bg-purple-500 text-white'}`}>
                            {suggestion.type === 'control' ? <Shield className="w-5 h-5" /> : suggestion.type === 'risk' ? <AlertTriangle className="w-5 h-5" /> : <BookOpen className="w-5 h-5" />}
                          </div>
                          <div>
                            <p className="font-bold text-slate-800">{suggestion.item.name || suggestion.item.title}</p>
                            <p className="text-sm text-slate-500">{suggestion.reason}</p>
                          </div> </div>
                        <div className="flex items-center gap-2">
                          <span className={`px-3 py-1 rounded-full text-sm font-bold ${suggestion.score >= 3 ? 'bg-emerald-100 text-emerald-700' : suggestion.score >= 2 ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-600'}`}>
                            {suggestion.score >= 3 ? 'ØªØ·Ø§Ø¨Ù‚ Ø¹Ø§Ù„ÙŠ' : suggestion.score >= 2 ? 'ØªØ·Ø§Ø¨Ù‚ Ù…ØªÙˆØ³Ø·' : 'ØªØ·Ø§Ø¨Ù‚ Ù…Ù†Ø®ÙØ¶'}
                          </span>
                          <button className="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-lg font-bold text-sm hover:from-emerald-600 hover:to-teal-600">Ø§Ø¹ØªÙ…Ø§Ø¯</button>
                        </div> </div> </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-16"><Zap className="w-16 h-16 text-slate-300 mx-auto mb-4" /><p className="text-slate-500">Ø§Ø®ØªØ± Ø§Ù„ØªØ²Ø§Ù…Ø§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</p></div>
              )}
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowAutoSuggestModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="px-6 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-bold">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</button>
            </div> </div> </div>
      )}

      {showCoverageAnalysis && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-emerald-600 to-teal-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><PieChart className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØºØ·ÙŠØ©</h2>
                    <p className="text-emerald-200 text-sm">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª - Coverage Analysis Report</p>
                  </div> </div>
                <button onClick={() => setShowCoverageAnalysis(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-4 gap-4">
                <div className="bg-emerald-50 rounded-2xl p-5 border-2 border-emerald-200 text-center"><p className="text-4xl font-black text-emerald-600">{stats.coveragePercent}%</p><p className="text-sm text-emerald-700 font-bold">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºØ·ÙŠØ©</p></div>
                <div className="bg-blue-50 rounded-2xl p-5 border-2 border-blue-200 text-center"><p className="text-4xl font-black text-blue-600">{stats.fullCoverage}</p><p className="text-sm text-blue-700 font-bold">ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</p></div>
                <div className="bg-amber-50 rounded-2xl p-5 border-2 border-amber-200 text-center"><p className="text-4xl font-black text-amber-600">{stats.partialCoverage}</p><p className="text-sm text-amber-700 font-bold">ØªØºØ·ÙŠØ© Ø¬Ø²Ø¦ÙŠØ©</p></div>
                <div className="bg-red-50 rounded-2xl p-5 border-2 border-red-200 text-center"><p className="text-4xl font-black text-red-600">{stats.noCoverage}</p><p className="text-sm text-red-700 font-bold">Ø¨Ø¯ÙˆÙ† ØªØºØ·ÙŠØ©</p></div>
              </div>
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Building2 className="w-5 h-5 text-slate-600" />Ø§Ù„ØªØºØ·ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h3>
                <div className="space-y-3">
                  {Object.entries(coverageAnalysis.byAuthority).map(([code, data]) => {
                    const pct = data.total > 0 ? Math.round((data.covered / data.total) * 100) : 0;
                    return (
                      <div key={code} className="flex items-center gap-4">
                        <span className="w-20 font-bold text-slate-700">{code}</span>
                        <div className="flex-1 h-4 bg-slate-100 rounded-full overflow-hidden"><div className={`h-full rounded-full ${pct >= 80 ? 'bg-emerald-500' : pct >= 50 ? 'bg-amber-500' : 'bg-red-500'}`} style={{ width: `${pct}%` }} /></div>
                        <span className="w-24 text-sm text-slate-600">{data.covered}/{data.total} ({pct}%)</span>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><AlertTriangle className="w-5 h-5 text-slate-600" />Ø§Ù„ØªØºØ·ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</h3>
                <div className="grid grid-cols-3 gap-4">
                  {Object.entries(coverageAnalysis.byCriticality).map(([level, data]) => {
                    const pct = data.total > 0 ? Math.round((data.covered / data.total) * 100) : 0;
                    return (
                      <div key={level} className={`p-4 rounded-xl ${level === 'High' ? 'bg-red-50 border-2 border-red-200' : level === 'Medium' ? 'bg-amber-50 border-2 border-amber-200' : 'bg-green-50 border-2 border-green-200'}`}>
                        <p className="font-bold text-slate-800 mb-2">{level === 'High' ? 'Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©' : level === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}</p>
                        <div className="flex items-baseline gap-2"><span className="text-3xl font-black">{pct}%</span><span className="text-sm text-slate-500">{data.covered}/{data.total}</span></div>
                      </div>);
                  })}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowCoverageAnalysis(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="flex items-center gap-2 px-6 py-2.5 bg-emerald-500 text-white rounded-xl font-bold"><Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            </div> </div> </div>
      )}

      {showOrphanDetection && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-red-600 to-rose-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><AlertCircle className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙŠØªÙŠÙ…Ø©</h2>
                    <p className="text-red-200 text-sm">Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·Ø© ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø§Ù„Ø¬Ø© - Orphan Detection</p>
                  </div> </div>
                <div className="px-4 py-2 bg-white/20 rounded-xl"><span className="text-2xl font-black">{orphanAnalysis.total}</span><span className="text-sm mr-2">Ø¹Ù†ØµØ± ÙŠØªÙŠÙ…</span></div>
                <button onClick={() => setShowOrphanDetection(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              {orphanAnalysis.obligations.length > 0 && (
                <div className="bg-emerald-50 rounded-2xl border-2 border-emerald-200 p-5">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-bold text-emerald-800 flex items-center gap-2"><FileText className="w-5 h-5" />Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¶ÙˆØ§Ø¨Ø· ({orphanAnalysis.obligations.length})</h3>
                    <button className="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm font-bold">Ø±Ø¨Ø· Ø§Ù„ÙƒÙ„</button>
                  </div>
                  <div className="grid grid-cols-2 gap-2">
                    {orphanAnalysis.obligations.slice(0, 6).map(obl => (
                      <div key={obl.id} className="p-3 bg-white rounded-xl border border-emerald-200 flex items-center justify-between">
                        <div><span className="font-mono text-sm font-bold text-emerald-600">{obl.code}</span><p className="text-xs text-slate-600 truncate max-w-xs">{obl.title}</p></div>
                        <button onClick={() => handleAddMapping(obl)} className="p-2 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200"><Plus className="w-4 h-4" /></button>
                      </div>
                    ))}
                  </div> </div>
              )}
              {orphanAnalysis.controls.length > 0 && (
                <div className="bg-blue-50 rounded-2xl border-2 border-blue-200 p-5">
                  <h3 className="font-bold text-blue-800 flex items-center gap-2 mb-4"><Shield className="w-5 h-5" />Ø¶ÙˆØ§Ø¨Ø· ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© ({orphanAnalysis.controls.length})</h3>
                  <div className="grid grid-cols-2 gap-2">
                    {orphanAnalysis.controls.slice(0, 6).map(ctrl => (
                      <div key={ctrl.id} className="p-3 bg-white rounded-xl border border-blue-200">
                        <span className="font-mono text-sm font-bold text-blue-600">{ctrl.id}</span>
                        <p className="text-xs text-slate-600 truncate">{ctrl.name}</p>
                      </div>
                    ))}
                  </div> </div>
              )}
              {orphanAnalysis.risks.length > 0 && (
                <div className="bg-amber-50 rounded-2xl border-2 border-amber-200 p-5">
                  <h3 className="font-bold text-amber-800 flex items-center gap-2 mb-4"><AlertTriangle className="w-5 h-5" />Ù…Ø®Ø§Ø·Ø± ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·Ø© ({orphanAnalysis.risks.length})</h3>
                  <div className="grid grid-cols-2 gap-2">
                    {orphanAnalysis.risks.slice(0, 6).map(risk => (
                      <div key={risk.id} className="p-3 bg-white rounded-xl border border-amber-200">
                        <span className="font-mono text-sm font-bold text-amber-600">{risk.id}</span>
                        <p className="text-xs text-slate-600 truncate">{risk.name}</p>
                      </div>
                    ))}
                  </div> </div>
              )}
              {circularDependencies.length > 0 && (
                <div className="bg-red-100 rounded-2xl border-2 border-red-300 p-5">
                  <h3 className="font-bold text-red-800 flex items-center gap-2 mb-4"><AlertCircle className="w-5 h-5" />ØªØ­Ø°ÙŠØ±: Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø¯Ø§Ø¦Ø±ÙŠØ© ({circularDependencies.length})</h3>
                  {circularDependencies.map((dep, idx) => (<div key={idx} className="p-3 bg-white rounded-xl border border-red-200 mb-2"><p className="text-sm text-red-700">{dep.description}</p></div>))}
                </div>
              )}
              {orphanAnalysis.total === 0 && (
                <div className="text-center py-16"><CheckCircle2 className="w-20 h-20 text-emerald-500 mx-auto mb-4" /><h3 className="text-xl font-bold text-emerald-800 mb-2">Ù…Ù…ØªØ§Ø²!</h3><p className="text-emerald-600">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</p></div>
              )}
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowOrphanDetection(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="flex items-center gap-2 px-6 py-2.5 bg-red-500 text-white rounded-xl font-bold"><AlertCircle className="w-5 h-5" />Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙŠØªÙŠÙ…Ø©</button>
            </div> </div> </div>
      )}
    </div>);
};

// Module 4.4: ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© (Compliance Calendar)
// Production-Ready Implementation - Beyond SAP GRC, MetricStream, ServiceNow GRC

// DATA MODELS

const OBLIGATION_SCHEDULES = [
  { id: 1, obligationId: 1, frequency: 'Monthly', dueRule: { type: 'EndOfMonth', offset: 0 }, gracePeriodDays: 5, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 365, escalationPolicyId: 1, status: 'Active', createdAt: '2024-01-01' },
  { id: 2, obligationId: 2, frequency: 'Monthly', dueRule: { type: 'FixedDay', day: 25 }, gracePeriodDays: 3, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 180, escalationPolicyId: 2, status: 'Active', createdAt: '2024-01-01' },
  { id: 3, obligationId: 5, frequency: 'Quarterly', dueRule: { type: 'EndOfQuarter', offset: 15 }, gracePeriodDays: 10, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 365, escalationPolicyId: 1, status: 'Active', createdAt: '2024-01-01' },
  { id: 4, obligationId: 7, frequency: 'Monthly', dueRule: { type: 'FixedDay', day: 20 }, gracePeriodDays: 5, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 90, escalationPolicyId: 3, status: 'Active', createdAt: '2024-01-01' },
  { id: 5, obligationId: 3, frequency: 'Quarterly', dueRule: { type: 'EndOfQuarter', offset: 0 }, gracePeriodDays: 7, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 365, escalationPolicyId: 1, status: 'Active', createdAt: '2024-01-01' },
  { id: 6, obligationId: 10, frequency: 'Annual', dueRule: { type: 'FixedDate', month: 1, day: 28 }, gracePeriodDays: 14, autoGenerate: true, evidenceRequired: true, evidenceValidityDays: 365, escalationPolicyId: 2, status: 'Active', createdAt: '2024-01-01' },
];

const ESCALATION_POLICIES = [
  {
    id: 1, name: 'Standard', levels: [
      { days: 3, action: 'Reminder', notifyRole: 'Owner' },
      { days: 7, action: 'Escalate', notifyRole: 'Manager' },
      { days: 14, action: 'CreateBreach', notifyRole: 'ComplianceHead' },
    ]
  },
  {
    id: 2, name: 'Critical', levels: [
      { days: 1, action: 'Reminder', notifyRole: 'Owner' },
      { days: 3, action: 'Escalate', notifyRole: 'Manager' },
      { days: 7, action: 'CreateBreach', notifyRole: 'ComplianceHead' },
      { days: 10, action: 'RegulatoryAlert', notifyRole: 'CEO' },
    ]
  },
  {
    id: 3, name: 'Flexible', levels: [
      { days: 5, action: 'Reminder', notifyRole: 'Owner' },
      { days: 14, action: 'Escalate', notifyRole: 'Manager' },
    ]
  },
];

const COMPLIANCE_TASKS = [
  { id: 1, scheduleId: 1, obligationId: 1, obligationCode: 'OBL-001', title: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ', period: '2025-01', periodType: 'Monthly', dueDate: '2025-01-31', graceEndDate: '2025-02-05', breachTriggerDate: '2025-02-05', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', reviewerId: 2, reviewerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', status: 'InProgress', priority: 'High', authority: 'SAMA', evidenceRequired: true, evidenceStatus: 'Uploaded', submittedAt: null, completedAt: null, escalationLevel: 0, extensionRequested: false },
  { id: 2, scheduleId: 2, obligationId: 2, obligationCode: 'OBL-002', title: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', period: '2025-01', periodType: 'Monthly', dueDate: '2025-01-25', graceEndDate: '2025-01-28', breachTriggerDate: '2025-01-28', ownerId: 2, ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', reviewerId: 3, reviewerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', status: 'Overdue', priority: 'Critical', authority: 'SAMA', evidenceRequired: true, evidenceStatus: 'UnderReview', submittedAt: null, completedAt: null, escalationLevel: 2, extensionRequested: true },
  { id: 3, scheduleId: 3, obligationId: 5, obligationCode: 'OBL-005', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', period: '2025-Q1', periodType: 'Quarterly', dueDate: '2025-02-15', graceEndDate: '2025-02-25', breachTriggerDate: '2025-02-25', ownerId: 3, ownerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', status: 'Open', priority: 'Medium', authority: 'NCA', evidenceRequired: true, evidenceStatus: 'PendingUpload', submittedAt: null, completedAt: null, escalationLevel: 0, extensionRequested: false },
  { id: 4, scheduleId: 4, obligationId: 7, obligationCode: 'OBL-007', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', period: '2025-01', periodType: 'Monthly', dueDate: '2025-01-20', graceEndDate: '2025-01-25', breachTriggerDate: '2025-01-25', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', reviewerId: 2, reviewerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', status: 'Completed', priority: 'High', authority: 'NCA', evidenceRequired: true, evidenceStatus: 'Accepted', submittedAt: '2025-01-18', completedAt: '2025-01-19', escalationLevel: 0, extensionRequested: false },
  { id: 5, scheduleId: 5, obligationId: 3, obligationCode: 'OBL-003', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', period: '2025-Q1', periodType: 'Quarterly', dueDate: '2025-03-31', graceEndDate: '2025-04-07', breachTriggerDate: '2025-04-07', ownerId: 2, ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', reviewerId: 3, reviewerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', status: 'Open', priority: 'High', authority: 'SAMA', evidenceRequired: true, evidenceStatus: 'PendingUpload', submittedAt: null, completedAt: null, escalationLevel: 0, extensionRequested: false },
  { id: 6, scheduleId: 6, obligationId: 10, obligationCode: 'OBL-010', title: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', period: '2025', periodType: 'Annual', dueDate: '2025-01-28', graceEndDate: '2025-02-11', breachTriggerDate: '2025-02-11', ownerId: 3, ownerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', status: 'Submitted', priority: 'Medium', authority: 'NDMO', evidenceRequired: true, evidenceStatus: 'UnderReview', submittedAt: '2025-01-25', completedAt: null, escalationLevel: 0, extensionRequested: false },
  { id: 7, scheduleId: 1, obligationId: 1, obligationCode: 'OBL-001', title: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - ÙØ¨Ø±Ø§ÙŠØ±', period: '2025-02', periodType: 'Monthly', dueDate: '2025-02-28', graceEndDate: '2025-03-05', breachTriggerDate: '2025-03-05', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', reviewerId: 2, reviewerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', status: 'Open', priority: 'High', authority: 'SAMA', evidenceRequired: true, evidenceStatus: 'PendingUpload', submittedAt: null, completedAt: null, escalationLevel: 0, extensionRequested: false },
  { id: 8, scheduleId: 2, obligationId: 2, obligationCode: 'OBL-002', title: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - ÙØ¨Ø±Ø§ÙŠØ±', period: '2025-02', periodType: 'Monthly', dueDate: '2025-02-25', graceEndDate: '2025-02-28', breachTriggerDate: '2025-02-28', ownerId: 2, ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', reviewerId: 3, reviewerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', status: 'Rejected', priority: 'Critical', authority: 'SAMA', evidenceRequired: true, evidenceStatus: 'Rejected', submittedAt: '2025-02-20', completedAt: null, escalationLevel: 0, extensionRequested: false, rejectReason: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙ‚ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' },
  { id: 9, scheduleId: 4, obligationId: 7, obligationCode: 'OBL-007', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ - ÙØ¨Ø±Ø§ÙŠØ±', period: '2025-02', periodType: 'Monthly', dueDate: '2025-02-20', graceEndDate: '2025-02-25', breachTriggerDate: '2025-02-25', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', reviewerId: 2, reviewerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', status: 'InProgress', priority: 'High', authority: 'NCA', evidenceRequired: true, evidenceStatus: 'Expired', submittedAt: null, completedAt: null, escalationLevel: 1, extensionRequested: false },
];

const TASK_EVIDENCE = [
  { id: 1, taskId: 1, fileName: 'ØªÙ‚Ø±ÙŠØ±_AML_ÙŠÙ†Ø§ÙŠØ±_Ù…Ø³ÙˆØ¯Ø©.docx', fileSize: '1.8 MB', fileType: 'docx', uploaderId: 1, uploaderName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', uploadedAt: '2025-01-25', status: 'Pending', expiresAt: '2026-01-25', reviewerId: null, reviewedAt: null, rejectComment: null },
  { id: 2, taskId: 2, fileName: 'Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡_Ø¹Ø§Ù„ÙŠØ©_Ø§Ù„Ù…Ø®Ø§Ø·Ø±.xlsx', fileSize: '2.4 MB', fileType: 'xlsx', uploaderId: 2, uploaderName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', uploadedAt: '2025-01-20', status: 'Pending', expiresAt: '2025-07-20', reviewerId: null, reviewedAt: null, rejectComment: null },
  { id: 3, taskId: 4, fileName: 'Ø³Ø¬Ù„_Ø§Ù„ÙˆØµÙˆÙ„_ÙŠÙ†Ø§ÙŠØ±.pdf', fileSize: '5.1 MB', fileType: 'pdf', uploaderId: 1, uploaderName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', uploadedAt: '2025-01-18', status: 'Approved', expiresAt: '2025-04-18', reviewerId: 2, reviewedAt: '2025-01-19', rejectComment: null },
  { id: 4, taskId: 6, fileName: 'Ø³ÙŠØ§Ø³Ø©_PDPL_v2.pdf', fileSize: '3.2 MB', fileType: 'pdf', uploaderId: 3, uploaderName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', uploadedAt: '2025-01-22', status: 'Rejected', expiresAt: '2026-01-22', reviewerId: 1, reviewedAt: '2025-01-23', rejectComment: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' },
  { id: 5, taskId: 6, fileName: 'Ø³ÙŠØ§Ø³Ø©_PDPL_v3_Ù…Ø¹Ø¯Ù„Ø©.pdf', fileSize: '3.5 MB', fileType: 'pdf', uploaderId: 3, uploaderName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', uploadedAt: '2025-01-24', status: 'Pending', expiresAt: '2026-01-24', reviewerId: null, reviewedAt: null, rejectComment: null },
  { id: 6, taskId: 3, fileName: 'Ø®Ø·Ø©_BCP_2025.pdf', fileSize: '8.2 MB', fileType: 'pdf', uploaderId: 3, uploaderName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', uploadedAt: '2025-01-10', status: 'Approved', expiresAt: '2026-01-10', reviewerId: 1, reviewedAt: '2025-01-11', rejectComment: null },
];

const REGULATORY_EVENTS = [
  { id: 1, title: 'Ø²ÙŠØ§Ø±Ø© ØªÙØªÙŠØ´ÙŠØ© Ù…Ù† SAMA', date: '2025-02-15', authority: 'SAMA', type: 'Inspection', status: 'Upcoming', impactedObligations: [1, 2, 3] },
  { id: 2, title: 'Ù…ÙˆØ¹Ø¯ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ', date: '2025-03-31', authority: 'SAMA', type: 'Reporting', status: 'Upcoming', impactedObligations: [3, 4] },
  { id: 3, title: 'ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', date: '2025-02-01', authority: 'NCA', type: 'Update', status: 'Active', impactedObligations: [5, 7, 8] },
];

// MOCK API SIGNATURES

const ComplianceAPI = {
  // GET /compliance/tasks?filter=...
  getTasks: async (filter) => ({ data: COMPLIANCE_TASKS.filter(t => !filter || t.status === filter), total: COMPLIANCE_TASKS.length }),

  // GET /compliance/calendar/summary
  getCalendarSummary: async () => ({
    dueThisMonth: COMPLIANCE_TASKS.filter(t => t.dueDate.startsWith('2025-01') && t.status !== 'Completed').length,
    overdue: COMPLIANCE_TASKS.filter(t => t.status === 'Overdue').length,
    evidencePending: TASK_EVIDENCE.filter(e => e.status === 'Pending').length,
    expiringEvidence: TASK_EVIDENCE.filter(e => { const d = new Date(e.expiresAt); const now = new Date(); return (d - now) / (1000 * 60 * 60 * 24) <= 30; }).length,
    highRiskOverdue: COMPLIANCE_TASKS.filter(t => t.status === 'Overdue' && t.priority === 'Critical').length,
  }),

  // POST /obligations/:id/schedules
  createSchedule: async (obligationId, scheduleData) => ({ success: true, scheduleId: Date.now() }),

  // GET /schedules/:id/tasks
  getScheduleTasks: async (scheduleId) => ({ data: COMPLIANCE_TASKS.filter(t => t.scheduleId === scheduleId) }),

  // POST /tasks/:id/evidence
  uploadEvidence: async (taskId, file) => ({ success: true, evidenceId: Date.now() }),

  // POST /tasks/:id/submit
  submitTask: async (taskId) => ({ success: true }),

  // GET /evidence/review-queue
  getEvidenceReviewQueue: async () => ({ data: TASK_EVIDENCE.filter(e => e.status === 'Pending') }),

  // POST /evidence/:id/approve
  approveEvidence: async (evidenceId, reviewerId) => ({ success: true }),

  // POST /evidence/:id/reject
  rejectEvidence: async (evidenceId, reviewerId, comment) => ({ success: comment.length >= 20 }),

  // POST /tasks/:id/escalate
  escalateTask: async (taskId) => ({ success: true }),
};

// VALIDATION HELPERS

const buildDueDateFromRule = (rule, period) => {
  const [year, periodPart] = period.split('-');
  let date = new Date();

  switch (rule.type) {
    case 'EndOfMonth': {
      const month = parseInt(periodPart) - 1;
      date = new Date(year, month + 1, 0);
      date.setDate(date.getDate() + (rule.offset || 0));
      break;
    }
    case 'FixedDay': {
      const month = parseInt(periodPart) - 1;
      date = new Date(year, month, rule.day);
      break;
    }
    case 'EndOfQuarter': {
      const quarter = parseInt(periodPart.replace('Q', ''));
      const lastMonth = quarter * 3;
      date = new Date(year, lastMonth, 0);
      date.setDate(date.getDate() + (rule.offset || 0));
      break;
    }
    case 'FixedDate': {
      date = new Date(year, rule.month - 1, rule.day);
      break;
    }
    default:
      break;
  }

  return date.toISOString().split('T')[0];
};

const canSubmitTask = (task, evidenceList) => {
  if (!task.evidenceRequired) return true;
  const taskEvidence = evidenceList.filter(e => e.taskId === task.id);
  const hasApprovedOrPending = taskEvidence.some(e => e.status === 'Approved' || e.status === 'Pending');
  return hasApprovedOrPending;
};

const canApproveEvidence = (evidence, reviewerId) => {
  // SoD: reviewer cannot be the uploader
  if (evidence.uploaderId === reviewerId) return { allowed: false, reason: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ø±Ø§ÙØ¹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯Ù„ÙŠÙ„Ù‡ - ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (SoD)' };
  return { allowed: true, reason: null };
};

const getDaysUntilDue = (dueDate) => {
  const due = new Date(dueDate);
  const now = new Date();
  return Math.ceil((due - now) / (1000 * 60 * 60 * 24));
};

const getTasksByTab = (tasks, tab, currentUserId = 1) => {
  const now = new Date();
  switch (tab) {
    case 'myTasks': return tasks.filter(t => t.ownerId === currentUserId && !['Completed', 'Submitted'].includes(t.status));
    case 'dueSoon': return tasks.filter(t => getDaysUntilDue(t.dueDate) <= 7 && getDaysUntilDue(t.dueDate) > 0 && t.status !== 'Completed');
    case 'overdue': return tasks.filter(t => t.status === 'Overdue' || getDaysUntilDue(t.dueDate) < 0);
    case 'submitted': return tasks.filter(t => t.status === 'Submitted');
    case 'rejected': return tasks.filter(t => t.status === 'Rejected');
    default: return tasks;
  }
};

// COMPLIANCE CALENDAR COMPONENT

// Module 4.4: ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© - World-Class Edition
// Compliance Calendar & Regulatory Obligations Scheduler
// Features: Task Inbox, Calendar Views, Gantt Chart, Evidence Review, 
//           Escalation Engine, Inspection Readiness Dashboard

const ComplianceCalendar = () => {
  // STATE MANAGEMENT
  const [activeTab, setActiveTab] = useState('inbox');
  const [calendarView, setCalendarView] = useState('month');
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedTask, setSelectedTask] = useState(null);
  const [showTaskModal, setShowTaskModal] = useState(false);
  const [showEvidenceModal, setShowEvidenceModal] = useState(false);
  const [showEscalationModal, setShowEscalationModal] = useState(false);
  const [showDelegationModal, setShowDelegationModal] = useState(false);
  const [showBulkModal, setShowBulkModal] = useState(false);
  const [showScheduleSetup, setShowScheduleSetup] = useState(false);
  const [scheduleForm, setScheduleForm] = useState({
    obligationId: '', frequency: 'Monthly', startDate: '', endDate: '',
    ownerId: '', reviewerId: '', reminderDays: 7, autoGenerate: true,
    graceperiodDays: 3, escalationEnabled: true, escalationDays: 2
  });
  const [selectedTasks, setSelectedTasks] = useState([]);
  const [filterAuthority, setFilterAuthority] = useState('');
  const [filterPriority, setFilterPriority] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterOwner, setFilterOwner] = useState('');
  const [searchQuery, setSearchQuery] = useState('');
  const [ganttZoom, setGanttZoom] = useState('month');

  // Current User
  const CURRENT_USER = { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' };

  // SAMPLE DATA - TASKS
  const [tasks, setTasks] = useState([
    {
      id: 1, code: 'OBL-001', title: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ',
      description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨',
      authorityId: 1, authorityCode: 'SAMA', frameworkCode: 'SAMA-AML',
      obligationRef: 'SAMA-AML-3.1', controlRef: 'CTRL-001', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ',
      reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', priority: 'High', frequency: 'Monthly',
      period: 'ÙŠÙ†Ø§ÙŠØ± 2025', periodKey: '2025-01',
      dueDate: '2025-01-31', gracePeriodEnd: '2025-02-05', violationDate: '2025-02-05',
      status: 'InProgress', evidenceStatus: 'Uploaded', evidenceId: 1, evidenceFileName: 'aml_report_jan.pdf',
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['AML', 'Monthly', 'Critical'],
      createdAt: '2025-01-01', updatedAt: '2025-01-28'
    },
    {
      id: 2, code: 'OBL-002', title: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - ÙØ¨Ø±Ø§ÙŠØ±',
      description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
      authorityId: 1, authorityCode: 'SAMA', frameworkCode: 'SAMA-AML',
      obligationRef: 'SAMA-AML-3.1', controlRef: 'CTRL-001', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ',
      reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', priority: 'High', frequency: 'Monthly',
      period: 'ÙØ¨Ø±Ø§ÙŠØ± 2025', periodKey: '2025-02',
      dueDate: '2025-02-28', gracePeriodEnd: '2025-03-05', violationDate: '2025-03-05',
      status: 'Open', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [1], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['AML', 'Monthly', 'Critical'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },
    {
      id: 3, code: 'OBL-007', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ - ÙØ¨Ø±Ø§ÙŠØ±',
      description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©',
      authorityId: 3, authorityCode: 'NCA', frameworkCode: 'NCA-ECC',
      obligationRef: 'NCA-ECC-3.1', controlRef: 'CTRL-005', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ',
      reviewerId: 3, reviewerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', priority: 'High', frequency: 'Monthly',
      period: 'ÙØ¨Ø±Ø§ÙŠØ± 2025', periodKey: '2025-02',
      dueDate: '2025-02-20', gracePeriodEnd: '2025-02-25', violationDate: '2025-02-25',
      status: 'InProgress', evidenceStatus: 'Expired', evidenceId: 3, evidenceFileName: 'access_logs_feb.xlsx',
      escalationLevel: 1, escalationHistory: [{ level: 1, date: '2025-02-21', to: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' }],
      dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['NCA', 'Security', 'Monthly'],
      createdAt: '2025-02-01', updatedAt: '2025-02-21'
    },
    {
      id: 4, code: 'OBL-010', title: 'ØªÙ‚Ø±ÙŠØ± Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ',
      description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Ø¹Ù† Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
      authorityId: 4, authorityCode: 'SDAIA', frameworkCode: 'SDAIA-PDPL',
      obligationRef: 'PDPL-2.1', controlRef: 'CTRL-008', ownerId: 4, ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
      reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', priority: 'Medium', frequency: 'Quarterly',
      period: 'Q1-2025', periodKey: 'Q1-2025',
      dueDate: '2025-03-31', gracePeriodEnd: '2025-04-07', violationDate: '2025-04-07',
      status: 'Open', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['PDPL', 'Quarterly', 'Privacy'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },
    {
      id: 5, code: 'OBL-015', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø³Ù†ÙˆÙŠ', description: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©',
      authorityId: 3, authorityCode: 'NCA', frameworkCode: 'NCA-ECC',
      obligationRef: 'NCA-ECC-4.1', controlRef: 'CTRL-010', ownerId: 3, ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
      reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', priority: 'Critical', frequency: 'Yearly',
      period: '2025', periodKey: '2025',
      dueDate: '2025-06-30', gracePeriodEnd: '2025-07-15', violationDate: '2025-07-15',
      status: 'NotStarted', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: 'ÙŠØªØ·Ù„Ø¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ', tags: ['NCA', 'PenTest', 'Annual', 'Critical'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },
    {
      id: 6, code: 'OBL-003', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ',
      description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª',
      authorityId: 2, authorityCode: 'CMA', frameworkCode: 'CMA-CGR',
      obligationRef: 'CMA-CGR-1.1', controlRef: 'CTRL-003', ownerId: 5, ownerName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ',
      reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', priority: 'High', frequency: 'Quarterly',
      period: 'Q1-2025', periodKey: 'Q1-2025',
      dueDate: '2025-03-15', gracePeriodEnd: '2025-03-20', violationDate: '2025-03-20',
      status: 'InProgress', evidenceStatus: 'Uploaded', evidenceId: 5, evidenceFileName: 'governance_q1.pdf',
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['CMA', 'Governance', 'Quarterly'],
      createdAt: '2025-01-01', updatedAt: '2025-02-28'
    },
    {
      id: 7, code: 'OBL-020', title: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      description: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      authorityId: 3, authorityCode: 'NCA', frameworkCode: 'NCA-ECC',
      obligationRef: 'NCA-ECC-1.1', controlRef: 'CTRL-001', ownerId: 3, ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
      reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', priority: 'High', frequency: 'Yearly', period: '2025', periodKey: '2025',
      dueDate: '2025-04-30', gracePeriodEnd: '2025-05-15', violationDate: '2025-05-15',
      status: 'InProgress', evidenceStatus: 'UnderReview', evidenceId: 7, evidenceFileName: 'cyber_policy_v2.pdf',
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['NCA', 'Policy', 'Annual'],
      createdAt: '2025-01-01', updatedAt: '2025-03-01'
    },
    {
      id: 8, code: 'OBL-025', title: 'ØªØ¯Ø±ÙŠØ¨ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ',
      description: 'ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
      authorityId: 1, authorityCode: 'SAMA', frameworkCode: 'SAMA-AML',
      obligationRef: 'SAMA-AML-4.1', controlRef: 'CTRL-012', ownerId: 2, ownerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯',
      reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', priority: 'Medium', frequency: 'Yearly',
      period: '2025', periodKey: '2025',
      dueDate: '2025-12-31', gracePeriodEnd: '2026-01-15', violationDate: '2026-01-15',
      status: 'NotStarted', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['SAMA', 'Training', 'Annual'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },
    {
      id: 9, code: 'OBL-030', title: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ',
      description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø¥Ù‚Ø±Ø§Ø± Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©',
      authorityId: 5, authorityCode: 'ZATCA', frameworkCode: 'ZATCA-VAT',
      obligationRef: 'VAT-1.1', controlRef: 'CTRL-015', ownerId: 6, ownerName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ',
      reviewerId: 5, reviewerName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', priority: 'Critical', frequency: 'Quarterly',
      period: 'Q1-2025', periodKey: 'Q1-2025',
      dueDate: '2025-04-30', gracePeriodEnd: '2025-05-05', violationDate: '2025-05-05',
      status: 'Open', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [], blockedBy: [], completedDate: null, submittedDate: null,
      notes: '', tags: ['ZATCA', 'VAT', 'Quarterly', 'Critical'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },
    {
      id: 10, code: 'OBL-035', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„',
      description: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ Ù…Ù† Ø§Ù„ÙƒÙˆØ§Ø±Ø«',
      authorityId: 1, authorityCode: 'SAMA', frameworkCode: 'SAMA-BCM',
      obligationRef: 'BCM-2.1', controlRef: 'CTRL-020', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ',
      reviewerId: 3, reviewerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', priority: 'High', frequency: 'Yearly', period: '2025', periodKey: '2025',
      dueDate: '2025-09-30', gracePeriodEnd: '2025-10-15', violationDate: '2025-10-15',
      status: 'NotStarted', evidenceStatus: 'PendingUpload', evidenceId: null, evidenceFileName: null,
      escalationLevel: 0, escalationHistory: [], dependencies: [5], blockedBy: [], completedDate: null, submittedDate: null,
      notes: 'ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', tags: ['SAMA', 'BCM', 'Annual'],
      createdAt: '2025-01-01', updatedAt: '2025-01-01'
    },]);
  // ESCALATION RULES
  const ESCALATION_RULES = [
    { level: 1, name: 'ØªÙ†Ø¨ÙŠÙ‡ Ø£ÙˆÙ„', daysBeforeDue: 7, notifyTo: 'Owner', action: 'Email' },
    { level: 2, name: 'ØªØµØ¹ÙŠØ¯ Ù„Ù„Ù…Ø¯ÙŠØ±', daysBeforeDue: 3, notifyTo: 'Manager', action: 'Email+SMS' },
    { level: 3, name: 'ØªØµØ¹ÙŠØ¯ Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', daysAfterDue: 1, notifyTo: 'Executive', action: 'Email+SMS+Call' },
    { level: 4, name: 'ØªØµØ¹ÙŠØ¯ Ù„Ù„Ø¬Ù†Ø©', daysAfterDue: 3, notifyTo: 'Committee', action: 'Meeting' },
  ];

  // INSPECTION CHECKLIST
  const [inspectionChecklist, setInspectionChecklist] = useState([
    { id: 1, category: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', item: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ù…Ø­Ø¯Ø«Ø©', completed: true, evidenceId: 1 },
    { id: 2, category: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', item: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ø¹ØªÙ…Ø¯Ø©', completed: true, evidenceId: 2 },
    { id: 3, category: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', item: 'Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø´ÙˆØ±Ø©', completed: false, evidenceId: null },
    { id: 4, category: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', item: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù…ÙƒØªÙ…Ù„Ø©', completed: true, evidenceId: 3 },
    { id: 5, category: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', item: 'ØªÙ‚Ø§Ø±ÙŠØ± STR Ù…Ø±Ø³Ù„Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª', completed: true, evidenceId: 4 },
    { id: 6, category: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', item: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ù…ÙˆØ«Ù‚Ø©', completed: false, evidenceId: null },
    { id: 7, category: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨', item: 'ØªØ¯Ø±ÙŠØ¨ AML Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯', completed: true, evidenceId: 5 },
    { id: 8, category: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨', item: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ', completed: false, evidenceId: null },
    { id: 9, category: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', item: 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ø­ÙÙˆØ¸Ø©', completed: true, evidenceId: 6 },
    { id: 10, category: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', item: 'Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø®ØªØ¨Ø±Ø©', completed: true, evidenceId: 7 },
    { id: 11, category: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', item: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ø­Ø¯Ø«', completed: false, evidenceId: null },
    { id: 12, category: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', item: 'Ù…Ø­Ø§Ø¶Ø± Ù„Ø¬Ù†Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', completed: true, evidenceId: 8 },
  ]);

  // COMPUTED VALUES
  const today = new Date();
  const todayStr = today.toISOString().split('T')[0];

  const getDaysUntilDue = (dueDate) => {
    if (!dueDate) return null;
    const due = new Date(dueDate);
    return Math.ceil((due - today) / (1000 * 60 * 60 * 24));
  };

  const getTaskUrgency = (task) => {
    const days = getDaysUntilDue(task.dueDate);
    if (days === null) return 'normal';
    if (days < 0) return 'overdue';
    if (days <= 3) return 'critical';
    if (days <= 7) return 'urgent';
    if (days <= 14) return 'warning';
    return 'normal';
  };

  const stats = useMemo(() => {
    const overdue = tasks.filter(t => getDaysUntilDue(t.dueDate) < 0 && t.status !== 'Completed').length;
    const dueSoon = tasks.filter(t => {
      const days = getDaysUntilDue(t.dueDate);
      return days >= 0 && days <= 7 && t.status !== 'Completed';
    }).length;
    const inProgress = tasks.filter(t => t.status === 'InProgress').length;
    const pendingReview = tasks.filter(t => t.evidenceStatus === 'UnderReview').length;
    const completed = tasks.filter(t => t.status === 'Completed').length;
    const escalated = tasks.filter(t => t.escalationLevel > 0).length;
    const total = tasks.length;
    const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

    return { overdue, dueSoon, inProgress, pendingReview, completed, escalated, total, completionRate };
  }, [tasks]);

  const filteredTasks = useMemo(() => {
    return tasks.filter(t => {
      const matchSearch = !searchQuery ||
        t.title?.toLowerCase().includes(searchQuery.toLowerCase()) ||
        t.code?.toLowerCase().includes(searchQuery.toLowerCase());
      const matchAuthority = !filterAuthority || t.authorityCode === filterAuthority;
      const matchPriority = !filterPriority || t.priority === filterPriority;
      const matchStatus = !filterStatus || t.status === filterStatus;
      const matchOwner = !filterOwner || t.ownerId === parseInt(filterOwner);
      return matchSearch && matchAuthority && matchPriority && matchStatus && matchOwner;
    });
  }, [tasks, searchQuery, filterAuthority, filterPriority, filterStatus, filterOwner]);

  const inspectionReadiness = useMemo(() => {
    const total = inspectionChecklist.length;
    const completed = inspectionChecklist.filter(i => i.completed).length;
    const percentage = Math.round((completed / total) * 100);
    const byCategory = {};
    inspectionChecklist.forEach(item => {
      if (!byCategory[item.category]) {
        byCategory[item.category] = { total: 0, completed: 0 };
      }
      byCategory[item.category].total++;
      if (item.completed) byCategory[item.category].completed++;
    });
    return { total, completed, percentage, byCategory };
  }, [inspectionChecklist]);

  // CONFIGURATIONS
  const PRIORITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', color: 'red', bg: 'bg-red-100', text: 'text-red-700', border: 'border-red-300' },
    High: { label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', bg: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-300' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', bg: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-300' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', color: 'green', bg: 'bg-green-100', text: 'text-green-700', border: 'border-green-300' },
  };

  const STATUS_CONFIG = {
    NotStarted: { label: 'Ù„Ù… ÙŠØ¨Ø¯Ø£', icon: Clock, bg: 'bg-slate-100', text: 'text-slate-600' },
    Open: { label: 'Ù…ÙØªÙˆØ­', icon: FolderOpen, bg: 'bg-blue-100', text: 'text-blue-700' },
    InProgress: { label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Play, bg: 'bg-indigo-100', text: 'text-indigo-700' },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye, bg: 'bg-purple-100', text: 'text-purple-700' },
    Completed: { label: 'Ù…ÙƒØªÙ…Ù„', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
    Overdue: { label: 'Ù…ØªØ£Ø®Ø±', icon: AlertTriangle, bg: 'bg-red-100', text: 'text-red-700' },
  };

  const EVIDENCE_STATUS_CONFIG = {
    PendingUpload: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±ÙØ¹', icon: Upload, bg: 'bg-slate-100', text: 'text-slate-600' },
    Uploaded: { label: 'ØªÙ… Ø§Ù„Ø±ÙØ¹', icon: FileCheck, bg: 'bg-blue-100', text: 'text-blue-700' },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye, bg: 'bg-amber-100', text: 'text-amber-700' },
    Accepted: { label: 'Ù…Ù‚Ø¨ÙˆÙ„', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
    Rejected: { label: 'Ù…Ø±ÙÙˆØ¶', icon: XCircle, bg: 'bg-red-100', text: 'text-red-700' },
    Expired: { label: 'Ù…Ù†ØªÙ‡ÙŠ', icon: AlertTriangle, bg: 'bg-orange-100', text: 'text-orange-700' },
  };

  const AUTHORITY_COLORS = {
    SAMA: { bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700' },
    CMA: { bg: 'bg-blue-500', light: 'bg-blue-100', text: 'text-blue-700' },
    NCA: { bg: 'bg-purple-500', light: 'bg-purple-100', text: 'text-purple-700' },
    SDAIA: { bg: 'bg-indigo-500', light: 'bg-indigo-100', text: 'text-indigo-700' },
    ZATCA: { bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700' },
  };

  const FREQUENCY_CONFIG = {
    Daily: { label: 'ÙŠÙˆÙ…ÙŠ', days: 1 }, Weekly: { label: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', days: 7 }, Monthly: { label: 'Ø´Ù‡Ø±ÙŠ', days: 30 },
    Quarterly: { label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', days: 90 }, Yearly: { label: 'Ø³Ù†ÙˆÙŠ', days: 365 },
  };

  const TEAM_MEMBERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer', avatar: 'Ø£' },
    { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Evidence Reviewer', avatar: 'Ù' },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'IT Security', avatar: 'Ø®' },
    { id: 4, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Data Protection', avatar: 'Ù†' },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Governance', avatar: 'Ø³' },
    { id: 6, name: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ', role: 'Tax Compliance', avatar: 'Ù…' },
  ];

  // HANDLERS
  const handleUploadEvidence = (taskId) => {
    setTasks(tasks.map(t => t.id === taskId ? {
      ...t,
      evidenceStatus: 'Uploaded', evidenceFileName: 'evidence_' + Date.now() + '.pdf',
      updatedAt: todayStr
    } : t));
    alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
  };

  const handleSubmitTask = (taskId) => {
    const task = tasks.find(t => t.id === taskId);
    if (!task) return;
    if (task.evidenceStatus !== 'Uploaded' && task.evidenceStatus !== 'Accepted') {
      alert('ÙŠØ¬Ø¨ Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
      return;
    }
    setTasks(tasks.map(t => t.id === taskId ? {
      ...t,
      status: 'UnderReview', evidenceStatus: 'UnderReview', submittedDate: todayStr,
      updatedAt: todayStr
    } : t));
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
  };

  const handleRequestExtension = (taskId) => {
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±.');
  };

  const handleEscalate = (taskId, level) => {
    setTasks(tasks.map(t => {
      if (t.id === taskId) {
        const newHistory = [...t.escalationHistory, {
          level: level, date: todayStr,
          to: ESCALATION_RULES.find(r => r.level === level)?.notifyTo || 'Unknown'
        }];
        return { ...t, escalationLevel: level, escalationHistory: newHistory, updatedAt: todayStr };
      }
      return t;
    }));
    alert(`ØªÙ… Ø§Ù„ØªØµØ¹ÙŠØ¯ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${level}`);
  };

  const handleApproveEvidence = (taskId) => {
    setTasks(tasks.map(t => t.id === taskId ? {
      ...t,
      evidenceStatus: 'Accepted', status: 'Completed', completedDate: todayStr,
      updatedAt: todayStr
    } : t));
    setShowEvidenceModal(false);
    alert('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙˆØ¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©');
  };

  const handleRejectEvidence = (taskId, reason) => {
    if (!reason || reason.length < 20) {
      alert('ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (20 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)');
      return;
    }
    setTasks(tasks.map(t => t.id === taskId ? {
      ...t,
      evidenceStatus: 'Rejected', status: 'InProgress',
      updatedAt: todayStr
    } : t));
    setShowEvidenceModal(false);
    alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„');
  };

  const handleDelegate = (taskId, newOwnerId) => {
    const newOwner = TEAM_MEMBERS.find(m => m.id === newOwnerId);
    if (!newOwner) return;
    setTasks(tasks.map(t => t.id === taskId ? {
      ...t,
      ownerId: newOwnerId, ownerName: newOwner.name,
      updatedAt: todayStr
    } : t));
    setShowDelegationModal(false);
    alert(`ØªÙ… ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ ${newOwner.name}`);
  };

  const handleBulkAction = (action) => {
    if (selectedTasks.length === 0) {
      alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹');
      return;
    }

    switch (action) {
      case 'submit':
        setTasks(tasks.map(t => selectedTasks.includes(t.id) && t.evidenceStatus === 'Uploaded' ?
          { ...t, status: 'UnderReview', evidenceStatus: 'UnderReview', submittedDate: todayStr, updatedAt: todayStr } : t
        ));
        alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${selectedTasks.length} Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©`);
        break;
      case 'escalate':
        setTasks(tasks.map(t => selectedTasks.includes(t.id) ?
          { ...t, escalationLevel: Math.min(t.escalationLevel + 1, 4), updatedAt: todayStr } : t
        ));
        alert(`ØªÙ… ØªØµØ¹ÙŠØ¯ ${selectedTasks.length} Ù…Ù‡Ù…Ø©`);
        break;
      case 'delegate':
        setShowDelegationModal(true);
        return;
      default:
        break;
    }
    setSelectedTasks([]);
    setShowBulkModal(false);
  };

  const toggleTaskSelection = (taskId) => {
    setSelectedTasks(prev =>
      prev.includes(taskId) ? prev.filter(id => id !== taskId) : [...prev, taskId]
    );
  };

  const toggleAllTasks = () => {
    if (selectedTasks.length === filteredTasks.length) {
      setSelectedTasks([]);
    } else {
      setSelectedTasks(filteredTasks.map(t => t.id));
    }
  };

  const toggleChecklistItem = (itemId) => {
    setInspectionChecklist(prev => prev.map(item =>
      item.id === itemId ? { ...item, completed: !item.completed } : item
    ));
  };

  // Calendar Navigation
  const navigateMonth = (direction) => {
    const newDate = new Date(currentDate);
    newDate.setMonth(newDate.getMonth() + direction);
    setCurrentDate(newDate);
  };

  const getMonthDays = () => {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDay = firstDay.getDay();

    const days = [];
    // Previous month days
    const prevMonthLastDay = new Date(year, month, 0).getDate();
    for (let i = startingDay - 1; i >= 0; i--) {
      days.push({ day: prevMonthLastDay - i, currentMonth: false, date: new Date(year, month - 1, prevMonthLastDay - i) });
    }
    // Current month days
    for (let i = 1; i <= daysInMonth; i++) {
      days.push({ day: i, currentMonth: true, date: new Date(year, month, i) });
    }
    // Next month days
    const remainingDays = 42 - days.length;
    for (let i = 1; i <= remainingDays; i++) {
      days.push({ day: i, currentMonth: false, date: new Date(year, month + 1, i) });
    }
    return days;
  };

  const getTasksForDate = (date) => {
    const dateStr = date.toISOString().split('T')[0];
    return tasks.filter(t => t.dueDate === dateStr);
  };

  const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  const weekDays = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];

  // TABS CONFIGURATION
  const tabs = [
    { id: 'inbox', label: 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ø§Ù…', icon: Inbox, count: stats.total - stats.completed },
    { id: 'calendar', label: 'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', icon: Calendar, count: null },
    { id: 'gantt', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ', icon: BarChart3, count: null },
    { id: 'evidence', label: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FileCheck, count: stats.pendingReview },
    { id: 'escalation', label: 'Ø§Ù„ØªØµØ¹ÙŠØ¯ ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', icon: AlertTriangle, count: stats.escalated },
    { id: 'readiness', label: 'Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„ØªÙØªÙŠØ´', icon: ClipboardCheck, count: null },
  ];

  // RENDER
  return (
    <div className="space-y-6">
      {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          HEADER
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
            <Calendar className="w-7 h-7 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-slate-900">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</h1>
            <p className="text-slate-500">Compliance Calendar & Regulatory Obligations Scheduler - Module 4.4</p>
          </div> </div>
        <div className="flex items-center gap-3">
          {selectedTasks.length > 0 && (
            <button onClick={() => setShowBulkModal(true)}
              className="flex items-center gap-2 px-4 py-2.5 bg-indigo-100 text-indigo-700 rounded-xl font-bold">
              <CheckSquare className="w-5 h-5" />
              Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ© ({selectedTasks.length})
            </button>
          )}
          <button onClick={() => setShowScheduleSetup(true)} className="flex items-center gap-2 px-4 py-2.5 border-2 border-indigo-200 bg-indigo-50 rounded-xl text-indigo-700 hover:bg-indigo-100 font-bold transition-all">
            <Settings className="w-5 h-5" />Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
          </button>
          <button className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50">
            <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ±
          </button> </div> </div>
      {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STATS CARDS
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div className="grid grid-cols-8 gap-3">
        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-4 text-white">
          <div className="flex items-center justify-between mb-2">
            <Target className="w-6 h-6 text-white/80" />
            <span className="text-3xl font-bold">{stats.completionRate}%</span>
          </div>
          <p className="text-indigo-100 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
          <div className="mt-2 h-2 bg-white/20 rounded-full overflow-hidden">
            <div className="h-full bg-white rounded-full" style={{ width: `${stats.completionRate}%` }}></div>
          </div> </div>
        <div className={`rounded-2xl p-4 border-2 ${stats.overdue > 0 ? 'bg-red-50 border-red-300 animate-pulse' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <AlertTriangle className={`w-5 h-5 ${stats.overdue > 0 ? 'text-red-500' : 'text-slate-400'}`} />
            <p className="text-xs text-slate-500">Ù…ØªØ£Ø®Ø±Ø©</p>
          </div>
          <p className={`text-2xl font-bold ${stats.overdue > 0 ? 'text-red-600' : 'text-slate-400'}`}>{stats.overdue}</p>
        </div>

        <div className={`rounded-2xl p-4 border-2 ${stats.dueSoon > 0 ? 'bg-amber-50 border-amber-300' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <Clock className="w-5 h-5 text-amber-500" />
            <p className="text-xs text-slate-500">ØªØ³ØªØ­Ù‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
          </div>
          <p className="text-2xl font-bold text-amber-600">{stats.dueSoon}</p>
          <p className="text-[10px] text-amber-500">Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-indigo-200">
          <div className="flex items-center gap-2 mb-1">
            <Play className="w-5 h-5 text-indigo-500" />
            <p className="text-xs text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
          </div>
          <p className="text-2xl font-bold text-indigo-600">{stats.inProgress}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-purple-200">
          <div className="flex items-center gap-2 mb-1">
            <Eye className="w-5 h-5 text-purple-500" />
            <p className="text-xs text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
          </div>
          <p className="text-2xl font-bold text-purple-600">{stats.pendingReview}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-emerald-200">
          <div className="flex items-center gap-2 mb-1">
            <CheckCircle2 className="w-5 h-5 text-emerald-500" />
            <p className="text-xs text-slate-500">Ù…ÙƒØªÙ…Ù„Ø©</p>
          </div>
          <p className="text-2xl font-bold text-emerald-600">{stats.completed}</p>
        </div>

        <div className={`rounded-2xl p-4 border-2 ${stats.escalated > 0 ? 'bg-orange-50 border-orange-300' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <TrendingUp className="w-5 h-5 text-orange-500" />
            <p className="text-xs text-slate-500">Ù…ÙØµØ¹Ù‘Ø¯Ø©</p>
          </div>
          <p className="text-2xl font-bold text-orange-600">{stats.escalated}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-slate-200">
          <div className="flex items-center gap-2 mb-1">
            <FolderOpen className="w-5 h-5 text-slate-500" />
            <p className="text-xs text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
          </div>
          <p className="text-2xl font-bold text-slate-700">{stats.total}</p>
        </div> </div>
      {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          MAIN CONTENT
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200 overflow-x-auto">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-5 py-4 font-bold transition-all border-b-2 whitespace-nowrap ${activeTab === tab.id
                ? 'text-indigo-600 border-indigo-500 bg-indigo-50'
                : 'text-slate-500 border-transparent hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count !== null && tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-indigo-500 text-white' : 'bg-slate-200 text-slate-600'
                  }`}>{tab.count}</span>
              )}
            </button>
          ))}
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: INBOX (ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ø§Ù…)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'inbox' && (
          <div className="p-6">
            <div className="flex flex-wrap items-center gap-3 mb-6">
              <div className="flex-1 min-w-[250px] relative">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500" />
              </div>
              <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl min-w-[150px]">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                <option value="SAMA">SAMA</option>
                <option value="CMA">CMA</option>
                <option value="NCA">NCA</option>
                <option value="SDAIA">SDAIA</option>
                <option value="ZATCA">ZATCA</option>
              </select>
              <select value={filterPriority} onChange={(e) => setFilterPriority(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl min-w-[150px]">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                {Object.entries(PRIORITY_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
              </select>
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl min-w-[150px]">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                {Object.entries(STATUS_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
              </select>
              <select value={filterOwner} onChange={(e) => setFilterOwner(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl min-w-[150px]">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</option>
                {TEAM_MEMBERS.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
              </select>
            </div>

            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="bg-slate-50 border-b-2 border-slate-200">
                    <th className="px-3 py-3 text-center w-10">
                      <input type="checkbox" checked={selectedTasks.length === filteredTasks.length && filteredTasks.length > 0}
                        onChange={toggleAllTasks} className="w-4 h-4 rounded" />
                    </th>
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„ÙØªØ±Ø©/Ø§Ù„Ø¯ÙˆØ±Ø©</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700 w-48">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr> </thead>
                <tbody>
                  {filteredTasks.map(task => {
                    const priorityCfg = PRIORITY_CONFIG[task.priority] || PRIORITY_CONFIG.Medium;
                    const statusCfg = STATUS_CONFIG[task.status] || STATUS_CONFIG.Open;
                    const evidenceCfg = EVIDENCE_STATUS_CONFIG[task.evidenceStatus] || EVIDENCE_STATUS_CONFIG.PendingUpload;
                    const authColor = AUTHORITY_COLORS[task.authorityCode] || { bg: 'bg-slate-500', light: 'bg-slate-100', text: 'text-slate-700' };
                    const daysUntil = getDaysUntilDue(task.dueDate);
                    const urgency = getTaskUrgency(task);
                    const StatusIcon = statusCfg.icon;
                    const EvidenceIcon = evidenceCfg.icon;

                    return (
                      <tr key={task.id} className={`border-b border-slate-100 hover:bg-slate-50 ${urgency === 'overdue' ? 'bg-red-50' : ''}`}>
                        <td className="px-3 py-4 text-center">
                          <input type="checkbox" checked={selectedTasks.includes(task.id)}
                            onChange={() => toggleTaskSelection(task.id)} className="w-4 h-4 rounded" />
                        </td>
                        <td className="px-4 py-4">
                          <div className="flex items-start gap-3">
                            <div className={`w-10 h-10 rounded-xl ${authColor.bg} flex items-center justify-center text-white font-bold text-xs shrink-0`}>
                              {task.authorityCode?.substring(0, 2)}
                            </div>
                            <div className="min-w-0">
                              <div className="flex items-center gap-2 mb-1">
                                <span className="font-mono text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{task.code}</span>
                                {task.escalationLevel > 0 && (
                                  <span className="flex items-center gap-1 px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-bold">
                                    <TrendingUp className="w-3 h-3" />ØªØµØ¹ÙŠØ¯ {task.escalationLevel}
                                  </span>
                                )}
                              </div>
                              <h4 className="font-bold text-slate-800 text-sm">{task.title}</h4>
                              <p className="text-xs text-slate-500 mt-0.5">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {task.ownerName}</p>
                            </div> </div> </td>
                        <td className="px-3 py-4 text-center">
                          <div className="inline-flex flex-col items-center">
                            <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${authColor.light} ${authColor.text}`}>
                              {task.period}
                            </span>
                            <span className="text-[10px] text-slate-400 mt-1">{FREQUENCY_CONFIG[task.frequency]?.label}</span>
                          </div> </td>
                        <td className="px-3 py-4 text-center">
                          <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${authColor.light} ${authColor.text}`}>
                            {task.authorityCode}
                          </span> </td>
                        <td className="px-3 py-4 text-center">
                          <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${priorityCfg.bg} ${priorityCfg.text}`}>
                            {priorityCfg.label}
                          </span> </td>
                        <td className="px-4 py-4 text-center">
                          <div className="space-y-1">
                            <div className="flex items-center justify-center gap-1 text-xs">
                              <span className="text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span>
                              <span className="font-bold text-slate-700">{task.dueDate}</span>
                            </div>
                            <div className="flex items-center justify-center gap-1 text-xs">
                              <span className="text-slate-500">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ù…Ø§Ø­:</span>
                              <span className="text-slate-600">{task.gracePeriodEnd}</span>
                            </div>
                            <div className="flex items-center justify-center gap-1 text-xs">
                              <span className="text-slate-500">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</span>
                              <span className="text-red-600">{task.violationDate}</span>
                            </div>
                            {daysUntil !== null && task.status !== 'Completed' && (
                              <span className={`inline-block px-2 py-1 rounded-lg text-xs font-bold mt-1 ${urgency === 'overdue' ? 'bg-red-500 text-white' :
                                urgency === 'critical' ? 'bg-red-100 text-red-700' :
                                  urgency === 'urgent' ? 'bg-orange-100 text-orange-700' :
                                    urgency === 'warning' ? 'bg-amber-100 text-amber-700' :
                                      'bg-emerald-100 text-emerald-700'
                                }`}>
                                {daysUntil < 0 ? `Ù…ØªØ£Ø®Ø± ${Math.abs(daysUntil)} ÙŠÙˆÙ…` : daysUntil === 0 ? 'Ø§Ù„ÙŠÙˆÙ…!' : `${daysUntil} ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ`}
                              </span>
                            )}
                          </div> </td>
                        <td className="px-3 py-4 text-center">
                          <span className={`inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs font-bold ${statusCfg.bg} ${statusCfg.text}`}>
                            <StatusIcon className="w-3.5 h-3.5" />
                            {statusCfg.label}
                          </span> </td>
                        <td className="px-3 py-4 text-center">
                          <span className={`inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs font-bold ${evidenceCfg.bg} ${evidenceCfg.text}`}>
                            <EvidenceIcon className="w-3.5 h-3.5" />
                            {evidenceCfg.label}
                          </span> </td>
                        <td className="px-4 py-4">
                          <div className="flex flex-wrap items-center justify-center gap-1">
                            <button onClick={() => handleUploadEvidence(task.id)}
                              className="flex items-center gap-1 px-2 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold hover:bg-blue-200">
                              <Upload className="w-3.5 h-3.5" />Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„
                            </button>
                            <button onClick={() => handleSubmitTask(task.id)}
                              disabled={task.evidenceStatus !== 'Uploaded'}
                              className={`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-bold ${task.evidenceStatus === 'Uploaded' ? 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200' : 'bg-slate-100 text-slate-400 cursor-not-allowed'
                                }`}>
                              <Send className="w-3.5 h-3.5" />Ø¥Ø±Ø³Ø§Ù„
                            </button>
                            <button onClick={() => handleRequestExtension(task.id)}
                              className="flex items-center gap-1 px-2 py-1.5 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold hover:bg-amber-200">
                              <Clock className="w-3.5 h-3.5" />Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯
                            </button>
                            <button onClick={() => handleEscalate(task.id, task.escalationLevel + 1)}
                              className="flex items-center gap-1 px-2 py-1.5 bg-orange-100 text-orange-700 rounded-lg text-xs font-bold hover:bg-orange-200">
                              <TrendingUp className="w-3.5 h-3.5" />ØªØµØ¹ÙŠØ¯ ÙÙˆØ±ÙŠ
                            </button>
                            <button onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                              className="flex items-center gap-1 px-2 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold hover:bg-slate-200">
                              <Eye className="w-3.5 h-3.5" />Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button> </div> </td> </tr>);
                  })}
                </tbody> </table> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: CALENDAR (Ø§Ù„ØªÙ‚ÙˆÙŠÙ…)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'calendar' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <button onClick={() => navigateMonth(-1)} className="p-2 hover:bg-slate-100 rounded-xl">
                  <ChevronRight className="w-6 h-6 text-slate-600" />
                </button>
                <h2 className="text-xl font-bold text-slate-800">
                  {months[currentDate.getMonth()]} {currentDate.getFullYear()}
                </h2>
                <button onClick={() => navigateMonth(1)} className="p-2 hover:bg-slate-100 rounded-xl">
                  <ChevronLeft className="w-6 h-6 text-slate-600" />
                </button> </div>
              <div className="flex items-center gap-2">
                <button onClick={() => setCurrentDate(new Date())} className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold text-sm">
                  Ø§Ù„ÙŠÙˆÙ…
                </button>
                <div className="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden">
                  {['month', 'week', 'day'].map(view => (
                    <button key={view} onClick={() => setCalendarView(view)}
                      className={`px-4 py-2 text-sm font-bold ${calendarView === view ? 'bg-indigo-500 text-white' : 'text-slate-600 hover:bg-slate-50'}`}>
                      {view === 'month' ? 'Ø´Ù‡Ø±' : view === 'week' ? 'Ø£Ø³Ø¨ÙˆØ¹' : 'ÙŠÙˆÙ…'}
                    </button>
                  ))}
                </div> </div> </div>
            {calendarView === 'month' && (
              <div className="border-2 border-slate-200 rounded-2xl overflow-hidden">
                <div className="grid grid-cols-7 bg-slate-50 border-b-2 border-slate-200">
                  {weekDays.map(day => (
                    <div key={day} className="px-2 py-3 text-center font-bold text-slate-600 text-sm">{day}</div>
                  ))}
                </div>
                <div className="grid grid-cols-7">
                  {getMonthDays().map((dayObj, idx) => {
                    const dayTasks = getTasksForDate(dayObj.date);
                    const isToday = dayObj.date.toDateString() === today.toDateString();
                    return (
                      <div key={idx}
                        className={`min-h-[120px] border-b border-r border-slate-100 p-2 ${!dayObj.currentMonth ? 'bg-slate-50 text-slate-400' : 'bg-white'
                          } ${isToday ? 'bg-indigo-50' : ''}`}>
                        <div className={`text-sm font-bold mb-1 ${isToday ? 'w-7 h-7 rounded-full bg-indigo-500 text-white flex items-center justify-center' : ''}`}>
                          {dayObj.day}
                        </div>
                        <div className="space-y-1">
                          {dayTasks.slice(0, 3).map(task => {
                            const authColor = AUTHORITY_COLORS[task.authorityCode] || { bg: 'bg-slate-500' };
                            const urgency = getTaskUrgency(task);
                            return (
                              <div key={task.id} onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                                className={`text-[10px] px-1.5 py-1 rounded cursor-pointer truncate ${urgency === 'overdue' ? 'bg-red-500 text-white' : `${authColor.bg} text-white`
                                  }`}>
                                {task.code}: {task.title.substring(0, 20)}...
                              </div>);
                          })}
                          {dayTasks.length > 3 && (
                            <div className="text-[10px] text-slate-500 font-bold">+{dayTasks.length - 3} Ø§Ù„Ù…Ø²ÙŠØ¯</div>
                          )}
                        </div> </div>);
                  })}
                </div> </div>
            )}

            {(calendarView === 'week' || calendarView === 'day') && (
              <div className="border-2 border-slate-200 rounded-2xl p-8 text-center bg-slate-50">
                <Calendar className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                <h3 className="text-xl font-bold text-slate-600">Ø¹Ø±Ø¶ {calendarView === 'week' ? 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹' : 'Ø§Ù„ÙŠÙˆÙ…'}</h3>
                <p className="text-slate-500 mt-2">Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
              </div>
            )}

            <div className="mt-6 flex items-center gap-6 justify-center">
              {Object.entries(AUTHORITY_COLORS).map(([code, colors]) => (
                <div key={code} className="flex items-center gap-2">
                  <div className={`w-4 h-4 rounded ${colors.bg}`}></div>
                  <span className="text-sm text-slate-600">{code}</span>
                </div>
              ))}
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 rounded bg-red-500"></div>
                <span className="text-sm text-slate-600">Ù…ØªØ£Ø®Ø±</span>
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: GANTT (Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ) - INTERACTIVE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'gantt' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <h2 className="text-lg font-bold text-slate-800">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ù…Ù‡Ø§Ù…</h2>
                <span className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-xl text-sm font-bold">
                  {filteredTasks.length} Ù…Ù‡Ù…Ø©
                </span> </div>
              <div className="flex items-center gap-3">
                <button
                  onClick={() => setShowScheduleSetup(true)}
                  className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold text-sm hover:shadow-lg transition-all">
                  <Plus className="w-4 h-4" />
                  Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                </button>

                <div className="flex items-center gap-2">
                  <span className="text-sm text-slate-500">Ø§Ù„ØªÙƒØ¨ÙŠØ±:</span>
                  <div className="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden">
                    {['day', 'week', 'month', 'quarter'].map(zoom => (
                      <button key={zoom} onClick={() => setGanttZoom(zoom)}
                        className={`px-3 py-1.5 text-xs font-bold ${ganttZoom === zoom ? 'bg-indigo-500 text-white' : 'text-slate-600 hover:bg-slate-50'}`}>
                        {zoom === 'day' ? 'ÙŠÙˆÙ…' : zoom === 'week' ? 'Ø£Ø³Ø¨ÙˆØ¹' : zoom === 'month' ? 'Ø´Ù‡Ø±' : 'Ø±Ø¨Ø¹'}
                      </button>
                    ))}
                  </div> </div> </div> </div>
            <div className="border-2 border-slate-200 rounded-2xl overflow-hidden bg-white">
              <div className="flex bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
                <div className="w-72 shrink-0 px-4 py-3 font-bold text-slate-700 border-l-2 border-slate-200 flex items-center gap-2">
                  <ClipboardList className="w-4 h-4" />
                  Ø§Ù„Ù…Ù‡Ù…Ø©
                </div>
                <div className="flex-1 flex">
                  {Array.from({ length: 12 }, (_, i) => {
                    const currentMonth = new Date().getMonth();
                    return (
                      <div key={i} className={`flex-1 px-2 py-3 text-center text-xs font-bold border-l border-slate-200 ${i === currentMonth ? 'bg-indigo-100 text-indigo-700' : 'text-slate-600'
                        }`}>
                        {months[i].substring(0, 3)}
                      </div>);
                  })}
                </div> </div>
              <div className="max-h-[450px] overflow-y-auto">
                {filteredTasks.length === 0 ? (
                  <div className="text-center py-12">
                    <Calendar className="w-16 h-16 mx-auto text-slate-300 mb-4" />
                    <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</p>
                    <p className="text-sm text-slate-400 mb-4">Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨Ø¯Ø¡</p>
                    <button onClick={() => setShowScheduleSetup(true)}
                      className="px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold text-sm">
                      <Plus className="w-4 h-4 inline ml-1" />Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                    </button> </div>
                ) : (
                  filteredTasks.map(task => {
                    const authColor = AUTHORITY_COLORS[task.authorityCode] || { bg: 'bg-slate-500' };
                    const dueDate = new Date(task.dueDate);
                    const startMonth = 0;
                    const dueMonth = dueDate.getMonth();
                    const progressWidth = ((dueMonth - startMonth + 1) / 12) * 100;
                    const urgency = getTaskUrgency(task);
                    const dayOfMonth = dueDate.getDate();

                    return (
                      <div key={task.id}
                        className="flex border-b border-slate-100 hover:bg-indigo-50/50 cursor-pointer transition-all group"
                        onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}>
                        <div className="w-72 shrink-0 px-4 py-3 border-l-2 border-slate-200">
                          <div className="flex items-center gap-3">
                            <span className={`w-9 h-9 rounded-lg ${authColor.bg} flex items-center justify-center text-white text-xs font-bold shadow-sm`}>
                              {task.authorityCode?.substring(0, 2)}
                            </span>
                            <div className="min-w-0 flex-1">
                              <div className="flex items-center gap-2">
                                <span className="font-mono text-xs text-indigo-600 bg-indigo-100 px-1.5 py-0.5 rounded">{task.code}</span>
                                {urgency === 'overdue' && (
                                  <span className="px-1.5 py-0.5 bg-red-500 text-white rounded text-[10px] font-bold">Ù…ØªØ£Ø®Ø±</span>
                                )}
                              </div>
                              <div className="text-sm font-medium text-slate-800 truncate mt-0.5">{task.title}</div>
                            </div>
                            <div className="opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1">
                              <button onClick={(e) => { e.stopPropagation(); setSelectedTask(task); setShowTaskModal(true); }}
                                className="w-7 h-7 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center hover:bg-indigo-200">
                                <Eye className="w-4 h-4" />
                              </button>
                              <button onClick={(e) => { e.stopPropagation(); setSelectedTask(task); setShowDelegationModal(true); }}
                                className="w-7 h-7 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center hover:bg-purple-200">
                                <Users className="w-4 h-4" />
                              </button> </div> </div> </div>
                        <div className="flex-1 relative py-3 px-2">
                          <div className="absolute inset-0 flex pointer-events-none">
                            {Array.from({ length: 12 }, (_, i) => {
                              const currentMonth = new Date().getMonth();
                              return (
                                <div key={i} className={`flex-1 border-l ${i === currentMonth ? 'border-indigo-300 bg-indigo-50/30' : 'border-slate-100'}`}></div>
                              );
                            })}
                          </div>

                          <div className="absolute inset-y-3 flex items-center" style={{ right: '0', width: `${progressWidth}%` }}>
                            <div className={`h-8 rounded-lg w-full flex items-center justify-between px-2 shadow-sm border-2 border-white/50 transition-all group-hover:shadow-md group-hover:scale-[1.02] ${urgency === 'overdue' ? 'bg-gradient-to-l from-red-500 to-red-600' :
                              task.status === 'Completed' ? 'bg-gradient-to-l from-emerald-500 to-emerald-600' :
                                task.status === 'PendingReview' ? 'bg-gradient-to-l from-amber-500 to-amber-600' :
                                  `${authColor.bg}`
                              }`}>
                              <span className="text-[10px] text-white/80 font-medium">
                                {task.status === 'Completed' ? 'âœ“' : task.status === 'PendingReview' ? 'â³' : ''}
                              </span>
                              <span className="text-[11px] text-white font-bold">{task.dueDate}</span>
                            </div> </div>
                          <div className="absolute left-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
                            <div className="bg-slate-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg whitespace-nowrap">
                              <p className="font-bold">{task.title}</p>
                              <p className="text-slate-300">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {task.ownerName}</p>
                              <p className="text-slate-300">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {task.dueDate}</p>
                              <p className={urgency === 'overdue' ? 'text-red-400' : 'text-emerald-400'}>
                                {urgency === 'overdue' ? `Ù…ØªØ£Ø®Ø± ${Math.abs(getDaysUntilDue(task.dueDate))} ÙŠÙˆÙ…` : `Ù…ØªØ¨Ù‚ÙŠ ${getDaysUntilDue(task.dueDate)} ÙŠÙˆÙ…`}
                              </p> </div> </div> </div> </div>);
                  })
                )}
              </div> </div>
            <div className="mt-6 flex items-center justify-between">
              <div className="flex items-center gap-4">
                <span className="text-sm text-slate-500 font-bold">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</span>
                <div className="flex items-center gap-2">
                  <div className="w-5 h-3 rounded bg-emerald-500"></div>
                  <span className="text-xs text-slate-600">Ù…ÙƒØªÙ…Ù„</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-5 h-3 rounded bg-amber-500"></div>
                  <span className="text-xs text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                </div>
                {Object.entries(AUTHORITY_COLORS).slice(0, 4).map(([code, colors]) => (
                  <div key={code} className="flex items-center gap-2">
                    <div className={`w-5 h-3 rounded ${colors.bg}`}></div>
                    <span className="text-xs text-slate-600">{code}</span>
                  </div>
                ))}
                <div className="flex items-center gap-2">
                  <div className="w-5 h-3 rounded bg-red-500"></div>
                  <span className="text-xs text-slate-600">Ù…ØªØ£Ø®Ø±</span>
                </div> </div>
              <div className="flex items-center gap-3">
                <div className="flex items-center gap-1.5 px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-xs font-bold">
                  <AlertTriangle className="w-3.5 h-3.5" />
                  {filteredTasks.filter(t => getTaskUrgency(t) === 'overdue').length} Ù…ØªØ£Ø®Ø±
                </div>
                <div className="flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">
                  <Clock className="w-3.5 h-3.5" />
                  {filteredTasks.filter(t => getDaysUntilDue(t.dueDate) <= 7 && getDaysUntilDue(t.dueDate) >= 0).length} Ù‚Ø±ÙŠØ¨
                </div>
                <div className="flex items-center gap-1.5 px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">
                  <CheckCircle2 className="w-3.5 h-3.5" />
                  {filteredTasks.filter(t => t.status === 'Completed').length} Ù…ÙƒØªÙ…Ù„
                </div> </div> </div>
            <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-xl">
              <p className="text-sm text-blue-700 flex items-center gap-2">
                <Info className="w-4 h-4" />
                <span><strong>ØªÙ„Ù…ÙŠØ­:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù‡Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙˆÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø©</span>
              </p> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: EVIDENCE REVIEW (Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø©)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'evidence' && (
          <div className="p-6">
            <div className="grid grid-cols-4 gap-4 mb-6">
              <div className="bg-amber-50 rounded-xl p-4 border-2 border-amber-200">
                <div className="flex items-center justify-between">
                  <Eye className="w-6 h-6 text-amber-500" />
                  <span className="text-2xl font-bold text-amber-600">
                    {tasks.filter(t => t.evidenceStatus === 'UnderReview').length}
                  </span> </div>
                <p className="text-sm text-amber-700 mt-1">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
              </div>
              <div className="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200">
                <div className="flex items-center justify-between">
                  <CheckCircle2 className="w-6 h-6 text-emerald-500" />
                  <span className="text-2xl font-bold text-emerald-600">
                    {tasks.filter(t => t.evidenceStatus === 'Accepted').length}
                  </span> </div>
                <p className="text-sm text-emerald-700 mt-1">ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§</p>
              </div>
              <div className="bg-red-50 rounded-xl p-4 border-2 border-red-200">
                <div className="flex items-center justify-between">
                  <XCircle className="w-6 h-6 text-red-500" />
                  <span className="text-2xl font-bold text-red-600">
                    {tasks.filter(t => t.evidenceStatus === 'Rejected').length}
                  </span> </div>
                <p className="text-sm text-red-700 mt-1">Ù…Ø±ÙÙˆØ¶Ø©</p>
              </div>
              <div className="bg-indigo-50 rounded-xl p-4 border-2 border-indigo-200">
                <div className="flex items-center justify-between">
                  <User className="w-6 h-6 text-indigo-500" />
                  <span className="text-lg font-bold text-indigo-600">{CURRENT_USER.name}</span>
                </div>
                <p className="text-sm text-indigo-700 mt-1">{CURRENT_USER.role}</p>
              </div> </div>
            <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6">
              <div className="flex items-center gap-3">
                <Info className="w-5 h-5 text-blue-600 shrink-0" />
                <div>
                  <p className="font-bold text-blue-800">ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (Segregation of Duties)</p>
                  <p className="text-sm text-blue-700">Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø±ÙØ¹Ù‡Ø§ Ø¨Ù†ÙØ³Ùƒ. Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙŠ Ø£Ù†Øª Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ù‡Ø§ Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø·Ù„Ø©.</p>
                </div> </div> </div>
            <div className="space-y-3">
              {tasks.filter(t => t.evidenceStatus === 'UnderReview' || t.evidenceStatus === 'Uploaded').map(task => {
                const canReview = task.ownerId !== CURRENT_USER.id;
                const authColor = AUTHORITY_COLORS[task.authorityCode] || { bg: 'bg-slate-500', light: 'bg-slate-100', text: 'text-slate-700' };
                const evidenceCfg = EVIDENCE_STATUS_CONFIG[task.evidenceStatus];
                const EvidenceIcon = evidenceCfg?.icon || Upload;

                return (
                  <div key={task.id} className={`bg-white rounded-xl border-2 p-4 ${canReview ? 'border-amber-300 hover:shadow-lg' : 'border-slate-200 opacity-60'}`}>
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-4">
                        <div className={`w-12 h-12 rounded-xl ${authColor.bg} flex items-center justify-center text-white font-bold shrink-0`}>
                          {task.authorityCode?.substring(0, 2)}
                        </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{task.code}</span>
                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-lg text-xs font-bold ${evidenceCfg?.bg} ${evidenceCfg?.text}`}>
                              <EvidenceIcon className="w-3 h-3" />{evidenceCfg?.label}
                            </span> </div>
                          <h4 className="font-bold text-slate-800">{task.title}</h4>
                          {task.evidenceFileName && (
                            <p className="text-sm text-slate-500 mt-1 flex items-center gap-2">
                              <FileText className="w-4 h-4" />
                              {task.evidenceFileName}
                            </p>
                          )}
                          <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                            <span>Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©: <strong className="text-slate-700">{task.ownerName}</strong></span>
                            <span>Ø§Ù„ÙØªØ±Ø©: <strong className="text-slate-700">{task.period}</strong></span>
                            <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <strong className="text-slate-700">{task.dueDate}</strong></span>
                          </div> </div> </div>
                      <div className="flex items-center gap-2">
                        {canReview ? (
                          <>
                            <button onClick={() => handleApproveEvidence(task.id)}
                              className="flex items-center gap-2 px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl font-bold hover:bg-emerald-200">
                              <CheckCircle2 className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯
                            </button>
                            <button onClick={() => { setSelectedTask(task); setShowEvidenceModal(true); }}
                              className="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200">
                              <XCircle className="w-5 h-5" />Ø±ÙØ¶
                            </button>
                          </>
                        ) : (
                          <span className="px-4 py-2 bg-slate-100 text-slate-500 rounded-xl text-sm">
                            SoD - Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                          </span>
                        )}
                        <button onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                          className="p-2 hover:bg-blue-50 rounded-lg">
                          <Eye className="w-5 h-5 text-blue-500" />
                        </button> </div> </div> </div>);
              })}

              {tasks.filter(t => t.evidenceStatus === 'UnderReview' || t.evidenceStatus === 'Uploaded').length === 0 && (
                <div className="text-center py-16 bg-slate-50 rounded-xl">
                  <CheckCircle2 className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
                  <h3 className="text-xl font-bold text-slate-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
                  <p className="text-slate-500 mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§</p>
                </div>
              )}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: ESCALATION (Ø§Ù„ØªØµØ¹ÙŠØ¯ ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'escalation' && (
          <div className="p-6">
            <div className="bg-gradient-to-l from-orange-500 to-red-500 rounded-2xl p-6 mb-6 text-white">
              <div className="flex items-center gap-4 mb-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <AlertTriangle className="w-6 h-6" />
                </div>
                <div>
                  <h3 className="text-xl font-bold">Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„Ø¢Ù„ÙŠ</h3>
                  <p className="text-orange-100">Auto-Escalation Engine</p>
                </div> </div>
              <div className="grid grid-cols-4 gap-4">
                {ESCALATION_RULES.map(rule => (
                  <div key={rule.level} className="bg-white/20 rounded-xl p-3">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="w-6 h-6 rounded-full bg-white/30 flex items-center justify-center text-sm font-bold">{rule.level}</span>
                      <span className="font-bold text-sm">{rule.name}</span>
                    </div>
                    <p className="text-xs text-orange-100">
                      {rule.daysBeforeDue ? `${rule.daysBeforeDue} Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯` : `${rule.daysAfterDue} Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ¹Ø¯`}
                    </p>
                    <p className="text-xs text-orange-100 mt-1">Ø¥Ø¨Ù„Ø§Øº: {rule.notifyTo}</p>
                  </div>
                ))}
              </div> </div>
            <div className="space-y-3">
              <h3 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙØµØ¹Ù‘Ø¯Ø© ({tasks.filter(t => t.escalationLevel > 0).length})</h3>

              {tasks.filter(t => t.escalationLevel > 0).map(task => {
                const authColor = AUTHORITY_COLORS[task.authorityCode] || { bg: 'bg-slate-500' };
                const daysUntil = getDaysUntilDue(task.dueDate);

                return (
                  <div key={task.id} className="bg-white rounded-xl border-2 border-orange-300 p-4 hover:shadow-lg">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-4">
                        <div className="relative">
                          <div className={`w-12 h-12 rounded-xl ${authColor.bg} flex items-center justify-center text-white font-bold`}>
                            {task.authorityCode?.substring(0, 2)}
                          </div>
                          <div className="absolute -top-1 -right-1 w-6 h-6 rounded-full bg-orange-500 text-white text-xs font-bold flex items-center justify-center">
                            {task.escalationLevel}
                          </div> </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{task.code}</span>
                            <span className="px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-bold">
                              Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØµØ¹ÙŠØ¯: {task.escalationLevel}
                            </span> </div>
                          <h4 className="font-bold text-slate-800">{task.title}</h4>
                          <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                            <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: <strong className="text-slate-700">{task.ownerName}</strong></span>
                            <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <strong className={daysUntil < 0 ? 'text-red-600' : 'text-slate-700'}>{task.dueDate}</strong></span>
                            {daysUntil < 0 && (
                              <span className="px-2 py-0.5 bg-red-500 text-white rounded-lg text-xs font-bold">
                                Ù…ØªØ£Ø®Ø± {Math.abs(daysUntil)} ÙŠÙˆÙ…
                              </span>
                            )}
                          </div>
                          {task.escalationHistory?.length > 0 && (
                            <div className="mt-3 pt-3 border-t border-slate-100">
                              <p className="text-xs font-bold text-slate-600 mb-2">Ø³Ø¬Ù„ Ø§Ù„ØªØµØ¹ÙŠØ¯:</p>
                              <div className="flex items-center gap-2 flex-wrap">
                                {task.escalationHistory.map((esc, idx) => (
                                  <span key={idx} className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">
                                    Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {esc.level} â†’ {esc.to} ({esc.date})
                                  </span>
                                ))}
                              </div> </div>
                          )}
                        </div> </div>
                      <div className="flex items-center gap-2">
                        {task.escalationLevel < 4 && (
                          <button onClick={() => handleEscalate(task.id, task.escalationLevel + 1)}
                            className="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200">
                            <TrendingUp className="w-5 h-5" />ØªØµØ¹ÙŠØ¯ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ {task.escalationLevel + 1}
                          </button>
                        )}
                        <button onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                          className="p-2 hover:bg-blue-50 rounded-lg">
                          <Eye className="w-5 h-5 text-blue-500" />
                        </button> </div> </div> </div>);
              })}

              {tasks.filter(t => t.escalationLevel > 0).length === 0 && (
                <div className="text-center py-16 bg-slate-50 rounded-xl">
                  <CheckCircle2 className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
                  <h3 className="text-xl font-bold text-slate-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙØµØ¹Ù‘Ø¯Ø©</h3>
                  <p className="text-slate-500 mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¶Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</p>
                </div>
              )}
            </div>

            <div className="mt-8">
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <AlertTriangle className="w-5 h-5 text-red-500" />
                Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ({tasks.filter(t => getDaysUntilDue(t.dueDate) < 0 && t.status !== 'Completed').length})
              </h3>

              {tasks.filter(t => getDaysUntilDue(t.dueDate) < 0 && t.status !== 'Completed').map(task => (
                <div key={task.id} className="bg-red-50 rounded-xl border-2 border-red-300 p-4 mb-3">
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-mono text-sm font-bold text-indigo-600">{task.code}</span>
                        <span className="px-2 py-0.5 bg-red-500 text-white rounded text-xs font-bold">
                          Ù…ØªØ£Ø®Ø± {Math.abs(getDaysUntilDue(task.dueDate))} ÙŠÙˆÙ…
                        </span> </div>
                      <h4 className="font-bold text-slate-800">{task.title}</h4>
                    </div>
                    <button onClick={() => handleEscalate(task.id, Math.min(task.escalationLevel + 1, 4))}
                      className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                      <TrendingUp className="w-5 h-5" />ØªØµØ¹ÙŠØ¯ ÙÙˆØ±ÙŠ
                    </button> </div> </div>
              ))}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: READINESS (Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„ØªÙØªÙŠØ´)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'readiness' && (
          <div className="p-6">
            <div className="bg-gradient-to-l from-emerald-500 to-teal-600 rounded-2xl p-6 mb-6 text-white">
              <div className="flex items-center justify-between">
                <div>
                  <h3 className="text-xl font-bold mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„ØªÙØªÙŠØ´</h3>
                  <p className="text-emerald-100">Inspection Readiness Score</p>
                </div>
                <div className="text-center">
                  <div className="relative w-32 h-32">
                    <svg className="w-32 h-32 transform -rotate-90">
                      <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.2)" strokeWidth="12" fill="none" />
                      <circle cx="64" cy="64" r="56" stroke="white" strokeWidth="12" fill="none"
                        strokeDasharray={`${(inspectionReadiness.percentage / 100) * 352} 352`}
                        strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">
                      <span className="text-3xl font-bold">{inspectionReadiness.percentage}%</span>
                    </div> </div>
                  <p className="mt-2 text-sm">{inspectionReadiness.completed}/{inspectionReadiness.total} Ù…ØªØ·Ù„Ø¨</p>
                </div> </div>
              <div className="grid grid-cols-4 gap-4 mt-6">
                {Object.entries(inspectionReadiness.byCategory).map(([category, data]) => (
                  <div key={category} className="bg-white/20 rounded-xl p-3">
                    <div className="flex items-center justify-between mb-2">
                      <span className="font-bold text-sm">{category}</span>
                      <span className="text-sm">{data.completed}/{data.total}</span>
                    </div>
                    <div className="h-2 bg-white/30 rounded-full overflow-hidden">
                      <div className="h-full bg-white rounded-full" style={{ width: `${(data.completed / data.total) * 100}%` }}></div>
                    </div> </div>
                ))}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-slate-50 border-b-2 border-slate-200">
                <h3 className="font-bold text-slate-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚</h3>
              </div>
              <div className="divide-y divide-slate-100">
                {Object.entries(inspectionReadiness.byCategory).map(([category, _]) => (
                  <div key={category}>
                    <div className="px-6 py-3 bg-slate-50 font-bold text-slate-700 text-sm">{category}</div>
                    {inspectionChecklist.filter(item => item.category === category).map(item => (
                      <div key={item.id} className="px-6 py-4 flex items-center justify-between hover:bg-slate-50">
                        <div className="flex items-center gap-4">
                          <button onClick={() => toggleChecklistItem(item.id)}
                            className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${item.completed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-300 hover:border-emerald-400'
                              }`}>
                            {item.completed && <Check className="w-4 h-4 text-white" />}
                          </button>
                          <span className={`${item.completed ? 'text-slate-500 line-through' : 'text-slate-800'}`}>
                            {item.item}
                          </span> </div>
                        {item.evidenceId ? (
                          <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">
                            Ø¯Ù„ÙŠÙ„ Ù…Ø±ÙÙ‚
                          </span>
                        ) : (
                          <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">
                            ÙŠØ­ØªØ§Ø¬ Ø¯Ù„ÙŠÙ„
                          </span>
                        )}
                      </div>
                    ))}
                  </div>
                ))}
              </div> </div>
            <div className="mt-6 bg-amber-50 rounded-2xl border-2 border-amber-200 p-6">
              <div className="flex items-center gap-3 mb-4">
                <AlertTriangle className="w-6 h-6 text-amber-600" />
                <h3 className="font-bold text-amber-800">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª</h3>
              </div>
              <div className="grid grid-cols-2 gap-4">
                {inspectionChecklist.filter(item => !item.completed).map(item => (
                  <div key={item.id} className="bg-white rounded-xl p-4 border border-amber-200">
                    <p className="font-medium text-slate-800">{item.item}</p>
                    <p className="text-sm text-amber-600 mt-1">Ø§Ù„ÙØ¦Ø©: {item.category}</p>
                    <button className="mt-2 text-sm text-indigo-600 font-bold hover:underline">
                      Ø¥Ø¶Ø§ÙØ© Ø¯Ù„ÙŠÙ„ â†’
                    </button> </div>
                ))}
              </div> </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          MODALS
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}

      {showTaskModal && selectedTask && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-4 text-white flex-shrink-0 ${getTaskUrgency(selectedTask) === 'overdue' ? 'bg-gradient-to-l from-red-600 to-rose-600' :
              selectedTask.status === 'Completed' ? 'bg-gradient-to-l from-emerald-500 to-teal-600' :
                selectedTask.status === 'PendingReview' ? 'bg-gradient-to-l from-amber-500 to-orange-500' :
                  'bg-gradient-to-l from-indigo-600 to-purple-600'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <ClipboardCheck className="w-6 h-6" />
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-0.5 rounded">{selectedTask.code}</span>
                      <span className={`px-2 py-0.5 rounded text-xs font-bold ${selectedTask.priority === 'Critical' ? 'bg-red-500' :
                        selectedTask.priority === 'High' ? 'bg-orange-500' : 'bg-amber-500'
                        }`}>{PRIORITY_CONFIG[selectedTask.priority]?.label}</span>
                    </div>
                    <h2 className="text-lg font-bold">{selectedTask.title}</h2>
                  </div> </div>
                <div className="flex items-center gap-2">
                  <div className="text-center px-3 py-1.5 bg-white/10 rounded-lg">
                    <p className="text-xl font-black">
                      {getDaysUntilDue(selectedTask.dueDate) >= 0 ? getDaysUntilDue(selectedTask.dueDate) : Math.abs(getDaysUntilDue(selectedTask.dueDate))}
                    </p>
                    <p className="text-xs">{getDaysUntilDue(selectedTask.dueDate) >= 0 ? 'ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ' : 'ÙŠÙˆÙ… Ù…ØªØ£Ø®Ø±'}</p>
                  </div>
                  {selectedTask.status !== 'Completed' && (
                    <button
                      onClick={() => setScheduleForm({ ...scheduleForm, editMode: !scheduleForm.editMode })}
                      className={`w-10 h-10 flex items-center justify-center rounded-lg transition-all ${scheduleForm.editMode ? 'bg-white text-purple-600' : 'bg-white/10 hover:bg-white/20'
                        }`}>
                      <Edit className="w-5 h-5" />
                    </button>
                  )}
                  <button onClick={() => { setShowTaskModal(false); setSelectedTask(null); setScheduleForm({ ...scheduleForm, editMode: false }); }}
                    className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-lg">
                    <X className="w-5 h-5" />
                  </button> </div> </div> </div>
            {scheduleForm.editMode && (
              <div className="px-6 py-2 bg-amber-50 border-b border-amber-200 flex items-center justify-between">
                <div className="flex items-center gap-2 text-amber-700">
                  <Edit className="w-4 h-4" />
                  <span className="font-bold text-sm">ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ± Ù…ÙØ¹Ù‘Ù„</span>
                  <span className="text-xs">- ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¯Ù†Ø§Ù‡</span>
                </div>
                <button onClick={() => setScheduleForm({ ...scheduleForm, editMode: false })}
                  className="text-xs text-amber-600 hover:text-amber-800 font-bold">
                  Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø±ÙŠØ±
                </button> </div>
            )}

            <div className={`px-6 py-3 flex items-center justify-between border-b flex-shrink-0 ${getTaskUrgency(selectedTask) === 'overdue' ? 'bg-red-50 border-red-200' :
              selectedTask.status === 'Completed' ? 'bg-emerald-50 border-emerald-200' :
                'bg-indigo-50 border-indigo-200'
              }`}>
              <div className="flex items-center gap-3">
                <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${getTaskUrgency(selectedTask) === 'overdue' ? 'bg-red-500 text-white' :
                  selectedTask.status === 'Completed' ? 'bg-emerald-500 text-white' :
                    'bg-indigo-500 text-white'
                  }`}>
                  {(() => { const Icon = STATUS_CONFIG[selectedTask.status]?.icon || Clock; return <Icon className="w-5 h-5" />; })()}
                </div>
                <div>
                  {scheduleForm.editMode ? (
                    <select className="font-bold bg-white border-2 border-indigo-300 rounded-lg px-2 py-1 text-sm"
                      defaultValue={selectedTask.status}>
                      <option value="Open">Ù…ÙØªÙˆØ­</option>
                      <option value="InProgress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                      <option value="PendingReview">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                      <option value="Completed">Ù…ÙƒØªÙ…Ù„</option>
                    </select>
                  ) : (
                    <p className={`font-bold ${getTaskUrgency(selectedTask) === 'overdue' ? 'text-red-700' :
                      selectedTask.status === 'Completed' ? 'text-emerald-700' : 'text-indigo-700'
                      }`}>{STATUS_CONFIG[selectedTask.status]?.label}</p>
                  )}
                  {getDaysUntilDue(selectedTask.dueDate) < 0 && selectedTask.status !== 'Completed' && !scheduleForm.editMode && (
                    <p className="text-xs text-red-600">Ù…ØªØ£Ø®Ø± {Math.abs(getDaysUntilDue(selectedTask.dueDate))} ÙŠÙˆÙ…</p>
                  )}
                </div> </div>
              <div className="flex items-center gap-3">
                <span className="text-sm font-bold text-slate-600">Ø§Ù„ØªÙ‚Ø¯Ù…:</span>
                <div className="w-32 h-2 bg-slate-200 rounded-full">
                  <div className={`h-full rounded-full ${selectedTask.status === 'Completed' ? 'bg-emerald-500 w-full' :
                    selectedTask.evidenceStatus === 'Uploaded' ? 'bg-blue-500 w-3/4' :
                      selectedTask.status === 'InProgress' ? 'bg-indigo-500 w-1/2' : 'bg-slate-400 w-1/4'
                    }`}></div>
                </div>
                <span className="text-sm font-bold text-slate-700">
                  {selectedTask.status === 'Completed' ? '100%' :
                    selectedTask.evidenceStatus === 'Uploaded' ? '75%' :
                      selectedTask.status === 'InProgress' ? '50%' : '25%'}
                </span> </div> </div>
            <div className="flex-1 overflow-y-auto p-5">
              <div className="grid grid-cols-2 gap-5">
                <div className="space-y-4">
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                      <Building2 className="w-4 h-4" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
                    </h4>
                    <div className="grid grid-cols-3 gap-3">
                      <div className="text-center p-2 bg-white rounded-lg border">
                        <p className="text-xs text-slate-500">Ø§Ù„Ø¬Ù‡Ø©</p>
                        <p className="font-bold text-indigo-700">{selectedTask.authorityCode || 'SAMA'}</p>
                      </div>
                      <div className="text-center p-2 bg-white rounded-lg border">
                        <p className="text-xs text-slate-500">Ø§Ù„Ø¥Ø·Ø§Ø±</p>
                        <p className="font-bold text-purple-700">{selectedTask.frameworkCode || 'SAMA-AML'}</p>
                      </div>
                      <div className="text-center p-2 bg-white rounded-lg border">
                        <p className="text-xs text-slate-500">Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</p>
                        {scheduleForm.editMode ? (
                          <select className="font-bold text-amber-700 bg-transparent border-0 text-center w-full text-sm"
                            defaultValue={selectedTask.periodType}>
                            <option value="Monthly">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="Quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                            <option value="Annual">Ø³Ù†ÙˆÙŠ</option>
                          </select>
                        ) : (
                          <p className="font-bold text-amber-700">{selectedTask.periodType === 'Monthly' ? 'Ø´Ù‡Ø±ÙŠ' : selectedTask.periodType}</p>
                        )}
                      </div> </div> </div>
                  <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                    <h4 className="font-bold text-blue-700 mb-3 text-sm flex items-center gap-2">
                      <Calendar className="w-4 h-4" />Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                      {scheduleForm.editMode && <span className="text-xs text-blue-500 mr-2">(Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</span>}
                    </h4>
                    <div className="space-y-2">
                      <div className="flex items-center justify-between bg-white rounded-lg p-2 border">
                        <span className="text-sm text-slate-600">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span>
                        {scheduleForm.editMode ? (
                          <input type="date" defaultValue={selectedTask.dueDate}
                            className="font-mono font-bold text-emerald-600 bg-emerald-50 border border-emerald-200 rounded px-2 py-1 text-sm" />
                        ) : (
                          <span className="font-mono font-bold text-emerald-600">{selectedTask.dueDate}</span>
                        )}
                      </div>
                      <div className="flex items-center justify-between bg-white rounded-lg p-2 border">
                        <span className="text-sm text-slate-600">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ù…Ø§Ø­</span>
                        {scheduleForm.editMode ? (
                          <input type="date" defaultValue={selectedTask.gracePeriodEnd || selectedTask.graceEndDate}
                            className="font-mono font-bold text-amber-600 bg-amber-50 border border-amber-200 rounded px-2 py-1 text-sm" />
                        ) : (
                          <span className="font-mono font-bold text-amber-600">{selectedTask.gracePeriodEnd || selectedTask.graceEndDate}</span>
                        )}
                      </div>
                      <div className="flex items-center justify-between bg-white rounded-lg p-2 border">
                        <span className="text-sm text-slate-600">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</span>
                        {scheduleForm.editMode ? (
                          <input type="date" defaultValue={selectedTask.violationDate || selectedTask.breachTriggerDate}
                            className="font-mono font-bold text-red-600 bg-red-50 border border-red-200 rounded px-2 py-1 text-sm" />
                        ) : (
                          <span className="font-mono font-bold text-red-600">{selectedTask.violationDate || selectedTask.breachTriggerDate}</span>
                        )}
                      </div> </div> </div>
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-2">
                      <FileText className="w-4 h-4" />Ø§Ù„ÙˆØµÙ
                      {scheduleForm.editMode && <span className="text-xs text-slate-500 mr-2">(Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</span>}
                    </h4>
                    {scheduleForm.editMode ? (
                      <textarea
                        defaultValue={selectedTask.description || 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨'}
                        className="w-full text-sm text-slate-600 bg-white border border-slate-200 rounded-lg p-2 min-h-[80px] resize-none"
                        placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©..."
                      />
                    ) : (
                      <p className="text-sm text-slate-600">
                        {selectedTask.description || 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨'}
                      </p>
                    )}
                  </div>

                  {scheduleForm.editMode && (
                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                      <h4 className="font-bold text-amber-700 mb-3 text-sm flex items-center gap-2">
                        <AlertTriangle className="w-4 h-4" />Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                      </h4>
                      <div className="grid grid-cols-4 gap-2">
                        {[
                          { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                          { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                          { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                          { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                        ].map(pri => (
                          <button key={pri.value} type="button"
                            className={`p-2 rounded-lg text-xs font-bold border-2 ${selectedTask.priority === pri.value
                              ? `bg-${pri.color}-500 text-white border-${pri.color}-500`
                              : `bg-white text-${pri.color}-600 border-${pri.color}-200 hover:border-${pri.color}-400`
                              }`}>
                            {pri.label}
                          </button>
                        ))}
                      </div> </div>
                  )}

                  <div className="flex flex-wrap gap-2">
                    {(selectedTask.tags || [selectedTask.priority, selectedTask.periodType, 'AML']).map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">{tag}</span>
                    ))}
                    {scheduleForm.editMode && (
                      <button className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-bold hover:bg-indigo-200">
                        + Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ
                      </button>
                    )}
                  </div> </div>
                <div className="space-y-4">
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                      <Users className="w-4 h-4" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ†
                      {scheduleForm.editMode && <span className="text-xs text-slate-500 mr-2">(Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</span>}
                    </h4>
                    <div className="space-y-2">
                      <div className="flex items-center gap-3 bg-indigo-50 rounded-lg p-3 border border-indigo-200">
                        <div className="w-10 h-10 rounded-lg bg-indigo-500 text-white flex items-center justify-center font-bold">
                          {selectedTask.ownerName?.charAt(0)}
                        </div>
                        <div className="flex-1">
                          {scheduleForm.editMode ? (
                            <select className="w-full font-bold text-slate-800 text-sm bg-white border border-indigo-200 rounded px-2 py-1"
                              defaultValue={selectedTask.ownerId}>
                              {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                            </select>
                          ) : (
                            <p className="font-bold text-slate-800 text-sm">{selectedTask.ownerName}</p>
                          )}
                          <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Owner)</p>
                        </div> </div>
                      <div className="flex items-center gap-3 bg-purple-50 rounded-lg p-3 border border-purple-200">
                        <div className="w-10 h-10 rounded-lg bg-purple-500 text-white flex items-center justify-center font-bold">
                          {selectedTask.reviewerName?.charAt(0)}
                        </div>
                        <div className="flex-1">
                          {scheduleForm.editMode ? (
                            <select className="w-full font-bold text-slate-800 text-sm bg-white border border-purple-200 rounded px-2 py-1"
                              defaultValue={selectedTask.reviewerId}>
                              {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                            </select>
                          ) : (
                            <p className="font-bold text-slate-800 text-sm">{selectedTask.reviewerName}</p>
                          )}
                          <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (Reviewer)</p>
                        </div> </div> </div> </div>
                  <div className={`rounded-xl p-4 border-2 ${selectedTask.evidenceStatus === 'Uploaded' ? 'bg-emerald-50 border-emerald-200' :
                    selectedTask.evidenceStatus === 'Approved' ? 'bg-blue-50 border-blue-200' : 'bg-amber-50 border-amber-200'
                    }`}>
                    <h4 className={`font-bold mb-3 text-sm flex items-center gap-2 ${selectedTask.evidenceStatus === 'Uploaded' ? 'text-emerald-700' :
                      selectedTask.evidenceStatus === 'Approved' ? 'text-blue-700' : 'text-amber-700'
                      }`}>
                      <FileCheck className="w-4 h-4" />Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„
                    </h4>
                    <div className="text-center py-3">
                      <div className={`w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center ${selectedTask.evidenceStatus === 'Uploaded' ? 'bg-emerald-500 text-white' :
                        selectedTask.evidenceStatus === 'Approved' ? 'bg-blue-500 text-white' : 'bg-amber-500 text-white'
                        }`}>
                        {selectedTask.evidenceStatus === 'Uploaded' ? <FileCheck className="w-6 h-6" /> :
                          selectedTask.evidenceStatus === 'Approved' ? <CheckCircle2 className="w-6 h-6" /> :
                            <Upload className="w-6 h-6" />}
                      </div>
                      <p className="font-bold text-sm">{EVIDENCE_STATUS_CONFIG[selectedTask.evidenceStatus]?.label}</p>
                      {selectedTask.evidenceFileName && (
                        <p className="text-xs text-slate-600 mt-1 bg-white rounded px-2 py-1">{selectedTask.evidenceFileName}</p>
                      )}
                      {!selectedTask.evidenceFileName && selectedTask.status !== 'Completed' && (
                        <button onClick={() => handleUploadEvidence(selectedTask.id)}
                          className="mt-2 flex items-center gap-1 px-3 py-1.5 bg-indigo-500 text-white rounded-lg text-xs font-bold mx-auto hover:bg-indigo-600">
                          <Upload className="w-3 h-3" />Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„
                        </button>
                      )}
                    </div> </div>
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-2">
                      <Clock className="w-4 h-4" />Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </h4>
                    <div className="space-y-2 max-h-24 overflow-y-auto">
                      {[
                        { action: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©', time: '01-01' },
                        { action: 'ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„', time: '15-01' },
                        selectedTask.evidenceStatus === 'Uploaded' && { action: 'ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„', time: '25-01' },
                      ].filter(Boolean).map((log, idx) => (
                        <div key={idx} className="flex items-center justify-between text-xs bg-white rounded px-2 py-1.5">
                          <span className="text-slate-700">{log.action}</span>
                          <span className="text-slate-500">{log.time}</span>
                        </div>
                      ))}
                    </div> </div>
                  {scheduleForm.editMode && (
                    <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-2">
                        <FileText className="w-4 h-4" />Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                      </h4>
                      <textarea
                        className="w-full text-sm text-slate-600 bg-white border border-slate-200 rounded-lg p-2 min-h-[60px] resize-none"
                        placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."
                      />
                    </div>
                  )}
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-3 bg-slate-50 flex items-center justify-between flex-shrink-0">
              <button onClick={() => { setShowTaskModal(false); setSelectedTask(null); setScheduleForm({ ...scheduleForm, editMode: false }); }}
                className="px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white text-sm">
                Ø¥ØºÙ„Ø§Ù‚
              </button>

              <div className="flex items-center gap-2">
                {scheduleForm.editMode ? (
                  <>
                    <button onClick={() => setScheduleForm({ ...scheduleForm, editMode: false })}
                      className="flex items-center gap-1.5 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 text-sm">
                      <X className="w-4 h-4" />Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button onClick={() => {
                      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                      setScheduleForm({ ...scheduleForm, editMode: false });
                    }}
                      className="flex items-center gap-1.5 px-5 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold shadow-lg text-sm">
                      <Save className="w-4 h-4" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    </button>
                  </>
                ) : (
                  <>
                    {selectedTask.status !== 'Completed' && (
                      <>
                        <button
                          onClick={() => setScheduleForm({ ...scheduleForm, editMode: true })}
                          className="flex items-center gap-1.5 px-4 py-2.5 bg-indigo-100 text-indigo-700 rounded-xl font-bold hover:bg-indigo-200 text-sm">
                          <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button className="flex items-center gap-1.5 px-4 py-2.5 bg-amber-100 text-amber-700 rounded-xl font-bold hover:bg-amber-200 text-sm">
                          <Clock className="w-4 h-4" />ØªÙ…Ø¯ÙŠØ¯
                        </button>
                      </>
                    )}
                    <button onClick={() => { setShowDelegationModal(true); }}
                      className="flex items-center gap-1.5 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 text-sm">
                      <Users className="w-4 h-4" />ØªÙÙˆÙŠØ¶
                    </button>
                    {selectedTask.evidenceStatus === 'Uploaded' && selectedTask.status !== 'Completed' && selectedTask.status !== 'PendingReview' && (
                      <button onClick={() => handleSubmitTask(selectedTask.id)}
                        className="flex items-center gap-1.5 px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg text-sm">
                        <Send className="w-4 h-4" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                      </button>
                    )}
                    {selectedTask.status === 'PendingReview' && (
                      <>
                        <button className="flex items-center gap-1.5 px-4 py-2.5 bg-red-100 text-red-700 rounded-xl font-bold text-sm">
                          <X className="w-4 h-4" />Ø±ÙØ¶
                        </button>
                        <button className="flex items-center gap-1.5 px-5 py-2.5 bg-emerald-500 text-white rounded-xl font-bold shadow text-sm">
                          <CheckCircle2 className="w-4 h-4" />Ø§Ø¹ØªÙ…Ø§Ø¯
                        </button>
                      </>
                    )}
                  </>
                )}
              </div> </div> </div> </div>
      )}

      {showDelegationModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Users className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
                  <p className="text-indigo-200">Delegate Task</p>
                </div> </div> </div>
            <div className="p-6">
              <p className="text-slate-600 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„ÙŠÙ‡:</p>
              <div className="space-y-2">
                {TEAM_MEMBERS.filter(m => m.id !== selectedTask?.ownerId).map(member => (
                  <button key={member.id}
                    onClick={() => handleDelegate(selectedTask?.id, member.id)}
                    className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all">
                    <div className="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">
                      {member.avatar}
                    </div>
                    <div className="text-right">
                      <p className="font-bold text-slate-800">{member.name}</p>
                      <p className="text-sm text-slate-500">{member.role}</p>
                    </div> </button>
                ))}
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => setShowDelegationModal(false)}
                className="w-full px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button> </div> </div> </div>
      )}

      {showBulkModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <CheckSquare className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
                  <p className="text-indigo-200">{selectedTasks.length} Ù…Ù‡Ù…Ø© Ù…Ø­Ø¯Ø¯Ø©</p>
                </div> </div> </div>
            <div className="p-6 space-y-3">
              <button onClick={() => handleBulkAction('submit')}
                className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-emerald-500 hover:bg-emerald-50">
                <Send className="w-6 h-6 text-emerald-500" />
                <div className="text-right">
                  <p className="font-bold text-slate-800">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                  <p className="text-sm text-slate-500">Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                </div> </button>
              <button onClick={() => handleBulkAction('escalate')}
                className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-orange-500 hover:bg-orange-50">
                <TrendingUp className="w-6 h-6 text-orange-500" />
                <div className="text-right">
                  <p className="font-bold text-slate-800">ØªØµØ¹ÙŠØ¯ Ø¬Ù…Ø§Ø¹ÙŠ</p>
                  <p className="text-sm text-slate-500">Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØµØ¹ÙŠØ¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
                </div> </button>
              <button onClick={() => handleBulkAction('delegate')}
                className="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-200 hover:border-indigo-500 hover:bg-indigo-50">
                <Users className="w-6 h-6 text-indigo-500" />
                <div className="text-right">
                  <p className="font-bold text-slate-800">ØªÙÙˆÙŠØ¶ Ø¬Ù…Ø§Ø¹ÙŠ</p>
                  <p className="text-sm text-slate-500">ØªÙÙˆÙŠØ¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ø´Ø®Øµ Ø¢Ø®Ø±</p>
                </div> </button> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => { setShowBulkModal(false); setSelectedTasks([]); }}
                className="w-full px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button> </div> </div> </div>
      )}

      {showEvidenceModal && selectedTask && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <XCircle className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„</h2>
                  <p className="text-red-200">{selectedTask.code}</p>
                </div> </div> </div>
            <div className="p-6 space-y-4">
              <div className="bg-slate-50 rounded-xl p-4">
                <h4 className="font-bold text-slate-800">{selectedTask.title}</h4>
                <p className="text-sm text-slate-500 mt-1">{selectedTask.evidenceFileName}</p>
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (Ù…Ø·Ù„ÙˆØ¨ 20 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„):</label>
                <textarea rows={4} placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none focus:outline-none focus:border-red-500"
                  id="rejectReason" />
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowEvidenceModal(false); setSelectedTask(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => {
                const reason = document.getElementById('rejectReason')?.value;
                handleRejectEvidence(selectedTask.id, reason);
              }}
                className="flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                <XCircle className="w-5 h-5" />ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶
              </button> </div> </div> </div>
      )}

      {showScheduleSetup && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-indigo-600 via-purple-600 to-violet-700 px-8 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <Settings className="w-8 h-8" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
                    <p className="text-white/80 text-sm">Advanced Schedule Setup - Enterprise Compliance Automation</p>
                  </div> </div>
                <div className="flex items-center gap-4">
                  <div className="text-center px-4 py-2 bg-white/10 backdrop-blur rounded-xl">
                    <p className="text-white/70 text-xs">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</p>
                    <p className="font-bold text-lg">{scheduleForm.obligationId ? 'âœ“ Ø¬Ø§Ù‡Ø²' : 'â—‹ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±'}</p>
                  </div>
                  <button onClick={() => setShowScheduleSetup(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="flex gap-1 bg-white/10 rounded-xl p-1">
                {[
                  { id: 0, label: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: Settings, desc: 'Basic Setup' },
                  { id: 1, label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', icon: Calendar, desc: 'Advanced Scheduling' },
                  { id: 2, label: 'Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©', icon: Users, desc: 'RACI & Assignments' },
                  { id: 3, label: 'Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ', icon: TrendingUp, desc: 'Smart Escalation' },
                  { id: 4, label: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', icon: Bell, desc: 'Multi-Channel Alerts' },
                  { id: 5, label: 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', icon: Eye, desc: 'Preview & Analytics' },
                ].map(tab => (
                  <button key={tab.id}
                    onClick={() => setScheduleForm({ ...scheduleForm, activeTab: tab.id })}
                    className={`flex-1 flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg font-bold transition-all ${(scheduleForm.activeTab || 0) === tab.id
                      ? 'bg-white text-purple-700 shadow-lg'
                      : 'text-white/80 hover:bg-white/10'
                      }`}>
                    <tab.icon className="w-4 h-4" />
                    <span className="text-sm">{tab.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">

              {(scheduleForm.activeTab || 0) === 0 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                      <label className="flex items-center gap-3 font-bold text-indigo-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm font-black">1</span>
                        <div>
                          <span className="block">Ø§Ø®ØªØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</span>
                          <span className="text-xs font-normal text-indigo-600">Select Regulatory Obligation</span>
                        </div>
                        <span className="text-red-500 mr-auto">*</span>
                      </label>
                      <select value={scheduleForm.obligationId} onChange={(e) => setScheduleForm({ ...scheduleForm, obligationId: e.target.value })}
                        className="w-full px-4 py-3.5 border-2 border-indigo-200 rounded-xl focus:border-indigo-500 focus:outline-none bg-white text-sm font-medium">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…...</option>
                        {INITIAL_OBLIGATIONS.filter(o => o.status === 'Active').map(obl => (
                          <option key={obl.id} value={obl.id}>{obl.code} - {obl.title}</option>
                        ))}
                      </select>

                      {scheduleForm.obligationId && (
                        <div className="mt-4 p-4 bg-white rounded-xl border border-indigo-200">
                          <div className="flex items-start gap-3">
                            <div className="w-10 h-10 rounded-lg bg-indigo-500 flex items-center justify-center text-white">
                              <FileText className="w-5 h-5" />
                            </div>
                            <div className="flex-1">
                              <p className="font-bold text-slate-800">{INITIAL_OBLIGATIONS.find(o => o.id === parseInt(scheduleForm.obligationId))?.title}</p>
                              <div className="flex items-center gap-2 mt-1">
                                <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">
                                  {INITIAL_OBLIGATIONS.find(o => o.id === parseInt(scheduleForm.obligationId))?.code}
                                </span>
                                <span className="px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-xs font-bold">Ù†Ø´Ø·</span>
                              </div> </div> </div> </div>
                      )}
                    </div>

                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm font-black">2</span>
                        <RefreshCw className="w-5 h-5 text-purple-500" />
                        <div>
                          <span className="block">Ø¯ÙˆØ±ÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø±</span>
                          <span className="text-xs font-normal text-slate-500">Recurrence Frequency</span>
                        </div>
                        <span className="text-red-500 mr-auto">*</span>
                      </label>
                      <div className="grid grid-cols-4 gap-2">
                        {[
                          { value: 'Daily', label: 'ÙŠÙˆÙ…ÙŠ', labelEn: 'Daily', icon: 'ğŸ“…', tasks: '365', color: 'red' },
                          { value: 'Weekly', label: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ', labelEn: 'Weekly', icon: 'ğŸ“†', tasks: '52', color: 'orange' },
                          { value: 'Monthly', label: 'Ø´Ù‡Ø±ÙŠ', labelEn: 'Monthly', icon: 'ğŸ—“ï¸', tasks: '12', color: 'amber' },
                          { value: 'Quarterly', label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', labelEn: 'Quarterly', icon: 'ğŸ“Š', tasks: '4', color: 'emerald' },
                          { value: 'SemiAnnual', label: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', labelEn: 'Semi-Annual', icon: 'ğŸ“ˆ', tasks: '2', color: 'blue' },
                          { value: 'Annual', label: 'Ø³Ù†ÙˆÙŠ', labelEn: 'Annual', icon: 'ğŸ¯', tasks: '1', color: 'indigo' },
                          { value: 'AdHoc', label: 'Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨', labelEn: 'Ad-Hoc', icon: 'âš¡', tasks: '-', color: 'purple' },
                          { value: 'Custom', label: 'Ù…Ø®ØµØµ', labelEn: 'Custom', icon: 'âš™ï¸', tasks: '?', color: 'slate' },
                        ].map(freq => {
                          const isSelected = scheduleForm.frequency === freq.value;
                          return (
                            <button key={freq.value} type="button"
                              onClick={() => setScheduleForm({ ...scheduleForm, frequency: freq.value })}
                              className={`flex flex-col items-center gap-1 p-3 rounded-xl border-2 transition-all ${isSelected
                                ? `border-${freq.color}-500 bg-${freq.color}-50 shadow-lg`
                                : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <span className="text-2xl">{freq.icon}</span>
                              <span className={`text-xs font-bold ${isSelected ? `text-${freq.color}-700` : 'text-slate-700'}`}>{freq.label}</span>
                              <span className="text-xs text-slate-500">{freq.labelEn}</span>
                              <span className={`text-xs font-bold mt-1 px-2 py-0.5 rounded ${isSelected ? `bg-${freq.color}-200 text-${freq.color}-800` : 'bg-slate-100 text-slate-600'}`}>
                                {freq.tasks} Ù…Ù‡Ù…Ø©/Ø³Ù†Ø©
                              </span> </button>);
                        })}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm font-black">3</span>
                        <AlertTriangle className="w-5 h-5 text-amber-500" />
                        <div>
                          <span className="block">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</span>
                          <span className="text-xs font-normal text-slate-500">Schedule Priority</span>
                        </div>
                      </label>
                      <div className="grid grid-cols-4 gap-2">
                        {[
                          { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red', icon: 'ğŸ”´' },
                          { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', icon: 'ğŸŸ ' },
                          { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', icon: 'ğŸŸ¡' },
                          { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald', icon: 'ğŸŸ¢' },
                        ].map(pri => {
                          const isSelected = (scheduleForm.priority || 'Medium') === pri.value;
                          return (
                            <button key={pri.value} type="button"
                              onClick={() => setScheduleForm({ ...scheduleForm, priority: pri.value })}
                              className={`flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${isSelected
                                ? `border-${pri.color}-500 bg-${pri.color}-50`
                                : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <span className="text-lg">{pri.icon}</span>
                              <span className={`text-sm font-bold ${isSelected ? `text-${pri.color}-700` : 'text-slate-700'}`}>{pri.label}</span>
                            </button>);
                        })}
                      </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                      <label className="flex items-center gap-3 font-bold text-amber-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm font-black">4</span>
                        <Calendar className="w-5 h-5 text-amber-600" />
                        <div>
                          <span className="block">Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</span>
                          <span className="text-xs font-normal text-amber-600">Schedule Date Range</span>
                        </div>
                      </label>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© *</label>
                          <input type="date" value={scheduleForm.startDate}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, startDate: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none bg-white" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                          <input type="date" value={scheduleForm.endDate}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, endDate: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none bg-white" />
                        </div> </div>
                      <div className="flex gap-2 mt-4">
                        <span className="text-xs text-slate-500 py-2">Ø§Ø®ØªØ± Ø³Ø±ÙŠØ¹:</span>
                        {[
                          { label: 'Ø³Ù†Ø© Ù…Ø§Ù„ÙŠØ©', months: 12 },
                          { label: 'Ø³Ù†ØªÙŠÙ†', months: 24 },
                          { label: '3 Ø³Ù†ÙˆØ§Øª', months: 36 },
                          { label: 'Ø¨Ø¯ÙˆÙ† Ù†Ù‡Ø§ÙŠØ©', months: 0 },
                        ].map(preset => (
                          <button key={preset.label} type="button"
                            onClick={() => {
                              const start = new Date().toISOString().split('T')[0];
                              const end = preset.months > 0
                                ? new Date(Date.now() + preset.months * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                                : '';
                              setScheduleForm({ ...scheduleForm, startDate: start, endDate: end });
                            }}
                            className="px-3 py-1.5 bg-white border border-amber-200 rounded-lg text-xs font-bold text-amber-700 hover:bg-amber-100 transition-all">
                            {preset.label}
                          </button>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm font-black">5</span>
                        <Clock className="w-5 h-5 text-blue-500" />
                        <div>
                          <span className="block">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© ÙˆØ³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</span>
                          <span className="text-xs font-normal text-slate-500">Time Zone & Working Hours</span>
                        </div>
                      </label>
                      <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label>
                          <select value={scheduleForm.timezone || 'Asia/Riyadh'}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, timezone: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            <option value="Asia/Riyadh">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø±ÙŠØ§Ø¶ (GMT+3)</option>
                            <option value="Asia/Dubai">ØªÙˆÙ‚ÙŠØª Ø¯Ø¨ÙŠ (GMT+4)</option>
                            <option value="Europe/London">ØªÙˆÙ‚ÙŠØª Ù„Ù†Ø¯Ù† (GMT+0)</option>
                            <option value="America/New_York">ØªÙˆÙ‚ÙŠØª Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ (GMT-5)</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ„ÙŠØ¯</label>
                          <input type="time" value={scheduleForm.generateTime || '08:00'}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, generateTime: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div> </div>
                      <label className="block text-xs font-bold text-slate-600 mb-2">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</label>
                      <div className="flex gap-2">
                        {[
                          { day: 'Sun', label: 'Ø£Ø­Ø¯' },
                          { day: 'Mon', label: 'Ø¥Ø«Ù†ÙŠÙ†' },
                          { day: 'Tue', label: 'Ø«Ù„Ø§Ø«Ø§Ø¡' },
                          { day: 'Wed', label: 'Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
                          { day: 'Thu', label: 'Ø®Ù…ÙŠØ³' },
                          { day: 'Fri', label: 'Ø¬Ù…Ø¹Ø©' },
                          { day: 'Sat', label: 'Ø³Ø¨Øª' },
                        ].map(d => {
                          const workDays = scheduleForm.workDays || ['Sun', 'Mon', 'Tue', 'Wed', 'Thu'];
                          const isSelected = workDays.includes(d.day);
                          return (
                            <button key={d.day} type="button"
                              onClick={() => {
                                const current = scheduleForm.workDays || ['Sun', 'Mon', 'Tue', 'Wed', 'Thu'];
                                const updated = isSelected
                                  ? current.filter(x => x !== d.day)
                                  : [...current, d.day];
                                setScheduleForm({ ...scheduleForm, workDays: updated });
                              }}
                              className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${isSelected
                                ? 'bg-blue-500 text-white'
                                : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                                }`}>
                              {d.label}
                            </button>);
                        })}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-sm font-black">6</span>
                        <Tag className="w-5 h-5 text-emerald-500" />
                        <div>
                          <span className="block">ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</span>
                          <span className="text-xs font-normal text-slate-500">Schedule Category</span>
                        </div>
                      </label>
                      <div className="grid grid-cols-3 gap-2">
                        {[
                          { value: 'Compliance', label: 'Ø§Ù…ØªØ«Ø§Ù„', icon: 'ğŸ“‹' },
                          { value: 'Audit', label: 'ØªØ¯Ù‚ÙŠÙ‚', icon: 'ğŸ”' },
                          { value: 'Risk', label: 'Ù…Ø®Ø§Ø·Ø±', icon: 'âš ï¸' },
                          { value: 'Control', label: 'Ø¶ÙˆØ§Ø¨Ø·', icon: 'ğŸ›¡ï¸' },
                          { value: 'Policy', label: 'Ø³ÙŠØ§Ø³Ø§Øª', icon: 'ğŸ“œ' },
                          { value: 'Training', label: 'ØªØ¯Ø±ÙŠØ¨', icon: 'ğŸ“' },
                        ].map(cat => {
                          const isSelected = (scheduleForm.category || 'Compliance') === cat.value;
                          return (
                            <button key={cat.value} type="button"
                              onClick={() => setScheduleForm({ ...scheduleForm, category: cat.value })}
                              className={`flex items-center gap-2 p-3 rounded-xl border-2 transition-all ${isSelected
                                ? 'border-emerald-500 bg-emerald-50'
                                : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <span className="text-xl">{cat.icon}</span>
                              <span className={`text-sm font-bold ${isSelected ? 'text-emerald-700' : 'text-slate-700'}`}>{cat.label}</span>
                            </button>);
                        })}
                      </div> </div> </div> </div>
              )}

              {(scheduleForm.activeTab || 0) === 1 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl p-5 border-2 border-purple-200">
                      <label className="flex items-center gap-3 font-bold text-purple-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">âš™ï¸</span>
                        <div>
                          <span className="block">Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø®ØµØµØ© Ù…ØªÙ‚Ø¯Ù…Ø©</span>
                          <span className="text-xs font-normal text-purple-600">Advanced Custom Scheduling</span>
                        </div>
                      </label>

                      <div className="space-y-4">
                        <div className="grid grid-cols-3 gap-3">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø±</label>
                            <select value={scheduleForm.cronDay || '1'}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, cronDay: e.target.value })}
                              className="w-full px-3 py-2.5 border-2 border-purple-200 rounded-xl focus:border-purple-500 focus:outline-none text-sm">
                              <option value="*">ÙƒÙ„ ÙŠÙˆÙ…</option>
                              <option value="1">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„</option>
                              <option value="15">Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ù‡Ø±</option>
                              <option value="L">Ø¢Ø®Ø± ÙŠÙˆÙ…</option>
                              {[...Array(28)].map((_, i) => (
                                <option key={i + 1} value={String(i + 1)}>Ø§Ù„ÙŠÙˆÙ… {i + 1}</option>
                              ))}
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">ÙŠÙˆÙ… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                            <select value={scheduleForm.cronWeekday || '*'}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, cronWeekday: e.target.value })}
                              className="w-full px-3 py-2.5 border-2 border-purple-200 rounded-xl focus:border-purple-500 focus:outline-none text-sm">
                              <option value="*">ÙƒÙ„ ÙŠÙˆÙ…</option>
                              <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                              <option value="1">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
                              <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                              <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                              <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù† Ø§Ù„Ø´Ù‡Ø±</label>
                            <select value={scheduleForm.cronWeek || '*'}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, cronWeek: e.target.value })}
                              className="w-full px-3 py-2.5 border-2 border-purple-200 rounded-xl focus:border-purple-500 focus:outline-none text-sm">
                              <option value="*">ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹</option>
                              <option value="1">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„</option>
                              <option value="2">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                              <option value="3">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                              <option value="4">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£Ø®ÙŠØ±</option>
                            </select>
                          </div> </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø£Ù†Ù…Ø§Ø· Ø³Ø±ÙŠØ¹Ø©</label>
                          <div className="flex flex-wrap gap-2">
                            {[
                              { label: 'Ø£ÙˆÙ„ Ø¥Ø«Ù†ÙŠÙ† Ù…Ù† ÙƒÙ„ Ø´Ù‡Ø±', pattern: { cronDay: '1-7', cronWeekday: '1', cronWeek: '1' } },
                              { label: 'Ø¢Ø®Ø± ÙŠÙˆÙ… Ø¹Ù…Ù„', pattern: { cronDay: 'LW', cronWeekday: '*', cronWeek: '*' } },
                              { label: 'ÙƒÙ„ Ø£Ø±Ø¨Ø¹Ø§Ø¡', pattern: { cronDay: '*', cronWeekday: '3', cronWeek: '*' } },
                              { label: 'Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ø±Ø¨Ø¹', pattern: { cronDay: 'L', cronWeekday: '*', cronWeek: '*' } },
                            ].map(p => (
                              <button key={p.label} type="button"
                                onClick={() => setScheduleForm({ ...scheduleForm, ...p.pattern })}
                                className="px-3 py-1.5 bg-white border border-purple-200 rounded-lg text-xs font-bold text-purple-700 hover:bg-purple-100 transition-all">
                                {p.label}
                              </button>
                            ))}
                          </div> </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-red-500 text-white flex items-center justify-center text-sm">ğŸ„</span>
                        <div>
                          <span className="block">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¹Ø·Ù„Ø§Øª</span>
                          <span className="text-xs font-normal text-slate-500">Holiday Calendar</span>
                        </div>
                      </label>

                      <div className="space-y-3">
                        <select value={scheduleForm.holidayCalendar || 'SA'}
                          onChange={(e) => setScheduleForm({ ...scheduleForm, holidayCalendar: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none">
                          <option value="SA">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                          <option value="UAE">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
                          <option value="US">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©</option>
                          <option value="UK">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©</option>
                          <option value="Custom">ØªÙ‚ÙˆÙŠÙ… Ù…Ø®ØµØµ</option>
                        </select>

                        <div className="flex gap-3">
                          {[
                            { value: 'skip', label: 'ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø·Ù„Ø§Øª', icon: 'â­ï¸' },
                            { value: 'before', label: 'Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø·Ù„Ø©', icon: 'â¬…ï¸' },
                            { value: 'after', label: 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø·Ù„Ø©', icon: 'â¡ï¸' },
                          ].map(opt => {
                            const isSelected = (scheduleForm.holidayBehavior || 'skip') === opt.value;
                            return (
                              <button key={opt.value} type="button"
                                onClick={() => setScheduleForm({ ...scheduleForm, holidayBehavior: opt.value })}
                                className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${isSelected ? 'border-red-500 bg-red-50' : 'border-slate-200 bg-white hover:border-slate-300'
                                  }`}>
                                <span>{opt.icon}</span>
                                <span className={`text-xs font-bold ${isSelected ? 'text-red-700' : 'text-slate-700'}`}>{opt.label}</span>
                              </button>);
                          })}
                        </div> </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                      <label className="flex items-center gap-3 font-bold text-amber-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm">ğŸ“†</span>
                        <div>
                          <span className="block">ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡</span>
                          <span className="text-xs font-normal text-amber-600">Exception Dates</span>
                        </div>
                      </label>

                      <div className="space-y-3">
                        <div className="flex gap-2">
                          <input type="date" className="flex-1 px-3 py-2.5 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none text-sm" />
                          <button type="button" className="px-4 py-2.5 bg-amber-500 text-white rounded-xl font-bold text-sm hover:bg-amber-600">
                            + Ø¥Ø¶Ø§ÙØ©
                          </button> </div>
                        <div className="bg-white rounded-xl p-3 border border-amber-200 max-h-32 overflow-y-auto">
                          {(scheduleForm.exceptionDates || []).length === 0 ? (
                            <p className="text-center text-slate-400 text-sm py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØ§Ø±ÙŠØ® Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
                          ) : (
                            <div className="space-y-2">
                            </div>
                          )}
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm">ğŸ“¦</span>
                          <div>
                            <span className="font-bold text-slate-800 block">Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯ÙØ¹Ø§Øª</span>
                            <span className="text-xs text-slate-500">Batch Processing</span>
                          </div> </div>
                        <label className="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" checked={scheduleForm.batchProcessing || false}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, batchProcessing: e.target.checked })}
                            className="sr-only peer" />
                          <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                        </label>
                      </label>

                      {scheduleForm.batchProcessing && (
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø­Ø¬Ù… Ø§Ù„Ø¯ÙØ¹Ø©</label>
                            <input type="number" value={scheduleForm.batchSize || 10}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, batchSize: parseInt(e.target.value) })}
                              className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none text-sm" min="1" max="100" />
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙØ§ØµÙ„ (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                            <input type="number" value={scheduleForm.batchInterval || 5}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, batchInterval: parseInt(e.target.value) })}
                              className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none text-sm" min="1" max="60" />
                          </div> </div>
                      )}
                    </div>

                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm">ğŸ”—</span>
                        <div>
                          <span className="block">Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª</span>
                          <span className="text-xs font-normal text-slate-500">Dependency Chain</span>
                        </div>
                      </label>

                      <select value={scheduleForm.dependsOn || ''}
                        onChange={(e) => setScheduleForm({ ...scheduleForm, dependsOn: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                        <option value="">Ø¨Ø¯ÙˆÙ† ØªØ¨Ø¹ÙŠØ§Øª</option>
                        <option value="schedule-1">Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</option>
                        <option value="schedule-2">Ø¬Ø¯ÙˆÙ„Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</option>
                        <option value="schedule-3">Ø¬Ø¯ÙˆÙ„Ø© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                      </select>

                      <p className="text-xs text-slate-500 mt-2">Ù„Ù† ØªØ¨Ø¯Ø£ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                    </div> </div> </div>
              )}

              {(scheduleForm.activeTab || 0) === 2 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-5 border-2 border-blue-200">
                    <label className="flex items-center gap-3 font-bold text-blue-800 mb-4">
                      <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm">ğŸ‘¥</span>
                      <div>
                        <span className="block">Ù…ØµÙÙˆÙØ© RACI</span>
                        <span className="text-xs font-normal text-blue-600">Responsibility Assignment Matrix</span>
                      </div>
                    </label>

                    <div className="space-y-4">
                      {[
                        { role: 'R', label: 'Ù…Ø³Ø¤ÙˆÙ„ (Responsible)', desc: 'Ù…Ù† ÙŠÙ†ÙØ° Ø§Ù„Ù…Ù‡Ù…Ø©', color: 'emerald' },
                        { role: 'A', label: 'Ù…ÙØ­Ø§Ø³ÙØ¨ (Accountable)', desc: 'Ù…Ù† ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©', color: 'blue' },
                        { role: 'C', label: 'Ù…ÙØ³ØªØ´Ø§Ø± (Consulted)', desc: 'Ù…Ù† ÙŠÙØ³ØªØ´Ø§Ø± Ù‚Ø¨Ù„ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±', color: 'amber' },
                        { role: 'I', label: 'Ù…ÙØ¨Ù„ÙÙ‘Øº (Informed)', desc: 'Ù…Ù† ÙŠÙØ¨Ù„ÙÙ‘Øº Ø¨Ø§Ù„Ù†ØªØ§Ø¦Ø¬', color: 'purple' },
                      ].map(r => (
                        <div key={r.role} className="bg-white rounded-xl p-4 border border-slate-200">
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center gap-2">
                              <span className={`w-8 h-8 rounded-lg bg-${r.color}-500 text-white flex items-center justify-center font-black`}>{r.role}</span>
                              <div>
                                <span className="font-bold text-slate-800 text-sm block">{r.label}</span>
                                <span className="text-xs text-slate-500">{r.desc}</span>
                              </div> </div> </div>
                          <select
                            value={scheduleForm[`raci${r.role}`] || ''}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, [`raci${r.role}`]: e.target.value })}
                            className={`w-full px-3 py-2.5 border-2 border-${r.color}-200 rounded-xl focus:border-${r.color}-500 focus:outline-none text-sm`}>
                            <option value="">Ø§Ø®ØªØ±...</option>
                            {USERS.map(u => <option key={u.id} value={u.id}>{u.name} - {u.role}</option>)}
                          </select>
                        </div>
                      ))}
                    </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                      <label className="flex items-center gap-3 font-bold text-amber-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm">ğŸ”„</span>
                        <div>
                          <span className="block">Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠÙŠÙ†</span>
                          <span className="text-xs font-normal text-amber-600">Backup Assignees</span>
                        </div>
                      </label>

                      <div className="space-y-3">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„</label>
                          <select value={scheduleForm.backup1 || ''}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, backup1: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„...</option>
                            {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                          </select>
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                          <select value={scheduleForm.backup2 || ''}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, backup2: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„...</option>
                            {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                          </select>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">âš–ï¸</span>
                          <div>
                            <span className="font-bold text-slate-800 block">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø°ÙƒÙŠ</span>
                            <span className="text-xs text-slate-500">AI Workload Balancing</span>
                          </div> </div>
                        <label className="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" checked={scheduleForm.workloadBalance || false}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, workloadBalance: e.target.checked })}
                            className="sr-only peer" />
                          <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"></div>
                        </label>
                      </label>

                      <p className="text-xs text-slate-500">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ù…Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                    </div>

                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm">ğŸ”€</span>
                        <div>
                          <span className="block">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                          <span className="text-xs font-normal text-slate-500">Auto-delegation Rules</span>
                        </div>
                      </label>

                      <div className="space-y-2">
                        {[
                          { value: 'vacation', label: 'Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª', icon: 'ğŸ–ï¸' },
                          { value: 'overload', label: 'Ø¹Ù†Ø¯ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ù…Ù„', icon: 'ğŸ“ˆ' },
                          { value: 'absence', label: 'Ø¹Ù†Ø¯ Ø§Ù„ØºÙŠØ§Ø¨', icon: 'ğŸš«' },
                        ].map(rule => (
                          <label key={rule.value} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-all">
                            <input type="checkbox"
                              checked={(scheduleForm.delegationRules || []).includes(rule.value)}
                              onChange={(e) => {
                                const current = scheduleForm.delegationRules || [];
                                const updated = e.target.checked
                                  ? [...current, rule.value]
                                  : current.filter(x => x !== rule.value);
                                setScheduleForm({ ...scheduleForm, delegationRules: updated });
                              }}
                              className="w-5 h-5 rounded text-indigo-500" />
                            <span className="text-lg">{rule.icon}</span>
                            <span className="text-sm font-bold text-slate-700">{rule.label}</span>
                          </label>
                        ))}
                      </div> </div> </div> </div>
              )}

              {(scheduleForm.activeTab || 0) === 3 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="bg-gradient-to-br from-red-50 to-orange-50 rounded-2xl p-5 border-2 border-red-200">
                    <label className="flex items-center gap-3 font-bold text-red-800 mb-4">
                      <span className="w-8 h-8 rounded-xl bg-red-500 text-white flex items-center justify-center text-sm">ğŸš¨</span>
                      <div>
                        <span className="block">Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªØµØ¹ÙŠØ¯ (4 Ù…Ø³ØªÙˆÙŠØ§Øª)</span>
                        <span className="text-xs font-normal text-red-600">4-Level Escalation Chain</span>
                      </div>
                    </label>

                    <div className="space-y-3">
                      {[
                        { level: 1, label: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„', desc: 'ØªØ°ÙƒÙŠØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', color: 'amber', defaultDays: 1 },
                        { level: 2, label: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ', desc: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', color: 'orange', defaultDays: 2 },
                        { level: 3, label: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«', desc: 'Ø¥Ø¨Ù„Ø§Øº Ù…Ø¯ÙŠØ± Ø§Ù„Ù‚Ø³Ù…', color: 'red', defaultDays: 3 },
                        { level: 4, label: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹', desc: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§', color: 'rose', defaultDays: 5 },
                      ].map(esc => (
                        <div key={esc.level} className={`bg-white rounded-xl p-4 border-2 border-${esc.color}-200`}>
                          <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center gap-2">
                              <span className={`w-7 h-7 rounded-lg bg-${esc.color}-500 text-white flex items-center justify-center text-sm font-bold`}>{esc.level}</span>
                              <div>
                                <span className="font-bold text-slate-800 text-sm block">{esc.label}</span>
                                <span className="text-xs text-slate-500">{esc.desc}</span>
                              </div> </div>
                            <label className="flex items-center gap-2 cursor-pointer">
                              <input type="checkbox"
                                checked={(scheduleForm[`escLevel${esc.level}`] !== false)}
                                onChange={(e) => setScheduleForm({ ...scheduleForm, [`escLevel${esc.level}`]: e.target.checked })}
                                className={`w-5 h-5 rounded text-${esc.color}-500`} />
                            </label>
                          </div>
                          <div className="grid grid-cols-2 gap-2">
                            <div>
                              <label className="block text-xs text-slate-500 mb-1">Ø¨Ø¹Ø¯ (Ø£ÙŠØ§Ù…)</label>
                              <input type="number"
                                value={scheduleForm[`escDays${esc.level}`] || esc.defaultDays}
                                onChange={(e) => setScheduleForm({ ...scheduleForm, [`escDays${esc.level}`]: parseInt(e.target.value) })}
                                className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm" min="1" max="14" />
                            </div>
                            <div>
                              <label className="block text-xs text-slate-500 mb-1">Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø¥Ù„Ù‰</label>
                              <select
                                value={scheduleForm[`escTo${esc.level}`] || ''}
                                onChange={(e) => setScheduleForm({ ...scheduleForm, [`escTo${esc.level}`]: e.target.value })}
                                className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm">
                                <option value="">ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
                                {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                              </select>
                            </div> </div> </div>
                      ))}
                    </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                      <label className="flex items-center gap-3 font-bold text-emerald-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-sm">â±ï¸</span>
                        <div>
                          <span className="block">Ø§ØªÙØ§Ù‚ÙŠØ© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¯Ù…Ø© (SLA)</span>
                          <span className="text-xs font-normal text-emerald-600">Service Level Agreement</span>
                        </div>
                      </label>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ù‡Ø¯Ù Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (%)</label>
                          <input type="number" value={scheduleForm.slaTarget || 95}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, slaTarget: parseInt(e.target.value) })}
                            className="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-emerald-500 focus:outline-none" min="50" max="100" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ£Ø®ÙŠØ± (Ø£ÙŠØ§Ù…)</label>
                          <input type="number" value={scheduleForm.slaMaxDelay || 5}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, slaMaxDelay: parseInt(e.target.value) })}
                            className="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-emerald-500 focus:outline-none" min="1" max="30" />
                        </div> </div>
                      <div className="mt-4 p-3 bg-emerald-100 rounded-xl">
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-emerald-700">Ù‡Ø¯Ù SLA Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                          <span className="font-bold text-emerald-800">{scheduleForm.slaTarget || 95}% Ø®Ù„Ø§Ù„ {scheduleForm.slaMaxDelay || 5} Ø£ÙŠØ§Ù…</span>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm">â°</span>
                        <div>
                          <span className="block">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ ÙˆØ§Ù„ØªØ°ÙƒÙŠØ±</span>
                          <span className="text-xs font-normal text-slate-500">Grace Period & Reminders</span>
                        </div>
                      </label>

                      <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ (Ø£ÙŠØ§Ù…)</label>
                            <input type="number" value={scheduleForm.reminderDays || 7}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, reminderDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none" min="1" max="30" />
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-600 mb-2">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ (Ø£ÙŠØ§Ù…)</label>
                            <input type="number" value={scheduleForm.graceperiodDays || 3}
                              onChange={(e) => setScheduleForm({ ...scheduleForm, graceperiodDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none" min="0" max="14" />
                          </div> </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ØªÙƒØ±Ø§Ø± Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                          <div className="flex gap-2">
                            {[
                              { value: 'once', label: 'Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©' },
                              { value: 'daily', label: 'ÙŠÙˆÙ…ÙŠØ§Ù‹' },
                              { value: 'twice', label: 'Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹' },
                            ].map(opt => {
                              const isSelected = (scheduleForm.reminderFreq || 'daily') === opt.value;
                              return (
                                <button key={opt.value} type="button"
                                  onClick={() => setScheduleForm({ ...scheduleForm, reminderFreq: opt.value })}
                                  className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all ${isSelected ? 'bg-blue-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                    }`}>
                                  {opt.label}
                                </button>);
                            })}
                          </div> </div> </div> </div> </div> </div>
              )}

              {(scheduleForm.activeTab || 0) === 4 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                    <label className="flex items-center gap-3 font-bold text-indigo-800 mb-4">
                      <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm">ğŸ“¢</span>
                      <div>
                        <span className="block">Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                        <span className="text-xs font-normal text-indigo-600">Multi-Channel Notifications</span>
                      </div>
                    </label>

                    <div className="space-y-3">
                      {[
                        { channel: 'email', label: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', icon: 'ğŸ“§', desc: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ø¨Ø± Email' },
                        { channel: 'sms', label: 'Ø±Ø³Ø§Ø¦Ù„ SMS', icon: 'ğŸ“±', desc: 'Ø±Ø³Ø§Ø¦Ù„ Ù†ØµÙŠØ© Ù‚ØµÙŠØ±Ø©' },
                        { channel: 'inApp', label: 'Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', icon: 'ğŸ””', desc: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©' },
                        { channel: 'teams', label: 'Microsoft Teams', icon: 'ğŸ’¬', desc: 'Ù‚Ù†Ø§Ø© Teams' },
                        { channel: 'slack', label: 'Slack', icon: 'ğŸ’¼', desc: 'Ù‚Ù†Ø§Ø© Slack' },
                        { channel: 'whatsapp', label: 'WhatsApp Business', icon: 'ğŸ“²', desc: 'Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨' },
                      ].map(ch => (
                        <label key={ch.channel} className="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-200 cursor-pointer hover:border-indigo-300 transition-all">
                          <div className="flex items-center gap-3">
                            <span className="text-2xl">{ch.icon}</span>
                            <div>
                              <span className="font-bold text-slate-800 text-sm block">{ch.label}</span>
                              <span className="text-xs text-slate-500">{ch.desc}</span>
                            </div> </div>
                          <label className="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox"
                              checked={(scheduleForm.channels || ['email', 'inApp']).includes(ch.channel)}
                              onChange={(e) => {
                                const current = scheduleForm.channels || ['email', 'inApp'];
                                const updated = e.target.checked
                                  ? [...current, ch.channel]
                                  : current.filter(x => x !== ch.channel);
                                setScheduleForm({ ...scheduleForm, channels: updated });
                              }}
                              className="sr-only peer" />
                            <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-500"></div>
                          </label>
                        </label>
                      ))}
                    </div> </div>
                  <div className="space-y-5">
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">ğŸ“‹</span>
                        <div>
                          <span className="block">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                          <span className="text-xs font-normal text-slate-500">Notification Events</span>
                        </div>
                      </label>

                      <div className="space-y-2">
                        {[
                          { event: 'created', label: 'Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©', icon: 'âœ¨' },
                          { event: 'reminder', label: 'Ø¹Ù†Ø¯ Ø§Ù„ØªØ°ÙƒÙŠØ±', icon: 'â°' },
                          { event: 'due', label: 'Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚', icon: 'ğŸ“…' },
                          { event: 'overdue', label: 'Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ±', icon: 'âš ï¸' },
                          { event: 'escalated', label: 'Ø¹Ù†Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯', icon: 'ğŸš¨' },
                          { event: 'completed', label: 'Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„', icon: 'âœ…' },
                        ].map(ev => (
                          <label key={ev.event} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-all">
                            <input type="checkbox"
                              checked={(scheduleForm.events || ['created', 'reminder', 'due', 'overdue']).includes(ev.event)}
                              onChange={(e) => {
                                const current = scheduleForm.events || ['created', 'reminder', 'due', 'overdue'];
                                const updated = e.target.checked
                                  ? [...current, ev.event]
                                  : current.filter(x => x !== ev.event);
                                setScheduleForm({ ...scheduleForm, events: updated });
                              }}
                              className="w-5 h-5 rounded text-purple-500" />
                            <span className="text-lg">{ev.icon}</span>
                            <span className="text-sm font-bold text-slate-700">{ev.label}</span>
                          </label>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm">ğŸ“Š</span>
                          <div>
                            <span className="font-bold text-slate-800 block">Ù…Ù„Ø®Øµ ÙŠÙˆÙ…ÙŠ</span>
                            <span className="text-xs text-slate-500">Daily Digest</span>
                          </div> </div>
                        <label className="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" checked={scheduleForm.dailyDigest || false}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, dailyDigest: e.target.checked })}
                            className="sr-only peer" />
                          <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500"></div>
                        </label>
                      </label>

                      {scheduleForm.dailyDigest && (
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ÙˆÙ‚Øª Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø®Øµ</label>
                          <input type="time" value={scheduleForm.digestTime || '08:00'}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, digestTime: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                        </div>
                      )}
                    </div> </div> </div>
              )}

              {(scheduleForm.activeTab || 0) === 5 && (
                <div className="grid grid-cols-3 gap-6">
                  <div className="col-span-2 bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-5 border-2 border-slate-200">
                    <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                      <span className="w-8 h-8 rounded-xl bg-slate-500 text-white flex items-center justify-center text-sm">ğŸ“Š</span>
                      <div>
                        <span className="block">Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</span>
                        <span className="text-xs font-normal text-slate-500">Schedule Summary</span>
                      </div>
                    </label>

                    {scheduleForm.obligationId ? (
                      <div className="grid grid-cols-3 gap-4">
                        {[
                          { label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', value: INITIAL_OBLIGATIONS.find(o => o.id === parseInt(scheduleForm.obligationId))?.code || '-', color: 'indigo' },
                          { label: 'Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', value: scheduleForm.frequency === 'Monthly' ? 'Ø´Ù‡Ø±ÙŠ' : scheduleForm.frequency === 'Quarterly' ? 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ' : scheduleForm.frequency || '-', color: 'purple' },
                          { label: 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©', value: scheduleForm.priority === 'Critical' ? 'Ø­Ø±Ø¬' : scheduleForm.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                          { label: 'Ø§Ù„Ù…Ù‡Ø§Ù…/Ø³Ù†Ø©', value: scheduleForm.frequency === 'Daily' ? '365' : scheduleForm.frequency === 'Weekly' ? '52' : scheduleForm.frequency === 'Monthly' ? '12' : scheduleForm.frequency === 'Quarterly' ? '4' : '1', color: 'emerald' },
                          { label: 'Ø§Ù„ØªØ°ÙƒÙŠØ±', value: `Ù‚Ø¨Ù„ ${scheduleForm.reminderDays || 7} Ø£ÙŠØ§Ù…`, color: 'blue' },
                          { label: 'SLA', value: `${scheduleForm.slaTarget || 95}%`, color: 'teal' },
                        ].map((item, idx) => (
                          <div key={idx} className={`bg-white rounded-xl p-4 border-2 border-${item.color}-200`}>
                            <p className="text-xs text-slate-500 mb-1">{item.label}</p>
                            <p className={`text-lg font-bold text-${item.color}-600`}>{item.value}</p>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-10 text-slate-400">
                        <Calendar className="w-12 h-12 mx-auto mb-3 opacity-50" />
                        <p>Ø§Ø®ØªØ± Ø§Ù„ØªØ²Ø§Ù… Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</p>
                      </div>
                    )}

                    {scheduleForm.obligationId && (
                      <div className="mt-6">
                        <h4 className="font-bold text-slate-700 mb-3">ğŸ“… Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø§Ù„Ù€ 3 Ø£Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©)</h4>
                        <div className="grid grid-cols-3 gap-4">
                          {['ÙŠÙ†Ø§ÙŠØ± 2025', 'ÙØ¨Ø±Ø§ÙŠØ± 2025', 'Ù…Ø§Ø±Ø³ 2025'].map((month, idx) => (
                            <div key={month} className="bg-white rounded-xl p-4 border border-slate-200">
                              <h5 className="text-sm font-bold text-slate-700 mb-2 text-center">{month}</h5>
                              <div className="grid grid-cols-7 gap-1">
                                {['Ø£', 'Ø¥', 'Ø«', 'Ø£Ø±', 'Ø®', 'Ø¬', 'Ø³'].map(d => (
                                  <span key={d} className="text-xs text-slate-400 text-center">{d}</span>
                                ))}
                                {[...Array(35)].map((_, i) => {
                                  const day = i - (idx * 2) + 1;
                                  const isTask = scheduleForm.frequency === 'Monthly' && day === 1;
                                  return (
                                    <span key={i} className={`text-xs text-center py-1 rounded ${day < 1 || day > 31 ? 'text-transparent' :
                                      isTask ? 'bg-indigo-500 text-white font-bold' : 'text-slate-600'
                                      }`}>
                                      {day > 0 && day <= 31 ? day : ''}
                                    </span>);
                                })}
                              </div> </div>
                          ))}
                        </div> </div>
                    )}
                  </div>

                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                      <label className="flex items-center gap-3 font-bold text-emerald-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-sm">ğŸ“ˆ</span>
                        <div>
                          <span className="block">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠØ©</span>
                          <span className="text-xs font-normal text-emerald-600">Predictive Analytics</span>
                        </div>
                      </label>

                      <div className="space-y-3">
                        <div className="bg-white rounded-xl p-3 flex items-center justify-between">
                          <span className="text-sm text-slate-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span>
                          <span className="font-bold text-emerald-600">92%</span>
                        </div>
                        <div className="bg-white rounded-xl p-3 flex items-center justify-between">
                          <span className="text-sm text-slate-600">Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±</span>
                          <span className="font-bold text-amber-600">15%</span>
                        </div>
                        <div className="bg-white rounded-xl p-3 flex items-center justify-between">
                          <span className="text-sm text-slate-600">Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹/Ø´Ù‡Ø±</span>
                          <span className="font-bold text-blue-600">Ù…ØªÙˆØ³Ø·</span>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center">
                            <Zap className="w-5 h-5 text-violet-600" />
                          </div>
                          <div>
                            <span className="font-bold text-slate-800 block">Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                            <span className="text-xs text-slate-500">Auto Generate Tasks</span>
                          </div> </div>
                        <label className="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" checked={scheduleForm.autoGenerate !== false}
                            onChange={(e) => setScheduleForm({ ...scheduleForm, autoGenerate: e.target.checked })}
                            className="sr-only peer" />
                          <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-violet-500"></div>
                        </label>
                      </label>
                    </div>

                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-3 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm">âœ“</span>
                        <span>Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</span>
                      </label>

                      <div className="space-y-2">
                        {[
                          { check: !!scheduleForm.obligationId, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù…Ø­Ø¯Ø¯' },
                          { check: !!scheduleForm.frequency, label: 'Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©' },
                          { check: !!scheduleForm.startDate, label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©' },
                          { check: !!scheduleForm.raciR, label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø­Ø¯Ø¯' },
                        ].map((item, idx) => (
                          <div key={idx} className="flex items-center gap-2">
                            <span className={`w-5 h-5 rounded-full flex items-center justify-center text-xs ${item.check ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-500'}`}>
                              {item.check ? 'âœ“' : 'â—‹'}
                            </span>
                            <span className={`text-sm ${item.check ? 'text-slate-800' : 'text-slate-400'}`}>{item.label}</span>
                          </div>
                        ))}
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-8 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <button onClick={() => setShowScheduleSetup(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white text-sm">
                  Ø¥Ù„ØºØ§Ø¡
                </button> </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setScheduleForm({ ...scheduleForm, activeTab: Math.max(0, (scheduleForm.activeTab || 0) - 1) })}
                  disabled={(scheduleForm.activeTab || 0) === 0}
                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold transition-all ${(scheduleForm.activeTab || 0) === 0
                    ? 'bg-slate-100 text-slate-300 cursor-not-allowed'
                    : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-purple-500'
                    }`}>
                  <ChevronRight className="w-4 h-4" />
                  <span className="text-sm">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
                </button>

                <div className="flex items-center gap-1 px-3 py-2 bg-white border-2 border-slate-200 rounded-xl">
                  {[0, 1, 2, 3, 4, 5].map(idx => (
                    <button key={idx}
                      onClick={() => setScheduleForm({ ...scheduleForm, activeTab: idx })}
                      className={`w-8 h-8 rounded-lg font-bold text-sm transition-all ${(scheduleForm.activeTab || 0) === idx
                        ? 'bg-purple-500 text-white'
                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                        }`}>
                      {idx + 1}
                    </button>
                  ))}
                </div>

                <button
                  onClick={() => setScheduleForm({ ...scheduleForm, activeTab: Math.min(5, (scheduleForm.activeTab || 0) + 1) })}
                  disabled={(scheduleForm.activeTab || 0) === 5}
                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold transition-all ${(scheduleForm.activeTab || 0) === 5
                    ? 'bg-slate-100 text-slate-300 cursor-not-allowed'
                    : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-purple-500'
                    }`}>
                  <span className="text-sm">Ø§Ù„ØªØ§Ù„ÙŠ</span>
                  <ChevronLeft className="w-4 h-4" />
                </button> </div>
              <div className="flex items-center gap-3">
                <button onClick={() => {
                  setScheduleForm({
                    obligationId: '', frequency: 'Monthly', startDate: '', endDate: '',
                    ownerId: '', reviewerId: '', reminderDays: 7, autoGenerate: true,
                    graceperiodDays: 3, escalationEnabled: true, escalationDays: 2, activeTab: 0
                  });
                }} className="px-4 py-3 text-slate-500 hover:text-slate-700 font-bold text-sm flex items-center gap-2">
                  <RotateCcw className="w-4 h-4" />
                  Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
                <button onClick={() => {
                  if (!scheduleForm.obligationId) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…');
                    return;
                  }
                  alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                  setShowScheduleSetup(false);
                }} disabled={!scheduleForm.obligationId}
                  className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-violet-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                  <Save className="w-5 h-5" />
                  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
                  <ChevronLeft className="w-4 h-4" />
                </button> </div> </div> </div> </div>
      )}
    </div>);
};

const EvidenceRepository = () => {
  const { can, currentUser, guardAction } = useAuth();

  const [activeTab, setActiveTab] = useState('repository');
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterType, setFilterType] = useState('');
  const [viewMode, setViewMode] = useState('table');
  const [showUploadModal, setShowUploadModal] = useState(false);
  const [showReviewModal, setShowReviewModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [showPackModal, setShowPackModal] = useState(false);
  const [selectedEvidence, setSelectedEvidence] = useState(null);
  const [rejectComment, setRejectComment] = useState('');
  const [selectedItems, setSelectedItems] = useState([]);
  const [sortField, setSortField] = useState('code');
  const [sortDirection, setSortDirection] = useState('desc');
  const [dragOver, setDragOver] = useState(false);
  const [showDocModal, setShowDocModal] = useState(false);
  const [docModalMode, setDocModalMode] = useState('create'); // create | edit | view
  const [selectedDoc, setSelectedDoc] = useState(null);
  const [showDocDeleteConfirm, setShowDocDeleteConfirm] = useState(false);
  const [docForm, setDocForm] = useState({
    titleAr: '', titleEn: '', docType: 'Policy', classification: 'Internal',
    version: 'v1.0', description: '', ownerId: 2
  });

  // Evidence Data - Enhanced
  const [evidence, setEvidence] = useState([
    { id: 1, code: 'EVD-000001', evidenceType: 'Report', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ - ÙŠÙ†Ø§ÙŠØ± 2025', fileName: 'compliance_jan_2025.pdf', fileSize: '1.2 MB', checksumSha256: 'f6g7h8i9...', validityStart: '2025-01-01', validityEnd: '2025-01-31', status: 'Accepted', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', reviewerComment: null, acceptedAt: '2025-01-28', period: '2025-01', linkedObligations: ['OBL-001', 'OBL-002'], linkedControls: ['CTR-001'], tags: ['Ø´Ù‡Ø±ÙŠ', 'SAMA'], priority: 'High', confidentiality: 'Confidential' },
    { id: 2, code: 'EVD-000002', evidenceType: 'Screenshot', title: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù†Ø¸Ø§Ù… KYC', fileName: 'kyc_screenshot.png', fileSize: '856 KB', checksumSha256: 'g7h8i9j0...', validityStart: '2025-01-01', validityEnd: '2025-03-31', status: 'Accepted', ownerId: 2, ownerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', reviewerId: 3, reviewerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerComment: null, acceptedAt: '2025-01-20', period: 'Q1-2025', linkedObligations: ['OBL-003'], linkedControls: ['CTR-002'], tags: ['KYC', 'AML'], priority: 'Medium', confidentiality: 'Internal' },
    { id: 3, code: 'EVD-000003', evidenceType: 'Certificate', title: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', fileName: 'pentest_cert.pdf', fileSize: '520 KB', checksumSha256: 'h8i9j0k1...', validityStart: '2025-01-15', validityEnd: '2026-01-15', status: 'Accepted', ownerId: 3, ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerComment: null, acceptedAt: '2025-01-22', period: '2025', linkedObligations: ['OBL-010'], linkedControls: ['CTR-005'], tags: ['Ø£Ù…Ù† Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'Pentest'], priority: 'Critical', confidentiality: 'Confidential' },
    { id: 4, code: 'EVD-000004', evidenceType: 'Log', title: 'Ø³Ø¬Ù„ ØªØ¯Ø±ÙŠØ¨ AML - ÙŠÙ†Ø§ÙŠØ±', fileName: 'aml_training.xlsx', fileSize: '245 KB', checksumSha256: 'i9j0k1l2...', validityStart: '2025-01-01', validityEnd: '2025-12-31', status: 'UnderReview', ownerId: 4, ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', reviewerComment: null, acceptedAt: null, period: '2025-01', linkedObligations: ['OBL-002'], linkedControls: [], tags: ['ØªØ¯Ø±ÙŠØ¨'], priority: 'Medium', confidentiality: 'Internal' },
    { id: 5, code: 'EVD-000005', evidenceType: 'Config', title: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firewall', fileName: 'firewall_config.xml', fileSize: '128 KB', checksumSha256: 'j0k1l2m3...', validityStart: '2025-01-01', validityEnd: '2025-06-30', status: 'UnderReview', ownerId: 3, ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerId: 5, reviewerName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', reviewerComment: null, acceptedAt: null, period: 'Q1-2025', linkedObligations: ['OBL-011'], linkedControls: ['CTR-004'], tags: ['Ø£Ù…Ù† Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'Firewall'], priority: 'High', confidentiality: 'Confidential' },
    { id: 6, code: 'EVD-000006', evidenceType: 'Report', title: 'ØªÙ‚Ø±ÙŠØ± STR - Ø¯ÙŠØ³Ù…Ø¨Ø± 2024', fileName: 'str_dec2024.pdf', fileSize: '890 KB', checksumSha256: 'k1l2m3n4...', validityStart: '2024-12-01', validityEnd: '2024-12-31', status: 'Expired', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', reviewerComment: null, acceptedAt: '2024-12-28', period: '2024-12', linkedObligations: ['OBL-003'], linkedControls: [], tags: ['STR', 'Ø´Ù‡Ø±ÙŠ'], priority: 'Critical', confidentiality: 'Confidential' },
    { id: 7, code: 'EVD-000007', evidenceType: 'Screenshot', title: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', fileName: 'monitoring.png', fileSize: '1.1 MB', checksumSha256: 'm3n4o5p6...', validityStart: '2025-01-01', validityEnd: '2025-02-28', status: 'Rejected', ownerId: 6, ownerName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ', reviewerId: 3, reviewerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerComment: 'Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø© ÙˆÙ„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®', acceptedAt: null, period: '2025-01', linkedObligations: [], linkedControls: ['CTR-005'], tags: ['Ù…Ø±Ø§Ù‚Ø¨Ø©'], priority: 'Medium', confidentiality: 'Internal' },
    { id: 8, code: 'EVD-000008', evidenceType: 'Report', title: 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ', fileName: 'risk_2025.pdf', fileSize: '4.5 MB', checksumSha256: 'n4o5p6q7...', validityStart: '2025-01-01', validityEnd: '2025-12-31', status: 'Uploaded', ownerId: 5, ownerName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', reviewerId: null, reviewerName: null, reviewerComment: null, acceptedAt: null, period: '2025', linkedObligations: ['OBL-008'], linkedControls: [], tags: ['Ù…Ø®Ø§Ø·Ø±', 'Ø³Ù†ÙˆÙŠ'], priority: 'High', confidentiality: 'Confidential' },
    { id: 9, code: 'EVD-000009', evidenceType: 'Report', title: 'ØªÙ‚Ø±ÙŠØ± ÙØ¨Ø±Ø§ÙŠØ± - Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯', fileName: null, fileSize: null, checksumSha256: null, validityStart: '2025-02-01', validityEnd: '2025-02-28', status: 'PendingUpload', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerId: 2, reviewerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', reviewerComment: null, acceptedAt: null, period: '2025-02', linkedObligations: ['OBL-001'], linkedControls: [], tags: ['Ø´Ù‡Ø±ÙŠ'], priority: 'High', confidentiality: 'Internal' },
    { id: 10, code: 'EVD-000010', evidenceType: 'Certificate', title: 'Ø´Ù‡Ø§Ø¯Ø© ISO 27001', fileName: 'iso27001.pdf', fileSize: '680 KB', checksumSha256: 'o5p6q7r8...', validityStart: '2024-06-01', validityEnd: '2027-06-01', status: 'Accepted', ownerId: 3, ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerComment: null, acceptedAt: '2024-06-15', period: '2024-2027', linkedObligations: ['OBL-009', 'OBL-010'], linkedControls: ['CTR-004', 'CTR-005'], tags: ['ISO', 'Ø´Ù‡Ø§Ø¯Ø©'], priority: 'Critical', confidentiality: 'Public' },
    { id: 11, code: 'EVD-000011', evidenceType: 'Attestation', title: 'Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', fileName: 'mgmt_attestation.pdf', fileSize: '156 KB', checksumSha256: 'p6q7r8s9...', validityStart: '2025-01-01', validityEnd: '2025-12-31', status: 'Accepted', ownerId: 7, ownerName: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerComment: null, acceptedAt: '2025-01-05', period: '2025', linkedObligations: ['OBL-001'], linkedControls: [], tags: ['Ø¥Ù‚Ø±Ø§Ø±', 'Ø¥Ø¯Ø§Ø±Ø©'], priority: 'Critical', confidentiality: 'Confidential' },
    { id: 12, code: 'EVD-000012', evidenceType: 'Procedure', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø«', fileName: 'cdd_procedure_v3.pdf', fileSize: '2.3 MB', checksumSha256: 'q7r8s9t0...', validityStart: '2025-01-15', validityEnd: '2026-01-15', status: 'Accepted', ownerId: 1, ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', reviewerId: 3, reviewerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', reviewerComment: null, acceptedAt: '2025-01-18', period: '2025', linkedObligations: ['OBL-001', 'OBL-002'], linkedControls: ['CTR-001', 'CTR-002'], tags: ['CDD', 'Ø¥Ø¬Ø±Ø§Ø¡'], priority: 'High', confidentiality: 'Internal' },
  ]);

  // Documents Data - Enhanced
  const [documents, setDocuments] = useState([
    { id: 1, code: 'DOC-0001', titleAr: 'Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', titleEn: 'AML Policy', docType: 'Policy', classification: 'Confidential', ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', ownerId: 1, version: 'v2.1', status: 'Active', lastUpdated: '2025-01-15', expiryDate: '2026-01-15', downloads: 45, linkedEvidence: 3, description: 'Ø³ÙŠØ§Ø³Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„' },
    { id: 2, code: 'DOC-0002', titleAr: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©', titleEn: 'CDD Procedures', docType: 'Procedure', classification: 'Internal', ownerName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', ownerId: 2, version: 'v1.3', status: 'Active', lastUpdated: '2025-01-10', expiryDate: '2025-07-10', downloads: 78, linkedEvidence: 5, description: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡' },
    { id: 3, code: 'DOC-0003', titleAr: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Policy', docType: 'Policy', classification: 'Confidential', ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', ownerId: 3, version: 'v1.0', status: 'Active', lastUpdated: '2024-12-01', expiryDate: '2025-12-01', downloads: 32, linkedEvidence: 4, description: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©' },
    { id: 4, code: 'DOC-0004', titleAr: 'Ø¯Ù„ÙŠÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', titleEn: 'PDPL Guide', docType: 'Guide', classification: 'Internal', ownerName: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', ownerId: 4, version: 'v1.2', status: 'Active', lastUpdated: '2025-01-20', expiryDate: '2026-01-20', downloads: 56, linkedEvidence: 2, description: 'Ø¯Ù„ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©' },
    { id: 5, code: 'DOC-0005', titleAr: 'Ø¥Ø·Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', titleEn: 'BCM Framework', docType: 'Framework', classification: 'Confidential', ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', ownerId: 1, version: 'v1.1', status: 'Active', lastUpdated: '2024-11-15', expiryDate: '2025-11-15', downloads: 23, linkedEvidence: 1, description: 'Ø¥Ø·Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„' },
    { id: 6, code: 'DOC-0006', titleAr: 'Ù…Ø¹ÙŠØ§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©', titleEn: 'IAM Standard', docType: 'Standard', classification: 'Internal', ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', ownerId: 3, version: 'v2.0', status: 'Active', lastUpdated: '2025-01-25', expiryDate: '2026-01-25', downloads: 41, linkedEvidence: 3, description: 'Ù…Ø¹ÙŠØ§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„' },
    { id: 7, code: 'DOC-0007', titleAr: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', titleEn: 'Incident Response Policy', docType: 'Policy', classification: 'Confidential', ownerName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', ownerId: 3, version: 'v1.5', status: 'UnderReview', lastUpdated: '2025-01-28', expiryDate: null, downloads: 18, linkedEvidence: 0, description: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©' },
  ]);

  // Audit Packs Data
  const [auditPacks] = useState([
    { id: 1, code: 'PACK-001', name: 'Ø­Ø²Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ SAMA Q1-2025', authority: 'SAMA', createdAt: '2025-01-15', createdBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', evidenceCount: 8, documentsCount: 3, status: 'Ready', size: '45.2 MB' },
    { id: 2, code: 'PACK-002', name: 'Ø­Ø²Ù…Ø© NCA ECC', authority: 'NCA', createdAt: '2025-01-20', createdBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', evidenceCount: 12, documentsCount: 5, status: 'Ready', size: '78.5 MB' },
  ]);

  // Upload Form
  const [uploadForm, setUploadForm] = useState({
    evidenceType: '', title: '', validityEnd: '', period: '', linkedObligations: [], linkedControls: [], tags: '',
    priority: 'Medium', confidentiality: 'Internal', description: ''
  });

  // Current User (for SoD)
  const CURRENT_USER = { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯' };

  // Status Config
  const STATUS_CONFIG = {
    PendingUpload: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±ÙØ¹', bg: 'bg-slate-100', text: 'text-slate-600', icon: Upload },
    Uploaded: { label: 'ØªÙ… Ø§Ù„Ø±ÙØ¹', bg: 'bg-blue-100', text: 'text-blue-700', icon: FileCheck },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', bg: 'bg-amber-100', text: 'text-amber-700', icon: Clock },
    Accepted: { label: 'Ù…Ù‚Ø¨ÙˆÙ„', bg: 'bg-emerald-100', text: 'text-emerald-700', icon: CheckCircle2 },
    Rejected: { label: 'Ù…Ø±ÙÙˆØ¶', bg: 'bg-red-100', text: 'text-red-700', icon: XCircle },
    Expired: { label: 'Ù…Ù†ØªÙ‡ÙŠ', bg: 'bg-orange-100', text: 'text-orange-700', icon: AlertTriangle },
  };

  // Type Config
  const TYPE_CONFIG = {
    Report: { label: 'ØªÙ‚Ø±ÙŠØ±', icon: FileText, color: 'blue' },
    Screenshot: { label: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', icon: Eye, color: 'cyan' },
    Certificate: { label: 'Ø´Ù‡Ø§Ø¯Ø©', icon: CheckCircle2, color: 'emerald' },
    Log: { label: 'Ø³Ø¬Ù„', icon: Table, color: 'purple' },
    Config: { label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', icon: Settings, color: 'slate' },
    Attestation: { label: 'Ø¥Ù‚Ø±Ø§Ø±', icon: ClipboardCheck, color: 'indigo' },
    Procedure: { label: 'Ø¥Ø¬Ø±Ø§Ø¡', icon: FileCheck, color: 'amber' },
  };

  // Priority Config
  const PRIORITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', color: 'red' }, High: { label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' }, Low: { label: 'Ù…Ù†Ø®ÙØ¶', color: 'slate' },
  };

  // Confidentiality Config  
  const CONFIDENTIALITY_CONFIG = {
    Public: { label: 'Ø¹Ø§Ù…', color: 'emerald' }, Internal: { label: 'Ø¯Ø§Ø®Ù„ÙŠ', color: 'blue' },
    Confidential: { label: 'Ø³Ø±ÙŠ', color: 'amber' }, Restricted: { label: 'Ù…Ù‚ÙŠØ¯', color: 'red' },
  };

  const [showFolderModal, setShowFolderModal] = useState(false);
  const [showVersionHistory, setShowVersionHistory] = useState(false);
  const [showFilePreview, setShowFilePreview] = useState(false);
  const [showAdvancedSearch, setShowAdvancedSearch] = useState(false);
  const [showRetentionSettings, setShowRetentionSettings] = useState(false);
  const [showPermissionsModal, setShowPermissionsModal] = useState(false);
  const [currentFolder, setCurrentFolder] = useState(null);
  const [selectedFiles, setSelectedFiles] = useState([]);
  const [uploadProgress, setUploadProgress] = useState(0);
  const [checkedOutFiles, setCheckedOutFiles] = useState([]);
  const [savedSearches, setSavedSearches] = useState([
    { id: 1, name: 'Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©', filters: { status: 'Expired' }, createdAt: '2025-01-15' },
    { id: 2, name: 'ØªÙ‚Ø§Ø±ÙŠØ± SAMA', filters: { type: 'Report', tags: ['SAMA'] }, createdAt: '2025-01-20' },
    { id: 3, name: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', filters: { status: 'UnderReview' }, createdAt: '2025-01-25' },
  ]);
  const [advancedFilters, setAdvancedFilters] = useState({
    dateFrom: '', dateTo: '', owner: '', confidentiality: '', tags: [], fullText: ''
  });

  const [folders, setFolders] = useState([
    { id: 1, name: 'Ø§Ù„Ø¬Ø°Ø±', parentId: null, icon: 'Folder', permissions: ['view', 'upload', 'edit', 'delete'], children: [2, 3, 4, 5] },
    { id: 2, name: 'Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©', parentId: 1, icon: 'Calendar', permissions: ['view', 'upload'], retentionDays: 365, children: [6, 7] },
    { id: 3, name: 'Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ±Ø§Ø®ÙŠØµ', parentId: 1, icon: 'Award', permissions: ['view', 'upload', 'edit'], retentionDays: 1095, children: [] },
    { id: 4, name: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠØ©', parentId: 1, icon: 'FileText', permissions: ['view', 'upload'], retentionDays: 2555, children: [] },
    { id: 5, name: 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨', parentId: 1, icon: 'Users', permissions: ['view', 'upload'], retentionDays: 730, children: [] },
    { id: 6, name: 'ÙŠÙ†Ø§ÙŠØ± 2025', parentId: 2, icon: 'FolderOpen', permissions: ['view', 'upload'], children: [] },
    { id: 7, name: 'ÙØ¨Ø±Ø§ÙŠØ± 2025', parentId: 2, icon: 'FolderOpen', permissions: ['view', 'upload'], children: [] },
  ]);

  const [fileVersions, setFileVersions] = useState({
    1: [
      { version: 'v1.2', date: '2025-01-28', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '1.2 MB', comment: 'ØªØ­Ø¯ÙŠØ« Ø´Ù‡Ø± ÙŠÙ†Ø§ÙŠØ±', checksum: 'f6g7h8i9...' },
      { version: 'v1.1', date: '2025-01-15', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '1.1 MB', comment: 'ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø·ÙÙŠÙØ©', checksum: 'e5f6g7h8...' },
      { version: 'v1.0', date: '2025-01-05', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '1.0 MB', comment: 'Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰', checksum: 'd4e5f6g7...' },
    ],
    12: [
      { version: 'v3.0', date: '2025-01-18', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '2.3 MB', comment: 'ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡', checksum: 'q7r8s9t0...' },
      { version: 'v2.0', date: '2024-07-10', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '2.0 MB', comment: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©', checksum: 'p6q7r8s9...' },
      { version: 'v1.0', date: '2024-01-01', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', size: '1.5 MB', comment: 'Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰', checksum: 'o5p6q7r8...' },
    ],
  });

  const [downloadLog, setDownloadLog] = useState([
    { id: 1, fileId: 1, userId: 2, userName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', downloadedAt: '2025-01-28 14:32', ipAddress: '192.168.1.50' },
    { id: 2, fileId: 3, userId: 5, userName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', downloadedAt: '2025-01-27 09:15', ipAddress: '192.168.1.65' },
    { id: 3, fileId: 1, userId: 3, userName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', downloadedAt: '2025-01-26 16:45', ipAddress: '192.168.1.42' },
  ]);

  const [retentionPolicies, setRetentionPolicies] = useState([
    { id: 1, docType: 'Report', retentionDays: 365, autoArchive: true, legalHold: false },
    { id: 2, docType: 'Certificate', retentionDays: 1095, autoArchive: true, legalHold: false },
    { id: 3, docType: 'Log', retentionDays: 730, autoArchive: true, legalHold: false },
    { id: 4, docType: 'Config', retentionDays: 365, autoArchive: false, legalHold: false },
    { id: 5, docType: 'Attestation', retentionDays: 2555, autoArchive: true, legalHold: true },
  ]);

  const [legalHolds, setLegalHolds] = useState([
    { id: 1, name: 'Ù‚Ø¶ÙŠØ© ØªØ¯Ù‚ÙŠÙ‚ SAMA 2024', startDate: '2024-06-01', status: 'Active', affectedFiles: [1, 3, 10], createdBy: 'Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ' },
  ]);

  const stats = useMemo(() => ({
    total: evidence.length,
    accepted: evidence.filter(e => e.status === 'Accepted').length,
    underReview: evidence.filter(e => e.status === 'UnderReview').length,
    rejected: evidence.filter(e => e.status === 'Rejected').length,
    expired: evidence.filter(e => e.status === 'Expired').length,
    pending: evidence.filter(e => e.status === 'PendingUpload').length,
    uploaded: evidence.filter(e => e.status === 'Uploaded').length,
  }), [evidence]);

  const filteredEvidence = useMemo(() => {
    return evidence.filter(e => {
      const matchSearch = !searchQuery || e.title?.toLowerCase().includes(searchQuery.toLowerCase()) || e.code?.toLowerCase().includes(searchQuery.toLowerCase());
      const matchStatus = !filterStatus || e.status === filterStatus;
      const matchType = !filterType || e.evidenceType === filterType;
      return matchSearch && matchStatus && matchType;
    });
  }, [evidence, searchQuery, filterStatus, filterType]);

  // Pending Review
  const pendingReview = useMemo(() => evidence.filter(e => e.status === 'UnderReview'), [evidence]);

  // SoD Check
  const canReview = (evd) => evd.ownerId !== CURRENT_USER.id && evd.status === 'UnderReview';

  // Handlers
  const handleUpload = () => {
    if (!uploadForm.evidenceType || !uploadForm.title || !uploadForm.validityEnd) {
      alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      return;
    }
    const newEvd = {
      id: evidence.length + 1,
      code: `EVD-${String(evidence.length + 1).padStart(6, '0')}`,
      evidenceType: uploadForm.evidenceType, title: uploadForm.title, fileName: 'uploaded_file.pdf', fileSize: '1.0 MB',
      checksumSha256: 'new_' + Date.now(), validityStart: new Date().toISOString().split('T')[0],
      validityEnd: uploadForm.validityEnd, status: 'Uploaded', ownerId: CURRENT_USER.id, ownerName: CURRENT_USER.name,
      reviewerId: null, reviewerName: null, reviewerComment: null, acceptedAt: null, period: uploadForm.period,
    };
    setEvidence([...evidence, newEvd]);
    setShowUploadModal(false);
    setUploadForm({ evidenceType: '', title: '', validityEnd: '', period: '' });
    alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„: ' + newEvd.code);
  };

  const handleSubmitForReview = (evd) => {
    if (evd.status !== 'Uploaded') return;
    setEvidence(evidence.map(e => e.id === evd.id ? { ...e, status: 'UnderReview', reviewerId: 1, reviewerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯' } : e));
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
  };

  const handleAccept = () => {
    if (!selectedEvidence) return;

    // SoD Check: Uploader cannot approve their own evidence
    const sodResult = guardAction('EVIDENCE', 'APPROVE', { uploadedBy: selectedEvidence.ownerId }, selectedEvidence.priority || 'Medium');
    if (!sodResult.allowed) {
      alert(`â›” ${sodResult.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ - Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…'}`);
      return;
    }

    setEvidence(evidence.map(e => e.id === selectedEvidence.id ? { ...e, status: 'Accepted', acceptedAt: new Date().toISOString().split('T')[0] } : e));
    setShowReviewModal(false);
    setSelectedEvidence(null);
    alert('âœ… ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¯Ù„ÙŠÙ„');
  };

  const handleReject = () => {
    if (!selectedEvidence || rejectComment.length < 20) {
      alert('ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (20 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)');
      return;
    }
    setEvidence(evidence.map(e => e.id === selectedEvidence.id ? { ...e, status: 'Rejected', reviewerComment: rejectComment } : e));
    setShowReviewModal(false);
    setSelectedEvidence(null);
    setRejectComment('');
    alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„');
  };

  // Multi-file Upload Handler
  const handleMultiFileUpload = (files) => {
    const fileList = Array.from(files);
    let uploaded = 0;
    fileList.forEach((file, idx) => {
      setTimeout(() => {
        uploaded++;
        setUploadProgress(Math.round((uploaded / fileList.length) * 100));
        if (uploaded === fileList.length) {
          alert(`ØªÙ… Ø±ÙØ¹ ${fileList.length} Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­`);
          setUploadProgress(0);
        }
      }, (idx + 1) * 500);
    });
  };

  const handleCheckOut = (evd) => {
    if (checkedOutFiles.includes(evd.id)) {
      alert('Ø§Ù„Ù…Ù„Ù Ù…Ø­Ø¬ÙˆØ² Ù„Ù„ØªØ­Ø±ÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹');
      return;
    }
    setCheckedOutFiles([...checkedOutFiles, evd.id]);
    alert(`ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ù ${evd.code} Ù„Ù„ØªØ­Ø±ÙŠØ±`);
  };

  const handleCheckIn = (evd, newVersion) => {
    setCheckedOutFiles(checkedOutFiles.filter(id => id !== evd.id));
    const versions = fileVersions[evd.id] || [];
    const newVersionNum = versions.length > 0 ? `v${parseFloat(versions[0].version.slice(1)) + 0.1}` : 'v1.0';
    setFileVersions({
      ...fileVersions,
      [evd.id]: [{ version: newVersionNum, date: new Date().toISOString().split('T')[0], userId: CURRENT_USER.id, userName: CURRENT_USER.name, size: evd.fileSize, comment: newVersion || 'ØªØ­Ø¯ÙŠØ«', checksum: 'new_' + Date.now() }, ...versions]
    });
    alert(`ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ù ${evd.code} Ø¨Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø© ${newVersionNum}`);
  };

  // Download with Tracking
  const handleDownloadWithTracking = (evd) => {
    const newLog = { id: downloadLog.length + 1, fileId: evd.id, userId: CURRENT_USER.id, userName: CURRENT_USER.name, downloadedAt: new Date().toLocaleString('ar-SA'), ipAddress: '192.168.1.100' };
    setDownloadLog([newLog, ...downloadLog]);
    alert(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ${evd.fileName}...`);
  };

  // Advanced Search Handler
  const handleAdvancedSearch = () => {
    const results = evidence.filter(e => {
      let match = true;
      if (advancedFilters.dateFrom && e.validityStart < advancedFilters.dateFrom) match = false;
      if (advancedFilters.dateTo && e.validityEnd > advancedFilters.dateTo) match = false;
      if (advancedFilters.owner && e.ownerId !== parseInt(advancedFilters.owner)) match = false;
      if (advancedFilters.confidentiality && e.confidentiality !== advancedFilters.confidentiality) match = false;
      if (advancedFilters.fullText && !e.title.includes(advancedFilters.fullText) && !e.fileName?.includes(advancedFilters.fullText)) match = false;
      return match;
    });
    return results;
  };

  // Save Search Handler
  const handleSaveSearch = (name) => {
    const newSearch = { id: savedSearches.length + 1, name, filters: { ...advancedFilters }, createdAt: new Date().toISOString().split('T')[0] };
    setSavedSearches([...savedSearches, newSearch]);
    alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø­Ø«: ${name}`);
  };

  // Apply Saved Search
  const applySavedSearch = (search) => {
    if (search.filters.status) setFilterStatus(search.filters.status);
    if (search.filters.type) setFilterType(search.filters.type);
    setAdvancedFilters({ ...advancedFilters, ...search.filters });
  };

  // Folder Navigation
  const navigateToFolder = (folderId) => {
    setCurrentFolder(folders.find(f => f.id === folderId) || null);
  };

  // Legal Hold Handler
  const applyLegalHold = (evdIds, holdName) => {
    const newHold = { id: legalHolds.length + 1, name: holdName, startDate: new Date().toISOString().split('T')[0], status: 'Active', affectedFiles: evdIds, createdBy: CURRENT_USER.name };
    setLegalHolds([...legalHolds, newHold]);
    alert(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø¹Ù„Ù‰ ${evdIds.length} Ù…Ù„ÙØ§Øª`);
  };

  // Document Handlers
  const openCreateDocModal = () => {
    setDocForm({ titleAr: '', titleEn: '', docType: 'Policy', classification: 'Internal', version: 'v1.0', description: '', ownerId: CURRENT_USER.id });
    setDocModalMode('create');
    setSelectedDoc(null);
    setShowDocModal(true);
  };

  const openEditDocModal = (doc) => {
    setDocForm({
      titleAr: doc.titleAr, titleEn: doc.titleEn, docType: doc.docType,
      classification: doc.classification, version: doc.version,
      description: doc.description || '', ownerId: doc.ownerId
    });
    setDocModalMode('edit');
    setSelectedDoc(doc);
    setShowDocModal(true);
  };

  const openViewDocModal = (doc) => {
    setSelectedDoc(doc);
    setDocModalMode('view');
    setShowDocModal(true);
  };

  const handleSaveDoc = () => {
    if (!docForm.titleAr || !docForm.titleEn) {
      alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      return;
    }

    if (docModalMode === 'create') {
      const newDoc = {
        id: documents.length + 1,
        code: `DOC-${String(documents.length + 1).padStart(4, '0')}`,
        titleAr: docForm.titleAr, titleEn: docForm.titleEn, docType: docForm.docType, classification: docForm.classification,
        version: docForm.version, description: docForm.description, ownerId: docForm.ownerId,
        ownerName: USERS.find(u => u.id === docForm.ownerId)?.name || CURRENT_USER.name,
        status: 'Active', lastUpdated: new Date().toISOString().split('T')[0], expiryDate: null, downloads: 0,
        linkedEvidence: 0
      };
      setDocuments([...documents, newDoc]);
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ' + newDoc.code);
    } else if (docModalMode === 'edit' && selectedDoc) {
      setDocuments(documents.map(d => d.id === selectedDoc.id ? {
        ...d,
        titleAr: docForm.titleAr, titleEn: docForm.titleEn, docType: docForm.docType, classification: docForm.classification,
        version: docForm.version, description: docForm.description, ownerId: docForm.ownerId,
        ownerName: USERS.find(u => u.id === docForm.ownerId)?.name || d.ownerName,
        lastUpdated: new Date().toISOString().split('T')[0]
      } : d));
      alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ' + selectedDoc.code);
    }
    setShowDocModal(false);
  };

  const handleDeleteDoc = () => {
    if (!selectedDoc) return;
    setDocuments(documents.filter(d => d.id !== selectedDoc.id));
    setShowDocDeleteConfirm(false);
    setSelectedDoc(null);
    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©');
  };

  // Document Type Config
  const DOC_TYPE_CONFIG = {
    Policy: { label: 'Ø³ÙŠØ§Ø³Ø©', color: 'purple' }, Procedure: { label: 'Ø¥Ø¬Ø±Ø§Ø¡', color: 'blue' },
    Standard: { label: 'Ù…Ø¹ÙŠØ§Ø±', color: 'emerald' }, Guide: { label: 'Ø¯Ù„ÙŠÙ„', color: 'amber' },
    Framework: { label: 'Ø¥Ø·Ø§Ø±', color: 'indigo' },
  };

  const getDaysUntilExpiry = (date) => {
    if (!date) return null;
    return Math.ceil((new Date(date) - new Date()) / (1000 * 60 * 60 * 24));
  };

  const tabs = [
    { id: 'repository', label: 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FolderOpen, count: stats.total },
    { id: 'documents', label: 'Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚', icon: FileText, count: documents.length },
    { id: 'review', label: 'Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: ClipboardCheck, count: stats.underReview },
    { id: 'pack', label: 'Ø­Ø²Ù… Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', icon: Download, count: null },
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-slate-900 flex items-center gap-3">
            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white">
              <FolderOpen className="w-5 h-5" />
            </div>
            Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚
          </h1>
          <p className="text-slate-500 mt-1">Evidence & Document Management - Module 4.5</p>
        </div>
        <div className="flex items-center gap-3">
          {can('EVIDENCE_EXPORT') && (
            <button onClick={() => setShowPackModal(true)} className="flex items-center gap-2 px-4 py-2.5 border-2 border-indigo-200 bg-indigo-50 rounded-xl text-indigo-700 hover:bg-indigo-100 font-bold transition-all">
              <Package className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚
            </button>
          )}
          {can('EVIDENCE_CREATE') && (
            <button onClick={() => setShowUploadModal(true)} className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">
              <Upload className="w-5 h-5" />Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
            </button>
          )}
        </div> </div>
      <div className="grid grid-cols-7 gap-3">
        <div className="bg-gradient-to-br from-indigo-500 via-purple-500 to-violet-600 rounded-2xl p-4 text-white relative overflow-hidden">
          <div className="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2" />
          <div className="flex items-center gap-2 mb-2">
            <FolderOpen className="w-5 h-5 text-indigo-200" />
            <p className="text-indigo-100 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¯Ù„Ø©</p>
          </div>
          <p className="text-3xl font-bold">{stats.total}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-emerald-200 hover:shadow-lg hover:border-emerald-400 transition-all cursor-pointer" onClick={() => setFilterStatus('Accepted')}>
          <div className="flex items-center gap-2 mb-2"><CheckCircle2 className="w-5 h-5 text-emerald-500" /><p className="text-xs text-slate-500">Ù…Ù‚Ø¨ÙˆÙ„Ø©</p></div>
          <p className="text-2xl font-bold text-emerald-600">{stats.accepted}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-amber-200 hover:shadow-lg hover:border-amber-400 transition-all cursor-pointer" onClick={() => setFilterStatus('UnderReview')}>
          <div className="flex items-center gap-2 mb-2"><Clock className="w-5 h-5 text-amber-500" /><p className="text-xs text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p></div>
          <p className="text-2xl font-bold text-amber-600">{stats.underReview}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-blue-200">
          <div className="flex items-center gap-2 mb-1"><FileCheck className="w-4 h-4 text-blue-500" /><p className="text-xs text-slate-500">ØªÙ… Ø§Ù„Ø±ÙØ¹</p></div>
          <p className="text-2xl font-bold text-blue-600">{stats.uploaded}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-slate-200">
          <div className="flex items-center gap-2 mb-1"><Upload className="w-4 h-4 text-slate-500" /><p className="text-xs text-slate-500">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±ÙØ¹</p></div>
          <p className="text-2xl font-bold text-slate-600">{stats.pending}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-red-200 hover:shadow-lg hover:border-red-400 transition-all cursor-pointer" onClick={() => setFilterStatus('Rejected')}>
          <div className="flex items-center gap-2 mb-2"><XCircle className="w-5 h-5 text-red-500" /><p className="text-xs text-slate-500">Ù…Ø±ÙÙˆØ¶Ø©</p></div>
          <p className="text-2xl font-bold text-red-600">{stats.rejected}</p>
        </div>
        <div className="bg-white rounded-2xl p-4 border-2 border-orange-200 hover:shadow-lg hover:border-orange-400 transition-all cursor-pointer" onClick={() => setFilterStatus('Expired')}>
          <div className="flex items-center gap-2 mb-2"><AlertTriangle className="w-5 h-5 text-orange-500" /><p className="text-xs text-slate-500">Ù…Ù†ØªÙ‡ÙŠØ©</p></div>
          <p className="text-2xl font-bold text-orange-600">{stats.expired}</p>
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden shadow-sm">
        <div className="flex border-b border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => { setActiveTab(tab.id); setFilterStatus(''); }}
              className={`flex items-center gap-2 px-6 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-indigo-600 border-indigo-500 bg-white -mb-px rounded-t-xl shadow-sm' : 'text-slate-500 border-transparent hover:text-indigo-500 hover:bg-white/50'}`}>
              <tab.icon className="w-5 h-5" />{tab.label}
              {tab.count !== null && <span className={`px-2.5 py-1 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-indigo-500 text-white' : 'bg-slate-200 text-slate-600'}`}>{tab.count}</span>}
            </button>
          ))}
        </div>

        {activeTab === 'repository' && (
          <div className="p-6">
            <div className="flex items-center gap-4 mb-6">
              <div className="flex-1 relative">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…... (Ø§Ù„ÙƒÙˆØ¯ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„ÙØªØ±Ø©ØŒ Ø§Ù„ÙˆØ³ÙˆÙ…)" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:outline-none focus:border-indigo-500 transition-all" />
              </div>
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white font-medium">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                {Object.entries(STATUS_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
              </select>
              <select value={filterType} onChange={(e) => setFilterType(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white font-medium">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                {Object.entries(TYPE_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
              </select>
              {filterStatus && (
                <button onClick={() => setFilterStatus('')} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm flex items-center gap-1 hover:bg-slate-200">
                  <X className="w-4 h-4" />Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±
                </button>
              )}
              <div className="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden">
                <button onClick={() => setViewMode('table')} className={`p-3 transition-all ${viewMode === 'table' ? 'bg-indigo-500 text-white' : 'text-slate-500 hover:bg-slate-100'}`}><Table className="w-5 h-5" /></button>
                <button onClick={() => setViewMode('grid')} className={`p-3 transition-all ${viewMode === 'grid' ? 'bg-indigo-500 text-white' : 'text-slate-500 hover:bg-slate-100'}`}><LayoutGrid className="w-5 h-5" /></button>
                <button onClick={() => setViewMode('folder')} className={`p-3 transition-all ${viewMode === 'folder' ? 'bg-indigo-500 text-white' : 'text-slate-500 hover:bg-slate-100'}`}><FolderOpen className="w-5 h-5" /></button>
              </div>

              <div className="flex items-center gap-2">
                <button onClick={() => setShowAdvancedSearch(true)} className="flex items-center gap-1.5 px-3 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl text-sm font-bold hover:from-cyan-600 hover:to-blue-600 shadow-lg shadow-cyan-500/20">
                  <Search className="w-4 h-4" />Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…
                </button>
                <button onClick={() => setShowFolderModal(true)} className="flex items-center gap-1.5 px-3 py-2.5 border-2 border-purple-300 text-purple-700 rounded-xl text-sm font-bold hover:bg-purple-50">
                  <FolderOpen className="w-4 h-4" />Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
                </button>
                <button onClick={() => setShowRetentionSettings(true)} className="flex items-center gap-1.5 px-3 py-2.5 border-2 border-amber-300 text-amber-700 rounded-xl text-sm font-bold hover:bg-amber-50">
                  <Archive className="w-4 h-4" />Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ø¸
                </button> </div> </div>
            {savedSearches.length > 0 && (
              <div className="mb-4 flex items-center gap-2">
                <span className="text-sm text-slate-500 font-bold">Ø¨Ø­Ø« Ù…Ø­ÙÙˆØ¸:</span>
                {savedSearches.slice(0, 4).map(search => (
                  <button key={search.id} onClick={() => applySavedSearch(search)} className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-200 flex items-center gap-1">
                    <Search className="w-3 h-3" />{search.name}
                  </button>
                ))}
              </div>
            )}

            {selectedItems.length > 0 && (
              <div className="mb-4 p-3 bg-indigo-50 border-2 border-indigo-200 rounded-xl flex items-center justify-between">
                <span className="text-indigo-700 font-bold">{selectedItems.length} Ø¹Ù†ØµØ± Ù…Ø­Ø¯Ø¯</span>
                <div className="flex items-center gap-2">
                  <button className="px-3 py-1.5 bg-white text-indigo-600 rounded-lg text-sm font-bold hover:bg-indigo-100 flex items-center gap-1"><Download className="w-4 h-4" />ØªØ­Ù…ÙŠÙ„</button>
                  <button className="px-3 py-1.5 bg-white text-emerald-600 rounded-lg text-sm font-bold hover:bg-emerald-100 flex items-center gap-1"><Package className="w-4 h-4" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø©</button>
                  <button onClick={() => setSelectedItems([])} className="px-3 py-1.5 bg-white text-slate-600 rounded-lg text-sm font-bold hover:bg-slate-100"><X className="w-4 h-4" /></button>
                </div> </div>
            )}

            {viewMode === 'table' && (
              <div className="overflow-hidden rounded-xl border-2 border-slate-200">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gradient-to-r from-slate-50 to-slate-100">
                      <th className="w-10 px-3 py-4">
                        <input type="checkbox" className="w-4 h-4 rounded"
                          checked={selectedItems.length === filteredEvidence.length && filteredEvidence.length > 0}
                          onChange={(e) => setSelectedItems(e.target.checked ? filteredEvidence.map(e => e.id) : [])} />
                      </th>
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙØªØ±Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700 w-44">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredEvidence.map((evd, idx) => {
                      const statusCfg = STATUS_CONFIG[evd.status] || STATUS_CONFIG.PendingUpload;
                      const typeCfg = TYPE_CONFIG[evd.evidenceType] || { label: evd.evidenceType, icon: File, color: 'slate' };
                      const daysUntil = getDaysUntilExpiry(evd.validityEnd);
                      const StatusIcon = statusCfg.icon;
                      const TypeIcon = typeCfg.icon;
                      const isSelected = selectedItems.includes(evd.id);
                      const isEditing = uploadForm.editingId === evd.id;
                      return (
                        <tr key={evd.id}
                          className={`border-b border-slate-100 transition-all cursor-pointer group ${isSelected ? 'bg-indigo-50' : isEditing ? 'bg-amber-50' : idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'
                            } hover:bg-indigo-50/50`}
                          onClick={() => { if (!isEditing) { setSelectedEvidence(evd); setShowDetailModal(true); } }}>
                          <td className="px-3 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                            <input type="checkbox" className="w-4 h-4 rounded" checked={isSelected}
                              onChange={(e) => setSelectedItems(e.target.checked ? [...selectedItems, evd.id] : selectedItems.filter(id => id !== evd.id))} />
                          </td>
                          <td className="px-4 py-4" onClick={(e) => e.stopPropagation()}>
                            <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-100 px-2.5 py-1 rounded-lg">{evd.code}</span>
                          </td>
                          <td className="px-4 py-4" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <input type="text"
                                defaultValue={evd.title}
                                className="w-full px-3 py-2 border-2 border-amber-300 rounded-lg font-bold text-slate-800 focus:border-amber-500 focus:outline-none"
                                autoFocus />
                            ) : (
                              <div>
                                <p className="font-bold text-slate-800 mb-1 group-hover:text-indigo-700 transition-colors">{evd.title}</p>
                                {evd.fileName && <p className="text-xs text-slate-500 flex items-center gap-1"><Paperclip className="w-3 h-3" />{evd.fileName} â€¢ {evd.fileSize}</p>}
                                {evd.tags && evd.tags.length > 0 && (
                                  <div className="flex items-center gap-1 mt-1.5">
                                    {evd.tags.slice(0, 2).map((tag, i) => (
                                      <span key={i} className="px-1.5 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">{tag}</span>
                                    ))}
                                    {evd.tags.length > 2 && <span className="text-xs text-slate-400">+{evd.tags.length - 2}</span>}
                                  </div>
                                )}
                              </div>
                            )}
                          </td>
                          <td className="px-4 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <select defaultValue={evd.evidenceType} className="px-2 py-1.5 border-2 border-amber-300 rounded-lg text-xs font-bold focus:border-amber-500 focus:outline-none">
                                {Object.entries(TYPE_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                              </select>
                            ) : (
                              <span className={`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-bold bg-${typeCfg.color}-100 text-${typeCfg.color}-700`}>
                                <TypeIcon className="w-3.5 h-3.5" />{typeCfg.label}
                              </span>
                            )}
                          </td>
                          <td className="px-4 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <select defaultValue={evd.status} className="px-2 py-1.5 border-2 border-amber-300 rounded-lg text-xs font-bold focus:border-amber-500 focus:outline-none">
                                {Object.entries(STATUS_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                              </select>
                            ) : (
                              <span className={`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-bold ${statusCfg.bg} ${statusCfg.text}`}>
                                <StatusIcon className="w-3.5 h-3.5" />{statusCfg.label}
                              </span>
                            )}
                          </td>
                          <td className="px-4 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <input type="text" defaultValue={evd.period} className="w-20 px-2 py-1.5 border-2 border-amber-300 rounded-lg text-xs text-center font-bold focus:border-amber-500 focus:outline-none" />
                            ) : (
                              <span className="text-sm font-medium text-slate-700 bg-slate-100 px-2 py-1 rounded">{evd.period || 'â€”'}</span>
                            )}
                          </td>
                          <td className="px-4 py-4 text-center" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <input type="date" defaultValue={evd.validityEnd} className="px-2 py-1.5 border-2 border-amber-300 rounded-lg text-xs focus:border-amber-500 focus:outline-none" />
                            ) : evd.validityEnd ? (
                              <div className="flex flex-col items-center">
                                <p className="text-sm text-slate-600">{evd.validityEnd}</p>
                                {daysUntil !== null && (
                                  <span className={`text-xs font-bold mt-1 px-2 py-0.5 rounded ${daysUntil <= 0 ? 'bg-red-100 text-red-600' : daysUntil <= 30 ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'}`}>
                                    {daysUntil <= 0 ? 'Ù…Ù†ØªÙ‡ÙŠ' : `${daysUntil} ÙŠÙˆÙ…`}
                                  </span>
                                )}
                              </div>
                            ) : <span className="text-slate-400">â€”</span>}
                          </td>
                          <td className="px-4 py-4" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <select defaultValue={evd.ownerId} className="w-full px-2 py-1.5 border-2 border-amber-300 rounded-lg text-xs font-bold focus:border-amber-500 focus:outline-none">
                                {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                              </select>
                            ) : (
                              <div className="flex items-center justify-center gap-2">
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${evd.ownerId === 1 ? 'bg-blue-100 text-blue-600' : evd.ownerId === 2 ? 'bg-purple-100 text-purple-600' : 'bg-emerald-100 text-emerald-600'}`}>
                                  {evd.ownerName?.charAt(0)}
                                </div>
                                <span className="text-sm text-slate-600 hidden xl:inline">{evd.ownerName}</span>
                              </div>
                            )}
                          </td>
                          <td className="px-4 py-4" onClick={(e) => e.stopPropagation()}>
                            {isEditing ? (
                              <div className="flex items-center justify-center gap-1">
                                <button onClick={() => {
                                  alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                                  setUploadForm({ ...uploadForm, editingId: null });
                                }} className="p-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600" title="Ø­ÙØ¸">
                                  <Save className="w-4 h-4" />
                                </button>
                                <button onClick={() => setUploadForm({ ...uploadForm, editingId: null })} className="p-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600" title="Ø¥Ù„ØºØ§Ø¡">
                                  <X className="w-4 h-4" />
                                </button> </div>
                            ) : (
                              <div className="flex items-center justify-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                                <button onClick={(e) => { e.stopPropagation(); setSelectedEvidence(evd); setShowFilePreview(true); }}
                                  className="p-2 hover:bg-cyan-100 rounded-lg transition-all" title="Ù…Ø¹Ø§ÙŠÙ†Ø©">
                                  <Eye className="w-4 h-4 text-cyan-500 hover:text-cyan-700" />
                                </button>
                                <button onClick={(e) => { e.stopPropagation(); setSelectedEvidence(evd); setShowVersionHistory(true); }}
                                  className="p-2 hover:bg-emerald-100 rounded-lg transition-all" title="Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª">
                                  <History className="w-4 h-4 text-emerald-500 hover:text-emerald-700" />
                                </button>
                                {checkedOutFiles.includes(evd.id) ? (
                                  <button onClick={(e) => { e.stopPropagation(); handleCheckIn(evd, ''); }}
                                    className="p-2 bg-amber-100 rounded-lg transition-all" title="Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ù (Check-in)">
                                    <Upload className="w-4 h-4 text-amber-600" />
                                  </button>
                                ) : (
                                  <button onClick={(e) => { e.stopPropagation(); handleCheckOut(evd); }}
                                    className="p-2 hover:bg-purple-100 rounded-lg transition-all" title="Ø­Ø¬Ø² Ù„Ù„ØªØ­Ø±ÙŠØ± (Check-out)">
                                    <Lock className="w-4 h-4 text-purple-500 hover:text-purple-700" />
                                  </button>
                                )}
                                <button onClick={(e) => { e.stopPropagation(); setUploadForm({ ...uploadForm, editingId: evd.id }); }}
                                  className="p-2 hover:bg-amber-100 rounded-lg transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                                  <Edit className="w-4 h-4 text-amber-500 hover:text-amber-700" />
                                </button>
                                {evd.status === 'Uploaded' && (
                                  <button onClick={(e) => { e.stopPropagation(); handleSubmitForReview(evd); }}
                                    className="p-2 hover:bg-emerald-100 rounded-lg transition-all" title="Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">
                                    <Send className="w-4 h-4 text-emerald-500 hover:text-emerald-700" />
                                  </button>
                                )}
                                {canReview(evd) && (
                                  <button onClick={(e) => { e.stopPropagation(); setSelectedEvidence(evd); setRejectComment(''); setShowReviewModal(true); }}
                                    className="p-2 hover:bg-purple-100 rounded-lg transition-all" title="Ù…Ø±Ø§Ø¬Ø¹Ø©">
                                    <ClipboardCheck className="w-4 h-4 text-purple-500 hover:text-purple-700" />
                                  </button>
                                )}
                                <button onClick={(e) => { e.stopPropagation(); handleDownloadWithTracking(evd); }}
                                  className="p-2 hover:bg-blue-100 rounded-lg transition-all" title="ØªØ­Ù…ÙŠÙ„">
                                  <Download className="w-4 h-4 text-blue-500 hover:text-blue-700" />
                                </button>
                                <button onClick={(e) => {
                                  e.stopPropagation();
                                  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ØŸ')) {
                                    setEvidence(evidence.filter(e => e.id !== evd.id));
                                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ—‘ï¸');
                                  }
                                }}
                                  className="p-2 hover:bg-red-100 rounded-lg transition-all" title="Ø­Ø°Ù">
                                  <Trash2 className="w-4 h-4 text-red-500 hover:text-red-700" />
                                </button> </div>
                            )}
                          </td> </tr>);
                    })}
                  </tbody> </table>
                {selectedItems.length > 0 && (
                  <div className="sticky bottom-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-violet-600 text-white px-6 py-4 flex items-center justify-between rounded-b-xl shadow-lg">
                    <div className="flex items-center gap-3">
                      <span className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center font-black text-lg">{selectedItems.length}</span>
                      <span className="font-bold">Ø¹Ù†ØµØ± Ù…Ø­Ø¯Ø¯</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <button onClick={() => {
                        alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${selectedItems.length} Ø¯Ù„ÙŠÙ„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©! ğŸ“¤`);
                        setSelectedItems([]);
                      }} className="flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-sm">
                        <Send className="w-4 h-4" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                      </button>
                      <button onClick={() => {
                        alert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${selectedItems.length} Ø¯Ù„ÙŠÙ„! ğŸ“¥`);
                      }} className="flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-sm">
                        <Download className="w-4 h-4" />ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„
                      </button>
                      <button onClick={() => {
                        alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯Ø©! ğŸ“¦');
                        setSelectedItems([]);
                      }} className="flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-sm">
                        <Package className="w-4 h-4" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø©
                      </button>
                      <button onClick={() => {
                        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedItems.length} Ø¯Ù„ÙŠÙ„ØŸ`)) {
                          setEvidence(evidence.filter(e => !selectedItems.includes(e.id)));
                          setSelectedItems([]);
                          alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©! ğŸ—‘ï¸');
                        }
                      }} className="flex items-center gap-2 px-4 py-2 bg-red-500/50 hover:bg-red-500/70 rounded-xl font-bold text-sm">
                        <Trash2 className="w-4 h-4" />Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                      </button>
                      <button onClick={() => setSelectedItems([])} className="flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-sm">
                        <X className="w-4 h-4" />Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                      </button> </div> </div>
                )}

                {filteredEvidence.length === 0 && (
                  <div className="text-center py-12 bg-slate-50">
                    <FolderOpen className="w-12 h-12 text-slate-300 mx-auto mb-3" />
                    <p className="text-slate-500 font-medium">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>
                  </div>
                )}
              </div>
            )}

            {viewMode === 'grid' && (
              <div className="grid grid-cols-4 gap-4">
                {filteredEvidence.map(evd => {
                  const statusCfg = STATUS_CONFIG[evd.status] || STATUS_CONFIG.PendingUpload;
                  const typeCfg = TYPE_CONFIG[evd.evidenceType] || { label: evd.evidenceType, icon: File, color: 'slate' };
                  const daysUntil = getDaysUntilExpiry(evd.validityEnd);
                  const StatusIcon = statusCfg.icon;
                  const TypeIcon = typeCfg.icon;
                  const isCheckedOut = checkedOutFiles.includes(evd.id);
                  return (
                    <div key={evd.id} onClick={() => { setSelectedEvidence(evd); setShowDetailModal(true); }}
                      className={`bg-white rounded-xl border-2 p-4 hover:shadow-xl cursor-pointer transition-all group relative ${isCheckedOut ? 'border-amber-300 bg-amber-50' : 'border-slate-200 hover:border-indigo-300'}`}>
                      {isCheckedOut && (
                        <div className="absolute top-2 left-2 px-2 py-1 bg-amber-500 text-white text-xs font-bold rounded-lg flex items-center gap-1">
                          <Lock className="w-3 h-3" />Ù…Ø­Ø¬ÙˆØ²
                        </div>
                      )}
                      {evd.confidentiality === 'Confidential' && (
                        <div className="absolute top-2 right-2 px-2 py-0.5 bg-red-100 text-red-700 text-xs font-bold rounded border border-red-200">Ø³Ø±ÙŠ</div>
                      )}
                      {evd.confidentiality === 'Restricted' && (
                        <div className="absolute top-2 right-2 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded">Ù…Ù‚ÙŠØ¯</div>
                      )}
                      <div className="flex items-start justify-between mb-3 mt-4">
                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center bg-${typeCfg.color}-100`}>
                          <TypeIcon className={`w-6 h-6 text-${typeCfg.color}-600`} />
                        </div>
                        <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-bold ${statusCfg.bg} ${statusCfg.text}`}>
                          <StatusIcon className="w-3 h-3" />{statusCfg.label}
                        </span> </div>
                      <span className="font-mono text-xs text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded">{evd.code}</span>
                      <h4 className="font-bold text-slate-800 mt-2 line-clamp-2 group-hover:text-indigo-600 transition-colors">{evd.title}</h4>
                      {evd.fileName && <p className="text-xs text-slate-500 mt-1 flex items-center gap-1"><Paperclip className="w-3 h-3" />{evd.fileName}</p>}

                      {daysUntil !== null && evd.status === 'Accepted' && (
                        <div className={`mt-2 px-2 py-1 rounded-lg text-xs font-bold inline-flex items-center gap-1 ${daysUntil <= 0 ? 'bg-red-100 text-red-600' : daysUntil <= 30 ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'}`}>
                          <Clock className="w-3 h-3" />{daysUntil <= 0 ? 'Ù…Ù†ØªÙ‡ÙŠ' : `ØµØ§Ù„Ø­ Ù„Ù€ ${daysUntil} ÙŠÙˆÙ…`}
                        </div>
                      )}

                      <div className="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                        <div className="flex items-center gap-2">
                          <div className="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xs font-bold">{evd.ownerName?.charAt(0)}</div>
                          <span className="text-xs text-slate-500">{evd.ownerName}</span>
                        </div>
                        <span className="text-xs text-slate-400">{evd.period}</span>
                      </div> </div>);
                })}
              </div>
            )}

            {viewMode === 'folder' && (
              <div className="space-y-4">
                <div className="flex items-center gap-2 p-3 bg-slate-50 rounded-xl">
                  <button onClick={() => setCurrentFolder(null)} className="flex items-center gap-1 text-indigo-600 hover:text-indigo-800 font-bold">
                    <FolderOpen className="w-4 h-4" />Ø§Ù„Ø¬Ø°Ø±
                  </button>
                  {currentFolder && (
                    <>
                      <ChevronLeft className="w-4 h-4 text-slate-400" />
                      <span className="text-slate-800 font-bold">{currentFolder.name}</span>
                    </>
                  )}
                </div>

                <div className="grid grid-cols-6 gap-4">
                  {folders.filter(f => f.parentId === (currentFolder?.id || 1)).map(folder => (
                    <div key={folder.id} onClick={() => setCurrentFolder(folder)}
                      className="bg-white rounded-xl border-2 border-slate-200 p-4 hover:shadow-lg hover:border-purple-300 cursor-pointer transition-all text-center group">
                      <div className="w-16 h-16 mx-auto mb-3 rounded-xl bg-gradient-to-br from-purple-100 to-indigo-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <FolderOpen className="w-8 h-8 text-purple-600" />
                      </div>
                      <p className="font-bold text-slate-800 text-sm">{folder.name}</p>
                      <p className="text-xs text-slate-500 mt-1">{folder.children?.length || 0} Ø¹Ù†Ø§ØµØ±</p>
                    </div>
                  ))}
                </div>

                {currentFolder && (
                  <div className="mt-6">
                    <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <FileText className="w-5 h-5 text-indigo-600" />
                      Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ {currentFolder.name}
                    </h4>
                    <div className="grid grid-cols-4 gap-4">
                      {filteredEvidence.slice(0, 8).map(evd => {
                        const typeCfg = TYPE_CONFIG[evd.evidenceType] || { label: evd.evidenceType, icon: File, color: 'slate' };
                        const TypeIcon = typeCfg.icon;
                        return (
                          <div key={evd.id} onClick={() => { setSelectedEvidence(evd); setShowDetailModal(true); }}
                            className="bg-white rounded-xl border-2 border-slate-200 p-3 hover:shadow-md hover:border-indigo-300 cursor-pointer transition-all flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center bg-${typeCfg.color}-100 flex-shrink-0`}>
                              <TypeIcon className={`w-5 h-5 text-${typeCfg.color}-600`} />
                            </div>
                            <div className="flex-1 min-w-0">
                              <p className="font-bold text-sm text-slate-800 truncate">{evd.title}</p>
                              <p className="text-xs text-slate-500">{evd.fileSize}</p>
                            </div> </div>);
                      })}
                    </div> </div>
                )}
              </div>
            )}
          </div>
        )}

        {activeTab === 'documents' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <div className="relative flex-1">
                  <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚..." className="w-72 pr-10 pl-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" />
                </div> </div>
              <button onClick={openCreateDocModal} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© ÙˆØ«ÙŠÙ‚Ø©
              </button> </div>
            <div className="grid grid-cols-3 gap-4">
              {documents.map(doc => (
                <div key={doc.id} className="bg-white rounded-xl border-2 border-slate-200 p-5 hover:shadow-xl hover:border-purple-300 transition-all group relative">
                  <div className="absolute top-3 left-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onClick={() => openViewDocModal(doc)} className="p-1.5 bg-blue-100 hover:bg-blue-200 rounded-lg transition-all" title="Ø¹Ø±Ø¶">
                      <Eye className="w-4 h-4 text-blue-600" />
                    </button>
                    <button onClick={() => openEditDocModal(doc)} className="p-1.5 bg-amber-100 hover:bg-amber-200 rounded-lg transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                      <Edit className="w-4 h-4 text-amber-600" />
                    </button>
                    <button onClick={() => { setSelectedDoc(doc); setShowDocDeleteConfirm(true); }} className="p-1.5 bg-red-100 hover:bg-red-200 rounded-lg transition-all" title="Ø­Ø°Ù">
                      <Trash2 className="w-4 h-4 text-red-600" />
                    </button> </div>
                  <div className="flex items-start justify-between mb-4">
                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${doc.docType === 'Policy' ? 'bg-purple-100' : doc.docType === 'Procedure' ? 'bg-blue-100' : doc.docType === 'Standard' ? 'bg-emerald-100' : doc.docType === 'Framework' ? 'bg-indigo-100' : 'bg-amber-100'}`}>
                      <FileText className={`w-6 h-6 ${doc.docType === 'Policy' ? 'text-purple-600' : doc.docType === 'Procedure' ? 'text-blue-600' : doc.docType === 'Standard' ? 'text-emerald-600' : doc.docType === 'Framework' ? 'text-indigo-600' : 'text-amber-600'}`} />
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">{doc.version}</span>
                      <span className={`px-2 py-1 rounded-lg text-xs font-bold ${doc.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>
                        {doc.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                      </span> </div> </div>
                  <span className="font-mono text-xs text-purple-600 bg-purple-50 px-1.5 py-0.5 rounded">{doc.code}</span>
                  <h4 className="font-bold text-slate-800 mt-2 group-hover:text-purple-600 transition-colors cursor-pointer" onClick={() => openViewDocModal(doc)}>{doc.titleAr}</h4>
                  <p className="text-xs text-slate-500 mt-1">{doc.titleEn}</p>

                  <div className="mt-3 flex flex-wrap gap-2">
                    <span className={`px-2 py-1 rounded text-xs font-bold ${doc.classification === 'Confidential' ? 'bg-amber-100 text-amber-700' : doc.classification === 'Internal' ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700'}`}>
                      {doc.classification === 'Confidential' ? 'Ø³Ø±ÙŠ' : doc.classification === 'Internal' ? 'Ø¯Ø§Ø®Ù„ÙŠ' : 'Ø¹Ø§Ù…'}
                    </span>
                    <span className={`px-2 py-1 rounded text-xs font-bold ${DOC_TYPE_CONFIG[doc.docType]?.color ? `bg-${DOC_TYPE_CONFIG[doc.docType].color}-100 text-${DOC_TYPE_CONFIG[doc.docType].color}-700` : 'bg-slate-100 text-slate-600'}`}>
                      {DOC_TYPE_CONFIG[doc.docType]?.label || doc.docType}
                    </span> </div>
                  <div className="mt-4 pt-3 border-t border-slate-100 flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <div className="w-6 h-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-bold">{doc.ownerName?.charAt(0)}</div>
                      <span className="text-xs text-slate-500">{doc.ownerName}</span>
                    </div>
                    <div className="flex items-center gap-1 text-xs text-slate-400">
                      <Download className="w-3 h-3" />{doc.downloads}
                    </div> </div>
                  <div className="mt-3 flex items-center justify-between text-xs text-slate-500">
                    <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {doc.lastUpdated}</span>
                    {doc.linkedEvidence > 0 && <span className="text-indigo-600 font-bold">{doc.linkedEvidence} Ø£Ø¯Ù„Ø© Ù…Ø±ØªØ¨Ø·Ø©</span>}
                  </div> </div>
              ))}
            </div> </div>
        )}

        {activeTab === 'review' && (
          <div className="p-6">
            <div className="grid grid-cols-4 gap-4 mb-6">
              <div className="bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Clock className="w-8 h-8 text-white/80" />
                  <span className="text-3xl font-bold">{pendingReview.length}</span>
                </div>
                <p className="text-amber-100 mt-2 font-medium">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
              </div>
              <div className="bg-white rounded-xl p-4 border-2 border-emerald-200">
                <div className="flex items-center justify-between">
                  <CheckCircle2 className="w-6 h-6 text-emerald-500" />
                  <span className="text-2xl font-bold text-emerald-600">{stats.accepted}</span>
                </div>
                <p className="text-slate-500 mt-2 text-sm">ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
              </div>
              <div className="bg-white rounded-xl p-4 border-2 border-red-200">
                <div className="flex items-center justify-between">
                  <XCircle className="w-6 h-6 text-red-500" />
                  <span className="text-2xl font-bold text-red-600">{stats.rejected}</span>
                </div>
                <p className="text-slate-500 mt-2 text-sm">ØªÙ… Ø±ÙØ¶Ù‡Ø§</p>
              </div>
              <div className="bg-white rounded-xl p-4 border-2 border-indigo-200">
                <div className="flex items-center justify-between">
                  <User className="w-6 h-6 text-indigo-500" />
                  <span className="text-lg font-bold text-indigo-600">{CURRENT_USER.name}</span>
                </div>
                <p className="text-slate-500 mt-2 text-sm">Evidence Reviewer</p>
              </div> </div>
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-4 mb-6">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center">
                  <Shield className="w-5 h-5 text-white" />
                </div>
                <div>
                  <p className="font-bold text-blue-800">ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (Segregation of Duties)</p>
                  <p className="text-sm text-blue-700">Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø±ÙØ¹Ù‡Ø§ Ø¨Ù†ÙØ³Ùƒ - ÙŠØªÙ… ØªÙ…ÙŠÙŠØ²Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
                </div> </div> </div>
            {pendingReview.length > 0 ? (
              <div className="space-y-4">
                {pendingReview.map(evd => {
                  const canReviewThis = canReview(evd);
                  const typeCfg = TYPE_CONFIG[evd.evidenceType] || { label: evd.evidenceType, icon: File, color: 'slate' };
                  const TypeIcon = typeCfg.icon;
                  return (
                    <div key={evd.id} className={`bg-white rounded-xl border-2 p-5 transition-all ${canReviewThis ? 'border-amber-300 hover:shadow-xl hover:border-amber-400' : 'border-slate-200 opacity-60'}`}>
                      <div className="flex items-start justify-between">
                        <div className="flex items-start gap-4">
                          <div className={`w-14 h-14 rounded-xl flex items-center justify-center bg-${typeCfg.color}-100`}>
                            <TypeIcon className={`w-7 h-7 text-${typeCfg.color}-600`} />
                          </div>
                          <div>
                            <div className="flex items-center gap-2 mb-1">
                              <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-100 px-2 py-0.5 rounded">{evd.code}</span>
                              <span className={`px-2 py-0.5 rounded text-xs font-bold bg-${typeCfg.color}-100 text-${typeCfg.color}-700`}>{typeCfg.label}</span>
                              {evd.priority && <span className={`px-2 py-0.5 rounded text-xs font-bold bg-${PRIORITY_CONFIG[evd.priority]?.color || 'slate'}-100 text-${PRIORITY_CONFIG[evd.priority]?.color || 'slate'}-700`}>{PRIORITY_CONFIG[evd.priority]?.label}</span>}
                            </div>
                            <h4 className="font-bold text-slate-800 text-lg">{evd.title}</h4>
                            <p className="text-sm text-slate-500 mt-1 flex items-center gap-2">
                              <Paperclip className="w-4 h-4" />{evd.fileName} â€¢ {evd.fileSize}
                            </p>
                            <div className="flex items-center gap-6 mt-3 text-sm">
                              <span className="text-slate-600">Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©: <strong className="text-slate-800">{evd.ownerName}</strong></span>
                              <span className="text-slate-600">Ø§Ù„ÙØªØ±Ø©: <strong className="text-indigo-600">{evd.period}</strong></span>
                              <span className="text-slate-600">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: <strong className="text-slate-800">{evd.validityEnd}</strong></span>
                            </div>
                            {evd.linkedObligations && evd.linkedObligations.length > 0 && (
                              <div className="flex items-center gap-2 mt-2">
                                <Link2 className="w-4 h-4 text-indigo-500" />
                                <span className="text-xs text-indigo-600">Ù…Ø±ØªØ¨Ø· Ø¨Ù€: {evd.linkedObligations.join(', ')}</span>
                              </div>
                            )}
                          </div> </div>
                        <div className="flex items-center gap-3">
                          {canReviewThis ? (
                            <>
                              <button onClick={() => { setSelectedEvidence(evd); setShowDetailModal(true); }} className="flex items-center gap-2 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 transition-all">
                                <Eye className="w-5 h-5" />Ø¹Ø±Ø¶
                              </button>
                              <button onClick={() => { setSelectedEvidence(evd); setRejectComment(''); setShowReviewModal(true); }} className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                <CheckCircle2 className="w-5 h-5" />Ù…Ø±Ø§Ø¬Ø¹Ø©
                              </button>
                            </>
                          ) : (
                            <div className="flex items-center gap-2 px-4 py-2.5 bg-slate-100 text-slate-500 rounded-xl">
                              <Lock className="w-4 h-4" />
                              <span className="text-sm font-medium">SoD - Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                            </div>
                          )}
                        </div> </div> </div>);
                })}
              </div>
            ) : (
              <div className="text-center py-16 bg-gradient-to-b from-slate-50 to-white rounded-xl border-2 border-dashed border-slate-200">
                <div className="w-20 h-20 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-4">
                  <CheckCircle2 className="w-10 h-10 text-emerald-500" />
                </div>
                <h3 className="text-xl font-bold text-slate-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
                <p className="text-slate-500 mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§</p>
              </div>
            )}
          </div>
        )}

        {activeTab === 'pack' && (
          <div className="p-6">
            <div className="bg-gradient-to-br from-indigo-500 via-purple-500 to-violet-600 rounded-2xl p-6 text-white mb-6 relative overflow-hidden">
              <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2" />
              <div className="absolute bottom-0 left-0 w-40 h-40 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2" />
              <div className="relative">
                <div className="flex items-center gap-4 mb-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <Package className="w-7 h-7" />
                  </div>
                  <div>
                    <h3 className="text-2xl font-bold">Ù…ÙˆÙ„Ù‘Ø¯ Ø­Ø²Ù… Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚</h3>
                    <p className="text-indigo-200">Evidence Pack Generator - Audit Ready</p>
                  </div> </div>
                <p className="text-indigo-100 mb-6 max-w-2xl">Ø£Ù†Ø´Ø¦ Ø­Ø²Ù…Ø© Ø£Ø¯Ù„Ø© Ø´Ø§Ù…Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© Ù…Ø¹ Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ¬ÙˆØ§Øª.</p>
                <div className="grid grid-cols-4 gap-4 mb-6">
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <p className="text-indigo-200 text-sm">Ø£Ø¯Ù„Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©</p>
                    <p className="text-2xl font-bold">{stats.accepted}</p>
                  </div>
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <p className="text-indigo-200 text-sm">ÙˆØ«Ø§Ø¦Ù‚ Ù†Ø´Ø·Ø©</p>
                    <p className="text-2xl font-bold">{documents.filter(d => d.status === 'Active').length}</p>
                  </div>
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <p className="text-indigo-200 text-sm">Ø­Ø²Ù… Ø¬Ø§Ù‡Ø²Ø©</p>
                    <p className="text-2xl font-bold">{auditPacks.length}</p>
                  </div>
                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-4">
                    <p className="text-indigo-200 text-sm">Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</p>
                    <p className="text-2xl font-bold text-amber-300">{stats.expired}</p>
                  </div> </div>
                <button onClick={() => setShowPackModal(true)} className="flex items-center gap-2 px-6 py-3 bg-white text-indigo-600 rounded-xl font-bold hover:bg-indigo-50 shadow-lg hover:shadow-xl transition-all">
                  <Zap className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button> </div> </div>
            <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><History className="w-5 h-5 text-slate-500" />Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h4>
            <div className="grid grid-cols-2 gap-4">
              {auditPacks.map(pack => (
                <div key={pack.id} className="bg-white rounded-xl border-2 border-slate-200 p-5 hover:shadow-lg hover:border-indigo-300 transition-all">
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 rounded-xl bg-indigo-100 flex items-center justify-center">
                        <Package className="w-6 h-6 text-indigo-600" />
                      </div>
                      <div>
                        <span className="font-mono text-xs text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded">{pack.code}</span>
                        <h5 className="font-bold text-slate-800 mt-1">{pack.name}</h5>
                      </div> </div>
                    <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">{pack.status}</span>
                  </div>
                  <div className="grid grid-cols-3 gap-3 mt-4">
                    <div className="text-center p-2 bg-slate-50 rounded-lg">
                      <p className="text-lg font-bold text-indigo-600">{pack.evidenceCount}</p>
                      <p className="text-xs text-slate-500">Ø£Ø¯Ù„Ø©</p>
                    </div>
                    <div className="text-center p-2 bg-slate-50 rounded-lg">
                      <p className="text-lg font-bold text-purple-600">{pack.documentsCount}</p>
                      <p className="text-xs text-slate-500">ÙˆØ«Ø§Ø¦Ù‚</p>
                    </div>
                    <div className="text-center p-2 bg-slate-50 rounded-lg">
                      <p className="text-lg font-bold text-slate-700">{pack.size}</p>
                      <p className="text-xs text-slate-500">Ø§Ù„Ø­Ø¬Ù…</p>
                    </div> </div>
                  <div className="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                    <div className="text-xs text-slate-500">
                      <span>Ø¨ÙˆØ§Ø³Ø·Ø© {pack.createdBy}</span> â€¢ <span>{pack.createdAt}</span>
                    </div>
                    <button className="flex items-center gap-1 px-3 py-1.5 bg-indigo-100 text-indigo-600 rounded-lg text-sm font-bold hover:bg-indigo-200">
                      <Download className="w-4 h-4" />ØªØ­Ù…ÙŠÙ„
                    </button> </div> </div>
              ))}
            </div> </div>
        )}
      </div>

      {showUploadModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-indigo-600 via-purple-600 to-violet-700 px-8 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <Upload className="w-8 h-8" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
                    <p className="text-indigo-200">Enterprise Evidence Upload - Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="text-center px-4 py-2 bg-white/10 backdrop-blur rounded-xl">
                    <p className="text-white/70 text-xs">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                    <p className="text-2xl font-black">{uploadForm.files?.length || 0}</p>
                  </div>
                  <button onClick={() => setShowUploadModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="flex gap-1 bg-white/10 rounded-xl p-1">
                {[
                  { id: 0, label: 'Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª', icon: Upload, desc: 'Upload Files' },
                  { id: 1, label: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ù„ÙŠÙ„', icon: FileText, desc: 'Evidence Details' },
                  { id: 2, label: 'Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªØµÙ†ÙŠÙ', icon: Link2, desc: 'Golden Thread' },
                  { id: 3, label: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹', icon: CheckCircle2, desc: 'Approval Workflow' },
                ].map(tab => (
                  <button key={tab.id}
                    onClick={() => setUploadForm({ ...uploadForm, activeUploadTab: tab.id })}
                    className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-bold transition-all ${(uploadForm.activeUploadTab || 0) === tab.id
                      ? 'bg-white text-purple-700 shadow-lg'
                      : 'text-white/80 hover:bg-white/10'
                      }`}>
                    <tab.icon className="w-4 h-4" />
                    <span className="text-sm">{tab.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">

              {(uploadForm.activeUploadTab || 0) === 0 && (
                <div className="space-y-6">
                  <div className={`border-3 border-dashed rounded-2xl p-10 text-center transition-all cursor-pointer ${dragOver ? 'border-indigo-500 bg-indigo-50 scale-[1.01]' : 'border-slate-300 hover:border-indigo-400 hover:bg-slate-50'
                    }`}
                    onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                    onDragLeave={() => setDragOver(false)}
                    onDrop={(e) => {
                      e.preventDefault(); setDragOver(false);
                      const files = Array.from(e.dataTransfer.files);
                      setUploadForm({ ...uploadForm, files: [...(uploadForm.files || []), ...files] });
                    }}>
                    <div className="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center mx-auto mb-4">
                      <Upload className="w-10 h-10 text-indigo-600" />
                    </div>
                    <p className="text-slate-800 font-bold text-xl mb-2">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                    <p className="text-sm text-slate-500 mb-4">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div className="flex items-center justify-center gap-3 mb-4">
                      {[
                        { ext: 'PDF', color: 'red' },
                        { ext: 'XLSX', color: 'emerald' },
                        { ext: 'DOCX', color: 'blue' },
                        { ext: 'PNG', color: 'amber' },
                        { ext: 'JPG', color: 'orange' },
                        { ext: 'ZIP', color: 'purple' },
                      ].map(f => (
                        <span key={f.ext} className={`px-2 py-1 bg-${f.color}-100 text-${f.color}-700 rounded text-xs font-bold`}>{f.ext}</span>
                      ))}
                    </div>
                    <p className="text-xs text-slate-400">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 100 MB Ù„ÙƒÙ„ Ù…Ù„Ù â€¢ 10 Ù…Ù„ÙØ§Øª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰</p>
                    <button className="mt-4 px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                      <FolderPlus className="w-5 h-5 inline ml-2" />Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
                    </button> </div>
                  {(uploadForm.files?.length > 0 || true) && (
                    <div className="bg-slate-50 rounded-2xl p-5 border border-slate-200">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <Package className="w-5 h-5 text-indigo-600" />
                        Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø±ÙØ¹
                        <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-bold mr-2">
                          {uploadForm.files?.length || 3} Ù…Ù„Ù
                        </span>
                      </h4>

                      <div className="space-y-3 max-h-60 overflow-y-auto">
                        {[
                          { name: 'AML_Report_Jan2025.pdf', size: '2.4 MB', type: 'PDF', status: 'ready', progress: 100 },
                          { name: 'Transaction_Log.xlsx', size: '1.8 MB', type: 'XLSX', status: 'uploading', progress: 65 },
                          { name: 'Supporting_Document.docx', size: '856 KB', type: 'DOCX', status: 'ready', progress: 100 },
                        ].map((file, idx) => (
                          <div key={idx} className="flex items-center gap-4 bg-white rounded-xl p-4 border border-slate-200">
                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${file.type === 'PDF' ? 'bg-red-100 text-red-600' :
                              file.type === 'XLSX' ? 'bg-emerald-100 text-emerald-600' :
                                'bg-blue-100 text-blue-600'
                              }`}>
                              <FileText className="w-6 h-6" />
                            </div>
                            <div className="flex-1 min-w-0">
                              <p className="font-bold text-slate-800 truncate">{file.name}</p>
                              <div className="flex items-center gap-3 mt-1">
                                <span className="text-xs text-slate-500">{file.size}</span>
                                <span className={`px-2 py-0.5 rounded text-xs font-bold ${file.type === 'PDF' ? 'bg-red-100 text-red-700' :
                                  file.type === 'XLSX' ? 'bg-emerald-100 text-emerald-700' :
                                    'bg-blue-100 text-blue-700'
                                  }`}>{file.type}</span>
                                {file.status === 'uploading' && (
                                  <div className="flex-1 max-w-32">
                                    <div className="h-1.5 bg-slate-200 rounded-full overflow-hidden">
                                      <div className="h-full bg-indigo-500 rounded-full transition-all" style={{ width: `${file.progress}%` }}></div>
                                    </div> </div>
                                )}
                                {file.status === 'ready' && (
                                  <span className="text-xs text-emerald-600 font-bold flex items-center gap-1">
                                    <CheckCircle2 className="w-3 h-3" />Ø¬Ø§Ù‡Ø²
                                  </span>
                                )}
                              </div> </div>
                            <div className="flex items-center gap-2">
                              <button className="w-8 h-8 rounded-lg bg-slate-100 text-slate-600 flex items-center justify-center hover:bg-slate-200">
                                <Eye className="w-4 h-4" />
                              </button>
                              <button className="w-8 h-8 rounded-lg bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200">
                                <Trash2 className="w-4 h-4" />
                              </button> </div> </div>
                        ))}
                      </div>

                      <div className="mt-4 pt-4 border-t border-slate-200 grid grid-cols-4 gap-4">
                        <div className="text-center">
                          <p className="text-2xl font-black text-indigo-600">3</p>
                          <p className="text-xs text-slate-500">Ù…Ù„ÙØ§Øª</p>
                        </div>
                        <div className="text-center">
                          <p className="text-2xl font-black text-purple-600">5.1 MB</p>
                          <p className="text-xs text-slate-500">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒÙ„ÙŠ</p>
                        </div>
                        <div className="text-center">
                          <p className="text-2xl font-black text-emerald-600">2</p>
                          <p className="text-xs text-slate-500">Ø¬Ø§Ù‡Ø²</p>
                        </div>
                        <div className="text-center">
                          <p className="text-2xl font-black text-amber-600">1</p>
                          <p className="text-xs text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„Ø±ÙØ¹</p>
                        </div> </div> </div>
                  )}

                  <div className="grid grid-cols-3 gap-4">
                    {[
                      { label: 'Ù…Ù† Google Drive', icon: Globe, color: 'blue' },
                      { label: 'Ù…Ù† OneDrive', icon: Globe, color: 'indigo' },
                      { label: 'Ù…Ù† SharePoint', icon: Globe, color: 'purple' },
                    ].map((opt, idx) => (
                      <button key={idx} className={`flex items-center justify-center gap-2 p-4 bg-${opt.color}-50 border-2 border-${opt.color}-200 rounded-xl font-bold text-${opt.color}-700 hover:bg-${opt.color}-100 transition-all`}>
                        <opt.icon className="w-5 h-5" />
                        {opt.label}
                      </button>
                    ))}
                  </div> </div>
              )}

              {(uploadForm.activeUploadTab || 0) === 1 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                      <label className="flex items-center gap-2 font-bold text-indigo-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm">1</span>
                        Ù†ÙˆØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ *
                      </label>
                      <div className="grid grid-cols-2 gap-2">
                        {[
                          { value: 'Report', label: 'ØªÙ‚Ø±ÙŠØ±', icon: 'ğŸ“Š' },
                          { value: 'Document', label: 'Ù…Ø³ØªÙ†Ø¯', icon: 'ğŸ“„' },
                          { value: 'Screenshot', label: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', icon: 'ğŸ–¼ï¸' },
                          { value: 'Log', label: 'Ø³Ø¬Ù„', icon: 'ğŸ“‹' },
                          { value: 'Certificate', label: 'Ø´Ù‡Ø§Ø¯Ø©', icon: 'ğŸ†' },
                          { value: 'Contract', label: 'Ø¹Ù‚Ø¯', icon: 'ğŸ“' },
                          { value: 'Policy', label: 'Ø³ÙŠØ§Ø³Ø©', icon: 'ğŸ“œ' },
                          { value: 'Other', label: 'Ø£Ø®Ø±Ù‰', icon: 'ğŸ“' },
                        ].map(type => {
                          const isSelected = uploadForm.evidenceType === type.value;
                          return (
                            <button key={type.value} type="button"
                              onClick={() => setUploadForm({ ...uploadForm, evidenceType: type.value })}
                              className={`flex items-center gap-2 p-3 rounded-xl border-2 transition-all ${isSelected ? 'border-indigo-500 bg-indigo-100' : 'border-slate-200 bg-white hover:border-slate-300'
                                }`}>
                              <span className="text-xl">{type.icon}</span>
                              <span className={`text-sm font-bold ${isSelected ? 'text-indigo-700' : 'text-slate-700'}`}>{type.label}</span>
                            </button>);
                        })}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">2</span>
                        Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ
                      </label>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ù„ÙŠÙ„ *</label>
                          <input type="text" value={uploadForm.title} onChange={(e) => setUploadForm({ ...uploadForm, title: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                            placeholder="Ù…Ø«Ø§Ù„: ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - ÙŠÙ†Ø§ÙŠØ± 2025" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
                          <textarea rows={3} value={uploadForm.description} onChange={(e) => setUploadForm({ ...uploadForm, description: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none resize-none"
                            placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¯Ù„ÙŠÙ„ ÙˆÙ…Ø­ØªÙˆÙŠØ§ØªÙ‡..." />
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-amber-500 text-white flex items-center justify-center text-sm">3</span>
                        Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
                      </label>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                          <div className="flex gap-2">
                            {[
                              { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                              { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                              { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                              { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                            ].map(pri => {
                              const isSelected = (uploadForm.priority || 'Medium') === pri.value;
                              return (
                                <button key={pri.value} type="button"
                                  onClick={() => setUploadForm({ ...uploadForm, priority: pri.value })}
                                  className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${isSelected ? `bg-${pri.color}-500 text-white` : `bg-${pri.color}-50 text-${pri.color}-700 hover:bg-${pri.color}-100`
                                    }`}>
                                  {pri.label}
                                </button>);
                            })}
                          </div> </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ø±ÙŠ</label>
                          <select value={uploadForm.confidentiality} onChange={(e) => setUploadForm({ ...uploadForm, confidentiality: e.target.value })}
                            className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                            <option value="Public">Ø¹Ø§Ù…</option>
                            <option value="Internal">Ø¯Ø§Ø®Ù„ÙŠ</option>
                            <option value="Confidential">Ø³Ø±ÙŠ</option>
                            <option value="Restricted">Ù…Ù‚ÙŠØ¯</option>
                          </select>
                        </div> </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                      <label className="flex items-center gap-2 font-bold text-blue-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center text-sm">4</span>
                        <Calendar className="w-5 h-5" />
                        Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙØªØ±Ø§Øª
                      </label>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± *</label>
                          <input type="date" value={uploadForm.issueDate} onChange={(e) => setUploadForm({ ...uploadForm, issueDate: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© *</label>
                          <input type="date" value={uploadForm.validityEnd} onChange={(e) => setUploadForm({ ...uploadForm, validityEnd: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</label>
                          <input type="text" value={uploadForm.period} onChange={(e) => setUploadForm({ ...uploadForm, period: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none"
                            placeholder="Ù…Ø«Ø§Ù„: 2025-Q1" />
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                          <input type="date" value={uploadForm.reminderDate} onChange={(e) => setUploadForm({ ...uploadForm, reminderDate: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-sm">5</span>
                        <Tag className="w-5 h-5" />
                        Ø§Ù„ÙˆØ³ÙˆÙ… ÙˆØ§Ù„ØªØµÙ†ÙŠÙØ§Øª
                      </label>
                      <input type="text" value={uploadForm.tags} onChange={(e) => setUploadForm({ ...uploadForm, tags: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:outline-none mb-3"
                        placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ³ÙˆÙ… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©" />
                      <div className="flex flex-wrap gap-2">
                        {['AML', 'Ø´Ù‡Ø±ÙŠ', 'SAMA', 'ØªÙ‚Ø±ÙŠØ±', '2025'].map(tag => (
                          <span key={tag} className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold flex items-center gap-1">
                            {tag}
                            <X className="w-3 h-3 cursor-pointer hover:text-emerald-900" />
                          </span>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">6</span>
                        Ø§Ù„Ù…ØµØ¯Ø± ÙˆØ§Ù„Ù…Ø±Ø¬Ø¹
                      </label>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ù…ØµØ¯Ø± Ø§Ù„Ø¯Ù„ÙŠÙ„</label>
                          <select value={uploadForm.source} onChange={(e) => setUploadForm({ ...uploadForm, source: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ØµØ¯Ø±...</option>
                            <option value="Internal">Ø¯Ø§Ø®Ù„ÙŠ - Ù…Ù† Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø©</option>
                            <option value="External">Ø®Ø§Ø±Ø¬ÙŠ - Ù…Ù† Ø¬Ù‡Ø© Ø£Ø®Ø±Ù‰</option>
                            <option value="Regulator">ØªÙ†Ø¸ÙŠÙ…ÙŠ - Ù…Ù† Ø¬Ù‡Ø© Ø±Ù‚Ø§Ø¨ÙŠØ©</option>
                            <option value="Audit">ØªØ¯Ù‚ÙŠÙ‚ - Ù…Ù† Ù…Ø±Ø§Ø¬Ø¹</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</label>
                          <input type="text" value={uploadForm.externalRef} onChange={(e) => setUploadForm({ ...uploadForm, externalRef: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                            placeholder="Ù…Ø«Ø§Ù„: REF-2025-001" />
                        </div> </div> </div> </div> </div>
              )}

              {(uploadForm.activeUploadTab || 0) === 2 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                      <label className="flex items-center gap-2 font-bold text-amber-800 mb-4">
                        <Link2 className="w-5 h-5" />
                        Ø±Ø¨Ø· Ø¨Ù€ Golden Thread
                      </label>

                      <div className="space-y-3">
                        {[
                          { type: 'obligation', label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', icon: 'ğŸ“‹', color: 'indigo', selected: 'OBL-001: ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„' },
                          { type: 'control', label: 'Ø§Ù„Ø¶Ø§Ø¨Ø·', icon: 'ğŸ›¡ï¸', color: 'emerald', selected: null },
                          { type: 'risk', label: 'Ø§Ù„Ø®Ø·Ø±', icon: 'âš ï¸', color: 'red', selected: null },
                          { type: 'policy', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', icon: 'ğŸ“œ', color: 'purple', selected: null },
                        ].map(obj => (
                          <div key={obj.type} className={`bg-white rounded-xl p-4 border-2 ${obj.selected ? `border-${obj.color}-300` : 'border-slate-200'}`}>
                            <div className="flex items-center justify-between mb-2">
                              <div className="flex items-center gap-2">
                                <span className="text-xl">{obj.icon}</span>
                                <span className="font-bold text-slate-700">{obj.label}</span>
                              </div>
                              {obj.selected ? (
                                <span className="px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-xs font-bold">Ù…Ø±Ø¨ÙˆØ·</span>
                              ) : (
                                <button className={`px-3 py-1 bg-${obj.color}-100 text-${obj.color}-700 rounded-lg text-xs font-bold hover:bg-${obj.color}-200`}>
                                  + Ø±Ø¨Ø·
                                </button>
                              )}
                            </div>
                            {obj.selected && (
                              <div className={`flex items-center justify-between p-2 bg-${obj.color}-50 rounded-lg`}>
                                <span className="text-sm text-slate-700 truncate">{obj.selected}</span>
                                <button className="text-red-500 hover:text-red-700">
                                  <X className="w-4 h-4" />
                                </button> </div>
                            )}
                          </div>
                        ))}
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <ClipboardCheck className="w-5 h-5" />
                        Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                      </label>
                      <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none mb-3">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ù…Ø©...</option>
                        <option value="task-1">TASK-001: ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ</option>
                        <option value="task-2">TASK-002: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„</option>
                      </select>
                      <div className="p-3 bg-indigo-50 rounded-xl border border-indigo-200">
                        <div className="flex items-center gap-2">
                          <CheckCircle2 className="w-4 h-4 text-indigo-600" />
                          <span className="text-sm text-indigo-800 font-bold">TASK-001</span>
                        </div>
                        <p className="text-xs text-slate-600 mt-1">ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ - ÙŠÙ†Ø§ÙŠØ± 2025</p>
                      </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-2xl p-5 border-2 border-indigo-200">
                      <label className="flex items-center gap-2 font-bold text-indigo-800 mb-4">
                        <Building2 className="w-5 h-5" />
                        Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                      </label>
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                          <select className="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                            <option value="SAMA">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</option>
                            <option value="CMA">CMA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                            <option value="NCA">NCA - Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                            <option value="SDAIA">SDAIA - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø±</label>
                          <select className="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                            <option value="AML">SAMA-AML - Ù…ÙƒØ§ÙØ­Ø© ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</option>
                            <option value="Cyber">NCA-Cyber - Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                            <option value="PDPL">PDPL - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                          </select>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <Users className="w-5 h-5" />
                        Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„
                      </label>
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù‚Ø³Ù…</label>
                          <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-slate-400 focus:outline-none">
                            <option value="compliance">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</option>
                            <option value="risk">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                            <option value="audit">Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</option>
                            <option value="legal">Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</option>
                            <option value="it">ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                          <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-slate-400 focus:outline-none">
                            {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                          </select>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <Layers className="w-5 h-5" />
                        ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„
                      </label>
                      <div className="flex flex-wrap gap-2">
                        {[
                          { label: 'AML/CFT', active: true },
                          { label: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', active: false },
                          { label: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', active: false },
                          { label: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', active: false },
                          { label: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', active: true },
                          { label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', active: false },
                        ].map(cat => (
                          <button key={cat.label}
                            className={`px-3 py-2 rounded-xl text-sm font-bold transition-all ${cat.active
                              ? 'bg-indigo-500 text-white'
                              : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                              }`}>
                            {cat.label}
                          </button>
                        ))}
                      </div> </div> </div> </div>
              )}

              {(uploadForm.activeUploadTab || 0) === 3 && (
                <div className="grid grid-cols-2 gap-6">
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                      <label className="flex items-center gap-2 font-bold text-emerald-800 mb-4">
                        <CheckCircle2 className="w-5 h-5" />
                        Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
                      </label>

                      <div className="space-y-3">
                        {[
                          { step: 1, role: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£ÙˆÙ„', user: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', status: 'pending', color: 'amber' },
                          { step: 2, role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', status: 'waiting', color: 'slate' },
                          { step: 3, role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', user: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', status: 'waiting', color: 'slate' },
                        ].map(approver => (
                          <div key={approver.step} className={`bg-white rounded-xl p-4 border-2 ${approver.status === 'pending' ? 'border-amber-300' : 'border-slate-200'
                            }`}>
                            <div className="flex items-center gap-4">
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold ${approver.status === 'approved' ? 'bg-emerald-500 text-white' :
                                approver.status === 'pending' ? 'bg-amber-500 text-white' :
                                  'bg-slate-200 text-slate-500'
                                }`}>
                                {approver.status === 'approved' ? <Check className="w-5 h-5" /> : approver.step}
                              </div>
                              <div className="flex-1">
                                <p className="font-bold text-slate-800">{approver.role}</p>
                                <p className="text-sm text-slate-500">{approver.user}</p>
                              </div>
                              <span className={`px-3 py-1 rounded-lg text-xs font-bold ${approver.status === 'approved' ? 'bg-emerald-100 text-emerald-700' :
                                approver.status === 'pending' ? 'bg-amber-100 text-amber-700' :
                                  'bg-slate-100 text-slate-500'
                                }`}>
                                {approver.status === 'approved' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©' :
                                  approver.status === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                              </span> </div> </div>
                        ))}
                      </div>

                      <button className="mt-4 w-full px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-200">
                        + Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§ÙÙ‚
                      </button> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <Bell className="w-5 h-5" />
                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                      </label>
                      <div className="space-y-3">
                        {[
                          { label: 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', checked: true },
                          { label: 'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', checked: true },
                          { label: 'ØªØ°ÙƒÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 3 Ø£ÙŠØ§Ù…', checked: false },
                          { label: 'ØªØµØ¹ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 7 Ø£ÙŠØ§Ù…', checked: false },
                        ].map((opt, idx) => (
                          <label key={idx} className="flex items-center justify-between p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                            <span className="text-sm font-bold text-slate-700">{opt.label}</span>
                            <input type="checkbox" defaultChecked={opt.checked} className="w-5 h-5 rounded text-indigo-500" />
                          </label>
                        ))}
                      </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-5 border-2 border-blue-200">
                      <label className="flex items-center gap-2 font-bold text-blue-800 mb-4">
                        <Shield className="w-5 h-5" />
                        Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                      </label>

                      <div className="bg-white rounded-xl p-4 border border-blue-200 mb-4">
                        <div className="flex items-center justify-between mb-3">
                          <span className="font-bold text-slate-700">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù…Ø·Ù„ÙˆØ¨</span>
                          <label className="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" defaultChecked className="sr-only peer" />
                            <div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                          </label>
                        </div>
                        <p className="text-xs text-slate-500">Ø³ÙŠØªÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚ÙŠÙ†</p>
                      </div>

                      <div className="p-4 bg-blue-100 rounded-xl border border-blue-200">
                        <div className="flex items-center gap-3 mb-2">
                          <Lock className="w-5 h-5 text-blue-600" />
                          <span className="font-bold text-blue-800">Ø­Ù…Ø§ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</span>
                        </div>
                        <input type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                          className="w-full px-4 py-2 border border-blue-200 rounded-lg bg-white focus:border-blue-400 focus:outline-none text-sm" />
                      </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <FileCheck className="w-5 h-5" />
                        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù„Ø§Ù…Ø©
                      </label>

                      <div className="space-y-3">
                        <div className="p-3 bg-emerald-50 rounded-xl border border-emerald-200">
                          <div className="flex items-center gap-2 mb-1">
                            <CheckCircle2 className="w-4 h-4 text-emerald-600" />
                            <span className="font-bold text-emerald-800 text-sm">SHA-256 Checksum</span>
                          </div>
                          <code className="text-xs text-slate-600 break-all">a7f5e8c9d3b2a1...</code>
                        </div>
                        <div className="p-3 bg-emerald-50 rounded-xl border border-emerald-200">
                          <div className="flex items-center gap-2 mb-1">
                            <CheckCircle2 className="w-4 h-4 text-emerald-600" />
                            <span className="font-bold text-emerald-800 text-sm">MD5 Checksum</span>
                          </div>
                          <code className="text-xs text-slate-600 break-all">e3b0c442...</code>
                        </div>
                        <div className="p-3 bg-blue-50 rounded-xl border border-blue-200">
                          <div className="flex items-center gap-2 mb-1">
                            <Shield className="w-4 h-4 text-blue-600" />
                            <span className="font-bold text-blue-800 text-sm">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª</span>
                          </div>
                          <span className="text-xs text-emerald-600 font-bold">âœ“ Ø§Ù„Ù…Ù„Ù Ù†Ø¸ÙŠÙ</span>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                      <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                        <Archive className="w-5 h-5" />
                        Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸
                      </label>
                      <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-slate-400 focus:outline-none">
                        <option value="1year">Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                        <option value="3years">3 Ø³Ù†ÙˆØ§Øª</option>
                        <option value="5years" selected>5 Ø³Ù†ÙˆØ§Øª</option>
                        <option value="7years">7 Ø³Ù†ÙˆØ§Øª</option>
                        <option value="permanent">Ø¯Ø§Ø¦Ù…</option>
                      </select>
                      <p className="text-xs text-slate-500 mt-2">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ÙØªØ±Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸</p>
                    </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-8 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between">
              <button onClick={() => setShowUploadModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>

              <div className="flex items-center gap-2">
                <button
                  onClick={() => setUploadForm({ ...uploadForm, activeUploadTab: Math.max(0, (uploadForm.activeUploadTab || 0) - 1) })}
                  disabled={(uploadForm.activeUploadTab || 0) === 0}
                  className={`px-4 py-2 rounded-xl font-bold text-sm ${(uploadForm.activeUploadTab || 0) === 0 ? 'bg-slate-100 text-slate-300' : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-purple-500'
                    }`}>
                  <ChevronRight className="w-4 h-4 inline" /> Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <div className="flex gap-1 px-2">
                  {[0, 1, 2, 3].map(idx => (
                    <button key={idx}
                      onClick={() => setUploadForm({ ...uploadForm, activeUploadTab: idx })}
                      className={`w-8 h-8 rounded-lg font-bold text-sm ${(uploadForm.activeUploadTab || 0) === idx ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                        }`}>
                      {idx + 1}
                    </button>
                  ))}
                </div>
                <button
                  onClick={() => setUploadForm({ ...uploadForm, activeUploadTab: Math.min(3, (uploadForm.activeUploadTab || 0) + 1) })}
                  disabled={(uploadForm.activeUploadTab || 0) === 3}
                  className={`px-4 py-2 rounded-xl font-bold text-sm ${(uploadForm.activeUploadTab || 0) === 3 ? 'bg-slate-100 text-slate-300' : 'bg-white border-2 border-slate-300 text-slate-700 hover:border-purple-500'
                    }`}>
                  Ø§Ù„ØªØ§Ù„ÙŠ <ChevronLeft className="w-4 h-4 inline" />
                </button> </div>
              <button onClick={() => {
                alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰\nØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…ÙˆØ§ÙÙ‚ÙŠÙ†.');
                setShowUploadModal(false);
              }} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-violet-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                <Upload className="w-5 h-5" />Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„
              </button> </div> </div> </div>
      )}

      {showReviewModal && selectedEvidence && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-amber-500 via-orange-500 to-red-500 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                  <ClipboardCheck className="w-7 h-7" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„</h2>
                  <p className="text-amber-100">{selectedEvidence.code} - {TYPE_CONFIG[selectedEvidence.evidenceType]?.label}</p>
                </div> </div> </div>
            <div className="p-6 space-y-5">
              <div className="bg-slate-50 rounded-xl p-4">
                <h4 className="font-bold text-slate-800 text-lg mb-2">{selectedEvidence.title}</h4>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div><span className="text-slate-500">Ø§Ù„Ø­Ø¬Ù…:</span> <span className="font-medium">{selectedEvidence.fileSize}</span></div>
                  <div><span className="text-slate-500">Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©:</span> <span className="font-medium">{selectedEvidence.ownerName}</span></div>
                  <div><span className="text-slate-500">Ø§Ù„ÙØªØ±Ø©:</span> <span className="font-medium">{selectedEvidence.period}</span></div>
                  <div><span className="text-slate-500">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</span> <span className="font-medium">{selectedEvidence.validityEnd}</span></div>
                </div> </div>
              <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                <div className="flex items-center gap-2 mb-2">
                  <Shield className="w-5 h-5 text-blue-600" />
                  <span className="font-bold text-blue-800">Checksum SHA-256</span>
                </div>
                <code className="text-xs text-blue-700 break-all bg-blue-100 px-2 py-1 rounded block">{selectedEvidence.checksumSha256}</code>
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (Ù…Ø·Ù„ÙˆØ¨ 20 Ø­Ø±Ù Ù„Ù„Ø±ÙØ¶):</label>
                <textarea value={rejectComment} onChange={(e) => setRejectComment(e.target.value)} rows={3}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none focus:border-amber-500 focus:outline-none" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ø¥Ù† ÙˆØ¬Ø¯..." />
                <div className={`text-xs mt-1 ${rejectComment.length >= 20 ? 'text-emerald-600' : 'text-slate-400'}`}>{rejectComment.length}/20 Ø­Ø±Ù</div>
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowReviewModal(false); setRejectComment(''); }} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <div className="flex items-center gap-3">
                <button onClick={handleReject} disabled={rejectComment.length < 20}
                  className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${rejectComment.length >= 20 ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}>
                  <XCircle className="w-5 h-5" />Ø±ÙØ¶
                </button>
                <button onClick={handleAccept} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                  <CheckCircle2 className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯
                </button> </div> </div> </div> </div>
      )}

      {showDetailModal && selectedEvidence && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white ${selectedEvidence.status === 'Accepted' ? 'bg-gradient-to-l from-emerald-500 to-teal-600' : selectedEvidence.status === 'Rejected' ? 'bg-gradient-to-l from-red-500 to-rose-600' : selectedEvidence.status === 'Expired' ? 'bg-gradient-to-l from-orange-500 to-amber-600' : 'bg-gradient-to-l from-indigo-500 to-purple-600'}`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    {(() => { const TypeIcon = TYPE_CONFIG[selectedEvidence.evidenceType]?.icon || FileText; return <TypeIcon className="w-7 h-7" />; })()}
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-0.5 rounded">{selectedEvidence.code}</span>
                      <span className="px-2 py-0.5 bg-white/20 rounded text-xs">{TYPE_CONFIG[selectedEvidence.evidenceType]?.label}</span>
                    </div>
                    <h2 className="text-xl font-bold">{selectedEvidence.title}</h2>
                  </div> </div>
                <button onClick={() => setShowDetailModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-5">
              <div className={`rounded-xl p-4 ${STATUS_CONFIG[selectedEvidence.status]?.bg} border-2`}>
                <div className="flex items-center gap-3">
                  {(() => { const Icon = STATUS_CONFIG[selectedEvidence.status]?.icon || Clock; return <Icon className={`w-6 h-6 ${STATUS_CONFIG[selectedEvidence.status]?.text}`} />; })()}
                  <p className={`font-bold text-lg ${STATUS_CONFIG[selectedEvidence.status]?.text}`}>{STATUS_CONFIG[selectedEvidence.status]?.label}</p>
                </div>
                {selectedEvidence.status === 'Rejected' && selectedEvidence.reviewerComment && (
                  <div className="mt-3 p-3 bg-white rounded-lg">
                    <p className="text-sm text-red-700"><strong>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:</strong> {selectedEvidence.reviewerComment}</p>
                  </div>
                )}
              </div>

              {selectedEvidence.fileName && (
                <div className="bg-slate-50 rounded-xl p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 rounded-xl bg-slate-200 flex items-center justify-center">
                      <Paperclip className="w-6 h-6 text-slate-600" />
                    </div>
                    <div>
                      <p className="font-bold text-slate-800">{selectedEvidence.fileName}</p>
                      <p className="text-sm text-slate-500">{selectedEvidence.fileSize}</p>
                    </div> </div>
                  <button className="flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-600 rounded-xl font-bold hover:bg-indigo-200">
                    <Download className="w-5 h-5" />ØªØ­Ù…ÙŠÙ„
                  </button> </div>
              )}

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</p>
                  <p className="font-bold text-slate-800">{selectedEvidence.period || 'â€”'}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</p>
                  <p className="font-bold text-slate-800">{selectedEvidence.validityEnd}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</p>
                  <span className={`px-2 py-1 rounded text-sm font-bold bg-${PRIORITY_CONFIG[selectedEvidence.priority]?.color || 'slate'}-100 text-${PRIORITY_CONFIG[selectedEvidence.priority]?.color || 'slate'}-700`}>
                    {PRIORITY_CONFIG[selectedEvidence.priority]?.label || selectedEvidence.priority}
                  </span> </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„ØªØµÙ†ÙŠÙ</p>
                  <span className={`px-2 py-1 rounded text-sm font-bold bg-${CONFIDENTIALITY_CONFIG[selectedEvidence.confidentiality]?.color || 'slate'}-100 text-${CONFIDENTIALITY_CONFIG[selectedEvidence.confidentiality]?.color || 'slate'}-700`}>
                    {CONFIDENTIALITY_CONFIG[selectedEvidence.confidentiality]?.label || selectedEvidence.confidentiality}
                  </span> </div> </div>
              {selectedEvidence.checksumSha256 && (
                <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                  <h4 className="font-bold text-blue-800 mb-2 flex items-center gap-2"><Shield className="w-5 h-5" />Checksum SHA-256</h4>
                  <code className="text-xs text-blue-700 break-all">{selectedEvidence.checksumSha256}</code>
                </div>
              )}

              {(selectedEvidence.linkedObligations?.length > 0 || selectedEvidence.linkedControls?.length > 0) && (
                <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                  <h4 className="font-bold text-indigo-800 mb-3 flex items-center gap-2"><Link2 className="w-5 h-5" />Ø§Ù„Ø±Ø¨Ø· (Golden Thread)</h4>
                  <div className="flex flex-wrap gap-2">
                    {selectedEvidence.linkedObligations?.map((obl, i) => (
                      <span key={i} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-bold">{obl}</span>
                    ))}
                    {selectedEvidence.linkedControls?.map((ctrl, i) => (
                      <span key={i} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">{ctrl}</span>
                    ))}
                  </div> </div>
              )}

              {selectedEvidence.tags && selectedEvidence.tags.length > 0 && (
                <div className="flex items-center gap-2">
                  <Tag className="w-4 h-4 text-slate-400" />
                  {selectedEvidence.tags.map((tag, i) => (
                    <span key={i} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">{tag}</span>
                  ))}
                </div>
              )}

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                  <p className="text-xs text-indigo-600 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Owner)</p>
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">{selectedEvidence.ownerName?.charAt(0)}</div>
                    <span className="font-bold text-slate-800">{selectedEvidence.ownerName}</span>
                  </div> </div>
                <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                  <p className="text-xs text-purple-600 mb-2">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (Reviewer)</p>
                  <div className="flex items-center gap-3">
                    {selectedEvidence.reviewerName ? (
                      <>
                        <div className="w-10 h-10 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">{selectedEvidence.reviewerName?.charAt(0)}</div>
                        <span className="font-bold text-slate-800">{selectedEvidence.reviewerName}</span>
                      </>
                    ) : <span className="text-slate-400">Ù„Ù… ÙŠÙØ¹ÙŠÙ‘Ù† Ø¨Ø¹Ø¯</span>}
                  </div> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowDetailModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-2">
                {selectedEvidence.status !== 'Accepted' && (
                  <button onClick={() => {
                    setUploadForm({
                      ...uploadForm,
                      editingEvidence: selectedEvidence, editMode: true, title: selectedEvidence.title,
                      evidenceType: selectedEvidence.evidenceType, period: selectedEvidence.period,
                      validityEnd: selectedEvidence.validityEnd, priority: selectedEvidence.priority,
                      confidentiality: selectedEvidence.confidentiality,
                      tags: selectedEvidence.tags?.join(', ') || ''
                    });
                    setShowDetailModal(false);
                    setShowUploadModal(true);
                  }} className="flex items-center gap-2 px-5 py-3 bg-amber-100 text-amber-700 rounded-xl font-bold hover:bg-amber-200">
                    <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                  </button>
                )}
                {canReview(selectedEvidence) && (
                  <button onClick={() => { setShowDetailModal(false); setRejectComment(''); setShowReviewModal(true); }} className="flex items-center gap-2 px-5 py-3 bg-purple-100 text-purple-700 rounded-xl font-bold hover:bg-purple-200">
                    <ClipboardCheck className="w-5 h-5" />Ù…Ø±Ø§Ø¬Ø¹Ø©
                  </button>
                )}
                <button className="flex items-center gap-2 px-5 py-3 bg-indigo-100 text-indigo-700 rounded-xl font-bold hover:bg-indigo-200">
                  <Download className="w-5 h-5" />ØªØ­Ù…ÙŠÙ„
                </button>
                <button onClick={() => {
                  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                    setEvidence(evidence.filter(e => e.id !== selectedEvidence.id));
                    setShowDetailModal(false);
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ—‘ï¸');
                  }
                }} className="flex items-center gap-2 px-5 py-3 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200">
                  <Trash2 className="w-5 h-5" />Ø­Ø°Ù
                </button> </div> </div> </div> </div>
      )}

      {uploadForm.quickEditEvidence && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Edit className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø³Ø±ÙŠØ¹</h2>
                    <p className="text-amber-100">{uploadForm.quickEditEvidence.code} - Quick Edit</p>
                  </div> </div>
                <button onClick={() => setUploadForm({ ...uploadForm, quickEditEvidence: null })} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
                <input type="text" defaultValue={uploadForm.quickEditEvidence.title}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
                  <select defaultValue={uploadForm.quickEditEvidence.evidenceType}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                    {Object.entries(TYPE_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                  <select defaultValue={uploadForm.quickEditEvidence.status}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                    {Object.entries(STATUS_CONFIG).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                  </select>
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</label>
                  <input type="text" defaultValue={uploadForm.quickEditEvidence.period}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                  <input type="date" defaultValue={uploadForm.quickEditEvidence.validityEnd}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                  <div className="flex gap-2">
                    {[
                      { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                      { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                      { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                      { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                    ].map(pri => (
                      <button key={pri.value} type="button"
                        className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${uploadForm.quickEditEvidence.priority === pri.value
                          ? `bg-${pri.color}-500 text-white`
                          : `bg-${pri.color}-50 text-${pri.color}-700 hover:bg-${pri.color}-100`
                          }`}>
                        {pri.label}
                      </button>
                    ))}
                  </div> </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ø±ÙŠ</label>
                  <select defaultValue={uploadForm.quickEditEvidence.confidentiality}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                    <option value="Public">Ø¹Ø§Ù…</option>
                    <option value="Internal">Ø¯Ø§Ø®Ù„ÙŠ</option>
                    <option value="Confidential">Ø³Ø±ÙŠ</option>
                    <option value="Restricted">Ù…Ù‚ÙŠØ¯</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØ³ÙˆÙ…</label>
                <input type="text" defaultValue={uploadForm.quickEditEvidence.tags?.join(', ')}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ³ÙˆÙ… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                <select defaultValue={uploadForm.quickEditEvidence.ownerId}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                  {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                </select>
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setUploadForm({ ...uploadForm, quickEditEvidence: null })}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => {
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                setUploadForm({ ...uploadForm, quickEditEvidence: null });
              }} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button> </div> </div> </div>
      )}

      {showDocModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className={`px-8 py-5 text-white ${docModalMode === 'create' ? 'bg-gradient-to-l from-purple-600 via-indigo-600 to-violet-700' : docModalMode === 'edit' ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500' : 'bg-gradient-to-l from-blue-600 via-indigo-600 to-purple-600'}`}>
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    {docModalMode === 'create' ? <FilePlus className="w-8 h-8" /> : docModalMode === 'edit' ? <Edit className="w-8 h-8" /> : <FileText className="w-8 h-8" />}
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">
                      {docModalMode === 'create' ? 'Ø¥Ø¶Ø§ÙØ© ÙˆØ«ÙŠÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©' : docModalMode === 'edit' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©' : 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©'}
                    </h2>
                    <p className="text-white/80">
                      {docModalMode === 'view' && selectedDoc ? `${selectedDoc.code} - ${selectedDoc.titleAr}` : 'Enterprise Document Management System'}
                    </p> </div> </div>
                <div className="flex items-center gap-3">
                  {docModalMode === 'view' && selectedDoc && (
                    <div className="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-xl">
                      <span className={`w-3 h-3 rounded-full ${selectedDoc.status === 'Active' ? 'bg-emerald-400' : 'bg-amber-400'}`}></span>
                      <span className="font-bold">{selectedDoc.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}</span>
                    </div>
                  )}
                  <button onClick={() => setShowDocModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              {docModalMode !== 'view' && (
                <div className="flex gap-1 bg-white/10 rounded-xl p-1">
                  {[
                    { id: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                    { id: 1, label: 'Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ù†Ø·Ø§Ù‚', icon: Layers },
                    { id: 2, label: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª ÙˆØ§Ù„Ù†Ø´Ø±', icon: CheckCircle2 },
                    { id: 3, label: 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©', icon: Paperclip },
                  ].map(tab => (
                    <button key={tab.id}
                      onClick={() => setDocForm({ ...docForm, activeTab: tab.id })}
                      className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-bold transition-all ${(docForm.activeTab || 0) === tab.id
                        ? 'bg-white text-purple-700 shadow-lg'
                        : 'text-white/80 hover:bg-white/10'
                        }`}>
                      <tab.icon className="w-4 h-4" />
                      <span className="text-sm">{tab.label}</span>
                    </button>
                  ))}
                </div>
              )}
            </div>

            <div className="flex-1 overflow-y-auto p-6">
              {docModalMode === 'view' && selectedDoc ? (
                /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VIEW MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
                <div className="grid grid-cols-3 gap-6">
                  <div className="col-span-2 space-y-5">
                    <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h3 className="text-2xl font-black text-slate-800">{selectedDoc.titleAr}</h3>
                          <p className="text-slate-500 text-lg">{selectedDoc.titleEn}</p>
                        </div>
                        <span className="font-mono text-sm bg-indigo-500 text-white px-3 py-1 rounded-lg">{selectedDoc.code}</span>
                      </div>
                      {selectedDoc.description && (
                        <p className="text-slate-600 bg-white/50 rounded-xl p-3">{selectedDoc.description}</p>
                      )}
                    </div>

                    <div className="grid grid-cols-4 gap-3">
                      {[
                        { label: 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©', value: DOC_TYPE_CONFIG[selectedDoc.docType]?.label, icon: FileText, color: 'blue' },
                        { label: 'Ø§Ù„ØªØµÙ†ÙŠÙ', value: selectedDoc.classification === 'Confidential' ? 'Ø³Ø±ÙŠ' : selectedDoc.classification === 'Internal' ? 'Ø¯Ø§Ø®Ù„ÙŠ' : 'Ø¹Ø§Ù…', icon: Lock, color: selectedDoc.classification === 'Confidential' ? 'red' : 'emerald' },
                        { label: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø±', value: selectedDoc.version, icon: GitBranch, color: 'purple' },
                        { label: 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«', value: selectedDoc.lastUpdated, icon: Calendar, color: 'amber' },
                      ].map((item, idx) => (
                        <div key={idx} className={`bg-${item.color}-50 rounded-xl p-4 border border-${item.color}-200`}>
                          <div className="flex items-center gap-2 mb-2">
                            <item.icon className={`w-4 h-4 text-${item.color}-600`} />
                            <p className={`text-xs text-${item.color}-600`}>{item.label}</p>
                          </div>
                          <p className="font-bold text-slate-800">{item.value}</p>
                        </div>
                      ))}
                    </div>

                    <div className="bg-slate-50 rounded-2xl p-5 border border-slate-200">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <History className="w-5 h-5 text-indigo-600" />
                        Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
                      </h4>
                      <div className="space-y-2">
                        {[
                          { version: selectedDoc.version, date: selectedDoc.lastUpdated, user: selectedDoc.ownerName, status: 'current' },
                          { version: 'v1.2', date: '2024-12-15', user: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', status: 'old' },
                          { version: 'v1.0', date: '2024-06-01', user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', status: 'old' },
                        ].map((ver, idx) => (
                          <div key={idx} className={`flex items-center justify-between p-3 rounded-xl ${ver.status === 'current' ? 'bg-emerald-100 border border-emerald-200' : 'bg-white border border-slate-200'}`}>
                            <div className="flex items-center gap-3">
                              <span className={`px-2 py-1 rounded font-mono text-sm font-bold ${ver.status === 'current' ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                                {ver.version}
                              </span>
                              <span className="text-sm text-slate-600">{ver.date}</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <span className="text-sm text-slate-500">{ver.user}</span>
                              {ver.status === 'current' && <span className="px-2 py-0.5 bg-emerald-500 text-white text-xs rounded font-bold">Ø§Ù„Ø­Ø§Ù„ÙŠ</span>}
                            </div> </div>
                        ))}
                      </div> </div> </div>
                  <div className="space-y-5">
                    <div className="bg-purple-50 rounded-2xl p-5 border-2 border-purple-200">
                      <h4 className="font-bold text-purple-800 mb-3 flex items-center gap-2">
                        <User className="w-5 h-5" />Ø§Ù„Ù…Ø§Ù„Ùƒ
                      </h4>
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-xl bg-purple-500 text-white flex items-center justify-center font-bold text-lg">
                          {selectedDoc.ownerName?.charAt(0)}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{selectedDoc.ownerName}</p>
                          <p className="text-sm text-slate-500">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                        </div> </div> </div>
                    <div className="bg-indigo-50 rounded-2xl p-5 border-2 border-indigo-200">
                      <h4 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                        <BarChart3 className="w-5 h-5" />Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                      </h4>
                      <div className="grid grid-cols-2 gap-3">
                        <div className="text-center p-3 bg-white rounded-xl">
                          <p className="text-2xl font-black text-indigo-600">{selectedDoc.downloads}</p>
                          <p className="text-xs text-slate-500">ØªØ­Ù…ÙŠÙ„</p>
                        </div>
                        <div className="text-center p-3 bg-white rounded-xl">
                          <p className="text-2xl font-black text-emerald-600">{selectedDoc.linkedEvidence}</p>
                          <p className="text-xs text-slate-500">Ø£Ø¯Ù„Ø© Ù…Ø±ØªØ¨Ø·Ø©</p>
                        </div> </div> </div>
                    <div className="bg-slate-50 rounded-2xl p-5 border border-slate-200">
                      <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <Link2 className="w-5 h-5 text-slate-600" />ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø±ØªØ¨Ø·Ø©
                      </h4>
                      <div className="space-y-2">
                        {['Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©', 'Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨'].map((doc, idx) => (
                          <div key={idx} className="flex items-center gap-2 p-2 bg-white rounded-lg hover:bg-indigo-50 cursor-pointer">
                            <FileText className="w-4 h-4 text-indigo-500" />
                            <span className="text-sm text-slate-700">{doc}</span>
                          </div>
                        ))}
                      </div> </div>
                    <div className="space-y-2">
                      <button className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                        <Download className="w-5 h-5" />ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                      </button>
                      <button className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-100 text-purple-700 rounded-xl font-bold hover:bg-purple-200">
                        <Eye className="w-5 h-5" />Ù…Ø¹Ø§ÙŠÙ†Ø©
                      </button> </div> </div> </div>
              ) : (
                /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CREATE/EDIT MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
                <>
                  {(docForm.activeTab || 0) === 0 && (
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-5">
                        <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                          <label className="flex items-center gap-2 font-bold text-indigo-800 mb-4">
                            <span className="w-8 h-8 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-sm">1</span>
                            Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *
                          </label>
                          <input type="text" value={docForm.titleAr} onChange={(e) => setDocForm({ ...docForm, titleAr: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl focus:border-indigo-500 focus:outline-none text-lg font-bold"
                            placeholder="Ù…Ø«Ø§Ù„: Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„" />
                        </div>

                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                            <span className="w-8 h-8 rounded-xl bg-purple-500 text-white flex items-center justify-center text-sm">2</span>
                            Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© *
                          </label>
                          <input type="text" value={docForm.titleEn} onChange={(e) => setDocForm({ ...docForm, titleEn: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                            placeholder="Example: Anti-Money Laundering Policy" />
                        </div>

                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <label className="flex items-center gap-2 font-bold text-slate-800 mb-4">
                            <span className="w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-sm">3</span>
                            Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                          </label>
                          <div className="grid grid-cols-3 gap-2">
                            {[
                              { value: 'Policy', label: 'Ø³ÙŠØ§Ø³Ø©', icon: 'ğŸ“œ' },
                              { value: 'Procedure', label: 'Ø¥Ø¬Ø±Ø§Ø¡', icon: 'ğŸ“‹' },
                              { value: 'Guide', label: 'Ø¯Ù„ÙŠÙ„', icon: 'ğŸ“–' },
                              { value: 'Standard', label: 'Ù…Ø¹ÙŠØ§Ø±', icon: 'ğŸ“' },
                              { value: 'Framework', label: 'Ø¥Ø·Ø§Ø±', icon: 'ğŸ—ï¸' },
                              { value: 'Manual', label: 'Ø¯Ù„ÙŠÙ„ Ø¹Ù…Ù„', icon: 'ğŸ“š' },
                            ].map(type => (
                              <button key={type.value} type="button"
                                onClick={() => setDocForm({ ...docForm, docType: type.value })}
                                className={`p-3 rounded-xl border-2 transition-all ${docForm.docType === type.value
                                  ? 'border-emerald-500 bg-emerald-50'
                                  : 'border-slate-200 bg-white hover:border-slate-300'
                                  }`}>
                                <span className="text-xl">{type.icon}</span>
                                <p className={`text-sm font-bold mt-1 ${docForm.docType === type.value ? 'text-emerald-700' : 'text-slate-700'}`}>
                                  {type.label}
                                </p> </button>
                            ))}
                          </div> </div> </div>
                      <div className="space-y-5">
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-blue-50 rounded-2xl p-5 border-2 border-blue-200">
                            <label className="flex items-center gap-2 font-bold text-blue-800 mb-3">
                              <Lock className="w-5 h-5" />Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ø±ÙŠ
                            </label>
                            <div className="space-y-2">
                              {[
                                { value: 'Public', label: 'Ø¹Ø§Ù…', color: 'emerald', desc: 'Ù…ØªØ§Ø­ Ù„Ù„Ø¬Ù…ÙŠØ¹' },
                                { value: 'Internal', label: 'Ø¯Ø§Ø®Ù„ÙŠ', color: 'blue', desc: 'Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙ‚Ø·' },
                                { value: 'Confidential', label: 'Ø³Ø±ÙŠ', color: 'amber', desc: 'Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙˆØµÙˆÙ„' },
                                { value: 'Restricted', label: 'Ù…Ù‚ÙŠØ¯', color: 'red', desc: 'Ø­Ø³Ø§Ø³ Ø¬Ø¯Ø§Ù‹' },
                              ].map(cls => (
                                <button key={cls.value} type="button"
                                  onClick={() => setDocForm({ ...docForm, classification: cls.value })}
                                  className={`w-full flex items-center justify-between p-3 rounded-xl border-2 transition-all ${docForm.classification === cls.value
                                    ? `border-${cls.color}-500 bg-${cls.color}-100`
                                    : 'border-slate-200 bg-white hover:border-slate-300'
                                    }`}>
                                  <div className="flex items-center gap-2">
                                    <span className={`w-3 h-3 rounded-full bg-${cls.color}-500`}></span>
                                    <span className="font-bold text-slate-700">{cls.label}</span>
                                  </div>
                                  <span className="text-xs text-slate-500">{cls.desc}</span>
                                </button>
                              ))}
                            </div> </div>
                          <div className="space-y-4">
                            <div className="bg-purple-50 rounded-2xl p-5 border-2 border-purple-200">
                              <label className="flex items-center gap-2 font-bold text-purple-800 mb-3">
                                <GitBranch className="w-5 h-5" />Ø§Ù„Ø¥ØµØ¯Ø§Ø±
                              </label>
                              <input type="text" value={docForm.version} onChange={(e) => setDocForm({ ...docForm, version: e.target.value })}
                                className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:border-purple-500 focus:outline-none font-mono font-bold text-center"
                                placeholder="v1.0" />
                            </div>

                            <div className="bg-amber-50 rounded-2xl p-5 border-2 border-amber-200">
                              <label className="flex items-center gap-2 font-bold text-amber-800 mb-3">
                                <User className="w-5 h-5" />Ø§Ù„Ù…Ø§Ù„Ùƒ
                              </label>
                              <select value={docForm.ownerId} onChange={(e) => setDocForm({ ...docForm, ownerId: parseInt(e.target.value) })}
                                className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none font-bold">
                                {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                              </select>
                            </div> </div> </div>
                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <label className="flex items-center gap-2 font-bold text-slate-800 mb-3">
                            <FileText className="w-5 h-5" />Ø§Ù„ÙˆØµÙ
                          </label>
                          <textarea value={docForm.description} onChange={(e) => setDocForm({ ...docForm, description: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none resize-none"
                            rows={4} placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„ÙˆØ«ÙŠÙ‚Ø© ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡Ø§ ÙˆÙ†Ø·Ø§Ù‚ ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§..." />
                        </div> </div> </div>
                  )}

                  {(docForm.activeTab || 0) === 1 && (
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-5">
                        <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                          <h4 className="font-bold text-blue-800 mb-4 flex items-center gap-2">
                            <Building2 className="w-5 h-5" />Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                          </h4>
                          <div className="grid grid-cols-2 gap-3">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                              <select className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option>
                                <option value="SAMA">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</option>
                                <option value="CMA">CMA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                                <option value="NCA">NCA - Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                                <option value="SDAIA">SDAIA - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                              <select className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ØªØ·Ù„Ø¨...</option>
                                <option value="AML">Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</option>
                                <option value="KYC">Ø§Ø¹Ø±Ù Ø¹Ù…ÙŠÙ„Ùƒ</option>
                                <option value="Cyber">Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                              </select>
                            </div> </div> </div>
                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Tag className="w-5 h-5" />Ø§Ù„ÙˆØ³ÙˆÙ… ÙˆØ§Ù„ØªØµÙ†ÙŠÙØ§Øª
                          </h4>
                          <input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ³ÙˆÙ… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©..."
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none mb-3" />
                          <div className="flex flex-wrap gap-2">
                            {['AML', 'Ø³ÙŠØ§Ø³Ø©', 'SAMA', 'Ø§Ù…ØªØ«Ø§Ù„'].map(tag => (
                              <span key={tag} className="px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-bold flex items-center gap-1">
                                {tag}
                                <X className="w-3 h-3 cursor-pointer hover:text-indigo-900" />
                              </span>
                            ))}
                          </div> </div>
                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Building className="w-5 h-5" />Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ©
                          </h4>
                          <div className="grid grid-cols-2 gap-2">
                            {['Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©'].map(dept => (
                              <label key={dept} className="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <input type="checkbox" className="w-4 h-4 rounded text-indigo-500" />
                                <span className="text-sm font-bold text-slate-700">{dept}</span>
                              </label>
                            ))}
                          </div> </div> </div>
                      <div className="space-y-5">
                        <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                          <h4 className="font-bold text-amber-800 mb-4 flex items-center gap-2">
                            <Calendar className="w-5 h-5" />ÙØªØ±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                          </h4>
                          <div className="grid grid-cols-2 gap-3">
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</label>
                              <input type="date" className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                            </div>
                            <div>
                              <label className="block text-xs font-bold text-slate-600 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                              <input type="date" className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                            </div> </div>
                          <div className="mt-3">
                            <label className="block text-xs font-bold text-slate-600 mb-2">Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</label>
                            <select className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none">
                              <option value="annual">Ø³Ù†ÙˆÙŠ</option>
                              <option value="biannual">Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option>
                              <option value="quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                              <option value="asneeded">Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©</option>
                            </select>
                          </div> </div>
                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Link2 className="w-5 h-5" />ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø±ØªØ¨Ø·Ø©
                          </h4>
                          <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none mb-3">
                            <option value="">Ø§Ø®ØªØ± ÙˆØ«ÙŠÙ‚Ø© Ù„Ù„Ø±Ø¨Ø·...</option>
                            {documents.map(d => <option key={d.id} value={d.id}>{d.titleAr}</option>)}
                          </select>
                          <div className="space-y-2">
                            <div className="flex items-center justify-between p-2 bg-indigo-50 rounded-lg">
                              <span className="text-sm font-bold text-slate-700">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©</span>
                              <button className="text-red-500 hover:text-red-700"><X className="w-4 h-4" /></button>
                            </div> </div> </div>
                        <div className="bg-red-50 rounded-2xl p-5 border-2 border-red-200">
                          <h4 className="font-bold text-red-800 mb-4 flex items-center gap-2">
                            <Lock className="w-5 h-5" />ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„
                          </h4>
                          <div className="space-y-2">
                            {[
                              { label: 'Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·', desc: 'ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·' },
                              { label: 'Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØ­Ù…ÙŠÙ„', desc: 'ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„' },
                              { label: 'ÙƒØ§Ù…Ù„', desc: 'ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù' },
                            ].map((perm, idx) => (
                              <label key={idx} className="flex items-center justify-between p-3 bg-white rounded-xl cursor-pointer hover:bg-red-100">
                                <div>
                                  <p className="font-bold text-slate-700">{perm.label}</p>
                                  <p className="text-xs text-slate-500">{perm.desc}</p>
                                </div>
                                <input type="radio" name="access" className="w-4 h-4 text-red-500" />
                              </label>
                            ))}
                          </div> </div> </div> </div>
                  )}

                  {(docForm.activeTab || 0) === 2 && (
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-5">
                        <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                          <h4 className="font-bold text-emerald-800 mb-4 flex items-center gap-2">
                            <CheckCircle2 className="w-5 h-5" />Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
                          </h4>
                          <div className="space-y-3">
                            {[
                              { step: 1, role: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', user: '' },
                              { step: 2, role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', user: '' },
                              { step: 3, role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', user: '' },
                            ].map(approver => (
                              <div key={approver.step} className="bg-white rounded-xl p-4 border border-emerald-200">
                                <div className="flex items-center gap-4">
                                  <div className="w-10 h-10 rounded-xl bg-emerald-500 text-white flex items-center justify-center font-bold">
                                    {approver.step}
                                  </div>
                                  <div className="flex-1">
                                    <p className="font-bold text-slate-700 mb-1">{approver.role}</p>
                                    <select className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm">
                                      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù...</option>
                                      {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                                    </select>
                                  </div> </div> </div>
                            ))}
                          </div>
                          <button className="mt-3 w-full px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-200">
                            + Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§ÙÙ‚
                          </button> </div> </div>
                      <div className="space-y-5">
                        <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Bell className="w-5 h-5" />Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                          </h4>
                          <div className="space-y-3">
                            {[
                              { label: 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', checked: true },
                              { label: 'Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', checked: true },
                              { label: 'ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©', checked: false },
                              { label: 'Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«', checked: true },
                            ].map((opt, idx) => (
                              <label key={idx} className="flex items-center justify-between p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100">
                                <span className="text-sm font-bold text-slate-700">{opt.label}</span>
                                <input type="checkbox" defaultChecked={opt.checked} className="w-5 h-5 rounded text-indigo-500" />
                              </label>
                            ))}
                          </div> </div>
                        <div className="bg-blue-50 rounded-2xl p-5 border-2 border-blue-200">
                          <h4 className="font-bold text-blue-800 mb-4 flex items-center gap-2">
                            <Globe className="w-5 h-5" />Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø±
                          </h4>
                          <div className="space-y-3">
                            <label className="flex items-center justify-between p-3 bg-white rounded-xl cursor-pointer">
                              <div>
                                <p className="font-bold text-slate-700">Ù†Ø´Ø± ÙÙˆØ±ÙŠ</p>
                                <p className="text-xs text-slate-500">ØªÙ†Ø´Ø± Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙÙˆØ± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                              </div>
                              <input type="radio" name="publish" className="w-4 h-4 text-blue-500" defaultChecked />
                            </label>
                            <label className="flex items-center justify-between p-3 bg-white rounded-xl cursor-pointer">
                              <div>
                                <p className="font-bold text-slate-700">Ù†Ø´Ø± Ù…Ø¬Ø¯ÙˆÙ„</p>
                                <p className="text-xs text-slate-500">ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</p>
                              </div>
                              <input type="radio" name="publish" className="w-4 h-4 text-blue-500" />
                            </label>
                            <label className="flex items-center justify-between p-3 bg-white rounded-xl cursor-pointer">
                              <div>
                                <p className="font-bold text-slate-700">Ù…Ø³ÙˆØ¯Ø©</p>
                                <p className="text-xs text-slate-500">Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                              </div>
                              <input type="radio" name="publish" className="w-4 h-4 text-blue-500" />
                            </label>
                          </div> </div> </div> </div>
                  )}

                  {(docForm.activeTab || 0) === 3 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-6 border-2 border-indigo-200">
                        <h4 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                          <FileText className="w-5 h-5" />Ù…Ù„Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ *
                        </h4>
                        <div className={`border-3 border-dashed rounded-2xl p-8 text-center transition-all cursor-pointer ${dragOver ? 'border-indigo-500 bg-indigo-100' : 'border-indigo-300 hover:border-indigo-400 hover:bg-indigo-50'
                          }`}>
                          <div className="w-16 h-16 rounded-2xl bg-indigo-100 flex items-center justify-center mx-auto mb-4">
                            <Upload className="w-8 h-8 text-indigo-600" />
                          </div>
                          <p className="text-slate-800 font-bold text-lg mb-2">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                          <p className="text-sm text-slate-500 mb-4">PDF, DOCX, DOC (Ø­ØªÙ‰ 50 MB)</p>
                          <button className="px-6 py-3 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                            <FolderPlus className="w-5 h-5 inline ml-2" />Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù
                          </button> </div> </div>
                      <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                        <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <Paperclip className="w-5 h-5" />Ù…Ø±ÙÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                        </h4>
                        <div className="grid grid-cols-3 gap-4 mb-4">
                          {[
                            { name: 'attachment_1.pdf', size: '1.2 MB', type: 'PDF' },
                            { name: 'appendix.xlsx', size: '456 KB', type: 'XLSX' },
                          ].map((file, idx) => (
                            <div key={idx} className="flex items-center gap-3 p-4 bg-slate-50 rounded-xl border border-slate-200">
                              <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${file.type === 'PDF' ? 'bg-red-100 text-red-600' : 'bg-emerald-100 text-emerald-600'
                                }`}>
                                <FileText className="w-5 h-5" />
                              </div>
                              <div className="flex-1 min-w-0">
                                <p className="font-bold text-slate-800 text-sm truncate">{file.name}</p>
                                <p className="text-xs text-slate-500">{file.size}</p>
                              </div>
                              <button className="text-red-500 hover:text-red-700">
                                <Trash2 className="w-4 h-4" />
                              </button> </div>
                          ))}
                          <button className="flex flex-col items-center justify-center p-4 border-2 border-dashed border-slate-300 rounded-xl hover:border-indigo-400 hover:bg-indigo-50">
                            <Plus className="w-6 h-6 text-slate-400 mb-1" />
                            <span className="text-sm text-slate-500">Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚</span>
                          </button> </div> </div>
                      <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                        <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <Eye className="w-5 h-5" />Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                        </h4>
                        <div className="bg-white rounded-xl border border-slate-200 h-64 flex items-center justify-center">
                          <div className="text-center">
                            <FileSearch className="w-12 h-12 text-slate-300 mx-auto mb-2" />
                            <p className="text-slate-500">Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹ Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡</p>
                          </div> </div> </div> </div>
                  )}
                </>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-8 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between">
              <button onClick={() => setShowDocModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                {docModalMode === 'view' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Ø¥Ù„ØºØ§Ø¡'}
              </button>

              {docModalMode !== 'view' && (
                <div className="flex items-center gap-2">
                  <div className="flex gap-1 px-2">
                    {[0, 1, 2, 3].map(idx => (
                      <button key={idx}
                        onClick={() => setDocForm({ ...docForm, activeTab: idx })}
                        className={`w-8 h-8 rounded-lg font-bold text-sm ${(docForm.activeTab || 0) === idx ? 'bg-indigo-500 text-white' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'
                          }`}>
                        {idx + 1}
                      </button>
                    ))}
                  </div> </div>
              )}

              <div className="flex items-center gap-2">
                {docModalMode === 'view' && selectedDoc && (
                  <>
                    <button onClick={() => { setShowDocModal(false); openEditDocModal(selectedDoc); }} className="flex items-center gap-2 px-5 py-3 bg-amber-100 text-amber-700 rounded-xl font-bold hover:bg-amber-200">
                      <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button className="flex items-center gap-2 px-5 py-3 bg-indigo-100 text-indigo-700 rounded-xl font-bold hover:bg-indigo-200">
                      <Download className="w-5 h-5" />ØªØ­Ù…ÙŠÙ„
                    </button>
                    <button onClick={() => {
                      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©ØŸ')) {
                        setDocuments(documents.filter(d => d.id !== selectedDoc.id));
                        setShowDocModal(false);
                        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ—‘ï¸');
                      }
                    }} className="flex items-center gap-2 px-5 py-3 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200">
                      <Trash2 className="w-5 h-5" />Ø­Ø°Ù
                    </button>
                  </>
                )}
                {docModalMode !== 'view' && (
                  <button onClick={handleSaveDoc} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-purple-500 via-indigo-500 to-violet-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                    <Save className="w-5 h-5" />{docModalMode === 'create' ? 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                  </button>
                )}
              </div> </div> </div> </div>
      )}

      {showDocDeleteConfirm && selectedDoc && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-4 text-white">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Trash2 className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-lg font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
                  <p className="text-red-100 text-sm">{selectedDoc.code}</p>
                </div> </div> </div>
            <div className="p-6">
              <p className="text-slate-700 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ</p>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <p className="font-bold text-slate-800">{selectedDoc.titleAr}</p>
                <p className="text-sm text-slate-500">{selectedDoc.titleEn}</p>
              </div>
              <p className="text-xs text-red-600 mt-3">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowDocDeleteConfirm(false); setSelectedDoc(null); }} className="px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDeleteDoc} className="flex items-center gap-2 px-5 py-2.5 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                <Trash2 className="w-4 h-4" />ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
              </button> </div> </div> </div>
      )}

      {showPackModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-600 via-purple-600 to-violet-700 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Package className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚</h2>
                    <p className="text-indigo-200">Audit Pack Generator</p>
                  </div> </div>
                <button onClick={() => setShowPackModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø© *</label>
                <input type="text" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ù…Ø«Ø§Ù„: Ø­Ø²Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ SAMA Q1-2025" />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                  <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option>SAMA</option>
                    <option>NCA</option>
                    <option>PDPL</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙØªØ±Ø©</label>
                  <input type="text" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Q1-2025" />
                </div> </div>
              <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                <h4 className="font-bold text-indigo-800 mb-3">Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø­Ø²Ù…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</h4>
                <div className="grid grid-cols-3 gap-3">
                  <div className="bg-white rounded-lg p-3 text-center">
                    <p className="text-2xl font-bold text-emerald-600">{stats.accepted}</p>
                    <p className="text-xs text-slate-500">Ø£Ø¯Ù„Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©</p>
                  </div>
                  <div className="bg-white rounded-lg p-3 text-center">
                    <p className="text-2xl font-bold text-purple-600">{documents.filter(d => d.status === 'Active').length}</p>
                    <p className="text-xs text-slate-500">ÙˆØ«Ø§Ø¦Ù‚ Ù†Ø´Ø·Ø©</p>
                  </div>
                  <div className="bg-white rounded-lg p-3 text-center">
                    <p className="text-2xl font-bold text-slate-600">~25 MB</p>
                    <p className="text-xs text-slate-500">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                  </div> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowPackModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => { alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!'); setShowPackModal(false); }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg">
                <Zap className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø©
              </button> </div> </div> </div>
      )}

      {showAdvancedSearch && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-cyan-600 to-blue-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><Search className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
                    <p className="text-cyan-200 text-sm">Full-text Search & Advanced Filters</p>
                  </div> </div>
                <button onClick={() => setShowAdvancedSearch(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="bg-slate-50 rounded-2xl p-5 border border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><FileSearch className="w-5 h-5 text-cyan-600" />Ø¨Ø­Ø« Ù†ØµÙŠ ÙƒØ§Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                <div className="relative">
                  <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                  <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„ÙØ§Øª..." value={advancedFilters.fullText} onChange={(e) => setAdvancedFilters({ ...advancedFilters, fullText: e.target.value })} className="w-full pr-12 pl-4 py-4 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none text-lg" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                  <input type="date" value={advancedFilters.dateFrom} onChange={(e) => setAdvancedFilters({ ...advancedFilters, dateFrom: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                  <input type="date" value={advancedFilters.dateTo} onChange={(e) => setAdvancedFilters({ ...advancedFilters, dateTo: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
                  <select value={advancedFilters.owner} onChange={(e) => setAdvancedFilters({ ...advancedFilters, owner: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠÙ†</option>
                    {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ù…Ù†ÙŠ</label>
                  <select value={advancedFilters.confidentiality} onChange={(e) => setAdvancedFilters({ ...advancedFilters, confidentiality: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                    {Object.entries(CONFIDENTIALITY_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
                  </select>
                </div> </div>
              <div className="bg-purple-50 rounded-2xl p-5 border border-purple-200">
                <h3 className="font-bold text-purple-800 mb-4 flex items-center gap-2"><BookOpen className="w-5 h-5" />Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div className="grid grid-cols-3 gap-3">
                  {savedSearches.map(search => (
                    <button key={search.id} onClick={() => { applySavedSearch(search); setShowAdvancedSearch(false); }} className="p-3 bg-white rounded-xl border border-purple-200 hover:border-purple-400 text-right">
                      <p className="font-bold text-slate-800">{search.name}</p>
                      <p className="text-xs text-slate-500">{search.createdAt}</p>
                    </button>
                  ))}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø­Ø«:'); if (name) handleSaveSearch(name); }} className="px-4 py-2.5 border-2 border-purple-300 text-purple-700 rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„Ø¨Ø­Ø«</button>
              <div className="flex items-center gap-3">
                <button onClick={() => setAdvancedFilters({ dateFrom: '', dateTo: '', owner: '', confidentiality: '', tags: [], fullText: '' })} className="px-4 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
                <button onClick={() => { handleAdvancedSearch(); setShowAdvancedSearch(false); }} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-bold"><Search className="w-5 h-5" />Ø¨Ø­Ø«</button>
              </div> </div> </div> </div>
      )}

      {showFolderModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-purple-600 to-violet-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><FolderOpen className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª</h2>
                    <p className="text-purple-200 text-sm">Folder Structure & Permissions</p>
                  </div> </div>
                <button onClick={() => setShowFolderModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              <div className="grid grid-cols-3 gap-6">
                <div className="col-span-1 bg-slate-50 rounded-2xl p-4 border border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª</h3>
                  <div className="space-y-2">
                    {folders.filter(f => f.parentId === 1 || f.parentId === null).map(folder => (
                      <div key={folder.id}>
                        <button onClick={() => setCurrentFolder(folder)} className={`w-full flex items-center gap-2 p-3 rounded-xl ${currentFolder?.id === folder.id ? 'bg-purple-100 text-purple-700 border-2 border-purple-400' : 'hover:bg-slate-100'}`}>
                          <FolderOpen className="w-5 h-5" />
                          <span className="font-bold">{folder.name}</span>
                          {folder.children?.length > 0 && <span className="text-xs bg-slate-200 px-2 py-0.5 rounded-full mr-auto">{folder.children.length}</span>}
                        </button>
                        {folder.children?.map(childId => {
                          const child = folders.find(f => f.id === childId);
                          if (!child) return null;
                          return (
                            <button key={child.id} onClick={() => setCurrentFolder(child)} className={`w-full flex items-center gap-2 p-2 pr-8 rounded-lg ${currentFolder?.id === child.id ? 'bg-purple-50 text-purple-600' : 'hover:bg-slate-50'}`}>
                              <FolderOpen className="w-4 h-4" />
                              <span className="text-sm">{child.name}</span>
                            </button>);
                        })}
                      </div>
                    ))}
                  </div>
                  <button className="w-full mt-4 flex items-center justify-center gap-2 p-3 border-2 border-dashed border-purple-300 rounded-xl text-purple-600 hover:bg-purple-50">
                    <Plus className="w-5 h-5" />Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯
                  </button> </div>
                <div className="col-span-2 space-y-4">
                  {currentFolder ? (
                    <>
                      <div className="bg-purple-50 rounded-2xl p-5 border border-purple-200">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="font-bold text-purple-800 flex items-center gap-2"><FolderOpen className="w-5 h-5" />{currentFolder.name}</h3>
                          <span className="text-sm text-purple-600">{currentFolder.retentionDays ? `${currentFolder.retentionDays} ÙŠÙˆÙ… Ø§Ø­ØªÙØ§Ø¸` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ§Ø³Ø© Ø§Ø­ØªÙØ§Ø¸'}</span>
                        </div>
                        <div className="flex items-center gap-2 flex-wrap">
                          {currentFolder.permissions?.map((perm, idx) => (
                            <span key={idx} className="px-3 py-1 bg-white text-purple-700 rounded-full text-sm font-bold border border-purple-200">{perm === 'view' ? 'Ø¹Ø±Ø¶' : perm === 'upload' ? 'Ø±ÙØ¹' : perm === 'edit' ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø­Ø°Ù'}</span>
                          ))}
                        </div> </div>
                      <div className="bg-white rounded-2xl p-5 border border-slate-200">
                        <h4 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯</h4>
                        <div className="grid grid-cols-2 gap-3">
                          {evidence.slice(0, 4).map(evd => (
                            <div key={evd.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-200">
                              <FileText className="w-8 h-8 text-indigo-500" />
                              <div className="flex-1 min-w-0">
                                <p className="font-bold text-sm text-slate-800 truncate">{evd.title}</p>
                                <p className="text-xs text-slate-500">{evd.fileSize}</p>
                              </div> </div>
                          ))}
                        </div> </div>
                    </>
                  ) : (
                    <div className="bg-slate-50 rounded-2xl p-8 text-center">
                      <FolderOpen className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                      <p className="text-slate-500">Ø§Ø®ØªØ± Ù…Ø¬Ù„Ø¯Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡</p>
                    </div>
                  )}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowFolderModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button onClick={() => setShowPermissionsModal(true)} className="flex items-center gap-2 px-6 py-2.5 bg-purple-500 text-white rounded-xl font-bold"><Lock className="w-5 h-5" />Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
            </div> </div> </div>
      )}

      {showRetentionSettings && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-amber-600 to-orange-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><Archive className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h2>
                    <p className="text-amber-200 text-sm">Document Retention & Legal Hold</p>
                  </div> </div>
                <button onClick={() => setShowRetentionSettings(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="bg-amber-50 rounded-2xl p-5 border border-amber-200">
                <h3 className="font-bold text-amber-800 mb-4 flex items-center gap-2"><Clock className="w-5 h-5" />ÙØªØ±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h3>
                <div className="space-y-3">
                  {retentionPolicies.map(policy => (
                    <div key={policy.id} className="flex items-center justify-between p-4 bg-white rounded-xl border border-amber-200">
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${TYPE_CONFIG[policy.docType]?.color ? `bg-${TYPE_CONFIG[policy.docType].color}-100` : 'bg-slate-100'}`}>
                          <FileText className="w-5 h-5 text-amber-600" />
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{TYPE_CONFIG[policy.docType]?.label || policy.docType}</p>
                          <p className="text-sm text-slate-500">{Math.round(policy.retentionDays / 365)} Ø³Ù†ÙˆØ§Øª ({policy.retentionDays} ÙŠÙˆÙ…)</p>
                        </div> </div>
                      <div className="flex items-center gap-3">
                        {policy.autoArchive && <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-bold">Ø£Ø±Ø´ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span>}
                        {policy.legalHold && <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-bold">Ø­Ø¬Ø² Ù‚Ø§Ù†ÙˆÙ†ÙŠ</span>}
                        <button className="p-2 text-slate-400 hover:text-slate-600"><Edit className="w-4 h-4" /></button>
                      </div> </div>
                  ))}
                </div> </div>
              <div className="bg-red-50 rounded-2xl p-5 border border-red-200">
                <h3 className="font-bold text-red-800 mb-4 flex items-center gap-2"><Lock className="w-5 h-5" />Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                {legalHolds.filter(h => h.status === 'Active').length > 0 ? (
                  <div className="space-y-3">
                    {legalHolds.filter(h => h.status === 'Active').map(hold => (
                      <div key={hold.id} className="flex items-center justify-between p-4 bg-white rounded-xl border border-red-200">
                        <div>
                          <p className="font-bold text-slate-800">{hold.name}</p>
                          <p className="text-sm text-slate-500">Ø¨Ø¯Ø£: {hold.startDate} | {hold.affectedFiles.length} Ù…Ù„ÙØ§Øª</p>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="px-3 py-1 bg-red-500 text-white rounded-full text-sm font-bold">Ù†Ø´Ø·</span>
                          <button className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm font-bold">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²</button>
                        </div> </div>
                    ))}
                  </div>
                ) : (
                  <p className="text-red-600 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù†Ø´Ø·Ø©</p>
                )}
                <button onClick={() => { const name = prompt('Ø§Ø³Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ:'); if (name) applyLegalHold(selectedItems, name); }} className="w-full mt-4 flex items-center justify-center gap-2 p-3 border-2 border-dashed border-red-300 rounded-xl text-red-600 hover:bg-red-50">
                  <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø­Ø¬Ø² Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø¬Ø¯ÙŠØ¯
                </button> </div>
              <div className="bg-blue-50 rounded-2xl p-5 border border-blue-200">
                <h3 className="font-bold text-blue-800 mb-4 flex items-center gap-2"><Download className="w-5 h-5" />Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                <div className="space-y-2">
                  {downloadLog.slice(0, 5).map(log => {
                    const evd = evidence.find(e => e.id === log.fileId);
                    return (
                      <div key={log.id} className="flex items-center justify-between p-3 bg-white rounded-xl border border-blue-200">
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center"><User className="w-4 h-4 text-blue-600" /></div>
                          <div>
                            <p className="font-bold text-sm text-slate-800">{log.userName}</p>
                            <p className="text-xs text-slate-500">Ø­Ù…Ù‘Ù„: {evd?.code || 'Ù…Ù„Ù Ù…Ø­Ø°ÙˆÙ'}</p>
                          </div> </div>
                        <div className="text-left">
                          <p className="text-sm text-slate-600">{log.downloadedAt}</p>
                          <p className="text-xs text-slate-400">{log.ipAddress}</p>
                        </div> </div>);
                  })}
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowRetentionSettings(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button className="flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white rounded-xl font-bold"><Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div> </div> </div>
      )}

      {showVersionHistory && selectedEvidence && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[85vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-emerald-600 to-teal-600 px-8 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center"><History className="w-7 h-7" /></div>
                  <div>
                    <h2 className="text-2xl font-black">Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª</h2>
                    <p className="text-emerald-200 text-sm">{selectedEvidence.code} - Version History</p>
                  </div> </div>
                <button onClick={() => setShowVersionHistory(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              <div className="space-y-4">
                {(fileVersions[selectedEvidence.id] || [{ version: 'v1.0', date: selectedEvidence.validityStart, userName: selectedEvidence.ownerName, size: selectedEvidence.fileSize, comment: 'Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©' }]).map((ver, idx) => (
                  <div key={idx} className={`flex items-center gap-4 p-4 rounded-xl border-2 ${idx === 0 ? 'bg-emerald-50 border-emerald-300' : 'bg-white border-slate-200'}`}>
                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center font-bold ${idx === 0 ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'}`}>{ver.version}</div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-bold text-slate-800">{ver.userName}</span>
                        {idx === 0 && <span className="px-2 py-0.5 bg-emerald-500 text-white text-xs rounded-full font-bold">Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>}
                      </div>
                      <p className="text-sm text-slate-500">{ver.comment}</p>
                      <p className="text-xs text-slate-400 mt-1">{ver.date} | {ver.size}</p>
                    </div>
                    <div className="flex items-center gap-2">
                      <button className="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><Download className="w-4 h-4" /></button>
                      {idx !== 0 && <button className="p-2 text-amber-500 hover:bg-amber-50 rounded-lg"><RotateCcw className="w-4 h-4" /></button>}
                    </div> </div>
                ))}
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowVersionHistory(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <button onClick={() => handleCheckIn(selectedEvidence, prompt('ÙˆØµÙ Ø§Ù„ØªØ­Ø¯ÙŠØ«:'))} className="flex items-center gap-2 px-6 py-2.5 bg-emerald-500 text-white rounded-xl font-bold"><Upload className="w-5 h-5" />Ø±ÙØ¹ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div> </div> </div>
      )}

      {showFilePreview && selectedEvidence && (
        <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-slate-700 to-slate-800 px-8 py-4 text-white flex items-center justify-between">
              <div className="flex items-center gap-4">
                <Eye className="w-6 h-6" />
                <div>
                  <h2 className="font-bold">{selectedEvidence.title}</h2>
                  <p className="text-slate-400 text-sm">{selectedEvidence.fileName} | {selectedEvidence.fileSize}</p>
                </div> </div>
              <div className="flex items-center gap-3">
                <button onClick={() => handleDownloadWithTracking(selectedEvidence)} className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold"><Download className="w-4 h-4" />ØªØ­Ù…ÙŠÙ„</button>
                <button onClick={() => setShowFilePreview(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-6 h-6" /></button>
              </div> </div>
            <div className="flex-1 bg-slate-100 flex items-center justify-center p-8">
              <div className="bg-white rounded-2xl shadow-xl p-8 text-center max-w-md">
                <FileSearch className="w-20 h-20 text-slate-300 mx-auto mb-4" />
                <h3 className="text-xl font-bold text-slate-800 mb-2">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h3>
                <p className="text-slate-500 mb-4">ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</p>
                <div className="flex items-center justify-center gap-3">
                  <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm">{selectedEvidence.fileName?.split('.').pop()?.toUpperCase()}</span>
                  <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm">{selectedEvidence.fileSize}</span>
                </div> </div> </div> </div> </div>
      )}
    </div>);
};

// Module 4.6: Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
// Compliance Testing Studio - World-Class Edition
// Features: Test Plans, Test Cases, Execution, Findings, Evidence Linking

const ComplianceTests = () => {
  const { can, currentUser, guardAction, checkSoD } = useAuth();

  // STATE MANAGEMENT
  const [activeTab, setActiveTab] = useState('command');
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('view');
  const [modalType, setModalType] = useState('plan'); // plan | case | template | finding
  const [selectedItem, setSelectedItem] = useState(null);
  const [formData, setFormData] = useState(null);
  const [notification, setNotification] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterAuthority, setFilterAuthority] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterPeriod, setFilterPeriod] = useState('');
  const [filterTester, setFilterTester] = useState('');
  const [executionStep, setExecutionStep] = useState(0);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteTarget, setDeleteTarget] = useState(null);

  const [showMobileExecution, setShowMobileExecution] = useState(false);
  const [showReportsModal, setShowReportsModal] = useState(false);
  const [showScheduler, setShowScheduler] = useState(false);
  const [showChecklistModal, setShowChecklistModal] = useState(false);
  const [showRetestWorkflow, setShowRetestWorkflow] = useState(false);
  const [showSignatureModal, setShowSignatureModal] = useState(false);
  const [selectedReportType, setSelectedReportType] = useState('summary');
  const [offlineMode, setOfflineMode] = useState(false);
  const [capturedPhotos, setCapturedPhotos] = useState([]);
  const [gpsLocation, setGpsLocation] = useState(null);
  const [digitalSignature, setDigitalSignature] = useState(null);

  const [scheduledTests, setScheduledTests] = useState([
    { id: 1, templateId: 3, frequency: 'Monthly', nextRun: '2025-03-01', lastRun: '2025-02-01', authorityId: 1, status: 'Active', autoAssign: true, assigneeId: 2 },
    { id: 2, templateId: 2, frequency: 'Quarterly', nextRun: '2025-04-01', lastRun: '2025-01-01', authorityId: 3, status: 'Active', autoAssign: true, assigneeId: 3 },
    { id: 3, templateId: 1, frequency: 'Weekly', nextRun: '2025-02-10', lastRun: '2025-02-03', authorityId: 1, status: 'Paused', autoAssign: false, assigneeId: null },
  ]);

  const [testChecklists, setTestChecklists] = useState([
    {
      id: 1, code: 'CHK-001', title: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', items: [
        { id: 1, text: 'Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', required: true, checked: false },
        { id: 2, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ø·Ø§Ù‚ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', required: true, checked: false },
        { id: 3, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø©', required: true, checked: false },
        { id: 4, text: 'ØªØ¬Ù‡ÙŠØ² Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (ÙƒØ§Ù…ÙŠØ±Ø§/Ù„Ù‚Ø·Ø§Øª Ø´Ø§Ø´Ø©)', required: false, checked: false },
      ]
    },
    {
      id: 2, code: 'CHK-002', title: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', items: [
        { id: 1, text: 'ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬', required: true, checked: false },
        { id: 2, text: 'Ø¥Ø±ÙØ§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¯Ø§Ø¹Ù…Ø©', required: true, checked: false },
        { id: 3, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', required: false, checked: false },
        { id: 4, text: 'Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©', required: true, checked: false },
      ]
    },
  ]);

  const [correctiveActions, setCorrectiveActions] = useState([
    {
      id: 1, findingId: 1, title: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', description: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙÙ„ØªØ±Ø©',
      status: 'InProgress', priority: 'High', ownerId: 2, dueDate: '2025-03-15', progress: 60,
      milestones: [
        { id: 1, title: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©', status: 'Completed', date: '2025-02-20' },
        { id: 2, title: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', status: 'InProgress', date: '2025-03-01' },
        { id: 3, title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯', status: 'Pending', date: '2025-03-10' },
        { id: 4, title: 'Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„', status: 'Pending', date: '2025-03-15' },
      ]
    },
    {
      id: 2, findingId: 2, title: 'ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', description: 'ØªØ¯Ø±ÙŠØ¨ Ø´Ø§Ù…Ù„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      status: 'Completed', priority: 'Critical', ownerId: 3, dueDate: '2025-02-28', progress: 100,
      milestones: [
        { id: 1, title: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©', status: 'Completed', date: '2025-02-15' },
        { id: 2, title: 'ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¯Ø±ÙŠØ¨', status: 'Completed', date: '2025-02-22' },
        { id: 3, title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…', status: 'Completed', date: '2025-02-25' },
      ]
    },]);
  const [retests, setRetests] = useState([
    { id: 1, originalTestId: 2, findingId: 1, scheduledDate: '2025-03-20', testerId: 2, status: 'Scheduled', result: null },
  ]);

  const FINDING_CLASSIFICATION = {
    Critical: { label: 'Ø­Ø±Ø¬', color: 'red', icon: AlertTriangle, description: 'ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ - ØªØ£Ø«ÙŠØ± Ø¹Ø§Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„' },
    Major: { label: 'Ø±Ø¦ÙŠØ³ÙŠ', color: 'orange', icon: AlertCircle, description: 'ÙŠØªØ·Ù„Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…' },
    Minor: { label: 'Ø«Ø§Ù†ÙˆÙŠ', color: 'amber', icon: Info, description: 'ÙŠØªØ·Ù„Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ù„Ø§Ù„ 90 ÙŠÙˆÙ…' },
    Observation: { label: 'Ù…Ù„Ø§Ø­Ø¸Ø©', color: 'blue', icon: Eye, description: 'Ù„Ù„ØªØ­Ø³ÙŠÙ† - Ù„Ø§ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ' },
  };

  // Current User (Use from Auth Context)
  const CURRENT_USER = currentUser || { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Tester' };

  // TEST TEMPLATES
  const [testTemplates, setTestTemplates] = useState([
    {
      id: 1, code: 'TST-TPL-001', title: 'Ø§Ø®ØªØ¨Ø§Ø± ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¶Ø§Ø¨Ø·',
      testType: 'Design', objective: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¶Ø§Ø¨Ø· ÙˆÙ…ÙˆØ§Ø¡Ù…ØªÙ‡ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª',
      sampleMethod: 'Judgmental', defaultSampleSize: 5, stepCount: 4, status: 'Active',
      steps: [
        { id: 1, stepNo: 1, instruction: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¶Ø§Ø¨Ø·', expectedEvidence: 'Document', passFailCriteria: 'Ø§Ù„Ø¶Ø§Ø¨Ø· Ù…ÙˆØ«Ù‚ ÙˆÙ…Ø¹ØªÙ…Ø¯', isMandatory: true },
        { id: 2, stepNo: 2, instruction: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºØ·ÙŠØ© Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª', expectedEvidence: 'Report', passFailCriteria: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…ØºØ·Ø§Ø©', isMandatory: true },
        { id: 3, stepNo: 3, instruction: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª', expectedEvidence: 'Document', passFailCriteria: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø©', isMandatory: true },
        { id: 4, stepNo: 4, instruction: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©', expectedEvidence: 'Report', passFailCriteria: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù…Ù‚Ø¨ÙˆÙ„Ø©', isMandatory: false },
      ],
    },
    {
      id: 2, code: 'TST-TPL-002', title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„',
      testType: 'Operating', objective: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶Ø§Ø¨Ø· ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ',
      sampleMethod: 'Random', defaultSampleSize: 25, stepCount: 5, status: 'Active',
      steps: [
        { id: 1, stepNo: 1, instruction: 'Ø§Ø®ØªÙŠØ§Ø± Ø¹ÙŠÙ†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©', expectedEvidence: 'Log', passFailCriteria: 'Ø§Ù„Ø¹ÙŠÙ†Ø© Ù…Ù…Ø«Ù„Ø©', isMandatory: true },
        { id: 2, stepNo: 2, instruction: 'ÙØ­Øµ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ¹Ù„ÙŠ', expectedEvidence: 'Screenshot', passFailCriteria: 'ØªÙ†ÙÙŠØ° ØµØ­ÙŠØ­', isMandatory: true },
        { id: 3, stepNo: 3, instruction: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', expectedEvidence: 'Report', passFailCriteria: 'Ù„Ø§ Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ø¬ÙˆÙ‡Ø±ÙŠØ©', isMandatory: true },
        { id: 4, stepNo: 4, instruction: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ«ÙŠÙ‚', expectedEvidence: 'Document', passFailCriteria: 'ØªÙˆØ«ÙŠÙ‚ ÙƒØ§Ù…Ù„', isMandatory: true },
        { id: 5, stepNo: 5, instruction: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬', expectedEvidence: 'Report', passFailCriteria: 'Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ â‰¥ 95%', isMandatory: true },
      ],
    },
    {
      id: 3, code: 'TST-TPL-003', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ',
      testType: 'Compliance', objective: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©',
      sampleMethod: 'Systematic', defaultSampleSize: 10, stepCount: 6, status: 'Active',
      steps: [
        { id: 1, stepNo: 1, instruction: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', expectedEvidence: 'Document', passFailCriteria: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ù…Ø­Ø¯Ø¯', isMandatory: true },
        { id: 2, stepNo: 2, instruction: 'Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', expectedEvidence: 'Multiple', passFailCriteria: 'Ø£Ø¯Ù„Ø© ÙƒØ§ÙÙŠØ©', isMandatory: true },
        { id: 3, stepNo: 3, instruction: 'Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ù„Ø© Ø¨Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª', expectedEvidence: 'Report', passFailCriteria: 'ØªØ·Ø§Ø¨Ù‚ ÙƒØ§Ù…Ù„', isMandatory: true },
        { id: 4, stepNo: 4, instruction: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ¬ÙˆØ§Øª', expectedEvidence: 'Report', passFailCriteria: 'Ù„Ø§ ÙØ¬ÙˆØ§Øª', isMandatory: true },
        { id: 5, stepNo: 5, instruction: 'Ù…Ø±Ø§Ø¬Ø¹Ø© CAPA Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', expectedEvidence: 'Document', passFailCriteria: 'CAPA Ù…ØºÙ„Ù‚Ø©', isMandatory: false },
        { id: 6, stepNo: 6, instruction: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', expectedEvidence: 'Report', passFailCriteria: 'ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØªÙ…Ù„', isMandatory: true },
      ],
    },
    {
      id: 4, code: 'TST-TPL-004', title: 'Ø§Ø®ØªØ¨Ø§Ø± Walkthrough',
      testType: 'Walkthrough', objective: 'ÙÙ‡Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©',
      sampleMethod: 'Judgmental', defaultSampleSize: 1, stepCount: 3, status: 'Active',
      steps: [
        { id: 1, stepNo: 1, instruction: 'Ù…Ù‚Ø§Ø¨Ù„Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', expectedEvidence: 'Document', passFailCriteria: 'ÙÙ‡Ù… ÙˆØ§Ø¶Ø­', isMandatory: true },
        { id: 2, stepNo: 2, instruction: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', expectedEvidence: 'Screenshot', passFailCriteria: 'Ø¹Ù…Ù„ÙŠØ© Ù…ÙˆØ«Ù‚Ø©', isMandatory: true },
        { id: 3, stepNo: 3, instruction: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', expectedEvidence: 'Report', passFailCriteria: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©', isMandatory: true },
      ],
    },]);
  // TEST PLANS
  const [testPlans, setTestPlans] = useState([
    {
      id: 1, code: 'PLAN-2025-Q1-001', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ - Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ 2025',
      authorityId: 1, periodKey: 'Q1-2025', scope: { bu: 'All', process: 'All', system: 'All' },
      status: 'Active', ownerId: 1, approverId: 2, testCaseCount: 4,
      startDate: '2025-01-01', endDate: '2025-03-31',
      createdAt: '2025-01-01', approvedAt: '2025-01-05', progress: 75,
    },
    {
      id: 2, code: 'PLAN-2025-Q1-002', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ - Q1',
      authorityId: 3, periodKey: 'Q1-2025', scope: { bu: 'IT', process: 'Security', system: 'All' },
      status: 'Completed', ownerId: 3, approverId: 1, testCaseCount: 3,
      startDate: '2025-01-15', endDate: '2025-03-15',
      createdAt: '2025-01-10', approvedAt: '2025-01-12', progress: 100,
    },
    {
      id: 3, code: 'PLAN-2025-Q2-001', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ',
      authorityId: 4, periodKey: 'Q2-2025', scope: { bu: 'All', process: 'Data', system: 'All' },
      status: 'Draft', ownerId: 4, approverId: 1, testCaseCount: 0,
      startDate: '2025-04-01', endDate: '2025-06-30', createdAt: '2025-02-01', approvedAt: null, progress: 0,
    },
    {
      id: 4, code: 'PLAN-2025-Q1-003', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - Q1',
      authorityId: 1, periodKey: 'Q1-2025', scope: { bu: 'Finance', process: 'AML', system: 'Core' },
      status: 'Active', ownerId: 2, approverId: 1, testCaseCount: 6,
      startDate: '2025-01-01', endDate: '2025-03-31',
      createdAt: '2025-01-05', approvedAt: '2025-01-08', progress: 50,
    },
    {
      id: 5, code: 'PLAN-2025-Q2-002', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ - Q2',
      authorityId: 1, periodKey: 'Q2-2025', scope: { bu: 'All', process: 'BCM', system: 'All' },
      status: 'Pending', ownerId: 1, approverId: 3, testCaseCount: 4,
      startDate: '2025-04-01', endDate: '2025-06-30', createdAt: '2025-02-10', approvedAt: null, progress: 0,
    },
    {
      id: 6, code: 'PLAN-2025-Q1-004', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø£Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª - Q1',
      authorityId: 3, periodKey: 'Q1-2025', scope: { bu: 'IT', process: 'AppSec', system: 'All' },
      status: 'Active', ownerId: 3, approverId: 2, testCaseCount: 5,
      startDate: '2025-02-01', endDate: '2025-03-31',
      createdAt: '2025-01-20', approvedAt: '2025-01-25', progress: 40,
    },
    {
      id: 7, code: 'PLAN-2025-Q3-001', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø®ØµÙˆØµÙŠØ© - Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«',
      authorityId: 4, periodKey: 'Q3-2025', scope: { bu: 'All', process: 'Privacy', system: 'All' },
      status: 'Draft', ownerId: 4, approverId: 1, testCaseCount: 0,
      startDate: '2025-07-01', endDate: '2025-09-30', createdAt: '2025-02-15', approvedAt: null, progress: 0,
    },
    {
      id: 8, code: 'PLAN-2025-Q2-003', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªÙ‚Ø§Ø±ÙŠØ± Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ© - Q2',
      authorityId: 2, periodKey: 'Q2-2025', scope: { bu: 'Finance', process: 'Reporting', system: 'ERP' },
      status: 'Pending', ownerId: 2, approverId: 1, testCaseCount: 3,
      startDate: '2025-04-15', endDate: '2025-06-15', createdAt: '2025-02-20', approvedAt: null, progress: 0,
    },
    {
      id: 9, code: 'PLAN-2025-Q4-001', title: 'Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© - Q4',
      authorityId: 1, periodKey: 'Q4-2025', scope: { bu: 'All', process: 'All', system: 'All' },
      status: 'Draft', ownerId: 1, approverId: 2, testCaseCount: 0,
      startDate: '2025-10-01', endDate: '2025-12-31', createdAt: '2025-02-25', approvedAt: null, progress: 0,
    },
    {
      id: 10, code: 'PLAN-2025-Q1-005', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© - Q1',
      authorityId: 1, periodKey: 'Q1-2025', scope: { bu: 'Finance', process: 'Internal Controls', system: 'ERP' },
      status: 'Active', ownerId: 2, approverId: 1, testCaseCount: 8,
      startDate: '2025-01-10', endDate: '2025-03-25',
      createdAt: '2025-01-08', approvedAt: '2025-01-09', progress: 65,
    },
    {
      id: 11, code: 'PLAN-2025-Q1-006', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©',
      authorityId: 1, periodKey: 'Q1-2025', scope: { bu: 'Operations', process: 'Risk Management', system: 'All' },
      status: 'Active', ownerId: 1, approverId: 3, testCaseCount: 5,
      startDate: '2025-02-01', endDate: '2025-03-31',
      createdAt: '2025-01-25', approvedAt: '2025-01-28', progress: 30,
    },
    {
      id: 12, code: 'PLAN-2025-Q2-004', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙˆÙƒÙ…Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
      authorityId: 3, periodKey: 'Q2-2025', scope: { bu: 'IT', process: 'IT Governance', system: 'All' },
      status: 'Pending', ownerId: 3, approverId: 2, testCaseCount: 4,
      startDate: '2025-04-15', endDate: '2025-06-15', createdAt: '2025-02-28', approvedAt: null, progress: 0,
    },
    {
      id: 13, code: 'PLAN-2025-Q2-005', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
      authorityId: 4, periodKey: 'Q2-2025', scope: { bu: 'All', process: 'PDPL', system: 'All' },
      status: 'Draft', ownerId: 4, approverId: 1, testCaseCount: 0,
      startDate: '2025-05-01', endDate: '2025-06-30', createdAt: '2025-03-01', approvedAt: null, progress: 0,
    },
    {
      id: 14, code: 'PLAN-2025-Q3-002', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„',
      authorityId: 3, periodKey: 'Q3-2025', scope: { bu: 'IT', process: 'IAM', system: 'All' },
      status: 'Draft', ownerId: 3, approverId: 1, testCaseCount: 0,
      startDate: '2025-07-15', endDate: '2025-09-15', createdAt: '2025-03-05', approvedAt: null, progress: 0,
    },
    {
      id: 15, code: 'PLAN-2025-Q1-007', title: 'Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©',
      authorityId: 1, periodKey: 'Q1-2025', scope: { bu: 'Finance', process: 'Regulatory Reporting', system: 'Core' },
      status: 'Completed', ownerId: 2, approverId: 1, testCaseCount: 6,
      startDate: '2025-01-05', endDate: '2025-02-28',
      createdAt: '2025-01-03', approvedAt: '2025-01-04', progress: 100,
    },]);
  // TEST CASES
  const [testCases, setTestCases] = useState([
    {
      id: 1, code: 'TC-2025-001', planId: 1, obligationId: 1, controlId: 1, templateId: 3,
      title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', testerId: 2, reviewerId: 1, dueDate: '2025-02-15',
      status: 'Submitted', overallResult: 'Pass', sampleSize: 10, populationRef: 'ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙ†Ø§ÙŠØ± 2025',
      startedAt: '2025-02-01', submittedAt: '2025-02-10',
      stepResults: [
        { stepId: 1, result: 'Pass', comment: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ù…Ø­Ø¯Ø¯ ÙˆÙˆØ§Ø¶Ø­', evidenceIds: [1] },
        { stepId: 2, result: 'Pass', comment: 'ØªÙ… Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø©', evidenceIds: [1, 2] },
        { stepId: 3, result: 'Pass', comment: 'ØªØ·Ø§Ø¨Ù‚ ÙƒØ§Ù…Ù„', evidenceIds: [3] },
        { stepId: 4, result: 'Pass', comment: 'Ù„Ø§ ÙØ¬ÙˆØ§Øª', evidenceIds: [] },
        { stepId: 5, result: 'N/A', comment: 'Ù„Ø§ CAPA Ø³Ø§Ø¨Ù‚Ø©', evidenceIds: [] },
        { stepId: 6, result: 'Pass', comment: 'ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØªÙ…Ù„', evidenceIds: [4] },
      ],
      notes: 'Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§Ø¬Ø­ - Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙƒØ§Ù…Ù„',
    },
    {
      id: 2, code: 'TC-2025-002', planId: 1, obligationId: 2, controlId: 2, templateId: 2,
      title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø¶Ø§Ø¨Ø· Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', testerId: 2, reviewerId: 1, dueDate: '2025-02-20',
      status: 'InProgress', overallResult: null, sampleSize: 25, populationRef: 'Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙŠÙ†Ø§ÙŠØ± 2025',
      startedAt: '2025-02-05', submittedAt: null,
      stepResults: [
        { stepId: 1, result: 'Pass', comment: 'Ø¹ÙŠÙ†Ø© 25 Ù…Ø¹Ø§Ù…Ù„Ø©', evidenceIds: [5] },
        { stepId: 2, result: 'Pass', comment: 'ØªÙ†ÙÙŠØ° ØµØ­ÙŠØ­', evidenceIds: [6] },
        { stepId: 3, result: 'Fail', comment: 'ÙˆØ¬ÙˆØ¯ 3 Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', evidenceIds: [7] },
        { stepId: 4, result: null, comment: '', evidenceIds: [] },
        { stepId: 5, result: null, comment: '', evidenceIds: [] },
      ],
      notes: '',
    },
    {
      id: 3, code: 'TC-2025-003', planId: 1, obligationId: 3, controlId: 5, templateId: 1,
      title: 'Ø§Ø®ØªØ¨Ø§Ø± ØªØµÙ…ÙŠÙ… Ø¶Ø§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØµÙˆÙ„', testerId: 3, reviewerId: 1, dueDate: '2025-02-25',
      status: 'NotStarted', overallResult: null, sampleSize: 5, populationRef: null, startedAt: null, submittedAt: null,
      stepResults: [], notes: '',
    },
    {
      id: 4, code: 'TC-2025-004', planId: 2, obligationId: 5, controlId: 6, templateId: 2,
      title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', testerId: 3, reviewerId: 2, dueDate: '2025-03-01',
      status: 'Reviewed', overallResult: 'Partial', sampleSize: 20, populationRef: 'Ø£Ø­Ø¯Ø§Ø« Ø£Ù…Ù†ÙŠØ© Q4-2024',
      startedAt: '2025-02-10', submittedAt: '2025-02-20',
      stepResults: [
        { stepId: 1, result: 'Pass', comment: 'Ø¹ÙŠÙ†Ø© Ù…Ù…Ø«Ù„Ø©', evidenceIds: [8] },
        { stepId: 2, result: 'Pass', comment: 'ØªÙ†ÙÙŠØ° ØµØ­ÙŠØ­', evidenceIds: [9] },
        { stepId: 3, result: 'Fail', comment: '2 Ø­ÙˆØ§Ø¯Ø« ØºÙŠØ± Ù…ÙˆØ«Ù‚Ø©', evidenceIds: [10] },
        { stepId: 4, result: 'Pass', comment: 'ØªÙˆØ«ÙŠÙ‚ Ø¬ÙŠØ¯', evidenceIds: [11] },
        { stepId: 5, result: 'Partial', comment: 'Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ 90%', evidenceIds: [12] },
      ],
      notes: 'ÙŠØªØ·Ù„Ø¨ ØªØ­Ø³ÙŠÙ† ÙÙŠ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«',
    },
    {
      id: 5, code: 'TC-2025-005', planId: 1, obligationId: 4, controlId: 3, templateId: 3,
      title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„ Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', testerId: 4, reviewerId: 1, dueDate: '2025-03-10',
      status: 'NotStarted', overallResult: null, sampleSize: 15, populationRef: null, startedAt: null, submittedAt: null,
      stepResults: [], notes: '',
    },]);
  // FINDINGS
  const [findings, setFindings] = useState([
    {
      id: 1, code: 'FND-2025-001', testCaseId: 2, severity: 'Medium',
      findingType: 'ControlFailure', title: 'Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª',
      description: 'ØªÙ… Ø±ØµØ¯ 3 Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ù… ØªØ®Ø¶Ø¹ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', rootCause: 'Ø®Ù„Ù„ ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙÙ„ØªØ±Ø©',
      recommendation: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ',
      status: 'Open', capaId: null, responsibleId: 2, dueDate: '2025-03-15',
      createdAt: '2025-02-10', createdBy: 2,
    },
    {
      id: 2, code: 'FND-2025-002', testCaseId: 4, severity: 'High',
      findingType: 'ProcessGap', title: 'Ù†Ù‚Øµ ÙÙŠ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      description: 'Ø­Ø§Ø¯Ø«ØªØ§Ù† Ø£Ù…Ù†ÙŠØªØ§Ù† Ù„Ù… ÙŠØªÙ… ØªÙˆØ«ÙŠÙ‚Ù‡Ù…Ø§ ÙˆÙÙ‚ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯',
      rootCause: 'Ø¹Ø¯Ù… ÙˆØ¶ÙˆØ­ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„ÙØ±ÙŠÙ‚',
      recommendation: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…ÙˆØ°Ø¬',
      status: 'ConvertedToCAPA', capaId: 1, responsibleId: 3, dueDate: '2025-03-01',
      createdAt: '2025-02-20', createdBy: 3,
    },
    {
      id: 3, code: 'FND-2025-003', testCaseId: 4, severity: 'Low',
      findingType: 'EvidenceInsufficient', title: 'Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¯Ø§Ø¹Ù…Ø©',
      description: 'Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø© ØºÙŠØ± Ù…Ø¤Ø±Ø®Ø©', rootCause: 'Ø¹Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
      recommendation: 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø©',
      status: 'Closed', capaId: null, responsibleId: 3, dueDate: '2025-02-25',
      createdAt: '2025-02-20', createdBy: 3, closedAt: '2025-02-24',
    },]);
  // CONFIGURATIONS
  const TEST_TYPE_CONFIG = {
    Design: { label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØµÙ…ÙŠÙ…', icon: FileText, color: 'blue' },
    Operating: { label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ´ØºÙŠÙ„', icon: Play, color: 'emerald' },
    Compliance: { label: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', icon: Shield, color: 'purple' },
    Walkthrough: { label: 'Walkthrough', icon: Eye, color: 'amber' },
  };

  const PLAN_STATUS_CONFIG = {
    Draft: { label: 'Ù…Ø³ÙˆØ¯Ø©', bg: 'bg-slate-100', text: 'text-slate-600' },
    Pending: { label: 'Ù…Ø¹Ù„Ù‚', bg: 'bg-amber-100', text: 'text-amber-700' },
    Approved: { label: 'Ù…Ø¹ØªÙ…Ø¯', bg: 'bg-blue-100', text: 'text-blue-700' },
    Active: { label: 'Ù†Ø´Ø·', bg: 'bg-emerald-100', text: 'text-emerald-700' },
    Completed: { label: 'Ù…ÙƒØªÙ…Ù„', bg: 'bg-purple-100', text: 'text-purple-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', bg: 'bg-slate-100', text: 'text-slate-500' },
  };

  const CASE_STATUS_CONFIG = {
    NotStarted: { label: 'Ù„Ù… ÙŠØ¨Ø¯Ø£', icon: Clock, bg: 'bg-slate-100', text: 'text-slate-600' },
    InProgress: { label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Play, bg: 'bg-blue-100', text: 'text-blue-700' },
    Submitted: { label: 'Ù…Ø±Ø³Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Send, bg: 'bg-amber-100', text: 'text-amber-700' },
    Reviewed: { label: 'ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', icon: Lock, bg: 'bg-slate-100', text: 'text-slate-500' },
  };

  const RESULT_CONFIG = {
    Pass: { label: 'Ù†Ø§Ø¬Ø­', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-300' },
    Fail: { label: 'ÙØ§Ø´Ù„', icon: XCircle, bg: 'bg-red-100', text: 'text-red-700', border: 'border-red-300' },
    Partial: { label: 'Ø¬Ø²Ø¦ÙŠ', icon: AlertCircle, bg: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-300' },
    'N/A': { label: 'ØºÙŠØ± Ù…Ù†Ø·Ø¨Ù‚', icon: MinusCircle, bg: 'bg-slate-100', text: 'text-slate-600', border: 'border-slate-300' },
  };

  const SEVERITY_CONFIG = {
    High: { label: 'Ø¹Ø§Ù„ÙŠ', bg: 'bg-red-100', text: 'text-red-700', border: 'border-red-300' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', bg: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-300' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', bg: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-300' },
  };

  const FINDING_TYPE_CONFIG = {
    ControlFailure: { label: 'ÙØ´Ù„ Ø§Ù„Ø¶Ø§Ø¨Ø·', icon: Shield }, PolicyGap: { label: 'ÙØ¬ÙˆØ© Ø³ÙŠØ§Ø³Ø©', icon: FileText },
    EvidenceInsufficient: { label: 'Ø£Ø¯Ù„Ø© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', icon: FileQuestion },
    ProcessGap: { label: 'ÙØ¬ÙˆØ© Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©', icon: GitBranch },
  };

  const FINDING_STATUS_CONFIG = {
    Open: { label: 'Ù…ÙØªÙˆØ­', bg: 'bg-amber-100', text: 'text-amber-700' },
    ConvertedToCAPA: { label: 'ØªØ­ÙˆÙŠÙ„ Ù„Ù€ CAPA', bg: 'bg-purple-100', text: 'text-purple-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', bg: 'bg-emerald-100', text: 'text-emerald-700' },
  };

  const TESTERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' },
    { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Compliance Tester' },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'IT Auditor' },
    { id: 4, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Data Protection' },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Governance Analyst' },
  ];

  // COMPUTED STATISTICS
  const stats = useMemo(() => {
    const totalCases = testCases.length;
    const notStarted = testCases.filter(tc => tc.status === 'NotStarted').length;
    const inProgress = testCases.filter(tc => tc.status === 'InProgress').length;
    const submitted = testCases.filter(tc => tc.status === 'Submitted').length;
    const reviewed = testCases.filter(tc => tc.status === 'Reviewed' || tc.status === 'Closed').length;

    const passed = testCases.filter(tc => tc.overallResult === 'Pass').length;
    const failed = testCases.filter(tc => tc.overallResult === 'Fail').length;
    const partial = testCases.filter(tc => tc.overallResult === 'Partial').length;

    const openFindings = findings.filter(f => f.status === 'Open').length;
    const highFindings = findings.filter(f => f.severity === 'High' && f.status !== 'Closed').length;

    const totalObligations = INITIAL_OBLIGATIONS.length;
    const testedObligations = [...new Set(testCases.map(tc => tc.obligationId))].length;
    const coveragePercent = Math.round((testedObligations / totalObligations) * 100);

    const dueSoon = testCases.filter(tc => {
      if (!tc.dueDate || tc.status === 'Reviewed' || tc.status === 'Closed') return false;
      const days = Math.ceil((new Date(tc.dueDate) - new Date()) / (1000 * 60 * 60 * 24));
      return days >= 0 && days <= 7;
    }).length;

    const overdue = testCases.filter(tc => {
      if (!tc.dueDate || tc.status === 'Reviewed' || tc.status === 'Closed') return false;
      return new Date(tc.dueDate) < new Date();
    }).length;

    return {
      totalCases, notStarted, inProgress, submitted, reviewed,
      passed, failed, partial, openFindings, highFindings,
      coveragePercent, testedObligations, totalObligations,
      dueSoon, overdue, totalPlans: testPlans.length,
      activePlans: testPlans.filter(p => p.status === 'Active').length,
    };
  }, [testCases, findings, testPlans]);

  // HELPER FUNCTIONS
  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const getUser = (id) => TESTERS.find(u => u.id === id);
  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);
  const getObligation = (id) => INITIAL_OBLIGATIONS.find(o => o.id === id);
  const getControl = (id) => CONTROLS.find(c => c.id === id);
  const getTemplate = (id) => testTemplates.find(t => t.id === id);
  const getPlan = (id) => testPlans.find(p => p.id === id);

  const canReview = (testCase) => {
    // SoD: Ø§Ù„Ù…Ø®ØªØ¨Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø®ØªØ¨Ø§Ø±Ù‡
    return testCase.testerId !== CURRENT_USER.id && testCase.reviewerId === CURRENT_USER.id;
  };

  const getDaysUntilDue = (dueDate) => {
    if (!dueDate) return null;
    return Math.ceil((new Date(dueDate) - new Date()) / (1000 * 60 * 60 * 24));
  };

  const handleCreatePlan = () => {
    setFormData({
      id: null, code: `PLAN-2025-Q${Math.ceil((new Date().getMonth() + 1) / 3)}-${String(testPlans.length + 1).padStart(3, '0')}`,
      title: '', authorityId: '', periodKey: '', scope: { bu: 'All', process: 'All', system: 'All' },
      status: 'Draft', ownerId: CURRENT_USER.id, approverId: '', testCaseCount: 0,
      startDate: '', endDate: '', createdAt: new Date().toISOString().split('T')[0],
    });
    setModalType('plan');
    setModalMode('create');
    setShowModal(true);
  };

  const handleCreateCase = (planId = null) => {
    setFormData({
      id: null, code: `TC-2025-${String(testCases.length + 1).padStart(3, '0')}`,
      planId: planId || '', obligationId: '', controlId: '', templateId: '',
      title: '', testerId: '', reviewerId: '', dueDate: '', status: 'NotStarted', overallResult: null,
      sampleSize: 10, populationRef: '', startedAt: null, submittedAt: null,
      stepResults: [], notes: '',
    });
    setModalType('case');
    setModalMode('create');
    setShowModal(true);
  };

  const handleCreateFinding = (testCaseId = null) => {
    setFormData({
      id: null, code: `FND-2025-${String(findings.length + 1).padStart(3, '0')}`,
      testCaseId: testCaseId || '', severity: 'Medium', findingType: 'ControlFailure',
      title: '', description: '', rootCause: '', recommendation: '',
      status: 'Open', capaId: null, responsibleId: '', dueDate: '',
      createdAt: new Date().toISOString().split('T')[0], createdBy: CURRENT_USER.id,
    });
    setModalType('finding');
    setModalMode('create');
    setShowModal(true);
  };

  const handleSave = () => {
    const now = new Date().toISOString().split('T')[0];

    if (modalType === 'plan') {
      if (!formData.title || !formData.periodKey) {
        showNotification('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙØªØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
        return;
      }
      if (modalMode === 'create') {
        setTestPlans([...testPlans, { ...formData, id: testPlans.length + 1 }]);
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        setTestPlans(testPlans.map(p => p.id === formData.id ? formData : p));
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
      }
    } else if (modalType === 'case') {
      if (!formData.obligationId || !formData.templateId || !formData.testerId || !formData.reviewerId) {
        showNotification('Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆØ§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù…Ø®ØªØ¨Ø± ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      if (formData.testerId === formData.reviewerId) {
        showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø®ØªØ¨Ø± Ù‡Ùˆ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (SoD)', 'error');
        return;
      }
      if (modalMode === 'create') {
        const template = getTemplate(parseInt(formData.templateId));
        const newCase = {
          ...formData,
          id: testCases.length + 1,
          stepResults: template?.steps.map(s => ({ stepId: s.id, result: null, comment: '', evidenceIds: [] })) || [],
        };
        setTestCases([...testCases, newCase]);
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        setTestCases(testCases.map(tc => tc.id === formData.id ? formData : tc));
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
      }
    } else if (modalType === 'finding') {
      if (!formData.testCaseId || !formData.title || !formData.description) {
        showNotification('Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      if (modalMode === 'create') {
        setFindings([...findings, { ...formData, id: findings.length + 1 }]);
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        setFindings(findings.map(f => f.id === formData.id ? formData : f));
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©');
      }
    }
    setShowModal(false);
    setFormData(null);
  };

  const handleDelete = () => {
    if (modalType === 'plan') {
      setTestPlans(testPlans.filter(p => p.id !== deleteTarget.id));
    } else if (modalType === 'case') {
      setTestCases(testCases.filter(tc => tc.id !== deleteTarget.id));
    } else if (modalType === 'finding') {
      setFindings(findings.filter(f => f.id !== deleteTarget.id));
    }
    showNotification('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
    setShowDeleteConfirm(false);
    setDeleteTarget(null);
  };

  const handleStartExecution = (testCase) => {
    setTestCases(testCases.map(tc => tc.id === testCase.id ? {
      ...tc, status: 'InProgress', startedAt: new Date().toISOString().split('T')[0]
    } : tc));
    showNotification('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°');
  };

  const handleSubmitForReview = (testCase) => {
    const template = getTemplate(testCase.templateId);
    const mandatorySteps = template?.steps.filter(s => s.isMandatory) || [];
    const completedMandatory = mandatorySteps.every(s => {
      const result = testCase.stepResults.find(sr => sr.stepId === s.id);
      return result && result.result !== null;
    });

    if (!completedMandatory) {
      showNotification('ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
      return;
    }

    const failedSteps = testCase.stepResults.filter(sr => sr.result === 'Fail');
    const existingFindings = findings.filter(f => f.testCaseId === testCase.id);

    if (failedSteps.length > 0 && existingFindings.length === 0) {
      showNotification('ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©', 'error');
      return;
    }

    // Calculate overall result
    const results = testCase.stepResults.filter(sr => sr.result && sr.result !== 'N/A').map(sr => sr.result);
    let overallResult = 'Pass';
    if (results.includes('Fail')) {
      overallResult = results.every(r => r === 'Fail') ? 'Fail' : 'Partial';
    }

    setTestCases(testCases.map(tc => tc.id === testCase.id ? {
      ...tc, status: 'Submitted', overallResult, submittedAt: new Date().toISOString().split('T')[0]
    } : tc));
    showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
  };

  const handleApproveReview = (testCase) => {
    setTestCases(testCases.map(tc => tc.id === testCase.id ? {
      ...tc, status: 'Reviewed'
    } : tc));
    showNotification('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
  };

  const handleReturnForRevision = (testCase) => {
    setTestCases(testCases.map(tc => tc.id === testCase.id ? {
      ...tc, status: 'InProgress', submittedAt: null
    } : tc));
    showNotification('ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
  };

  const handleConvertToCAPA = (finding) => {
    setFindings(findings.map(f => f.id === finding.id ? {
      ...f, status: 'ConvertedToCAPA', capaId: finding.id
    } : f));
    showNotification('ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ù„Ù‰ CAPA');
  };

  // Capture GPS Location
  const captureGPSLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setGpsLocation({
            lat: position.coords.latitude, lng: position.coords.longitude, timestamp: new Date().toISOString(),
            accuracy: position.coords.accuracy
          });
          showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ');
        },
        (error) => {
          showNotification('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ' + error.message, 'error');
        });
    }
  };

  // Capture Photo/Screenshot
  const handlePhotoCapture = (testCaseId) => {
    const newPhoto = {
      id: capturedPhotos.length + 1,
      testCaseId,
      timestamp: new Date().toISOString(), type: 'photo', fileName: `capture_${Date.now()}.jpg`,
      size: '1.2 MB'
    };
    setCapturedPhotos([...capturedPhotos, newPhoto]);
    showNotification('ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©');
  };

  // Digital Signature
  const handleDigitalSignature = (testCase) => {
    const signature = {
      signedBy: CURRENT_USER.id, signedByName: CURRENT_USER.name, timestamp: new Date().toISOString(),
      testCaseId: testCase.id,
      hash: 'SHA256:' + Date.now().toString(36)
    };
    setDigitalSignature(signature);
    showNotification('ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
    setShowSignatureModal(false);
  };

  // Schedule Test
  const handleScheduleTest = (templateId, frequency, authorityId, assigneeId) => {
    const nextRun = new Date();
    if (frequency === 'Weekly') nextRun.setDate(nextRun.getDate() + 7);
    if (frequency === 'Monthly') nextRun.setMonth(nextRun.getMonth() + 1);
    if (frequency === 'Quarterly') nextRun.setMonth(nextRun.getMonth() + 3);

    const newSchedule = {
      id: scheduledTests.length + 1,
      templateId,
      frequency,
      authorityId,
      assigneeId,
      nextRun: nextRun.toISOString().split('T')[0], lastRun: null, status: 'Active',
      autoAssign: assigneeId !== null
    };
    setScheduledTests([...scheduledTests, newSchedule]);
    showNotification('ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
  };

  // Create Retest
  const handleCreateRetest = (originalTestId, findingId) => {
    const retest = {
      id: retests.length + 1,
      originalTestId,
      findingId,
      scheduledDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      testerId: CURRENT_USER.id, status: 'Scheduled',
      result: null
    };
    setRetests([...retests, retest]);
    showNotification('ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
  };

  // Escalate Finding to Issue
  const handleEscalateToIssue = (finding) => {
    const updatedFinding = {
      ...finding,
      status: 'Escalated', escalatedAt: new Date().toISOString(),
      escalatedBy: CURRENT_USER.id
    };
    setFindings(findings.map(f => f.id === finding.id ? updatedFinding : f));
    showNotification('ØªÙ… ØªØµØ¹ÙŠØ¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙƒÙ‚Ø¶ÙŠØ©');
  };

  // Update Corrective Action Progress
  const handleUpdateCAPAProgress = (capaId, milestoneId, newStatus) => {
    setCorrectiveActions(correctiveActions.map(capa => {
      if (capa.id !== capaId) return capa;
      const updatedMilestones = capa.milestones.map(m =>
        m.id === milestoneId ? { ...m, status: newStatus } : m
      );
      const completed = updatedMilestones.filter(m => m.status === 'Completed').length;
      const progress = Math.round((completed / updatedMilestones.length) * 100);
      return { ...capa, milestones: updatedMilestones, progress };
    }));
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ');
  };

  // Generate Report
  const handleGenerateReport = (reportType) => {
    setSelectedReportType(reportType);
    showNotification(`Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ${reportType}...`);
  };

  // Toggle Offline Mode
  const handleToggleOfflineMode = () => {
    setOfflineMode(!offlineMode);
    showNotification(offlineMode ? 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„' : 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹');
  };

  // Tester Performance Stats
  const getTesterPerformance = (testerId) => {
    const testerCases = testCases.filter(tc => tc.testerId === testerId);
    const completed = testerCases.filter(tc => tc.status === 'Reviewed' || tc.status === 'Closed').length;
    const passed = testerCases.filter(tc => tc.overallResult === 'Pass').length;
    const avgDays = testerCases.filter(tc => tc.startedAt && tc.submittedAt)
      .map(tc => Math.ceil((new Date(tc.submittedAt) - new Date(tc.startedAt)) / (1000 * 60 * 60 * 24)))
      .reduce((a, b, _, arr) => a + b / arr.length, 0);
    return {
      total: testerCases.length,
      completed,
      passed,
      passRate: completed > 0 ? Math.round((passed / completed) * 100) : 0,
      avgCompletionDays: Math.round(avgDays) || 0
    };
  };

  const handleUpdateStepResult = (testCaseId, stepId, result, comment) => {
    setTestCases(testCases.map(tc => {
      if (tc.id !== testCaseId) return tc;
      const newStepResults = tc.stepResults.map(sr =>
        sr.stepId === stepId ? { ...sr, result, comment } : sr
      );
      return { ...tc, stepResults: newStepResults };
    }));
  };

  // TABS CONFIGURATION
  const tabs = [
    { id: 'command', label: 'Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard, count: null },
    { id: 'plans', label: 'Ø®Ø·Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardList, count: testPlans.length },
    { id: 'cases', label: 'Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: FileCheck, count: stats.inProgress + stats.notStarted },
    { id: 'execution', label: 'Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Play, count: stats.inProgress },
    { id: 'findings', label: 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', icon: AlertTriangle, count: stats.openFindings },
    { id: 'capa', label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©', icon: Target, count: correctiveActions.filter(c => c.status !== 'Completed').length },
    { id: 'reports', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', icon: BarChart3, count: null },
    { id: 'templates', label: 'Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: FileText, count: testTemplates.length },
    { id: 'scheduler', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©', icon: Calendar, count: scheduledTests.filter(s => s.status === 'Active').length },
  ];

  // RENDER
  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg">
            <ClipboardCheck className="w-7 h-7 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-slate-900">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h1>
            <p className="text-slate-500">Compliance Testing Studio - Module 4.6 v5.52.0</p>
          </div> </div>
        <div className="flex items-center gap-3">
          <button onClick={handleToggleOfflineMode} className={`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-bold ${offlineMode ? 'bg-amber-100 text-amber-700 border-2 border-amber-300' : 'bg-slate-100 text-slate-600'}`}>
            {offlineMode ? <AlertCircle className="w-4 h-4" /> : <Globe className="w-4 h-4" />}
            {offlineMode ? 'ØºÙŠØ± Ù…ØªØµÙ„' : 'Ù…ØªØµÙ„'}
          </button>
          <button onClick={() => setShowMobileExecution(true)} className="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl text-sm font-bold shadow-lg">
            <Maximize2 className="w-4 h-4" />ØªÙ†ÙÙŠØ° Ù…ÙŠØ¯Ø§Ù†ÙŠ
          </button>
          <button onClick={handleCreatePlan}
            className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50">
            <FolderPlus className="w-5 h-5" />Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©
          </button>
          <button onClick={() => handleCreateCase()}
            className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg">
            <Plus className="w-5 h-5" />Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
          </button> </div> </div>
      <div className="grid grid-cols-8 gap-3">
        <div className="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl p-4 text-white">
          <div className="flex items-center justify-between mb-2">
            <Target className="w-6 h-6 text-white/80" />
            <span className="text-3xl font-bold">{stats.coveragePercent}%</span>
          </div>
          <p className="text-purple-100 text-sm">ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
          <p className="text-xs text-purple-200">{stats.testedObligations}/{stats.totalObligations} Ø§Ù„ØªØ²Ø§Ù…</p>
        </div>

        <div className={`rounded-2xl p-4 border-2 ${stats.overdue > 0 ? 'bg-red-50 border-red-300 animate-pulse' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <AlertTriangle className={`w-5 h-5 ${stats.overdue > 0 ? 'text-red-500' : 'text-slate-400'}`} />
            <p className="text-xs text-slate-500">Ù…ØªØ£Ø®Ø±</p>
          </div>
          <p className={`text-2xl font-bold ${stats.overdue > 0 ? 'text-red-600' : 'text-slate-400'}`}>{stats.overdue}</p>
        </div>

        <div className={`rounded-2xl p-4 border-2 ${stats.dueSoon > 0 ? 'bg-amber-50 border-amber-300' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <Clock className="w-5 h-5 text-amber-500" />
            <p className="text-xs text-slate-500">ÙŠØ³ØªØ­Ù‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
          </div>
          <p className="text-2xl font-bold text-amber-600">{stats.dueSoon}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-blue-200">
          <div className="flex items-center gap-2 mb-1">
            <Play className="w-5 h-5 text-blue-500" />
            <p className="text-xs text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
          </div>
          <p className="text-2xl font-bold text-blue-600">{stats.inProgress}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-emerald-200">
          <div className="flex items-center gap-2 mb-1">
            <CheckCircle2 className="w-5 h-5 text-emerald-500" />
            <p className="text-xs text-slate-500">Ù†Ø§Ø¬Ø­</p>
          </div>
          <p className="text-2xl font-bold text-emerald-600">{stats.passed}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-red-200">
          <div className="flex items-center gap-2 mb-1">
            <XCircle className="w-5 h-5 text-red-500" />
            <p className="text-xs text-slate-500">ÙØ§Ø´Ù„</p>
          </div>
          <p className="text-2xl font-bold text-red-600">{stats.failed}</p>
        </div>

        <div className={`rounded-2xl p-4 border-2 ${stats.highFindings > 0 ? 'bg-orange-50 border-orange-300' : 'bg-white border-slate-200'}`}>
          <div className="flex items-center gap-2 mb-1">
            <AlertCircle className="w-5 h-5 text-orange-500" />
            <p className="text-xs text-slate-500">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙØªÙˆØ­Ø©</p>
          </div>
          <p className="text-2xl font-bold text-orange-600">{stats.openFindings}</p>
        </div>

        <div className="bg-white rounded-2xl p-4 border-2 border-slate-200">
          <div className="flex items-center gap-2 mb-1">
            <FileCheck className="w-5 h-5 text-slate-500" />
            <p className="text-xs text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
          </div>
          <p className="text-2xl font-bold text-slate-700">{stats.totalCases}</p>
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200 overflow-x-auto">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-5 py-4 font-bold transition-all border-b-2 whitespace-nowrap ${activeTab === tab.id ? 'text-purple-600 border-purple-500 bg-purple-50' : 'text-slate-500 border-transparent hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count !== null && tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: COMMAND CENTER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'command' && (
          <div className="p-6">
            <div className="grid grid-cols-3 gap-6">
              <div className="col-span-2 bg-slate-50 rounded-2xl p-5 border border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <BarChart3 className="w-5 h-5 text-purple-500" />
                  ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø©
                </h3>
                <div className="space-y-3">
                  {AUTHORITIES.slice(0, 5).map(auth => {
                    const authObligations = INITIAL_OBLIGATIONS.filter(o => o.authorityId === auth.id);
                    const testedObl = testCases.filter(tc => authObligations.some(o => o.id === tc.obligationId)).length;
                    const coverage = authObligations.length > 0 ? Math.round((testedObl / authObligations.length) * 100) : 0;
                    return (
                      <div key={auth.id}>
                        <div className="flex items-center justify-between mb-1">
                          <span className="text-sm font-medium text-slate-700">{auth.code}</span>
                          <span className="text-sm font-bold text-slate-800">{coverage}%</span>
                        </div>
                        <div className="h-3 bg-slate-200 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${coverage >= 80 ? 'bg-emerald-500' : coverage >= 50 ? 'bg-amber-500' : 'bg-red-500'}`}
                            style={{ width: `${coverage}%` }}></div>
                        </div> </div>);
                  })}
                </div>
                {stats.coveragePercent < 100 && (
                  <div className="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-xl">
                    <p className="text-sm text-amber-800 font-medium">
                      <AlertTriangle className="w-4 h-4 inline ml-1" />
                      ÙØ¬ÙˆØ© Ø¶Ù…Ø§Ù†: {stats.totalObligations - stats.testedObligations} Ø§Ù„ØªØ²Ø§Ù… Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªØ¨Ø§Ø±Ù‡
                    </p> </div>
                )}
              </div>

              <div className="space-y-4">
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                  <h3 className="font-bold mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                  <div className="space-y-2">
                    <button onClick={handleCreatePlan} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <FolderPlus className="w-5 h-5" /><span>Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø±</span>
                    </button>
                    <button onClick={() => handleCreateCase()} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <Plus className="w-5 h-5" /><span>Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</span>
                    </button>
                    <button onClick={() => handleCreateFinding()} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <AlertCircle className="w-5 h-5" /><span>ØªØ³Ø¬ÙŠÙ„ Ù…Ù„Ø§Ø­Ø¸Ø©</span>
                    </button> </div> </div>
                <div className="bg-amber-50 rounded-2xl p-5 border border-amber-200">
                  <h3 className="font-bold text-amber-800 mb-3 flex items-center gap-2">
                    <Eye className="w-5 h-5" />Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                  </h3>
                  {testCases.filter(tc => tc.status === 'Submitted').slice(0, 3).map(tc => (
                    <div key={tc.id} className="flex items-center justify-between py-2 border-b border-amber-200 last:border-0">
                      <div>
                        <p className="text-sm font-bold text-slate-800">{tc.code}</p>
                        <p className="text-xs text-slate-500">{tc.title?.substring(0, 30)}...</p>
                      </div>
                      {canReview(tc) && (
                        <button onClick={() => { setSelectedItem(tc); setActiveTab('execution'); }}
                          className="px-3 py-1 bg-amber-500 text-white rounded-lg text-xs font-bold">
                          Ù…Ø±Ø§Ø¬Ø¹Ø©
                        </button>
                      )}
                    </div>
                  ))}
                  {testCases.filter(tc => tc.status === 'Submitted').length === 0 && (
                    <p className="text-sm text-amber-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                  )}
                </div> </div> </div>
            <div className="mt-6">
              <h3 className="font-bold text-slate-800 mb-4">Ø£Ø­Ø¯Ø« Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
              <div className="grid grid-cols-4 gap-4">
                {testCases.slice(0, 4).map(tc => {
                  const plan = getPlan(tc.planId);
                  const template = getTemplate(tc.templateId);
                  const statusCfg = CASE_STATUS_CONFIG[tc.status];
                  const resultCfg = tc.overallResult ? RESULT_CONFIG[tc.overallResult] : null;
                  const StatusIcon = statusCfg?.icon || Clock;

                  return (
                    <div key={tc.id} className="bg-white rounded-xl border-2 border-slate-200 p-4 hover:shadow-lg cursor-pointer"
                      onClick={() => { setSelectedItem(tc); setActiveTab('execution'); }}>
                      <div className="flex items-start justify-between mb-3">
                        <span className="font-mono text-xs font-bold text-purple-600 bg-purple-50 px-2 py-0.5 rounded">{tc.code}</span>
                        <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                          <StatusIcon className="w-3 h-3" />{statusCfg?.label}
                        </span> </div>
                      <h4 className="font-bold text-slate-800 text-sm line-clamp-2 mb-2">{tc.title}</h4>
                      <div className="flex items-center gap-2 text-xs text-slate-500">
                        <span className="px-2 py-0.5 bg-slate-100 rounded">{template?.testType}</span>
                        <span>{plan?.periodKey}</span>
                      </div>
                      {resultCfg && (
                        <div className={`mt-3 px-3 py-1.5 rounded-lg text-xs font-bold text-center ${resultCfg.bg} ${resultCfg.text}`}>
                          {resultCfg.label}
                        </div>
                      )}
                    </div>);
                })}
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: TEST PLANS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'plans' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø®Ø·Ø·..." value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl w-64" />
                </div>
                <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                  className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  {Object.entries(PLAN_STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
                </select>
              </div>
              <button onClick={handleCreatePlan}
                className="flex items-center gap-2 px-4 py-2.5 bg-purple-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="grid grid-cols-3 gap-4">
              {testPlans.filter(p => {
                if (searchQuery && !p.title.toLowerCase().includes(searchQuery.toLowerCase()) && !p.code.toLowerCase().includes(searchQuery.toLowerCase())) return false;
                if (filterStatus && p.status !== filterStatus) return false;
                return true;
              }).map(plan => {
                const auth = getAuthority(plan.authorityId);
                const statusCfg = PLAN_STATUS_CONFIG[plan.status];
                const planCases = testCases.filter(tc => tc.planId === plan.id);
                const completedCases = planCases.filter(tc => tc.status === 'Reviewed' || tc.status === 'Closed').length;
                const progressPercent = plan.progress || (planCases.length > 0 ? Math.round((completedCases / planCases.length) * 100) : 0);

                return (
                  <div key={plan.id} className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:shadow-xl hover:border-purple-300 transition-all group">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex items-center gap-2 flex-wrap">
                        <span className="font-mono text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded-lg">{plan.code}</span>
                        {auth && (
                          <span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">{auth.code}</span>
                        )}
                      </div>
                      <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                        {statusCfg?.label}
                      </span> </div>
                    <h4 className="font-bold text-slate-800 mb-3 text-base leading-tight">{plan.title}</h4>

                    <div className="flex items-center gap-3 text-xs text-slate-500 mb-4 flex-wrap">
                      <span className="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded-lg">
                        <Calendar className="w-3.5 h-3.5" />{plan.periodKey}
                      </span>
                      <span className="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded-lg">
                        <FileCheck className="w-3.5 h-3.5" />{planCases.length} Ø§Ø®ØªØ¨Ø§Ø±
                      </span> </div>
                    <div className="mb-4">
                      <div className="flex items-center justify-between text-xs mb-1.5">
                        <span className="text-slate-500 font-medium">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                        <span className={`font-bold ${progressPercent === 100 ? 'text-emerald-600' : progressPercent > 50 ? 'text-blue-600' : 'text-slate-600'}`}>
                          {progressPercent}%
                        </span> </div>
                      <div className="h-2.5 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full transition-all ${progressPercent === 100 ? 'bg-emerald-500' : progressPercent > 50 ? 'bg-blue-500' : 'bg-purple-500'
                          }`} style={{ width: `${progressPercent}%` }}></div>
                      </div> </div>
                    <div className="grid grid-cols-4 gap-2">
                      <button onClick={() => { setFormData(plan); setModalType('plan'); setModalMode('view'); setShowModal(true); }}
                        className="flex flex-col items-center justify-center gap-1 p-2.5 bg-blue-50 text-blue-700 rounded-xl text-xs font-bold hover:bg-blue-100 transition-all">
                        <Eye className="w-4 h-4" />
                        <span>Ø§Ø³ØªØ¹Ø±Ø§Ø¶</span>
                      </button>
                      <button onClick={() => { setFormData(plan); setModalType('plan'); setModalMode('edit'); setShowModal(true); setExecutionStep(0); }}
                        className="flex flex-col items-center justify-center gap-1 p-2.5 bg-amber-50 text-amber-700 rounded-xl text-xs font-bold hover:bg-amber-100 transition-all">
                        <Edit className="w-4 h-4" />
                        <span>ØªØ¹Ø¯ÙŠÙ„</span>
                      </button>
                      <button onClick={() => handleCreateCase(plan.id)}
                        className="flex flex-col items-center justify-center gap-1 p-2.5 bg-emerald-50 text-emerald-700 rounded-xl text-xs font-bold hover:bg-emerald-100 transition-all">
                        <Plus className="w-4 h-4" />
                        <span>Ø§Ø®ØªØ¨Ø§Ø±</span>
                      </button>
                      <button onClick={() => { setDeleteTarget({ type: 'plan', id: plan.id, code: plan.code, title: plan.title }); setShowDeleteConfirm(true); }}
                        className="flex flex-col items-center justify-center gap-1 p-2.5 bg-red-50 text-red-600 rounded-xl text-xs font-bold hover:bg-red-100 transition-all">
                        <Trash2 className="w-4 h-4" />
                        <span>Ø­Ø°Ù</span>
                      </button> </div> </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: TEST CASES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'cases' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl w-64" />
                </div>
                <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                  className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  {Object.entries(CASE_STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
                </select>
                <select value={filterTester} onChange={(e) => setFilterTester(e.target.value)}
                  className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙŠÙ†</option>
                  {TESTERS.map(t => <option key={t.id} value={t.id}>{t.name}</option>)}
                </select>
              </div>
              <button onClick={() => handleCreateCase()}
                className="flex items-center gap-2 px-4 py-2.5 bg-purple-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="bg-slate-50 border-b-2 border-slate-200">
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ù‚Ø§Ù„Ø¨</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ù…Ø®ØªØ¨Ø±</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th className="text-center px-3 py-3 font-bold text-slate-700">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700 w-40">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr> </thead>
                <tbody>
                  {testCases.filter(tc => {
                    if (searchQuery && !tc.title?.toLowerCase().includes(searchQuery.toLowerCase()) && !tc.code?.toLowerCase().includes(searchQuery.toLowerCase())) return false;
                    if (filterStatus && tc.status !== filterStatus) return false;
                    if (filterTester && tc.testerId !== parseInt(filterTester)) return false;
                    return true;
                  }).map(tc => {
                    const template = getTemplate(tc.templateId);
                    const tester = getUser(tc.testerId);
                    const statusCfg = CASE_STATUS_CONFIG[tc.status];
                    const resultCfg = tc.overallResult ? RESULT_CONFIG[tc.overallResult] : null;
                    const StatusIcon = statusCfg?.icon || Clock;
                    const daysUntil = getDaysUntilDue(tc.dueDate);

                    return (
                      <tr key={tc.id} className="border-b border-slate-100 hover:bg-slate-50">
                        <td className="px-4 py-4">
                          <span className="font-mono text-sm font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded">{tc.code}</span>
                        </td>
                        <td className="px-4 py-4">
                          <p className="font-medium text-slate-800 line-clamp-1">{tc.title}</p>
                          <p className="text-xs text-slate-500">{getPlan(tc.planId)?.periodKey}</p>
                        </td>
                        <td className="px-3 py-4 text-center">
                          <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{template?.testType}</span>
                        </td>
                        <td className="px-3 py-4 text-center">
                          <div className="flex items-center justify-center gap-2">
                            <div className="w-7 h-7 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-bold">
                              {tester?.name?.charAt(0)}
                            </div>
                            <span className="text-sm">{tester?.name?.split(' ')[0]}</span>
                          </div> </td>
                        <td className="px-3 py-4 text-center">
                          <div className="text-sm text-slate-700">{tc.dueDate}</div>
                          {daysUntil !== null && tc.status !== 'Reviewed' && tc.status !== 'Closed' && (
                            <span className={`text-xs font-bold ${daysUntil < 0 ? 'text-red-600' : daysUntil <= 7 ? 'text-amber-600' : 'text-emerald-600'}`}>
                              {daysUntil < 0 ? `Ù…ØªØ£Ø®Ø± ${Math.abs(daysUntil)} ÙŠÙˆÙ…` : `${daysUntil} ÙŠÙˆÙ…`}
                            </span>
                          )}
                        </td>
                        <td className="px-3 py-4 text-center">
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                            <StatusIcon className="w-3.5 h-3.5" />{statusCfg?.label}
                          </span> </td>
                        <td className="px-3 py-4 text-center">
                          {resultCfg ? (
                            <span className={`px-2 py-1 rounded-lg text-xs font-bold ${resultCfg.bg} ${resultCfg.text}`}>
                              {resultCfg.label}
                            </span>
                          ) : (
                            <span className="text-slate-400">-</span>
                          )}
                        </td>
                        <td className="px-4 py-4">
                          <div className="flex items-center justify-center gap-1">
                            <button onClick={() => { setSelectedItem(tc); setActiveTab('execution'); }}
                              className="p-2 hover:bg-blue-50 rounded-lg" title="ØªÙ†ÙÙŠØ°">
                              <Play className="w-4 h-4 text-blue-500" />
                            </button>
                            <button onClick={() => { setFormData(tc); setModalType('case'); setModalMode('edit'); setShowModal(true); }}
                              className="p-2 hover:bg-amber-50 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                              <Edit className="w-4 h-4 text-amber-500" />
                            </button>
                            <button onClick={() => { setDeleteTarget(tc); setModalType('case'); setShowDeleteConfirm(true); }}
                              className="p-2 hover:bg-red-50 rounded-lg" title="Ø­Ø°Ù">
                              <Trash2 className="w-4 h-4 text-red-500" />
                            </button> </div> </td> </tr>);
                  })}
                </tbody> </table> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: EXECUTION WORKSPACE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'execution' && (
          <div className="p-6">
            {selectedItem ? (
              <div className="space-y-6">
                <div className={`rounded-2xl p-5 ${selectedItem.overallResult === 'Pass' ? 'bg-emerald-50 border-2 border-emerald-200' :
                  selectedItem.overallResult === 'Fail' ? 'bg-red-50 border-2 border-red-200' :
                    selectedItem.overallResult === 'Partial' ? 'bg-amber-50 border-2 border-amber-200' :
                      'bg-slate-50 border-2 border-slate-200'
                  }`}>
                  <div className="flex items-start justify-between">
                    <div>
                      <div className="flex items-center gap-3 mb-2">
                        <span className="font-mono text-lg font-bold text-purple-600 bg-purple-100 px-3 py-1 rounded-lg">{selectedItem.code}</span>
                        <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-sm font-bold ${CASE_STATUS_CONFIG[selectedItem.status]?.bg} ${CASE_STATUS_CONFIG[selectedItem.status]?.text}`}>
                          {CASE_STATUS_CONFIG[selectedItem.status]?.label}
                        </span>
                        {selectedItem.overallResult && (
                          <span className={`px-3 py-1 rounded-lg text-sm font-bold ${RESULT_CONFIG[selectedItem.overallResult]?.bg} ${RESULT_CONFIG[selectedItem.overallResult]?.text}`}>
                            {RESULT_CONFIG[selectedItem.overallResult]?.label}
                          </span>
                        )}
                      </div>
                      <h2 className="text-xl font-bold text-slate-800">{selectedItem.title}</h2>
                      <div className="flex items-center gap-4 mt-2 text-sm text-slate-600">
                        <span>Ø§Ù„Ù…Ø®ØªØ¨Ø±: <strong>{getUser(selectedItem.testerId)?.name}</strong></span>
                        <span>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹: <strong>{getUser(selectedItem.reviewerId)?.name}</strong></span>
                        <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <strong>{selectedItem.dueDate}</strong></span>
                      </div> </div>
                    <div className="flex items-center gap-2">
                      {selectedItem.status === 'NotStarted' && selectedItem.testerId === CURRENT_USER.id && (
                        <button onClick={() => handleStartExecution(selectedItem)}
                          className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold">
                          <Play className="w-5 h-5" />Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°
                        </button>
                      )}
                      {selectedItem.status === 'InProgress' && selectedItem.testerId === CURRENT_USER.id && (
                        <button onClick={() => handleSubmitForReview(selectedItem)}
                          className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold">
                          <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                        </button>
                      )}
                      {selectedItem.status === 'Submitted' && canReview(selectedItem) && (
                        <>
                          <button onClick={() => handleReturnForRevision(selectedItem)}
                            className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-xl font-bold">
                            <RotateCcw className="w-5 h-5" />Ø¥Ø±Ø¬Ø§Ø¹
                          </button>
                          <button onClick={() => handleApproveReview(selectedItem)}
                            className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold">
                            <CheckCircle2 className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯
                          </button>
                        </>
                      )}
                      <button onClick={() => setSelectedItem(null)}
                        className="p-2 hover:bg-slate-200 rounded-xl">
                        <X className="w-5 h-5 text-slate-500" />
                      </button> </div> </div> </div>
                <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className="px-5 py-4 bg-slate-50 border-b-2 border-slate-200">
                    <h3 className="font-bold text-slate-800">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                  </div>
                  <div className="divide-y divide-slate-100">
                    {getTemplate(selectedItem.templateId)?.steps.map((step, idx) => {
                      const stepResult = selectedItem.stepResults?.find(sr => sr.stepId === step.id);
                      const canEdit = selectedItem.status === 'InProgress' && selectedItem.testerId === CURRENT_USER.id;

                      return (
                        <div key={step.id} className={`p-5 ${stepResult?.result === 'Fail' ? 'bg-red-50' : stepResult?.result === 'Pass' ? 'bg-emerald-50' : ''}`}>
                          <div className="flex items-start gap-4">
                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold text-lg shrink-0 ${stepResult?.result === 'Pass' ? 'bg-emerald-500 text-white' :
                              stepResult?.result === 'Fail' ? 'bg-red-500 text-white' :
                                stepResult?.result === 'Partial' ? 'bg-amber-500 text-white' :
                                  stepResult?.result === 'N/A' ? 'bg-slate-400 text-white' :
                                    'bg-slate-200 text-slate-600'
                              }`}>
                              {stepResult?.result === 'Pass' ? <CheckCircle2 className="w-6 h-6" /> :
                                stepResult?.result === 'Fail' ? <XCircle className="w-6 h-6" /> :
                                  stepResult?.result === 'N/A' ? <MinusCircle className="w-6 h-6" /> :
                                    step.stepNo}
                            </div>
                            <div className="flex-1">
                              <div className="flex items-start justify-between">
                                <div>
                                  <h4 className="font-bold text-slate-800 flex items-center gap-2">
                                    {step.instruction}
                                    {step.isMandatory && <span className="px-1.5 py-0.5 bg-red-100 text-red-600 text-xs rounded">Ø¥Ù„Ø²Ø§Ù…ÙŠ</span>}
                                  </h4>
                                  <p className="text-sm text-slate-500 mt-1">Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: {step.expectedEvidence}</p>
                                  <p className="text-sm text-slate-500">Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­: {step.passFailCriteria}</p>
                                </div>
                                {canEdit && (
                                  <div className="flex items-center gap-2">
                                    {['Pass', 'Fail', 'Partial', 'N/A'].map(result => {
                                      const cfg = RESULT_CONFIG[result];
                                      return (
                                        <button key={result}
                                          onClick={() => handleUpdateStepResult(selectedItem.id, step.id, result, stepResult?.comment || '')}
                                          className={`px-3 py-1.5 rounded-lg text-xs font-bold border-2 transition-all ${stepResult?.result === result ? `${cfg.bg} ${cfg.text} ${cfg.border}` : 'bg-white border-slate-200 text-slate-600 hover:border-slate-400'
                                            }`}>
                                          {cfg.label}
                                        </button>);
                                    })}
                                  </div>
                                )}
                              </div>
                              {(stepResult?.comment || canEdit) && (
                                <div className="mt-3">
                                  {canEdit ? (
                                    <textarea
                                      placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø©..."
                                      value={stepResult?.comment || ''}
                                      onChange={(e) => handleUpdateStepResult(selectedItem.id, step.id, stepResult?.result, e.target.value)}
                                      className="w-full px-4 py-2 border-2 border-slate-200 rounded-xl text-sm resize-none focus:border-purple-400"
                                      rows={2}
                                    />
                                  ) : stepResult?.comment && (
                                    <p className="text-sm text-slate-600 bg-slate-100 rounded-lg p-3">{stepResult.comment}</p>
                                  )}
                                </div>
                              )}
                            </div> </div> </div>);
                    })}
                  </div> </div>
                <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className="px-5 py-4 bg-slate-50 border-b-2 border-slate-200 flex items-center justify-between">
                    <h3 className="font-bold text-slate-800">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
                    <button onClick={() => handleCreateFinding(selectedItem.id)}
                      className="flex items-center gap-1 px-3 py-1.5 bg-orange-100 text-orange-700 rounded-lg text-sm font-bold">
                      <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©
                    </button> </div>
                  <div className="p-5">
                    {findings.filter(f => f.testCaseId === selectedItem.id).length > 0 ? (
                      <div className="space-y-3">
                        {findings.filter(f => f.testCaseId === selectedItem.id).map(finding => {
                          const severityCfg = SEVERITY_CONFIG[finding.severity];
                          const statusCfg = FINDING_STATUS_CONFIG[finding.status];
                          return (
                            <div key={finding.id} className={`rounded-xl border-2 p-4 ${severityCfg?.border}`}>
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="flex items-center gap-2 mb-1">
                                    <span className="font-mono text-xs font-bold text-orange-600">{finding.code}</span>
                                    <span className={`px-2 py-0.5 rounded text-xs font-bold ${severityCfg?.bg} ${severityCfg?.text}`}>{severityCfg?.label}</span>
                                    <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>{statusCfg?.label}</span>
                                  </div>
                                  <h4 className="font-bold text-slate-800">{finding.title}</h4>
                                  <p className="text-sm text-slate-600 mt-1">{finding.description}</p>
                                </div>
                                {finding.status === 'Open' && (
                                  <button onClick={() => handleConvertToCAPA(finding)}
                                    className="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-bold">
                                    ØªØ­ÙˆÙŠÙ„ Ù„Ù€ CAPA
                                  </button>
                                )}
                              </div> </div>);
                        })}
                      </div>
                    ) : (
                      <p className="text-center text-slate-500 py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
                    )}
                  </div> </div> </div>
            ) : (
              <div className="text-center py-16">
                <Play className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                <h3 className="text-xl font-bold text-slate-600">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <p className="text-slate-500 mt-2">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
            )}
          </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: FINDINGS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'findings' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                  className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  {Object.entries(FINDING_STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
                </select>
              </div>
              <button onClick={() => handleCreateFinding()}
                className="flex items-center gap-2 px-4 py-2.5 bg-orange-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="space-y-4">
              {findings.filter(f => !filterStatus || f.status === filterStatus).map(finding => {
                const tc = testCases.find(t => t.id === finding.testCaseId);
                const severityCfg = SEVERITY_CONFIG[finding.severity];
                const statusCfg = FINDING_STATUS_CONFIG[finding.status];
                const typeCfg = FINDING_TYPE_CONFIG[finding.findingType];
                const TypeIcon = typeCfg?.icon || AlertCircle;

                return (
                  <div key={finding.id} className={`bg-white rounded-xl border-2 p-5 hover:shadow-lg ${severityCfg?.border}`}>
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-2">
                          <span className="font-mono text-sm font-bold text-orange-600 bg-orange-50 px-2 py-0.5 rounded">{finding.code}</span>
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${severityCfg?.bg} ${severityCfg?.text}`}>{severityCfg?.label}</span>
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>{statusCfg?.label}</span>
                          <span className="flex items-center gap-1 px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">
                            <TypeIcon className="w-3 h-3" />{typeCfg?.label}
                          </span> </div>
                        <h4 className="font-bold text-slate-800 text-lg">{finding.title}</h4>
                        <p className="text-slate-600 mt-1">{finding.description}</p>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                          <div>
                            <p className="text-slate-500">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ:</p>
                            <p className="text-slate-700">{finding.rootCause || '-'}</p>
                          </div>
                          <div>
                            <p className="text-slate-500">Ø§Ù„ØªÙˆØµÙŠØ©:</p>
                            <p className="text-slate-700">{finding.recommendation || '-'}</p>
                          </div> </div>
                        <div className="mt-3 flex items-center gap-4 text-xs text-slate-500">
                          <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: <strong className="text-purple-600">{tc?.code}</strong></span>
                          <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: <strong>{getUser(finding.responsibleId)?.name}</strong></span>
                          <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <strong>{finding.dueDate}</strong></span>
                        </div> </div>
                      <div className="flex flex-col gap-2">
                        {finding.status === 'Open' && (
                          <button onClick={() => handleConvertToCAPA(finding)}
                            className="flex items-center gap-1 px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-bold">
                            <GitBranch className="w-4 h-4" />ØªØ­ÙˆÙŠÙ„ Ù„Ù€ CAPA
                          </button>
                        )}
                        <button onClick={() => { setFormData(finding); setModalType('finding'); setModalMode('edit'); setShowModal(true); }}
                          className="flex items-center gap-1 px-3 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold">
                          <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                        </button> </div> </div> </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: TEMPLATES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'templates' && (
          <div className="p-6">
            <div className="grid grid-cols-2 gap-4">
              {testTemplates.map(template => {
                const typeCfg = TEST_TYPE_CONFIG[template.testType];
                const TypeIcon = typeCfg?.icon || FileText;
                return (
                  <div key={template.id} className="bg-white rounded-xl border-2 border-slate-200 p-5">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl bg-${typeCfg?.color}-100 flex items-center justify-center`}>
                          <TypeIcon className={`w-5 h-5 text-${typeCfg?.color}-600`} />
                        </div>
                        <div>
                          <span className="font-mono text-xs font-bold text-purple-600">{template.code}</span>
                          <h4 className="font-bold text-slate-800">{template.title}</h4>
                        </div> </div>
                      <span className={`px-2 py-0.5 rounded text-xs font-bold bg-${typeCfg?.color}-100 text-${typeCfg?.color}-700`}>
                        {typeCfg?.label}
                      </span> </div>
                    <p className="text-sm text-slate-600 mb-3">{template.objective}</p>
                    <div className="flex items-center gap-4 text-xs text-slate-500">
                      <span>Ø§Ù„Ø¹ÙŠÙ†Ø©: {template.sampleMethod}</span>
                      <span>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: {template.defaultSampleSize}</span>
                      <span>{template.stepCount} Ø®Ø·ÙˆØ§Øª</span>
                    </div>
                    <div className="mt-4 pt-4 border-t border-slate-100">
                      <p className="text-xs font-bold text-slate-700 mb-2">Ø§Ù„Ø®Ø·ÙˆØ§Øª:</p>
                      <div className="space-y-1">
                        {template.steps.slice(0, 3).map(step => (
                          <div key={step.id} className="flex items-center gap-2 text-xs">
                            <span className="w-5 h-5 rounded bg-slate-100 flex items-center justify-center font-bold">{step.stepNo}</span>
                            <span className="text-slate-600 truncate">{step.instruction}</span>
                            {step.isMandatory && <span className="px-1 py-0.5 bg-red-100 text-red-600 rounded text-[10px]">Ø¥Ù„Ø²Ø§Ù…ÙŠ</span>}
                          </div>
                        ))}
                        {template.steps.length > 3 && (
                          <p className="text-xs text-slate-400">+{template.steps.length - 3} Ø®Ø·ÙˆØ§Øª Ø£Ø®Ø±Ù‰</p>
                        )}
                      </div> </div> </div>);
              })}
            </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          MODALS
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          WORLD-CLASS MODALS WITH WIZARD
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden">

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                PLAN WIZARD MODAL - Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - ULTIMATE 10-STEP EDITION
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {modalType === 'plan' && (
              <>
                <div className="bg-gradient-to-l from-indigo-600 via-purple-600 to-violet-700 px-6 py-5 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                        <FolderPlus className="w-7 h-7" />
                      </div>
                      <div>
                        <h2 className="text-xl font-black">{modalMode === 'create' ? 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø±' : 'ØªØ¹Ø¯ÙŠÙ„ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'}</h2>
                        <p className="text-purple-200 font-mono text-sm">{formData.code}</p>
                      </div> </div>
                    <div className="flex items-center gap-3">
                      <div className="relative w-16 h-16">
                        <svg className="w-16 h-16 transform -rotate-90">
                          <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.2)" strokeWidth="4" fill="none" />
                          <circle cx="32" cy="32" r="28" stroke="white" strokeWidth="4" fill="none"
                            strokeDasharray={`${(executionStep / 9) * 176} 176`} strokeLinecap="round" />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <span className="text-lg font-black">{executionStep + 1}/10</span>
                        </div> </div>
                      <button onClick={() => { setShowModal(false); setExecutionStep(0); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                        <X className="w-5 h-5" />
                      </button> </div> </div>
                  <div className="grid grid-cols-10 gap-1">
                    {[
                      { step: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                      { step: 1, label: 'Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©', icon: Calendar },
                      { step: 2, label: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: Building2 },
                      { step: 3, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©', icon: ClipboardCheck },
                      { step: 4, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Shield },
                      { step: 5, label: 'Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardList },
                      { step: 6, label: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„', icon: Users },
                      { step: 7, label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', icon: Clock },
                      { step: 8, label: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', icon: DollarSign },
                      { step: 9, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', icon: CheckCircle2 },
                    ].map((s) => (
                      <button key={s.step} onClick={() => setExecutionStep(s.step)}
                        className={`flex flex-col items-center p-2 rounded-xl transition-all ${executionStep === s.step ? 'bg-white text-purple-600' :
                          executionStep > s.step ? 'bg-emerald-400/40 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-1 ${executionStep === s.step ? 'bg-purple-100' :
                          executionStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {executionStep > s.step ? <Check className="w-4 h-4" /> : <s.icon className="w-4 h-4" />}
                        </div>
                        <span className="text-[9px] font-bold text-center leading-tight">{s.label}</span>
                      </button>
                    ))}
                  </div> </div>
                <div className="p-6 max-h-[50vh] overflow-y-auto">

                  {executionStep === 0 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl p-5 border-2 border-purple-200">
                        <h3 className="text-lg font-black text-purple-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm">1</span>
                          <FileText className="w-5 h-5" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø·Ø© *</label>
                            <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl text-lg font-bold focus:border-purple-500 focus:outline-none"
                              placeholder="Ù…Ø«Ø§Ù„: Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ 2025" />
                          </div>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø©</label>
                              <div className="grid grid-cols-2 gap-2">
                                {[
                                  { value: 'Quarterly', label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©', icon: 'ğŸ“…' },
                                  { value: 'Annual', label: 'Ø³Ù†ÙˆÙŠØ©', icon: 'ğŸ“†' },
                                  { value: 'AdHoc', label: 'Ø®Ø§ØµØ©', icon: 'ğŸ¯' },
                                  { value: 'Continuous', label: 'Ù…Ø³ØªÙ…Ø±Ø©', icon: 'ğŸ”„' },
                                ].map(type => (
                                  <button key={type.value} type="button" onClick={() => setFormData({ ...formData, planType: type.value })}
                                    className={`p-3 rounded-xl border-2 transition-all ${formData.planType === type.value ? 'border-purple-500 bg-purple-50' : 'border-slate-200 hover:border-slate-300'}`}>
                                    <span className="text-xl">{type.icon}</span>
                                    <p className="text-xs font-bold mt-1">{type.label}</p>
                                  </button>
                                ))}
                              </div> </div>
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                              <div className="flex gap-1">
                                {[
                                  { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                                  { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                                  { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                                  { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                                ].map(pri => (
                                  <button key={pri.value} type="button" onClick={() => setFormData({ ...formData, priority: pri.value })}
                                    className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${formData.priority === pri.value ? `bg-${pri.color}-500 text-white` : `bg-${pri.color}-50 text-${pri.color}-700`}`}>
                                    {pri.label}
                                  </button>
                                ))}
                              </div> </div> </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„Ø®Ø·Ø©</label>
                            <textarea rows={2} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none resize-none"
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆÙ†Ø·Ø§Ù‚ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±..." />
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 1 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                        <h3 className="text-lg font-black text-blue-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm">2</span>
                          <Calendar className="w-5 h-5" />Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</label>
                            <div className="grid grid-cols-5 gap-3">
                              {[
                                { key: 'Q1-2025', label: 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„', sub: 'Q1 2025', icon: 'ğŸŒ¸', months: 'ÙŠÙ†Ø§ÙŠØ± - Ù…Ø§Ø±Ø³' },
                                { key: 'Q2-2025', label: 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', sub: 'Q2 2025', icon: 'â˜€ï¸', months: 'Ø£Ø¨Ø±ÙŠÙ„ - ÙŠÙˆÙ†ÙŠÙˆ' },
                                { key: 'Q3-2025', label: 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«', sub: 'Q3 2025', icon: 'ğŸ‚', months: 'ÙŠÙˆÙ„ÙŠÙˆ - Ø³Ø¨ØªÙ…Ø¨Ø±' },
                                { key: 'Q4-2025', label: 'Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹', sub: 'Q4 2025', icon: 'â„ï¸', months: 'Ø£ÙƒØªÙˆØ¨Ø± - Ø¯ÙŠØ³Ù…Ø¨Ø±' },
                                { key: '2025', label: 'Ø³Ù†ÙˆÙŠ ÙƒØ§Ù…Ù„', sub: '2025', icon: 'ğŸ“…', months: 'Ø§Ù„Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©' },
                              ].map(period => (
                                <button key={period.key} onClick={() => setFormData({ ...formData, periodKey: period.key })}
                                  className={`p-4 rounded-xl border-2 transition-all text-center ${formData.periodKey === period.key ? 'border-blue-500 bg-blue-50 shadow-lg' : 'border-slate-200 hover:border-blue-300'
                                    }`}>
                                  <div className="text-3xl mb-2">{period.icon}</div>
                                  <p className="font-bold text-slate-800 text-sm">{period.label}</p>
                                  <p className="text-xs text-slate-500">{period.sub}</p>
                                  <p className="text-[10px] text-blue-600 mt-1">{period.months}</p>
                                </button>
                              ))}
                            </div> </div>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                              <input type="date" value={formData.startDate || ''} onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                                className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                            </div>
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                              <input type="date" value={formData.endDate || ''} onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}
                                className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none" />
                            </div> </div> </div> </div> </div>
                  )}

                  {executionStep === 2 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                        <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">3</span>
                          <Building2 className="w-5 h-5" />Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                        </h3>
                        <p className="text-sm text-emerald-600 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© (ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø¬Ù‡Ø©)</p>
                        <div className="grid grid-cols-4 gap-3">
                          {[
                            { id: 'SAMA', code: 'SA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', color: 'emerald' },
                            { id: 'CMA', code: 'CM', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', color: 'blue' },
                            { id: 'NCA', code: 'NC', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', color: 'purple' },
                            { id: 'SDAIA', code: 'SD', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', color: 'indigo' },
                            { id: 'ZATCA', code: 'ZA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', color: 'amber' },
                            { id: 'CCHI', code: 'CC', name: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', color: 'teal' },
                            { id: 'HRSD', code: 'HR', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'rose' },
                            { id: 'ALL', code: 'Ø§Ù„ÙƒÙ„', name: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª', color: 'slate' },
                          ].map(auth => (
                            <button key={auth.id} type="button" onClick={() => setFormData({ ...formData, authorityId: auth.id })}
                              className={`p-3 rounded-xl border-2 transition-all text-center ${formData.authorityId === auth.id ? `border-${auth.color}-500 bg-${auth.color}-100` : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className={`w-10 h-10 rounded-lg mx-auto mb-2 flex items-center justify-center font-black ${formData.authorityId === auth.id ? `bg-${auth.color}-500 text-white` : 'bg-slate-100 text-slate-600'
                                }`}>{auth.code}</div>
                              <p className="text-xs font-bold text-slate-700">{auth.name}</p>
                            </button>
                          ))}
                        </div> </div> </div>
                  )}

                  {executionStep === 3 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                        <h3 className="text-lg font-black text-amber-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center text-sm">4</span>
                          <ClipboardCheck className="w-5 h-5" />Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
                        </h3>
                        <div className="flex items-center justify-between mb-3">
                          <div className="relative flex-1 ml-4">
                            <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                            <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª..." className="w-full pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl" />
                          </div>
                          <button className="px-4 py-2 bg-amber-500 text-white rounded-xl font-bold text-sm">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                        </div>
                        <div className="max-h-48 overflow-y-auto space-y-2">
                          {INITIAL_OBLIGATIONS.map(obl => {
                            const isSelected = formData.targetObligations?.includes(obl.id);
                            return (
                              <div key={obl.id} onClick={() => {
                                const current = formData.targetObligations || [];
                                const updated = isSelected ? current.filter(id => id !== obl.id) : [...current, obl.id];
                                setFormData({ ...formData, targetObligations: updated });
                              }}
                                className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-amber-500 bg-amber-100' : 'border-slate-200 hover:border-amber-300'}`}>
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center gap-2">
                                    <input type="checkbox" checked={isSelected} readOnly className="w-4 h-4 rounded text-amber-500" />
                                    <span className="font-mono text-xs font-bold text-amber-600">{obl.code}</span>
                                  </div>
                                  {isSelected && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                                </div>
                                <p className="font-medium text-slate-800 text-sm mt-1">{obl.title}</p>
                              </div>);
                          })}
                        </div>
                        <div className="mt-3 p-2 bg-white rounded-lg border">
                          <p className="text-sm text-slate-600">Ø§Ù„Ù…Ø­Ø¯Ø¯: <strong className="text-amber-600">{formData.targetObligations?.length || 0}</strong> Ø§Ù„ØªØ²Ø§Ù…</p>
                        </div> </div> </div>
                  )}

                  {executionStep === 4 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-2xl p-5 border-2 border-indigo-200">
                        <h3 className="text-lg font-black text-indigo-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-indigo-500 text-white rounded-lg flex items-center justify-center text-sm">5</span>
                          <Shield className="w-5 h-5" />Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
                        </h3>
                        <div className="max-h-52 overflow-y-auto space-y-2">
                          {CONTROLS.map(ctrl => {
                            const isSelected = formData.targetControls?.includes(ctrl.id);
                            return (
                              <div key={ctrl.id} onClick={() => {
                                const current = formData.targetControls || [];
                                const updated = isSelected ? current.filter(id => id !== ctrl.id) : [...current, ctrl.id];
                                setFormData({ ...formData, targetControls: updated });
                              }}
                                className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-indigo-500 bg-indigo-100' : 'border-slate-200 hover:border-indigo-300'}`}>
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center gap-2">
                                    <input type="checkbox" checked={isSelected} readOnly className="w-4 h-4 rounded text-indigo-500" />
                                    <span className="font-mono text-xs font-bold text-indigo-600">{ctrl.code}</span>
                                  </div>
                                  {isSelected && <CheckCircle2 className="w-4 h-4 text-indigo-500" />}
                                </div>
                                <p className="text-sm text-slate-700 mt-1">{ctrl.title}</p>
                              </div>);
                          })}
                        </div>
                        <div className="mt-3 p-2 bg-white rounded-lg border">
                          <p className="text-sm text-slate-600">Ø§Ù„Ù…Ø­Ø¯Ø¯: <strong className="text-indigo-600">{formData.targetControls?.length || 0}</strong> Ø¶Ø§Ø¨Ø·</p>
                        </div> </div> </div>
                  )}

                  {executionStep === 5 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-violet-50 to-purple-50 rounded-2xl p-5 border-2 border-violet-200">
                        <h3 className="text-lg font-black text-violet-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-violet-500 text-white rounded-lg flex items-center justify-center text-sm">6</span>
                          <ClipboardList className="w-5 h-5" />Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                        </h3>
                        <div className="grid grid-cols-2 gap-3">
                          {testTemplates.map(template => {
                            const isSelected = formData.selectedTemplates?.includes(template.id);
                            return (
                              <div key={template.id} onClick={() => {
                                const current = formData.selectedTemplates || [];
                                const updated = isSelected ? current.filter(id => id !== template.id) : [...current, template.id];
                                setFormData({ ...formData, selectedTemplates: updated });
                              }}
                                className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-violet-500 bg-violet-100' : 'border-slate-200 hover:border-violet-300'}`}>
                                <div className="flex items-start justify-between mb-2">
                                  <input type="checkbox" checked={isSelected} readOnly className="w-4 h-4 rounded text-violet-500 mt-1" />
                                  {isSelected && <CheckCircle2 className="w-5 h-5 text-violet-500" />}
                                </div>
                                <span className="font-mono text-xs font-bold text-violet-600">{template.code}</span>
                                <h4 className="font-bold text-slate-800 text-sm mt-1">{template.title}</h4>
                                <div className="flex items-center gap-2 mt-2 text-xs text-slate-500">
                                  <span className="px-2 py-0.5 bg-slate-100 rounded">{template.stepCount} Ø®Ø·ÙˆØ§Øª</span>
                                </div> </div>);
                          })}
                        </div> </div> </div>
                  )}

                  {executionStep === 6 && (
                    <div className="grid grid-cols-2 gap-5">
                      <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                        <h3 className="text-base font-black text-blue-800 mb-3 flex items-center gap-2">
                          <User className="w-5 h-5" />Ù…Ø¯ÙŠØ± Ø§Ù„Ø®Ø·Ø©
                        </h3>
                        <div className="space-y-2">
                          {TESTERS.map(user => (
                            <div key={user.id} onClick={() => setFormData({ ...formData, managerId: user.id })}
                              className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.managerId === user.id ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'}`}>
                              <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.managerId === user.id ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                                {user.name.charAt(0)}
                              </div>
                              <div className="flex-1">
                                <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                                <p className="text-xs text-slate-500">{user.role}</p>
                              </div>
                              {formData.managerId === user.id && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                            </div>
                          ))}
                        </div> </div>
                      <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                        <h3 className="text-base font-black text-emerald-800 mb-3 flex items-center gap-2">
                          <Users className="w-5 h-5" />ÙØ±ÙŠÙ‚ Ø§Ù„ØªÙ†ÙÙŠØ°
                        </h3>
                        <div className="space-y-2">
                          {TESTERS.map(user => {
                            const isSelected = formData.teamMembers?.includes(user.id);
                            return (
                              <div key={user.id} onClick={() => {
                                const current = formData.teamMembers || [];
                                const updated = isSelected ? current.filter(id => id !== user.id) : [...current, user.id];
                                setFormData({ ...formData, teamMembers: updated });
                              }}
                                className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300'}`}>
                                <input type="checkbox" checked={isSelected} readOnly className="w-4 h-4 rounded text-emerald-500" />
                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${isSelected ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                                  {user.name.charAt(0)}
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                                  <p className="text-xs text-slate-500">{user.role}</p>
                                </div> </div>);
                          })}
                        </div> </div> </div>
                  )}

                  {executionStep === 7 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl p-5 border-2 border-cyan-200">
                        <h3 className="text-lg font-black text-cyan-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-cyan-500 text-white rounded-lg flex items-center justify-center text-sm">8</span>
                          <Clock className="w-5 h-5" />Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                        </h3>
                        <div className="grid grid-cols-3 gap-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                            <input type="date" value={formData.executionStart || ''} onChange={(e) => setFormData({ ...formData, executionStart: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
                            <input type="date" value={formData.targetDelivery || ''} onChange={(e) => setFormData({ ...formData, targetDelivery: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø© (Ø£ÙŠØ§Ù…)</label>
                            <input type="number" value={formData.estimatedDays || 30} onChange={(e) => setFormData({ ...formData, estimatedDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div> </div>
                        <div className="grid grid-cols-2 gap-4 mt-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</label>
                            <select value={formData.reminderDays || 7} onChange={(e) => setFormData({ ...formData, reminderDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl">
                              <option value={3}>Ù‚Ø¨Ù„ 3 Ø£ÙŠØ§Ù…</option>
                              <option value={7}>Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹</option>
                              <option value={14}>Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</label>
                            <select value={formData.reviewFrequency || 'weekly'} onChange={(e) => setFormData({ ...formData, reviewFrequency: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl">
                              <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                              <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                              <option value="biweekly">ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                            </select>
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 8 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-rose-50 to-pink-50 rounded-2xl p-5 border-2 border-rose-200">
                        <h3 className="text-lg font-black text-rose-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-rose-500 text-white rounded-lg flex items-center justify-center text-sm">9</span>
                          <DollarSign className="w-5 h-5" />Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
                        </h3>
                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</label>
                            <input type="number" value={formData.estimatedHours || 100} onChange={(e) => setFormData({ ...formData, estimatedHours: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-rose-200 rounded-xl" />
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø±ÙŠØ§Ù„)</label>
                            <input type="number" value={formData.budget || 50000} onChange={(e) => setFormData({ ...formData, budget: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-rose-200 rounded-xl" />
                          </div> </div>
                        <div className="mt-4">
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                          <div className="grid grid-cols-3 gap-2">
                            {['Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø§Ø¨Ù‚Ø©', 'Ù…Ø³ØªÙ†Ø¯Ø§Øª', 'Ù…Ù‚Ø§Ø¨Ù„Ø§Øª', 'ØªØ¯Ø±ÙŠØ¨'].map(res => (
                              <label key={res} className="flex items-center gap-2 p-3 bg-white rounded-xl border border-rose-200 cursor-pointer hover:bg-rose-50">
                                <input type="checkbox" className="w-4 h-4 rounded text-rose-500" />
                                <span className="text-sm font-bold text-slate-700">{res}</span>
                              </label>
                            ))}
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 9 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                        <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">10</span>
                          <CheckCircle2 className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                        </h3>
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><FileText className="w-4 h-4 text-blue-500" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span><span className="font-bold">{formData.code}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span><span className="font-bold truncate max-w-32">{formData.title || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙØªØ±Ø©:</span><span className="font-bold">{formData.periodKey || '-'}</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Target className="w-4 h-4 text-amber-500" />Ø§Ù„Ù†Ø·Ø§Ù‚</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¬Ù‡Ø©:</span><span className="font-bold">{formData.authorityId || 'Ø§Ù„ÙƒÙ„'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª:</span><span className="font-bold">{formData.targetObligations?.length || 0}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·:</span><span className="font-bold">{formData.targetControls?.length || 0}</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Users className="w-4 h-4 text-purple-500" />Ø§Ù„ÙØ±ÙŠÙ‚</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø¯ÙŠØ±:</span><span className="font-bold">{getUser(formData.managerId)?.name || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙØ±ÙŠÙ‚:</span><span className="font-bold">{formData.teamMembers?.length || 0} Ø£Ø¹Ø¶Ø§Ø¡</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Clock className="w-4 h-4 text-cyan-500" />Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø¯Ø©:</span><span className="font-bold">{formData.estimatedDays || 30} ÙŠÙˆÙ…</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span><span className="font-bold">{formData.estimatedHours || 100} Ø³Ø§Ø¹Ø©</span></div>
                            </div> </div> </div>
                        <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                          <h4 className="font-bold text-slate-700 mb-2 text-sm">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                          <div className="grid grid-cols-3 gap-2">
                            {[
                              { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', valid: formData.title?.length >= 5 },
                              { label: 'Ø§Ù„ÙØªØ±Ø©', valid: !!formData.periodKey },
                              { label: 'Ø§Ù„Ø¬Ù‡Ø©', valid: !!formData.authorityId },
                              { label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', valid: formData.targetObligations?.length > 0 },
                              { label: 'Ø§Ù„Ù…Ø¯ÙŠØ±', valid: !!formData.managerId },
                              { label: 'Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®', valid: !!formData.startDate },
                            ].map((check, idx) => (
                              <div key={idx} className={`flex items-center gap-1 p-1.5 rounded-lg text-xs ${check.valid ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                                {check.valid ? <CheckCircle2 className="w-3 h-3" /> : <XCircle className="w-3 h-3" />}
                                <span className="font-bold">{check.label}</span>
                              </div>
                            ))}
                          </div> </div> </div> </div>
                  )}
                </div>

                <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
                  <button onClick={() => executionStep > 0 ? setExecutionStep(executionStep - 1) : setShowModal(false)}
                    className="flex items-center gap-2 px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                    <ChevronRight className="w-4 h-4" />
                    {executionStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
                  </button>

                  <div className="flex items-center gap-1">
                    {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(step => (
                      <div key={step} className={`w-2 h-2 rounded-full transition-all ${executionStep === step ? 'bg-purple-500 w-4' : executionStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                    ))}
                  </div>

                  {executionStep < 9 ? (
                    <button onClick={() => setExecutionStep(executionStep + 1)}
                      className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg">
                      Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                    </button>
                  ) : (
                    <button onClick={handleSave}
                      disabled={!formData.title || !formData.periodKey}
                      className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                      <CheckCircle2 className="w-4 h-4" />{modalMode === 'create' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                    </button>
                  )}
                </div>
              </>
            )}

            {modalType === 'case' && (
              <>
                <div className="bg-gradient-to-l from-purple-600 via-indigo-600 to-blue-600 px-6 py-5 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                        <ClipboardCheck className="w-7 h-7" />
                      </div>
                      <div>
                        <h2 className="text-xl font-black">{modalMode === 'create' ? 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±' : 'ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'}</h2>
                        <p className="text-purple-200 font-mono text-sm">{formData.code}</p>
                      </div> </div>
                    <div className="flex items-center gap-3">
                      <div className="relative w-16 h-16">
                        <svg className="w-16 h-16 transform -rotate-90">
                          <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.2)" strokeWidth="4" fill="none" />
                          <circle cx="32" cy="32" r="28" stroke="white" strokeWidth="4" fill="none"
                            strokeDasharray={`${(executionStep / 9) * 176} 176`} strokeLinecap="round" />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <span className="text-lg font-black">{executionStep + 1}/10</span>
                        </div> </div>
                      <button onClick={() => setShowModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                        <X className="w-5 h-5" />
                      </button> </div> </div>
                  <div className="grid grid-cols-10 gap-1">
                    {[
                      { step: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                      { step: 1, label: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: Building2 },
                      { step: 2, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', icon: ClipboardCheck },
                      { step: 3, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±', icon: Shield },
                      { step: 4, label: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardList },
                      { step: 5, label: 'Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°', icon: ListChecks },
                      { step: 6, label: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„', icon: Users },
                      { step: 7, label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©', icon: Calendar },
                      { step: 8, label: 'Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', icon: FileCheck },
                      { step: 9, label: 'Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', icon: CheckCircle2 },
                    ].map((s) => (
                      <button key={s.step} onClick={() => setExecutionStep(s.step)}
                        className={`flex flex-col items-center p-2 rounded-xl transition-all ${executionStep === s.step ? 'bg-white text-purple-600' :
                          executionStep > s.step ? 'bg-emerald-400/40 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-1 ${executionStep === s.step ? 'bg-purple-100' :
                          executionStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {executionStep > s.step ? <Check className="w-4 h-4" /> : <s.icon className="w-4 h-4" />}
                        </div>
                        <span className="text-[9px] font-bold text-center leading-tight">{s.label}</span>
                      </button>
                    ))}
                  </div> </div>
                <div className="p-6 max-h-[50vh] overflow-y-auto">

                  {executionStep === 0 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl p-5 border-2 border-purple-200">
                        <h3 className="text-lg font-black text-purple-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm">1</span>
                          Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Basic Information
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± *</label>
                            <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl text-lg font-bold focus:border-purple-500 focus:outline-none"
                              placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ" />
                          </div>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                              <select value={formData.planId || ''} onChange={(e) => setFormData({ ...formData, planId: parseInt(e.target.value) || '' })}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none">
                                <option value="">Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø© (Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³ØªÙ‚Ù„)</option>
                                {testPlans.filter(p => p.status === 'Active').map(p => (
                                  <option key={p.id} value={p.id}>{p.code} - {p.title}</option>
                                ))}
                              </select>
                            </div>
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                              <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                                className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none" />
                            </div> </div>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                              <div className="grid grid-cols-3 gap-2">
                                {[
                                  { value: 'Walkthrough', label: 'Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye },
                                  { value: 'Sample', label: 'Ø¹ÙŠÙ†Ø©', icon: BarChart3 },
                                  { value: 'Full', label: 'Ø´Ø§Ù…Ù„', icon: Target },
                                ].map(type => (
                                  <button key={type.value} type="button" onClick={() => setFormData({ ...formData, testType: type.value })}
                                    className={`p-2 rounded-xl border-2 transition-all ${formData.testType === type.value ? 'border-purple-500 bg-purple-50' : 'border-slate-200 hover:border-slate-300'}`}>
                                    <type.icon className={`w-4 h-4 mx-auto mb-1 ${formData.testType === type.value ? 'text-purple-600' : 'text-slate-400'}`} />
                                    <p className="text-xs font-bold">{type.label}</p>
                                  </button>
                                ))}
                              </div> </div>
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                              <div className="flex gap-1">
                                {[
                                  { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                                  { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                                  { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                                  { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                                ].map(pri => (
                                  <button key={pri.value} type="button" onClick={() => setFormData({ ...formData, priority: pri.value })}
                                    className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${formData.priority === pri.value ? `bg-${pri.color}-500 text-white` : `bg-${pri.color}-50 text-${pri.color}-700`}`}>
                                    {pri.label}
                                  </button>
                                ))}
                              </div> </div> </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                            <textarea rows={2} value={formData.notes || ''} onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none resize-none"
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù‡Ø¯Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„Ù†Ø·Ø§Ù‚..." />
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 1 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                        <h3 className="text-lg font-black text-blue-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm">2</span>
                          <Building2 className="w-5 h-5" />Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                        </h3>
                        <div className="grid grid-cols-2 gap-5">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                            <div className="space-y-2 max-h-72 overflow-y-auto">
                              {[
                                { id: 'SAMA', code: 'SA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', fullName: 'Saudi Central Bank', color: 'emerald' },
                                { id: 'CMA', code: 'CM', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', fullName: 'Capital Market Authority', color: 'blue' },
                                { id: 'NCA', code: 'NC', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', fullName: 'National Cybersecurity Authority', color: 'purple' },
                                { id: 'SDAIA', code: 'SD', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', fullName: 'Saudi Data & AI Authority', color: 'indigo' },
                                { id: 'ZATCA', code: 'ZA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', fullName: 'Zakat, Tax and Customs Authority', color: 'amber' },
                                { id: 'CCHI', code: 'CC', name: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ', fullName: 'Council of Cooperative Health Insurance', color: 'teal' },
                                { id: 'HRSD', code: 'HR', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', fullName: 'Ministry of Human Resources', color: 'rose' },
                                { id: 'CITC', code: 'CI', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', fullName: 'Communications & IT Commission', color: 'cyan' },
                              ].map(auth => (
                                <button key={auth.id} type="button" onClick={() => setFormData({ ...formData, authorityId: auth.id })}
                                  className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-right ${formData.authorityId === auth.id
                                    ? `border-${auth.color}-500 bg-${auth.color}-100`
                                    : 'border-slate-200 hover:border-slate-300 bg-white'
                                    }`}>
                                  <div className={`w-12 h-12 rounded-xl flex items-center justify-center font-black text-lg ${formData.authorityId === auth.id
                                    ? `bg-${auth.color}-500 text-white`
                                    : 'bg-slate-100 text-slate-600'
                                    }`}>
                                    {auth.code}
                                  </div>
                                  <div className="flex-1">
                                    <p className="font-bold text-slate-800">{auth.name}</p>
                                    <p className="text-xs text-slate-500">{auth.id}</p>
                                  </div>
                                  {formData.authorityId === auth.id && <CheckCircle2 className="w-6 h-6 text-emerald-500" />}
                                </button>
                              ))}
                            </div> </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø¥Ø·Ø§Ø± / Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                            <div className="space-y-2 max-h-72 overflow-y-auto">
                              {[
                                { id: 'SAMA-AML', name: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨', code: 'AML/CFT', authority: 'SAMA', color: 'emerald' },
                                { id: 'SAMA-BCM', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', code: 'BCM', authority: 'SAMA', color: 'emerald' },
                                { id: 'SAMA-CYBER', name: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ', code: 'CSF', authority: 'SAMA', color: 'emerald' },
                                { id: 'NCA-ECC', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', code: 'ECC', authority: 'NCA', color: 'purple' },
                                { id: 'NCA-CCC', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', code: 'CCC', authority: 'NCA', color: 'purple' },
                                { id: 'NCA-CSCC', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', code: 'CSCC', authority: 'NCA', color: 'purple' },
                                { id: 'PDPL', name: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', code: 'PDPL', authority: 'SDAIA', color: 'indigo' },
                                { id: 'ISO27001', name: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', code: 'ISO 27001', authority: 'Ø¯ÙˆÙ„ÙŠ', color: 'blue' },
                                { id: 'PCIDSS', name: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ø§Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹', code: 'PCI-DSS', authority: 'Ø¯ÙˆÙ„ÙŠ', color: 'blue' },
                              ].map(fw => (
                                <button key={fw.id} type="button" onClick={() => setFormData({ ...formData, framework: fw.id })}
                                  className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-right ${formData.framework === fw.id
                                    ? `border-${fw.color}-500 bg-${fw.color}-100`
                                    : 'border-slate-200 hover:border-slate-300 bg-white'
                                    }`}>
                                  <div className={`px-3 py-1.5 rounded-lg font-mono text-xs font-bold ${formData.framework === fw.id
                                    ? `bg-${fw.color}-500 text-white`
                                    : 'bg-slate-100 text-slate-600'
                                    }`}>
                                    {fw.code}
                                  </div>
                                  <div className="flex-1">
                                    <p className="font-bold text-slate-800 text-sm">{fw.name}</p>
                                    <p className="text-xs text-slate-500">{fw.authority}</p>
                                  </div>
                                  {formData.framework === fw.id && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                                </button>
                              ))}
                            </div> </div> </div>
                        {(formData.authorityId || formData.framework) && (
                          <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                            <p className="text-sm text-slate-600">
                              <strong>Ø§Ù„Ù…Ø­Ø¯Ø¯:</strong>
                              {formData.authorityId && <span className="mx-1 px-2 py-0.5 bg-blue-100 text-blue-700 rounded">{formData.authorityId}</span>}
                              {formData.framework && <span className="mx-1 px-2 py-0.5 bg-purple-100 text-purple-700 rounded">{formData.framework}</span>}
                            </p> </div>
                        )}
                      </div> </div>
                  )}

                  {executionStep === 2 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                        <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">3</span>
                          <ClipboardCheck className="w-5 h-5" />Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
                        </h3>
                        <div className="relative mb-3">
                          <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                          <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª..." className="w-full pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl" />
                        </div>
                        <div className="max-h-48 overflow-y-auto space-y-2">
                          {INITIAL_OBLIGATIONS.map(obl => {
                            const auth = AUTHORITIES.find(a => a.id === obl.authorityId);
                            const isSelected = formData.obligationId === obl.id;
                            return (
                              <div key={obl.id} onClick={() => setFormData({ ...formData, obligationId: obl.id })}
                                className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300'}`}>
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center gap-2">
                                    <span className="font-mono text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded">{obl.code}</span>
                                    {auth && <span className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">{auth.code}</span>}
                                  </div>
                                  {isSelected && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                                </div>
                                <p className="font-medium text-slate-800 text-sm mt-1">{obl.title}</p>
                              </div>);
                          })}
                        </div> </div> </div>
                  )}

                  {executionStep === 3 && (
                    <div className="grid grid-cols-2 gap-5">
                      <div className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-2xl p-5 border-2 border-indigo-200">
                        <h3 className="text-base font-black text-indigo-800 mb-3 flex items-center gap-2">
                          <Shield className="w-5 h-5" />Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                        </h3>
                        <div className="max-h-40 overflow-y-auto space-y-2">
                          {CONTROLS.map(ctrl => (
                            <div key={ctrl.id} onClick={() => setFormData({ ...formData, controlId: ctrl.id })}
                              className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.controlId === ctrl.id ? 'border-indigo-500 bg-indigo-100' : 'border-slate-200 hover:border-indigo-300'}`}>
                              <div className="flex items-center justify-between">
                                <span className="font-mono text-xs font-bold text-indigo-600">{ctrl.code}</span>
                                {formData.controlId === ctrl.id && <CheckCircle2 className="w-4 h-4 text-indigo-500" />}
                              </div>
                              <p className="text-sm text-slate-700 mt-1">{ctrl.title}</p>
                            </div>
                          ))}
                        </div> </div>
                      <div className="bg-gradient-to-br from-red-50 to-orange-50 rounded-2xl p-5 border-2 border-red-200">
                        <h3 className="text-base font-black text-red-800 mb-3 flex items-center gap-2">
                          <AlertTriangle className="w-5 h-5" />Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                        </h3>
                        <div className="space-y-2">
                          {[
                            { id: 'R1', code: 'RISK-001', title: 'Ù…Ø®Ø§Ø·Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', level: 'High' },
                            { id: 'R2', code: 'RISK-002', title: 'Ù…Ø®Ø§Ø·Ø± ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', level: 'Critical' },
                            { id: 'R3', code: 'RISK-003', title: 'Ù…Ø®Ø§Ø·Ø± ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨', level: 'Critical' },
                          ].map(risk => (
                            <div key={risk.id} className="flex items-center gap-3 p-3 bg-white rounded-xl border border-red-200">
                              <input type="checkbox" className="w-4 h-4 rounded text-red-500" />
                              <div className="flex-1">
                                <span className="font-mono text-xs text-red-600">{risk.code}</span>
                                <p className="text-sm text-slate-700">{risk.title}</p>
                              </div>
                              <span className={`px-2 py-0.5 rounded text-xs font-bold ${risk.level === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'}`}>{risk.level}</span>
                            </div>
                          ))}
                        </div> </div> </div>
                  )}

                  {executionStep === 4 && (
                    <div className="space-y-5">
                      <h3 className="text-lg font-black text-slate-800 flex items-center gap-2">
                        <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm">5</span>
                        Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Test Template
                      </h3>
                      <div className="grid grid-cols-2 gap-3">
                        {testTemplates.map(template => {
                          const isSelected = formData.templateId === template.id;
                          const typeCfg = TEST_TYPE_CONFIG[template.testType];
                          const TypeIcon = typeCfg?.icon || FileText;
                          return (
                            <div key={template.id} onClick={() => setFormData({ ...formData, templateId: template.id, sampleSize: template.defaultSampleSize })}
                              className={`rounded-xl border-2 p-4 cursor-pointer transition-all ${isSelected ? 'border-purple-500 bg-purple-50 shadow-lg' : 'border-slate-200 hover:border-purple-300'}`}>
                              <div className="flex items-start justify-between mb-2">
                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${isSelected ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                  <TypeIcon className="w-5 h-5" />
                                </div>
                                {isSelected && <CheckCircle2 className="w-5 h-5 text-purple-500" />}
                              </div>
                              <span className="font-mono text-xs font-bold text-purple-600">{template.code}</span>
                              <h4 className="font-bold text-slate-800 text-sm mt-1">{template.title}</h4>
                              <div className="flex items-center gap-2 mt-2 text-xs text-slate-500">
                                <span className="px-2 py-0.5 bg-slate-100 rounded">{template.stepCount} Ø®Ø·ÙˆØ§Øª</span>
                                <span>Ø¹ÙŠÙ†Ø©: {template.defaultSampleSize}</span>
                              </div> </div>);
                        })}
                      </div> </div>
                  )}

                  {executionStep === 5 && (
                    <div className="space-y-5">
                      <h3 className="text-lg font-black text-slate-800 flex items-center gap-2">
                        <span className="w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center text-sm">6</span>
                        Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° - Execution Steps
                      </h3>
                      {formData.templateId ? (
                        <div className="space-y-2">
                          {getTemplate(formData.templateId)?.steps.map((step, idx) => (
                            <div key={step.id} className="flex items-center gap-3 p-3 bg-white rounded-xl border-2 border-slate-200">
                              <div className="w-8 h-8 rounded-lg bg-amber-100 text-amber-600 flex items-center justify-center font-bold text-sm">{step.stepNo}</div>
                              <div className="flex-1">
                                <p className="text-sm font-medium text-slate-800">{step.instruction}</p>
                                <p className="text-xs text-slate-500 mt-1">Ø§Ù„Ø¯Ù„ÙŠÙ„: {step.expectedEvidence}</p>
                              </div>
                              {step.isMandatory && <span className="px-2 py-0.5 bg-red-100 text-red-600 text-xs rounded font-bold">Ø¥Ù„Ø²Ø§Ù…ÙŠ</span>}
                            </div>
                          ))}
                        </div>
                      ) : (
                        <div className="text-center py-8 bg-slate-50 rounded-xl">
                          <ClipboardList className="w-12 h-12 text-slate-300 mx-auto mb-2" />
                          <p className="text-slate-500">Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹</p>
                        </div>
                      )}
                      <div className="grid grid-cols-2 gap-4 mt-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø­Ø¬Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</label>
                          <input type="number" value={formData.sampleSize || 10} onChange={(e) => setFormData({ ...formData, sampleSize: parseInt(e.target.value) })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</label>
                          <input type="text" value={formData.populationRef || ''} onChange={(e) => setFormData({ ...formData, populationRef: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙŠÙ†Ø§ÙŠØ± 2025" />
                        </div> </div> </div>
                  )}

                  {executionStep === 6 && (
                    <div className="grid grid-cols-2 gap-5">
                      <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                        <h3 className="text-base font-black text-blue-800 mb-3 flex items-center gap-2">
                          <User className="w-5 h-5" />Ø§Ù„Ù…Ø®ØªØ¨Ø± - Tester
                        </h3>
                        <div className="space-y-2">
                          {TESTERS.map(tester => {
                            const isSelected = formData.testerId === tester.id;
                            const isDisabled = formData.reviewerId === tester.id;
                            return (
                              <div key={tester.id} onClick={() => !isDisabled && setFormData({ ...formData, testerId: tester.id })}
                                className={`flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'} ${isSelected ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'}`}>
                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${isSelected ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                                  {tester.name.charAt(0)}
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800 text-sm">{tester.name}</p>
                                  <p className="text-xs text-slate-500">{tester.role}</p>
                                </div>
                                {isSelected && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                              </div>);
                          })}
                        </div> </div>
                      <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                        <h3 className="text-base font-black text-amber-800 mb-3 flex items-center gap-2">
                          <UserCheck className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (SoD) - Reviewer
                        </h3>
                        <div className="space-y-2">
                          {TESTERS.map(reviewer => {
                            const isSelected = formData.reviewerId === reviewer.id;
                            const isDisabled = formData.testerId === reviewer.id;
                            return (
                              <div key={reviewer.id} onClick={() => !isDisabled && setFormData({ ...formData, reviewerId: reviewer.id })}
                                className={`flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${isDisabled ? 'border-red-300 bg-red-50 cursor-not-allowed' : 'cursor-pointer'} ${isSelected ? 'border-amber-500 bg-amber-100' : 'border-slate-200 hover:border-amber-300'}`}>
                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${isDisabled ? 'bg-red-200 text-red-600' : isSelected ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                                  {reviewer.name.charAt(0)}
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800 text-sm">{reviewer.name}</p>
                                  <p className="text-xs text-slate-500">{reviewer.role}</p>
                                </div>
                                {isDisabled && <span className="px-2 py-0.5 bg-red-100 text-red-600 text-xs rounded font-bold">SoD</span>}
                                {isSelected && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                              </div>);
                          })}
                        </div> </div> </div>
                  )}

                  {executionStep === 7 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl p-5 border-2 border-cyan-200">
                        <h3 className="text-lg font-black text-cyan-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-cyan-500 text-white rounded-lg flex items-center justify-center text-sm">8</span>
                          Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ - Scheduling
                        </h3>
                        <div className="grid grid-cols-3 gap-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                            <input type="date" value={formData.startDate || ''} onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                            <input type="date" value={formData.expectedEndDate || ''} onChange={(e) => setFormData({ ...formData, expectedEndDate: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø© (Ø£ÙŠØ§Ù…)</label>
                            <input type="number" value={formData.estimatedDays || 5} onChange={(e) => setFormData({ ...formData, estimatedDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl" />
                          </div> </div>
                        <div className="grid grid-cols-2 gap-4 mt-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
                            <select value={formData.recurrence || 'none'} onChange={(e) => setFormData({ ...formData, recurrence: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl">
                              <option value="none">Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                              <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                              <option value="quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                              <option value="annual">Ø³Ù†ÙˆÙŠ</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ (Ø£ÙŠØ§Ù…)</label>
                            <select value={formData.reminderDays || 3} onChange={(e) => setFormData({ ...formData, reminderDays: parseInt(e.target.value) })}
                              className="w-full px-4 py-3 border-2 border-cyan-200 rounded-xl">
                              <option value={1}>ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</option>
                              <option value={3}>3 Ø£ÙŠØ§Ù…</option>
                              <option value={7}>Ø£Ø³Ø¨ÙˆØ¹</option>
                              <option value={14}>Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                            </select>
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 8 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-violet-50 to-purple-50 rounded-2xl p-5 border-2 border-violet-200">
                        <h3 className="text-lg font-black text-violet-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-violet-500 text-white rounded-lg flex items-center justify-center text-sm">9</span>
                          Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© - Required Evidence
                        </h3>
                        <div className="grid grid-cols-2 gap-4">
                          {[
                            { type: 'Report', label: 'ØªÙ‚Ø±ÙŠØ±', icon: FileText, required: true },
                            { type: 'Screenshot', label: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', icon: Eye, required: true },
                            { type: 'Log', label: 'Ø³Ø¬Ù„', icon: Table, required: false },
                            { type: 'Certificate', label: 'Ø´Ù‡Ø§Ø¯Ø©', icon: Award, required: false },
                            { type: 'Attestation', label: 'Ø¥Ù‚Ø±Ø§Ø±', icon: FileCheck, required: false },
                            { type: 'Config', label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', icon: Settings, required: false },
                          ].map(evd => (
                            <label key={evd.type} className="flex items-center gap-3 p-3 bg-white rounded-xl border-2 border-slate-200 cursor-pointer hover:border-violet-300">
                              <input type="checkbox" defaultChecked={evd.required} className="w-5 h-5 rounded text-violet-500" />
                              <evd.icon className="w-5 h-5 text-violet-500" />
                              <span className="font-bold text-slate-700">{evd.label}</span>
                              {evd.required && <span className="px-2 py-0.5 bg-red-100 text-red-600 text-xs rounded mr-auto">Ù…Ø·Ù„ÙˆØ¨</span>}
                            </label>
                          ))}
                        </div>
                        <div className="mt-4">
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù„Ø©</label>
                          <textarea rows={2} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                            placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø­ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©..." />
                        </div> </div> </div>
                  )}

                  {executionStep === 9 && (
                    <div className="space-y-5">
                      <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                        <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                          <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">10</span>
                          Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ£ÙƒÙŠØ¯ - Review & Confirm
                        </h3>
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><FileText className="w-4 h-4 text-blue-500" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span><span className="font-bold">{formData.code}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span><span className="font-bold truncate max-w-32">{formData.title || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span><span className="font-bold">{formData.dueDate || '-'}</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Link2 className="w-4 h-4 text-emerald-500" />Ø§Ù„Ù†Ø·Ø§Ù‚</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</span><span className="font-bold">{getObligation(formData.obligationId)?.code || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¶Ø§Ø¨Ø·:</span><span className="font-bold">{getControl(formData.controlId)?.code || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¹ÙŠÙ†Ø©:</span><span className="font-bold">{formData.sampleSize}</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><ClipboardList className="w-4 h-4 text-purple-500" />Ø§Ù„Ù‚Ø§Ù„Ø¨</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù‚Ø§Ù„Ø¨:</span><span className="font-bold">{getTemplate(formData.templateId)?.code || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ§Øª:</span><span className="font-bold">{getTemplate(formData.templateId)?.stepCount || 0}</span></div>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Users className="w-4 h-4 text-amber-500" />ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</h4>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø®ØªØ¨Ø±:</span><span className="font-bold">{getUser(formData.testerId)?.name || '-'}</span></div>
                              <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹:</span><span className="font-bold">{getUser(formData.reviewerId)?.name || '-'}</span></div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">SoD:</span>
                                {formData.testerId !== formData.reviewerId ? (
                                  <span className="font-bold text-emerald-600 flex items-center gap-1"><CheckCircle2 className="w-3 h-3" />âœ“</span>
                                ) : (
                                  <span className="font-bold text-red-600 flex items-center gap-1"><XCircle className="w-3 h-3" />âœ—</span>
                                )}
                              </div> </div> </div> </div>
                        <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                          <h4 className="font-bold text-slate-700 mb-2 text-sm">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                          <div className="grid grid-cols-3 gap-2">
                            {[
                              { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', valid: formData.title?.length >= 3 },
                              { label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', valid: !!formData.obligationId },
                              { label: 'Ø§Ù„Ù‚Ø§Ù„Ø¨', valid: !!formData.templateId },
                              { label: 'Ø§Ù„Ù…Ø®ØªØ¨Ø±', valid: !!formData.testerId },
                              { label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', valid: !!formData.reviewerId },
                              { label: 'ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…', valid: formData.testerId !== formData.reviewerId },
                            ].map((check, idx) => (
                              <div key={idx} className={`flex items-center gap-1 p-1.5 rounded-lg text-xs ${check.valid ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                                {check.valid ? <CheckCircle2 className="w-3 h-3" /> : <XCircle className="w-3 h-3" />}
                                <span className="font-bold">{check.label}</span>
                              </div>
                            ))}
                          </div> </div> </div> </div>
                  )}
                </div>

                <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
                  <button onClick={() => executionStep > 0 ? setExecutionStep(executionStep - 1) : setShowModal(false)}
                    className="flex items-center gap-2 px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                    <ChevronRight className="w-4 h-4" />
                    {executionStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
                  </button>

                  <div className="flex items-center gap-1">
                    {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(step => (
                      <div key={step} className={`w-2 h-2 rounded-full transition-all ${executionStep === step ? 'bg-purple-500 w-4' : executionStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                    ))}
                  </div>

                  {executionStep < 9 ? (
                    <button onClick={() => setExecutionStep(executionStep + 1)}
                      className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg">
                      Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                    </button>
                  ) : (
                    <button onClick={handleSave}
                      disabled={!formData.title || !formData.obligationId || !formData.templateId || !formData.testerId || !formData.reviewerId || formData.testerId === formData.reviewerId}
                      className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                      <CheckCircle2 className="w-4 h-4" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                  )}
                </div>
              </>
            )}

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                FINDING WIZARD MODAL - Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {modalType === 'finding' && (
              <>
                <div className="bg-gradient-to-l from-red-500 via-orange-500 to-amber-500 px-8 py-6 text-white">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                        <AlertTriangle className="w-7 h-7" />
                      </div>
                      <div>
                        <h2 className="text-2xl font-bold">{modalMode === 'create' ? 'Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ù…Ù„Ø§Ø­Ø¸Ø©' : 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©'}</h2>
                        <p className="text-orange-200">{formData.code}</p>
                      </div> </div>
                    <button onClick={() => { setShowModal(false); setExecutionStep(0); }} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <X className="w-6 h-6" />
                    </button> </div>
                  <div className="flex items-center justify-between">
                    {[
                      { step: 0, label: 'Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ø®Ø·ÙˆØ±Ø©', icon: AlertCircle },
                      { step: 1, label: 'Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„', icon: FileText },
                      { step: 2, label: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨', icon: Search },
                      { step: 3, label: 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: Zap },
                      { step: 4, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', icon: CheckCircle2 },
                    ].map((s, idx) => (
                      <div key={s.step} className="flex items-center">
                        <button onClick={() => setExecutionStep(s.step)}
                          className={`flex items-center gap-2 px-3 py-2 rounded-xl transition-all ${executionStep === s.step ? 'bg-white text-orange-600 font-bold shadow-lg' :
                            executionStep > s.step ? 'bg-white/30 text-white' : 'bg-white/10 text-white/60'
                            }`}>
                          <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${executionStep === s.step ? 'bg-orange-100' :
                            executionStep > s.step ? 'bg-emerald-400 text-white' : 'bg-white/10'
                            }`}>
                            {executionStep > s.step ? <Check className="w-5 h-5" /> : <s.icon className="w-4 h-4" />}
                          </div>
                          <span className="hidden xl:inline text-sm">{s.label}</span>
                        </button>
                        {idx < 4 && <ChevronLeft className="w-4 h-4 mx-1 text-white/40" />}
                      </div>
                    ))}
                  </div> </div>
                <div className="p-8 max-h-[55vh] overflow-y-auto">

                  {executionStep === 0 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200">
                        <h3 className="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
                          <ClipboardCheck className="w-5 h-5" />Ø±Ø¨Ø· Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± *
                        </h3>
                        <div className="grid grid-cols-2 gap-3 max-h-48 overflow-y-auto">
                          {testCases.map(tc => {
                            const isSelected = formData.testCaseId === tc.id;
                            const statusCfg = CASE_STATUS_CONFIG[tc.status];
                            return (
                              <div key={tc.id} onClick={() => setFormData({ ...formData, testCaseId: tc.id })}
                                className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-blue-500 bg-blue-100 shadow-lg' : 'border-slate-200 hover:border-blue-300 bg-white'
                                  }`}>
                                <div className="flex items-start justify-between">
                                  <div>
                                    <span className="font-mono text-xs font-bold text-blue-600">{tc.code}</span>
                                    <p className="text-sm text-slate-800 mt-1 line-clamp-1">{tc.title}</p>
                                    <span className={`inline-block mt-2 px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                                      {statusCfg?.label}
                                    </span> </div>
                                  {isSelected && <CheckCircle2 className="w-5 h-5 text-blue-500 shrink-0" />}
                                </div> </div>);
                          })}
                        </div> </div>
                      <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-6 border border-red-200">
                        <h3 className="text-lg font-bold text-red-800 mb-4 flex items-center gap-2">
                          <AlertTriangle className="w-5 h-5" />Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø© *
                        </h3>
                        <div className="grid grid-cols-3 gap-4">
                          {[
                            { key: 'High', label: 'Ø¹Ø§Ù„ÙŠ', icon: 'ğŸ”´', desc: 'ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ', color: 'red' },
                            { key: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', icon: 'ğŸŸ¡', desc: 'ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…', color: 'amber' },
                            { key: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', icon: 'ğŸŸ¢', desc: 'Ù„Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø±', color: 'emerald' },
                          ].map(sev => (
                            <button key={sev.key} onClick={() => setFormData({ ...formData, severity: sev.key })}
                              className={`p-5 rounded-2xl border-2 transition-all text-center ${formData.severity === sev.key
                                ? `border-${sev.color}-500 bg-${sev.color}-100 shadow-lg`
                                : 'border-slate-200 hover:border-slate-400 bg-white'
                                }`}>
                              <div className="text-4xl mb-2">{sev.icon}</div>
                              <p className="font-bold text-slate-800">{sev.label}</p>
                              <p className="text-xs text-slate-500 mt-1">{sev.desc}</p>
                            </button>
                          ))}
                        </div> </div>
                      <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl p-6 border border-purple-200">
                        <h3 className="text-lg font-bold text-purple-800 mb-4 flex items-center gap-2">
                          <Tag className="w-5 h-5" />Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© *
                        </h3>
                        <div className="grid grid-cols-4 gap-3">
                          {[
                            { key: 'ControlFailure', label: 'ÙØ´Ù„ Ø§Ù„Ø¶Ø§Ø¨Ø·', icon: Shield, desc: 'Ø§Ù„Ø¶Ø§Ø¨Ø· Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ØªÙˆÙ‚Ø¹' },
                            { key: 'PolicyGap', label: 'ÙØ¬ÙˆØ© Ø³ÙŠØ§Ø³Ø©', icon: FileText, desc: 'Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' },
                            { key: 'EvidenceInsufficient', label: 'Ø£Ø¯Ù„Ø© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', icon: FileQuestion, desc: 'Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¯Ø§Ø¹Ù…Ø©' },
                            { key: 'ProcessGap', label: 'ÙØ¬ÙˆØ© Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©', icon: GitBranch, desc: 'Ø®Ù„Ù„ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' },
                          ].map(type => {
                            const isSelected = formData.findingType === type.key;
                            return (
                              <button key={type.key} onClick={() => setFormData({ ...formData, findingType: type.key })}
                                className={`p-4 rounded-xl border-2 transition-all text-center ${isSelected ? 'border-purple-500 bg-purple-100 shadow-lg' : 'border-slate-200 hover:border-purple-300 bg-white'
                                  }`}>
                                <div className={`w-10 h-10 rounded-xl mx-auto mb-2 flex items-center justify-center ${isSelected ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600'
                                  }`}>
                                  <type.icon className="w-5 h-5" />
                                </div>
                                <p className="font-bold text-slate-800 text-sm">{type.label}</p>
                                <p className="text-xs text-slate-500 mt-1 line-clamp-2">{type.desc}</p>
                              </button>);
                          })}
                        </div> </div> </div>
                  )}

                  {executionStep === 1 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-6 border border-orange-200">
                        <h3 className="text-lg font-bold text-orange-800 mb-4 flex items-center gap-2">
                          <FileText className="w-5 h-5" />ÙˆØµÙ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© *</label>
                            <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                              className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:border-orange-400 focus:outline-none bg-white"
                              placeholder="Ù…Ø«Ø§Ù„: ÙØ¬ÙˆØ© ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©" />
                          </div>

                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                            <textarea rows={4} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                              className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl focus:border-orange-400 focus:outline-none bg-white resize-none"
                              placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±..." />
                            <p className="text-xs text-slate-500 mt-1 text-left">{formData.description?.length || 0} / 500 Ø­Ø±Ù</p>
                          </div>

                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·</label>
                            <div className="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center bg-white">
                              <Upload className="w-10 h-10 text-slate-400 mx-auto mb-2" />
                              <p className="text-slate-600">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„</p>
                              <p className="text-xs text-slate-400 mt-1">PNG, JPG, PDF Ø­ØªÙ‰ 10MB</p>
                            </div> </div> </div> </div>
                      <div className="bg-gradient-to-r from-slate-50 to-slate-100 rounded-2xl p-6 border border-slate-200">
                        <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <Layers className="w-5 h-5" />Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
                        </h3>
                        <div className="flex flex-wrap gap-2">
                          {['Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©'].map(area => (
                            <button key={area} onClick={() => {
                              const areas = formData.affectedAreas || [];
                              setFormData({
                                ...formData,
                                affectedAreas: areas.includes(area) ? areas.filter(a => a !== area) : [...areas, area]
                              });
                            }}
                              className={`px-4 py-2 rounded-xl border-2 text-sm font-bold transition-all ${formData.affectedAreas?.includes(area) ? 'border-orange-500 bg-orange-100 text-orange-700' : 'border-slate-200 bg-white text-slate-600 hover:border-orange-300'
                                }`}>
                              {area}
                            </button>
                          ))}
                        </div> </div> </div>
                  )}

                  {executionStep === 2 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-200">
                        <h3 className="text-lg font-bold text-indigo-800 mb-4 flex items-center gap-2">
                          <Search className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ *</label>
                            <textarea rows={3} value={formData.rootCause || ''} onChange={(e) => setFormData({ ...formData, rootCause: e.target.value })}
                              className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl focus:border-indigo-400 focus:outline-none bg-white resize-none"
                              placeholder="Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ" />
                          </div>

                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                              <HelpCircle className="w-4 h-4" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù€ 5 Ù„Ù…Ø§Ø°Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </h4>
                            {[1, 2, 3, 4, 5].map(num => (
                              <div key={num} className="flex items-center gap-3 mb-2">
                                <span className="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-sm">{num}</span>
                                <input type="text" placeholder={`Ù„Ù…Ø§Ø°Ø§ ${num}ØŸ`}
                                  value={formData[`why${num}`] || ''}
                                  onChange={(e) => setFormData({ ...formData, [`why${num}`]: e.target.value })}
                                  className="flex-1 px-4 py-2 border-2 border-slate-200 rounded-lg text-sm focus:border-indigo-400 focus:outline-none" />
                              </div>
                            ))}
                          </div> </div> </div>
                      <div className="bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-6 border border-red-200">
                        <h3 className="text-lg font-bold text-red-800 mb-4 flex items-center gap-2">
                          <Activity className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±
                        </h3>
                        <div className="grid grid-cols-3 gap-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ</label>
                            <select value={formData.financialImpact || 'Low'} onChange={(e) => setFormData({ ...formData, financialImpact: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                              <option value="High">Ø¹Ø§Ù„ÙŠ</option>
                              <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                              <option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£Ø«Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ</label>
                            <select value={formData.operationalImpact || 'Low'} onChange={(e) => setFormData({ ...formData, operationalImpact: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                              <option value="High">Ø¹Ø§Ù„ÙŠ</option>
                              <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                              <option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù…Ø¹Ø©</label>
                            <select value={formData.reputationalImpact || 'Low'} onChange={(e) => setFormData({ ...formData, reputationalImpact: e.target.value })}
                              className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                              <option value="High">Ø¹Ø§Ù„ÙŠ</option>
                              <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                              <option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                            </select>
                          </div> </div> </div> </div>
                  )}

                  {executionStep === 3 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-6 border border-emerald-200">
                        <h3 className="text-lg font-bold text-emerald-800 mb-4 flex items-center gap-2">
                          <Zap className="w-5 h-5" />Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                        </h3>
                        <div className="space-y-4">
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙˆØµÙŠØ© / Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ *</label>
                            <textarea rows={3} value={formData.recommendation || ''} onChange={(e) => setFormData({ ...formData, recommendation: e.target.value })}
                              className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl focus:border-emerald-400 focus:outline-none bg-white resize-none"
                              placeholder="Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ" />
                          </div>

                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© *</label>
                              <div className="space-y-2 max-h-48 overflow-y-auto">
                                {TESTERS.map(user => {
                                  const isSelected = formData.responsibleId === user.id;
                                  return (
                                    <div key={user.id} onClick={() => setFormData({ ...formData, responsibleId: user.id })}
                                      className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300 bg-white'
                                        }`}>
                                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold ${isSelected ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'
                                        }`}>
                                        {user.name.charAt(0)}
                                      </div>
                                      <div>
                                        <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                                        <p className="text-xs text-slate-500">{user.role}</p>
                                      </div>
                                      {isSelected && <CheckCircle2 className="w-5 h-5 text-emerald-500 mr-auto" />}
                                    </div>);
                                })}
                              </div> </div>
                            <div className="space-y-4">
                              <div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                                <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl bg-white focus:border-emerald-400 focus:outline-none" />
                              </div>

                              <div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                                <div className="flex gap-2">
                                  {['Urgent', 'High', 'Normal'].map(priority => (
                                    <button key={priority} onClick={() => setFormData({ ...formData, priority })}
                                      className={`flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all ${formData.priority === priority
                                        ? priority === 'Urgent' ? 'border-red-500 bg-red-100 text-red-700'
                                          : priority === 'High' ? 'border-amber-500 bg-amber-100 text-amber-700'
                                            : 'border-emerald-500 bg-emerald-100 text-emerald-700'
                                        : 'border-slate-200 bg-white text-slate-600'
                                        }`}>
                                      {priority === 'Urgent' ? 'Ø¹Ø§Ø¬Ù„' : priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ø¹Ø§Ø¯ÙŠ'}
                                    </button>
                                  ))}
                                </div> </div> </div> </div> </div> </div>
                      <div className={`rounded-2xl p-6 border-2 transition-all ${formData.convertToCAPA ? 'bg-purple-50 border-purple-300' : 'bg-slate-50 border-slate-200'
                        }`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${formData.convertToCAPA ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-600'
                              }`}>
                              <GitBranch className="w-6 h-6" />
                            </div>
                            <div>
                              <h4 className="font-bold text-slate-800">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ CAPA</h4>
                              <p className="text-sm text-slate-500">Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡ ØªØµØ­ÙŠØ­ÙŠ/ÙˆÙ‚Ø§Ø¦ÙŠ Ù…Ø±ØªØ¨Ø·</p>
                            </div> </div>
                          <button onClick={() => setFormData({ ...formData, convertToCAPA: !formData.convertToCAPA })}
                            className={`w-14 h-8 rounded-full transition-all ${formData.convertToCAPA ? 'bg-purple-500' : 'bg-slate-300'
                              }`}>
                            <div className={`w-6 h-6 rounded-full bg-white shadow-md transition-all ${formData.convertToCAPA ? 'translate-x-7' : 'translate-x-1'
                              }`} />
                          </button> </div> </div> </div>
                  )}

                  {executionStep === 4 && (
                    <div className="space-y-6">
                      <div className="bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-6 border border-orange-200">
                        <h3 className="text-lg font-bold text-orange-800 mb-6 flex items-center gap-2">
                          <CheckCircle2 className="w-5 h-5" />Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                        </h3>

                        <div className="grid grid-cols-2 gap-6">
                          <div className="bg-white rounded-xl p-5 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                              <AlertTriangle className="w-4 h-4 text-orange-500" />Ø§Ù„ØªØµÙ†ÙŠÙ
                            </h4>
                            <div className="space-y-2 text-sm">
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span>
                                <span className="font-bold">{formData.code}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</span>
                                <span className="font-bold">{testCases.find(tc => tc.id === formData.testCaseId)?.code || '-'}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ±Ø©:</span>
                                <span className={`font-bold px-2 py-0.5 rounded ${SEVERITY_CONFIG[formData.severity]?.bg} ${SEVERITY_CONFIG[formData.severity]?.text}`}>
                                  {SEVERITY_CONFIG[formData.severity]?.label}
                                </span> </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„Ù†ÙˆØ¹:</span>
                                <span className="font-bold">{FINDING_TYPE_CONFIG[formData.findingType]?.label}</span>
                              </div> </div> </div>
                          <div className="bg-white rounded-xl p-5 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                              <FileText className="w-4 h-4 text-blue-500" />Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </h4>
                            <div className="space-y-2 text-sm">
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                                <span className="font-bold text-left max-w-[200px] truncate">{formData.title || '-'}</span>
                              </div>
                              <div>
                                <span className="text-slate-500">Ø§Ù„ÙˆØµÙ:</span>
                                <p className="text-slate-700 mt-1 text-xs line-clamp-2">{formData.description || '-'}</p>
                              </div> </div> </div>
                          <div className="bg-white rounded-xl p-5 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                              <Search className="w-4 h-4 text-indigo-500" />Ø§Ù„ØªØ­Ù„ÙŠÙ„
                            </h4>
                            <div className="space-y-2 text-sm">
                              <div>
                                <span className="text-slate-500">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ:</span>
                                <p className="text-slate-700 mt-1 text-xs line-clamp-2">{formData.rootCause || '-'}</p>
                              </div>
                              <div className="flex gap-2 mt-2">
                                <span className={`px-2 py-0.5 rounded text-xs ${formData.financialImpact === 'High' ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-600'}`}>
                                  Ù…Ø§Ù„ÙŠ: {formData.financialImpact || 'Low'}
                                </span>
                                <span className={`px-2 py-0.5 rounded text-xs ${formData.operationalImpact === 'High' ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-600'}`}>
                                  ØªØ´ØºÙŠÙ„ÙŠ: {formData.operationalImpact || 'Low'}
                                </span> </div> </div> </div>
                          <div className="bg-white rounded-xl p-5 border border-slate-200">
                            <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                              <Zap className="w-4 h-4 text-emerald-500" />Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                            </h4>
                            <div className="space-y-2 text-sm">
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span>
                                <span className="font-bold">{getUser(formData.responsibleId)?.name || '-'}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span>
                                <span className="font-bold">{formData.dueDate || '-'}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">CAPA:</span>
                                {formData.convertToCAPA ? (
                                  <span className="font-bold text-purple-600 flex items-center gap-1"><CheckCircle2 className="w-4 h-4" />Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</span>
                                ) : (
                                  <span className="text-slate-400">Ù„Ø§</span>
                                )}
                              </div> </div> </div> </div>
                        <div className="mt-6 p-4 bg-white rounded-xl border border-slate-200">
                          <h4 className="font-bold text-slate-700 mb-3">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                          <div className="grid grid-cols-3 gap-3">
                            {[
                              { label: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', valid: !!formData.testCaseId },
                              { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', valid: formData.title?.length >= 3 },
                              { label: 'Ø§Ù„ÙˆØµÙ', valid: formData.description?.length >= 10 },
                              { label: 'Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ', valid: formData.rootCause?.length >= 5 },
                              { label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', valid: !!formData.responsibleId },
                              { label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚', valid: !!formData.dueDate },
                            ].map((check, idx) => (
                              <div key={idx} className={`flex items-center gap-2 p-2 rounded-lg ${check.valid ? 'bg-emerald-50' : 'bg-red-50'}`}>
                                {check.valid ? <CheckCircle2 className="w-4 h-4 text-emerald-500" /> : <XCircle className="w-4 h-4 text-red-500" />}
                                <span className={`text-xs font-medium ${check.valid ? 'text-emerald-700' : 'text-red-700'}`}>{check.label}</span>
                              </div>
                            ))}
                          </div> </div> </div> </div>
                  )}
                </div>

                <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between">
                  <button onClick={() => executionStep > 0 ? setExecutionStep(executionStep - 1) : setShowModal(false)}
                    className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white transition-all">
                    <ChevronRight className="w-5 h-5" />
                    {executionStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
                  </button>

                  <div className="flex items-center gap-2">
                    {[0, 1, 2, 3, 4].map(step => (
                      <div key={step} className={`w-3 h-3 rounded-full transition-all ${executionStep === step ? 'bg-orange-500 w-8' : executionStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                    ))}
                  </div>

                  {executionStep < 4 ? (
                    <button onClick={() => setExecutionStep(executionStep + 1)}
                      className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-bold shadow-lg">
                      Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <button onClick={handleSave}
                      disabled={!formData.testCaseId || !formData.title || !formData.description}
                      className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                      <CheckCircle2 className="w-5 h-5" />ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
                    </button>
                  )}
                </div>
              </>
            )}
          </div> </div>
      )}

      {activeTab === 'capa' && (
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
              <Target className="w-6 h-6 text-purple-600" />
              Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© (CAPA)
            </h3>
            <button className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-xl font-bold">
              <Plus className="w-4 h-4" />Ø¥Ø¬Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
            </button> </div>
          <div className="grid grid-cols-2 gap-6">
            {correctiveActions.map(capa => {
              const finding = findings.find(f => f.id === capa.findingId);
              return (
                <div key={capa.id} className={`bg-white rounded-2xl border-2 p-5 ${capa.status === 'Completed' ? 'border-emerald-200' : capa.priority === 'Critical' ? 'border-red-300' : 'border-slate-200'}`}>
                  <div className="flex items-start justify-between mb-4">
                    <div>
                      <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${capa.priority === 'Critical' ? 'bg-red-100 text-red-700' : capa.priority === 'High' ? 'bg-orange-100 text-orange-700' : 'bg-amber-100 text-amber-700'}`}>
                        {capa.priority === 'Critical' ? 'Ø­Ø±Ø¬' : capa.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}
                      </span>
                      <h4 className="font-bold text-slate-800 mt-2">{capa.title}</h4>
                      <p className="text-sm text-slate-500 mt-1">{capa.description}</p>
                    </div>
                    <span className={`px-3 py-1 rounded-full text-xs font-bold ${capa.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : capa.status === 'InProgress' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'}`}>
                      {capa.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : capa.status === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…Ø¹Ù„Ù‚'}
                    </span> </div>
                  <div className="mb-4">
                    <div className="flex items-center justify-between text-sm mb-1">
                      <span className="text-slate-600">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                      <span className="font-bold text-slate-800">{capa.progress}%</span>
                    </div>
                    <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                      <div className={`h-full rounded-full ${capa.progress === 100 ? 'bg-emerald-500' : 'bg-purple-500'}`} style={{ width: `${capa.progress}%` }}></div>
                    </div> </div>
                  <div className="space-y-2">
                    {capa.milestones.map(milestone => (
                      <div key={milestone.id} className="flex items-center gap-3 p-2 bg-slate-50 rounded-lg">
                        <button onClick={() => handleUpdateCAPAProgress(capa.id, milestone.id, milestone.status === 'Completed' ? 'Pending' : 'Completed')}
                          className={`w-6 h-6 rounded-full flex items-center justify-center ${milestone.status === 'Completed' ? 'bg-emerald-500 text-white' : 'border-2 border-slate-300'}`}>
                          {milestone.status === 'Completed' && <Check className="w-4 h-4" />}
                        </button>
                        <span className={`flex-1 text-sm ${milestone.status === 'Completed' ? 'text-slate-400 line-through' : 'text-slate-700'}`}>{milestone.title}</span>
                        <span className="text-xs text-slate-400">{milestone.date}</span>
                      </div>
                    ))}
                  </div>

                  {finding && (
                    <div className="mt-4 pt-4 border-t border-slate-200">
                      <p className="text-xs text-slate-500">Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</p>
                      <p className="text-sm font-bold text-slate-700">{finding.code} - {finding.title}</p>
                    </div>
                  )}
                </div>);
            })}
          </div> </div>
      )}

      {activeTab === 'reports' && (
        <div className="p-6">
          <div className="grid grid-cols-4 gap-6 mb-6">
            {[
              { id: 'summary', title: 'ØªÙ‚Ø±ÙŠØ± Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', icon: FileText, color: 'purple', desc: 'Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª' },
              { id: 'effectiveness', title: 'ØªÙ‚Ø±ÙŠØ± ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: Shield, color: 'emerald', desc: 'ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©' },
              { id: 'tester', title: 'ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙŠÙ†', icon: Users, color: 'blue', desc: 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø£Ø¯Ø§Ø¡ ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' },
              { id: 'coverage', title: 'ØªÙ‚Ø±ÙŠØ± ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', icon: Target, color: 'amber', desc: 'ØªØ­Ù„ÙŠÙ„ ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª' },
            ].map(report => (
              <button key={report.id} onClick={() => setSelectedReportType(report.id)}
                className={`p-5 rounded-2xl border-2 text-right transition-all ${selectedReportType === report.id ? `border-${report.color}-400 bg-${report.color}-50` : 'border-slate-200 hover:border-slate-300'}`}>
                <div className={`w-12 h-12 rounded-xl bg-${report.color}-100 flex items-center justify-center mb-3`}>
                  <report.icon className={`w-6 h-6 text-${report.color}-600`} />
                </div>
                <h4 className="font-bold text-slate-800">{report.title}</h4>
                <p className="text-sm text-slate-500 mt-1">{report.desc}</p>
              </button>
            ))}
          </div>

          <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
            {selectedReportType === 'summary' && (
              <div>
                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <FileText className="w-6 h-6 text-purple-600" />
                  ØªÙ‚Ø±ÙŠØ± Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                </h3>
                <div className="grid grid-cols-4 gap-4 mb-6">
                  <div className="bg-purple-50 rounded-xl p-4 text-center">
                    <p className="text-3xl font-black text-purple-600">{stats.totalCases}</p>
                    <p className="text-sm text-purple-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>
                  </div>
                  <div className="bg-emerald-50 rounded-xl p-4 text-center">
                    <p className="text-3xl font-black text-emerald-600">{stats.passed}</p>
                    <p className="text-sm text-emerald-700">Ù†Ø§Ø¬Ø­</p>
                  </div>
                  <div className="bg-red-50 rounded-xl p-4 text-center">
                    <p className="text-3xl font-black text-red-600">{stats.failed}</p>
                    <p className="text-sm text-red-700">ÙØ§Ø´Ù„</p>
                  </div>
                  <div className="bg-amber-50 rounded-xl p-4 text-center">
                    <p className="text-3xl font-black text-amber-600">{stats.openFindings}</p>
                    <p className="text-sm text-amber-700">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙØªÙˆØ­Ø©</p>
                  </div> </div>
                <button onClick={() => handleGenerateReport('summary')} className="flex items-center gap-2 px-6 py-3 bg-purple-500 text-white rounded-xl font-bold">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button> </div>
            )}

            {selectedReportType === 'tester' && (
              <div>
                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Users className="w-6 h-6 text-blue-600" />
                  ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙŠÙ†
                </h3>
                <div className="space-y-4">
                  {TESTERS.slice(0, 4).map(tester => {
                    const perf = getTesterPerformance(tester.id);
                    return (
                      <div key={tester.id} className="flex items-center gap-4 p-4 bg-slate-50 rounded-xl">
                        <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center font-bold text-blue-600">
                          {tester.name.charAt(0)}
                        </div>
                        <div className="flex-1">
                          <p className="font-bold text-slate-800">{tester.name}</p>
                          <p className="text-sm text-slate-500">{tester.role}</p>
                        </div>
                        <div className="grid grid-cols-4 gap-6 text-center">
                          <div>
                            <p className="text-xl font-bold text-slate-800">{perf.total}</p>
                            <p className="text-xs text-slate-500">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>
                          </div>
                          <div>
                            <p className="text-xl font-bold text-emerald-600">{perf.passRate}%</p>
                            <p className="text-xs text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</p>
                          </div>
                          <div>
                            <p className="text-xl font-bold text-blue-600">{perf.avgCompletionDays}</p>
                            <p className="text-xs text-slate-500">Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªÙˆØ³Ø·</p>
                          </div>
                          <div>
                            <p className="text-xl font-bold text-purple-600">{perf.completed}</p>
                            <p className="text-xs text-slate-500">Ù…ÙƒØªÙ…Ù„</p>
                          </div> </div> </div>);
                  })}
                </div> </div>
            )}

            {selectedReportType === 'coverage' && (
              <div>
                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Target className="w-6 h-6 text-amber-600" />
                  ØªÙ‚Ø±ÙŠØ± ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                </h3>
                <div className="mb-6">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-bold text-slate-700">Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</span>
                    <span className="text-2xl font-black text-purple-600">{stats.coveragePercent}%</span>
                  </div>
                  <div className="h-4 bg-slate-100 rounded-full overflow-hidden">
                    <div className="h-full bg-gradient-to-r from-purple-500 to-indigo-500 rounded-full" style={{ width: `${stats.coveragePercent}%` }}></div>
                  </div> </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="p-4 bg-emerald-50 rounded-xl">
                    <p className="text-3xl font-black text-emerald-600">{stats.testedObligations}</p>
                    <p className="text-sm text-emerald-700">Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…Ø®ØªØ¨Ø±Ø©</p>
                  </div>
                  <div className="p-4 bg-red-50 rounded-xl">
                    <p className="text-3xl font-black text-red-600">{stats.totalObligations - stats.testedObligations}</p>
                    <p className="text-sm text-red-700">Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø±</p>
                  </div> </div> </div>
            )}

            {selectedReportType === 'effectiveness' && (
              <div>
                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Shield className="w-6 h-6 text-emerald-600" />
                  ØªÙ‚Ø±ÙŠØ± ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·
                </h3>
                <div className="space-y-3">
                  {CONTROLS.slice(0, 5).map(ctrl => {
                    const ctrlTests = testCases.filter(tc => tc.controlId === ctrl.id);
                    const passed = ctrlTests.filter(tc => tc.overallResult === 'Pass').length;
                    const effectiveness = ctrlTests.length > 0 ? Math.round((passed / ctrlTests.length) * 100) : 0;
                    return (
                      <div key={ctrl.id} className="flex items-center gap-4 p-3 bg-slate-50 rounded-xl">
                        <div className="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center">
                          <Shield className="w-5 h-5 text-emerald-600" />
                        </div>
                        <div className="flex-1">
                          <p className="font-bold text-slate-800 text-sm">{ctrl.name}</p>
                          <div className="flex items-center gap-2 mt-1">
                            <div className="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
                              <div className={`h-full rounded-full ${effectiveness >= 80 ? 'bg-emerald-500' : effectiveness >= 50 ? 'bg-amber-500' : 'bg-red-500'}`} style={{ width: `${effectiveness}%` }}></div>
                            </div>
                            <span className="text-sm font-bold text-slate-700">{effectiveness}%</span>
                          </div> </div> </div>);
                  })}
                </div> </div>
            )}
          </div> </div>
      )}

      {activeTab === 'scheduler' && (
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
              <Calendar className="w-6 h-6 text-indigo-600" />
              Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            </h3>
            <button onClick={() => setShowScheduler(true)} className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold">
              <Plus className="w-4 h-4" />Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button> </div>
          <div className="space-y-4">
            {scheduledTests.map(schedule => {
              const template = getTemplate(schedule.templateId);
              const authority = getAuthority(schedule.authorityId);
              const assignee = getUser(schedule.assigneeId);
              return (
                <div key={schedule.id} className={`bg-white rounded-2xl border-2 p-5 ${schedule.status === 'Active' ? 'border-indigo-200' : 'border-slate-200'}`}>
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${schedule.status === 'Active' ? 'bg-indigo-100' : 'bg-slate-100'}`}>
                        <Calendar className={`w-6 h-6 ${schedule.status === 'Active' ? 'text-indigo-600' : 'text-slate-400'}`} />
                      </div>
                      <div>
                        <h4 className="font-bold text-slate-800">{template?.title || 'Ù‚Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}</h4>
                        <p className="text-sm text-slate-500">
                          {schedule.frequency === 'Weekly' ? 'Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹' : schedule.frequency === 'Monthly' ? 'Ø´Ù‡Ø±ÙŠØ§Ù‹' : 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ'}
                          {' â€¢ '}{authority?.code || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </p> </div> </div>
                    <div className="flex items-center gap-4">
                      <div className="text-left">
                        <p className="text-xs text-slate-500">Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù…</p>
                        <p className="font-bold text-slate-800">{schedule.nextRun}</p>
                      </div>
                      {assignee && (
                        <div className="flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-lg">
                          <div className="w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-xs font-bold text-indigo-600">
                            {assignee.name.charAt(0)}
                          </div>
                          <span className="text-sm text-slate-700">{assignee.name}</span>
                        </div>
                      )}
                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${schedule.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>
                        {schedule.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…ØªÙˆÙ‚Ù'}
                      </span>
                      <button className="p-2 hover:bg-slate-100 rounded-lg">
                        <MoreVertical className="w-4 h-4 text-slate-400" />
                      </button> </div> </div> </div>);
            })}
          </div> </div>
      )}

      {showMobileExecution && (
        <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center">
          <div className="bg-white w-full h-full md:rounded-3xl md:w-[480px] md:h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-cyan-600 to-blue-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Maximize2 className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-black">Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</h2>
                    <p className="text-cyan-200 text-sm">Mobile Test Execution</p>
                  </div> </div>
                <button onClick={() => setShowMobileExecution(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className={`flex items-center justify-between p-4 rounded-xl ${offlineMode ? 'bg-amber-50 border-2 border-amber-200' : 'bg-emerald-50 border-2 border-emerald-200'}`}>
                <div className="flex items-center gap-3">
                  {offlineMode ? <AlertCircle className="w-6 h-6 text-amber-600" /> : <Globe className="w-6 h-6 text-emerald-600" />}
                  <span className={`font-bold ${offlineMode ? 'text-amber-700' : 'text-emerald-700'}`}>
                    {offlineMode ? 'ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„' : 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'}
                  </span> </div>
                <button onClick={handleToggleOfflineMode} className={`px-4 py-2 rounded-xl font-bold text-sm ${offlineMode ? 'bg-amber-500 text-white' : 'bg-emerald-500 text-white'}`}>
                  {offlineMode ? 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„' : 'ØªØ¹Ø·ÙŠÙ„'}
                </button> </div>
              <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <div className="flex items-center justify-between mb-3">
                  <span className="font-bold text-slate-700 flex items-center gap-2">
                    <MapPin className="w-5 h-5 text-blue-500" />
                    Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
                  </span>
                  <button onClick={captureGPSLocation} className="px-3 py-1.5 bg-blue-500 text-white rounded-lg text-sm font-bold">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                  </button> </div>
                {gpsLocation ? (
                  <div className="text-sm text-slate-600">
                    <p>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: {gpsLocation.lat.toFixed(6)}</p>
                    <p>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: {gpsLocation.lng.toFixed(6)}</p>
                    <p className="text-xs text-slate-400 mt-1">Ø§Ù„Ø¯Ù‚Ø©: {gpsLocation.accuracy}Ù…</p>
                  </div>
                ) : (
                  <p className="text-sm text-slate-400">Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</p>
                )}
              </div>

              <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <div className="flex items-center justify-between mb-3">
                  <span className="font-bold text-slate-700 flex items-center gap-2">
                    <Eye className="w-5 h-5 text-purple-500" />
                    Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±
                  </span>
                  <button onClick={() => handlePhotoCapture(1)} className="px-3 py-1.5 bg-purple-500 text-white rounded-lg text-sm font-bold">
                    Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
                  </button> </div>
                <div className="grid grid-cols-4 gap-2">
                  {capturedPhotos.map(photo => (
                    <div key={photo.id} className="aspect-square bg-slate-200 rounded-lg flex items-center justify-center">
                      <Eye className="w-6 h-6 text-slate-400" />
                    </div>
                  ))}
                  <div className="aspect-square border-2 border-dashed border-slate-300 rounded-lg flex items-center justify-center">
                    <Plus className="w-6 h-6 text-slate-400" />
                  </div> </div> </div>
              <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <span className="font-bold text-slate-700 flex items-center gap-2 mb-3">
                  <CheckSquare className="w-5 h-5 text-emerald-500" />
                  Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚
                </span>
                <div className="space-y-2">
                  {testChecklists[0].items.map(item => (
                    <div key={item.id} className="flex items-center gap-3 p-2 bg-white rounded-lg">
                      <button className={`w-6 h-6 rounded-full flex items-center justify-center ${item.checked ? 'bg-emerald-500 text-white' : 'border-2 border-slate-300'}`}>
                        {item.checked && <Check className="w-4 h-4" />}
                      </button>
                      <span className={`flex-1 text-sm ${item.checked ? 'text-slate-400 line-through' : 'text-slate-700'}`}>{item.text}</span>
                      {item.required && <span className="text-red-500 text-xs">*</span>}
                    </div>
                  ))}
                </div> </div>
              <button onClick={() => setShowSignatureModal(true)} className="w-full flex items-center justify-center gap-3 p-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold">
                <Edit className="w-5 h-5" />
                Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
              </button> </div> </div> </div>
      )}

      {showSignatureModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                  <Edit className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-black">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
                  <p className="text-indigo-200 text-sm">Digital Signature</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-slate-100 rounded-xl p-8 mb-4 border-2 border-dashed border-slate-300 text-center">
                <Edit className="w-12 h-12 text-slate-300 mx-auto mb-2" />
                <p className="text-slate-500">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</p>
                <p className="text-xs text-slate-400 mt-2">Ø§Ù„Ù…Ø³ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„Ø±Ø³Ù…</p>
              </div>
              <div className="flex items-center gap-4 mb-4">
                <div className="flex-1">
                  <p className="text-sm text-slate-500">Ø§Ù„Ù…ÙˆÙ‚Ù‘Ø¹</p>
                  <p className="font-bold text-slate-800">{CURRENT_USER.name}</p>
                </div>
                <div className="flex-1">
                  <p className="text-sm text-slate-500">Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                  <p className="font-bold text-slate-800">{new Date().toLocaleDateString('ar-SA')}</p>
                </div> </div>
              {digitalSignature && (
                <div className="bg-emerald-50 rounded-xl p-4 mb-4 border border-emerald-200">
                  <div className="flex items-center gap-2 text-emerald-700">
                    <CheckCircle2 className="w-5 h-5" />
                    <span className="font-bold">ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­</span>
                  </div>
                  <p className="text-xs text-emerald-600 mt-1">{digitalSignature.hash}</p>
                </div>
              )}
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowSignatureModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => handleDigitalSignature({ id: 1 })} className="flex items-center gap-2 px-6 py-2.5 bg-indigo-500 text-white rounded-xl font-bold">
                <CheckCircle2 className="w-5 h-5" />ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
              </button> </div> </div> </div>
      )}

      {showDeleteConfirm && deleteTarget && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Trash2 className="w-6 h-6" /></div>
                <div><h2 className="text-xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2></div>
              </div> </div>
            <div className="p-6">
              <p className="text-slate-600">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù:</p>
              <p className="font-bold text-slate-800 mt-2">{deleteTarget.code} - {deleteTarget.title}</p>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowDeleteConfirm(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDelete} className="flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-bold">
                <Trash2 className="w-5 h-5" />Ø­Ø°Ù
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 4.7: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ÙˆØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
// Regulatory Breach & Compliance Violations Management - World-Class Edition
// Features: Auto Triggers, CAPA, RCA, Exception Workflow, Golden Thread

const ViolationsManagement = () => {
  const { can, currentUser, guardAction, checkSoD } = useAuth();

  // STATE MANAGEMENT
  const [activeTab, setActiveTab] = useState('command');
  const [selectedBreach, setSelectedBreach] = useState(null);
  const [breachTab, setBreachTab] = useState('summary');
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('create');
  const [modalType, setModalType] = useState('breach'); // breach | action | exception
  const [formData, setFormData] = useState(null);
  const [wizardStep, setWizardStep] = useState(0);
  const [notification, setNotification] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterSeverity, setFilterSeverity] = useState('');
  const [filterAuthority, setFilterAuthority] = useState('');
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteTarget, setDeleteTarget] = useState(null);
  const [viewMode, setViewMode] = useState('table'); // table | cards | kanban | timeline | matrix

  // DOA Approval Workflow States (Module 0.6)
  const [showApprovalModal, setShowApprovalModal] = useState(false);
  const [approvalTarget, setApprovalTarget] = useState(null);
  const [approvalNotes, setApprovalNotes] = useState('');
  const [pendingApprovals, setPendingApprovals] = useState([]);

  const [showFinancialCalculator, setShowFinancialCalculator] = useState(false);
  const [showPenaltyEstimator, setShowPenaltyEstimator] = useState(false);
  const [financialImpactData, setFinancialImpactData] = useState({
    directCost: 0, indirectCost: 0, operationalLoss: 0, reputationalDamage: 0,
    remediationCost: 0, legalFees: 0, insuranceClaim: 0, recoveryTime: 0
  });
  const [penaltyEstimate, setPenaltyEstimate] = useState({
    basePenalty: 0, aggravatingFactors: [], mitigatingFactors: [],
    repeatViolation: false, voluntaryDisclosure: false, cooperationLevel: 'Standard'
  });

  const [showCAPAModal, setShowCAPAModal] = useState(false);
  const [selectedCAPA, setSelectedCAPA] = useState(null);
  const [capaFormData, setCAPAFormData] = useState({
    type: 'Corrective', priority: 'High', category: '', description: '', rootCause: '', preventiveAction: '',
    milestones: [], targetDate: '', assignedTo: '', verifier: '',
    effectivenessReviewDate: '', effectivenessCriteria: '',
    evidence: [], status: 'Draft'
  });

  // CAPA Records
  const [capaRecords, setCAPARecords] = useState([
    {
      id: 1, breachId: 1, code: 'CAPA-2025-001', type: 'Corrective',
      priority: 'High', category: 'Process', status: 'InProgress',
      description: 'ØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©',
      rootCause: 'Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø³Ø¨Ù‚Ø© ÙƒØ§ÙÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',
      preventiveAction: 'ØªØ·Ø¨ÙŠÙ‚ Ù†Ø¸Ø§Ù… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª (30/15/7/1 ÙŠÙˆÙ…)',
      milestones: [
        { id: 1, title: 'ØªØ­Ø¯ÙŠØ¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', dueDate: '2025-02-01', status: 'Done', completedDate: '2025-01-28', evidence: 'REQ-001.pdf' },
        { id: 2, title: 'ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', dueDate: '2025-02-15', status: 'Done', completedDate: '2025-02-10', evidence: 'DEV-001.pdf' },
        { id: 3, title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…', dueDate: '2025-02-20', status: 'InProgress', completedDate: null, evidence: null },
        { id: 4, title: 'Ù†Ø´Ø± Ø§Ù„Ù†Ø¸Ø§Ù…', dueDate: '2025-02-28', status: 'Pending', completedDate: null, evidence: null },
      ],
      targetDate: '2025-02-28', assignedTo: 2, verifier: 1,
      effectivenessReviewDate: '2025-04-01', effectivenessCriteria: 'Ø¹Ø¯Ù… Ø­Ø¯ÙˆØ« ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø®Ù„Ø§Ù„ 60 ÙŠÙˆÙ…',
      effectivenessStatus: 'Pending', effectivenessNotes: '', evidence: ['improvement_plan.pdf', 'system_design.pdf'],
      createdAt: '2025-01-20', createdBy: 1
    },
    {
      id: 2, breachId: 2, code: 'CAPA-2025-002', type: 'Preventive',
      priority: 'Critical', category: 'Training', status: 'Open', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ø´Ø§Ù…Ù„ Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      rootCause: 'Ø¹Ø¯Ù… ÙˆØ¶ÙˆØ­ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ø¯Ù‰ Ø§Ù„ÙØ±ÙŠÙ‚', preventiveAction: 'Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ø¯ÙˆØ±ÙŠ ÙˆÙ‚ÙˆØ§Ù„Ø¨ Ù…ÙˆØ­Ø¯Ø©',
      milestones: [
        { id: 1, title: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ', dueDate: '2025-03-01', status: 'InProgress', completedDate: null, evidence: null },
        { id: 2, title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', dueDate: '2025-03-05', status: 'Pending', completedDate: null, evidence: null },
        { id: 3, title: 'ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰', dueDate: '2025-03-15', status: 'Pending', completedDate: null, evidence: null },
      ],
      targetDate: '2025-03-15', assignedTo: 4, verifier: 3,
      effectivenessReviewDate: '2025-05-15', effectivenessCriteria: 'Ù†Ø¬Ø§Ø­ 100% Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
      effectivenessStatus: 'NotStarted', effectivenessNotes: '', evidence: [],
      createdAt: '2025-02-22', createdBy: 1
    },]);
  const [showAcceptanceModal, setShowAcceptanceModal] = useState(false);
  const [acceptanceFormData, setAcceptanceFormData] = useState({
    reason: '', businessJustification: '', riskLevel: 'Medium', compensatingControls: '', acceptanceCriteria: '',
    expiryDate: '', reviewFrequency: 'Quarterly',
    approvers: [], conditions: [], attachments: []
  });

  const [riskAcceptances, setRiskAcceptances] = useState([
    {
      id: 1, breachId: 5, code: 'RA-2025-001', status: 'Approved',
      reason: 'ØªØ£Ø®Ø± Ø¨Ø³Ø¨Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
      businessJustification: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø¶Ø±ÙˆØ±ÙŠ Ù„ØªÙ„Ø¨ÙŠØ© Ù…ØªØ·Ù„Ø¨Ø§Øª ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©',
      riskLevel: 'Low', compensatingControls: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù‡ÙŠØ¦Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø©',
      acceptanceCriteria: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© Ø®Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ù‡ÙŠØ¦Ø©', expiryDate: '2025-04-01', reviewFrequency: 'Monthly',
      approvers: [
        { userId: 3, role: 'Compliance Manager', status: 'Approved', date: '2025-02-05', notes: 'Ù…ÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø´Ø±ÙˆØ·' },
        { userId: 1, role: 'CISO', status: 'Approved', date: '2025-02-06', notes: '' },
      ],
      conditions: ['ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙˆØ± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù‡ÙŠØ¦Ø© Ø¨Ø§Ù„ØªÙ‚Ø¯Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹'],
      attachments: ['regulator_approval.pdf'], nextReviewDate: '2025-03-01', lastReviewDate: '2025-02-01',
      createdAt: '2025-02-01', createdBy: 5
    },]);
  const [autoDetectedViolations, setAutoDetectedViolations] = useState([
    { id: 1, type: 'OverdueObligation', sourceId: 'OBL-005', title: 'Ø§Ù„ØªØ²Ø§Ù… ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù…ØªØ£Ø®Ø± 7 Ø£ÙŠØ§Ù…', severity: 'High', detectedAt: '2025-02-05T09:00:00', acknowledged: false },
    { id: 2, type: 'FailedTest', sourceId: 'TST-012', title: 'ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø¶Ø§Ø¨Ø·', severity: 'Medium', detectedAt: '2025-02-04T14:30:00', acknowledged: false },
    { id: 3, type: 'RepeatedViolation', sourceId: 'BRH-2025-001', title: 'Ù…Ø®Ø§Ù„ÙØ© Ù…ØªÙƒØ±Ø±Ø© (3 Ù…Ø±Ø§Øª)', severity: 'Critical', detectedAt: '2025-02-03T11:00:00', acknowledged: true },
  ]);

  const [reportType, setReportType] = useState('aging');
  const [reportDateRange, setReportDateRange] = useState({ from: '', to: '' });
  const [reportDepartment, setReportDepartment] = useState('');

  // Current User (Use from Auth Context)
  const CURRENT_USER = currentUser || { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' };

  const PENALTY_CONFIG = {
    NCA: { // Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ
      basePenalties: {
        Critical: { min: 500000, max: 5000000 }, High: { min: 100000, max: 1000000 }, Medium: { min: 50000, max: 500000 },
        Low: { min: 10000, max: 100000 },
      },
      aggravatingFactors: [
        { id: 'repeat', label: 'Ù…Ø®Ø§Ù„ÙØ© Ù…ØªÙƒØ±Ø±Ø©', multiplier: 2.0 },
        { id: 'data_breach', label: 'ØªØ³Ø±ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª', multiplier: 1.5 },
        { id: 'non_cooperation', label: 'Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§ÙˆÙ†', multiplier: 1.3 },
        { id: 'delayed_reporting', label: 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', multiplier: 1.2 },
      ],
      mitigatingFactors: [
        { id: 'voluntary', label: 'Ø¥ÙØµØ§Ø­ Ø·ÙˆØ¹ÙŠ', discount: 0.3 },
        { id: 'full_cooperation', label: 'ØªØ¹Ø§ÙˆÙ† ÙƒØ§Ù…Ù„', discount: 0.2 },
        { id: 'immediate_fix', label: 'Ø¥ØµÙ„Ø§Ø­ ÙÙˆØ±ÙŠ', discount: 0.15 },
        { id: 'first_offense', label: 'Ø£ÙˆÙ„ Ù…Ø®Ø§Ù„ÙØ©', discount: 0.1 },
      ]
    },
    SAMA: { // Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
      basePenalties: {
        Critical: { min: 1000000, max: 10000000 }, High: { min: 500000, max: 2000000 }, Medium: { min: 100000, max: 500000 },
        Low: { min: 25000, max: 100000 },
      },
      aggravatingFactors: [
        { id: 'customer_harm', label: 'Ø¶Ø±Ø± Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡', multiplier: 2.5 },
        { id: 'repeat', label: 'Ù…Ø®Ø§Ù„ÙØ© Ù…ØªÙƒØ±Ø±Ø©', multiplier: 2.0 },
        { id: 'financial_loss', label: 'Ø®Ø³Ø§Ø±Ø© Ù…Ø§Ù„ÙŠØ©', multiplier: 1.5 },
        { id: 'systemic_risk', label: 'Ø®Ø·Ø± Ù…Ù†Ù‡Ø¬ÙŠ', multiplier: 1.8 },
      ],
      mitigatingFactors: [
        { id: 'voluntary', label: 'Ø¥ÙØµØ§Ø­ Ø·ÙˆØ¹ÙŠ', discount: 0.25 },
        { id: 'customer_compensation', label: 'ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', discount: 0.2 },
        { id: 'enhanced_controls', label: 'ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', discount: 0.15 },
      ]
    },
    NDMO: { // Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      basePenalties: {
        Critical: { min: 3000000, max: 5000000 }, High: { min: 1000000, max: 3000000 }, Medium: { min: 500000, max: 1000000 },
        Low: { min: 100000, max: 500000 },
      },
      aggravatingFactors: [
        { id: 'pii_exposure', label: 'ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©', multiplier: 2.0 },
        { id: 'cross_border', label: 'Ù†Ù‚Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯', multiplier: 1.8 },
        { id: 'sensitive_data', label: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø©', multiplier: 1.5 },
      ],
      mitigatingFactors: [
        { id: 'dpo_appointed', label: 'ØªØ¹ÙŠÙŠÙ† DPO', discount: 0.15 },
        { id: 'privacy_program', label: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØµÙˆØµÙŠØ©', discount: 0.2 },
      ]
    }
  };

  // Financial Impact Categories
  const FINANCIAL_IMPACT_CATEGORIES = [
    { id: 'directCost', label: 'Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©', icon: DollarSign, color: 'red', description: 'ØºØ±Ø§Ù…Ø§ØªØŒ ØªØ¹ÙˆÙŠØ¶Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©' },
    { id: 'indirectCost', label: 'Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ØºÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©', icon: TrendingDown, color: 'orange', description: 'ÙÙ‚Ø¯Ø§Ù† Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª' },
    { id: 'operationalLoss', label: 'Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©', icon: Activity, color: 'amber', description: 'ØªÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ§ØªØŒ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©' },
    { id: 'reputationalDamage', label: 'Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø³Ù…Ø¹ÙŠ', icon: TrendingDown, color: 'purple', description: 'ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©' },
    { id: 'remediationCost', label: 'ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: Wrench, color: 'blue', description: 'Ø¥ØµÙ„Ø§Ø­ØŒ Ø§Ø³ØªØ´Ø§Ø±Ø§ØªØŒ ØªØ·ÙˆÙŠØ±' },
    { id: 'legalFees', label: 'Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', icon: Scale, color: 'slate', description: 'Ù…Ø­Ø§Ù…Ø§Ø©ØŒ ØªÙ‚Ø§Ø¶ÙŠØŒ ØªØ³ÙˆÙŠØ§Øª' },
  ];

  // BREACHES DATA
  const [breaches, setBreaches] = useState([
    {
      id: 1, code: 'BRH-2025-001', authorityId: 1, frameworkId: 1, obligationId: 1, controlId: 1, riskId: 1,
      sourceType: 'TaskOverdue', sourceRefId: 101, title: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
      description: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ù€ 15 ÙŠÙˆÙ…',
      severity: 'High', regulatoryExposure: ['Penalty', 'Reputation'],
      breachDate: '2025-01-15', dueDate: '2025-02-15', status: 'Open',
      financialImpact: {
        directCost: 0, indirectCost: 50000, operationalLoss: 0,
        reputationalDamage: 100000, remediationCost: 25000, legalFees: 10000,
        totalEstimate: 185000, calculatedAt: '2025-01-20'
      },
      penaltyEstimate: { min: 100000, max: 500000, likely: 250000, authority: 'SAMA' },
      department: 'Compliance', repeatCount: 0,
      ownerId: 2, reviewerId: 1, approverId: 3, escalationLevel: 1,
      actions: [
        { id: 1, type: 'ImmediateFix', description: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙˆØ±Ø§Ù‹', responsibleId: 2, dueDate: '2025-01-20', status: 'Done' },
        { id: 2, type: 'RootCause', description: 'ØªØ­Ù„ÙŠÙ„ Ø³Ø¨Ø¨ Ø§Ù„ØªØ£Ø®ÙŠØ±', responsibleId: 2, dueDate: '2025-01-25', status: 'Open' },
      ],
      rca: { category: 'Process', rootCause: 'Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø³Ø¨Ù‚Ø©', linkedControlGap: 'Ø¶Ø¹Ù ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' },
      closureEvidence: [], exceptions: [], escalationHistory: [
        { date: '2025-01-20', level: 1, reason: 'ØªØ¬Ø§ÙˆØ² 5 Ø£ÙŠØ§Ù…', notifiedUsers: [1, 3] }
      ],
      createdAt: '2025-01-15', createdBy: 1,
    },
    {
      id: 2, code: 'BRH-2025-002', authorityId: 3, frameworkId: 5, obligationId: 5, controlId: 6, riskId: 2,
      sourceType: 'TestFail', sourceRefId: 4, title: 'ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      description: 'ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ - ÙˆØ¬ÙˆØ¯ Ø­ÙˆØ§Ø¯Ø« ØºÙŠØ± Ù…ÙˆØ«Ù‚Ø©',
      severity: 'Critical', regulatoryExposure: ['Penalty', 'License', 'Reputation'],
      breachDate: '2025-02-20', dueDate: '2025-03-20', status: 'UnderReview',
      financialImpact: {
        directCost: 0, indirectCost: 200000, operationalLoss: 150000,
        reputationalDamage: 500000, remediationCost: 100000, legalFees: 50000,
        totalEstimate: 1000000, calculatedAt: '2025-02-22'
      },
      penaltyEstimate: { min: 500000, max: 5000000, likely: 1500000, authority: 'NCA' },
      department: 'IT Security', repeatCount: 1,
      ownerId: 3, reviewerId: 1, approverId: 3, escalationLevel: 2,
      actions: [
        { id: 1, type: 'ImmediateFix', description: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©', responsibleId: 3, dueDate: '2025-02-25', status: 'Done' },
        { id: 2, type: 'ControlUpdate', description: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', responsibleId: 3, dueDate: '2025-03-01', status: 'Open' },
        { id: 3, type: 'Training', description: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', responsibleId: 4, dueDate: '2025-03-10', status: 'Open' },
      ],
      rca: { category: 'People', rootCause: 'Ø¹Ø¯Ù… ÙˆØ¶ÙˆØ­ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚', linkedControlGap: 'Ù†Ù‚Øµ Ø§Ù„ØªØ¯Ø±ÙŠØ¨' },
      closureEvidence: [], exceptions: [], escalationHistory: [
        { date: '2025-02-22', level: 1, reason: 'Ù…Ø®Ø§Ù„ÙØ© Critical', notifiedUsers: [1, 3] },
        { date: '2025-02-25', level: 2, reason: 'ØªØ¬Ø§ÙˆØ² 5 Ø£ÙŠØ§Ù…', notifiedUsers: [1, 3, 5] },
      ],
      createdAt: '2025-02-20', createdBy: 1,
    },
    {
      id: 3, code: 'BRH-2025-003', authorityId: 1, frameworkId: 2, obligationId: 2, controlId: 2, riskId: 1,
      sourceType: 'EvidenceRejected', sourceRefId: 7, title: 'Ø±ÙØ¶ Ø¯Ù„ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª',
      description: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø±ØªÙŠÙ† Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      severity: 'Medium', regulatoryExposure: ['Penalty'],
      breachDate: '2025-02-10', dueDate: '2025-03-10', status: 'Remediation',
      financialImpact: {
        directCost: 0, indirectCost: 20000, operationalLoss: 10000,
        reputationalDamage: 30000, remediationCost: 15000, legalFees: 5000,
        totalEstimate: 80000, calculatedAt: '2025-02-12'
      },
      penaltyEstimate: { min: 50000, max: 200000, likely: 100000, authority: 'SAMA' },
      department: 'Operations', repeatCount: 2,
      ownerId: 2, reviewerId: 1, approverId: 3, escalationLevel: 0,
      actions: [
        { id: 1, type: 'ImmediateFix', description: 'Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©', responsibleId: 2, dueDate: '2025-02-15', status: 'Done' },
        { id: 2, type: 'ProcessUpdate', description: 'ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', responsibleId: 2, dueDate: '2025-02-20', status: 'Done' },
      ],
      rca: { category: 'Process', rootCause: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØºÙŠØ± Ù…ÙƒØªÙ…Ù„', linkedControlGap: 'Ø¹Ø¯Ù… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¯ÙˆØ±ÙŠØ§Ù‹' },
      closureEvidence: [{ id: 1, evidenceId: 8, acceptedBy: 1, acceptedAt: '2025-02-18' }],
      exceptions: [], escalationHistory: [], createdAt: '2025-02-10', createdBy: 1,
    },
    {
      id: 4, code: 'BRH-2025-004', authorityId: 4, frameworkId: 7, obligationId: 4, controlId: 3, riskId: 3,
      sourceType: 'ExternalInspection', sourceRefId: null, title: 'Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙØªÙŠØ´ÙŠØ© - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      description: 'Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù† Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙˆÙ„ Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø³Ø¬Ù„ Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
      severity: 'High', regulatoryExposure: ['Penalty', 'Operational'],
      breachDate: '2025-01-25', dueDate: '2025-02-25', status: 'Closed',
      financialImpact: {
        directCost: 0, indirectCost: 0, operationalLoss: 20000,
        reputationalDamage: 50000, remediationCost: 30000, legalFees: 10000,
        totalEstimate: 110000, calculatedAt: '2025-01-27'
      },
      penaltyEstimate: { min: 100000, max: 1000000, likely: 300000, authority: 'NDMO' },
      department: 'Data Privacy', repeatCount: 0,
      ownerId: 4, reviewerId: 1, approverId: 3, escalationLevel: 0,
      actions: [
        { id: 1, type: 'ImmediateFix', description: 'Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø³Ø¬Ù„ ROPA', responsibleId: 4, dueDate: '2025-02-01', status: 'Done' },
        { id: 2, type: 'PolicyUpdate', description: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚', responsibleId: 4, dueDate: '2025-02-10', status: 'Done' },
      ],
      rca: { category: 'System', rootCause: 'Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ Ù„Ù„ØªØªØ¨Ø¹', linkedControlGap: 'ÙŠØ¯ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©' },
      closureEvidence: [
        { id: 1, evidenceId: 10, acceptedBy: 1, acceptedAt: '2025-02-12' },
        { id: 2, evidenceId: 11, acceptedBy: 1, acceptedAt: '2025-02-15' },
      ],
      exceptions: [], escalationHistory: [], closedAt: '2025-02-20', closedBy: 3, createdAt: '2025-01-25', createdBy: 1,
    },
    {
      id: 5, code: 'BRH-2025-005', authorityId: 2, frameworkId: 4, obligationId: 6, controlId: 7, riskId: 4,
      sourceType: 'TaskOverdue', sourceRefId: 105, title: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥ÙØµØ§Ø­ Ù„Ù„Ù‡ÙŠØ¦Ø©',
      description: 'ØªØ£Ø®Ø± ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
      severity: 'Low', regulatoryExposure: ['Reputation'],
      breachDate: '2025-02-01', dueDate: '2025-04-01', status: 'AcceptedException',
      financialImpact: null, penaltyEstimate: null, department: 'Finance', repeatCount: 0,
      ownerId: 5, reviewerId: 1, approverId: 3, escalationLevel: 0,
      actions: [], rca: null, closureEvidence: [],
      exceptions: [{
        id: 1, reason: 'ØªØ£Ø®Ø± Ø¨Ø³Ø¨Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… - ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ù‡ÙŠØ¦Ø©', approvedBy: 3, expiryDate: '2025-04-01', status: 'Active'
      }],
      escalationHistory: [], createdAt: '2025-02-01', createdBy: 1,
    },]);
  // CONFIGURATIONS
  const SEVERITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', icon: AlertTriangle, bg: 'bg-red-600', light: 'bg-red-100', text: 'text-red-700', border: 'border-red-500' },
    High: { label: 'Ø¹Ø§Ù„ÙŠ', icon: AlertCircle, bg: 'bg-orange-500', light: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-500' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', icon: AlertCircle, bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-500' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', icon: Info, bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-500' },
  };

  const STATUS_CONFIG = {
    Open: { label: 'Ù…ÙØªÙˆØ­', icon: AlertCircle, bg: 'bg-red-100', text: 'text-red-700' },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye, bg: 'bg-blue-100', text: 'text-blue-700' },
    Remediation: { label: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: Zap, bg: 'bg-amber-100', text: 'text-amber-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
    AcceptedException: { label: 'Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù…Ø¹ØªÙ…Ø¯', icon: Shield, bg: 'bg-purple-100', text: 'text-purple-700' },
  };

  const SOURCE_TYPE_CONFIG = {
    TaskOverdue: { label: 'Ù…Ù‡Ù…Ø© Ù…ØªØ£Ø®Ø±Ø©', icon: Clock, color: 'amber' },
    EvidenceRejected: { label: 'Ø¯Ù„ÙŠÙ„ Ù…Ø±ÙÙˆØ¶', icon: XCircle, color: 'red' },
    TestFail: { label: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ§Ø´Ù„', icon: FileWarning, color: 'orange' },
    ExternalInspection: { label: 'ØªÙØªÙŠØ´ Ø®Ø§Ø±Ø¬ÙŠ', icon: Building2, color: 'purple' },
  };

  const EXPOSURE_CONFIG = {
    Penalty: { label: 'ØºØ±Ø§Ù…Ø© Ù…Ø§Ù„ÙŠØ©', icon: Scale, color: 'red' },
    License: { label: 'ØªØ±Ø®ÙŠØµ', icon: FileText, color: 'purple' },
    Reputation: { label: 'Ø³Ù…Ø¹Ø©', icon: Globe, color: 'amber' },
    Operational: { label: 'ØªØ´ØºÙŠÙ„ÙŠ', icon: Activity, color: 'blue' },
  };

  const ACTION_TYPE_CONFIG = {
    ImmediateFix: { label: 'Ø¥ØµÙ„Ø§Ø­ ÙÙˆØ±ÙŠ', icon: Zap, color: 'red' },
    RootCause: { label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨', icon: Search, color: 'indigo' },
    ControlUpdate: { label: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¶Ø§Ø¨Ø·', icon: Shield, color: 'blue' },
    Training: { label: 'ØªØ¯Ø±ÙŠØ¨', icon: Users, color: 'emerald' },
    PolicyUpdate: { label: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø³Ø©', icon: FileText, color: 'purple' },
    ProcessUpdate: { label: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', icon: GitBranch, color: 'amber' },
  };

  const RCA_CATEGORY_CONFIG = {
    People: { label: 'Ø§Ù„Ø£ÙØ±Ø§Ø¯', icon: Users, color: 'blue' },
    Process: { label: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', icon: GitBranch, color: 'amber' },
    System: { label: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', icon: Settings, color: 'purple' },
    ThirdParty: { label: 'Ø·Ø±Ù Ø«Ø§Ù„Ø«', icon: Building2, color: 'slate' },
  };

  const USERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' },
    { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Compliance Analyst' },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'Compliance Approver' },
    { id: 4, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Data Protection Officer' },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Governance Analyst' },
  ];

  // COMPUTED STATISTICS
  const stats = useMemo(() => {
    const open = breaches.filter(b => b.status === 'Open').length;
    const underReview = breaches.filter(b => b.status === 'UnderReview').length;
    const remediation = breaches.filter(b => b.status === 'Remediation').length;
    const closed = breaches.filter(b => b.status === 'Closed').length;
    const exceptions = breaches.filter(b => b.status === 'AcceptedException').length;

    const critical = breaches.filter(b => b.severity === 'Critical' && b.status !== 'Closed').length;
    const high = breaches.filter(b => b.severity === 'High' && b.status !== 'Closed').length;

    const overdue = breaches.filter(b => {
      if (b.status === 'Closed' || b.status === 'AcceptedException') return false;
      return new Date(b.dueDate) < new Date();
    }).length;

    const totalActions = breaches.reduce((sum, b) => sum + (b.actions?.length || 0), 0);
    const doneActions = breaches.reduce((sum, b) => sum + (b.actions?.filter(a => a.status === 'Done').length || 0), 0);

    const penaltyExposure = breaches.filter(b => b.regulatoryExposure?.includes('Penalty') && b.status !== 'Closed').length;
    const licenseExposure = breaches.filter(b => b.regulatoryExposure?.includes('License') && b.status !== 'Closed').length;

    return {
      total: breaches.length, open, underReview, remediation, closed, exceptions,
      critical, high, overdue, totalActions, doneActions, penaltyExposure, licenseExposure,
      activeBreaches: open + underReview + remediation,
    };
  }, [breaches]);

  // HELPER FUNCTIONS
  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const getUser = (id) => USERS.find(u => u.id === id);
  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);
  const getObligation = (id) => INITIAL_OBLIGATIONS.find(o => o.id === id);
  const getControl = (id) => CONTROLS.find(c => c.id === id);

  const getDaysUntilDue = (dueDate) => {
    if (!dueDate) return null;
    return Math.ceil((new Date(dueDate) - new Date()) / (1000 * 60 * 60 * 24));
  };

  const filteredBreaches = useMemo(() => {
    return breaches.filter(b => {
      if (searchQuery && !b.code.toLowerCase().includes(searchQuery.toLowerCase()) && !b.title.toLowerCase().includes(searchQuery.toLowerCase())) return false;
      if (filterStatus && b.status !== filterStatus) return false;
      if (filterSeverity && b.severity !== filterSeverity) return false;
      if (filterAuthority && b.authorityId !== parseInt(filterAuthority)) return false;
      return true;
    });
  }, [breaches, searchQuery, filterStatus, filterSeverity, filterAuthority]);

  const handleCreateBreach = () => {
    setFormData({
      id: null, code: `BRH-2025-${String(breaches.length + 1).padStart(3, '0')}`,
      authorityId: '', frameworkId: '', obligationId: '', controlId: '', riskId: '',
      sourceType: 'TaskOverdue', sourceRefId: '', title: '', description: '',
      severity: 'Medium', regulatoryExposure: [], breachDate: new Date().toISOString().split('T')[0],
      dueDate: '', status: 'Open', ownerId: '', reviewerId: '', approverId: '',
      escalationLevel: 0, actions: [], rca: null, closureEvidence: [], exceptions: [],
      escalationHistory: [], createdAt: new Date().toISOString().split('T')[0], createdBy: CURRENT_USER.id,
    });
    setWizardStep(0);
    setModalType('breach');
    setModalMode('create');
    setShowModal(true);
  };

  const handleEditBreach = (breach) => {
    setFormData({ ...breach });
    setWizardStep(0);
    setModalType('breach');
    setModalMode('edit');
    setShowModal(true);
  };

  const handleViewBreach = (breach) => {
    setSelectedBreach(breach);
    setBreachTab('summary');
    setActiveTab('workspace');
  };

  const handleAddAction = () => {
    if (!selectedBreach) return;
    setFormData({
      id: null, type: 'ImmediateFix', description: '', responsibleId: '', dueDate: '', status: 'Open'
    });
    setModalType('action');
    setModalMode('create');
    setShowModal(true);
  };

  const handleRequestException = () => {
    if (!selectedBreach) return;
    setFormData({
      id: null, reason: '', approvedBy: '', expiryDate: '', status: 'Pending'
    });
    setModalType('exception');
    setModalMode('create');
    setShowModal(true);
  };

  const handleSave = () => {
    const now = new Date().toISOString().split('T')[0];

    if (modalType === 'breach') {
      if (!formData.title || !formData.obligationId || !formData.ownerId) {
        showNotification('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      if (modalMode === 'create') {
        setBreaches([...breaches, { ...formData, id: breaches.length + 1 }]);
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        setBreaches(breaches.map(b => b.id === formData.id ? formData : b));
        if (selectedBreach?.id === formData.id) setSelectedBreach(formData);
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©');
      }
    } else if (modalType === 'action') {
      if (!formData.description || !formData.responsibleId) {
        showNotification('Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      const newAction = { ...formData, id: (selectedBreach.actions?.length || 0) + 1 };
      const updatedBreach = {
        ...selectedBreach,
        actions: [...(selectedBreach.actions || []), newAction]
      };
      setBreaches(breaches.map(b => b.id === selectedBreach.id ? updatedBreach : b));
      setSelectedBreach(updatedBreach);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ');
    } else if (modalType === 'exception') {
      if (!formData.reason || !formData.expiryDate) {
        showNotification('Ø§Ù„Ø³Ø¨Ø¨ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      const newException = { ...formData, id: (selectedBreach.exceptions?.length || 0) + 1, approvedBy: CURRENT_USER.id, status: 'Active' };
      const updatedBreach = {
        ...selectedBreach,
        status: 'AcceptedException',
        exceptions: [...(selectedBreach.exceptions || []), newException]
      };
      setBreaches(breaches.map(b => b.id === selectedBreach.id ? updatedBreach : b));
      setSelectedBreach(updatedBreach);
      showNotification('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡');
    }

    setShowModal(false);
    setFormData(null);
    setWizardStep(0);
  };

  const handleUpdateStatus = (breach, newStatus) => {
    // SoD Check for Close action: Creator cannot close their own breach
    if (newStatus === 'Closed') {
      const sodResult = guardAction('BREACHES', 'APPROVE', { createdBy: breach.createdBy }, breach.severity || 'Medium');
      if (!sodResult.allowed) {
        showNotification(`â›” ${sodResult.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØºÙ„Ø§Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© - Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…'}`, 'error');
        return;
      }

      // DOA Check: Critical breaches require approval before closing
      if (breach.severity === 'Critical' || breach.severity === 'High') {
        const doaCheck = ApprovalService.requiresApproval('BREACHES', 'APPROVE', breach.severity);
        if (doaCheck.required) {
          const existingRequests = ApprovalService.getRecordApprovalStatus('BREACH', breach.code);
          const approvedRequest = existingRequests.find(r => r.status === 'Approved');

          if (!approvedRequest) {
            // Need to request approval
            setApprovalTarget({ breach, newStatus, doaRule: doaCheck.rule });
            setApprovalNotes('');
            setShowApprovalModal(true);
            return;
          }
        }
      }
    }
    const updatedBreach = { ...breach, status: newStatus };
    if (newStatus === 'Closed') {
      updatedBreach.closedAt = new Date().toISOString().split('T')[0];
      updatedBreach.closedBy = CURRENT_USER.id;
    }
    setBreaches(breaches.map(b => b.id === breach.id ? updatedBreach : b));
    if (selectedBreach?.id === breach.id) setSelectedBreach(updatedBreach);
    showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${STATUS_CONFIG[newStatus]?.label}`);
  };

  // DOA: Submit approval request for breach closure
  const handleSubmitApprovalRequest = () => {
    if (!approvalTarget) return;

    const result = ApprovalService.createRequest(
      CURRENT_USER.id,
      'BREACHES',
      'APPROVE',
      approvalTarget.breach.severity,
      'LE-001',
      'BREACH',
      approvalTarget.breach.code,
      approvalTarget.breach.title,
      approvalNotes
    );

    if (result.success) {
      showNotification(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ - ÙŠØªØ·Ù„Ø¨ ${result.chain.requiresDualApproval ? 'Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠÙ†' : 'Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ§Ø­Ø¯'}`);
      setShowApprovalModal(false);
      setApprovalTarget(null);
      setApprovalNotes('');
    } else {
      showNotification(`â›” ${result.error}`, 'error');
    }
  };

  // DOA: Approve a pending request
  const handleApproveRequest = (requestId, comment = '') => {
    const result = ApprovalService.approve(requestId, CURRENT_USER.id, comment);
    if (result.success) {
      if (result.isComplete) {
        // Auto-complete the action
        const request = result.request;
        const breach = breaches.find(b => b.code === request.recordId);
        if (breach) {
          const updatedBreach = { ...breach, status: 'Closed', closedAt: new Date().toISOString().split('T')[0], closedBy: CURRENT_USER.id };
          setBreaches(breaches.map(b => b.id === breach.id ? updatedBreach : b));
          if (selectedBreach?.id === breach.id) setSelectedBreach(updatedBreach);
        }
        showNotification('âœ… ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©');
      } else {
        showNotification('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø¹ØªÙ…Ø§Ø¯Ùƒ - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ');
      }
      setPendingApprovals(ApprovalService.getMyPendingApprovals(CURRENT_USER.id));
    } else {
      showNotification(`â›” ${result.error}`, 'error');
    }
  };

  // DOA: Reject a pending request
  const handleRejectRequest = (requestId, reason) => {
    const result = ApprovalService.reject(requestId, CURRENT_USER.id, reason);
    if (result.success) {
      showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
      setPendingApprovals(ApprovalService.getMyPendingApprovals(CURRENT_USER.id));
    } else {
      showNotification(`â›” ${result.error}`, 'error');
    }
  };

  const handleUpdateActionStatus = (actionId, newStatus) => {
    const updatedActions = selectedBreach.actions.map(a => a.id === actionId ? { ...a, status: newStatus } : a);
    const updatedBreach = { ...selectedBreach, actions: updatedActions };
    setBreaches(breaches.map(b => b.id === selectedBreach.id ? updatedBreach : b));
    setSelectedBreach(updatedBreach);
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡');
  };

  const handleEscalate = (breach) => {
    const newLevel = (breach.escalationLevel || 0) + 1;
    const escalationEntry = {
      date: new Date().toISOString().split('T')[0], level: newLevel, reason: 'ØªØµØ¹ÙŠØ¯ ÙŠØ¯ÙˆÙŠ',
      notifiedUsers: [1, 3, 5].slice(0, newLevel + 1)
    };
    const updatedBreach = {
      ...breach,
      escalationLevel: newLevel,
      escalationHistory: [...(breach.escalationHistory || []), escalationEntry]
    };
    setBreaches(breaches.map(b => b.id === breach.id ? updatedBreach : b));
    if (selectedBreach?.id === breach.id) setSelectedBreach(updatedBreach);
    showNotification(`ØªÙ… Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}`);
  };

  const handleDelete = () => {
    setBreaches(breaches.filter(b => b.id !== deleteTarget.id));
    if (selectedBreach?.id === deleteTarget.id) setSelectedBreach(null);
    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©');
    setShowDeleteConfirm(false);
    setDeleteTarget(null);
  };

  // TABS CONFIGURATION
  const mainTabs = [
    { id: 'command', label: 'Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard },
    { id: 'register', label: 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', icon: ClipboardList, count: stats.activeBreaches },
    { id: 'workspace', label: 'Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„', icon: Briefcase, disabled: !selectedBreach },
    { id: 'capa', label: 'CAPA', icon: Target, count: capaRecords.filter(c => c.status !== 'Closed').length },
    { id: 'exceptions', label: 'Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', icon: Shield, count: stats.exceptions },
    { id: 'reports', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', icon: BarChart3 },
  ];

  const breachTabs = [
    { id: 'summary', label: 'Ø§Ù„Ù…Ù„Ø®Øµ', icon: FileText },
    { id: 'source', label: 'Ø§Ù„Ù…ØµØ¯Ø±', icon: Link2 },
    { id: 'actions', label: 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', icon: Zap },
    { id: 'rca', label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨', icon: Search },
    { id: 'evidence', label: 'Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚', icon: FileCheck },
    { id: 'escalation', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØµØ¹ÙŠØ¯', icon: TrendingUp },
  ];

  // RENDER
  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-red-500 to-orange-600 flex items-center justify-center shadow-lg">
            <AlertTriangle className="w-7 h-7 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-slate-900">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h1>
            <p className="text-slate-500">Regulatory Breach Management - Module 4.7</p>
          </div> </div>
        <div className="flex items-center gap-3">
          <button className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50">
            <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ±
          </button>
          <button onClick={handleCreateBreach}
            className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-red-500 to-orange-600 text-white rounded-xl font-bold shadow-lg">
            <Plus className="w-5 h-5" />ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ©
          </button> </div> </div>
      <div className="grid grid-cols-8 gap-3">
        <div className={`rounded-2xl p-4 ${stats.critical > 0 ? 'bg-red-600 animate-pulse' : 'bg-red-500'} text-white`}>
          <div className="flex items-center justify-between mb-1">
            <AlertTriangle className="w-5 h-5" />
            <span className="text-3xl font-bold">{stats.critical}</span>
          </div>
          <p className="text-red-100 text-sm">Ø­Ø±Ø¬</p>
        </div>

        <div className={`rounded-2xl p-4 ${stats.overdue > 0 ? 'bg-orange-500 animate-pulse' : 'bg-orange-400'} text-white`}>
          <div className="flex items-center justify-between mb-1">
            <Clock className="w-5 h-5" />
            <span className="text-3xl font-bold">{stats.overdue}</span>
          </div>
          <p className="text-orange-100 text-sm">Ù…ØªØ£Ø®Ø±</p>
        </div>

        <div className="bg-amber-100 rounded-2xl p-4 border-2 border-amber-300">
          <div className="flex items-center justify-between mb-1">
            <AlertCircle className="w-5 h-5 text-amber-600" />
            <span className="text-2xl font-bold text-amber-700">{stats.open}</span>
          </div>
          <p className="text-amber-600 text-sm">Ù…ÙØªÙˆØ­</p>
        </div>

        <div className="bg-blue-100 rounded-2xl p-4 border-2 border-blue-300">
          <div className="flex items-center justify-between mb-1">
            <Eye className="w-5 h-5 text-blue-600" />
            <span className="text-2xl font-bold text-blue-700">{stats.underReview}</span>
          </div>
          <p className="text-blue-600 text-sm">Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
        </div>

        <div className="bg-amber-50 rounded-2xl p-4 border-2 border-amber-200">
          <div className="flex items-center justify-between mb-1">
            <Zap className="w-5 h-5 text-amber-500" />
            <span className="text-2xl font-bold text-amber-600">{stats.remediation}</span>
          </div>
          <p className="text-amber-500 text-sm">Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
        </div>

        <div className="bg-emerald-100 rounded-2xl p-4 border-2 border-emerald-300">
          <div className="flex items-center justify-between mb-1">
            <CheckCircle2 className="w-5 h-5 text-emerald-600" />
            <span className="text-2xl font-bold text-emerald-700">{stats.closed}</span>
          </div>
          <p className="text-emerald-600 text-sm">Ù…ØºÙ„Ù‚</p>
        </div>

        <div className="bg-purple-100 rounded-2xl p-4 border-2 border-purple-300">
          <div className="flex items-center justify-between mb-1">
            <Shield className="w-5 h-5 text-purple-600" />
            <span className="text-2xl font-bold text-purple-700">{stats.exceptions}</span>
          </div>
          <p className="text-purple-600 text-sm">Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
        </div>

        <div className="bg-slate-100 rounded-2xl p-4 border-2 border-slate-200">
          <div className="flex items-center justify-between mb-1">
            <ClipboardCheck className="w-5 h-5 text-slate-600" />
            <span className="text-2xl font-bold text-slate-700">{stats.total}</span>
          </div>
          <p className="text-slate-500 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200">
          {mainTabs.map(tab => (
            <button key={tab.id} onClick={() => !tab.disabled && setActiveTab(tab.id)}
              disabled={tab.disabled}
              className={`flex items-center gap-2 px-5 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-red-600 border-red-500 bg-red-50' :
                tab.disabled ? 'text-slate-300 border-transparent cursor-not-allowed' :
                  'text-slate-500 border-transparent hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-red-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: COMMAND CENTER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'command' && (
          <div className="p-6">
            <div className="grid grid-cols-3 gap-6">
              <div className="col-span-2 bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-5 border border-red-200">
                <h3 className="font-bold text-red-800 mb-4 flex items-center gap-2">
                  <Activity className="w-5 h-5" />Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                </h3>
                <div className="grid grid-cols-4 gap-4">
                  {Object.entries(EXPOSURE_CONFIG).map(([key, cfg]) => {
                    const count = breaches.filter(b => b.regulatoryExposure?.includes(key) && b.status !== 'Closed').length;
                    return (
                      <div key={key} className={`bg-white rounded-xl p-4 border-2 ${count > 0 ? `border-${cfg.color}-300` : 'border-slate-200'}`}>
                        <div className="flex items-center gap-2 mb-2">
                          <cfg.icon className={`w-5 h-5 text-${cfg.color}-500`} />
                          <span className="text-sm font-bold text-slate-700">{cfg.label}</span>
                        </div>
                        <p className={`text-3xl font-bold ${count > 0 ? `text-${cfg.color}-600` : 'text-slate-400'}`}>{count}</p>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                <h3 className="font-bold mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div className="space-y-2">
                  <button onClick={handleCreateBreach} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <Plus className="w-5 h-5" /><span>ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
                  </button>
                  <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <FileText className="w-5 h-5" /><span>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</span>
                  </button>
                  <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <TrendingUp className="w-5 h-5" /><span>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª</span>
                  </button> </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø©</h3>
                {AUTHORITIES.slice(0, 5).map(auth => {
                  const count = breaches.filter(b => b.authorityId === auth.id && b.status !== 'Closed').length;
                  const pct = stats.activeBreaches > 0 ? Math.round((count / stats.activeBreaches) * 100) : 0;
                  return (
                    <div key={auth.id} className="mb-3">
                      <div className="flex justify-between mb-1">
                        <span className="text-sm text-slate-600">{auth.code}</span>
                        <span className="text-sm font-bold">{count}</span>
                      </div>
                      <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full ${count > 0 ? 'bg-red-500' : 'bg-slate-200'}`} style={{ width: `${pct}%` }}></div>
                      </div> </div>);
                })}
              </div>

              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">ØªÙ‚Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©</h3>
                <div className="flex items-center justify-center">
                  <div className="relative w-32 h-32">
                    <svg className="w-32 h-32 transform -rotate-90">
                      <circle cx="64" cy="64" r="56" stroke="#e2e8f0" strokeWidth="12" fill="none" />
                      <circle cx="64" cy="64" r="56" stroke="#10b981" strokeWidth="12" fill="none"
                        strokeDasharray={`${(stats.doneActions / Math.max(stats.totalActions, 1)) * 352} 352`} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                      <span className="text-3xl font-bold text-slate-800">{stats.totalActions > 0 ? Math.round((stats.doneActions / stats.totalActions) * 100) : 0}%</span>
                      <span className="text-xs text-slate-500">{stats.doneActions}/{stats.totalActions}</span>
                    </div> </div> </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</h3>
                <div className="space-y-2">
                  {breaches.slice(0, 4).map(b => {
                    const sevCfg = SEVERITY_CONFIG[b.severity];
                    const statusCfg = STATUS_CONFIG[b.status];
                    return (
                      <div key={b.id} onClick={() => handleViewBreach(b)}
                        className="flex items-center gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 cursor-pointer">
                        <div className={`w-3 h-3 rounded-full ${sevCfg?.bg}`}></div>
                        <div className="flex-1 min-w-0">
                          <p className="text-sm font-bold text-slate-800 truncate">{b.code}</p>
                          <p className="text-xs text-slate-500 truncate">{b.title}</p>
                        </div>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                          {statusCfg?.label}
                        </span> </div>);
                  })}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: BREACH REGISTER - WORLD-CLASS EDITION
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'register' && (
          <div className="p-6">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <h3 className="text-xl font-bold text-slate-800">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h3>
                <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-bold">
                  {filteredBreaches.length} Ù…Ø®Ø§Ù„ÙØ©
                </span> </div>
              <div className="flex items-center gap-2 bg-slate-100 p-1 rounded-xl">
                {[
                  { id: 'table', icon: Table, label: 'Ø¬Ø¯ÙˆÙ„' },
                  { id: 'cards', icon: LayoutGrid, label: 'Ø¨Ø·Ø§Ù‚Ø§Øª' },
                  { id: 'kanban', icon: Layers, label: 'ÙƒØ§Ù†Ø¨Ø§Ù†' },
                  { id: 'timeline', icon: Activity, label: 'Ø®Ø· Ø²Ù…Ù†ÙŠ' },
                  { id: 'matrix', icon: PieChart, label: 'Ù…ØµÙÙˆÙØ©' },
                ].map(mode => (
                  <button key={mode.id} onClick={() => setViewMode(mode.id)}
                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-bold transition-all ${viewMode === mode.id ? 'bg-white text-red-600 shadow-md' : 'text-slate-500 hover:text-slate-700'
                      }`}>
                    <mode.icon className="w-4 h-4" />
                    <span className="text-sm">{mode.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="flex items-center gap-3 mb-4">
              <span className="text-sm text-slate-500">ÙÙ„ØªØ±Ø© Ø³Ø±ÙŠØ¹Ø©:</span>
              <button onClick={() => setFilterSeverity(filterSeverity === 'Critical' ? '' : 'Critical')}
                className={`flex items-center gap-2 px-3 py-2 rounded-xl border-2 transition-all ${filterSeverity === 'Critical' ? 'border-red-500 bg-red-50 text-red-700' : 'border-slate-200 hover:border-red-300'
                  }`}>
                <div className="w-3 h-3 rounded-full bg-red-600"></div>
                <span className="text-sm font-bold">Ø­Ø±Ø¬ ({breaches.filter(b => b.severity === 'Critical').length})</span>
              </button>
              <button onClick={() => setFilterSeverity(filterSeverity === 'High' ? '' : 'High')}
                className={`flex items-center gap-2 px-3 py-2 rounded-xl border-2 transition-all ${filterSeverity === 'High' ? 'border-orange-500 bg-orange-50 text-orange-700' : 'border-slate-200 hover:border-orange-300'
                  }`}>
                <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                <span className="text-sm font-bold">Ø¹Ø§Ù„ÙŠ ({breaches.filter(b => b.severity === 'High').length})</span>
              </button>
              <button onClick={() => setFilterSeverity(filterSeverity === 'Medium' ? '' : 'Medium')}
                className={`flex items-center gap-2 px-3 py-2 rounded-xl border-2 transition-all ${filterSeverity === 'Medium' ? 'border-amber-500 bg-amber-50 text-amber-700' : 'border-slate-200 hover:border-amber-300'
                  }`}>
                <div className="w-3 h-3 rounded-full bg-amber-500"></div>
                <span className="text-sm font-bold">Ù…ØªÙˆØ³Ø· ({breaches.filter(b => b.severity === 'Medium').length})</span>
              </button>
              <button onClick={() => setFilterSeverity(filterSeverity === 'Low' ? '' : 'Low')}
                className={`flex items-center gap-2 px-3 py-2 rounded-xl border-2 transition-all ${filterSeverity === 'Low' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-200 hover:border-emerald-300'
                  }`}>
                <div className="w-3 h-3 rounded-full bg-emerald-500"></div>
                <span className="text-sm font-bold">Ù…Ù†Ø®ÙØ¶ ({breaches.filter(b => b.severity === 'Low').length})</span>
              </button>

              <div className="h-6 w-px bg-slate-300 mx-2"></div>

              <button onClick={() => setFilterStatus(filterStatus === 'Open' ? '' : 'Open')}
                className={`px-3 py-2 rounded-xl border-2 text-sm font-bold transition-all ${filterStatus === 'Open' ? 'border-red-500 bg-red-50 text-red-700' : 'border-slate-200 hover:border-red-300'
                  }`}>Ù…ÙØªÙˆØ­</button>
              <button onClick={() => setFilterStatus(filterStatus === 'Remediation' ? '' : 'Remediation')}
                className={`px-3 py-2 rounded-xl border-2 text-sm font-bold transition-all ${filterStatus === 'Remediation' ? 'border-amber-500 bg-amber-50 text-amber-700' : 'border-slate-200 hover:border-amber-300'
                  }`}>Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
              <button onClick={() => setFilterStatus(filterStatus === 'Closed' ? '' : 'Closed')}
                className={`px-3 py-2 rounded-xl border-2 text-sm font-bold transition-all ${filterStatus === 'Closed' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-200 hover:border-emerald-300'
                  }`}>Ù…ØºÙ„Ù‚</button>

              {(filterStatus || filterSeverity || filterAuthority || searchQuery) && (
                <button onClick={() => { setFilterStatus(''); setFilterSeverity(''); setFilterAuthority(''); setSearchQuery(''); }}
                  className="px-3 py-2 text-red-600 hover:bg-red-50 rounded-xl text-sm font-bold flex items-center gap-1">
                  <X className="w-4 h-4" />Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
                </button>
              )}
            </div>

            <div className="flex items-center gap-3 mb-6">
              <div className="relative flex-1 max-w-lg">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„ÙˆØµÙ..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none" />
              </div>
              <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl min-w-[150px]">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                {AUTHORITIES.map(a => <option key={a.id} value={a.id}>{a.code} - {a.nameAr}</option>)}
              </select>
            </div>

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                VIEW: TABLE
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {viewMode === 'table' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
                        <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                        <th className="text-right px-4 py-4 font-bold text-slate-700 min-w-[250px]">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ù…ØµØ¯Ø±</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                        <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                        <th className="text-center px-4 py-4 font-bold text-slate-700 w-44">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                      </tr> </thead>
                    <tbody>
                      {filteredBreaches.map((breach, idx) => {
                        const auth = getAuthority(breach.authorityId);
                        const sevCfg = SEVERITY_CONFIG[breach.severity];
                        const statusCfg = STATUS_CONFIG[breach.status];
                        const sourceCfg = SOURCE_TYPE_CONFIG[breach.sourceType];
                        const daysUntil = getDaysUntilDue(breach.dueDate);
                        const SourceIcon = sourceCfg?.icon || Clock;
                        const actionsCount = breach.actions?.length || 0;
                        const doneActions = breach.actions?.filter(a => a.status === 'Done').length || 0;
                        const progressPct = actionsCount > 0 ? Math.round((doneActions / actionsCount) * 100) : 0;

                        return (
                          <tr key={breach.id} className={`border-b border-slate-100 hover:bg-slate-50 transition-all ${breach.severity === 'Critical' ? 'bg-red-50/50' : ''
                            }`}>
                            <td className="px-4 py-4">
                              <div className="flex items-center gap-2">
                                <div className={`w-1.5 h-10 rounded-full ${sevCfg?.bg}`}></div>
                                <span className="font-mono text-sm font-bold text-red-600 bg-red-50 px-2 py-1 rounded-lg">{breach.code}</span>
                              </div> </td>
                            <td className="px-4 py-4">
                              <div className="cursor-pointer hover:text-red-600" onClick={() => handleViewBreach(breach)}>
                                <p className="font-bold text-slate-800 line-clamp-1">{breach.title}</p>
                                <p className="text-xs text-slate-500 line-clamp-1">{breach.description?.substring(0, 60)}...</p>
                              </div> </td>
                            <td className="px-3 py-4 text-center">
                              <span className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">{auth?.code}</span>
                            </td>
                            <td className="px-3 py-4 text-center">
                              <span className={`inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-${sourceCfg?.color}-100 text-${sourceCfg?.color}-700 rounded-lg text-xs font-bold`}>
                                <SourceIcon className="w-3.5 h-3.5" />{sourceCfg?.label}
                              </span> </td>
                            <td className="px-3 py-4 text-center">
                              <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>
                                {sevCfg?.label}
                              </span> </td>
                            <td className="px-3 py-4 text-center">
                              <span className={`inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                                {React.createElement(statusCfg?.icon || Clock, { className: "w-3 h-3" })}
                                {statusCfg?.label}
                              </span> </td>
                            <td className="px-3 py-4 text-center">
                              <div className="text-sm font-bold text-slate-700">{breach.dueDate}</div>
                              {daysUntil !== null && breach.status !== 'Closed' && breach.status !== 'AcceptedException' && (
                                <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${daysUntil < 0 ? 'bg-red-100 text-red-600' : daysUntil <= 7 ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'
                                  }`}>
                                  {daysUntil < 0 ? `Ù…ØªØ£Ø®Ø± ${Math.abs(daysUntil)} ÙŠÙˆÙ…` : `${daysUntil} ÙŠÙˆÙ…`}
                                </span>
                              )}
                            </td>
                            <td className="px-3 py-4">
                              <div className="flex flex-col items-center gap-1">
                                <div className="w-16 h-2 bg-slate-200 rounded-full overflow-hidden">
                                  <div className={`h-full rounded-full ${progressPct === 100 ? 'bg-emerald-500' : progressPct > 0 ? 'bg-amber-500' : 'bg-slate-300'}`}
                                    style={{ width: `${progressPct}%` }}></div>
                                </div>
                                <span className="text-xs text-slate-500">{doneActions}/{actionsCount}</span>
                              </div> </td>
                            <td className="px-4 py-4">
                              <div className="flex items-center justify-center gap-1">
                                <button onClick={() => handleViewBreach(breach)} className="p-2 hover:bg-blue-100 rounded-lg transition-all" title="Ø¹Ø±Ø¶">
                                  <Eye className="w-4 h-4 text-blue-600" />
                                </button>
                                <button onClick={() => handleEditBreach(breach)} className="p-2 hover:bg-amber-100 rounded-lg transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                                  <Edit className="w-4 h-4 text-amber-600" />
                                </button>
                                {breach.escalationLevel < 3 && breach.status !== 'Closed' && (
                                  <button onClick={() => handleEscalate(breach)} className="p-2 hover:bg-red-100 rounded-lg transition-all" title="ØªØµØ¹ÙŠØ¯">
                                    <TrendingUp className="w-4 h-4 text-red-600" />
                                  </button>
                                )}
                                {breach.escalationLevel > 0 && (
                                  <span className="px-2 py-1 bg-red-500 text-white rounded text-xs font-bold">L{breach.escalationLevel}</span>
                                )}
                                <button onClick={() => { setDeleteTarget(breach); setShowDeleteConfirm(true); }} className="p-2 hover:bg-red-100 rounded-lg transition-all" title="Ø­Ø°Ù">
                                  <Trash2 className="w-4 h-4 text-red-600" />
                                </button> </div> </td> </tr>);
                      })}
                    </tbody> </table> </div> </div>
            )}

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                VIEW: CARDS
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {viewMode === 'cards' && (
              <div className="grid grid-cols-3 gap-4">
                {filteredBreaches.map(breach => {
                  const auth = getAuthority(breach.authorityId);
                  const sevCfg = SEVERITY_CONFIG[breach.severity];
                  const statusCfg = STATUS_CONFIG[breach.status];
                  const sourceCfg = SOURCE_TYPE_CONFIG[breach.sourceType];
                  const daysUntil = getDaysUntilDue(breach.dueDate);
                  const SourceIcon = sourceCfg?.icon || Clock;
                  const actionsCount = breach.actions?.length || 0;
                  const doneActions = breach.actions?.filter(a => a.status === 'Done').length || 0;

                  return (
                    <div key={breach.id} className={`bg-white rounded-2xl border-2 overflow-hidden transition-all hover:shadow-lg cursor-pointer ${breach.severity === 'Critical' ? 'border-red-300 shadow-red-100' : 'border-slate-200 hover:border-red-300'
                      }`} onClick={() => handleViewBreach(breach)}>
                      <div className={`px-4 py-3 ${sevCfg?.light} border-b-2 ${sevCfg?.border}`}>
                        <div className="flex items-center justify-between">
                          <span className="font-mono text-sm font-bold text-red-600">{breach.code}</span>
                          <div className="flex items-center gap-2">
                            {breach.escalationLevel > 0 && (
                              <span className="flex items-center gap-1 px-2 py-0.5 bg-red-500 text-white rounded text-xs font-bold">
                                <TrendingUp className="w-3 h-3" />L{breach.escalationLevel}
                              </span>
                            )}
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                          </div> </div> </div>
                      <div className="p-4">
                        <h4 className="font-bold text-slate-800 line-clamp-2 mb-3">{breach.title}</h4>

                        <div className="flex flex-wrap gap-2 mb-3">
                          <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold">{auth?.code}</span>
                          <span className={`inline-flex items-center gap-1 px-2 py-1 bg-${sourceCfg?.color}-100 text-${sourceCfg?.color}-700 rounded text-xs font-bold`}>
                            <SourceIcon className="w-3 h-3" />{sourceCfg?.label}
                          </span> </div>
                        <p className="text-sm text-slate-600 line-clamp-2 mb-4">{breach.description}</p>

                        {actionsCount > 0 && (
                          <div className="mb-3">
                            <div className="flex justify-between text-xs text-slate-500 mb-1">
                              <span>ØªÙ‚Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</span>
                              <span>{doneActions}/{actionsCount}</span>
                            </div>
                            <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                              <div className="h-full bg-emerald-500 rounded-full" style={{ width: `${(doneActions / actionsCount) * 100}%` }}></div>
                            </div> </div>
                        )}

                        <div className="flex items-center justify-between pt-3 border-t border-slate-100">
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                            {React.createElement(statusCfg?.icon || Clock, { className: "w-3 h-3" })}
                            {statusCfg?.label}
                          </span>
                          <span className={`text-xs font-bold ${daysUntil !== null && daysUntil < 0 ? 'text-red-600' : 'text-slate-500'}`}>
                            {breach.dueDate}
                          </span> </div> </div> </div>);
                })}
              </div>
            )}

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                VIEW: KANBAN
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {viewMode === 'kanban' && (
              <div className="grid grid-cols-5 gap-4">
                {Object.entries(STATUS_CONFIG).map(([statusKey, statusCfg]) => {
                  const statusBreaches = filteredBreaches.filter(b => b.status === statusKey);
                  const StatusIcon = statusCfg.icon;
                  return (
                    <div key={statusKey} className="bg-slate-50 rounded-2xl p-4 min-h-[500px]">
                      <div className={`flex items-center justify-between mb-4 pb-3 border-b-2 ${statusCfg.bg.replace('bg-', 'border-')}`}>
                        <div className="flex items-center gap-2">
                          <StatusIcon className={`w-5 h-5 ${statusCfg.text}`} />
                          <span className={`font-bold ${statusCfg.text}`}>{statusCfg.label}</span>
                        </div>
                        <span className={`w-7 h-7 rounded-lg ${statusCfg.bg} ${statusCfg.text} flex items-center justify-center text-sm font-bold`}>
                          {statusBreaches.length}
                        </span> </div>
                      <div className="space-y-3">
                        {statusBreaches.map(breach => {
                          const sevCfg = SEVERITY_CONFIG[breach.severity];
                          const auth = getAuthority(breach.authorityId);
                          return (
                            <div key={breach.id} onClick={() => handleViewBreach(breach)}
                              className={`bg-white rounded-xl p-3 border-r-4 ${sevCfg?.border} shadow-sm hover:shadow-md cursor-pointer transition-all`}>
                              <div className="flex items-start justify-between mb-2">
                                <span className="font-mono text-xs font-bold text-red-600">{breach.code}</span>
                                <span className={`px-1.5 py-0.5 rounded text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                              </div>
                              <p className="text-sm font-bold text-slate-800 line-clamp-2 mb-2">{breach.title}</p>
                              <div className="flex items-center justify-between text-xs text-slate-500">
                                <span>{auth?.code}</span>
                                <span>{breach.dueDate}</span>
                              </div>
                              {breach.escalationLevel > 0 && (
                                <div className="mt-2 flex items-center gap-1 text-xs text-red-600">
                                  <TrendingUp className="w-3 h-3" />
                                  <span>ØªØµØ¹ÙŠØ¯ L{breach.escalationLevel}</span>
                                </div>
                              )}
                            </div>);
                        })}
                      </div> </div>);
                })}
              </div>
            )}

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                VIEW: TIMELINE
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {viewMode === 'timeline' && (
              <div className="relative">
                <div className="absolute right-8 top-0 bottom-0 w-1 bg-gradient-to-b from-red-500 via-amber-500 to-emerald-500 rounded-full"></div>
                <div className="space-y-6 pr-16">
                  {filteredBreaches.sort((a, b) => new Date(b.breachDate) - new Date(a.breachDate)).map((breach, idx) => {
                    const sevCfg = SEVERITY_CONFIG[breach.severity];
                    const statusCfg = STATUS_CONFIG[breach.status];
                    const auth = getAuthority(breach.authorityId);
                    const SevIcon = sevCfg?.icon || AlertCircle;

                    return (
                      <div key={breach.id} className="relative flex gap-6">
                        <div className={`absolute right-5 w-6 h-6 rounded-full ${sevCfg?.bg} border-4 border-white shadow-lg flex items-center justify-center`}>
                          <SevIcon className="w-3 h-3 text-white" />
                        </div>
                        <div className={`flex-1 bg-white rounded-2xl border-2 ${sevCfg?.border} p-5 hover:shadow-lg cursor-pointer transition-all`}
                          onClick={() => handleViewBreach(breach)}>
                          <div className="flex items-start justify-between mb-3">
                            <div>
                              <div className="flex items-center gap-2 mb-1">
                                <span className="font-mono text-sm font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded">{breach.code}</span>
                                <span className={`px-2 py-0.5 rounded text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                                <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>{statusCfg?.label}</span>
                                {breach.escalationLevel > 0 && (
                                  <span className="flex items-center gap-1 px-2 py-0.5 bg-red-500 text-white rounded text-xs font-bold">
                                    <TrendingUp className="w-3 h-3" />L{breach.escalationLevel}
                                  </span>
                                )}
                              </div>
                              <h4 className="font-bold text-slate-800 text-lg">{breach.title}</h4>
                            </div>
                            <div className="text-left">
                              <p className="text-sm font-bold text-slate-700">{breach.breachDate}</p>
                              <p className="text-xs text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</p>
                            </div> </div>
                          <p className="text-slate-600 mb-4">{breach.description}</p>
                          <div className="flex items-center gap-4 text-sm text-slate-500">
                            <span className="flex items-center gap-1"><Building2 className="w-4 h-4" />{auth?.code}</span>
                            <span className="flex items-center gap-1"><User className="w-4 h-4" />{getUser(breach.ownerId)?.name}</span>
                            <span className="flex items-center gap-1"><Calendar className="w-4 h-4" />Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {breach.dueDate}</span>
                            {breach.actions?.length > 0 && (
                              <span className="flex items-center gap-1">
                                <Zap className="w-4 h-4" />
                                {breach.actions.filter(a => a.status === 'Done').length}/{breach.actions.length} Ø¥Ø¬Ø±Ø§Ø¡
                              </span>
                            )}
                          </div> </div> </div>);
                  })}
                </div> </div>
            )}

            {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                VIEW: RISK MATRIX
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
            {viewMode === 'matrix' && (
              <div className="space-y-6">
                <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                  <h3 className="font-bold text-slate-800 mb-4">Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø± - Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ã— Ø§Ù„Ø­Ø§Ù„Ø©</h3>
                  <div className="grid grid-cols-6 gap-2">
                    <div></div>
                    {Object.entries(STATUS_CONFIG).map(([key, cfg]) => (
                      <div key={key} className={`text-center p-2 rounded-lg ${cfg.bg}`}>
                        <span className={`text-sm font-bold ${cfg.text}`}>{cfg.label}</span>
                      </div>
                    ))}

                    {Object.entries(SEVERITY_CONFIG).map(([sevKey, sevCfg]) => (
                      <React.Fragment key={sevKey}>
                        <div className={`p-3 rounded-lg ${sevCfg.light} flex items-center justify-center`}>
                          <span className={`text-sm font-bold ${sevCfg.text}`}>{sevCfg.label}</span>
                        </div>
                        {Object.keys(STATUS_CONFIG).map(statusKey => {
                          const count = filteredBreaches.filter(b => b.severity === sevKey && b.status === statusKey).length;
                          const isHot = sevKey === 'Critical' && (statusKey === 'Open' || statusKey === 'UnderReview');
                          return (
                            <div key={statusKey}
                              className={`p-4 rounded-lg text-center transition-all cursor-pointer ${count > 0
                                ? isHot ? 'bg-red-500 text-white animate-pulse' : 'bg-slate-100 hover:bg-slate-200'
                                : 'bg-slate-50'
                                }`}
                              onClick={() => {
                                setFilterSeverity(sevKey);
                                setFilterStatus(statusKey);
                              }}>
                              <span className={`text-2xl font-bold ${count > 0 && isHot ? 'text-white' : count > 0 ? 'text-slate-800' : 'text-slate-300'}`}>
                                {count}
                              </span> </div>);
                        })}
                      </React.Fragment>
                    ))}
                  </div> </div>
                <div className="grid grid-cols-4 gap-4">
                  {Object.entries(EXPOSURE_CONFIG).map(([key, cfg]) => {
                    const count = filteredBreaches.filter(b => b.regulatoryExposure?.includes(key) && b.status !== 'Closed').length;
                    const ExpIcon = cfg.icon;
                    return (
                      <div key={key} className={`bg-gradient-to-br from-${cfg.color}-50 to-${cfg.color}-100 rounded-2xl p-5 border-2 border-${cfg.color}-200`}>
                        <div className="flex items-center justify-between mb-3">
                          <ExpIcon className={`w-8 h-8 text-${cfg.color}-600`} />
                          <span className={`text-4xl font-bold text-${cfg.color}-700`}>{count}</span>
                        </div>
                        <h4 className={`font-bold text-${cfg.color}-800`}>{cfg.label}</h4>
                        <p className="text-sm text-slate-600 mt-1">Ù…Ø®Ø§Ù„ÙØ§Øª Ù†Ø´Ø·Ø©</p>
                      </div>);
                  })}
                </div>

                <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                  <h3 className="font-bold text-slate-800 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h3>
                  <div className="grid grid-cols-5 gap-4">
                    {AUTHORITIES.slice(0, 5).map(auth => {
                      const authBreaches = filteredBreaches.filter(b => b.authorityId === auth.id && b.status !== 'Closed');
                      const criticalCount = authBreaches.filter(b => b.severity === 'Critical').length;
                      const highCount = authBreaches.filter(b => b.severity === 'High').length;

                      return (
                        <div key={auth.id} className={`rounded-xl p-4 border-2 ${authBreaches.length > 0 ? 'border-red-200 bg-red-50' : 'border-slate-200 bg-slate-50'}`}>
                          <div className="text-center mb-3">
                            <span className="text-2xl font-bold text-slate-800">{authBreaches.length}</span>
                            <p className="text-sm text-slate-600">{auth.code}</p>
                          </div>
                          <div className="flex justify-center gap-2">
                            {criticalCount > 0 && (
                              <span className="px-2 py-0.5 bg-red-500 text-white rounded text-xs font-bold">{criticalCount} Ø­Ø±Ø¬</span>
                            )}
                            {highCount > 0 && (
                              <span className="px-2 py-0.5 bg-orange-500 text-white rounded text-xs font-bold">{highCount} Ø¹Ø§Ù„ÙŠ</span>
                            )}
                          </div> </div>);
                    })}
                  </div> </div> </div>
            )}

            {filteredBreaches.length === 0 && (
              <div className="text-center py-20 bg-slate-50 rounded-2xl">
                <AlertTriangle className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                <h3 className="text-xl font-bold text-slate-600 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª</h3>
                <p className="text-slate-500 mb-4">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø®Ø§Ù„ÙØ§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                <button onClick={handleCreateBreach}
                  className="px-6 py-3 bg-red-500 text-white rounded-xl font-bold">
                  ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
                </button> </div>
            )}
          </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: BREACH WORKSPACE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'workspace' && selectedBreach && (
          <div className="p-6">
            <div className={`rounded-2xl p-6 mb-6 border-2 ${SEVERITY_CONFIG[selectedBreach.severity]?.border} ${SEVERITY_CONFIG[selectedBreach.severity]?.light}`}>
              <div className="flex items-start justify-between">
                <div>
                  <div className="flex items-center gap-3 mb-2">
                    <span className="font-mono text-lg font-bold text-red-600 bg-red-100 px-3 py-1 rounded-lg">{selectedBreach.code}</span>
                    <span className={`px-3 py-1 rounded-lg text-sm font-bold ${SEVERITY_CONFIG[selectedBreach.severity]?.light} ${SEVERITY_CONFIG[selectedBreach.severity]?.text}`}>
                      {SEVERITY_CONFIG[selectedBreach.severity]?.label}
                    </span>
                    <span className={`px-3 py-1 rounded-lg text-sm font-bold ${STATUS_CONFIG[selectedBreach.status]?.bg} ${STATUS_CONFIG[selectedBreach.status]?.text}`}>
                      {STATUS_CONFIG[selectedBreach.status]?.label}
                    </span>
                    {selectedBreach.escalationLevel > 0 && (
                      <span className="flex items-center gap-1 px-3 py-1 bg-red-600 text-white rounded-lg text-sm font-bold">
                        <TrendingUp className="w-4 h-4" />ØªØµØ¹ÙŠØ¯ L{selectedBreach.escalationLevel}
                      </span>
                    )}
                  </div>
                  <h2 className="text-xl font-bold text-slate-800">{selectedBreach.title}</h2>
                  <div className="flex items-center gap-4 mt-2 text-sm text-slate-600">
                    <span>Ø§Ù„Ø¬Ù‡Ø©: <strong>{getAuthority(selectedBreach.authorityId)?.code}</strong></span>
                    <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: <strong>{getUser(selectedBreach.ownerId)?.name}</strong></span>
                    <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: <strong className={getDaysUntilDue(selectedBreach.dueDate) < 0 ? 'text-red-600' : ''}>{selectedBreach.dueDate}</strong></span>
                  </div> </div>
                <div className="flex items-center gap-2">
                  {selectedBreach.status === 'Open' && (
                    <button onClick={() => handleUpdateStatus(selectedBreach, 'UnderReview')}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold">
                      <Eye className="w-5 h-5" />Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                    </button>
                  )}
                  {selectedBreach.status === 'UnderReview' && (
                    <button onClick={() => handleUpdateStatus(selectedBreach, 'Remediation')}
                      className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-xl font-bold">
                      <Zap className="w-5 h-5" />Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                    </button>
                  )}
                  {selectedBreach.status === 'Remediation' && (
                    <>
                      <button onClick={handleRequestException}
                        className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-xl font-bold">
                        <Shield className="w-5 h-5" />Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡
                      </button>
                      <button onClick={() => handleUpdateStatus(selectedBreach, 'Closed')}
                        disabled={!selectedBreach.actions?.every(a => a.status === 'Done') || !selectedBreach.closureEvidence?.length}
                        className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed">
                        <CheckCircle2 className="w-5 h-5" />Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                      </button>
                    </>
                  )}
                  {selectedBreach.escalationLevel < 3 && selectedBreach.status !== 'Closed' && (
                    <button onClick={() => handleEscalate(selectedBreach)}
                      className="flex items-center gap-2 px-4 py-2 border-2 border-red-500 text-red-500 rounded-xl font-bold hover:bg-red-50">
                      <TrendingUp className="w-5 h-5" />ØªØµØ¹ÙŠØ¯
                    </button>
                  )}
                  <button onClick={() => setSelectedBreach(null)} className="p-2 hover:bg-slate-200 rounded-xl">
                    <X className="w-5 h-5 text-slate-500" />
                  </button> </div> </div>
              {selectedBreach.regulatoryExposure?.length > 0 && (
                <div className="flex items-center gap-2 mt-4 pt-4 border-t border-slate-200">
                  <span className="text-sm text-slate-600">Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ:</span>
                  {selectedBreach.regulatoryExposure.map(exp => {
                    const cfg = EXPOSURE_CONFIG[exp];
                    return (
                      <span key={exp} className={`flex items-center gap-1 px-2 py-1 bg-${cfg?.color}-100 text-${cfg?.color}-700 rounded text-xs font-bold`}>
                        <cfg.icon className="w-3 h-3" />{cfg?.label}
                      </span>);
                  })}
                </div>
              )}
            </div>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="flex border-b border-slate-200 overflow-x-auto">
                {breachTabs.map(tab => (
                  <button key={tab.id} onClick={() => setBreachTab(tab.id)}
                    className={`flex items-center gap-2 px-5 py-3 font-bold transition-all border-b-2 whitespace-nowrap ${breachTab === tab.id ? 'text-red-600 border-red-500 bg-red-50' : 'text-slate-500 border-transparent hover:bg-slate-50'
                      }`}>
                    <tab.icon className="w-4 h-4" />{tab.label}
                  </button>
                ))}
              </div>

              <div className="p-6">
                {breachTab === 'summary' && (
                  <div className="grid grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</h4>
                        <p className="text-slate-600">{selectedBreach.description}</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Golden Thread</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex items-center gap-2">
                            <ClipboardCheck className="w-4 h-4 text-emerald-500" />
                            <span>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…: <strong>{getObligation(selectedBreach.obligationId)?.code}</strong></span>
                          </div>
                          {selectedBreach.controlId && (
                            <div className="flex items-center gap-2">
                              <Shield className="w-4 h-4 text-blue-500" />
                              <span>Ø§Ù„Ø¶Ø§Ø¨Ø·: <strong>{getControl(selectedBreach.controlId)?.code}</strong></span>
                            </div>
                          )}
                        </div> </div> </div>
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø§Ù„Ùƒ:</span><span className="font-bold">{getUser(selectedBreach.ownerId)?.name}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹:</span><span className="font-bold">{getUser(selectedBreach.reviewerId)?.name}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯:</span><span className="font-bold">{getUser(selectedBreach.approverId)?.name}</span></div>
                        </div> </div>
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù:</span><span className="font-bold">{selectedBreach.breachDate}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚:</span><span className="font-bold">{selectedBreach.dueDate}</span></div>
                          {selectedBreach.closedAt && (
                            <div className="flex justify-between"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚:</span><span className="font-bold text-emerald-600">{selectedBreach.closedAt}</span></div>
                          )}
                        </div> </div> </div> </div>
                )}

                {breachTab === 'source' && (
                  <div className="space-y-4">
                    <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-200">
                      <h4 className="font-bold text-blue-800 mb-3 flex items-center gap-2">
                        <Link2 className="w-5 h-5" />Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                      </h4>
                      <div className="flex items-center gap-4">
                        <div className={`w-12 h-12 rounded-xl bg-${SOURCE_TYPE_CONFIG[selectedBreach.sourceType]?.color}-500 flex items-center justify-center text-white`}>
                          {React.createElement(SOURCE_TYPE_CONFIG[selectedBreach.sourceType]?.icon || Clock, { className: "w-6 h-6" })}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{SOURCE_TYPE_CONFIG[selectedBreach.sourceType]?.label}</p>
                          {selectedBreach.sourceRefId && (
                            <p className="text-sm text-slate-500">Ø§Ù„Ù…Ø±Ø¬Ø¹: #{selectedBreach.sourceRefId}</p>
                          )}
                        </div> </div> </div> </div>
                )}

                {breachTab === 'actions' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø®Ø·Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© (CAPA)</h4>
                      <button onClick={handleAddAction}
                        className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold">
                        <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡
                      </button> </div>
                    {selectedBreach.actions?.length > 0 ? (
                      <div className="space-y-3">
                        {selectedBreach.actions.map(action => {
                          const typeCfg = ACTION_TYPE_CONFIG[action.type];
                          const TypeIcon = typeCfg?.icon || Zap;
                          return (
                            <div key={action.id} className={`rounded-xl border-2 p-4 ${action.status === 'Done' ? 'bg-emerald-50 border-emerald-200' : 'bg-white border-slate-200'}`}>
                              <div className="flex items-start justify-between">
                                <div className="flex items-start gap-3">
                                  <div className={`w-10 h-10 rounded-xl bg-${typeCfg?.color}-100 flex items-center justify-center`}>
                                    <TypeIcon className={`w-5 h-5 text-${typeCfg?.color}-600`} />
                                  </div>
                                  <div>
                                    <div className="flex items-center gap-2 mb-1">
                                      <span className={`px-2 py-0.5 bg-${typeCfg?.color}-100 text-${typeCfg?.color}-700 rounded text-xs font-bold`}>{typeCfg?.label}</span>
                                      <span className={`px-2 py-0.5 rounded text-xs font-bold ${action.status === 'Done' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>
                                        {action.status === 'Done' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°'}
                                      </span> </div>
                                    <p className="text-slate-800">{action.description}</p>
                                    <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                                      <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {getUser(action.responsibleId)?.name}</span>
                                      <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {action.dueDate}</span>
                                    </div> </div> </div>
                                {action.status !== 'Done' && (
                                  <button onClick={() => handleUpdateActionStatus(action.id, 'Done')}
                                    className="flex items-center gap-1 px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-sm font-bold">
                                    <Check className="w-4 h-4" />Ø¥ÙƒÙ…Ø§Ù„
                                  </button>
                                )}
                              </div> </div>);
                        })}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <Zap className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØµØ­ÙŠØ­ÙŠØ©</p>
                      </div>
                    )}
                  </div>
                )}

                {breachTab === 'rca' && (
                  <div className="space-y-4">
                    {selectedBreach.rca ? (
                      <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-5 border border-indigo-200">
                        <h4 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                          <Search className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (RCA)
                        </h4>
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <p className="text-xs text-slate-500 mb-1">ÙØ¦Ø© Ø§Ù„Ø³Ø¨Ø¨</p>
                            <div className="flex items-center gap-2">
                              {React.createElement(RCA_CATEGORY_CONFIG[selectedBreach.rca.category]?.icon || Users, { className: `w-5 h-5 text-${RCA_CATEGORY_CONFIG[selectedBreach.rca.category]?.color}-500` })}
                              <span className="font-bold text-slate-800">{RCA_CATEGORY_CONFIG[selectedBreach.rca.category]?.label}</span>
                            </div> </div>
                          <div className="bg-white rounded-xl p-4 border border-slate-200">
                            <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ</p>
                            <p className="font-bold text-slate-800">{selectedBreach.rca.rootCause}</p>
                          </div>
                          <div className="col-span-2 bg-white rounded-xl p-4 border border-slate-200">
                            <p className="text-xs text-slate-500 mb-1">ÙØ¬ÙˆØ© Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
                            <p className="text-slate-700">{selectedBreach.rca.linkedControlGap}</p>
                          </div> </div> </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <Search className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ</p>
                        <button className="mt-4 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold">
                          Ø¥Ø¶Ø§ÙØ© RCA
                        </button> </div>
                    )}
                  </div>
                )}

                {breachTab === 'evidence' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</h4>
                      <button className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold">
                        <Upload className="w-5 h-5" />Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„
                      </button> </div>
                    {selectedBreach.closureEvidence?.length > 0 ? (
                      <div className="space-y-3">
                        {selectedBreach.closureEvidence.map(ev => (
                          <div key={ev.id} className="flex items-center gap-4 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                            <CheckCircle2 className="w-6 h-6 text-emerald-500" />
                            <div>
                              <p className="font-bold text-slate-800">Ø¯Ù„ÙŠÙ„ #{ev.evidenceId}</p>
                              <p className="text-sm text-slate-500">Ù‚Ø¨ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø©: {getUser(ev.acceptedBy)?.name} ÙÙŠ {ev.acceptedAt}</p>
                            </div> </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <FileCheck className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ø¥ØºÙ„Ø§Ù‚</p>
                      </div>
                    )}
                  </div>
                )}

                {breachTab === 'escalation' && (
                  <div className="space-y-4">
                    <h4 className="font-bold text-slate-800 mb-4">Ø³Ø¬Ù„ Ø§Ù„ØªØµØ¹ÙŠØ¯</h4>
                    {selectedBreach.escalationHistory?.length > 0 ? (
                      <div className="relative">
                        <div className="absolute right-5 top-0 bottom-0 w-0.5 bg-slate-200"></div>
                        <div className="space-y-4">
                          {selectedBreach.escalationHistory.map((esc, idx) => (
                            <div key={idx} className="relative flex gap-4 pr-10">
                              <div className="absolute right-3 w-4 h-4 rounded-full bg-red-500 border-4 border-white"></div>
                              <div className="flex-1 bg-red-50 rounded-xl p-4 border border-red-200">
                                <div className="flex items-center justify-between mb-2">
                                  <span className="font-bold text-red-700">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {esc.level}</span>
                                  <span className="text-sm text-slate-500">{esc.date}</span>
                                </div>
                                <p className="text-slate-600">{esc.reason}</p>
                                <p className="text-xs text-slate-500 mt-2">
                                  ØªÙ… Ø¥Ø®Ø·Ø§Ø±: {esc.notifiedUsers?.map(id => getUser(id)?.name).join(', ')}
                                </p> </div> </div>
                          ))}
                        </div> </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <TrendingUp className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØµØ¹ÙŠØ¯</p>
                      </div>
                    )}
                  </div>
                )}
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: EXCEPTIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'exceptions' && (
          <div className="p-6">
            <h3 className="font-bold text-slate-800 mb-6">Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h3>
            <div className="grid grid-cols-2 gap-4">
              {breaches.filter(b => b.status === 'AcceptedException' && b.exceptions?.length > 0).map(breach => {
                const exception = breach.exceptions[0];
                const daysUntilExpiry = getDaysUntilDue(exception.expiryDate);
                return (
                  <div key={breach.id} className={`rounded-xl border-2 p-5 ${daysUntilExpiry !== null && daysUntilExpiry <= 7 ? 'border-amber-300 bg-amber-50' : 'border-purple-200 bg-purple-50'}`}>
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <span className="font-mono text-sm font-bold text-purple-600">{breach.code}</span>
                        <h4 className="font-bold text-slate-800 mt-1">{breach.title}</h4>
                      </div>
                      <span className={`px-2 py-1 rounded text-xs font-bold ${exception.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>
                        {exception.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                      </span> </div>
                    <p className="text-sm text-slate-600 mb-3">{exception.reason}</p>
                    <div className="flex items-center justify-between text-xs text-slate-500">
                      <span>Ø§Ø¹ØªÙ…Ø§Ø¯: {getUser(exception.approvedBy)?.name}</span>
                      <span className={daysUntilExpiry !== null && daysUntilExpiry <= 7 ? 'text-amber-600 font-bold' : ''}>
                        Ø§Ù†ØªÙ‡Ø§Ø¡: {exception.expiryDate} {daysUntilExpiry !== null && daysUntilExpiry <= 7 && `(${daysUntilExpiry} ÙŠÙˆÙ…)`}
                      </span> </div> </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: CAPA (Corrective and Preventive Actions)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'capa' && (
          <div className="p-6 space-y-6">
            <div className="grid grid-cols-5 gap-4">
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-5 text-white">
                <Target className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{capaRecords.length}</p>
                <p className="text-blue-100 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ CAPA</p>
              </div>
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
                <Clock className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{capaRecords.filter(c => c.status === 'InProgress').length}</p>
                <p className="text-amber-100 text-sm">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
                <CheckCircle2 className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{capaRecords.filter(c => c.status === 'Closed').length}</p>
                <p className="text-emerald-100 text-sm">Ù…ÙƒØªÙ…Ù„</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-5 text-white">
                <Eye className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{capaRecords.filter(c => c.effectivenessStatus === 'Pending').length}</p>
                <p className="text-purple-100 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</p>
              </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-5 text-white">
                <AlertTriangle className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{capaRecords.filter(c => new Date(c.targetDate) < new Date() && c.status !== 'Closed').length}</p>
                <p className="text-red-100 text-sm">Ù…ØªØ£Ø®Ø±</p>
              </div> </div>
            <div className="flex justify-between items-center">
              <h3 className="text-xl font-bold text-slate-800">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© (CAPA)</h3>
              <button onClick={() => { setShowCAPAModal(true); setSelectedCAPA(null); setCAPAFormData({ type: 'Corrective', priority: 'High', status: 'Draft', milestones: [] }); }}
                className="flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© CAPA Ø¬Ø¯ÙŠØ¯
              </button> </div>
            <div className="space-y-4">
              {capaRecords.map(capa => {
                const breach = breaches.find(b => b.id === capa.breachId);
                const completedMilestones = capa.milestones.filter(m => m.status === 'Done').length;
                const totalMilestones = capa.milestones.length;
                const progress = totalMilestones > 0 ? Math.round((completedMilestones / totalMilestones) * 100) : 0;
                const isOverdue = new Date(capa.targetDate) < new Date() && capa.status !== 'Closed';

                return (
                  <div key={capa.id} className={`bg-white rounded-2xl border-2 p-6 transition-all hover:shadow-lg ${isOverdue ? 'border-red-300' : capa.status === 'Closed' ? 'border-emerald-300' : 'border-slate-200'
                    }`}>
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${capa.type === 'Corrective' ? 'bg-red-100' : 'bg-blue-100'
                          }`}>
                          {capa.type === 'Corrective' ? <Wrench className="w-7 h-7 text-red-600" /> : <Shield className="w-7 h-7 text-blue-600" />}
                        </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{capa.code}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${capa.type === 'Corrective' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'
                              }`}>{capa.type === 'Corrective' ? 'ØªØµØ­ÙŠØ­ÙŠ' : 'ÙˆÙ‚Ø§Ø¦ÙŠ'}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${capa.priority === 'Critical' ? 'bg-red-500 text-white' :
                              capa.priority === 'High' ? 'bg-orange-100 text-orange-700' :
                                capa.priority === 'Medium' ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'
                              }`}>{capa.priority}</span>
                          </div>
                          <h4 className="font-bold text-slate-800">{capa.description}</h4>
                          <p className="text-sm text-slate-500 mt-1">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©: {breach?.code} - {breach?.title}</p>
                        </div> </div>
                      <div className="flex items-center gap-2">
                        <span className={`px-3 py-1.5 rounded-xl text-sm font-bold ${capa.status === 'Closed' ? 'bg-emerald-100 text-emerald-700' :
                          capa.status === 'InProgress' ? 'bg-amber-100 text-amber-700' :
                            capa.status === 'Open' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-700'
                          }`}>{capa.status === 'Closed' ? 'Ù…ÙƒØªÙ…Ù„' : capa.status === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : capa.status === 'Open' ? 'Ù…ÙØªÙˆØ­' : 'Ù…Ø³ÙˆØ¯Ø©'}</span>
                        <button onClick={() => { setSelectedCAPA(capa); setCAPAFormData(capa); setShowCAPAModal(true); }}
                          className="p-2 hover:bg-slate-100 rounded-lg text-slate-500"><Eye className="w-5 h-5" /></button>
                        <button onClick={() => { setSelectedCAPA(capa); setCAPAFormData(capa); setShowCAPAModal(true); }}
                          className="p-2 hover:bg-blue-50 rounded-lg text-blue-500"><Edit className="w-5 h-5" /></button>
                      </div> </div>
                    <div className="mb-4">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-bold text-slate-600">Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ù…</span>
                        <span className="text-sm font-bold text-slate-800">{completedMilestones}/{totalMilestones} ({progress}%)</span>
                      </div>
                      <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full transition-all ${progress === 100 ? 'bg-emerald-500' : 'bg-blue-500'}`}
                          style={{ width: `${progress}%` }} />
                      </div> </div>
                    <div className="bg-slate-50 rounded-xl p-4 mb-4">
                      <h5 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                        <GitBranch className="w-4 h-4" />Ø§Ù„Ù…Ø¹Ø§Ù„Ù… ÙˆØ§Ù„Ù…Ù‡Ø§Ù…
                      </h5>
                      <div className="space-y-2">
                        {capa.milestones.map((milestone, idx) => (
                          <div key={milestone.id} className={`flex items-center gap-3 p-3 rounded-lg border ${milestone.status === 'Done' ? 'bg-emerald-50 border-emerald-200' :
                            milestone.status === 'InProgress' ? 'bg-amber-50 border-amber-200' : 'bg-white border-slate-200'
                            }`}>
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${milestone.status === 'Done' ? 'bg-emerald-500 text-white' :
                              milestone.status === 'InProgress' ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-500'
                              }`}>
                              {milestone.status === 'Done' ? <Check className="w-4 h-4" /> : idx + 1}
                            </div>
                            <div className="flex-1">
                              <p className="font-bold text-slate-800 text-sm">{milestone.title}</p>
                              <p className="text-xs text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {milestone.dueDate} {milestone.completedDate && `â€¢ Ø§ÙƒØªÙ…Ù„: ${milestone.completedDate}`}</p>
                            </div>
                            {milestone.evidence && (
                              <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold flex items-center gap-1">
                                <FileCheck className="w-3 h-3" />{milestone.evidence}
                              </span>
                            )}
                          </div>
                        ))}
                      </div> </div>
                    <div className="grid grid-cols-4 gap-4 text-sm">
                      <div className="bg-white rounded-lg p-3 border border-slate-200">
                        <p className="text-slate-500 text-xs">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ</p>
                        <p className="font-bold text-slate-800">{capa.rootCause}</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 border border-slate-200">
                        <p className="text-slate-500 text-xs">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù</p>
                        <p className={`font-bold ${isOverdue ? 'text-red-600' : 'text-slate-800'}`}>{capa.targetDate}</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 border border-slate-200">
                        <p className="text-slate-500 text-xs">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                        <p className="font-bold text-slate-800">{USERS.find(u => u.id === capa.assignedTo)?.name}</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 border border-slate-200">
                        <p className="text-slate-500 text-xs">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</p>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${capa.effectivenessStatus === 'Verified' ? 'bg-emerald-100 text-emerald-700' :
                          capa.effectivenessStatus === 'Pending' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-600'
                          }`}>{capa.effectivenessStatus === 'Verified' ? 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚' : capa.effectivenessStatus === 'Pending' ? 'Ù…Ø¹Ù„Ù‚' : 'Ù„Ù… ÙŠØ¨Ø¯Ø£'}</span>
                      </div> </div> </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: REPORTS (ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'reports' && (
          <div className="p-6 space-y-6">
            <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-bold text-indigo-800 flex items-center gap-2">
                  <BarChart3 className="w-5 h-5" />ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
                </h3>
                <div className="flex items-center gap-2">
                  <button onClick={() => {
                    const data = breaches.map(b => ({
                      Ø§Ù„ÙƒÙˆØ¯: b.code, Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: b.title, Ø§Ù„Ø®Ø·ÙˆØ±Ø©: b.severity,
                      Ø§Ù„Ø­Ø§Ù„Ø©: b.status, ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§ÙƒØªØ´Ø§Ù: b.breachDate, ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: b.dueDate
                    }));
                    ExportUtils.toCSV(data, 'violations-report.csv');
                  }} className="flex items-center gap-2 px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl font-bold hover:bg-emerald-200">
                    <Download className="w-4 h-4" />CSV
                  </button>
                  <button onClick={() => {
                    const headers = ['Ø§Ù„ÙƒÙˆØ¯', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'Ø§Ù„Ø®Ø·ÙˆØ±Ø©', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'];
                    const rows = breaches.map(b => [b.code, b.title, b.severity, b.status, b.breachDate]);
                    const tableHtml = ExportUtils.createTable(headers, rows);
                    ExportUtils.toPDF('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', tableHtml);
                  }} className="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-xl font-bold hover:bg-red-200">
                    <FileText className="w-4 h-4" />PDF
                  </button> </div> </div>
              <div className="flex gap-3 flex-wrap">
                {[
                  { id: 'aging', label: 'ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', icon: Clock, color: 'amber' },
                  { id: 'repeat', label: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©', icon: RefreshCw, color: 'red' },
                  { id: 'department', label: 'Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', icon: Building2, color: 'blue' },
                  { id: 'financial', label: 'Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ', icon: DollarSign, color: 'emerald' },
                  { id: 'penalty', label: 'ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØºØ±Ø§Ù…Ø§Øª', icon: Scale, color: 'purple' },
                ].map(report => (
                  <button key={report.id} onClick={() => setReportType(report.id)}
                    className={`flex items-center gap-2 px-5 py-3 rounded-xl font-bold transition-all ${reportType === report.id
                      ? `bg-${report.color}-500 text-white shadow-lg`
                      : `bg-white text-${report.color}-700 border-2 border-${report.color}-200 hover:bg-${report.color}-50`
                      }`}>
                    <report.icon className="w-5 h-5" />{report.label}
                  </button>
                ))}
              </div> </div>
            {reportType === 'aging' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Clock className="w-5 h-5 text-amber-500" />ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª (Aging Report)
                </h4>
                <div className="grid grid-cols-5 gap-4 mb-6">
                  {[
                    { range: '0-7 Ø£ÙŠØ§Ù…', count: breaches.filter(b => { const days = Math.floor((new Date() - new Date(b.breachDate)) / (1000 * 60 * 60 * 24)); return days >= 0 && days <= 7 && b.status !== 'Closed'; }).length, color: 'emerald' },
                    { range: '8-14 ÙŠÙˆÙ…', count: breaches.filter(b => { const days = Math.floor((new Date() - new Date(b.breachDate)) / (1000 * 60 * 60 * 24)); return days >= 8 && days <= 14 && b.status !== 'Closed'; }).length, color: 'blue' },
                    { range: '15-30 ÙŠÙˆÙ…', count: breaches.filter(b => { const days = Math.floor((new Date() - new Date(b.breachDate)) / (1000 * 60 * 60 * 24)); return days >= 15 && days <= 30 && b.status !== 'Closed'; }).length, color: 'amber' },
                    { range: '31-60 ÙŠÙˆÙ…', count: breaches.filter(b => { const days = Math.floor((new Date() - new Date(b.breachDate)) / (1000 * 60 * 60 * 24)); return days >= 31 && days <= 60 && b.status !== 'Closed'; }).length, color: 'orange' },
                    { range: '60+ ÙŠÙˆÙ…', count: breaches.filter(b => { const days = Math.floor((new Date() - new Date(b.breachDate)) / (1000 * 60 * 60 * 24)); return days > 60 && b.status !== 'Closed'; }).length, color: 'red' },
                  ].map((bucket, idx) => (
                    <div key={idx} className={`bg-${bucket.color}-50 rounded-xl p-4 border-2 border-${bucket.color}-200 text-center`}>
                      <p className={`text-3xl font-black text-${bucket.color}-600`}>{bucket.count}</p>
                      <p className={`text-sm font-bold text-${bucket.color}-700`}>{bucket.range}</p>
                    </div>
                  ))}
                </div>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-slate-50">
                      <tr>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¹Ù…Ø± (Ø£ÙŠØ§Ù…)</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      </tr> </thead>
                    <tbody className="divide-y divide-slate-100">
                      {breaches.filter(b => b.status !== 'Closed').sort((a, b) => new Date(a.breachDate) - new Date(b.breachDate)).map(breach => {
                        const ageDays = Math.floor((new Date() - new Date(breach.breachDate)) / (1000 * 60 * 60 * 24));
                        return (
                          <tr key={breach.id} className="hover:bg-slate-50">
                            <td className="px-4 py-3 font-mono text-sm font-bold text-indigo-600">{breach.code}</td>
                            <td className="px-4 py-3 font-bold text-slate-800">{breach.title}</td>
                            <td className="px-4 py-3 text-sm">{breach.breachDate}</td>
                            <td className="px-4 py-3">
                              <span className={`px-3 py-1 rounded-full text-sm font-bold ${ageDays > 60 ? 'bg-red-100 text-red-700' :
                                ageDays > 30 ? 'bg-orange-100 text-orange-700' :
                                  ageDays > 14 ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'
                                }`}>{ageDays} ÙŠÙˆÙ…</span>
                            </td>
                            <td className="px-4 py-3">
                              <span className={`px-2 py-1 rounded text-xs font-bold ${SEVERITY_CONFIG[breach.severity]?.light} ${SEVERITY_CONFIG[breach.severity]?.text}`}>
                                {SEVERITY_CONFIG[breach.severity]?.label}
                              </span> </td>
                            <td className="px-4 py-3">
                              <span className={`px-2 py-1 rounded text-xs font-bold ${STATUS_CONFIG[breach.status]?.bg} ${STATUS_CONFIG[breach.status]?.text}`}>
                                {STATUS_CONFIG[breach.status]?.label}
                              </span> </td> </tr>);
                      })}
                    </tbody> </table> </div> </div>
            )}

            {reportType === 'repeat' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <RefreshCw className="w-5 h-5 text-red-500" />ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Repeat Violations)
                </h4>
                <div className="grid grid-cols-3 gap-6 mb-6">
                  <div className="bg-red-50 rounded-xl p-5 border-2 border-red-200">
                    <p className="text-4xl font-black text-red-600">{breaches.filter(b => (b.repeatCount || 0) >= 3).length}</p>
                    <p className="text-red-700 font-bold">3+ ØªÙƒØ±Ø§Ø±Ø§Øª</p>
                    <p className="text-red-500 text-sm">ÙŠØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù… ÙÙˆØ±ÙŠ</p>
                  </div>
                  <div className="bg-orange-50 rounded-xl p-5 border-2 border-orange-200">
                    <p className="text-4xl font-black text-orange-600">{breaches.filter(b => (b.repeatCount || 0) === 2).length}</p>
                    <p className="text-orange-700 font-bold">ØªÙƒØ±Ø§Ø±Ø§Ù†</p>
                    <p className="text-orange-500 text-sm">Ø¨Ø­Ø§Ø¬Ø© Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                  </div>
                  <div className="bg-amber-50 rounded-xl p-5 border-2 border-amber-200">
                    <p className="text-4xl font-black text-amber-600">{breaches.filter(b => (b.repeatCount || 0) === 1).length}</p>
                    <p className="text-amber-700 font-bold">ØªÙƒØ±Ø§Ø± ÙˆØ§Ø­Ø¯</p>
                    <p className="text-amber-500 text-sm">Ù…Ø±Ø§Ù‚Ø¨Ø©</p>
                  </div> </div>
                <div className="space-y-3">
                  {breaches.filter(b => (b.repeatCount || 0) > 0).sort((a, b) => (b.repeatCount || 0) - (a.repeatCount || 0)).map(breach => (
                    <div key={breach.id} className={`p-4 rounded-xl border-2 ${(breach.repeatCount || 0) >= 3 ? 'bg-red-50 border-red-300' :
                      (breach.repeatCount || 0) === 2 ? 'bg-orange-50 border-orange-300' : 'bg-amber-50 border-amber-300'
                      }`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl font-black ${(breach.repeatCount || 0) >= 3 ? 'bg-red-500 text-white' :
                            (breach.repeatCount || 0) === 2 ? 'bg-orange-500 text-white' : 'bg-amber-500 text-white'
                            }`}>{breach.repeatCount || 0}x</div>
                          <div>
                            <p className="font-mono text-sm font-bold text-slate-600">{breach.code}</p>
                            <p className="font-bold text-slate-800">{breach.title}</p>
                            <p className="text-sm text-slate-500">Ø§Ù„Ù‚Ø³Ù…: {breach.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                          </div> </div>
                        <div className="text-left">
                          <p className={`text-2xl font-black ${(breach.repeatCount || 0) >= 3 ? 'text-red-600' : 'text-orange-600'
                            }`}>{((breach.repeatCount || 0) * 0.5 + 1).toFixed(1)}x</p>
                          <p className="text-sm text-slate-500">Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©</p>
                        </div> </div> </div>
                  ))}
                </div> </div>
            )}

            {reportType === 'department' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Building2 className="w-5 h-5 text-blue-500" />ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                </h4>
                <div className="space-y-4">
                  {[...new Set(breaches.map(b => b.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'))].map(dept => {
                    const deptBreaches = breaches.filter(b => (b.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') === dept);
                    const openCount = deptBreaches.filter(b => b.status !== 'Closed').length;
                    const criticalCount = deptBreaches.filter(b => b.severity === 'Critical' && b.status !== 'Closed').length;
                    const totalImpact = deptBreaches.reduce((sum, b) => sum + (b.financialImpact?.totalEstimate || 0), 0);

                    return (
                      <div key={dept} className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center gap-3">
                            <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                              <Building2 className="w-6 h-6 text-blue-600" />
                            </div>
                            <div>
                              <h5 className="font-bold text-slate-800 text-lg">{dept}</h5>
                              <p className="text-sm text-slate-500">{deptBreaches.length} Ù…Ø®Ø§Ù„ÙØ© Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                            </div> </div>
                          <div className="flex items-center gap-6">
                            <div className="text-center">
                              <p className="text-2xl font-black text-amber-600">{openCount}</p>
                              <p className="text-xs text-slate-500">Ù…ÙØªÙˆØ­</p>
                            </div>
                            <div className="text-center">
                              <p className="text-2xl font-black text-red-600">{criticalCount}</p>
                              <p className="text-xs text-slate-500">Ø­Ø±Ø¬</p>
                            </div>
                            <div className="text-center">
                              <p className="text-2xl font-black text-emerald-600">{(totalImpact / 1000).toFixed(0)}K</p>
                              <p className="text-xs text-slate-500">Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</p>
                            </div> </div> </div>
                        <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                          <div className="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"
                            style={{ width: `${(openCount / Math.max(deptBreaches.length, 1)) * 100}%` }} />
                        </div> </div>);
                  })}
                </div> </div>
            )}

            {reportType === 'financial' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <DollarSign className="w-5 h-5 text-emerald-500" />ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ
                </h4>
                <div className="grid grid-cols-4 gap-4 mb-6">
                  <div className="bg-red-50 rounded-xl p-5 border-2 border-red-200 text-center">
                    <p className="text-3xl font-black text-red-600">
                      {(breaches.reduce((sum, b) => sum + (b.financialImpact?.directCost || 0), 0) / 1000).toFixed(0)}K
                    </p>
                    <p className="text-red-700 font-bold text-sm">ØªÙƒØ§Ù„ÙŠÙ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
                  </div>
                  <div className="bg-orange-50 rounded-xl p-5 border-2 border-orange-200 text-center">
                    <p className="text-3xl font-black text-orange-600">
                      {(breaches.reduce((sum, b) => sum + (b.financialImpact?.indirectCost || 0), 0) / 1000).toFixed(0)}K
                    </p>
                    <p className="text-orange-700 font-bold text-sm">ØªÙƒØ§Ù„ÙŠÙ ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø±Ø©</p>
                  </div>
                  <div className="bg-purple-50 rounded-xl p-5 border-2 border-purple-200 text-center">
                    <p className="text-3xl font-black text-purple-600">
                      {(breaches.reduce((sum, b) => sum + (b.financialImpact?.reputationalDamage || 0), 0) / 1000).toFixed(0)}K
                    </p>
                    <p className="text-purple-700 font-bold text-sm">Ø¶Ø±Ø± Ø³Ù…Ø¹ÙŠ</p>
                  </div>
                  <div className="bg-emerald-50 rounded-xl p-5 border-2 border-emerald-200 text-center">
                    <p className="text-3xl font-black text-emerald-600">
                      {(breaches.reduce((sum, b) => sum + (b.financialImpact?.totalEstimate || 0), 0) / 1000000).toFixed(2)}M
                    </p>
                    <p className="text-emerald-700 font-bold text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                  </div> </div>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-slate-50">
                      <tr>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ù…Ø¨Ø§Ø´Ø±</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø±</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ù…Ø¹Ø§Ù„Ø¬Ø©</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø³Ù…Ø¹ÙŠ</th>
                        <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                      </tr> </thead>
                    <tbody className="divide-y divide-slate-100">
                      {breaches.filter(b => b.financialImpact).sort((a, b) => (b.financialImpact?.totalEstimate || 0) - (a.financialImpact?.totalEstimate || 0)).map(breach => (
                        <tr key={breach.id} className="hover:bg-slate-50">
                          <td className="px-4 py-3">
                            <p className="font-mono text-sm font-bold text-indigo-600">{breach.code}</p>
                            <p className="text-sm text-slate-600">{breach.title}</p>
                          </td>
                          <td className="px-4 py-3 font-bold text-red-600">{(breach.financialImpact?.directCost || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 font-bold text-orange-600">{(breach.financialImpact?.indirectCost || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 font-bold text-blue-600">{(breach.financialImpact?.remediationCost || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 font-bold text-purple-600">{(breach.financialImpact?.reputationalDamage || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 font-black text-emerald-600 text-lg">{(breach.financialImpact?.totalEstimate || 0).toLocaleString()}</td>
                        </tr>
                      ))}
                    </tbody> </table> </div> </div>
            )}

            {reportType === 'penalty' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <Scale className="w-5 h-5 text-purple-500" />ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØºØ±Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
                </h4>
                <div className="grid grid-cols-3 gap-4 mb-6">
                  <div className="bg-emerald-50 rounded-xl p-5 border-2 border-emerald-200 text-center">
                    <p className="text-3xl font-black text-emerald-600">
                      {(breaches.reduce((sum, b) => sum + (b.penaltyEstimate?.min || 0), 0) / 1000000).toFixed(2)}M
                    </p>
                    <p className="text-emerald-700 font-bold">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</p>
                  </div>
                  <div className="bg-amber-50 rounded-xl p-5 border-2 border-amber-200 text-center">
                    <p className="text-3xl font-black text-amber-600">
                      {(breaches.reduce((sum, b) => sum + (b.penaltyEstimate?.likely || 0), 0) / 1000000).toFixed(2)}M
                    </p>
                    <p className="text-amber-700 font-bold">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                  </div>
                  <div className="bg-red-50 rounded-xl p-5 border-2 border-red-200 text-center">
                    <p className="text-3xl font-black text-red-600">
                      {(breaches.reduce((sum, b) => sum + (b.penaltyEstimate?.max || 0), 0) / 1000000).toFixed(2)}M
                    </p>
                    <p className="text-red-700 font-bold">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</p>
                  </div> </div>
                <div className="space-y-4">
                  {breaches.filter(b => b.penaltyEstimate).sort((a, b) => (b.penaltyEstimate?.likely || 0) - (a.penaltyEstimate?.likely || 0)).map(breach => (
                    <div key={breach.id} className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                      <div className="flex items-center justify-between mb-4">
                        <div>
                          <p className="font-mono text-sm font-bold text-indigo-600">{breach.code}</p>
                          <p className="font-bold text-slate-800">{breach.title}</p>
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${breach.penaltyEstimate?.authority === 'NCA' ? 'bg-purple-100 text-purple-700' :
                            breach.penaltyEstimate?.authority === 'SAMA' ? 'bg-emerald-100 text-emerald-700' : 'bg-blue-100 text-blue-700'
                            }`}>{breach.penaltyEstimate?.authority}</span>
                        </div>
                        <div className="text-left">
                          <p className="text-2xl font-black text-amber-600">{(breach.penaltyEstimate?.likely || 0).toLocaleString()} Ø±ÙŠØ§Ù„</p>
                          <p className="text-sm text-slate-500">Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                        </div> </div>
                      <div className="flex items-center gap-4">
                        <div className="flex-1">
                          <div className="h-4 bg-gradient-to-r from-emerald-500 via-amber-500 to-red-500 rounded-full relative">
                            <div className="absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white border-2 border-slate-800 rounded-full"
                              style={{ left: `${((breach.penaltyEstimate?.likely || 0) - (breach.penaltyEstimate?.min || 0)) / ((breach.penaltyEstimate?.max || 1) - (breach.penaltyEstimate?.min || 0)) * 100}%` }} />
                          </div>
                          <div className="flex justify-between mt-1 text-xs text-slate-500">
                            <span>{(breach.penaltyEstimate?.min || 0).toLocaleString()}</span>
                            <span>{(breach.penaltyEstimate?.max || 0).toLocaleString()}</span>
                          </div> </div> </div> </div>
                  ))}
                </div> </div>
            )}
          </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          BREACH WIZARD MODAL - Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª - ULTIMATE 10-STEP EDITION
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'breach' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden">
            <div className="bg-gradient-to-l from-red-600 via-orange-500 to-amber-500 px-6 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <AlertTriangle className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-black">{modalMode === 'create' ? 'Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ©' : 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©'}</h2>
                    <p className="text-orange-200 font-mono text-sm">{formData.code}</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="relative w-16 h-16">
                    <svg className="w-16 h-16 transform -rotate-90">
                      <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.2)" strokeWidth="4" fill="none" />
                      <circle cx="32" cy="32" r="28" stroke="white" strokeWidth="4" fill="none"
                        strokeDasharray={`${(wizardStep / 9) * 176} 176`} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">
                      <span className="text-lg font-black">{wizardStep + 1}/10</span>
                    </div> </div>
                  <button onClick={() => { setShowModal(false); setWizardStep(0); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-5 h-5" />
                  </button> </div> </div>
              <div className="grid grid-cols-10 gap-1">
                {[
                  { step: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                  { step: 1, label: 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù†Ø·Ø§Ù‚', icon: Calendar },
                  { step: 2, label: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: Building2 },
                  { step: 3, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©', icon: ClipboardCheck },
                  { step: 4, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±', icon: Shield },
                  { step: 5, label: 'Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', icon: Search },
                  { step: 6, label: 'Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ø®Ø·ÙˆØ±Ø©', icon: AlertTriangle },
                  { step: 7, label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„ÙØ±ÙŠÙ‚', icon: Users },
                  { step: 8, label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©', icon: Zap },
                  { step: 9, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', icon: CheckCircle2 },
                ].map((s) => (
                  <button key={s.step} onClick={() => setWizardStep(s.step)}
                    className={`flex flex-col items-center p-2 rounded-xl transition-all ${wizardStep === s.step ? 'bg-white text-red-600' :
                      wizardStep > s.step ? 'bg-emerald-400/40 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20'
                      }`}>
                    <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-1 ${wizardStep === s.step ? 'bg-red-100' :
                      wizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                      }`}>
                      {wizardStep > s.step ? <Check className="w-4 h-4" /> : <s.icon className="w-4 h-4" />}
                    </div>
                    <span className="text-[9px] font-bold text-center leading-tight">{s.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="p-6 max-h-[50vh] overflow-y-auto">

              {wizardStep === 0 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-red-50 to-orange-50 rounded-2xl p-5 border-2 border-red-200">
                    <h3 className="text-lg font-black text-red-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-red-500 text-white rounded-lg flex items-center justify-center text-sm">1</span>
                      <FileText className="w-5 h-5" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© *</label>
                        <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-red-200 rounded-xl text-lg font-bold focus:border-red-500 focus:outline-none"
                          placeholder="Ù…Ø«Ø§Ù„: ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„" />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</label>
                          <select value={formData.breachType || ''} onChange={(e) => setFormData({ ...formData, breachType: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                            <option value="Regulatory">ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</option>
                            <option value="Operational">ØªØ´ØºÙŠÙ„ÙŠØ©</option>
                            <option value="Security">Ø£Ù…Ù†ÙŠØ©</option>
                            <option value="Data">Ø¨ÙŠØ§Ù†Ø§Øª</option>
                            <option value="Financial">Ù…Ø§Ù„ÙŠØ©</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</label>
                          <input type="text" value={formData.reference || ''} onChange={(e) => setFormData({ ...formData, reference: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl"
                            placeholder="Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ Ø£Ùˆ Ù…Ù„Ù" />
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                        <textarea rows={3} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ø®Ø§Ù„ÙØ© ÙˆØ¸Ø±ÙˆÙ Ø­Ø¯ÙˆØ«Ù‡Ø§..." />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 1 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-lg font-black text-blue-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm">2</span>
                      <Calendar className="w-5 h-5" />Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
                    </h3>
                    <div className="grid grid-cols-3 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù *</label>
                        <input type="date" value={formData.breachDate || ''} onChange={(e) => setFormData({ ...formData, breachDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯ÙˆØ« (ØªÙ‚Ø¯ÙŠØ±ÙŠ)</label>
                        <input type="date" value={formData.occurrenceDate || ''} onChange={(e) => setFormData({ ...formData, occurrenceDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù *</label>
                        <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500" />
                      </div> </div>
                    <div className="mt-4 grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                        <select value={formData.affectedPeriod || ''} onChange={(e) => setFormData({ ...formData, affectedPeriod: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
                          <option value="Q1-2025">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ 2025</option>
                          <option value="Q2-2025">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ 2025</option>
                          <option value="Q3-2025">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø« 2025</option>
                          <option value="Q4-2025">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ 2025</option>
                          <option value="2025">Ø§Ù„Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© 2025</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø¯Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± (Ø£ÙŠØ§Ù…)</label>
                        <input type="number" value={formData.impactDuration || ''} onChange={(e) => setFormData({ ...formData, impactDuration: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…" />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">3</span>
                      <Building2 className="w-5 h-5" />Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-4 gap-3">
                      {[
                        { id: 1, code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', color: 'emerald' },
                        { id: 2, code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', color: 'blue' },
                        { id: 3, code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', color: 'purple' },
                        { id: 4, code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', color: 'indigo' },
                      ].map(auth => (
                        <button key={auth.id} type="button" onClick={() => setFormData({ ...formData, authorityId: auth.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.authorityId === auth.id ? `border-${auth.color}-500 bg-${auth.color}-100` : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <div className={`w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center font-black text-lg ${formData.authorityId === auth.id ? `bg-${auth.color}-500 text-white` : 'bg-slate-100 text-slate-600'
                            }`}>{auth.code.substring(0, 2)}</div>
                          <p className="text-xs font-bold text-slate-700">{auth.name}</p>
                        </button>
                      ))}
                    </div>
                    <div className="mt-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø± / Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                      <div className="grid grid-cols-3 gap-2">
                        {['SAMA-AML/CFT', 'SAMA-BCM', 'NCA-ECC', 'PDPL', 'ISO 27001', 'PCI-DSS'].map(fw => (
                          <button key={fw} type="button" onClick={() => setFormData({ ...formData, framework: fw })}
                            className={`p-3 rounded-xl border-2 text-sm font-bold transition-all ${formData.framework === fw ? 'border-emerald-500 bg-emerald-100 text-emerald-700' : 'border-slate-200 hover:border-slate-300'
                              }`}>{fw}</button>
                        ))}
                      </div> </div> </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                    <h3 className="text-lg font-black text-amber-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center text-sm">4</span>
                      <ClipboardCheck className="w-5 h-5" />Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                    </h3>
                    <div className="relative mb-3">
                      <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                      <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª..." className="w-full pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl" />
                    </div>
                    <div className="max-h-48 overflow-y-auto space-y-2">
                      {INITIAL_OBLIGATIONS.filter(o => !formData.authorityId || o.authorityId === formData.authorityId).map(obl => {
                        const isSelected = formData.obligationId === obl.id;
                        return (
                          <div key={obl.id} onClick={() => setFormData({ ...formData, obligationId: obl.id })}
                            className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-amber-500 bg-amber-100' : 'border-slate-200 hover:border-amber-300'}`}>
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-2">
                                <span className="font-mono text-xs font-bold text-amber-600 bg-amber-50 px-2 py-0.5 rounded">{obl.code}</span>
                              </div>
                              {isSelected && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                            </div>
                            <p className="font-medium text-slate-800 text-sm mt-1">{obl.title}</p>
                          </div>);
                      })}
                    </div> </div> </div>
              )}

              {wizardStep === 4 && (
                <div className="grid grid-cols-2 gap-5">
                  <div className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-2xl p-5 border-2 border-indigo-200">
                    <h3 className="text-base font-black text-indigo-800 mb-3 flex items-center gap-2">
                      <Shield className="w-5 h-5" />Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
                    </h3>
                    <div className="max-h-40 overflow-y-auto space-y-2">
                      {CONTROLS.map(ctrl => (
                        <div key={ctrl.id} onClick={() => setFormData({ ...formData, controlId: ctrl.id })}
                          className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.controlId === ctrl.id ? 'border-indigo-500 bg-indigo-100' : 'border-slate-200 hover:border-indigo-300'}`}>
                          <div className="flex items-center justify-between">
                            <span className="font-mono text-xs font-bold text-indigo-600">{ctrl.code}</span>
                            {formData.controlId === ctrl.id && <CheckCircle2 className="w-4 h-4 text-indigo-500" />}
                          </div>
                          <p className="text-sm text-slate-700 mt-1">{ctrl.title}</p>
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl p-5 border-2 border-red-200">
                    <h3 className="text-base font-black text-red-800 mb-3 flex items-center gap-2">
                      <AlertTriangle className="w-5 h-5" />Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                    </h3>
                    <div className="max-h-40 overflow-y-auto space-y-2">
                      {[
                        { id: 1, code: 'RISK-001', title: 'Ù…Ø®Ø§Ø·Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', severity: 'High' },
                        { id: 2, code: 'RISK-002', title: 'Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø³Ù…Ø¹Ø©', severity: 'Critical' },
                        { id: 3, code: 'RISK-003', title: 'Ù…Ø®Ø§Ø·Ø± Ù…Ø§Ù„ÙŠØ©', severity: 'High' },
                        { id: 4, code: 'RISK-004', title: 'Ù…Ø®Ø§Ø·Ø± ØªØ´ØºÙŠÙ„ÙŠØ©', severity: 'Medium' },
                      ].map(risk => (
                        <div key={risk.id} onClick={() => setFormData({ ...formData, riskId: risk.id })}
                          className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.riskId === risk.id ? 'border-red-500 bg-red-100' : 'border-slate-200 hover:border-red-300'}`}>
                          <div className="flex items-center justify-between">
                            <span className="font-mono text-xs font-bold text-red-600">{risk.code}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${risk.severity === 'Critical' ? 'bg-red-200 text-red-700' : risk.severity === 'High' ? 'bg-orange-200 text-orange-700' : 'bg-amber-200 text-amber-700'}`}>{risk.severity}</span>
                          </div>
                          <p className="text-sm text-slate-700 mt-1">{risk.title}</p>
                        </div>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 5 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl p-5 border-2 border-cyan-200">
                    <h3 className="text-lg font-black text-cyan-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-cyan-500 text-white rounded-lg flex items-center justify-center text-sm">6</span>
                      <Search className="w-5 h-5" />Ù…ØµØ¯Ø± Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                    </h3>
                    <div className="grid grid-cols-3 gap-3">
                      {[
                        { id: 'Internal', label: 'Ø¯Ø§Ø®Ù„ÙŠ', icon: 'ğŸ¢', desc: 'ØªØ¯Ù‚ÙŠÙ‚ Ø¯Ø§Ø®Ù„ÙŠ Ø£Ùˆ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø°Ø§ØªÙŠØ©' },
                        { id: 'External', label: 'Ø®Ø§Ø±Ø¬ÙŠ', icon: 'ğŸ›ï¸', desc: 'Ø¬Ù‡Ø© Ø±Ù‚Ø§Ø¨ÙŠØ© Ø£Ùˆ Ù…Ø¯Ù‚Ù‚ Ø®Ø§Ø±Ø¬ÙŠ' },
                        { id: 'TestCase', label: 'Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±', icon: 'ğŸ“‹', desc: 'Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„' },
                        { id: 'Complaint', label: 'Ø´ÙƒÙˆÙ‰', icon: 'ğŸ“¢', desc: 'Ø´ÙƒÙˆÙ‰ Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ù…ÙˆØ¸Ù' },
                        { id: 'Incident', label: 'Ø­Ø§Ø¯Ø«Ø©', icon: 'âš ï¸', desc: 'Ø­Ø§Ø¯Ø«Ø© Ø£Ù…Ù†ÙŠØ© Ø£Ùˆ ØªØ´ØºÙŠÙ„ÙŠØ©' },
                        { id: 'SelfReport', label: 'Ø¥ÙØµØ§Ø­ Ø°Ø§ØªÙŠ', icon: 'âœ‹', desc: 'Ø¥Ø¨Ù„Ø§Øº Ø·ÙˆØ¹ÙŠ Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù' },
                      ].map(src => (
                        <button key={src.id} type="button" onClick={() => setFormData({ ...formData, source: src.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.source === src.id ? 'border-cyan-500 bg-cyan-100' : 'border-slate-200 hover:border-cyan-300'
                            }`}>
                          <div className="text-3xl mb-2">{src.icon}</div>
                          <p className="font-bold text-slate-800 text-sm">{src.label}</p>
                          <p className="text-xs text-slate-500 mt-1">{src.desc}</p>
                        </button>
                      ))}
                    </div>
                    {formData.source === 'TestCase' && (
                      <div className="mt-4">
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ø¨Ø· Ø¨Ø­Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</label>
                        <select value={formData.sourceTestCaseId || ''} onChange={(e) => setFormData({ ...formData, sourceTestCaseId: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</option>
                          {testCases.map(tc => <option key={tc.id} value={tc.id}>{tc.code} - {tc.title}</option>)}
                        </select>
                      </div>
                    )}
                  </div> </div>
              )}

              {wizardStep === 6 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-5 border-2 border-purple-200">
                    <h3 className="text-lg font-black text-purple-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm">7</span>
                      <AlertTriangle className="w-5 h-5" />Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø© *</label>
                        <div className="space-y-2">
                          {[
                            { id: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red', desc: 'ÙŠØªØ·Ù„Ø¨ ØªØµØ¹ÙŠØ¯ ÙÙˆØ±ÙŠ' },
                            { id: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', desc: 'ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ø§Ø¬Ù„' },
                            { id: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', desc: 'ÙŠØªØ·Ù„Ø¨ Ù…ØªØ§Ø¨Ø¹Ø©' },
                            { id: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald', desc: 'Ù„Ù„Ø¹Ù„Ù… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' },
                          ].map(sev => (
                            <button key={sev.id} type="button" onClick={() => setFormData({ ...formData, severity: sev.id })}
                              className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.severity === sev.id ? `border-${sev.color}-500 bg-${sev.color}-100` : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className={`w-4 h-4 rounded-full bg-${sev.color}-500`}></div>
                              <div className="flex-1 text-right">
                                <p className="font-bold text-slate-800">{sev.label}</p>
                                <p className="text-xs text-slate-500">{sev.desc}</p>
                              </div>
                              {formData.severity === sev.id && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                        <div className="space-y-2">
                          {[
                            { id: 'Fine', label: 'ØºØ±Ø§Ù…Ø© Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ’°' },
                            { id: 'Warning', label: 'ØªØ­Ø°ÙŠØ± Ø±Ø³Ù…ÙŠ', icon: 'âš ï¸' },
                            { id: 'Suspension', label: 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª', icon: 'â¸ï¸' },
                            { id: 'Reputation', label: 'Ø¶Ø±Ø± Ø³Ù…Ø¹Ø©', icon: 'ğŸ“‰' },
                            { id: 'Legal', label: 'Ø¥Ø¬Ø±Ø§Ø¡ Ù‚Ø§Ù†ÙˆÙ†ÙŠ', icon: 'âš–ï¸' },
                          ].map(exp => {
                            const isSelected = formData.regulatoryExposure?.includes(exp.id);
                            return (
                              <button key={exp.id} type="button" onClick={() => {
                                const current = formData.regulatoryExposure || [];
                                setFormData({ ...formData, regulatoryExposure: isSelected ? current.filter(e => e !== exp.id) : [...current, exp.id] });
                              }}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${isSelected ? 'border-purple-500 bg-purple-100' : 'border-slate-200 hover:border-slate-300'
                                  }`}>
                                <span className="text-xl">{exp.icon}</span>
                                <span className="font-bold text-slate-800 flex-1 text-right">{exp.label}</span>
                                {isSelected && <CheckCircle2 className="w-5 h-5 text-purple-500" />}
                              </button>);
                          })}
                        </div> </div> </div> </div> </div>
              )}

              {wizardStep === 7 && (
                <div className="grid grid-cols-3 gap-5">
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-base font-black text-blue-800 mb-3 flex items-center gap-2">
                      <User className="w-5 h-5" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                    </h3>
                    <div className="space-y-2">
                      {USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, ownerId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.ownerId === user.id ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.ownerId === user.id ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                            <p className="text-xs text-slate-500">{user.role}</p>
                          </div>
                          {formData.ownerId === user.id && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                    <h3 className="text-base font-black text-amber-800 mb-3 flex items-center gap-2">
                      <UserCheck className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
                    </h3>
                    <div className="space-y-2">
                      {USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, reviewerId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.reviewerId === user.id ? 'border-amber-500 bg-amber-100' : 'border-slate-200 hover:border-amber-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.reviewerId === user.id ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                          </div>
                          {formData.reviewerId === user.id && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-base font-black text-emerald-800 mb-3 flex items-center gap-2">
                      <Award className="w-5 h-5" />Ø§Ù„Ù…Ø¹ØªÙ…Ø¯
                    </h3>
                    <div className="space-y-2">
                      {USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, approverId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.approverId === user.id ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.approverId === user.id ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                          </div>
                          {formData.approverId === user.id && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                        </div>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 8 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-teal-50 to-emerald-50 rounded-2xl p-5 border-2 border-teal-200">
                    <h3 className="text-lg font-black text-teal-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-teal-500 text-white rounded-lg flex items-center justify-center text-sm">9</span>
                      <Zap className="w-5 h-5" />Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙÙˆØ±ÙŠ</label>
                        <textarea rows={2} value={formData.immediateAction || ''} onChange={(e) => setFormData({ ...formData, immediateAction: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©..." />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ</label>
                        <textarea rows={2} value={formData.correctiveAction || ''} onChange={(e) => setFormData({ ...formData, correctiveAction: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ..." />
                      </div> </div>
                    <div className="mt-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ</label>
                      <textarea rows={2} value={formData.preventiveAction || ''} onChange={(e) => setFormData({ ...formData, preventiveAction: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                        placeholder="Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹..." />
                    </div>
                    <div className="mt-4 p-4 bg-white rounded-xl border border-slate-200">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" checked={formData.requiresEscalation || false} onChange={(e) => setFormData({ ...formData, requiresEscalation: e.target.checked })}
                          className="w-5 h-5 rounded text-teal-500" />
                        <span className="font-bold text-slate-700">ÙŠØªØ·Ù„Ø¨ ØªØµØ¹ÙŠØ¯ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</span>
                      </label>
                    </div> </div> </div>
              )}

              {wizardStep === 9 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">10</span>
                      <CheckCircle2 className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><FileText className="w-4 h-4 text-red-500" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span><span className="font-bold">{formData.code}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span><span className="font-bold truncate max-w-32">{formData.title || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù†ÙˆØ¹:</span><span className="font-bold">{formData.breachType || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Calendar className="w-4 h-4 text-blue-500" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§ÙƒØªØ´Ø§Ù:</span><span className="font-bold">{formData.breachDate || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span><span className="font-bold">{formData.dueDate || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><AlertTriangle className="w-4 h-4 text-orange-500" />Ø§Ù„ØªØµÙ†ÙŠÙ</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ±Ø©:</span><span className="font-bold">{formData.severity || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…ØµØ¯Ø±:</span><span className="font-bold">{formData.source || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Users className="w-4 h-4 text-purple-500" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span><span className="font-bold">{getUser(formData.ownerId)?.name || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹:</span><span className="font-bold">{getUser(formData.reviewerId)?.name || '-'}</span></div>
                        </div> </div> </div>
                    <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-2 text-sm">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                      <div className="grid grid-cols-3 gap-2">
                        {[
                          { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', valid: formData.title?.length >= 5 },
                          { label: 'Ø§Ù„ÙˆØµÙ', valid: formData.description?.length >= 10 },
                          { label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù', valid: !!formData.breachDate },
                          { label: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', valid: !!formData.authorityId },
                          { label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', valid: !!formData.obligationId },
                          { label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', valid: !!formData.ownerId },
                        ].map((check, idx) => (
                          <div key={idx} className={`flex items-center gap-1 p-1.5 rounded-lg text-xs ${check.valid ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                            {check.valid ? <CheckCircle2 className="w-3 h-3" /> : <XCircle className="w-3 h-3" />}
                            <span className="font-bold">{check.label}</span>
                          </div>
                        ))}
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => wizardStep > 0 ? setWizardStep(wizardStep - 1) : setShowModal(false)}
                className="flex items-center gap-2 px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                <ChevronRight className="w-4 h-4" />
                {wizardStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
              </button>

              <div className="flex items-center gap-1">
                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(step => (
                  <div key={step} className={`w-2 h-2 rounded-full transition-all ${wizardStep === step ? 'bg-red-500 w-4' : wizardStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                ))}
              </div>

              {wizardStep < 9 ? (
                <button onClick={() => setWizardStep(wizardStep + 1)}
                  className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-xl font-bold shadow-lg">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                </button>
              ) : (
                <button onClick={handleSave}
                  disabled={!formData.title || !formData.obligationId || !formData.ownerId}
                  className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                  <CheckCircle2 className="w-4 h-4" />{modalMode === 'create' ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                </button>
              )}
            </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          ACTION MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'action' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-emerald-500 to-teal-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Zap className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡ ØªØµØ­ÙŠØ­ÙŠ</h2>
                    <p className="text-emerald-200">CAPA Action</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                <div className="grid grid-cols-3 gap-3">
                  {Object.entries(ACTION_TYPE_CONFIG).map(([key, cfg]) => {
                    const isSelected = formData.type === key;
                    const TypeIcon = cfg.icon;
                    return (
                      <button key={key} onClick={() => setFormData({ ...formData, type: key })}
                        className={`p-4 rounded-xl border-2 transition-all text-center ${isSelected ? `border-${cfg.color}-500 bg-${cfg.color}-100` : 'border-slate-200 bg-white hover:border-slate-400'
                          }`}>
                        <TypeIcon className={`w-6 h-6 mx-auto mb-2 ${isSelected ? `text-${cfg.color}-600` : 'text-slate-400'}`} />
                        <p className="font-bold text-slate-800 text-sm">{cfg.label}</p>
                      </button>);
                  })}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                <textarea rows={3} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl resize-none" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨..." />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ *</label>
                  <select value={formData.responsibleId || ''} onChange={(e) => setFormData({ ...formData, responsibleId: parseInt(e.target.value) || '' })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</option>
                    {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                  <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-8 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} className="flex items-center gap-2 px-8 py-3 bg-emerald-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EXCEPTION MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'exception' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Shield className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡</h2>
                    <p className="text-purple-200">Regulatory Exception</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <p className="text-amber-800 text-sm">
                  <AlertTriangle className="w-4 h-4 inline ml-1" />
                  Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ ÙŠØ¹Ù†ÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ù…Ø¤Ù‚ØªØ§Ù‹. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡.
                </p> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ *</label>
                <textarea rows={4} value={formData.reason || ''} onChange={(e) => setFormData({ ...formData, reason: e.target.value })}
                  className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl resize-none" placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡..." />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ *</label>
                <input type="date" value={formData.expiryDate || ''} onChange={(e) => setFormData({ ...formData, expiryDate: e.target.value })}
                  className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl" />
              </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-8 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} className="flex items-center gap-2 px-8 py-3 bg-purple-500 text-white rounded-xl font-bold">
                <Shield className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡
              </button> </div> </div> </div>
      )}

      {showDeleteConfirm && deleteTarget && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Trash2 className="w-6 h-6" /></div>
                <h2 className="text-xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
              </div> </div>
            <div className="p-6">
              <p className="text-slate-600">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</p>
              <p className="font-bold text-slate-800 mt-2">{deleteTarget.code} - {deleteTarget.title}</p>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowDeleteConfirm(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDelete} className="flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-bold">
                <Trash2 className="w-5 h-5" />Ø­Ø°Ù
              </button> </div> </div> </div>
      )}

      {showApprovalModal && approvalTarget && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Shield className="w-6 h-6" /></div>
                <div>
                  <h2 className="text-xl font-bold">Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</h2>
                  <p className="text-purple-200 text-sm">DOA - ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙÙˆØ¶Ø©</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-4">
                <div className="flex items-center gap-2 text-amber-700 font-bold mb-2">
                  <AlertTriangle className="w-5 h-5" />
                  <span>ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø³Ø¨Ù‚</span>
                </div>
                <p className="text-sm text-amber-600">
                  Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª {approvalTarget.breach.severity === 'Critical' ? 'Ø§Ù„Ø­Ø±Ø¬Ø©' : 'Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø©'} ÙŠØªØ·Ù„Ø¨
                  {approvalTarget.doaRule?.requiresDualApproval ? ' Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ø§Ù„Ù…Ø®ÙˆÙ„ÙŠÙ†' : ' Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù† Ù…Ø¹ØªÙ…Ø¯ Ù…Ø®ÙˆÙ„'}
                </p> </div>
              <div className="bg-slate-50 rounded-xl p-4 mb-4">
                <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</p>
                <p className="font-bold text-slate-800">{approvalTarget.breach.code}</p>
                <p className="text-slate-600">{approvalTarget.breach.title}</p>
                <div className="flex items-center gap-2 mt-2">
                  <span className={`px-2 py-1 rounded text-xs font-bold ${approvalTarget.breach.severity === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'
                    }`}>
                    {approvalTarget.breach.severity === 'Critical' ? 'Ø­Ø±Ø¬' : 'Ø¹Ø§Ù„ÙŠ'}
                  </span> </div> </div>
              <div className="mb-4">
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</label>
                <textarea
                  value={approvalNotes}
                  onChange={(e) => setApprovalNotes(e.target.value)}
                  placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¨Ø±Ø±Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø©..."
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none resize-none h-24"
                />
              </div>

              <div className="bg-purple-50 rounded-xl p-4">
                <p className="text-sm font-bold text-purple-700 mb-2">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙˆÙ† Ø§Ù„Ù…Ø®ÙˆÙ„ÙˆÙ†:</p>
                <div className="flex flex-wrap gap-2">
                  {approvalTarget.doaRule?.approverRoles?.map(role => (
                    <span key={role} className="px-3 py-1 bg-purple-100 text-purple-700 rounded-lg text-sm font-bold">
                      {role === 'CCO' ? 'Ø±Ø¦ÙŠØ³ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' : role === 'COMPLIANCE_MANAGER' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' : role}
                    </span>
                  ))}
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowApprovalModal(false); setApprovalTarget(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleSubmitApprovalRequest}
                className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold">
                <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          CAPA MODAL - Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ©
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showCAPAModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-blue-600 via-indigo-600 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Target className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">{selectedCAPA ? 'ØªØ¹Ø¯ÙŠÙ„ CAPA' : 'Ø¥Ø¶Ø§ÙØ© CAPA Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="text-blue-200">Corrective and Preventive Action</p>
                  </div> </div>
                <button onClick={() => { setShowCAPAModal(false); setSelectedCAPA(null); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 max-h-[60vh] overflow-y-auto space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                  <div className="flex gap-3">
                    <button onClick={() => setCAPAFormData({ ...capaFormData, type: 'Corrective' })}
                      className={`flex-1 p-4 rounded-xl border-2 font-bold ${capaFormData.type === 'Corrective' ? 'border-red-500 bg-red-50 text-red-700' : 'border-slate-200'}`}>
                      <Wrench className="w-6 h-6 mx-auto mb-2" />ØªØµØ­ÙŠØ­ÙŠ
                    </button>
                    <button onClick={() => setCAPAFormData({ ...capaFormData, type: 'Preventive' })}
                      className={`flex-1 p-4 rounded-xl border-2 font-bold ${capaFormData.type === 'Preventive' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200'}`}>
                      <Shield className="w-6 h-6 mx-auto mb-2" />ÙˆÙ‚Ø§Ø¦ÙŠ
                    </button> </div> </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© *</label>
                  <select value={capaFormData.priority || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</option>
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© *</label>
                <select value={capaFormData.breachId || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, breachId: parseInt(e.target.value) })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</option>
                  {breaches.map(b => <option key={b.id} value={b.id}>{b.code} - {b.title}</option>)}
                </select>
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                <textarea rows={3} value={capaFormData.description || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, description: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                  placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ Ø£Ùˆ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ..." />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ *</label>
                  <textarea rows={2} value={capaFormData.rootCause || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, rootCause: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                    placeholder="Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ù„Ù…Ø´ÙƒÙ„Ø©..." />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ</label>
                  <textarea rows={2} value={capaFormData.preventiveAction || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, preventiveAction: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                    placeholder="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±..." />
                </div> </div>
              <div className="bg-slate-50 rounded-xl p-5">
                <div className="flex items-center justify-between mb-4">
                  <h4 className="font-bold text-slate-800 flex items-center gap-2"><GitBranch className="w-5 h-5 text-indigo-500" />Ø§Ù„Ù…Ø¹Ø§Ù„Ù… ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</h4>
                  <button onClick={() => setCAPAFormData({ ...capaFormData, milestones: [...(capaFormData.milestones || []), { id: Date.now(), title: '', dueDate: '', status: 'Pending' }] })}
                    className="flex items-center gap-1 px-3 py-1.5 bg-indigo-500 text-white rounded-lg text-sm font-bold">
                    <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…
                  </button> </div>
                <div className="space-y-3">
                  {(capaFormData.milestones || []).map((milestone, idx) => (
                    <div key={milestone.id} className="flex items-center gap-3 bg-white p-3 rounded-lg border border-slate-200">
                      <span className="w-8 h-8 bg-indigo-100 text-indigo-700 rounded-full flex items-center justify-center font-bold text-sm">{idx + 1}</span>
                      <input type="text" value={milestone.title} onChange={(e) => {
                        const updated = [...capaFormData.milestones];
                        updated[idx].title = e.target.value;
                        setCAPAFormData({ ...capaFormData, milestones: updated });
                      }} className="flex-1 px-3 py-2 border border-slate-200 rounded-lg" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ù„Ù…" />
                      <input type="date" value={milestone.dueDate} onChange={(e) => {
                        const updated = [...capaFormData.milestones];
                        updated[idx].dueDate = e.target.value;
                        setCAPAFormData({ ...capaFormData, milestones: updated });
                      }} className="px-3 py-2 border border-slate-200 rounded-lg" />
                      <select value={milestone.status} onChange={(e) => {
                        const updated = [...capaFormData.milestones];
                        updated[idx].status = e.target.value;
                        setCAPAFormData({ ...capaFormData, milestones: updated });
                      }} className="px-3 py-2 border border-slate-200 rounded-lg">
                        <option value="Pending">Ù…Ø¹Ù„Ù‚</option>
                        <option value="InProgress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                        <option value="Done">Ù…ÙƒØªÙ…Ù„</option>
                      </select>
                      <button onClick={() => setCAPAFormData({ ...capaFormData, milestones: capaFormData.milestones.filter((_, i) => i !== idx) })}
                        className="p-2 text-red-500 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /></button>
                    </div>
                  ))}
                </div> </div>
              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù *</label>
                  <input type="date" value={capaFormData.targetDate || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, targetDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ *</label>
                  <select value={capaFormData.assignedTo || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, assignedTo: parseInt(e.target.value) })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</option>
                    {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙØ­Ù‚Ù‚</label>
                  <select value={capaFormData.verifier || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, verifier: parseInt(e.target.value) })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙØ­Ù‚Ù‚</option>
                    {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div> </div>
              <div className="bg-purple-50 rounded-xl p-5 border border-purple-200">
                <h4 className="font-bold text-purple-800 mb-4 flex items-center gap-2"><Eye className="w-5 h-5" />Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</h4>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                    <input type="date" value={capaFormData.effectivenessReviewDate || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, effectivenessReviewDate: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                    <input type="text" value={capaFormData.effectivenessCriteria || ''} onChange={(e) => setCAPAFormData({ ...capaFormData, effectivenessCriteria: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø®Ù„Ø§Ù„ 90 ÙŠÙˆÙ…" />
                  </div> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowCAPAModal(false); setSelectedCAPA(null); }} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => {
                const newCapa = {
                  ...capaFormData,
                  id: selectedCAPA?.id || Date.now(),
                  code: selectedCAPA?.code || `CAPA-2025-${String(capaRecords.length + 1).padStart(3, '0')}`,
                  status: capaFormData.status || 'Open',
                  effectivenessStatus: capaFormData.effectivenessStatus || 'NotStarted',
                  createdAt: selectedCAPA?.createdAt || new Date().toISOString().split('T')[0],
                  createdBy: CURRENT_USER.id
                };
                if (selectedCAPA) {
                  setCAPARecords(capaRecords.map(c => c.id === selectedCAPA.id ? newCapa : c));
                } else {
                  setCAPARecords([...capaRecords, newCapa]);
                }
                setNotification({ type: 'success', message: selectedCAPA ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« CAPA Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© CAPA Ø¨Ù†Ø¬Ø§Ø­' });
                setTimeout(() => setNotification(null), 3000);
                setShowCAPAModal(false);
                setSelectedCAPA(null);
              }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />{selectedCAPA ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø¥Ù†Ø´Ø§Ø¡ CAPA'}
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          FINANCIAL IMPACT CALCULATOR MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showFinancialCalculator && selectedBreach && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl overflow-hidden">
            <div className="bg-gradient-to-l from-emerald-500 to-teal-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <DollarSign className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
                    <p className="text-emerald-200">{selectedBreach.code}</p>
                  </div> </div>
                <button onClick={() => setShowFinancialCalculator(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                {FINANCIAL_IMPACT_CATEGORIES.map(cat => (
                  <div key={cat.id} className={`bg-${cat.color}-50 rounded-xl p-4 border border-${cat.color}-200`}>
                    <label className={`block text-sm font-bold text-${cat.color}-700 mb-2 flex items-center gap-2`}>
                      <cat.icon className="w-4 h-4" />{cat.label}
                    </label>
                    <input type="number" value={financialImpactData[cat.id] || 0}
                      onChange={(e) => setFinancialImpactData({ ...financialImpactData, [cat.id]: parseInt(e.target.value) || 0 })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-lg font-bold" placeholder="0" />
                    <p className="text-xs text-slate-500 mt-1">{cat.description}</p>
                  </div>
                ))}
              </div>
              <div className="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl p-6 text-white text-center">
                <p className="text-emerald-100 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙÙ‚Ø¯Ù‘Ø±</p>
                <p className="text-4xl font-black">
                  {Object.values(financialImpactData).reduce((sum, val) => sum + (val || 0), 0).toLocaleString()} Ø±ÙŠØ§Ù„
                </p> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowFinancialCalculator(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => {
                const total = Object.values(financialImpactData).reduce((sum, val) => sum + (val || 0), 0);
                setBreaches(breaches.map(b => b.id === selectedBreach.id ? {
                  ...b,
                  financialImpact: { ...financialImpactData, totalEstimate: total, calculatedAt: new Date().toISOString().split('T')[0] }
                } : b));
                setNotification({ type: 'success', message: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ' });
                setTimeout(() => setNotification(null), 3000);
                setShowFinancialCalculator(false);
              }} className="flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          PENALTY ESTIMATOR MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showPenaltyEstimator && selectedBreach && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl overflow-hidden">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Scale className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ù…ÙÙ‚Ø¯Ù‘Ø± Ø§Ù„ØºØ±Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h2>
                    <p className="text-purple-200">{selectedBreach.code}</p>
                  </div> </div>
                <button onClick={() => setShowPenaltyEstimator(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                  <select value={penaltyEstimate.authority || 'SAMA'} onChange={(e) => setPenaltyEstimate({ ...penaltyEstimate, authority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="SAMA">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</option>
                    <option value="NCA">NCA - Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                    <option value="NDMO">NDMO - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</label>
                  <div className="px-4 py-3 bg-slate-100 rounded-xl font-bold">
                    {SEVERITY_CONFIG[selectedBreach.severity]?.label} ({selectedBreach.severity})
                  </div> </div> </div>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <h4 className="font-bold text-red-800 mb-3">Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø´Ø¯Ø¯Ø©</h4>
                <div className="space-y-2">
                  {PENALTY_CONFIG[penaltyEstimate.authority || 'SAMA']?.aggravatingFactors?.map(factor => (
                    <label key={factor.id} className="flex items-center gap-3 p-2 bg-white rounded-lg cursor-pointer">
                      <input type="checkbox" checked={(penaltyEstimate.aggravatingFactors || []).includes(factor.id)}
                        onChange={(e) => {
                          const current = penaltyEstimate.aggravatingFactors || [];
                          setPenaltyEstimate({
                            ...penaltyEstimate,
                            aggravatingFactors: e.target.checked ? [...current, factor.id] : current.filter(f => f !== factor.id)
                          });
                        }}
                        className="w-5 h-5 text-red-500" />
                      <span className="font-bold text-slate-700">{factor.label}</span>
                      <span className="text-red-600 font-bold mr-auto">Ã—{factor.multiplier}</span>
                    </label>
                  ))}
                </div> </div>
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <h4 className="font-bold text-emerald-800 mb-3">Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø®ÙÙØ©</h4>
                <div className="space-y-2">
                  {PENALTY_CONFIG[penaltyEstimate.authority || 'SAMA']?.mitigatingFactors?.map(factor => (
                    <label key={factor.id} className="flex items-center gap-3 p-2 bg-white rounded-lg cursor-pointer">
                      <input type="checkbox" checked={(penaltyEstimate.mitigatingFactors || []).includes(factor.id)}
                        onChange={(e) => {
                          const current = penaltyEstimate.mitigatingFactors || [];
                          setPenaltyEstimate({
                            ...penaltyEstimate,
                            mitigatingFactors: e.target.checked ? [...current, factor.id] : current.filter(f => f !== factor.id)
                          });
                        }}
                        className="w-5 h-5 text-emerald-500" />
                      <span className="font-bold text-slate-700">{factor.label}</span>
                      <span className="text-emerald-600 font-bold mr-auto">-{(factor.discount * 100).toFixed(0)}%</span>
                    </label>
                  ))}
                </div> </div>
              {(() => {
                const config = PENALTY_CONFIG[penaltyEstimate.authority || 'SAMA'];
                const basePenalty = config?.basePenalties?.[selectedBreach.severity] || { min: 0, max: 0 };
                let multiplier = 1;
                (penaltyEstimate.aggravatingFactors || []).forEach(fid => {
                  const factor = config?.aggravatingFactors?.find(f => f.id === fid);
                  if (factor) multiplier *= factor.multiplier;
                });
                let discount = 0;
                (penaltyEstimate.mitigatingFactors || []).forEach(fid => {
                  const factor = config?.mitigatingFactors?.find(f => f.id === fid);
                  if (factor) discount += factor.discount;
                });
                const minPenalty = Math.round(basePenalty.min * multiplier * (1 - discount));
                const maxPenalty = Math.round(basePenalty.max * multiplier * (1 - discount));
                const likelyPenalty = Math.round((minPenalty + maxPenalty) / 2);

                return (
                  <div className="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-2xl p-6 text-white">
                    <div className="grid grid-cols-3 gap-4 text-center">
                      <div>
                        <p className="text-purple-200 text-sm">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</p>
                        <p className="text-2xl font-black">{minPenalty.toLocaleString()}</p>
                      </div>
                      <div className="border-r border-l border-white/30">
                        <p className="text-purple-200 text-sm">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                        <p className="text-3xl font-black">{likelyPenalty.toLocaleString()}</p>
                      </div>
                      <div>
                        <p className="text-purple-200 text-sm">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</p>
                        <p className="text-2xl font-black">{maxPenalty.toLocaleString()}</p>
                      </div> </div>
                    <p className="text-center text-purple-200 text-sm mt-3">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                  </div>);
              })()}
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowPenaltyEstimator(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => {
                const config = PENALTY_CONFIG[penaltyEstimate.authority || 'SAMA'];
                const basePenalty = config?.basePenalties?.[selectedBreach.severity] || { min: 0, max: 0 };
                let multiplier = 1;
                (penaltyEstimate.aggravatingFactors || []).forEach(fid => {
                  const factor = config?.aggravatingFactors?.find(f => f.id === fid);
                  if (factor) multiplier *= factor.multiplier;
                });
                let discount = 0;
                (penaltyEstimate.mitigatingFactors || []).forEach(fid => {
                  const factor = config?.mitigatingFactors?.find(f => f.id === fid);
                  if (factor) discount += factor.discount;
                });
                const minPenalty = Math.round(basePenalty.min * multiplier * (1 - discount));
                const maxPenalty = Math.round(basePenalty.max * multiplier * (1 - discount));
                const likelyPenalty = Math.round((minPenalty + maxPenalty) / 2);

                setBreaches(breaches.map(b => b.id === selectedBreach.id ? {
                  ...b,
                  penaltyEstimate: { min: minPenalty, max: maxPenalty, likely: likelyPenalty, authority: penaltyEstimate.authority || 'SAMA' }
                } : b));
                setNotification({ type: 'success', message: 'ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØºØ±Ø§Ù…Ø©' });
                setTimeout(() => setNotification(null), 3000);
                setShowPenaltyEstimator(false);
              }} className="flex items-center gap-2 px-6 py-3 bg-purple-500 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 4.8: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
// Regulatory Change Management (RCM) - World-Class Edition
// Features: Auto Impact Engine, Change Items, Action Plans, Evidence Closure

const RegulatoryChanges = () => {
  // STATE MANAGEMENT
  const [activeTab, setActiveTab] = useState('command');
  const [selectedChange, setSelectedChange] = useState(null);
  const [changeTab, setChangeTab] = useState('summary');
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('create');
  const [modalType, setModalType] = useState('change'); // change | action | item
  const [formData, setFormData] = useState(null);
  const [wizardStep, setWizardStep] = useState(0);
  const [notification, setNotification] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterType, setFilterType] = useState('');
  const [filterAuthority, setFilterAuthority] = useState('');
  const [viewMode, setViewMode] = useState('table');
  const [showImpactModal, setShowImpactModal] = useState(false);

  const CURRENT_USER = { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' };

  // REGULATORY CHANGES DATA
  const [changes, setChanges] = useState([
    {
      id: 1, code: 'CHG-REG-2025-001', authorityId: 1, frameworkId: 1,
      changeType: 'Update', title: 'ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      description: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø© 15 Ù…Ù† Ù„Ø§Ø¦Ø­Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 48 Ø³Ø§Ø¹Ø©',
      issueDate: '2025-01-10', effectiveDate: '2025-03-01',
      sourceLink: 'https://sama.gov.sa/ar-sa/Laws/Documents/AML-Update-2025.pdf',
      severity: 'High', status: 'Implementing', createdBy: 1, createdAt: '2025-01-12',
      items: [
        { id: 1, requirementId: 'REQ-AML-15', impactType: 'Modified', oldText: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©', newText: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©' },
        { id: 2, requirementId: 'REQ-AML-15.1', impactType: 'Added', oldText: null, newText: 'ÙŠØ´Ù…Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©' },
      ],
      impact: {
        obligationsCount: 3, controlsCount: 2, risksCount: 1, policiesCount: 1, tasksCount: 5,
        retestingRequired: true, evidenceRefreshRequired: true, overallLevel: 'High',
        assessorId: 1, assessedAt: '2025-01-15',
        affectedObligations: [1, 2, 3], affectedControls: [1, 2], affectedPolicies: [1]
      },
      actions: [
        { id: 1, type: 'UpdatePolicy', description: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', ownerId: 2, dueDate: '2025-02-01', status: 'Done' },
        { id: 2, type: 'UpdateControl', description: 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', ownerId: 3, dueDate: '2025-02-10', status: 'Done' },
        { id: 3, type: 'Training', description: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', ownerId: 4, dueDate: '2025-02-20', status: 'InProgress' },
        { id: 4, type: 'Retest', description: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', ownerId: 1, dueDate: '2025-02-28', status: 'Open' },
      ],
      closureEvidence: [],
    },
    {
      id: 2, code: 'CHG-REG-2025-002', authorityId: 3, frameworkId: 5,
      changeType: 'New', title: 'Ø¥Ø·Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«',
      description: 'Ø¥ØµØ¯Ø§Ø± Ø¥Ø·Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙŠØªØ¶Ù…Ù† Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©',
      issueDate: '2025-01-20', effectiveDate: '2025-06-01',
      sourceLink: 'https://nca.gov.sa/frameworks/third-party-risk-2025.pdf',
      severity: 'Critical', status: 'Assessed', createdBy: 1, createdAt: '2025-01-22',
      items: [
        { id: 1, requirementId: 'REQ-TPR-01', impactType: 'Added', oldText: null, newText: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø³Ù†ÙˆÙŠØ§Ù‹' },
        { id: 2, requirementId: 'REQ-TPR-02', impactType: 'Added', oldText: null, newText: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©' },
        { id: 3, requirementId: 'REQ-TPR-03', impactType: 'Added', oldText: null, newText: 'Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø§Ù„Ø­Ø±Ø¬ÙŠÙ†' },
      ],
      impact: {
        obligationsCount: 8, controlsCount: 5, risksCount: 3, policiesCount: 2, tasksCount: 12,
        retestingRequired: true, evidenceRefreshRequired: true, overallLevel: 'Critical',
        assessorId: 1, assessedAt: '2025-01-25',
        affectedObligations: [4, 5, 6, 7, 8], affectedControls: [3, 4, 5, 6, 7], affectedPolicies: [2, 3]
      },
      actions: [], closureEvidence: [],
    },
    {
      id: 3, code: 'CHG-REG-2025-003', authorityId: 4, frameworkId: 7,
      changeType: 'Update', title: 'ØªØ¹Ø¯ÙŠÙ„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø®Ø·Ø§Ø± Ø¨Ø®Ø±Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      description: 'ØªÙ… ØªÙ‚Ù„ÙŠØµ Ù…Ù‡Ù„Ø© Ø§Ù„Ø¥Ø®Ø·Ø§Ø± Ø¨Ø­ÙˆØ§Ø¯Ø« Ø®Ø±Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† 72 Ø³Ø§Ø¹Ø© Ø¥Ù„Ù‰ 48 Ø³Ø§Ø¹Ø©',
      issueDate: '2025-02-01', effectiveDate: '2025-04-01', sourceLink: 'https://sdaia.gov.sa/pdpl-update-2025.pdf',
      severity: 'Medium', status: 'UnderReview', createdBy: 1, createdAt: '2025-02-03',
      items: [
        { id: 1, requirementId: 'REQ-PDPL-28', impactType: 'Modified', oldText: 'Ø§Ù„Ø¥Ø®Ø·Ø§Ø± Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', newText: 'Ø§Ù„Ø¥Ø®Ø·Ø§Ø± Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©' },
      ],
      impact: null, actions: [], closureEvidence: [],
    },
    {
      id: 4, code: 'CHG-REG-2025-004', authorityId: 1, frameworkId: 2,
      changeType: 'Guidance', title: 'ØªÙˆØ¬ÙŠÙ‡Ø§Øª ØªÙØ³ÙŠØ±ÙŠØ© Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª KYC',
      description: 'Ø¥ØµØ¯Ø§Ø± ØªÙˆØ¬ÙŠÙ‡Ø§Øª ØªÙØ³ÙŠØ±ÙŠØ© Ù„ØªÙˆØ¶ÙŠØ­ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©',
      issueDate: '2025-01-28', effectiveDate: '2025-02-28',
      sourceLink: 'https://sama.gov.sa/guidance/kyc-digital-2025.pdf',
      severity: 'Low', status: 'Closed', createdBy: 1, createdAt: '2025-01-30',
      items: [
        { id: 1, requirementId: 'REQ-KYC-05', impactType: 'Modified', oldText: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©', newText: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ù…Ø§ ÙŠØ´Ù…Ù„ eKYC' },
      ],
      impact: {
        obligationsCount: 2, controlsCount: 1, risksCount: 0, policiesCount: 1, tasksCount: 3,
        retestingRequired: false, evidenceRefreshRequired: true, overallLevel: 'Low',
        assessorId: 1, assessedAt: '2025-02-01',
        affectedObligations: [2, 3], affectedControls: [2], affectedPolicies: [1]
      },
      actions: [
        { id: 1, type: 'UpdatePolicy', description: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª eKYC', ownerId: 2, dueDate: '2025-02-15', status: 'Done' },
      ],
      closureEvidence: [{ id: 1, evidenceId: 15, acceptedBy: 3, acceptedAt: '2025-02-20' }],
      closedAt: '2025-02-22', closedBy: 3,
    },
    {
      id: 5, code: 'CHG-REG-2025-005', authorityId: 2, frameworkId: 4,
      changeType: 'Repeal', title: 'Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø±Ø¨Ø¹ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØµØºÙŠØ±Ø©',
      description: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø±Ø¨Ø¹ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø¬Ø© Ø°Ø§Øª Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø£Ù‚Ù„ Ù…Ù† 50 Ù…Ù„ÙŠÙˆÙ†',
      issueDate: '2025-02-05', effectiveDate: '2025-03-01', sourceLink: 'https://cma.org.sa/circular/2025-001.pdf',
      severity: 'Low', status: 'Draft', createdBy: 1, createdAt: '2025-02-07',
      items: [
        { id: 1, requirementId: 'REQ-CMA-12', impactType: 'Removed', oldText: 'Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø±Ø¨Ø¹ÙŠ Ø¥Ù„Ø²Ø§Ù…ÙŠ', newText: null },
      ],
      impact: null, actions: [], closureEvidence: [],
    },]);
  // CONFIGURATIONS
  const CHANGE_TYPE_CONFIG = {
    New: { label: 'Ø¬Ø¯ÙŠØ¯', icon: Plus, bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700' },
    Update: { label: 'ØªØ­Ø¯ÙŠØ«', icon: RefreshCw, bg: 'bg-blue-500', light: 'bg-blue-100', text: 'text-blue-700' },
    Repeal: { label: 'Ø¥Ù„ØºØ§Ø¡', icon: XCircle, bg: 'bg-red-500', light: 'bg-red-100', text: 'text-red-700' },
    Guidance: { label: 'ØªÙˆØ¬ÙŠÙ‡', icon: BookOpen, bg: 'bg-purple-500', light: 'bg-purple-100', text: 'text-purple-700' },
  };

  const STATUS_CONFIG = {
    Draft: { label: 'Ù…Ø³ÙˆØ¯Ø©', icon: FileText, bg: 'bg-slate-100', text: 'text-slate-700' },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye, bg: 'bg-blue-100', text: 'text-blue-700' },
    Assessed: { label: 'ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', icon: CheckSquare, bg: 'bg-purple-100', text: 'text-purple-700' },
    Implementing: { label: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Zap, bg: 'bg-amber-100', text: 'text-amber-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
  };

  const SEVERITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', bg: 'bg-red-600', light: 'bg-red-100', text: 'text-red-700', border: 'border-red-500' },
    High: { label: 'Ø¹Ø§Ù„ÙŠ', bg: 'bg-orange-500', light: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-500' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-500' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-500' },
  };

  const IMPACT_TYPE_CONFIG = {
    Added: { label: 'Ù…Ø¶Ø§Ù', icon: Plus, color: 'emerald' }, Modified: { label: 'Ù…Ø¹Ø¯Ù‘Ù„', icon: Edit, color: 'blue' },
    Removed: { label: 'Ù…Ø­Ø°ÙˆÙ', icon: Trash2, color: 'red' },
  };

  const ACTION_TYPE_CONFIG = {
    UpdatePolicy: { label: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø©', icon: FileText, color: 'purple' },
    UpdateControl: { label: 'ØªØ­Ø¯ÙŠØ« Ø¶Ø§Ø¨Ø·', icon: Shield, color: 'blue' },
    NewObligation: { label: 'Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯', icon: Plus, color: 'emerald' },
    Training: { label: 'ØªØ¯Ø±ÙŠØ¨', icon: Users, color: 'amber' },
    Retest: { label: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø±', icon: RefreshCw, color: 'indigo' },
    RescheduleTask: { label: 'Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø©', icon: Calendar, color: 'cyan' },
  };

  const USERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' },
    { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Policy Manager' },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'Compliance Approver' },
    { id: 4, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Training Coordinator' },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Control Owner' },
  ];

  // COMPUTED STATISTICS
  const stats = useMemo(() => {
    const draft = changes.filter(c => c.status === 'Draft').length;
    const underReview = changes.filter(c => c.status === 'UnderReview').length;
    const assessed = changes.filter(c => c.status === 'Assessed').length;
    const implementing = changes.filter(c => c.status === 'Implementing').length;
    const closed = changes.filter(c => c.status === 'Closed').length;

    const critical = changes.filter(c => c.severity === 'Critical' && c.status !== 'Closed').length;
    const high = changes.filter(c => c.severity === 'High' && c.status !== 'Closed').length;

    const pendingAssessment = changes.filter(c => !c.impact && c.status !== 'Draft').length;
    const overdueActions = changes.reduce((sum, c) => {
      return sum + (c.actions?.filter(a => a.status !== 'Done' && new Date(a.dueDate) < new Date()).length || 0);
    }, 0);

    const totalActions = changes.reduce((sum, c) => sum + (c.actions?.length || 0), 0);
    const doneActions = changes.reduce((sum, c) => sum + (c.actions?.filter(a => a.status === 'Done').length || 0), 0);

    const newChanges = changes.filter(c => c.changeType === 'New').length;
    const updates = changes.filter(c => c.changeType === 'Update').length;
    const repeals = changes.filter(c => c.changeType === 'Repeal').length;

    const effectiveSoon = changes.filter(c => {
      if (c.status === 'Closed') return false;
      const days = Math.ceil((new Date(c.effectiveDate) - new Date()) / (1000 * 60 * 60 * 24));
      return days >= 0 && days <= 30;
    }).length;

    return {
      total: changes.length, draft, underReview, assessed, implementing, closed,
      critical, high, pendingAssessment, overdueActions, totalActions, doneActions,
      newChanges, updates, repeals, effectiveSoon,
      activeChanges: draft + underReview + assessed + implementing,
    };
  }, [changes]);

  // HELPER FUNCTIONS
  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const getUser = (id) => USERS.find(u => u.id === id);
  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);

  const getDaysUntilEffective = (date) => {
    if (!date) return null;
    return Math.ceil((new Date(date) - new Date()) / (1000 * 60 * 60 * 24));
  };

  const filteredChanges = useMemo(() => {
    return changes.filter(c => {
      if (searchQuery && !c.code.toLowerCase().includes(searchQuery.toLowerCase()) && !c.title.toLowerCase().includes(searchQuery.toLowerCase())) return false;
      if (filterStatus && c.status !== filterStatus) return false;
      if (filterType && c.changeType !== filterType) return false;
      if (filterAuthority && c.authorityId !== parseInt(filterAuthority)) return false;
      return true;
    });
  }, [changes, searchQuery, filterStatus, filterType, filterAuthority]);

  const handleCreateChange = () => {
    setFormData({
      id: null, code: `CHG-REG-2025-${String(changes.length + 1).padStart(3, '0')}`,
      authorityId: '', frameworkId: '', changeType: 'Update', title: '', description: '',
      issueDate: new Date().toISOString().split('T')[0], effectiveDate: '',
      sourceLink: '', severity: 'Medium', status: 'Draft',
      createdBy: CURRENT_USER.id, createdAt: new Date().toISOString().split('T')[0],
      items: [], impact: null, actions: [], closureEvidence: [],
    });
    setWizardStep(0);
    setModalType('change');
    setModalMode('create');
    setShowModal(true);
  };

  const handleEditChange = (change) => {
    setFormData({ ...change });
    setWizardStep(0);
    setModalType('change');
    setModalMode('edit');
    setShowModal(true);
  };

  const handleViewChange = (change) => {
    setSelectedChange(change);
    setChangeTab('summary');
    setActiveTab('workspace');
  };

  const handleAddItem = () => {
    if (!selectedChange) return;
    setFormData({ id: null, requirementId: '', impactType: 'Modified', oldText: '', newText: '' });
    setModalType('item');
    setModalMode('create');
    setShowModal(true);
  };

  const handleAddAction = () => {
    if (!selectedChange) return;
    setFormData({ id: null, type: 'UpdatePolicy', description: '', ownerId: '', dueDate: '', status: 'Open' });
    setModalType('action');
    setModalMode('create');
    setShowModal(true);
  };

  const handleSave = () => {
    if (modalType === 'change') {
      if (!formData.title || !formData.authorityId || !formData.effectiveDate) {
        showNotification('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø¬Ù‡Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ù†ÙØ§Ø° Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      if (modalMode === 'create') {
        setChanges([...changes, { ...formData, id: changes.length + 1 }]);
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        setChanges(changes.map(c => c.id === formData.id ? formData : c));
        if (selectedChange?.id === formData.id) setSelectedChange(formData);
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØºÙŠÙŠØ±');
      }
    } else if (modalType === 'item') {
      if (!formData.requirementId) {
        showNotification('Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ù…Ø·Ù„ÙˆØ¨', 'error');
        return;
      }
      const newItem = { ...formData, id: (selectedChange.items?.length || 0) + 1 };
      const updatedChange = { ...selectedChange, items: [...(selectedChange.items || []), newItem] };
      setChanges(changes.map(c => c.id === selectedChange.id ? updatedChange : c));
      setSelectedChange(updatedChange);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©');
    } else if (modalType === 'action') {
      if (!formData.description || !formData.ownerId) {
        showNotification('Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      const newAction = { ...formData, id: (selectedChange.actions?.length || 0) + 1 };
      const updatedChange = { ...selectedChange, actions: [...(selectedChange.actions || []), newAction] };
      setChanges(changes.map(c => c.id === selectedChange.id ? updatedChange : c));
      setSelectedChange(updatedChange);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡');
    }
    setShowModal(false);
    setFormData(null);
    setWizardStep(0);
  };

  const handleUpdateStatus = (change, newStatus) => {
    const updatedChange = { ...change, status: newStatus };
    if (newStatus === 'Closed') {
      updatedChange.closedAt = new Date().toISOString().split('T')[0];
      updatedChange.closedBy = CURRENT_USER.id;
    }
    setChanges(changes.map(c => c.id === change.id ? updatedChange : c));
    if (selectedChange?.id === change.id) setSelectedChange(updatedChange);
    showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${STATUS_CONFIG[newStatus]?.label}`);
  };

  const handleRunImpactAssessment = (change) => {
    // Simulated Auto Impact Engine
    const impact = {
      obligationsCount: Math.floor(Math.random() * 5) + 1, controlsCount: Math.floor(Math.random() * 4) + 1,
      risksCount: Math.floor(Math.random() * 3), policiesCount: Math.floor(Math.random() * 2) + 1,
      tasksCount: Math.floor(Math.random() * 8) + 2,
      retestingRequired: change.severity === 'Critical' || change.severity === 'High',
      evidenceRefreshRequired: true, overallLevel: change.severity, assessorId: CURRENT_USER.id,
      assessedAt: new Date().toISOString().split('T')[0],
      affectedObligations: [1, 2, 3].slice(0, Math.floor(Math.random() * 3) + 1),
      affectedControls: [1, 2, 3, 4].slice(0, Math.floor(Math.random() * 4) + 1),
      affectedPolicies: [1, 2].slice(0, Math.floor(Math.random() * 2) + 1),
    };
    const updatedChange = { ...change, impact, status: 'Assessed' };
    setChanges(changes.map(c => c.id === change.id ? updatedChange : c));
    if (selectedChange?.id === change.id) setSelectedChange(updatedChange);
    showNotification('ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± Ø¨Ù†Ø¬Ø§Ø­');
    setShowImpactModal(true);
  };

  const handleApplyToCalendar = (change) => {
    showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„');
  };

  const handleUpdateActionStatus = (actionId, newStatus) => {
    const updatedActions = selectedChange.actions.map(a => a.id === actionId ? { ...a, status: newStatus } : a);
    const updatedChange = { ...selectedChange, actions: updatedActions };
    setChanges(changes.map(c => c.id === selectedChange.id ? updatedChange : c));
    setSelectedChange(updatedChange);
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡');
  };

  // TABS CONFIGURATION
  const mainTabs = [
    { id: 'command', label: 'Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard },
    { id: 'register', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', icon: ClipboardList, count: stats.activeChanges },
    { id: 'workspace', label: 'Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„', icon: Briefcase, disabled: !selectedChange },
    { id: 'timeline', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ', icon: Calendar },
  ];

  const changeTabs = [
    { id: 'summary', label: 'Ø§Ù„Ù…Ù„Ø®Øµ', icon: FileText },
    { id: 'items', label: 'Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', icon: List },
    { id: 'impact', label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±', icon: Activity },
    { id: 'actions', label: 'Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Zap },
    { id: 'evidence', label: 'Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚', icon: FileCheck },
    { id: 'audit', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', icon: History },
  ];

  // RENDER
  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
            <RefreshCw className="w-7 h-7 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-slate-900">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h1>
            <p className="text-slate-500">Regulatory Change Management - Module 4.8</p>
          </div> </div>
        <div className="flex items-center gap-3">
          <button className="flex items-center gap-2 px-4 py-2.5 border-2 border-slate-200 rounded-xl text-slate-700 hover:bg-slate-50">
            <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ±
          </button>
          <button onClick={handleCreateChange}
            className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg">
            <Plus className="w-5 h-5" />ØªØ³Ø¬ÙŠÙ„ ØªØºÙŠÙŠØ±
          </button> </div> </div>
      <div className="grid grid-cols-8 gap-3">
        <div className={`rounded-2xl p-4 ${stats.critical > 0 ? 'bg-red-500 animate-pulse' : 'bg-red-400'} text-white`}>
          <div className="flex items-center justify-between mb-1">
            <AlertTriangle className="w-5 h-5" />
            <span className="text-3xl font-bold">{stats.critical}</span>
          </div>
          <p className="text-red-100 text-sm">Ø­Ø±Ø¬</p>
        </div>

        <div className={`rounded-2xl p-4 ${stats.effectiveSoon > 0 ? 'bg-amber-500' : 'bg-amber-400'} text-white`}>
          <div className="flex items-center justify-between mb-1">
            <Clock className="w-5 h-5" />
            <span className="text-3xl font-bold">{stats.effectiveSoon}</span>
          </div>
          <p className="text-amber-100 text-sm">Ù‚Ø±ÙŠØ¨ Ø§Ù„Ù†ÙØ§Ø°</p>
        </div>

        <div className="bg-slate-100 rounded-2xl p-4 border-2 border-slate-200">
          <div className="flex items-center justify-between mb-1">
            <FileText className="w-5 h-5 text-slate-500" />
            <span className="text-2xl font-bold text-slate-700">{stats.draft}</span>
          </div>
          <p className="text-slate-500 text-sm">Ù…Ø³ÙˆØ¯Ø©</p>
        </div>

        <div className="bg-blue-100 rounded-2xl p-4 border-2 border-blue-200">
          <div className="flex items-center justify-between mb-1">
            <Eye className="w-5 h-5 text-blue-600" />
            <span className="text-2xl font-bold text-blue-700">{stats.underReview}</span>
          </div>
          <p className="text-blue-600 text-sm">Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
        </div>

        <div className="bg-purple-100 rounded-2xl p-4 border-2 border-purple-200">
          <div className="flex items-center justify-between mb-1">
            <CheckSquare className="w-5 h-5 text-purple-600" />
            <span className="text-2xl font-bold text-purple-700">{stats.assessed}</span>
          </div>
          <p className="text-purple-600 text-sm">Ù…ÙÙ‚ÙŠÙ‘Ù…</p>
        </div>

        <div className="bg-amber-100 rounded-2xl p-4 border-2 border-amber-200">
          <div className="flex items-center justify-between mb-1">
            <Zap className="w-5 h-5 text-amber-600" />
            <span className="text-2xl font-bold text-amber-700">{stats.implementing}</span>
          </div>
          <p className="text-amber-600 text-sm">ØªÙ†ÙÙŠØ°</p>
        </div>

        <div className="bg-emerald-100 rounded-2xl p-4 border-2 border-emerald-200">
          <div className="flex items-center justify-between mb-1">
            <CheckCircle2 className="w-5 h-5 text-emerald-600" />
            <span className="text-2xl font-bold text-emerald-700">{stats.closed}</span>
          </div>
          <p className="text-emerald-600 text-sm">Ù…ØºÙ„Ù‚</p>
        </div>

        <div className="bg-indigo-100 rounded-2xl p-4 border-2 border-indigo-200">
          <div className="flex items-center justify-between mb-1">
            <ClipboardList className="w-5 h-5 text-indigo-600" />
            <span className="text-2xl font-bold text-indigo-700">{stats.total}</span>
          </div>
          <p className="text-indigo-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200">
          {mainTabs.map(tab => (
            <button key={tab.id} onClick={() => !tab.disabled && setActiveTab(tab.id)}
              disabled={tab.disabled}
              className={`flex items-center gap-2 px-5 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-indigo-600 border-indigo-500 bg-indigo-50' :
                tab.disabled ? 'text-slate-300 border-transparent cursor-not-allowed' :
                  'text-slate-500 border-transparent hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-indigo-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: COMMAND CENTER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'command' && (
          <div className="p-6">
            <div className="grid grid-cols-3 gap-6">
              <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-5 border border-indigo-200">
                <h3 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                  <PieChart className="w-5 h-5" />Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </h3>
                <div className="grid grid-cols-2 gap-3">
                  {Object.entries(CHANGE_TYPE_CONFIG).map(([key, cfg]) => {
                    const count = changes.filter(c => c.changeType === key).length;
                    const TypeIcon = cfg.icon;
                    return (
                      <div key={key} className="bg-white rounded-xl p-3 border border-slate-200">
                        <div className="flex items-center gap-2 mb-2">
                          <div className={`w-8 h-8 rounded-lg ${cfg.bg} flex items-center justify-center text-white`}>
                            <TypeIcon className="w-4 h-4" />
                          </div>
                          <span className="text-2xl font-bold text-slate-800">{count}</span>
                        </div>
                        <p className="text-sm text-slate-600">{cfg.label}</p>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-5 border border-amber-200">
                <h3 className="font-bold text-amber-800 mb-4 flex items-center gap-2">
                  <Activity className="w-5 h-5" />Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø«Ø±
                </h3>
                <div className="space-y-3">
                  {[
                    { label: 'Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…ØªØ£Ø«Ø±Ø©', value: changes.reduce((sum, c) => sum + (c.impact?.obligationsCount || 0), 0), icon: ClipboardCheck, color: 'emerald' },
                    { label: 'Ø¶ÙˆØ§Ø¨Ø· Ù…ØªØ£Ø«Ø±Ø©', value: changes.reduce((sum, c) => sum + (c.impact?.controlsCount || 0), 0), icon: Shield, color: 'blue' },
                    { label: 'Ø³ÙŠØ§Ø³Ø§Øª Ù…ØªØ£Ø«Ø±Ø©', value: changes.reduce((sum, c) => sum + (c.impact?.policiesCount || 0), 0), icon: FileText, color: 'purple' },
                    { label: 'Ù…Ù‡Ø§Ù… ØªØ­ØªØ§Ø¬ Ø¬Ø¯ÙˆÙ„Ø©', value: changes.reduce((sum, c) => sum + (c.impact?.tasksCount || 0), 0), icon: Calendar, color: 'amber' },
                  ].map((item, idx) => {
                    const Icon = item.icon;
                    return (
                      <div key={idx} className="flex items-center justify-between bg-white rounded-xl p-3 border border-slate-200">
                        <div className="flex items-center gap-2">
                          <Icon className={`w-5 h-5 text-${item.color}-500`} />
                          <span className="text-sm text-slate-600">{item.label}</span>
                        </div>
                        <span className={`text-xl font-bold text-${item.color}-600`}>{item.value}</span>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                <h3 className="font-bold mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                <div className="space-y-2">
                  <button onClick={handleCreateChange} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <Plus className="w-5 h-5" /><span>ØªØ³Ø¬ÙŠÙ„ ØªØºÙŠÙŠØ± Ø¬Ø¯ÙŠØ¯</span>
                  </button>
                  <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <Activity className="w-5 h-5" /><span>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø´Ø§Ù…Ù„</span>
                  </button>
                  <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <Calendar className="w-5 h-5" /><span>ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span>
                  </button>
                  <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                    <FileText className="w-5 h-5" /><span>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span>
                  </button> </div> </div>
              <div className="col-span-2 bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-indigo-500" />ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù†ÙØ§Ø° Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                </h3>
                <div className="space-y-3">
                  {changes.filter(c => c.status !== 'Closed').sort((a, b) => new Date(a.effectiveDate) - new Date(b.effectiveDate)).slice(0, 4).map(change => {
                    const days = getDaysUntilEffective(change.effectiveDate);
                    const sevCfg = SEVERITY_CONFIG[change.severity];
                    const typeCfg = CHANGE_TYPE_CONFIG[change.changeType];
                    return (
                      <div key={change.id} onClick={() => handleViewChange(change)}
                        className="flex items-center gap-4 p-4 rounded-xl bg-slate-50 hover:bg-slate-100 cursor-pointer">
                        <div className={`w-12 h-12 rounded-xl ${sevCfg?.bg} flex items-center justify-center text-white font-bold`}>
                          {days !== null && days >= 0 ? days : '!'}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-xs font-bold text-indigo-600">{change.code}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>{typeCfg?.label}</span>
                          </div>
                          <p className="font-bold text-slate-800">{change.title}</p>
                        </div>
                        <div className="text-left">
                          <p className="text-sm font-bold text-slate-700">{change.effectiveDate}</p>
                          <p className={`text-xs font-bold ${days !== null && days <= 30 ? 'text-amber-600' : 'text-slate-500'}`}>
                            {days !== null && days >= 0 ? `${days} ÙŠÙˆÙ…` : 'Ù†Ø§ÙØ°'}
                          </p> </div> </div>);
                  })}
                </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <AlertCircle className="w-5 h-5 text-amber-500" />Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </h3>
                {changes.filter(c => !c.impact && c.status !== 'Draft' && c.status !== 'Closed').length > 0 ? (
                  <div className="space-y-2">
                    {changes.filter(c => !c.impact && c.status !== 'Draft' && c.status !== 'Closed').map(change => (
                      <div key={change.id} className="flex items-center justify-between p-3 bg-amber-50 rounded-xl border border-amber-200">
                        <div>
                          <span className="font-mono text-xs font-bold text-indigo-600">{change.code}</span>
                          <p className="text-sm text-slate-700 line-clamp-1">{change.title}</p>
                        </div>
                        <button onClick={() => handleRunImpactAssessment(change)}
                          className="px-3 py-1.5 bg-amber-500 text-white rounded-lg text-xs font-bold">
                          ØªÙ‚ÙŠÙŠÙ…
                        </button> </div>
                    ))}
                  </div>
                ) : (
                  <p className="text-center text-slate-400 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                )}
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: CHANGE REGISTER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'register' && (
          <div className="p-6">
            <div className="flex items-center gap-3 mb-6">
              <div className="relative flex-1 max-w-lg">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl" />
              </div>
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                {Object.entries(STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
              </select>
              <select value={filterType} onChange={(e) => setFilterType(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                {Object.entries(CHANGE_TYPE_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
              </select>
              <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                {AUTHORITIES.map(a => <option key={a.id} value={a.id}>{a.code}</option>)}
              </select>

              <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-xl mr-auto">
                <button onClick={() => setViewMode('table')} className={`p-2 rounded-lg ${viewMode === 'table' ? 'bg-white shadow' : ''}`}>
                  <Table className="w-5 h-5" />
                </button>
                <button onClick={() => setViewMode('cards')} className={`p-2 rounded-lg ${viewMode === 'cards' ? 'bg-white shadow' : ''}`}>
                  <LayoutGrid className="w-5 h-5" />
                </button> </div> </div>
            {viewMode === 'table' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                      <th className="text-right px-4 py-4 font-bold text-slate-700 min-w-[250px]">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙØ§Ø°</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø£Ø«Ø±</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700 w-36">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredChanges.map(change => {
                      const auth = getAuthority(change.authorityId);
                      const typeCfg = CHANGE_TYPE_CONFIG[change.changeType];
                      const sevCfg = SEVERITY_CONFIG[change.severity];
                      const statusCfg = STATUS_CONFIG[change.status];
                      const days = getDaysUntilEffective(change.effectiveDate);
                      const TypeIcon = typeCfg?.icon || FileText;

                      return (
                        <tr key={change.id} className={`border-b border-slate-100 hover:bg-slate-50 ${change.severity === 'Critical' ? 'bg-red-50/50' : ''}`}>
                          <td className="px-4 py-4">
                            <div className="flex items-center gap-2">
                              <div className={`w-1.5 h-10 rounded-full ${sevCfg?.bg}`}></div>
                              <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-lg">{change.code}</span>
                            </div> </td>
                          <td className="px-4 py-4">
                            <div className="cursor-pointer hover:text-indigo-600" onClick={() => handleViewChange(change)}>
                              <p className="font-bold text-slate-800 line-clamp-1">{change.title}</p>
                              <p className="text-xs text-slate-500 line-clamp-1">{change.description?.substring(0, 60)}...</p>
                            </div> </td>
                          <td className="px-3 py-4 text-center">
                            <span className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">{auth?.code}</span>
                          </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                              <TypeIcon className="w-3.5 h-3.5" />{typeCfg?.label}
                            </span> </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                          </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                              {React.createElement(statusCfg?.icon || Clock, { className: "w-3 h-3" })}
                              {statusCfg?.label}
                            </span> </td>
                          <td className="px-3 py-4 text-center">
                            <div className="text-sm font-bold text-slate-700">{change.effectiveDate}</div>
                            {days !== null && change.status !== 'Closed' && (
                              <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${days < 0 ? 'bg-emerald-100 text-emerald-600' : days <= 30 ? 'bg-amber-100 text-amber-600' : 'bg-slate-100 text-slate-600'
                                }`}>
                                {days < 0 ? 'Ù†Ø§ÙØ°' : `${days} ÙŠÙˆÙ…`}
                              </span>
                            )}
                          </td>
                          <td className="px-3 py-4 text-center">
                            {change.impact ? (
                              <span className={`px-2 py-1 rounded-lg text-xs font-bold ${SEVERITY_CONFIG[change.impact.overallLevel]?.light} ${SEVERITY_CONFIG[change.impact.overallLevel]?.text}`}>
                                {change.impact.obligationsCount} Ø¥Ù„ØªØ²Ø§Ù…
                              </span>
                            ) : (
                              <button onClick={() => handleRunImpactAssessment(change)}
                                className="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold hover:bg-amber-200">
                                ØªÙ‚ÙŠÙŠÙ…
                              </button>
                            )}
                          </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => handleViewChange(change)} className="p-2 hover:bg-blue-100 rounded-lg" title="Ø¹Ø±Ø¶">
                                <Eye className="w-4 h-4 text-blue-600" />
                              </button>
                              <button onClick={() => handleEditChange(change)} className="p-2 hover:bg-amber-100 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                                <Edit className="w-4 h-4 text-amber-600" />
                              </button>
                              {change.impact && change.status === 'Assessed' && (
                                <button onClick={() => handleUpdateStatus(change, 'Implementing')} className="p-2 hover:bg-emerald-100 rounded-lg" title="Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°">
                                  <Play className="w-4 h-4 text-emerald-600" />
                                </button>
                              )}
                            </div> </td> </tr>);
                    })}
                  </tbody> </table> </div>
            )}

            {viewMode === 'cards' && (
              <div className="grid grid-cols-3 gap-4">
                {filteredChanges.map(change => {
                  const auth = getAuthority(change.authorityId);
                  const typeCfg = CHANGE_TYPE_CONFIG[change.changeType];
                  const sevCfg = SEVERITY_CONFIG[change.severity];
                  const statusCfg = STATUS_CONFIG[change.status];
                  const days = getDaysUntilEffective(change.effectiveDate);
                  const TypeIcon = typeCfg?.icon || FileText;

                  return (
                    <div key={change.id} onClick={() => handleViewChange(change)}
                      className={`bg-white rounded-2xl border-2 overflow-hidden cursor-pointer hover:shadow-lg transition-all ${change.severity === 'Critical' ? 'border-red-300' : 'border-slate-200 hover:border-indigo-300'
                        }`}>
                      <div className={`px-4 py-3 ${sevCfg?.light} border-b-2 ${sevCfg?.border}`}>
                        <div className="flex items-center justify-between">
                          <span className="font-mono text-sm font-bold text-indigo-600">{change.code}</span>
                          <div className="flex items-center gap-2">
                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                              <TypeIcon className="w-3 h-3" />{typeCfg?.label}
                            </span> </div> </div> </div>
                      <div className="p-4">
                        <h4 className="font-bold text-slate-800 line-clamp-2 mb-3">{change.title}</h4>
                        <div className="flex flex-wrap gap-2 mb-3">
                          <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold">{auth?.code}</span>
                          <span className={`px-2 py-1 rounded text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                        </div>
                        <p className="text-sm text-slate-600 line-clamp-2 mb-4">{change.description}</p>

                        {change.impact && (
                          <div className="flex items-center gap-3 mb-3 text-xs text-slate-500">
                            <span>{change.impact.obligationsCount} Ø§Ù„ØªØ²Ø§Ù…</span>
                            <span>{change.impact.controlsCount} Ø¶Ø§Ø¨Ø·</span>
                            <span>{change.impact.tasksCount} Ù…Ù‡Ù…Ø©</span>
                          </div>
                        )}

                        <div className="flex items-center justify-between pt-3 border-t border-slate-100">
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                            {React.createElement(statusCfg?.icon || Clock, { className: "w-3 h-3" })}
                            {statusCfg?.label}
                          </span>
                          <span className={`text-xs font-bold ${days !== null && days <= 30 && days >= 0 ? 'text-amber-600' : 'text-slate-500'}`}>
                            Ù†ÙØ§Ø°: {change.effectiveDate}
                          </span> </div> </div> </div>);
                })}
              </div>
            )}
          </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: CHANGE WORKSPACE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'workspace' && selectedChange && (
          <div className="p-6">
            <div className={`rounded-2xl p-6 mb-6 border-2 ${SEVERITY_CONFIG[selectedChange.severity]?.border} ${SEVERITY_CONFIG[selectedChange.severity]?.light}`}>
              <div className="flex items-start justify-between">
                <div>
                  <div className="flex items-center gap-3 mb-2">
                    <span className="font-mono text-lg font-bold text-indigo-600 bg-indigo-100 px-3 py-1 rounded-lg">{selectedChange.code}</span>
                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-sm font-bold ${CHANGE_TYPE_CONFIG[selectedChange.changeType]?.light} ${CHANGE_TYPE_CONFIG[selectedChange.changeType]?.text}`}>
                      {React.createElement(CHANGE_TYPE_CONFIG[selectedChange.changeType]?.icon || FileText, { className: "w-4 h-4" })}
                      {CHANGE_TYPE_CONFIG[selectedChange.changeType]?.label}
                    </span>
                    <span className={`px-3 py-1 rounded-lg text-sm font-bold ${SEVERITY_CONFIG[selectedChange.severity]?.light} ${SEVERITY_CONFIG[selectedChange.severity]?.text}`}>
                      {SEVERITY_CONFIG[selectedChange.severity]?.label}
                    </span>
                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-sm font-bold ${STATUS_CONFIG[selectedChange.status]?.bg} ${STATUS_CONFIG[selectedChange.status]?.text}`}>
                      {React.createElement(STATUS_CONFIG[selectedChange.status]?.icon || Clock, { className: "w-4 h-4" })}
                      {STATUS_CONFIG[selectedChange.status]?.label}
                    </span> </div>
                  <h2 className="text-xl font-bold text-slate-800">{selectedChange.title}</h2>
                  <div className="flex items-center gap-4 mt-2 text-sm text-slate-600">
                    <span>Ø§Ù„Ø¬Ù‡Ø©: <strong>{getAuthority(selectedChange.authorityId)?.code}</strong></span>
                    <span>Ø§Ù„Ù†ÙØ§Ø°: <strong className={getDaysUntilEffective(selectedChange.effectiveDate) <= 30 ? 'text-amber-600' : ''}>{selectedChange.effectiveDate}</strong></span>
                    {selectedChange.sourceLink && (
                      <a href={selectedChange.sourceLink} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1 text-indigo-600 hover:underline">
                        <ExternalLink className="w-4 h-4" />Ø§Ù„Ù…ØµØ¯Ø±
                      </a>
                    )}
                  </div> </div>
                <div className="flex items-center gap-2">
                  {selectedChange.status === 'UnderReview' && !selectedChange.impact && (
                    <button onClick={() => handleRunImpactAssessment(selectedChange)}
                      className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-xl font-bold">
                      <Activity className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±
                    </button>
                  )}
                  {selectedChange.status === 'Assessed' && (
                    <button onClick={() => handleUpdateStatus(selectedChange, 'Implementing')}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold">
                      <Play className="w-5 h-5" />Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°
                    </button>
                  )}
                  {selectedChange.status === 'Implementing' && (
                    <>
                      <button onClick={() => handleApplyToCalendar(selectedChange)}
                        className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold">
                        <Calendar className="w-5 h-5" />ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
                      </button>
                      <button onClick={() => handleUpdateStatus(selectedChange, 'Closed')}
                        disabled={!selectedChange.actions?.every(a => a.status === 'Done')}
                        className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold disabled:opacity-50">
                        <CheckCircle2 className="w-5 h-5" />Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØºÙŠÙŠØ±
                      </button>
                    </>
                  )}
                  <button onClick={() => setSelectedChange(null)} className="p-2 hover:bg-slate-200 rounded-xl">
                    <X className="w-5 h-5 text-slate-500" />
                  </button> </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="flex border-b border-slate-200 overflow-x-auto">
                {changeTabs.map(tab => (
                  <button key={tab.id} onClick={() => setChangeTab(tab.id)}
                    className={`flex items-center gap-2 px-5 py-3 font-bold transition-all border-b-2 whitespace-nowrap ${changeTab === tab.id ? 'text-indigo-600 border-indigo-500 bg-indigo-50' : 'text-slate-500 border-transparent hover:bg-slate-50'
                      }`}>
                    <tab.icon className="w-4 h-4" />{tab.label}
                  </button>
                ))}
              </div>

              <div className="p-6">
                {changeTab === 'summary' && (
                  <div className="grid grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</h4>
                        <p className="text-slate-600">{selectedChange.description}</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</span><span className="font-bold">{selectedChange.issueDate}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù†ÙØ§Ø°:</span><span className="font-bold">{selectedChange.effectiveDate}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span><span className="font-bold">{selectedChange.createdAt}</span></div>
                          {selectedChange.closedAt && (
                            <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¥ØºÙ„Ø§Ù‚:</span><span className="font-bold text-emerald-600">{selectedChange.closedAt}</span></div>
                          )}
                        </div> </div> </div>
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-4">
                        <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„:</span><span className="font-bold">{getUser(selectedChange.createdBy)?.name}</span></div>
                          {selectedChange.impact?.assessorId && (
                            <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…:</span><span className="font-bold">{getUser(selectedChange.impact.assessorId)?.name}</span></div>
                          )}
                          {selectedChange.closedBy && (
                            <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…ÙØºÙ„ÙÙ‚:</span><span className="font-bold">{getUser(selectedChange.closedBy)?.name}</span></div>
                          )}
                        </div> </div>
                      {selectedChange.impact && (
                        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200">
                          <h4 className="font-bold text-amber-800 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø³Ø±ÙŠØ¹</h4>
                          <div className="grid grid-cols-2 gap-2 text-sm">
                            <div className="bg-white rounded-lg p-2 text-center">
                              <span className="text-2xl font-bold text-emerald-600">{selectedChange.impact.obligationsCount}</span>
                              <p className="text-xs text-slate-500">Ø§Ù„ØªØ²Ø§Ù…</p>
                            </div>
                            <div className="bg-white rounded-lg p-2 text-center">
                              <span className="text-2xl font-bold text-blue-600">{selectedChange.impact.controlsCount}</span>
                              <p className="text-xs text-slate-500">Ø¶Ø§Ø¨Ø·</p>
                            </div>
                            <div className="bg-white rounded-lg p-2 text-center">
                              <span className="text-2xl font-bold text-purple-600">{selectedChange.impact.policiesCount}</span>
                              <p className="text-xs text-slate-500">Ø³ÙŠØ§Ø³Ø©</p>
                            </div>
                            <div className="bg-white rounded-lg p-2 text-center">
                              <span className="text-2xl font-bold text-amber-600">{selectedChange.impact.tasksCount}</span>
                              <p className="text-xs text-slate-500">Ù…Ù‡Ù…Ø©</p>
                            </div> </div> </div>
                      )}
                    </div> </div>
                )}

                {changeTab === 'items' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</h4>
                      <button onClick={handleAddItem}
                        className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold">
                        <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©
                      </button> </div>
                    {selectedChange.items?.length > 0 ? (
                      <div className="space-y-3">
                        {selectedChange.items.map(item => {
                          const impactCfg = IMPACT_TYPE_CONFIG[item.impactType];
                          const ImpactIcon = impactCfg?.icon || Edit;
                          return (
                            <div key={item.id} className={`rounded-xl border-2 p-4 bg-${impactCfg?.color}-50 border-${impactCfg?.color}-200`}>
                              <div className="flex items-start justify-between mb-3">
                                <div className="flex items-center gap-2">
                                  <span className={`inline-flex items-center gap-1 px-2 py-1 bg-${impactCfg?.color}-100 text-${impactCfg?.color}-700 rounded-lg text-xs font-bold`}>
                                    <ImpactIcon className="w-3 h-3" />{impactCfg?.label}
                                  </span>
                                  <span className="font-mono text-sm font-bold text-slate-700">{item.requirementId}</span>
                                </div> </div>
                              <div className="grid grid-cols-2 gap-4">
                                {item.oldText && (
                                  <div className="bg-red-50 rounded-lg p-3 border border-red-200">
                                    <p className="text-xs text-red-600 font-bold mb-1">Ø§Ù„Ù†Øµ Ø§Ù„Ø³Ø§Ø¨Ù‚:</p>
                                    <p className="text-sm text-slate-700 line-through">{item.oldText}</p>
                                  </div>
                                )}
                                {item.newText && (
                                  <div className="bg-emerald-50 rounded-lg p-3 border border-emerald-200">
                                    <p className="text-xs text-emerald-600 font-bold mb-1">Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</p>
                                    <p className="text-sm text-slate-700">{item.newText}</p>
                                  </div>
                                )}
                              </div> </div>);
                        })}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <List className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø³Ø¬Ù„Ø©</p>
                      </div>
                    )}
                  </div>
                )}

                {changeTab === 'impact' && (
                  <div className="space-y-6">
                    {selectedChange.impact ? (
                      <>
                        <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-200">
                          <div className="flex items-center justify-between mb-6">
                            <h3 className="text-lg font-bold text-indigo-800 flex items-center gap-2">
                              <Activity className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± - Impact Analysis
                            </h3>
                            <div className="flex items-center gap-2">
                              <span className={`px-3 py-1 rounded-lg text-sm font-bold ${SEVERITY_CONFIG[selectedChange.impact.overallLevel]?.light} ${SEVERITY_CONFIG[selectedChange.impact.overallLevel]?.text}`}>
                                Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±: {SEVERITY_CONFIG[selectedChange.impact.overallLevel]?.label}
                              </span>
                              <span className="text-sm text-slate-500">ØªÙ‚ÙŠÙŠÙ…: {selectedChange.impact.assessedAt}</span>
                            </div> </div>
                          <div className="grid grid-cols-5 gap-4">
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200">
                              <ClipboardCheck className="w-8 h-8 text-emerald-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-emerald-600">{selectedChange.impact.obligationsCount}</span>
                              <p className="text-sm text-slate-600">Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200">
                              <Shield className="w-8 h-8 text-blue-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-blue-600">{selectedChange.impact.controlsCount}</span>
                              <p className="text-sm text-slate-600">Ø¶ÙˆØ§Ø¨Ø·</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200">
                              <AlertTriangle className="w-8 h-8 text-red-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-red-600">{selectedChange.impact.risksCount}</span>
                              <p className="text-sm text-slate-600">Ù…Ø®Ø§Ø·Ø±</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200">
                              <FileText className="w-8 h-8 text-purple-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-purple-600">{selectedChange.impact.policiesCount}</span>
                              <p className="text-sm text-slate-600">Ø³ÙŠØ§Ø³Ø§Øª</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200">
                              <Calendar className="w-8 h-8 text-amber-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-amber-600">{selectedChange.impact.tasksCount}</span>
                              <p className="text-sm text-slate-600">Ù…Ù‡Ø§Ù…</p>
                            </div> </div> </div>
                        <div className="grid grid-cols-2 gap-4">
                          <div className={`rounded-xl p-4 border-2 ${selectedChange.impact.retestingRequired ? 'bg-amber-50 border-amber-300' : 'bg-slate-50 border-slate-200'}`}>
                            <div className="flex items-center gap-3">
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${selectedChange.impact.retestingRequired ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-500'}`}>
                                <RefreshCw className="w-5 h-5" />
                              </div>
                              <div>
                                <p className="font-bold text-slate-800">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                                <p className={`text-sm ${selectedChange.impact.retestingRequired ? 'text-amber-600 font-bold' : 'text-slate-500'}`}>
                                  {selectedChange.impact.retestingRequired ? 'Ù…Ø·Ù„ÙˆØ¨' : 'ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨'}
                                </p> </div> </div> </div>
                          <div className={`rounded-xl p-4 border-2 ${selectedChange.impact.evidenceRefreshRequired ? 'bg-blue-50 border-blue-300' : 'bg-slate-50 border-slate-200'}`}>
                            <div className="flex items-center gap-3">
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${selectedChange.impact.evidenceRefreshRequired ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-500'}`}>
                                <FileCheck className="w-5 h-5" />
                              </div>
                              <div>
                                <p className="font-bold text-slate-800">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¯Ù„Ø©</p>
                                <p className={`text-sm ${selectedChange.impact.evidenceRefreshRequired ? 'text-blue-600 font-bold' : 'text-slate-500'}`}>
                                  {selectedChange.impact.evidenceRefreshRequired ? 'Ù…Ø·Ù„ÙˆØ¨' : 'ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨'}
                                </p> </div> </div> </div> </div>
                        <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4">Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø£Ø«Ø± - Impact Graph</h4>
                          <div className="flex items-center justify-center gap-8">
                            <div className="text-center">
                              <div className="w-20 h-20 rounded-full bg-indigo-500 flex items-center justify-center text-white mb-2">
                                <RefreshCw className="w-10 h-10" />
                              </div>
                              <p className="text-sm font-bold">Ø§Ù„ØªØºÙŠÙŠØ±</p>
                            </div>
                            <div className="flex flex-col items-center gap-2">
                              <ChevronLeft className="w-8 h-8 text-indigo-400 rotate-180" />
                              <span className="text-xs text-slate-500">ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰</span>
                            </div>
                            <div className="grid grid-cols-3 gap-4">
                              {[
                                { icon: ClipboardCheck, label: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', count: selectedChange.impact.obligationsCount, color: 'emerald' },
                                { icon: Shield, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', count: selectedChange.impact.controlsCount, color: 'blue' },
                                { icon: FileText, label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', count: selectedChange.impact.policiesCount, color: 'purple' },
                              ].map((item, idx) => (
                                <div key={idx} className={`w-16 h-16 rounded-xl bg-${item.color}-100 border-2 border-${item.color}-300 flex flex-col items-center justify-center`}>
                                  <item.icon className={`w-6 h-6 text-${item.color}-600`} />
                                  <span className={`text-sm font-bold text-${item.color}-700`}>{item.count}</span>
                                </div>
                              ))}
                            </div> </div> </div>
                      </>
                    ) : (
                      <div className="text-center py-16 bg-amber-50 rounded-2xl border-2 border-amber-200">
                        <Activity className="w-16 h-16 text-amber-400 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-amber-800 mb-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± Ø¨Ø¹Ø¯</h3>
                        <p className="text-amber-600 mb-6">Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ù…Ø­Ø±Ùƒ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                        <button onClick={() => handleRunImpactAssessment(selectedChange)}
                          className="px-8 py-3 bg-amber-500 text-white rounded-xl font-bold">
                          <Activity className="w-5 h-5 inline ml-2" />ØªØ´ØºÙŠÙ„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±
                        </button> </div>
                    )}
                  </div>
                )}

                {changeTab === 'actions' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° - Action Plan</h4>
                      <button onClick={handleAddAction}
                        className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold">
                        <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡
                      </button> </div>
                    {selectedChange.actions?.length > 0 && (
                      <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-4 border border-emerald-200 mb-4">
                        <div className="flex items-center justify-between mb-2">
                          <span className="font-bold text-emerald-800">ØªÙ‚Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                          <span className="text-sm text-emerald-700">
                            {selectedChange.actions.filter(a => a.status === 'Done').length} / {selectedChange.actions.length} Ø¥Ø¬Ø±Ø§Ø¡ Ù…ÙƒØªÙ…Ù„
                          </span> </div>
                        <div className="h-3 bg-white rounded-full overflow-hidden">
                          <div className="h-full bg-emerald-500 rounded-full transition-all"
                            style={{ width: `${(selectedChange.actions.filter(a => a.status === 'Done').length / selectedChange.actions.length) * 100}%` }}></div>
                        </div> </div>
                    )}

                    {selectedChange.actions?.length > 0 ? (
                      <div className="space-y-3">
                        {selectedChange.actions.map(action => {
                          const typeCfg = ACTION_TYPE_CONFIG[action.type];
                          const TypeIcon = typeCfg?.icon || Zap;
                          const statusColors = {
                            Open: 'bg-slate-100 text-slate-700', InProgress: 'bg-blue-100 text-blue-700', Done: 'bg-emerald-100 text-emerald-700',
                          };
                          return (
                            <div key={action.id} className={`rounded-xl border-2 p-4 ${action.status === 'Done' ? 'bg-emerald-50 border-emerald-200' : 'bg-white border-slate-200'}`}>
                              <div className="flex items-start justify-between">
                                <div className="flex items-start gap-3">
                                  <div className={`w-10 h-10 rounded-xl bg-${typeCfg?.color}-100 flex items-center justify-center`}>
                                    <TypeIcon className={`w-5 h-5 text-${typeCfg?.color}-600`} />
                                  </div>
                                  <div>
                                    <div className="flex items-center gap-2 mb-1">
                                      <span className={`px-2 py-0.5 bg-${typeCfg?.color}-100 text-${typeCfg?.color}-700 rounded text-xs font-bold`}>{typeCfg?.label}</span>
                                      <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusColors[action.status]}`}>
                                        {action.status === 'Done' ? 'Ù…ÙƒØªÙ…Ù„' : action.status === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…ÙØªÙˆØ­'}
                                      </span> </div>
                                    <p className="text-slate-800">{action.description}</p>
                                    <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                                      <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {getUser(action.ownerId)?.name}</span>
                                      <span>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {action.dueDate}</span>
                                    </div> </div> </div>
                                {action.status !== 'Done' && (
                                  <div className="flex items-center gap-2">
                                    {action.status === 'Open' && (
                                      <button onClick={() => handleUpdateActionStatus(action.id, 'InProgress')}
                                        className="px-3 py-1.5 bg-blue-500 text-white rounded-lg text-sm font-bold">
                                        Ø¨Ø¯Ø¡
                                      </button>
                                    )}
                                    <button onClick={() => handleUpdateActionStatus(action.id, 'Done')}
                                      className="flex items-center gap-1 px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-sm font-bold">
                                      <Check className="w-4 h-4" />Ø¥ÙƒÙ…Ø§Ù„
                                    </button> </div>
                                )}
                              </div> </div>);
                        })}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <Zap className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                      </div>
                    )}
                  </div>
                )}

                {changeTab === 'evidence' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</h4>
                      <button className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold">
                        <Upload className="w-5 h-5" />Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„
                      </button> </div>
                    {selectedChange.closureEvidence?.length > 0 ? (
                      <div className="space-y-3">
                        {selectedChange.closureEvidence.map(ev => (
                          <div key={ev.id} className="flex items-center gap-4 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                            <CheckCircle2 className="w-6 h-6 text-emerald-500" />
                            <div>
                              <p className="font-bold text-slate-800">Ø¯Ù„ÙŠÙ„ #{ev.evidenceId}</p>
                              <p className="text-sm text-slate-500">Ù‚Ø¨ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø©: {getUser(ev.acceptedBy)?.name} ÙÙŠ {ev.acceptedAt}</p>
                            </div> </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <FileCheck className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ø¥ØºÙ„Ø§Ù‚</p>
                      </div>
                    )}
                  </div>
                )}

                {changeTab === 'audit' && (
                  <div className="space-y-4">
                    <h4 className="font-bold text-slate-800 mb-4">Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ - Audit Trail</h4>
                    <div className="relative">
                      <div className="absolute right-4 top-0 bottom-0 w-0.5 bg-slate-200"></div>
                      <div className="space-y-4">
                        {[
                          { date: selectedChange.createdAt, action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±', user: selectedChange.createdBy, icon: Plus, color: 'indigo' },
                          selectedChange.impact?.assessedAt && { date: selectedChange.impact.assessedAt, action: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±', user: selectedChange.impact.assessorId, icon: Activity, color: 'amber' },
                          selectedChange.closedAt && { date: selectedChange.closedAt, action: 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØºÙŠÙŠØ±', user: selectedChange.closedBy, icon: CheckCircle2, color: 'emerald' },
                        ].filter(Boolean).map((entry, idx) => {
                          const Icon = entry.icon;
                          return (
                            <div key={idx} className="relative flex gap-4 pr-8">
                              <div className={`absolute right-2 w-5 h-5 rounded-full bg-${entry.color}-500 flex items-center justify-center`}>
                                <Icon className="w-3 h-3 text-white" />
                              </div>
                              <div className={`flex-1 bg-${entry.color}-50 rounded-xl p-4 border border-${entry.color}-200`}>
                                <div className="flex items-center justify-between mb-1">
                                  <span className={`font-bold text-${entry.color}-700`}>{entry.action}</span>
                                  <span className="text-sm text-slate-500">{entry.date}</span>
                                </div>
                                <p className="text-slate-600 text-sm">Ø¨ÙˆØ§Ø³Ø·Ø©: {getUser(entry.user)?.name}</p>
                              </div> </div>);
                        })}
                      </div> </div> </div>
                )}
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: TIMELINE VIEW
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'timeline' && (
          <div className="p-6">
            <h3 className="font-bold text-slate-800 mb-6">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</h3>
            <div className="relative">
              <div className="absolute right-8 top-0 bottom-0 w-1 bg-gradient-to-b from-indigo-500 via-purple-500 to-emerald-500 rounded-full"></div>
              <div className="space-y-6 pr-16">
                {changes.sort((a, b) => new Date(b.effectiveDate) - new Date(a.effectiveDate)).map(change => {
                  const typeCfg = CHANGE_TYPE_CONFIG[change.changeType];
                  const sevCfg = SEVERITY_CONFIG[change.severity];
                  const statusCfg = STATUS_CONFIG[change.status];
                  const auth = getAuthority(change.authorityId);
                  const days = getDaysUntilEffective(change.effectiveDate);
                  const TypeIcon = typeCfg?.icon || FileText;

                  return (
                    <div key={change.id} className="relative flex gap-6">
                      <div className={`absolute right-5 w-6 h-6 rounded-full ${typeCfg?.bg} border-4 border-white shadow-lg flex items-center justify-center`}>
                        <TypeIcon className="w-3 h-3 text-white" />
                      </div>
                      <div className={`flex-1 bg-white rounded-2xl border-2 ${sevCfg?.border} p-5 hover:shadow-lg cursor-pointer transition-all`}
                        onClick={() => handleViewChange(change)}>
                        <div className="flex items-start justify-between mb-3">
                          <div>
                            <div className="flex items-center gap-2 mb-1">
                              <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{change.code}</span>
                              <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                                <TypeIcon className="w-3 h-3" />{typeCfg?.label}
                              </span>
                              <span className={`px-2 py-0.5 rounded text-xs font-bold ${sevCfg?.light} ${sevCfg?.text}`}>{sevCfg?.label}</span>
                              <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                                {React.createElement(statusCfg?.icon || Clock, { className: "w-3 h-3" })}
                                {statusCfg?.label}
                              </span> </div>
                            <h4 className="font-bold text-slate-800 text-lg">{change.title}</h4>
                          </div>
                          <div className="text-left">
                            <div className={`px-3 py-1 rounded-lg text-center ${days !== null && days >= 0 && days <= 30 ? 'bg-amber-100' : days !== null && days < 0 ? 'bg-emerald-100' : 'bg-slate-100'}`}>
                              <p className={`text-lg font-bold ${days !== null && days >= 0 && days <= 30 ? 'text-amber-700' : days !== null && days < 0 ? 'text-emerald-700' : 'text-slate-700'}`}>
                                {days !== null && days >= 0 ? days : 'Ù†Ø§ÙØ°'}
                              </p>
                              <p className="text-xs text-slate-500">{days !== null && days >= 0 ? 'ÙŠÙˆÙ…' : ''}</p>
                            </div>
                            <p className="text-xs text-slate-500 mt-1">{change.effectiveDate}</p>
                          </div> </div>
                        <p className="text-slate-600 mb-4 line-clamp-2">{change.description}</p>
                        <div className="flex items-center gap-4 text-sm text-slate-500">
                          <span className="flex items-center gap-1"><Building2 className="w-4 h-4" />{auth?.code}</span>
                          {change.impact && (
                            <>
                              <span className="flex items-center gap-1"><ClipboardCheck className="w-4 h-4" />{change.impact.obligationsCount} Ø§Ù„ØªØ²Ø§Ù…</span>
                              <span className="flex items-center gap-1"><Shield className="w-4 h-4" />{change.impact.controlsCount} Ø¶Ø§Ø¨Ø·</span>
                            </>
                          )}
                          {change.actions?.length > 0 && (
                            <span className="flex items-center gap-1">
                              <Zap className="w-4 h-4" />
                              {change.actions.filter(a => a.status === 'Done').length}/{change.actions.length} Ø¥Ø¬Ø±Ø§Ø¡
                            </span>
                          )}
                        </div> </div> </div>);
                })}
              </div> </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          CHANGE WIZARD MODAL - Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ - ULTIMATE 10-STEP EDITION
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'change' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-600 via-purple-500 to-pink-500 px-6 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <RefreshCw className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-black">{modalMode === 'create' ? 'ØªØ³Ø¬ÙŠÙ„ ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ'}</h2>
                    <p className="text-indigo-200 font-mono text-sm">{formData.code}</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="relative w-16 h-16">
                    <svg className="w-16 h-16 transform -rotate-90">
                      <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.2)" strokeWidth="4" fill="none" />
                      <circle cx="32" cy="32" r="28" stroke="white" strokeWidth="4" fill="none"
                        strokeDasharray={`${(wizardStep / 9) * 176} 176`} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">
                      <span className="text-lg font-black">{wizardStep + 1}/10</span>
                    </div> </div>
                  <button onClick={() => { setShowModal(false); setWizardStep(0); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-5 h-5" />
                  </button> </div> </div>
              <div className="grid grid-cols-10 gap-1">
                {[
                  { step: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                  { step: 1, label: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Building2 },
                  { step: 2, label: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: BookOpen },
                  { step: 3, label: 'Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø³Ø±ÙŠØ§Ù†', icon: Calendar },
                  { step: 4, label: 'Ù†ÙˆØ¹ ÙˆÙ…ØµØ¯Ø± Ø§Ù„ØªØºÙŠÙŠØ±', icon: Tag },
                  { step: 5, label: 'Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', icon: List },
                  { step: 6, label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø±', icon: Activity },
                  { step: 7, label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„ÙØ±ÙŠÙ‚', icon: Users },
                  { step: 8, label: 'Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°', icon: ClipboardList },
                  { step: 9, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', icon: CheckCircle2 },
                ].map((s) => (
                  <button key={s.step} onClick={() => setWizardStep(s.step)}
                    className={`flex flex-col items-center p-2 rounded-xl transition-all ${wizardStep === s.step ? 'bg-white text-purple-600' :
                      wizardStep > s.step ? 'bg-emerald-400/40 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20'
                      }`}>
                    <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-1 ${wizardStep === s.step ? 'bg-purple-100' :
                      wizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                      }`}>
                      {wizardStep > s.step ? <Check className="w-4 h-4" /> : <s.icon className="w-4 h-4" />}
                    </div>
                    <span className="text-[9px] font-bold text-center leading-tight">{s.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="p-6 max-h-[50vh] overflow-y-auto">

              {wizardStep === 0 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200">
                    <h3 className="text-lg font-black text-indigo-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-indigo-500 text-white rounded-lg flex items-center justify-center text-sm">1</span>
                      <FileText className="w-5 h-5" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØºÙŠÙŠØ± *</label>
                        <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-indigo-200 rounded-xl text-lg font-bold focus:border-indigo-500 focus:outline-none"
                          placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©" />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ù…ÙŠÙ… / Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</label>
                          <input type="text" value={formData.circularNumber || ''} onChange={(e) => setFormData({ ...formData, circularNumber: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl"
                            placeholder="Ù…Ø«Ø§Ù„: 2025/01/C" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                          <div className="flex gap-2">
                            {[
                              { value: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red' },
                              { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange' },
                              { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                              { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald' },
                            ].map(pri => (
                              <button key={pri.value} type="button" onClick={() => setFormData({ ...formData, priority: pri.value })}
                                className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${formData.priority === pri.value ? `bg-${pri.color}-500 text-white` : `bg-${pri.color}-50 text-${pri.color}-700`}`}>
                                {pri.label}
                              </button>
                            ))}
                          </div> </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„ØªØºÙŠÙŠØ± *</label>
                        <textarea rows={3} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©..." />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 1 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">2</span>
                      <Building2 className="w-5 h-5" />Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ¯Ø±Ø©
                    </h3>
                    <div className="grid grid-cols-4 gap-3">
                      {[
                        { id: 1, code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', color: 'emerald' },
                        { id: 2, code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', color: 'blue' },
                        { id: 3, code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', color: 'purple' },
                        { id: 4, code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', color: 'indigo' },
                        { id: 5, code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', color: 'amber' },
                        { id: 6, code: 'CCHI', name: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', color: 'teal' },
                        { id: 7, code: 'HRSD', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'rose' },
                        { id: 8, code: 'CITC', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', color: 'cyan' },
                      ].map(auth => (
                        <button key={auth.id} type="button" onClick={() => setFormData({ ...formData, authorityId: auth.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.authorityId === auth.id ? `border-${auth.color}-500 bg-${auth.color}-100` : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <div className={`w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center font-black text-lg ${formData.authorityId === auth.id ? `bg-${auth.color}-500 text-white` : 'bg-slate-100 text-slate-600'
                            }`}>{auth.code.substring(0, 2)}</div>
                          <p className="text-xs font-bold text-slate-700">{auth.name}</p>
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-lg font-black text-blue-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm">3</span>
                      <BookOpen className="w-5 h-5" />Ø§Ù„Ø¥Ø·Ø§Ø± / Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªØ£Ø«Ø±
                    </h3>
                    <div className="grid grid-cols-3 gap-3">
                      {[
                        { id: 1, code: 'SAMA-AML/CFT', name: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨' },
                        { id: 2, code: 'SAMA-BCM', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„' },
                        { id: 3, code: 'SAMA-CYBER', name: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ' },
                        { id: 4, code: 'NCA-ECC', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' },
                        { id: 5, code: 'NCA-CCC', name: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©' },
                        { id: 6, code: 'PDPL', name: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©' },
                        { id: 7, code: 'ISO 27001', name: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
                        { id: 8, code: 'PCI-DSS', name: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ø§Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹' },
                        { id: 9, code: 'Other', name: 'Ø¥Ø·Ø§Ø± Ø¢Ø®Ø±' },
                      ].map(fw => (
                        <button key={fw.id} type="button" onClick={() => setFormData({ ...formData, frameworkId: fw.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.frameworkId === fw.id ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'
                            }`}>
                          <p className="font-bold text-blue-600 text-sm">{fw.code}</p>
                          <p className="text-xs text-slate-600 mt-1">{fw.name}</p>
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                    <h3 className="text-lg font-black text-amber-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center text-sm">4</span>
                      <Calendar className="w-5 h-5" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø³Ø±ÙŠØ§Ù†
                    </h3>
                    <div className="grid grid-cols-3 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± *</label>
                        <input type="date" value={formData.publishedDate || ''} onChange={(e) => setFormData({ ...formData, publishedDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù† *</label>
                        <input type="date" value={formData.effectiveDate || ''} onChange={(e) => setFormData({ ...formData, effectiveDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„</label>
                        <input type="date" value={formData.complianceDeadline || ''} onChange={(e) => setFormData({ ...formData, complianceDeadline: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                      </div> </div>
                    <div className="mt-4 grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ (Ø£ÙŠØ§Ù…)</label>
                        <input type="number" value={formData.gracePeriod || ''} onChange={(e) => setFormData({ ...formData, gracePeriod: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø±ÙŠØ§Ù†</label>
                        <select value={formData.effectiveType || ''} onChange={(e) => setFormData({ ...formData, effectiveType: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                          <option value="Immediate">ÙÙˆØ±ÙŠ</option>
                          <option value="Phased">Ù…Ø±Ø­Ù„ÙŠ</option>
                          <option value="Delayed">Ù…Ø¤Ø¬Ù„</option>
                        </select>
                      </div> </div> </div> </div>
              )}

              {wizardStep === 4 && (
                <div className="grid grid-cols-2 gap-5">
                  <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-5 border-2 border-purple-200">
                    <h3 className="text-base font-black text-purple-800 mb-3 flex items-center gap-2">
                      <Tag className="w-5 h-5" />Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±
                    </h3>
                    <div className="space-y-2">
                      {[
                        { id: 'New', label: 'Ù…ØªØ·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', icon: 'ğŸ†•', desc: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹' },
                        { id: 'Amendment', label: 'ØªØ¹Ø¯ÙŠÙ„', icon: 'âœï¸', desc: 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ù…ØªØ·Ù„Ø¨ Ù‚Ø§Ø¦Ù…' },
                        { id: 'Clarification', label: 'ØªÙˆØ¶ÙŠØ­', icon: 'ğŸ’¡', desc: 'ØªÙˆØ¶ÙŠØ­ Ø£Ùˆ ØªÙØ³ÙŠØ±' },
                        { id: 'Repeal', label: 'Ø¥Ù„ØºØ§Ø¡', icon: 'ğŸ—‘ï¸', desc: 'Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ·Ù„Ø¨ Ù‚Ø§Ø¦Ù…' },
                      ].map(type => (
                        <button key={type.id} type="button" onClick={() => setFormData({ ...formData, changeType: type.id })}
                          className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.changeType === type.id ? 'border-purple-500 bg-purple-100' : 'border-slate-200 hover:border-purple-300'
                            }`}>
                          <span className="text-2xl">{type.icon}</span>
                          <div className="flex-1 text-right">
                            <p className="font-bold text-slate-800">{type.label}</p>
                            <p className="text-xs text-slate-500">{type.desc}</p>
                          </div>
                          {formData.changeType === type.id && <CheckCircle2 className="w-5 h-5 text-purple-500" />}
                        </button>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl p-5 border-2 border-cyan-200">
                    <h3 className="text-base font-black text-cyan-800 mb-3 flex items-center gap-2">
                      <Search className="w-5 h-5" />Ù…ØµØ¯Ø± Ø§Ù„Ø§ÙƒØªØ´Ø§Ù
                    </h3>
                    <div className="space-y-2">
                      {[
                        { id: 'OfficialGazette', label: 'Ø§Ù„Ø¬Ø±ÙŠØ¯Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©', icon: 'ğŸ“°' },
                        { id: 'RegulatorWebsite', label: 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: 'ğŸŒ' },
                        { id: 'DirectCircular', label: 'ØªØ¹Ù…ÙŠÙ… Ù…Ø¨Ø§Ø´Ø±', icon: 'ğŸ“§' },
                        { id: 'IndustryAlert', label: 'ØªÙ†Ø¨ÙŠÙ‡ ØµÙ†Ø§Ø¹ÙŠ', icon: 'ğŸ””' },
                        { id: 'LegalAdvisor', label: 'Ù…Ø³ØªØ´Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ', icon: 'âš–ï¸' },
                        { id: 'Other', label: 'Ù…ØµØ¯Ø± Ø¢Ø®Ø±', icon: 'ğŸ“Œ' },
                      ].map(src => (
                        <button key={src.id} type="button" onClick={() => setFormData({ ...formData, discoverySource: src.id })}
                          className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.discoverySource === src.id ? 'border-cyan-500 bg-cyan-100' : 'border-slate-200 hover:border-cyan-300'
                            }`}>
                          <span className="text-xl">{src.icon}</span>
                          <span className="font-bold text-slate-800 flex-1 text-right">{src.label}</span>
                          {formData.discoverySource === src.id && <CheckCircle2 className="w-5 h-5 text-cyan-500" />}
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 5 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-rose-50 to-pink-50 rounded-2xl p-5 border-2 border-rose-200">
                    <h3 className="text-lg font-black text-rose-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-rose-500 text-white rounded-lg flex items-center justify-center text-sm">6</span>
                      <List className="w-5 h-5" />Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
                    </h3>
                    <div className="space-y-3">
                      <div className="grid grid-cols-3 gap-3">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø© / Ø§Ù„Ø¨Ù†Ø¯</label>
                          <input type="text" value={formData.affectedArticle || ''} onChange={(e) => setFormData({ ...formData, affectedArticle: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø§Ø¯Ø© 5.2.1" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                          <input type="number" value={formData.affectedObligationsCount || ''} onChange={(e) => setFormData({ ...formData, affectedObligationsCount: parseInt(e.target.value) })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="0" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                          <input type="number" value={formData.affectedControlsCount || ''} onChange={(e) => setFormData({ ...formData, affectedControlsCount: parseInt(e.target.value) })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="0" />
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¯</label>
                        <textarea rows={3} value={formData.articleChangeSummary || ''} onChange={(e) => setFormData({ ...formData, articleChangeSummary: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="Ù…Ù„Ø®Øµ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¯..." />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 6 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl p-5 border-2 border-orange-200">
                    <h3 className="text-lg font-black text-orange-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-orange-500 text-white rounded-lg flex items-center justify-center text-sm">7</span>
                      <Activity className="w-5 h-5" />ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø± *</label>
                        <div className="space-y-2">
                          {[
                            { id: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red', desc: 'ØªØ£Ø«ÙŠØ± Ø¬ÙˆÙ‡Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' },
                            { id: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', desc: 'ÙŠØªØ·Ù„Ø¨ ØªØºÙŠÙŠØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø©' },
                            { id: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', desc: 'ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©' },
                            { id: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald', desc: 'ØªØ£Ø«ÙŠØ± Ø·ÙÙŠÙ' },
                          ].map(level => (
                            <button key={level.id} type="button" onClick={() => setFormData({ ...formData, impactLevel: level.id })}
                              className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.impactLevel === level.id ? `border-${level.color}-500 bg-${level.color}-100` : 'border-slate-200'
                                }`}>
                              <div className={`w-4 h-4 rounded-full bg-${level.color}-500`}></div>
                              <div className="flex-1 text-right">
                                <p className="font-bold">{level.label}</p>
                                <p className="text-xs text-slate-500">{level.desc}</p>
                              </div> </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                        <div className="space-y-2">
                          {['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©'].map(unit => {
                            const isSelected = formData.affectedUnits?.includes(unit);
                            return (
                              <label key={unit} className={`flex items-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-orange-500 bg-orange-100' : 'border-slate-200 hover:border-slate-300'
                                }`}>
                                <input type="checkbox" checked={isSelected} onChange={(e) => {
                                  const current = formData.affectedUnits || [];
                                  setFormData({ ...formData, affectedUnits: e.target.checked ? [...current, unit] : current.filter(u => u !== unit) });
                                }} className="w-4 h-4 rounded text-orange-500" />
                                <span className="font-bold text-slate-700">{unit}</span>
                              </label>
                            );
                          })}
                        </div> </div> </div> </div> </div>
              )}

              {wizardStep === 7 && (
                <div className="grid grid-cols-2 gap-5">
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-base font-black text-blue-800 mb-3 flex items-center gap-2">
                      <User className="w-5 h-5" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„ØªÙ†ÙÙŠØ°
                    </h3>
                    <div className="space-y-2">
                      {USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, ownerId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.ownerId === user.id ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.ownerId === user.id ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                            <p className="text-xs text-slate-500">{user.role}</p>
                          </div>
                          {formData.ownerId === user.id && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-base font-black text-emerald-800 mb-3 flex items-center gap-2">
                      <Users className="w-5 h-5" />ÙØ±ÙŠÙ‚ Ø§Ù„ØªÙ†ÙÙŠØ°
                    </h3>
                    <div className="space-y-2">
                      {USERS.map(user => {
                        const isSelected = formData.teamMembers?.includes(user.id);
                        return (
                          <div key={user.id} onClick={() => {
                            const current = formData.teamMembers || [];
                            setFormData({ ...formData, teamMembers: isSelected ? current.filter(id => id !== user.id) : [...current, user.id] });
                          }}
                            className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${isSelected ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300'
                              }`}>
                            <input type="checkbox" checked={isSelected} readOnly className="w-4 h-4 rounded text-emerald-500" />
                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${isSelected ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'
                              }`}>{user.name.charAt(0)}</div>
                            <div className="flex-1">
                              <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                            </div> </div>);
                      })}
                    </div> </div> </div>
              )}

              {wizardStep === 8 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-teal-50 to-emerald-50 rounded-2xl p-5 border-2 border-teal-200">
                    <h3 className="text-lg font-black text-teal-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-teal-500 text-white rounded-lg flex items-center justify-center text-sm">9</span>
                      <ClipboardList className="w-5 h-5" />Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                        <input type="date" value={formData.implementationStart || ''} onChange={(e) => setFormData({ ...formData, implementationStart: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-teal-200 rounded-xl" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                        <input type="date" value={formData.implementationEnd || ''} onChange={(e) => setFormData({ ...formData, implementationEnd: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-teal-200 rounded-xl" />
                      </div> </div>
                    <div className="mt-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
                      <textarea rows={3} value={formData.implementationSteps || ''} onChange={(e) => setFormData({ ...formData, implementationSteps: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                        placeholder="1. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©&#10;2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª&#10;3. ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø¹Ù†ÙŠÙŠÙ†" />
                    </div>
                    <div className="mt-4 p-4 bg-white rounded-xl border border-slate-200">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" checked={formData.requiresGapAssessment || false} onChange={(e) => setFormData({ ...formData, requiresGapAssessment: e.target.checked })}
                          className="w-5 h-5 rounded text-teal-500" />
                        <span className="font-bold text-slate-700">ÙŠØªØ·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… ÙØ¬ÙˆØ§Øª (Gap Assessment)</span>
                      </label>
                    </div> </div> </div>
              )}

              {wizardStep === 9 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">10</span>
                      <CheckCircle2 className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><FileText className="w-4 h-4 text-indigo-500" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span><span className="font-bold">{formData.code}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span><span className="font-bold truncate max-w-32">{formData.title || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù†ÙˆØ¹:</span><span className="font-bold">{formData.changeType || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Building2 className="w-4 h-4 text-emerald-500" />Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„Ø¥Ø·Ø§Ø±</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¬Ù‡Ø©:</span><span className="font-bold">{getAuthority(formData.authorityId)?.code || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¥Ø·Ø§Ø±:</span><span className="font-bold">{formData.frameworkId || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Calendar className="w-4 h-4 text-amber-500" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø³Ø±ÙŠØ§Ù†:</span><span className="font-bold">{formData.effectiveDate || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø£Ø«Ø±:</span><span className="font-bold">{formData.impactLevel || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Users className="w-4 h-4 text-purple-500" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span><span className="font-bold">{getUser(formData.ownerId)?.name || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙØ±ÙŠÙ‚:</span><span className="font-bold">{formData.teamMembers?.length || 0} Ø£Ø¹Ø¶Ø§Ø¡</span></div>
                        </div> </div> </div>
                    <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-2 text-sm">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                      <div className="grid grid-cols-3 gap-2">
                        {[
                          { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', valid: formData.title?.length >= 5 },
                          { label: 'Ø§Ù„Ø¬Ù‡Ø©', valid: !!formData.authorityId },
                          { label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†', valid: !!formData.effectiveDate },
                          { label: 'Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±', valid: !!formData.changeType },
                          { label: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±', valid: !!formData.impactLevel },
                          { label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', valid: !!formData.ownerId },
                        ].map((check, idx) => (
                          <div key={idx} className={`flex items-center gap-1 p-1.5 rounded-lg text-xs ${check.valid ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                            {check.valid ? <CheckCircle2 className="w-3 h-3" /> : <XCircle className="w-3 h-3" />}
                            <span className="font-bold">{check.label}</span>
                          </div>
                        ))}
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => wizardStep > 0 ? setWizardStep(wizardStep - 1) : setShowModal(false)}
                className="flex items-center gap-2 px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                <ChevronRight className="w-4 h-4" />
                {wizardStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
              </button>

              <div className="flex items-center gap-1">
                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(step => (
                  <div key={step} className={`w-2 h-2 rounded-full transition-all ${wizardStep === step ? 'bg-purple-500 w-4' : wizardStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                ))}
              </div>

              {wizardStep < 9 ? (
                <button onClick={() => setWizardStep(wizardStep + 1)}
                  className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold shadow-lg">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                </button>
              ) : (
                <button onClick={handleSave}
                  disabled={!formData.title || !formData.authorityId || !formData.effectiveDate}
                  className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                  <CheckCircle2 className="w-4 h-4" />{modalMode === 'create' ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                </button>
              )}
            </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          ITEM MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'item' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-blue-500 to-indigo-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <List className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ù…ØªØ£Ø«Ø±Ø©</h2>
                    <p className="text-blue-200">Change Item</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ·Ù„Ø¨/Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                <input type="text" value={formData.requirementId || ''} onChange={(e) => setFormData({ ...formData, requirementId: e.target.value })}
                  className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl" placeholder="Ù…Ø«Ø§Ù„: REQ-AML-15" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„ØªØ£Ø«ÙŠØ± *</label>
                <div className="grid grid-cols-3 gap-3">
                  {Object.entries(IMPACT_TYPE_CONFIG).map(([key, cfg]) => {
                    const isSelected = formData.impactType === key;
                    const ImpactIcon = cfg.icon;
                    return (
                      <button key={key} onClick={() => setFormData({ ...formData, impactType: key })}
                        className={`p-4 rounded-xl border-2 transition-all text-center ${isSelected ? `border-${cfg.color}-500 bg-${cfg.color}-100` : 'border-slate-200 bg-white hover:border-slate-400'
                          }`}>
                        <ImpactIcon className={`w-6 h-6 mx-auto mb-2 ${isSelected ? `text-${cfg.color}-600` : 'text-slate-400'}`} />
                        <p className="font-bold text-slate-800 text-sm">{cfg.label}</p>
                      </button>);
                  })}
                </div> </div>
              {formData.impactType !== 'Added' && (
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù†Øµ Ø§Ù„Ø³Ø§Ø¨Ù‚</label>
                  <textarea rows={2} value={formData.oldText || ''} onChange={(e) => setFormData({ ...formData, oldText: e.target.value })}
                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl resize-none" placeholder="Ø§Ù„Ù†Øµ Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„..." />
                </div>
              )}
              {formData.impactType !== 'Removed' && (
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                  <textarea rows={2} value={formData.newText || ''} onChange={(e) => setFormData({ ...formData, newText: e.target.value })}
                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl resize-none" placeholder="Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„..." />
                </div>
              )}
            </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-8 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} className="flex items-center gap-2 px-8 py-3 bg-blue-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø©
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          ACTION MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'action' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-emerald-500 to-teal-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Zap className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ†ÙÙŠØ°ÙŠ</h2>
                    <p className="text-emerald-200">Change Action</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                <div className="grid grid-cols-3 gap-3">
                  {Object.entries(ACTION_TYPE_CONFIG).map(([key, cfg]) => {
                    const isSelected = formData.type === key;
                    const TypeIcon = cfg.icon;
                    return (
                      <button key={key} onClick={() => setFormData({ ...formData, type: key })}
                        className={`p-4 rounded-xl border-2 transition-all text-center ${isSelected ? `border-${cfg.color}-500 bg-${cfg.color}-100` : 'border-slate-200 bg-white hover:border-slate-400'
                          }`}>
                        <TypeIcon className={`w-6 h-6 mx-auto mb-2 ${isSelected ? `text-${cfg.color}-600` : 'text-slate-400'}`} />
                        <p className="font-bold text-slate-800 text-sm">{cfg.label}</p>
                      </button>);
                  })}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *</label>
                <textarea rows={3} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl resize-none" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨..." />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ *</label>
                  <select value={formData.ownerId || ''} onChange={(e) => setFormData({ ...formData, ownerId: parseInt(e.target.value) || '' })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</option>
                    {USERS.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                  <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-8 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} className="flex items-center gap-2 px-8 py-3 bg-emerald-500 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
              </button> </div> </div> </div>
      )}
    </div>);
};

const RegulatoryContact = () => {
  const { can, currentUser, guardAction } = useAuth();

  const [activeTab, setActiveTab] = useState('command');
  const [selectedCase, setSelectedCase] = useState(null);
  const [caseTab, setCaseTab] = useState('summary');
  const [showModal, setShowModal] = useState(false);
  const [modalType, setModalType] = useState('case');
  const [formData, setFormData] = useState(null);
  const [notification, setNotification] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterType, setFilterType] = useState('');
  const [filterPriority, setFilterPriority] = useState('');
  const [viewMode, setViewMode] = useState('table');
  const [wizardStep, setWizardStep] = useState(0);

  // Current User (Use from Auth Context)
  const CURRENT_USER = currentUser || { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' };

  const [cases, setCases] = useState([
    {
      id: 1, code: 'REG-CAS-2025-001', authorityId: 1, caseType: 'Inquiry',
      subject: 'Ø§Ø³ØªÙØ³Ø§Ø± Ø­ÙˆÙ„ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
      description: 'Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† SAMA Ø­ÙˆÙ„ Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      receivedDate: '2025-01-15', dueDate: '2025-02-15', priority: 'High', status: 'InProgress',
      ownerId: 1, reviewerId: 2, approverId: 3, escalationLevel: 0,
      createdAt: '2025-01-15', createdBy: 1,
      messages: [
        { id: 1, direction: 'Incoming', channel: 'Portal', messageDate: '2025-01-15', sender: 'SAMA', recipient: 'Ø§Ù„Ø´Ø±ÙƒØ©', subject: 'Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª RFI-2025-0142', summary: 'Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª AML', status: 'Received', attachments: 2, isRead: true },
        { id: 2, direction: 'Outgoing', channel: 'Portal', messageDate: '2025-01-20', sender: 'Ø§Ù„Ø´Ø±ÙƒØ©', recipient: 'SAMA', subject: 'Ø±Ø¯ Ø¹Ù„Ù‰ RFI-2025-0142', summary: 'Ø±Ø¯ Ù…Ø¨Ø¯Ø¦ÙŠ Ù…Ø¹ Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯', status: 'Sent', attachments: 1, isRead: true },
      ],
      linkedObjects: [
        { type: 'Obligation', entityId: 1, code: 'OBL-001', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', status: 'Active' },
        { type: 'Obligation', entityId: 2, code: 'OBL-002', title: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', status: 'Active' },
        { type: 'Test', entityId: 3, code: 'TST-015', title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ù†Ø¸Ø§Ù… AML', status: 'Passed' },
      ],
      responsePack: { id: 1, status: 'Draft', obligationsCount: 2, evidenceCount: 0, evidenceList: [], signedOffBy: null, signedOffAt: null },
      auditTrail: [
        { date: '2025-01-15', action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', details: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©' },
      ],
    },
    {
      id: 2, code: 'REG-CAS-2025-002', authorityId: 3, caseType: 'Inspection',
      subject: 'ØªÙØªÙŠØ´ Ø¯ÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      description: 'Ø²ÙŠØ§Ø±Ø© ØªÙØªÙŠØ´ÙŠØ© Ù…Ù† Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      receivedDate: '2025-02-01', dueDate: '2025-02-28', priority: 'Critical', status: 'Open',
      ownerId: 3, reviewerId: 1, approverId: 3, escalationLevel: 1,
      createdAt: '2025-02-01', createdBy: 1,
      messages: [
        { id: 1, direction: 'Incoming', channel: 'Letter', messageDate: '2025-02-01', sender: 'NCA', recipient: 'Ø§Ù„Ø´Ø±ÙƒØ©', subject: 'Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©', summary: 'Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ø¨Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØªÙØªÙŠØ´ÙŠØ©', status: 'Received', attachments: 3, isRead: true },
      ],
      linkedObjects: [
        { type: 'Obligation', entityId: 5, code: 'OBL-005', title: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', status: 'Active' },
      ],
      responsePack: null,
      auditTrail: [{ date: '2025-02-01', action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', details: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªÙØªÙŠØ´' }],
    },
    {
      id: 3, code: 'REG-CAS-2025-003', authorityId: 4, caseType: 'ReportRequest',
      subject: 'Ø·Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', description: 'Ø·Ù„Ø¨ SDAIA Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ',
      receivedDate: '2025-01-01', dueDate: '2025-01-31', priority: 'Medium', status: 'Submitted',
      ownerId: 4, reviewerId: 1, approverId: 3, escalationLevel: 0,
      createdAt: '2025-01-01', createdBy: 1,
      messages: [
        { id: 1, direction: 'Incoming', channel: 'Portal', messageDate: '2025-01-01', sender: 'SDAIA', recipient: 'Ø§Ù„Ø´Ø±ÙƒØ©', subject: 'Ø·Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ', summary: 'Ø·Ù„Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±', status: 'Received', attachments: 1, isRead: true },
        { id: 2, direction: 'Outgoing', channel: 'Portal', messageDate: '2025-01-28', sender: 'Ø§Ù„Ø´Ø±ÙƒØ©', recipient: 'SDAIA', subject: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±', summary: 'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±', status: 'Sent', attachments: 5, isRead: true },
      ],
      linkedObjects: [{ type: 'Obligation', entityId: 4, code: 'OBL-004', title: 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', status: 'Active' }],
      responsePack: { id: 2, status: 'Sent', obligationsCount: 1, evidenceCount: 5, evidenceList: [], signedOffBy: 3, signedOffAt: '2025-01-27' },
      auditTrail: [{ date: '2025-01-01', action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', details: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±' }],
    },
    {
      id: 4, code: 'REG-CAS-2025-004', authorityId: 1, caseType: 'ViolationNotice',
      subject: 'Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®Ø§Ù„ÙØ© - ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      description: 'Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ù…Ù† Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', receivedDate: '2025-01-20', dueDate: '2025-02-05',
      priority: 'Critical', status: 'Closed',
      ownerId: 1, reviewerId: 2, approverId: 3, escalationLevel: 0,
      createdAt: '2025-01-20', createdBy: 1,
      messages: [
        { id: 1, direction: 'Incoming', channel: 'Letter', messageDate: '2025-01-20', sender: 'SAMA', recipient: 'Ø§Ù„Ø´Ø±ÙƒØ©', subject: 'Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®Ø§Ù„ÙØ©', summary: 'Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ø¨Ù…Ø®Ø§Ù„ÙØ©', status: 'Received', attachments: 2, isRead: true },
        { id: 2, direction: 'Outgoing', channel: 'Letter', messageDate: '2025-01-25', sender: 'Ø§Ù„Ø´Ø±ÙƒØ©', recipient: 'SAMA', subject: 'Ø±Ø¯ Ø¹Ù„Ù‰ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', summary: 'Ø±Ø¯ Ø±Ø³Ù…ÙŠ ÙˆØ®Ø·Ø© ØªØµØ­ÙŠØ­', status: 'Sent', attachments: 4, isRead: true },
      ],
      linkedObjects: [
        { type: 'Breach', entityId: 1, code: 'BRH-2025-001', title: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± AML', status: 'Closed' },
        { type: 'CAPA', entityId: 1, code: 'CAPA-001', title: 'Ø®Ø·Ø© ØªØµØ­ÙŠØ­ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', status: 'Completed' },
      ],
      responsePack: { id: 3, status: 'Sent', obligationsCount: 2, evidenceCount: 4, evidenceList: [], signedOffBy: 3, signedOffAt: '2025-01-24' },
      closedAt: '2025-02-03', closedBy: 3, closureNotes: 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø¶ÙŠØ©',
      auditTrail: [{ date: '2025-01-20', action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', details: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©' }],
    },
    {
      id: 5, code: 'REG-CAS-2025-005', authorityId: 2, caseType: 'Meeting',
      subject: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', description: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¯ÙˆØ±ÙŠ Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­',
      receivedDate: '2025-02-10', dueDate: '2025-02-25', priority: 'Low', status: 'Open',
      ownerId: 5, reviewerId: 1, approverId: 3, escalationLevel: 0,
      createdAt: '2025-02-10', createdBy: 1,
      messages: [
        { id: 1, direction: 'Incoming', channel: 'Email', messageDate: '2025-02-10', sender: 'CMA', recipient: 'Ø§Ù„Ø´Ø±ÙƒØ©', subject: 'Ø¯Ø¹ÙˆØ© Ù„Ø§Ø¬ØªÙ…Ø§Ø¹', summary: 'Ø¯Ø¹ÙˆØ© Ù„Ø­Ø¶ÙˆØ± Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…ØªØ§Ø¨Ø¹Ø©', status: 'Received', attachments: 1, isRead: false },
      ],
      linkedObjects: [], responsePack: null,
      auditTrail: [{ date: '2025-02-10', action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', details: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø¹ÙˆØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹' }],
    },]);
  const CASE_TYPE_CONFIG = {
    Inquiry: { label: 'Ø§Ø³ØªÙØ³Ø§Ø±', icon: HelpCircle, bg: 'bg-blue-500', light: 'bg-blue-100', text: 'text-blue-700' },
    Inspection: { label: 'ØªÙØªÙŠØ´', icon: Search, bg: 'bg-purple-500', light: 'bg-purple-100', text: 'text-purple-700' },
    ReportRequest: { label: 'Ø·Ù„Ø¨ ØªÙ‚Ø±ÙŠØ±', icon: FileText, bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700' },
    ViolationNotice: { label: 'Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®Ø§Ù„ÙØ©', icon: AlertTriangle, bg: 'bg-red-500', light: 'bg-red-100', text: 'text-red-700' },
    Meeting: { label: 'Ø§Ø¬ØªÙ…Ø§Ø¹', icon: Users, bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700' },
  };

  const STATUS_CONFIG = {
    Open: { label: 'Ù…ÙØªÙˆØ­', icon: Inbox, bg: 'bg-slate-100', text: 'text-slate-700' },
    InProgress: { label: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„', icon: Zap, bg: 'bg-blue-100', text: 'text-blue-700' },
    PendingApproval: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', icon: Clock, bg: 'bg-amber-100', text: 'text-amber-700' },
    Submitted: { label: 'ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…', icon: Send, bg: 'bg-purple-100', text: 'text-purple-700' },
    Closed: { label: 'Ù…ØºÙ„Ù‚', icon: CheckCircle2, bg: 'bg-emerald-100', text: 'text-emerald-700' },
  };

  const PRIORITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', bg: 'bg-red-600', light: 'bg-red-100', text: 'text-red-700' },
    High: { label: 'Ø¹Ø§Ù„ÙŠ', bg: 'bg-orange-500', light: 'bg-orange-100', text: 'text-orange-700' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700' },
  };

  const CHANNEL_CONFIG = {
    Email: { label: 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', icon: Mail }, Portal: { label: 'Ø¨ÙˆØ§Ø¨Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', icon: Globe },
    Letter: { label: 'Ø®Ø·Ø§Ø¨ Ø±Ø³Ù…ÙŠ', icon: FileText }, Meeting: { label: 'Ø§Ø¬ØªÙ…Ø§Ø¹', icon: Users },
    Phone: { label: 'Ø§ØªØµØ§Ù„ Ù‡Ø§ØªÙÙŠ', icon: PhoneCall },
  };

  const LINK_TYPE_CONFIG = {
    Obligation: { label: 'Ø§Ù„ØªØ²Ø§Ù…', icon: ClipboardCheck, bg: 'bg-emerald-100', text: 'text-emerald-700' },
    Breach: { label: 'Ù…Ø®Ø§Ù„ÙØ©', icon: AlertTriangle, bg: 'bg-red-100', text: 'text-red-700' },
    ChangeEvent: { label: 'ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: RefreshCw, bg: 'bg-indigo-100', text: 'text-indigo-700' },
    CAPA: { label: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªØµØ­ÙŠØ­ÙŠ', icon: Zap, bg: 'bg-amber-100', text: 'text-amber-700' },
    Test: { label: 'Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardList, bg: 'bg-blue-100', text: 'text-blue-700' },
    Evidence: { label: 'Ø¯Ù„ÙŠÙ„', icon: FileCheck, bg: 'bg-cyan-100', text: 'text-cyan-700' },
  };

  const COMM_USERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' },
    { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Compliance Reviewer' },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'Compliance Approver' },
    { id: 4, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'DPO' },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Governance Analyst' },
  ];

  const stats = useMemo(() => {
    const now = new Date();
    const open = cases.filter(c => c.status === 'Open').length;
    const inProgress = cases.filter(c => c.status === 'InProgress').length;
    const submitted = cases.filter(c => c.status === 'Submitted').length;
    const closed = cases.filter(c => c.status === 'Closed').length;
    const critical = cases.filter(c => c.priority === 'Critical' && c.status !== 'Closed').length;
    const overdue = cases.filter(c => {
      if (c.status === 'Closed' || c.status === 'Submitted') return false;
      return new Date(c.dueDate) < now;
    }).length;
    const dueIn7Days = cases.filter(c => {
      if (c.status === 'Closed' || c.status === 'Submitted') return false;
      const days = Math.ceil((new Date(c.dueDate) - now) / (1000 * 60 * 60 * 24));
      return days >= 0 && days <= 7;
    }).length;
    const pendingApproval = cases.filter(c => c.responsePack && c.responsePack.status === 'Draft').length;
    const totalMessages = cases.reduce((sum, c) => sum + (c.messages?.length || 0), 0);
    const incomingMessages = cases.reduce((sum, c) => sum + (c.messages?.filter(m => m.direction === 'Incoming').length || 0), 0);
    const outgoingMessages = cases.reduce((sum, c) => sum + (c.messages?.filter(m => m.direction === 'Outgoing').length || 0), 0);
    const unreadMessages = cases.reduce((sum, c) => sum + (c.messages?.filter(m => m.direction === 'Incoming' && !m.isRead).length || 0), 0);
    return { total: cases.length, open, inProgress, submitted, closed, critical, overdue, dueIn7Days, pendingApproval, totalMessages, incomingMessages, outgoingMessages, unreadMessages, activeCases: open + inProgress };
  }, [cases]);

  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const getUser = (id) => COMM_USERS.find(u => u.id === id);
  const getAuthority = (id) => AUTHORITIES.find(a => a.id === id);

  const getDaysUntilDue = (date) => {
    if (!date) return null;
    return Math.ceil((new Date(date) - new Date()) / (1000 * 60 * 60 * 24));
  };

  const filteredCases = useMemo(() => {
    return cases.filter(c => {
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        if (!c.code.toLowerCase().includes(q) && !c.subject.toLowerCase().includes(q)) return false;
      }
      if (filterStatus && c.status !== filterStatus) return false;
      if (filterType && c.caseType !== filterType) return false;
      if (filterPriority && c.priority !== filterPriority) return false;
      return true;
    });
  }, [cases, searchQuery, filterStatus, filterType, filterPriority]);

  const handleCreateCase = () => {
    setFormData({
      id: null, code: `REG-CAS-2025-${String(cases.length + 1).padStart(3, '0')}`,
      authorityId: '', caseType: 'Inquiry', subject: '', description: '',
      receivedDate: new Date().toISOString().split('T')[0], dueDate: '',
      priority: 'Medium', status: 'Open', ownerId: CURRENT_USER.id, reviewerId: '', approverId: '',
      escalationLevel: 0, messages: [], linkedObjects: [], responsePack: null, auditTrail: [],
    });
    setModalType('case');
    setShowModal(true);
  };

  const handleEditCase = (caseItem) => {
    setFormData({ ...caseItem });
    setModalType('case');
    setShowModal(true);
  };

  const handleDeleteCase = (caseItem) => {
    if (window.confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù‚Ø¶ÙŠØ© ${caseItem.code}ØŸ`)) {
      setCases(cases.filter(c => c.id !== caseItem.id));
      if (selectedCase?.id === caseItem.id) {
        setSelectedCase(null);
        setActiveTab('register');
      }
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
    }
  };

  const handleViewCase = (caseItem) => {
    setSelectedCase(caseItem);
    setCaseTab('summary');
    setActiveTab('workspace');
  };

  const handleAddMessage = () => {
    if (!selectedCase) return;
    setFormData({
      id: null, direction: 'Outgoing', channel: 'Email', messageDate: new Date().toISOString().split('T')[0],
      sender: 'Ø§Ù„Ø´Ø±ÙƒØ©', recipient: getAuthority(selectedCase.authorityId)?.nameAr || '',
      subject: '', summary: '', status: 'Draft', attachments: 0, isRead: false
    });
    setModalType('message');
    setShowModal(true);
  };

  const handleEditMessage = (msg) => {
    setFormData({ ...msg });
    setModalType('message');
    setShowModal(true);
  };

  const handleDeleteMessage = (msgId) => {
    if (!selectedCase || !window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) return;
    const updatedCase = {
      ...selectedCase,
      messages: selectedCase.messages.filter(m => m.id !== msgId),
      auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø©', user: CURRENT_USER.name, details: '' }]
    };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
  };

  const handleSendMessage = (msgId) => {
    if (!selectedCase) return;
    const updatedCase = {
      ...selectedCase,
      messages: selectedCase.messages.map(m => m.id === msgId ? { ...m, status: 'Sent' } : m),
      auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©', user: CURRENT_USER.name, details: '' }]
    };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
  };

  const handleAddLink = () => {
    if (!selectedCase) return;
    setFormData({ type: 'Obligation', entityId: '', code: '', title: '', status: 'Active' });
    setModalType('link');
    setShowModal(true);
  };

  const handleEditLink = (link, idx) => {
    if (!selectedCase) return;
    setFormData({ ...link, _idx: idx });
    setModalType('link');
    setShowModal(true);
  };

  const handleUnlinkObject = (linkIdx) => {
    if (!selectedCase || !window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø·ØŸ')) return;
    const updatedCase = {
      ...selectedCase,
      linkedObjects: selectedCase.linkedObjects.filter((_, idx) => idx !== linkIdx),
      auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø·', user: CURRENT_USER.name, details: '' }]
    };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·');
  };

  const handleCreateResponsePack = () => {
    if (!selectedCase) return;
    const responsePack = {
      id: Date.now(), status: 'Draft',
      obligationsCount: selectedCase.linkedObjects?.filter(l => l.type === 'Obligation').length || 0,
      evidenceCount: 0, evidenceList: [], signedOffBy: null, signedOffAt: null
    };
    const updatedCase = { ...selectedCase, responsePack, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯', user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
  };

  const handleAddEvidence = () => {
    if (!selectedCase) return;
    setFormData({ evidenceCode: '', evidenceTitle: '', evidenceType: 'Document', evidenceStatus: 'Accepted' });
    setModalType('evidence');
    setShowModal(true);
  };

  const handleRemoveEvidence = (evidenceId) => {
    if (!selectedCase?.responsePack || !window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ØŸ')) return;
    const updatedEvidenceList = selectedCase.responsePack.evidenceList.filter(e => e.id !== evidenceId);
    const updatedPack = { ...selectedCase.responsePack, evidenceCount: updatedEvidenceList.length, evidenceList: updatedEvidenceList };
    const updatedCase = { ...selectedCase, responsePack: updatedPack, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ø²Ø§Ù„Ø© Ø¯Ù„ÙŠÙ„', user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„');
  };

  const handleDeleteResponsePack = () => {
    if (!selectedCase?.responsePack || !window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ØŸ')) return;
    const updatedCase = { ...selectedCase, responsePack: null, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø­Ø°Ù Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯', user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø­Ø°Ù Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯');
  };

  const handleApproveResponsePack = () => {
    if (!selectedCase?.responsePack) return;
    const updatedPack = { ...selectedCase.responsePack, status: 'Approved', signedOffBy: CURRENT_USER.id, signedOffAt: new Date().toISOString().split('T')[0] };
    const updatedCase = { ...selectedCase, responsePack: updatedPack, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯', user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
  };

  const handleSubmitResponse = () => {
    if (!selectedCase?.responsePack || selectedCase.responsePack.status !== 'Approved') {
      showNotification('ÙŠØ¬Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }
    const updatedPack = { ...selectedCase.responsePack, status: 'Sent' };
    const updatedCase = { ...selectedCase, responsePack: updatedPack, status: 'Submitted', auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø±Ø¯', user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
    setSelectedCase(updatedCase);
    showNotification('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
  };

  const handleUpdateStatus = (caseItem, newStatus) => {
    const updatedCase = { ...caseItem, status: newStatus, auditTrail: [...(caseItem.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: `ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ ${STATUS_CONFIG[newStatus]?.label}`, user: CURRENT_USER.name, details: '' }] };
    if (newStatus === 'Closed') {
      updatedCase.closedAt = new Date().toISOString().split('T')[0];
      updatedCase.closedBy = CURRENT_USER.id;
    }
    setCases(cases.map(c => c.id === caseItem.id ? updatedCase : c));
    if (selectedCase?.id === caseItem.id) setSelectedCase(updatedCase);
    showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${STATUS_CONFIG[newStatus]?.label}`);
  };

  const handleEscalate = (caseItem) => {
    const newLevel = (caseItem.escalationLevel || 0) + 1;
    const updatedCase = { ...caseItem, escalationLevel: newLevel, auditTrail: [...(caseItem.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: `Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}`, user: CURRENT_USER.name, details: '' }] };
    setCases(cases.map(c => c.id === caseItem.id ? updatedCase : c));
    if (selectedCase?.id === caseItem.id) setSelectedCase(updatedCase);
    showNotification(`ØªÙ… Ø§Ù„ØªØµØ¹ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}`);
  };

  const handleSave = () => {
    if (modalType === 'case') {
      if (!formData.subject || !formData.authorityId || !formData.dueDate) {
        showNotification('Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ù„Ø¬Ù‡Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');
        return;
      }
      if (formData.id) {
        const updatedCase = { ...formData, auditTrail: [...(formData.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: CURRENT_USER.name, details: '' }] };
        setCases(cases.map(c => c.id === formData.id ? updatedCase : c));
        if (selectedCase?.id === formData.id) setSelectedCase(updatedCase);
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        const newCase = { ...formData, id: Date.now(), auditTrail: [{ date: new Date().toISOString().split('T')[0], action: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©', user: CURRENT_USER.name, details: '' }] };
        setCases([...cases, newCase]);
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
      }
    } else if (modalType === 'message') {
      if (!formData.subject || !formData.summary) {
        showNotification('Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ù„Ù…Ù„Ø®Øµ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
        return;
      }
      if (formData.id) {
        const updatedCase = { ...selectedCase, messages: selectedCase.messages.map(m => m.id === formData.id ? formData : m), auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'ØªØ¹Ø¯ÙŠÙ„ Ø±Ø³Ø§Ù„Ø©', user: CURRENT_USER.name, details: '' }] };
        setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
        setSelectedCase(updatedCase);
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
      } else {
        const newMessage = { ...formData, id: Date.now(), status: formData.direction === 'Outgoing' ? 'Draft' : 'Received' };
        const updatedCase = { ...selectedCase, messages: [...(selectedCase.messages || []), newMessage], auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©', user: CURRENT_USER.name, details: '' }] };
        setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
        setSelectedCase(updatedCase);
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
      }
    } else if (modalType === 'link') {
      if (!formData.code || !formData.title) {
        showNotification('Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
        return;
      }
      const newLink = { type: formData.type, entityId: formData.entityId || Date.now(), code: formData.code, title: formData.title, status: formData.status };
      let updatedLinks;
      if (formData._idx !== undefined) {
        updatedLinks = selectedCase.linkedObjects.map((l, idx) => idx === formData._idx ? newLink : l);
      } else {
        updatedLinks = [...(selectedCase.linkedObjects || []), newLink];
      }
      const updatedCase = { ...selectedCase, linkedObjects: updatedLinks, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: formData._idx !== undefined ? 'ØªØ¹Ø¯ÙŠÙ„ Ø±Ø¨Ø·' : 'Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø·', user: CURRENT_USER.name, details: '' }] };
      setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
      setSelectedCase(updatedCase);
      showNotification(formData._idx !== undefined ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
    } else if (modalType === 'evidence') {
      if (!formData.evidenceCode || !formData.evidenceTitle) {
        showNotification('Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
        return;
      }
      const newEvidence = { id: Date.now(), code: formData.evidenceCode, title: formData.evidenceTitle, type: formData.evidenceType, status: formData.evidenceStatus };
      const updatedPack = { ...selectedCase.responsePack, evidenceCount: (selectedCase.responsePack.evidenceCount || 0) + 1, evidenceList: [...(selectedCase.responsePack.evidenceList || []), newEvidence] };
      const updatedCase = { ...selectedCase, responsePack: updatedPack, auditTrail: [...(selectedCase.auditTrail || []), { date: new Date().toISOString().split('T')[0], action: 'Ø¥Ø¶Ø§ÙØ© Ø¯Ù„ÙŠÙ„', user: CURRENT_USER.name, details: '' }] };
      setCases(cases.map(c => c.id === selectedCase.id ? updatedCase : c));
      setSelectedCase(updatedCase);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    }
    setShowModal(false);
    setFormData(null);
  };

  const mainTabs = [
    { id: 'command', label: 'Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard },
    { id: 'register', label: 'Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§', icon: ClipboardList, count: stats.activeCases },
    { id: 'workspace', label: 'Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„', icon: Briefcase, disabled: !selectedCase },
    { id: 'calendar', label: 'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', icon: Calendar },
  ];

  const caseTabs = [
    { id: 'summary', label: 'Ø§Ù„Ù…Ù„Ø®Øµ', icon: FileText },
    { id: 'thread', label: 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª', icon: MessageSquare },
    { id: 'linked', label: 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø·', icon: Link2 },
    { id: 'response', label: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯', icon: Package },
    { id: 'audit', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', icon: History },
  ];

  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold flex items-center gap-2 ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertCircle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-500 via-blue-500 to-indigo-600 flex items-center justify-center shadow-xl">
            <MessageSquare className="w-8 h-8 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-slate-900">Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h1>
            <p className="text-slate-500">Regulatory Communications Management</p>
          </div> </div>
        <div className="flex items-center gap-3">
          {stats.unreadMessages > 0 && (
            <div className="flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-xl">
              <Mail className="w-5 h-5" />
              <span className="font-bold">{stats.unreadMessages} Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
            </div>
          )}
          <button onClick={handleCreateCase} className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
            <Plus className="w-5 h-5" />Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
          </button> </div> </div>
      <div className="grid grid-cols-10 gap-3">
        <div className={`rounded-2xl p-3 ${stats.critical > 0 ? 'bg-red-500 animate-pulse' : 'bg-red-400'} text-white text-center`}>
          <AlertTriangle className="w-5 h-5 mx-auto mb-1" />
          <span className="text-2xl font-bold block">{stats.critical}</span>
          <span className="text-xs">Ø­Ø±Ø¬</span>
        </div>
        <div className={`rounded-2xl p-3 ${stats.overdue > 0 ? 'bg-orange-500 animate-pulse' : 'bg-orange-400'} text-white text-center`}>
          <Clock className="w-5 h-5 mx-auto mb-1" />
          <span className="text-2xl font-bold block">{stats.overdue}</span>
          <span className="text-xs">Ù…ØªØ£Ø®Ø±</span>
        </div>
        <div className="rounded-2xl p-3 bg-amber-500 text-white text-center">
          <Calendar className="w-5 h-5 mx-auto mb-1" />
          <span className="text-2xl font-bold block">{stats.dueIn7Days}</span>
          <span className="text-xs">7 Ø£ÙŠØ§Ù…</span>
        </div>
        <div className="bg-slate-100 rounded-2xl p-3 border-2 border-slate-200 text-center">
          <Inbox className="w-5 h-5 mx-auto mb-1 text-slate-500" />
          <span className="text-2xl font-bold text-slate-700 block">{stats.open}</span>
          <span className="text-xs text-slate-500">Ù…ÙØªÙˆØ­</span>
        </div>
        <div className="bg-blue-100 rounded-2xl p-3 border-2 border-blue-200 text-center">
          <Zap className="w-5 h-5 mx-auto mb-1 text-blue-600" />
          <span className="text-2xl font-bold text-blue-700 block">{stats.inProgress}</span>
          <span className="text-xs text-blue-600">Ø¬Ø§Ø±ÙŠ</span>
        </div>
        <div className="bg-amber-100 rounded-2xl p-3 border-2 border-amber-200 text-center">
          <Clock className="w-5 h-5 mx-auto mb-1 text-amber-600" />
          <span className="text-2xl font-bold text-amber-700 block">{stats.pendingApproval}</span>
          <span className="text-xs text-amber-600">Ø§Ø¹ØªÙ…Ø§Ø¯</span>
        </div>
        <div className="bg-purple-100 rounded-2xl p-3 border-2 border-purple-200 text-center">
          <Send className="w-5 h-5 mx-auto mb-1 text-purple-600" />
          <span className="text-2xl font-bold text-purple-700 block">{stats.submitted}</span>
          <span className="text-xs text-purple-600">Ù…Ù‚Ø¯Ù‘Ù…</span>
        </div>
        <div className="bg-emerald-100 rounded-2xl p-3 border-2 border-emerald-200 text-center">
          <CheckCircle2 className="w-5 h-5 mx-auto mb-1 text-emerald-600" />
          <span className="text-2xl font-bold text-emerald-700 block">{stats.closed}</span>
          <span className="text-xs text-emerald-600">Ù…ØºÙ„Ù‚</span>
        </div>
        <div className="bg-cyan-100 rounded-2xl p-3 border-2 border-cyan-200 text-center">
          <ArrowDownCircle className="w-5 h-5 mx-auto mb-1 text-cyan-600" />
          <span className="text-2xl font-bold text-cyan-700 block">{stats.incomingMessages}</span>
          <span className="text-xs text-cyan-600">ÙˆØ§Ø±Ø¯Ø©</span>
        </div>
        <div className="bg-teal-100 rounded-2xl p-3 border-2 border-teal-200 text-center">
          <ArrowUpCircle className="w-5 h-5 mx-auto mb-1 text-teal-600" />
          <span className="text-2xl font-bold text-teal-700 block">{stats.outgoingMessages}</span>
          <span className="text-xs text-teal-600">ØµØ§Ø¯Ø±Ø©</span>
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden shadow-sm">
        <div className="flex border-b border-slate-200 bg-slate-50">
          {mainTabs.map(tab => (
            <button key={tab.id} onClick={() => !tab.disabled && setActiveTab(tab.id)} disabled={tab.disabled}
              className={`flex items-center gap-2 px-6 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-cyan-600 border-cyan-500 bg-white' :
                tab.disabled ? 'text-slate-300 border-transparent cursor-not-allowed' :
                  'text-slate-500 border-transparent hover:bg-white hover:text-slate-700'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-cyan-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </div>

        {activeTab === 'command' && (
          <div className="p-6">
            <div className="grid grid-cols-3 gap-6">
              <div className="col-span-2 bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-gradient-to-r from-red-500 to-orange-500 px-5 py-3 text-white flex items-center justify-between">
                  <h3 className="font-bold flex items-center gap-2"><AlertTriangle className="w-5 h-5" />Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</h3>
                  <span className="bg-white/20 px-3 py-1 rounded-lg text-sm">{stats.critical + stats.overdue + stats.dueIn7Days} Ù‚Ø¶ÙŠØ©</span>
                </div>
                <div className="p-4 space-y-3 max-h-80 overflow-y-auto">
                  {cases.filter(c => c.status !== 'Closed' && c.status !== 'Submitted').sort((a, b) => {
                    const priorityOrder = { Critical: 0, High: 1, Medium: 2, Low: 3 };
                    if (priorityOrder[a.priority] !== priorityOrder[b.priority]) return priorityOrder[a.priority] - priorityOrder[b.priority];
                    return new Date(a.dueDate) - new Date(b.dueDate);
                  }).slice(0, 5).map(caseItem => {
                    const days = getDaysUntilDue(caseItem.dueDate);
                    const priorityCfg = PRIORITY_CONFIG[caseItem.priority];
                    const typeCfg = CASE_TYPE_CONFIG[caseItem.caseType];
                    const auth = getAuthority(caseItem.authorityId);
                    const TypeIcon = typeCfg?.icon || FileText;
                    return (
                      <div key={caseItem.id} onClick={() => handleViewCase(caseItem)}
                        className={`flex items-center gap-4 p-4 rounded-xl cursor-pointer transition-all hover:shadow-md ${days !== null && days < 0 ? 'bg-red-50 border-2 border-red-200' :
                          days !== null && days <= 7 ? 'bg-amber-50 border-2 border-amber-200' :
                            'bg-slate-50 border-2 border-slate-200'
                          }`}>
                        <div className={`w-14 h-14 rounded-xl ${priorityCfg?.bg} flex items-center justify-center text-white font-bold shadow-lg`}>
                          {days !== null && days >= 0 ? (
                            <div className="text-center">
                              <span className="text-xl font-bold block">{days}</span>
                              <span className="text-[10px]">ÙŠÙˆÙ…</span>
                            </div>
                          ) : (
                            <AlertTriangle className="w-6 h-6" />
                          )}
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-xs font-bold text-cyan-600 bg-cyan-100 px-2 py-0.5 rounded">{caseItem.code}</span>
                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                              <TypeIcon className="w-3 h-3" />{typeCfg?.label}
                            </span>
                            <span className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs font-bold">{auth?.code}</span>
                          </div>
                          <p className="font-bold text-slate-800 truncate">{caseItem.subject}</p>
                        </div>
                        <div className="text-left">
                          <p className="text-sm font-bold text-slate-700">{caseItem.dueDate}</p>
                          <p className={`text-xs font-bold ${days !== null && days < 0 ? 'text-red-600' : days !== null && days <= 7 ? 'text-amber-600' : 'text-slate-500'}`}>
                            {days !== null && days < 0 ? `Ù…ØªØ£Ø®Ø± ${Math.abs(days)} ÙŠÙˆÙ…` : days !== null ? `Ø¨Ø§Ù‚ÙŠ ${days} ÙŠÙˆÙ…` : ''}
                          </p> </div>
                        <ChevronLeft className="w-5 h-5 text-slate-400" />
                      </div>);
                  })}
                </div> </div>
              <div className="space-y-4">
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 text-white">
                  <h3 className="font-bold mb-4 flex items-center gap-2"><Zap className="w-5 h-5 text-amber-400" />Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                  <div className="space-y-2">
                    <button onClick={handleCreateCase} className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <Plus className="w-5 h-5" /><span>ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                    <button className="w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all">
                      <Package className="w-5 h-5" /><span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø±Ø¯</span>
                    </button> </div> </div>
                <div className="bg-gradient-to-r from-cyan-50 to-blue-50 rounded-2xl p-5 border border-cyan-200">
                  <h3 className="font-bold text-cyan-800 mb-4">Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø©</h3>
                  <div className="space-y-2">
                    {AUTHORITIES.slice(0, 5).map(auth => {
                      const count = cases.filter(c => c.authorityId === auth.id && c.status !== 'Closed').length;
                      return (
                        <div key={auth.id} className={`flex items-center justify-between p-3 rounded-xl transition-all ${count > 0 ? 'bg-white border border-cyan-200 shadow-sm' : 'bg-white/50'}`}>
                          <span className="font-bold text-slate-700">{auth.code}</span>
                          <span className={`text-lg font-bold ${count > 0 ? 'text-cyan-600' : 'text-slate-400'}`}>{count}</span>
                        </div>);
                    })}
                  </div> </div> </div> </div> </div>
        )}

        {activeTab === 'register' && (
          <div className="p-6">
            <div className="flex items-center gap-3 mb-6 flex-wrap">
              <div className="relative flex-1 max-w-md">
                <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full pr-12 pl-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-400 focus:outline-none" />
              </div>
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                {Object.entries(STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
              </select>
              <select value={filterType} onChange={(e) => setFilterType(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                {Object.entries(CASE_TYPE_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
              </select>
              <select value={filterPriority} onChange={(e) => setFilterPriority(e.target.value)}
                className="px-4 py-3 border-2 border-slate-200 rounded-xl bg-white">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                {Object.entries(PRIORITY_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
              </select>
              <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-xl mr-auto">
                <button onClick={() => setViewMode('table')} className={`p-2 rounded-lg transition-all ${viewMode === 'table' ? 'bg-white shadow' : 'hover:bg-white/50'}`}>
                  <LayoutList className="w-5 h-5" />
                </button>
                <button onClick={() => setViewMode('cards')} className={`p-2 rounded-lg transition-all ${viewMode === 'cards' ? 'bg-white shadow' : 'hover:bg-white/50'}`}>
                  <LayoutGrid className="w-5 h-5" />
                </button> </div> </div>
            {viewMode === 'table' && (
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200">
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                      <th className="text-right px-4 py-4 font-bold text-slate-700 min-w-[250px]">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                      <th className="text-center px-3 py-4 font-bold text-slate-700">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700 w-32">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredCases.map(caseItem => {
                      const auth = getAuthority(caseItem.authorityId);
                      const typeCfg = CASE_TYPE_CONFIG[caseItem.caseType];
                      const priorityCfg = PRIORITY_CONFIG[caseItem.priority];
                      const statusCfg = STATUS_CONFIG[caseItem.status];
                      const days = getDaysUntilDue(caseItem.dueDate);
                      const TypeIcon = typeCfg?.icon || FileText;
                      const StatusIcon = statusCfg?.icon || Clock;

                      return (
                        <tr key={caseItem.id} className={`border-b border-slate-100 hover:bg-slate-50 transition-colors ${caseItem.priority === 'Critical' && caseItem.status !== 'Closed' ? 'bg-red-50/50' : ''}`}>
                          <td className="px-4 py-4">
                            <div className="flex items-center gap-2">
                              <div className={`w-1.5 h-12 rounded-full ${priorityCfg?.bg}`}></div>
                              <span className="font-mono text-sm font-bold text-cyan-600 bg-cyan-50 px-2 py-1 rounded-lg">{caseItem.code}</span>
                            </div> </td>
                          <td className="px-4 py-4">
                            <div className="cursor-pointer hover:text-cyan-600" onClick={() => handleViewCase(caseItem)}>
                              <p className="font-bold text-slate-800 line-clamp-1">{caseItem.subject}</p>
                              <p className="text-xs text-slate-500 line-clamp-1">{caseItem.description}</p>
                            </div> </td>
                          <td className="px-3 py-4 text-center">
                            <span className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">{auth?.code}</span>
                          </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                              <TypeIcon className="w-3.5 h-3.5" />{typeCfg?.label}
                            </span> </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${priorityCfg?.light} ${priorityCfg?.text}`}>{priorityCfg?.label}</span>
                          </td>
                          <td className="px-3 py-4 text-center">
                            <span className={`inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                              <StatusIcon className="w-3 h-3" />{statusCfg?.label}
                            </span> </td>
                          <td className="px-3 py-4 text-center">
                            <div className="text-sm font-bold text-slate-700">{caseItem.dueDate}</div>
                            {days !== null && caseItem.status !== 'Closed' && caseItem.status !== 'Submitted' && (
                              <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${days < 0 ? 'bg-red-100 text-red-600' : days <= 7 ? 'bg-amber-100 text-amber-600' : 'bg-slate-100 text-slate-600'
                                }`}>
                                {days < 0 ? `Ù…ØªØ£Ø®Ø± ${Math.abs(days)}` : `${days} ÙŠÙˆÙ…`}
                              </span>
                            )}
                          </td>
                          <td className="px-3 py-4 text-center">
                            <div className="flex items-center justify-center gap-2">
                              <span className="flex items-center gap-1 text-blue-600 text-sm">
                                <ArrowDownCircle className="w-4 h-4" />
                                {caseItem.messages?.filter(m => m.direction === 'Incoming').length || 0}
                              </span>
                              <span className="text-slate-300">/</span>
                              <span className="flex items-center gap-1 text-emerald-600 text-sm">
                                <ArrowUpCircle className="w-4 h-4" />
                                {caseItem.messages?.filter(m => m.direction === 'Outgoing').length || 0}
                              </span> </div> </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => handleViewCase(caseItem)} className="p-2 hover:bg-blue-100 rounded-lg" title="Ø¹Ø±Ø¶">
                                <Eye className="w-4 h-4 text-blue-600" />
                              </button>
                              <button onClick={(e) => { e.stopPropagation(); handleEditCase(caseItem); }} className="p-2 hover:bg-amber-100 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                                <Edit className="w-4 h-4 text-amber-600" />
                              </button>
                              {caseItem.status !== 'Closed' && caseItem.escalationLevel < 3 && (
                                <button onClick={(e) => { e.stopPropagation(); handleEscalate(caseItem); }} className="p-2 hover:bg-orange-100 rounded-lg" title="ØªØµØ¹ÙŠØ¯">
                                  <TrendingUp className="w-4 h-4 text-orange-600" />
                                </button>
                              )}
                              <button onClick={(e) => { e.stopPropagation(); handleDeleteCase(caseItem); }} className="p-2 hover:bg-red-100 rounded-lg" title="Ø­Ø°Ù">
                                <Trash2 className="w-4 h-4 text-red-600" />
                              </button> </div> </td> </tr>);
                    })}
                  </tbody> </table>
                {filteredCases.length === 0 && (
                  <div className="text-center py-12 text-slate-400">
                    <Search className="w-12 h-12 mx-auto mb-2 opacity-50" />
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>
                  </div>
                )}
              </div>
            )}

            {viewMode === 'cards' && (
              <div className="grid grid-cols-3 gap-4">
                {filteredCases.map(caseItem => {
                  const auth = getAuthority(caseItem.authorityId);
                  const typeCfg = CASE_TYPE_CONFIG[caseItem.caseType];
                  const priorityCfg = PRIORITY_CONFIG[caseItem.priority];
                  const statusCfg = STATUS_CONFIG[caseItem.status];
                  const days = getDaysUntilDue(caseItem.dueDate);
                  const TypeIcon = typeCfg?.icon || FileText;
                  const StatusIcon = statusCfg?.icon || Clock;

                  return (
                    <div key={caseItem.id} onClick={() => handleViewCase(caseItem)}
                      className={`bg-white rounded-2xl border-2 overflow-hidden cursor-pointer hover:shadow-lg transition-all ${caseItem.priority === 'Critical' && caseItem.status !== 'Closed' ? 'border-red-300 ring-2 ring-red-100' : 'border-slate-200 hover:border-cyan-300'
                        }`}>
                      <div className={`h-1.5 ${priorityCfg?.bg}`}></div>
                      <div className="p-5">
                        <div className="flex items-center justify-between mb-3">
                          <span className="font-mono text-sm font-bold text-cyan-600 bg-cyan-50 px-2 py-1 rounded">{caseItem.code}</span>
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${typeCfg?.light} ${typeCfg?.text}`}>
                            <TypeIcon className="w-3 h-3" />{typeCfg?.label}
                          </span> </div>
                        <h4 className="font-bold text-slate-800 line-clamp-2 mb-3">{caseItem.subject}</h4>
                        <div className="flex flex-wrap gap-2 mb-3">
                          <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold">{auth?.code}</span>
                          <span className={`px-2 py-1 rounded text-xs font-bold ${priorityCfg?.light} ${priorityCfg?.text}`}>{priorityCfg?.label}</span>
                        </div>
                        <div className="flex items-center gap-4 mb-4 text-sm">
                          <span className="flex items-center gap-1 text-blue-600">
                            <ArrowDownCircle className="w-4 h-4" />
                            {caseItem.messages?.filter(m => m.direction === 'Incoming').length || 0}
                          </span>
                          <span className="flex items-center gap-1 text-emerald-600">
                            <ArrowUpCircle className="w-4 h-4" />
                            {caseItem.messages?.filter(m => m.direction === 'Outgoing').length || 0}
                          </span> </div>
                        <div className="flex items-center justify-between pt-3 border-t border-slate-100">
                          <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${statusCfg?.bg} ${statusCfg?.text}`}>
                            <StatusIcon className="w-3 h-3" />{statusCfg?.label}
                          </span>
                          <span className={`text-xs font-bold ${days !== null && days < 0 ? 'text-red-600' : days !== null && days <= 7 ? 'text-amber-600' : 'text-slate-500'}`}>
                            {caseItem.dueDate}
                          </span> </div> </div> </div>);
                })}
              </div>
            )}
          </div>
        )}

        {activeTab === 'workspace' && selectedCase && (
          <div className="p-6">
            <div className={`rounded-2xl p-6 mb-6 border-2 ${PRIORITY_CONFIG[selectedCase.priority]?.light}`}>
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2 flex-wrap">
                    <span className="font-mono text-lg font-bold text-cyan-600 bg-cyan-100 px-3 py-1 rounded-lg">{selectedCase.code}</span>
                    <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-sm font-bold ${CASE_TYPE_CONFIG[selectedCase.caseType]?.light} ${CASE_TYPE_CONFIG[selectedCase.caseType]?.text}`}>
                      {React.createElement(CASE_TYPE_CONFIG[selectedCase.caseType]?.icon || FileText, { className: "w-4 h-4" })}
                      {CASE_TYPE_CONFIG[selectedCase.caseType]?.label}
                    </span>
                    <span className={`px-3 py-1 rounded-lg text-sm font-bold ${PRIORITY_CONFIG[selectedCase.priority]?.light} ${PRIORITY_CONFIG[selectedCase.priority]?.text}`}>
                      {PRIORITY_CONFIG[selectedCase.priority]?.label}
                    </span>
                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-lg text-sm font-bold ${STATUS_CONFIG[selectedCase.status]?.bg} ${STATUS_CONFIG[selectedCase.status]?.text}`}>
                      {React.createElement(STATUS_CONFIG[selectedCase.status]?.icon || Clock, { className: "w-4 h-4" })}
                      {STATUS_CONFIG[selectedCase.status]?.label}
                    </span>
                    {selectedCase.escalationLevel > 0 && (
                      <span className="flex items-center gap-1 px-3 py-1 bg-red-500 text-white rounded-lg text-sm font-bold animate-pulse">
                        <TrendingUp className="w-4 h-4" />ØªØµØ¹ÙŠØ¯ L{selectedCase.escalationLevel}
                      </span>
                    )}
                  </div>
                  <h2 className="text-xl font-bold text-slate-800 mb-2">{selectedCase.subject}</h2>
                  <div className="flex items-center gap-4 text-sm text-slate-600 flex-wrap">
                    <span className="flex items-center gap-1"><Building2 className="w-4 h-4" />{getAuthority(selectedCase.authorityId)?.nameAr}</span>
                    <span className="flex items-center gap-1"><User className="w-4 h-4" />{getUser(selectedCase.ownerId)?.name}</span>
                    <span className={`flex items-center gap-1 font-bold ${getDaysUntilDue(selectedCase.dueDate) < 0 ? 'text-red-600' : getDaysUntilDue(selectedCase.dueDate) <= 7 ? 'text-amber-600' : ''}`}>
                      <Calendar className="w-4 h-4" />{selectedCase.dueDate}
                    </span> </div> </div>
                <div className="flex items-center gap-2 flex-wrap">
                  {selectedCase.status === 'Open' && (
                    <button onClick={() => handleUpdateStatus(selectedCase, 'InProgress')}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600">
                      <Zap className="w-5 h-5" />Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„
                    </button>
                  )}
                  {selectedCase.status === 'InProgress' && (
                    <button onClick={handleAddMessage}
                      className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-xl font-bold hover:bg-purple-600">
                      <MessageSquare className="w-5 h-5" />Ø±Ø³Ø§Ù„Ø©
                    </button>
                  )}
                  {selectedCase.responsePack?.status === 'Draft' && (
                    <button onClick={handleApproveResponsePack}
                      className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                      <CheckCircle2 className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯
                    </button>
                  )}
                  {selectedCase.responsePack?.status === 'Approved' && selectedCase.status !== 'Submitted' && (
                    <button onClick={handleSubmitResponse}
                      className="flex items-center gap-2 px-4 py-2 bg-cyan-500 text-white rounded-xl font-bold hover:bg-cyan-600">
                      <Send className="w-5 h-5" />ØªÙ‚Ø¯ÙŠÙ…
                    </button>
                  )}
                  {selectedCase.status === 'Submitted' && (
                    <button onClick={() => handleUpdateStatus(selectedCase, 'Closed')}
                      className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                      <CheckCircle2 className="w-5 h-5" />Ø¥ØºÙ„Ø§Ù‚
                    </button>
                  )}
                  {selectedCase.status !== 'Closed' && selectedCase.escalationLevel < 3 && (
                    <button onClick={() => handleEscalate(selectedCase)}
                      className="flex items-center gap-2 px-4 py-2 border-2 border-red-500 text-red-500 rounded-xl font-bold hover:bg-red-50">
                      <TrendingUp className="w-5 h-5" />
                    </button>
                  )}
                  <button onClick={() => { setSelectedCase(null); setActiveTab('register'); }} className="p-2 hover:bg-slate-200 rounded-xl">
                    <X className="w-5 h-5 text-slate-500" />
                  </button> </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="flex border-b border-slate-200 overflow-x-auto bg-slate-50">
                {caseTabs.map(tab => (
                  <button key={tab.id} onClick={() => setCaseTab(tab.id)}
                    className={`flex items-center gap-2 px-5 py-3 font-bold transition-all border-b-2 whitespace-nowrap ${caseTab === tab.id ? 'text-cyan-600 border-cyan-500 bg-white' : 'text-slate-500 border-transparent hover:bg-white hover:text-slate-700'
                      }`}>
                    <tab.icon className="w-4 h-4" />{tab.label}
                  </button>
                ))}
              </div>

              <div className="p-6">
                {caseTab === 'summary' && (
                  <div className="grid grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><FileText className="w-5 h-5" />Ø§Ù„ÙˆØµÙ</h4>
                        <p className="text-slate-600 leading-relaxed">{selectedCase.description}</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Calendar className="w-5 h-5" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between py-2 border-b border-slate-200"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span><span className="font-bold">{selectedCase.receivedDate}</span></div>
                          <div className="flex justify-between py-2 border-b border-slate-200"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</span><span className="font-bold">{selectedCase.dueDate}</span></div>
                          {selectedCase.closedAt && (
                            <div className="flex justify-between py-2"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</span><span className="font-bold text-emerald-600">{selectedCase.closedAt}</span></div>
                          )}
                        </div> </div> </div>
                    <div className="space-y-4">
                      <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Users className="w-5 h-5" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-3">
                          {[
                            { label: 'Ø§Ù„Ù…Ø§Ù„Ùƒ', id: selectedCase.ownerId },
                            { label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', id: selectedCase.reviewerId },
                            { label: 'Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', id: selectedCase.approverId },
                          ].map(item => {
                            const user = getUser(item.id);
                            return (
                              <div key={item.label} className="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200">
                                <span className="text-slate-500">{item.label}</span>
                                {user ? <span className="font-bold text-slate-700">{user.name}</span> : <span className="text-slate-400">-</span>}
                              </div>);
                          })}
                        </div> </div>
                      <div className="bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-5 border border-cyan-200">
                        <h4 className="font-bold text-cyan-800 mb-3">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</h4>
                        <div className="grid grid-cols-2 gap-3">
                          <div className="bg-white rounded-lg p-3 text-center border border-slate-200">
                            <ArrowDownCircle className="w-6 h-6 text-blue-500 mx-auto mb-1" />
                            <span className="text-2xl font-bold text-slate-800">{selectedCase.messages?.filter(m => m.direction === 'Incoming').length || 0}</span>
                            <p className="text-xs text-slate-500">ÙˆØ§Ø±Ø¯Ø©</p>
                          </div>
                          <div className="bg-white rounded-lg p-3 text-center border border-slate-200">
                            <ArrowUpCircle className="w-6 h-6 text-emerald-500 mx-auto mb-1" />
                            <span className="text-2xl font-bold text-slate-800">{selectedCase.messages?.filter(m => m.direction === 'Outgoing').length || 0}</span>
                            <p className="text-xs text-slate-500">ØµØ§Ø¯Ø±Ø©</p>
                          </div> </div> </div> </div> </div>
                )}

                {caseTab === 'thread' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800 text-lg">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</h4>
                      <button onClick={handleAddMessage}
                        className="flex items-center gap-2 px-4 py-2 bg-cyan-500 text-white rounded-xl font-bold hover:bg-cyan-600">
                        <Plus className="w-5 h-5" />Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                      </button> </div>
                    {selectedCase.messages?.length > 0 ? (
                      <div className="relative">
                        <div className="absolute right-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-300 via-purple-300 to-emerald-300"></div>
                        <div className="space-y-4">
                          {selectedCase.messages.sort((a, b) => new Date(a.messageDate) - new Date(b.messageDate)).map((msg) => {
                            const isIncoming = msg.direction === 'Incoming';
                            const channelCfg = CHANNEL_CONFIG[msg.channel];
                            const ChannelIcon = channelCfg?.icon || Mail;
                            return (
                              <div key={msg.id} className="relative flex gap-4 pr-10">
                                <div className={`absolute right-4 w-5 h-5 rounded-full ${isIncoming ? 'bg-blue-500' : 'bg-emerald-500'} border-4 border-white shadow-lg z-10`}></div>
                                <div className={`flex-1 rounded-2xl p-5 ${isIncoming ? 'bg-blue-50 border-2 border-blue-200' : 'bg-emerald-50 border-2 border-emerald-200'}`}>
                                  <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2 flex-wrap">
                                      <span className={`flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold ${isIncoming ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                        {isIncoming ? <ArrowDownCircle className="w-3.5 h-3.5" /> : <ArrowUpCircle className="w-3.5 h-3.5" />}
                                        {isIncoming ? 'ÙˆØ§Ø±Ø¯' : 'ØµØ§Ø¯Ø±'}
                                      </span>
                                      <span className="flex items-center gap-1.5 px-3 py-1 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">
                                        <ChannelIcon className="w-3.5 h-3.5" />{channelCfg?.label}
                                      </span>
                                      <span className={`px-2 py-1 rounded-lg text-xs font-bold ${msg.status === 'Sent' ? 'bg-emerald-100 text-emerald-700' : msg.status === 'Received' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'}`}>
                                        {msg.status === 'Sent' ? 'Ù…Ø±Ø³Ù„' : msg.status === 'Received' ? 'Ù…Ø³ØªÙ„Ù…' : 'Ù…Ø³ÙˆØ¯Ø©'}
                                      </span>
                                      {msg.attachments > 0 && (
                                        <span className="flex items-center gap-1 px-2 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold">
                                          <Paperclip className="w-3 h-3" />{msg.attachments}
                                        </span>
                                      )}
                                    </div>
                                    <div className="flex items-center gap-2">
                                      <span className="text-sm text-slate-500 font-bold">{msg.messageDate}</span>
                                      <div className="flex items-center gap-1">
                                        {!isIncoming && msg.status === 'Draft' && (
                                          <button onClick={() => handleSendMessage(msg.id)} className="p-1.5 hover:bg-emerald-100 rounded-lg" title="Ø¥Ø±Ø³Ø§Ù„">
                                            <Send className="w-4 h-4 text-emerald-600" />
                                          </button>
                                        )}
                                        <button onClick={() => handleEditMessage(msg)} className="p-1.5 hover:bg-amber-100 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                                          <Edit className="w-4 h-4 text-amber-600" />
                                        </button>
                                        <button onClick={() => handleDeleteMessage(msg.id)} className="p-1.5 hover:bg-red-100 rounded-lg" title="Ø­Ø°Ù">
                                          <Trash2 className="w-4 h-4 text-red-600" />
                                        </button> </div> </div> </div>
                                  <div className="mb-3">
                                    <h5 className="font-bold text-slate-800">{msg.subject}</h5>
                                  </div>
                                  <div className="flex items-center gap-3 mb-3 text-sm text-slate-600">
                                    <span>Ù…Ù†: <strong>{msg.sender}</strong></span>
                                    <ChevronLeft className="w-4 h-4 text-slate-400" />
                                    <span>Ø¥Ù„Ù‰: <strong>{msg.recipient}</strong></span>
                                  </div>
                                  <p className="text-slate-700 bg-white rounded-lg p-3 border border-slate-200">{msg.summary}</p>
                                </div> </div>);
                          })}
                        </div> </div>
                    ) : (
                      <div className="text-center py-16 text-slate-400 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                        <MessageSquare className="w-16 h-16 mx-auto mb-4 opacity-50" />
                        <p className="text-lg font-bold mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø³Ø¬Ù„Ø©</p>
                        <p className="text-sm">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©</p>
                      </div>
                    )}
                  </div>
                )}

                {caseTab === 'linked' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800 text-lg">Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© - Golden Thread</h4>
                      <button onClick={handleAddLink} className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                        <Link2 className="w-5 h-5" />Ø±Ø¨Ø· ÙƒØ§Ø¦Ù†
                      </button> </div>
                    {selectedCase.linkedObjects?.length > 0 ? (
                      <div className="grid grid-cols-2 gap-4">
                        {selectedCase.linkedObjects.map((link, idx) => {
                          const linkCfg = LINK_TYPE_CONFIG[link.type];
                          const LinkIcon = linkCfg?.icon || Link2;
                          return (
                            <div key={idx} className={`rounded-xl border-2 p-4 ${linkCfg?.bg} hover:shadow-md transition-all`}>
                              <div className="flex items-start gap-4">
                                <div className="w-12 h-12 rounded-xl bg-white flex items-center justify-center shadow">
                                  <LinkIcon className="w-6 h-6 text-slate-600" />
                                </div>
                                <div className="flex-1 min-w-0">
                                  <div className="flex items-center gap-2 mb-1">
                                    <span className={`px-2 py-0.5 ${linkCfg?.bg} ${linkCfg?.text} rounded text-xs font-bold`}>{linkCfg?.label}</span>
                                    <span className="font-mono text-xs text-slate-500">{link.code}</span>
                                  </div>
                                  <p className="font-bold text-slate-800 truncate">{link.title}</p>
                                  <span className={`text-xs px-2 py-0.5 rounded mt-1 inline-block ${link.status === 'Active' || link.status === 'Passed' || link.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' :
                                    link.status === 'InProgress' || link.status === 'Scheduled' ? 'bg-blue-100 text-blue-700' :
                                      'bg-slate-100 text-slate-600'
                                    }`}>{link.status}</span>
                                </div>
                                <div className="flex items-center gap-1">
                                  <button onClick={() => handleEditLink(link, idx)} className="p-1.5 hover:bg-amber-100 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                                    <Edit className="w-4 h-4 text-amber-600" />
                                  </button>
                                  <button onClick={() => handleUnlinkObject(idx)} className="p-1.5 hover:bg-red-100 rounded-lg" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·">
                                    <Trash2 className="w-4 h-4 text-red-600" />
                                  </button> </div> </div> </div>);
                        })}
                      </div>
                    ) : (
                      <div className="text-center py-16 text-slate-400 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                        <Link2 className="w-16 h-16 mx-auto mb-4 opacity-50" />
                        <p className="text-lg font-bold mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø·</p>
                        <p className="text-sm mb-4">Ù‚Ù… Ø¨Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©</p>
                        <button onClick={handleAddLink} className="px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">Ø±Ø¨Ø· ÙƒØ§Ø¦Ù†</button>
                      </div>
                    )}
                  </div>
                )}

                {caseTab === 'response' && (
                  <div className="space-y-6">
                    {selectedCase.responsePack ? (
                      <>
                        <div className={`bg-gradient-to-r ${selectedCase.responsePack.status === 'Sent' ? 'from-emerald-50 to-teal-50 border-emerald-200' :
                          selectedCase.responsePack.status === 'Approved' ? 'from-blue-50 to-indigo-50 border-blue-200' :
                            'from-amber-50 to-orange-50 border-amber-200'
                          } rounded-2xl p-6 border-2`}>
                          <div className="flex items-center justify-between mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-3">
                              <Package className="w-6 h-6" />Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ - Response Pack
                            </h3>
                            <div className="flex items-center gap-2">
                              <span className={`px-4 py-2 rounded-xl text-sm font-bold ${selectedCase.responsePack.status === 'Sent' ? 'bg-emerald-500 text-white' :
                                selectedCase.responsePack.status === 'Approved' ? 'bg-blue-500 text-white' :
                                  'bg-amber-500 text-white'
                                }`}>
                                {selectedCase.responsePack.status === 'Sent' ? 'âœ“ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' :
                                  selectedCase.responsePack.status === 'Approved' ? 'âœ“ Ù…Ø¹ØªÙ…Ø¯' : 'â³ Ù…Ø³ÙˆØ¯Ø©'}
                              </span>
                              {selectedCase.responsePack.status === 'Draft' && (
                                <button onClick={handleDeleteResponsePack} className="p-2 hover:bg-red-100 rounded-xl" title="Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©">
                                  <Trash2 className="w-5 h-5 text-red-500" />
                                </button>
                              )}
                            </div> </div>
                          <div className="grid grid-cols-4 gap-4 mb-6">
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200 shadow-sm">
                              <ClipboardCheck className="w-10 h-10 text-emerald-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-slate-800">{selectedCase.responsePack.obligationsCount}</span>
                              <p className="text-sm text-slate-500">Ø§Ù„ØªØ²Ø§Ù… Ù…Ø´Ù…ÙˆÙ„</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200 shadow-sm">
                              <FileCheck className="w-10 h-10 text-blue-500 mx-auto mb-2" />
                              <span className="text-3xl font-bold text-slate-800">{selectedCase.responsePack.evidenceCount || 0}</span>
                              <p className="text-sm text-slate-500">Ø¯Ù„ÙŠÙ„ Ù…Ø±ÙÙ‚</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200 shadow-sm">
                              <User className="w-10 h-10 text-purple-500 mx-auto mb-2" />
                              <span className="text-lg font-bold text-slate-800">{getUser(selectedCase.responsePack.signedOffBy)?.name || '-'}</span>
                              <p className="text-sm text-slate-500">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</p>
                            </div>
                            <div className="bg-white rounded-xl p-4 text-center border border-slate-200 shadow-sm">
                              <Calendar className="w-10 h-10 text-amber-500 mx-auto mb-2" />
                              <span className="text-lg font-bold text-slate-800">{selectedCase.responsePack.signedOffAt || '-'}</span>
                              <p className="text-sm text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                            </div> </div>
                          <div className="flex items-center gap-3 flex-wrap">
                            {selectedCase.responsePack.status === 'Draft' && (
                              <>
                                <button onClick={handleAddEvidence} className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600">
                                  <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ù„Ø©
                                </button>
                                <button onClick={handleApproveResponsePack}
                                  className="flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                                  <CheckCircle2 className="w-5 h-5" />Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­Ø²Ù…Ø©
                                </button>
                              </>
                            )}
                            {selectedCase.responsePack.status === 'Approved' && (
                              <button onClick={handleSubmitResponse}
                                className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                                <Send className="w-5 h-5" />ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø±Ø¯ Ù„Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                              </button>
                            )}
                          </div> </div>
                        {selectedCase.responsePack.evidenceList?.length > 0 && (
                          <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                            <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                              <FileCheck className="w-5 h-5 text-blue-500" />Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø© ({selectedCase.responsePack.evidenceList.length})
                            </h4>
                            <div className="grid grid-cols-2 gap-3">
                              {selectedCase.responsePack.evidenceList.map((evidence) => (
                                <div key={evidence.id} className="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200">
                                  <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                                      <FileCheck className="w-5 h-5 text-blue-600" />
                                    </div>
                                    <div>
                                      <span className="font-mono text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded">{evidence.code}</span>
                                      <p className="font-bold text-slate-800 text-sm mt-1">{evidence.title}</p>
                                      <span className={`text-xs px-2 py-0.5 rounded ${evidence.status === 'Accepted' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>
                                        {evidence.status === 'Accepted' ? 'Ù…Ù‚Ø¨ÙˆÙ„' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                                      </span> </div> </div>
                                  {selectedCase.responsePack.status === 'Draft' && (
                                    <button onClick={() => handleRemoveEvidence(evidence.id)} className="p-2 hover:bg-red-100 rounded-lg" title="Ø¥Ø²Ø§Ù„Ø©">
                                      <Trash2 className="w-4 h-4 text-red-500" />
                                    </button>
                                  )}
                                </div>
                              ))}
                            </div> </div>
                        )}

                        {selectedCase.linkedObjects?.filter(l => l.type === 'Obligation').length > 0 && (
                          <div className="bg-white rounded-2xl p-6 border-2 border-slate-200">
                            <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                              <ClipboardCheck className="w-5 h-5 text-emerald-500" />Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø© ({selectedCase.linkedObjects.filter(l => l.type === 'Obligation').length})
                            </h4>
                            <div className="grid grid-cols-2 gap-3">
                              {selectedCase.linkedObjects.filter(l => l.type === 'Obligation').map((obl, idx) => (
                                <div key={idx} className="flex items-center gap-3 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                                  <div className="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center">
                                    <ClipboardCheck className="w-5 h-5 text-emerald-600" />
                                  </div>
                                  <div>
                                    <span className="font-mono text-xs text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded">{obl.code}</span>
                                    <p className="font-bold text-slate-800 text-sm mt-1">{obl.title}</p>
                                  </div> </div>
                              ))}
                            </div> </div>
                        )}
                      </>
                    ) : (
                      <div className="text-center py-16 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl border-2 border-amber-200">
                        <Package className="w-20 h-20 text-amber-400 mx-auto mb-4" />
                        <h3 className="text-2xl font-bold text-amber-800 mb-2">Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯</h3>
                        <p className="text-amber-600 mb-6">Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯ Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                        <button onClick={handleCreateResponsePack}
                          className="px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                          <Package className="w-5 h-5 inline ml-2" />Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø±Ø¯
                        </button> </div>
                    )}
                  </div>
                )}

                {caseTab === 'audit' && (
                  <div className="space-y-4">
                    <h4 className="font-bold text-slate-800 text-lg mb-4">Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ - Audit Trail</h4>
                    {selectedCase.auditTrail?.length > 0 ? (
                      <div className="relative">
                        <div className="absolute right-4 top-0 bottom-0 w-0.5 bg-slate-200"></div>
                        <div className="space-y-4">
                          {selectedCase.auditTrail.map((entry, idx) => (
                            <div key={idx} className="relative flex gap-4 pr-8">
                              <div className="absolute right-2 w-5 h-5 rounded-full bg-cyan-500 border-4 border-white shadow z-10 flex items-center justify-center">
                                <Check className="w-3 h-3 text-white" />
                              </div>
                              <div className="flex-1 bg-slate-50 rounded-xl p-4 border border-slate-200">
                                <div className="flex items-center justify-between mb-2">
                                  <span className="font-bold text-slate-800">{entry.action}</span>
                                  <span className="text-sm text-slate-500">{entry.date}</span>
                                </div>
                                <p className="text-slate-600 text-sm">{entry.details}</p>
                                <p className="text-xs text-slate-400 mt-2">Ø¨ÙˆØ§Ø³Ø·Ø©: {entry.user}</p>
                              </div> </div>
                          ))}
                        </div> </div>
                    ) : (
                      <div className="text-center py-12 text-slate-400">
                        <History className="w-12 h-12 mx-auto mb-2 opacity-50" />
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚</p>
                      </div>
                    )}
                  </div>
                )}
              </div> </div> </div>
        )}

        {activeTab === 'calendar' && (
          <div className="p-6">
            <h3 className="font-bold text-slate-800 text-lg mb-6">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
            <div className="grid grid-cols-4 gap-4">
              {[
                { key: 'overdue', label: 'Ù…ØªØ£Ø®Ø±', icon: AlertTriangle, color: 'red', filter: c => c.status !== 'Closed' && c.status !== 'Submitted' && getDaysUntilDue(c.dueDate) < 0 },
                { key: 'week', label: 'Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', icon: Clock, color: 'amber', filter: c => { const d = getDaysUntilDue(c.dueDate); return c.status !== 'Closed' && c.status !== 'Submitted' && d >= 0 && d <= 7; } },
                { key: 'month', label: 'Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±', icon: Calendar, color: 'blue', filter: c => { const d = getDaysUntilDue(c.dueDate); return c.status !== 'Closed' && c.status !== 'Submitted' && d > 7 && d <= 30; } },
                { key: 'completed', label: 'Ù…ÙƒØªÙ…Ù„', icon: CheckCircle2, color: 'emerald', filter: c => c.status === 'Closed' || c.status === 'Submitted' },
              ].map(section => {
                const SectionIcon = section.icon;
                const sectionCases = cases.filter(section.filter);
                return (
                  <div key={section.key} className={`bg-${section.color}-50 rounded-2xl p-5 border-2 border-${section.color}-200`}>
                    <h4 className={`font-bold text-${section.color}-800 mb-4 flex items-center gap-2`}>
                      <SectionIcon className="w-5 h-5" />{section.label}
                      <span className={`mr-auto px-2 py-0.5 bg-${section.color}-200 text-${section.color}-800 rounded-full text-xs font-bold`}>{sectionCases.length}</span>
                    </h4>
                    <div className="space-y-2 max-h-80 overflow-y-auto">
                      {sectionCases.map(c => {
                        const typeCfg = CASE_TYPE_CONFIG[c.caseType];
                        const TypeIcon = typeCfg?.icon || FileText;
                        return (
                          <div key={c.id} onClick={() => handleViewCase(c)} className="bg-white rounded-xl p-3 cursor-pointer hover:shadow-md transition-all border border-slate-200">
                            <div className="flex items-center gap-2 mb-1">
                              <span className="font-mono text-xs text-cyan-600 font-bold">{c.code}</span>
                              <TypeIcon className={`w-3 h-3 ${typeCfg?.text}`} />
                            </div>
                            <p className="text-sm font-bold text-slate-800 line-clamp-1">{c.subject}</p>
                            <p className={`text-xs font-bold mt-1 ${section.key === 'overdue' ? 'text-red-600' : section.key === 'week' ? 'text-amber-600' : 'text-slate-500'}`}>
                              {section.key === 'overdue' ? `Ù…ØªØ£Ø®Ø± ${Math.abs(getDaysUntilDue(c.dueDate))} ÙŠÙˆÙ…` :
                                section.key === 'completed' ? c.closedAt || c.dueDate :
                                  `${getDaysUntilDue(c.dueDate)} ÙŠÙˆÙ… - ${c.dueDate}`}
                            </p> </div>);
                      })}
                      {sectionCases.length === 0 && (
                        <p className="text-center text-slate-400 py-4 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§</p>
                      )}
                    </div> </div>);
              })}
            </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          REGULATORY CASE WIZARD - Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© - ULTIMATE 10-STEP EDITION
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showModal && formData && modalType === 'case' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden">
            <div className="bg-gradient-to-l from-cyan-500 via-blue-500 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                    <MessageSquare className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-black">{formData.id ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©' : 'ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¶ÙŠØ© ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©'}</h2>
                    <p className="text-cyan-200 font-mono text-sm">{formData.code}</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="relative w-16 h-16">
                    <svg className="w-16 h-16 transform -rotate-90">
                      <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.2)" strokeWidth="4" fill="none" />
                      <circle cx="32" cy="32" r="28" stroke="white" strokeWidth="4" fill="none"
                        strokeDasharray={`${(wizardStep / 9) * 176} 176`} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">
                      <span className="text-lg font-black">{wizardStep + 1}/10</span>
                    </div> </div>
                  <button onClick={() => { setShowModal(false); setWizardStep(0); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-5 h-5" />
                  </button> </div> </div>
              <div className="grid grid-cols-10 gap-1">
                {[
                  { step: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                  { step: 1, label: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Building2 },
                  { step: 2, label: 'Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©', icon: Tag },
                  { step: 3, label: 'Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', icon: Calendar },
                  { step: 4, label: 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„Ø£Ù‡Ù…ÙŠØ©', icon: AlertTriangle },
                  { step: 5, label: 'Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚', icon: Paperclip },
                  { step: 6, label: 'Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', icon: Link2 },
                  { step: 7, label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„ÙØ±ÙŠÙ‚', icon: Users },
                  { step: 8, label: 'Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©', icon: ClipboardList },
                  { step: 9, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', icon: CheckCircle2 },
                ].map((s) => (
                  <button key={s.step} onClick={() => setWizardStep(s.step)}
                    className={`flex flex-col items-center p-2 rounded-xl transition-all ${wizardStep === s.step ? 'bg-white text-blue-600' :
                      wizardStep > s.step ? 'bg-emerald-400/40 text-white' : 'bg-white/10 text-white/60 hover:bg-white/20'
                      }`}>
                    <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-1 ${wizardStep === s.step ? 'bg-blue-100' :
                      wizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                      }`}>
                      {wizardStep > s.step ? <Check className="w-4 h-4" /> : <s.icon className="w-4 h-4" />}
                    </div>
                    <span className="text-[9px] font-bold text-center leading-tight">{s.label}</span>
                  </button>
                ))}
              </div> </div>
            <div className="p-6 max-h-[50vh] overflow-y-auto">

              {wizardStep === 0 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-lg font-black text-blue-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm">1</span>
                      <FileText className="w-5 h-5" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ© *</label>
                        <input type="text" value={formData.subject || ''} onChange={(e) => setFormData({ ...formData, subject: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl text-lg font-bold focus:border-blue-500 focus:outline-none"
                          placeholder="Ù…Ø«Ø§Ù„: Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø¹ÙŠ" />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                          <input type="text" value={formData.officialRef || ''} onChange={(e) => setFormData({ ...formData, officialRef: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl"
                            placeholder="Ù…Ø«Ø§Ù„: 2025/REF/001" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</label>
                          <input type="text" value={formData.internalRef || ''} onChange={(e) => setFormData({ ...formData, internalRef: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl"
                            placeholder="Ù…Ø«Ø§Ù„: FILE-2025-001" />
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ *</label>
                        <textarea rows={3} value={formData.description || ''} onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª..." />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 1 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">2</span>
                      <Building2 className="w-5 h-5" />Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                    </h3>
                    <div className="grid grid-cols-4 gap-3">
                      {[
                        { id: 1, code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', color: 'emerald' },
                        { id: 2, code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', color: 'blue' },
                        { id: 3, code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', color: 'purple' },
                        { id: 4, code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', color: 'indigo' },
                        { id: 5, code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', color: 'amber' },
                        { id: 6, code: 'CCHI', name: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', color: 'teal' },
                        { id: 7, code: 'HRSD', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', color: 'rose' },
                        { id: 8, code: 'CITC', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', color: 'cyan' },
                      ].map(auth => (
                        <button key={auth.id} type="button" onClick={() => setFormData({ ...formData, authorityId: auth.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.authorityId === auth.id ? `border-${auth.color}-500 bg-${auth.color}-100` : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <div className={`w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center font-black text-lg ${formData.authorityId === auth.id ? `bg-${auth.color}-500 text-white` : 'bg-slate-100 text-slate-600'
                            }`}>{auth.code.substring(0, 2)}</div>
                          <p className="text-xs font-bold text-slate-700">{auth.name}</p>
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-5 border-2 border-purple-200">
                    <h3 className="text-lg font-black text-purple-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm">3</span>
                      <Tag className="w-5 h-5" />Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-3 gap-3">
                      {[
                        { id: 'Inquiry', label: 'Ø§Ø³ØªÙØ³Ø§Ø±', icon: 'â“', desc: 'Ø·Ù„Ø¨ ØªÙˆØ¶ÙŠØ­ Ø£Ùˆ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
                        { id: 'Inspection', label: 'ØªÙØªÙŠØ´', icon: 'ğŸ”', desc: 'Ø²ÙŠØ§Ø±Ø© ØªÙØªÙŠØ´ÙŠØ© Ø£Ùˆ ÙØ­Øµ' },
                        { id: 'ReportRequest', label: 'Ø·Ù„Ø¨ ØªÙ‚Ø±ÙŠØ±', icon: 'ğŸ“Š', desc: 'Ø·Ù„Ø¨ ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª' },
                        { id: 'ViolationNotice', label: 'Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®Ø§Ù„ÙØ©', icon: 'âš ï¸', desc: 'Ø¥Ø®Ø·Ø§Ø± Ø¨Ù…Ø®Ø§Ù„ÙØ© Ù…Ø­ØªÙ…Ù„Ø©' },
                        { id: 'Meeting', label: 'Ø§Ø¬ØªÙ…Ø§Ø¹', icon: 'ğŸ¤', desc: 'Ø·Ù„Ø¨ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø£Ùˆ Ù…Ù‚Ø§Ø¨Ù„Ø©' },
                        { id: 'Circular', label: 'ØªØ¹Ù…ÙŠÙ…', icon: 'ğŸ“¢', desc: 'ØªØ¹Ù…ÙŠÙ… Ø£Ùˆ Ø¥Ø¹Ù„Ø§Ù† Ø±Ø³Ù…ÙŠ' },
                        { id: 'Complaint', label: 'Ø´ÙƒÙˆÙ‰', icon: 'ğŸ“', desc: 'Ø´ÙƒÙˆÙ‰ Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø·Ø±Ù' },
                        { id: 'License', label: 'ØªØ±Ø®ÙŠØµ', icon: 'ğŸ“œ', desc: 'Ø·Ù„Ø¨ ØªØ±Ø®ÙŠØµ Ø£Ùˆ ØªØ¬Ø¯ÙŠØ¯' },
                        { id: 'Other', label: 'Ø£Ø®Ø±Ù‰', icon: 'ğŸ“Œ', desc: 'Ù†ÙˆØ¹ Ø¢Ø®Ø± Ù…Ù† Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§' },
                      ].map(type => (
                        <button key={type.id} type="button" onClick={() => setFormData({ ...formData, caseType: type.id })}
                          className={`p-4 rounded-xl border-2 transition-all text-center ${formData.caseType === type.id ? 'border-purple-500 bg-purple-100' : 'border-slate-200 hover:border-purple-300'
                            }`}>
                          <div className="text-3xl mb-2">{type.icon}</div>
                          <p className="font-bold text-slate-800 text-sm">{type.label}</p>
                          <p className="text-xs text-slate-500 mt-1">{type.desc}</p>
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                    <h3 className="text-lg font-black text-amber-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center text-sm">4</span>
                      <Calendar className="w-5 h-5" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                    </h3>
                    <div className="grid grid-cols-3 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… *</label>
                        <input type="date" value={formData.receivedDate || ''} onChange={(e) => setFormData({ ...formData, receivedDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                        <input type="date" value={formData.dueDate || ''} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500" />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø±Ø¯</label>
                        <input type="date" value={formData.responseDeadline || ''} onChange={(e) => setFormData({ ...formData, responseDeadline: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                      </div> </div>
                    <div className="mt-4 grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø£ÙŠØ§Ù… Ø§Ù„ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                        <select value={formData.reminderDays || ''} onChange={(e) => setFormData({ ...formData, reminderDays: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">Ø¨Ø¯ÙˆÙ† ØªØ°ÙƒÙŠØ±</option>
                          <option value="1">ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</option>
                          <option value="3">3 Ø£ÙŠØ§Ù…</option>
                          <option value="7">Ø£Ø³Ø¨ÙˆØ¹</option>
                          <option value="14">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„Ø¥Ù†Ø¬Ø§Ø²</label>
                        <input type="number" value={formData.estimatedDays || ''} onChange={(e) => setFormData({ ...formData, estimatedDays: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…" />
                      </div> </div> </div> </div>
              )}

              {wizardStep === 4 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-red-50 to-orange-50 rounded-2xl p-5 border-2 border-red-200">
                    <h3 className="text-lg font-black text-red-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-red-500 text-white rounded-lg flex items-center justify-center text-sm">5</span>
                      <AlertTriangle className="w-5 h-5" />Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„Ø£Ù‡Ù…ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© *</label>
                        <div className="space-y-2">
                          {[
                            { id: 'Critical', label: 'Ø­Ø±Ø¬', color: 'red', desc: 'ÙŠØªØ·Ù„Ø¨ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©' },
                            { id: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', desc: 'ÙŠØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù… Ø¹Ø§Ø¬Ù„' },
                            { id: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', desc: 'Ø¶Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ' },
                            { id: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'emerald', desc: 'Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©' },
                          ].map(pri => (
                            <button key={pri.id} type="button" onClick={() => setFormData({ ...formData, priority: pri.id })}
                              className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${formData.priority === pri.id ? `border-${pri.color}-500 bg-${pri.color}-100` : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className={`w-4 h-4 rounded-full bg-${pri.color}-500`}></div>
                              <div className="flex-1 text-right">
                                <p className="font-bold text-slate-800">{pri.label}</p>
                                <p className="text-xs text-slate-500">{pri.desc}</p>
                              </div>
                              {formData.priority === pri.id && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø­ØªÙ…Ù„</label>
                        <div className="space-y-2">
                          {[
                            { id: 'Regulatory', label: 'ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: 'âš–ï¸' },
                            { id: 'Financial', label: 'Ù…Ø§Ù„ÙŠ', icon: 'ğŸ’°' },
                            { id: 'Operational', label: 'ØªØ´ØºÙŠÙ„ÙŠ', icon: 'âš™ï¸' },
                            { id: 'Reputational', label: 'Ø³Ù…Ø¹Ø©', icon: 'ğŸ“‰' },
                            { id: 'Legal', label: 'Ù‚Ø§Ù†ÙˆÙ†ÙŠ', icon: 'ğŸ“œ' },
                          ].map(impact => {
                            const isSelected = formData.potentialImpact?.includes(impact.id);
                            return (
                              <button key={impact.id} type="button" onClick={() => {
                                const current = formData.potentialImpact || [];
                                setFormData({ ...formData, potentialImpact: isSelected ? current.filter(i => i !== impact.id) : [...current, impact.id] });
                              }}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${isSelected ? 'border-red-500 bg-red-100' : 'border-slate-200 hover:border-slate-300'
                                  }`}>
                                <span className="text-xl">{impact.icon}</span>
                                <span className="font-bold text-slate-800 flex-1 text-right">{impact.label}</span>
                                {isSelected && <CheckCircle2 className="w-5 h-5 text-red-500" />}
                              </button>);
                          })}
                        </div> </div> </div> </div> </div>
              )}

              {wizardStep === 5 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-2xl p-5 border-2 border-indigo-200">
                    <h3 className="text-lg font-black text-indigo-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-indigo-500 text-white rounded-lg flex items-center justify-center text-sm">6</span>
                      <Paperclip className="w-5 h-5" />Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚
                    </h3>
                    <div className="border-2 border-dashed border-indigo-300 rounded-xl p-8 text-center bg-white">
                      <Upload className="w-12 h-12 text-indigo-400 mx-auto mb-3" />
                      <p className="font-bold text-slate-700 mb-1">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø±ÙØ¹</p>
                      <p className="text-sm text-slate-500">PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB)</p>
                      <button type="button" className="mt-4 px-6 py-2 bg-indigo-500 text-white rounded-lg font-bold hover:bg-indigo-600">
                        Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
                      </button> </div>
                    <div className="mt-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</label>
                      <textarea rows={2} value={formData.attachmentNotes || ''} onChange={(e) => setFormData({ ...formData, attachmentNotes: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                        placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª..." />
                    </div> </div> </div>
              )}

              {wizardStep === 6 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-2xl p-5 border-2 border-teal-200">
                    <h3 className="text-lg font-black text-teal-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-teal-500 text-white rounded-lg flex items-center justify-center text-sm">7</span>
                      <Link2 className="w-5 h-5" />Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø·
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·</label>
                        <select value={formData.linkedObligationId || ''} onChange={(e) => setFormData({ ...formData, linkedObligationId: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø§Ø®ØªØ± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</option>
                          {INITIAL_OBLIGATIONS.filter(o => !formData.authorityId || o.authorityId === formData.authorityId).map(o =>
                            <option key={o.id} value={o.id}>{o.code} - {o.title}</option>
                          )}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·</label>
                        <select value={formData.linkedControlId || ''} onChange={(e) => setFormData({ ...formData, linkedControlId: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                          <option value="">Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø§Ø®ØªØ± Ø§Ù„Ø¶Ø§Ø¨Ø·</option>
                          {CONTROLS.map(c => <option key={c.id} value={c.id}>{c.code} - {c.title}</option>)}
                        </select>
                      </div> </div>
                    <div className="mt-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ø¨Ø· Ø¨Ù‚Ø¶Ø§ÙŠØ§ Ø³Ø§Ø¨Ù‚Ø©</label>
                      <input type="text" value={formData.relatedCases || ''} onChange={(e) => setFormData({ ...formData, relatedCases: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl"
                        placeholder="Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)" />
                    </div> </div> </div>
              )}

              {wizardStep === 7 && (
                <div className="grid grid-cols-3 gap-5">
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border-2 border-blue-200">
                    <h3 className="text-base font-black text-blue-800 mb-3 flex items-center gap-2">
                      <User className="w-5 h-5" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                    </h3>
                    <div className="space-y-2">
                      {COMM_USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, ownerId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.ownerId === user.id ? 'border-blue-500 bg-blue-100' : 'border-slate-200 hover:border-blue-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.ownerId === user.id ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                            <p className="text-xs text-slate-500">{user.role}</p>
                          </div>
                          {formData.ownerId === user.id && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border-2 border-amber-200">
                    <h3 className="text-base font-black text-amber-800 mb-3 flex items-center gap-2">
                      <UserCheck className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
                    </h3>
                    <div className="space-y-2">
                      {COMM_USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, reviewerId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.reviewerId === user.id ? 'border-amber-500 bg-amber-100' : 'border-slate-200 hover:border-amber-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.reviewerId === user.id ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                          </div>
                          {formData.reviewerId === user.id && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-base font-black text-emerald-800 mb-3 flex items-center gap-2">
                      <Award className="w-5 h-5" />Ø§Ù„Ù…Ø¹ØªÙ…Ø¯
                    </h3>
                    <div className="space-y-2">
                      {COMM_USERS.map(user => (
                        <div key={user.id} onClick={() => setFormData({ ...formData, approverId: user.id })}
                          className={`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${formData.approverId === user.id ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 hover:border-emerald-300'
                            }`}>
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold ${formData.approverId === user.id ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'
                            }`}>{user.name.charAt(0)}</div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800 text-sm">{user.name}</p>
                          </div>
                          {formData.approverId === user.id && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                        </div>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 8 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-violet-50 to-purple-50 rounded-2xl p-5 border-2 border-violet-200">
                    <h3 className="text-lg font-black text-violet-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-violet-500 text-white rounded-lg flex items-center justify-center text-sm">9</span>
                      <ClipboardList className="w-5 h-5" />Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„ØªÙ†ÙÙŠØ°
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</label>
                        <div className="grid grid-cols-3 gap-3">
                          {[
                            { id: 'Immediate', label: 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©', icon: 'âš¡' },
                            { id: 'Scheduled', label: 'Ù…Ø¬Ø¯ÙˆÙ„Ø©', icon: 'ğŸ“…' },
                            { id: 'Escalate', label: 'ØªØµØ¹ÙŠØ¯', icon: 'â¬†ï¸' },
                          ].map(strategy => (
                            <button key={strategy.id} type="button" onClick={() => setFormData({ ...formData, responseStrategy: strategy.id })}
                              className={`p-3 rounded-xl border-2 transition-all text-center ${formData.responseStrategy === strategy.id ? 'border-violet-500 bg-violet-100' : 'border-slate-200 hover:border-violet-300'
                                }`}>
                              <span className="text-2xl">{strategy.icon}</span>
                              <p className="font-bold text-slate-800 text-sm mt-1">{strategy.label}</p>
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</label>
                        <textarea rows={3} value={formData.responseSteps || ''} onChange={(e) => setFormData({ ...formData, responseSteps: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                          placeholder="1. Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨&#10;2. Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©&#10;3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø¯" />
                      </div>
                      <div className="p-4 bg-white rounded-xl border border-slate-200">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input type="checkbox" checked={formData.requiresEscalation || false} onChange={(e) => setFormData({ ...formData, requiresEscalation: e.target.checked })}
                            className="w-5 h-5 rounded text-violet-500" />
                          <span className="font-bold text-slate-700">ÙŠØªØ·Ù„Ø¨ ØªØµØ¹ÙŠØ¯ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</span>
                        </label>
                      </div> </div> </div> </div>
              )}

              {wizardStep === 9 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border-2 border-emerald-200">
                    <h3 className="text-lg font-black text-emerald-800 mb-4 flex items-center gap-2">
                      <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm">10</span>
                      <CheckCircle2 className="w-5 h-5" />Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><FileText className="w-4 h-4 text-blue-500" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯:</span><span className="font-bold">{formData.code}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</span><span className="font-bold truncate max-w-32">{formData.subject || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù†ÙˆØ¹:</span><span className="font-bold">{formData.caseType || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Building2 className="w-4 h-4 text-emerald-500" />Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø¬Ù‡Ø©:</span><span className="font-bold">{getAuthority(formData.authorityId)?.code || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</span><span className="font-bold">{formData.priority || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Calendar className="w-4 h-4 text-amber-500" />Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</span><span className="font-bold">{formData.receivedDate || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span><span className="font-bold">{formData.dueDate || '-'}</span></div>
                        </div> </div>
                      <div className="bg-white rounded-xl p-4 border border-slate-200">
                        <h4 className="font-bold text-slate-700 mb-2 text-sm flex items-center gap-1"><Users className="w-4 h-4 text-purple-500" />Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span><span className="font-bold">{getUser(formData.ownerId)?.name || '-'}</span></div>
                          <div className="flex justify-between"><span className="text-slate-500">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹:</span><span className="font-bold">{getUser(formData.reviewerId)?.name || '-'}</span></div>
                        </div> </div> </div>
                    <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200">
                      <h4 className="font-bold text-slate-700 mb-2 text-sm">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                      <div className="grid grid-cols-3 gap-2">
                        {[
                          { label: 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹', valid: formData.subject?.length >= 5 },
                          { label: 'Ø§Ù„Ø¬Ù‡Ø©', valid: !!formData.authorityId },
                          { label: 'Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©', valid: !!formData.caseType },
                          { label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚', valid: !!formData.dueDate },
                          { label: 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©', valid: !!formData.priority },
                          { label: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', valid: !!formData.ownerId },
                        ].map((check, idx) => (
                          <div key={idx} className={`flex items-center gap-1 p-1.5 rounded-lg text-xs ${check.valid ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                            {check.valid ? <CheckCircle2 className="w-3 h-3" /> : <XCircle className="w-3 h-3" />}
                            <span className="font-bold">{check.label}</span>
                          </div>
                        ))}
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => wizardStep > 0 ? setWizardStep(wizardStep - 1) : setShowModal(false)}
                className="flex items-center gap-2 px-5 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                <ChevronRight className="w-4 h-4" />
                {wizardStep === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
              </button>

              <div className="flex items-center gap-1">
                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(step => (
                  <div key={step} className={`w-2 h-2 rounded-full transition-all ${wizardStep === step ? 'bg-blue-500 w-4' : wizardStep > step ? 'bg-emerald-500' : 'bg-slate-300'}`} />
                ))}
              </div>

              {wizardStep < 9 ? (
                <button onClick={() => setWizardStep(wizardStep + 1)}
                  className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-bold shadow-lg">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-4 h-4" />
                </button>
              ) : (
                <button onClick={handleSave}
                  disabled={!formData.subject || !formData.authorityId || !formData.dueDate}
                  className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                  <CheckCircle2 className="w-4 h-4" />{formData.id ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©'}
                </button>
              )}
            </div> </div> </div>
      )}

      {showModal && formData && modalType === 'message' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <MessageSquare className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">{formData.id ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©'}</h2>
                    <p className="text-purple-200">Communication Thread</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ *</label>
                  <div className="flex gap-3">
                    <button onClick={() => setFormData({ ...formData, direction: 'Incoming' })}
                      className={`flex-1 flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all ${formData.direction === 'Incoming' ? 'border-blue-500 bg-blue-100' : 'border-slate-200 bg-white hover:border-blue-300'
                        }`}>
                      <ArrowDownCircle className={`w-5 h-5 ${formData.direction === 'Incoming' ? 'text-blue-600' : 'text-slate-400'}`} />
                      <span className="font-bold">ÙˆØ§Ø±Ø¯</span>
                    </button>
                    <button onClick={() => setFormData({ ...formData, direction: 'Outgoing' })}
                      className={`flex-1 flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all ${formData.direction === 'Outgoing' ? 'border-emerald-500 bg-emerald-100' : 'border-slate-200 bg-white hover:border-emerald-300'
                        }`}>
                      <ArrowUpCircle className={`w-5 h-5 ${formData.direction === 'Outgoing' ? 'text-emerald-600' : 'text-slate-400'}`} />
                      <span className="font-bold">ØµØ§Ø¯Ø±</span>
                    </button> </div> </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ù‚Ù†Ø§Ø© *</label>
                  <select value={formData.channel || ''} onChange={(e) => setFormData({ ...formData, channel: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    {Object.entries(CHANNEL_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© *</label>
                <input type="text" value={formData.subject || ''} onChange={(e) => setFormData({ ...formData, subject: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                  placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©..." />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø±Ø³Ù„</label>
                  <input type="text" value={formData.sender || ''} onChange={(e) => setFormData({ ...formData, sender: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                  <input type="text" value={formData.recipient || ''} onChange={(e) => setFormData({ ...formData, recipient: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                <input type="date" value={formData.messageDate || ''} onChange={(e) => setFormData({ ...formData, messageDate: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© *</label>
                <textarea rows={3} value={formData.summary || ''} onChange={(e) => setFormData({ ...formData, summary: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none resize-none"
                  placeholder="Ù…Ù„Ø®Øµ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©..." />
              </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} disabled={!formData.subject || !formData.summary}
                className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50">
                {formData.id ? <Save className="w-5 h-5" /> : <Plus className="w-5 h-5" />}{formData.id ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø©'}
              </button> </div> </div> </div>
      )}

      {showModal && formData && modalType === 'link' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Link2 className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">{formData._idx !== undefined ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø·' : 'Ø±Ø¨Ø· ÙƒØ§Ø¦Ù† Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="text-indigo-200">Golden Thread Connection</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„ÙƒØ§Ø¦Ù† *</label>
                <div className="grid grid-cols-3 gap-3">
                  {Object.entries(LINK_TYPE_CONFIG).map(([key, cfg]) => {
                    const TypeIcon = cfg.icon;
                    const isSelected = formData.type === key;
                    return (
                      <button key={key} type="button" onClick={() => setFormData({ ...formData, type: key })}
                        className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${isSelected ? `border-indigo-500 ${cfg.bg}` : 'border-slate-200 bg-white hover:border-slate-300'
                          }`}>
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${isSelected ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-500'}`}>
                          <TypeIcon className="w-5 h-5" />
                        </div>
                        <span className={`text-sm font-bold ${isSelected ? cfg.text : 'text-slate-600'}`}>{cfg.label}</span>
                      </button>);
                  })}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ø¦Ù† *</label>
                <input type="text" value={formData.code || ''} onChange={(e) => setFormData({ ...formData, code: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-400 focus:outline-none"
                  placeholder={formData.type === 'Obligation' ? 'OBL-001' : formData.type === 'Breach' ? 'BRH-001' : formData.type === 'CAPA' ? 'CAPA-001' : formData.type === 'Test' ? 'TST-001' : 'CHG-001'} />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ø¦Ù† *</label>
                <input type="text" value={formData.title || ''} onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-400 focus:outline-none"
                  placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø¦Ù†</label>
                <div className="flex flex-wrap gap-2">
                  {['Active', 'InProgress', 'Completed', 'Passed', 'Failed', 'Scheduled', 'Closed'].map(status => {
                    const isSelected = formData.status === status;
                    const statusLabels = { Active: 'Ù†Ø´Ø·', InProgress: 'Ø¬Ø§Ø±ÙŠ', Completed: 'Ù…ÙƒØªÙ…Ù„', Passed: 'Ù†Ø§Ø¬Ø­', Failed: 'ÙØ§Ø´Ù„', Scheduled: 'Ù…Ø¬Ø¯ÙˆÙ„', Closed: 'Ù…ØºÙ„Ù‚' };
                    return (
                      <button key={status} type="button" onClick={() => setFormData({ ...formData, status })}
                        className={`px-4 py-2 rounded-xl text-sm font-bold transition-all ${isSelected ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                          }`}>
                        {statusLabels[status]}
                      </button>);
                  })}
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} disabled={!formData.code || !formData.title}
                className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50">
                {formData._idx !== undefined ? <Save className="w-5 h-5" /> : <Link2 className="w-5 h-5" />}
                {formData._idx !== undefined ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø±Ø¨Ø· Ø§Ù„ÙƒØ§Ø¦Ù†'}
              </button> </div> </div> </div>
      )}

      {showModal && formData && modalType === 'evidence' && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-xl overflow-hidden">
            <div className="bg-gradient-to-l from-blue-500 to-cyan-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <FileCheck className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯Ù„ÙŠÙ„ Ù„Ù„Ø­Ø²Ù…Ø©</h2>
                    <p className="text-cyan-200">Evidence Pack Builder</p>
                  </div> </div>
                <button onClick={() => setShowModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„</label>
                <div className="grid grid-cols-4 gap-2">
                  {[
                    { key: 'Document', label: 'Ù…Ø³ØªÙ†Ø¯', icon: FileText },
                    { key: 'Report', label: 'ØªÙ‚Ø±ÙŠØ±', icon: FileCheck },
                    { key: 'Screenshot', label: 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', icon: Eye },
                    { key: 'Log', label: 'Ø³Ø¬Ù„', icon: History }
                  ].map(type => {
                    const TypeIcon = type.icon;
                    const isSelected = formData.evidenceType === type.key;
                    return (
                      <button key={type.key} type="button" onClick={() => setFormData({ ...formData, evidenceType: type.key })}
                        className={`flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all ${isSelected ? 'border-blue-500 bg-blue-50' : 'border-slate-200 bg-white hover:border-slate-300'
                          }`}>
                        <TypeIcon className={`w-5 h-5 ${isSelected ? 'text-blue-600' : 'text-slate-400'}`} />
                        <span className={`text-xs font-bold ${isSelected ? 'text-blue-700' : 'text-slate-600'}`}>{type.label}</span>
                      </button>);
                  })}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ù„ÙŠÙ„ *</label>
                <input type="text" value={formData.evidenceCode || ''} onChange={(e) => setFormData({ ...formData, evidenceCode: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none"
                  placeholder="EVD-001" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ù„ÙŠÙ„ *</label>
                <input type="text" value={formData.evidenceTitle || ''} onChange={(e) => setFormData({ ...formData, evidenceTitle: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none"
                  placeholder="Ù…Ø«Ø§Ù„: Ø³ÙŠØ§Ø³Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„</label>
                <div className="flex gap-3">
                  <button type="button" onClick={() => setFormData({ ...formData, evidenceStatus: 'Accepted' })}
                    className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${formData.evidenceStatus === 'Accepted' ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 bg-white hover:border-emerald-300'
                      }`}>
                    <CheckCircle2 className={`w-5 h-5 ${formData.evidenceStatus === 'Accepted' ? 'text-emerald-600' : 'text-slate-400'}`} />
                    <span className="font-bold">Ù…Ù‚Ø¨ÙˆÙ„</span>
                  </button>
                  <button type="button" onClick={() => setFormData({ ...formData, evidenceStatus: 'Pending' })}
                    className={`flex-1 flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${formData.evidenceStatus === 'Pending' ? 'border-amber-500 bg-amber-50' : 'border-slate-200 bg-white hover:border-amber-300'
                      }`}>
                    <Clock className={`w-5 h-5 ${formData.evidenceStatus === 'Pending' ? 'text-amber-600' : 'text-slate-400'}`} />
                    <span className="font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                  </button> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleSave} disabled={!formData.evidenceCode || !formData.evidenceTitle}
                className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-50">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ù„ÙŠÙ„
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 4.10: Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªÙØªÙŠØ´ ÙˆÙ…ØµÙ†Ø¹ Ø­Ø²Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ
// Inspection Readiness & Regulator Submission Factory - ENTERPRISE EDITION
// Features: Authority Inspection Mode, Gap Analysis, Pack Generator, Hard Gates

const InspectionReadiness = () => {
  const { can, currentUser, guardAction } = useAuth();

  const [activeTab, setActiveTab] = useState('dashboard');
  const [selectedAuthority, setSelectedAuthority] = useState(null);
  const [selectedSession, setSelectedSession] = useState(null);
  const [showPackModal, setShowPackModal] = useState(false);
  const [showSessionModal, setShowSessionModal] = useState(false);
  const [generatingPack, setGeneratingPack] = useState(false);
  const [notification, setNotification] = useState(null);
  const [packStep, setPackStep] = useState(0);

  // DOA Approval Workflow States (Module 0.6)
  const [showExportApprovalModal, setShowExportApprovalModal] = useState(false);
  const [exportApprovalNotes, setExportApprovalNotes] = useState('');
  const [exportType, setExportType] = useState(null); // 'zip' | 'pdf' | 'excel'

  // PACK GENERATOR WIZARD - State & Modal Control
  const [showPackGenerator, setShowPackGenerator] = useState(false);
  const [packGeneratorPreselect, setPackGeneratorPreselect] = useState(null);
  const [submissionArchive, setSubmissionArchive] = useState([
    { id: 1, packId: 'SA-SAMA-CYBER-PACK-V1-1704067200', authority: 'SAMA', sessionCode: 'INS-2024-Q4-001', approvedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', generatedAt: '2024-12-15T10:30:00Z', exportCount: 3 },
    { id: 2, packId: 'SA-NCA-ECC-PACK-V1-1701388800', authority: 'NCA', sessionCode: 'INS-2024-Q4-002', approvedBy: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', generatedAt: '2024-11-30T14:20:00Z', exportCount: 2 },
  ]);

  // PACK GENERATOR - Mock API / In-Memory DB (Scoped to Module 4.10 ONLY)
  const PACK_API = {
    // SAMA Cyber Pack V1 - Obligations Seed Data
    obligations: [
      { id: 1, code: 'SAMA-CYB-001', title: 'Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Governance Framework', severity: 'Critical', domain: 'GOV', evidenceStatus: 'Accepted', evidenceId: 'EVD-001' },
      { id: 2, code: 'SAMA-CYB-002', title: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª CISO', titleEn: 'CISO Appointment', severity: 'Critical', domain: 'GOV', evidenceStatus: 'Accepted', evidenceId: 'EVD-002' },
      { id: 3, code: 'SAMA-CYB-003', title: 'Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©', titleEn: 'Approved Cyber Policies', severity: 'Critical', domain: 'GOV', evidenceStatus: 'Missing', evidenceId: null },
      { id: 4, code: 'SAMA-CYB-004', title: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠ', titleEn: 'Annual Security Awareness Program', severity: 'High', domain: 'GOV', evidenceStatus: 'Accepted', evidenceId: 'EVD-004' },
      { id: 5, code: 'SAMA-CYB-005', title: 'ØªØ·Ø¨ÙŠÙ‚ MFA Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', titleEn: 'MFA for Critical Systems', severity: 'Critical', domain: 'ACC', evidenceStatus: 'Accepted', evidenceId: 'EVD-005' },
      { id: 6, code: 'SAMA-CYB-006', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', titleEn: 'Periodic Access Review', severity: 'High', domain: 'ACC', evidenceStatus: 'PendingReview', evidenceId: 'EVD-006' },
      { id: 7, code: 'SAMA-CYB-007', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© PAM', titleEn: 'Privileged Access Management', severity: 'Critical', domain: 'ACC', evidenceStatus: 'Accepted', evidenceId: 'EVD-007' },
      { id: 8, code: 'SAMA-CYB-008', title: 'ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… SoD', titleEn: 'Segregation of Duties', severity: 'Critical', domain: 'ACC', evidenceStatus: 'Expired', evidenceId: 'EVD-008' },
      { id: 9, code: 'SAMA-CYB-009', title: 'Ù…Ø±ÙƒØ² Ø¹Ù…Ù„ÙŠØ§Øª Ø£Ù…Ù†ÙŠØ© SOC 24/7', titleEn: 'Security Operations Center 24/7', severity: 'Critical', domain: 'MON', evidenceStatus: 'Accepted', evidenceId: 'EVD-009' },
      { id: 10, code: 'SAMA-CYB-010', title: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª SIEM Ù„Ù…Ø¯Ø© Ø³Ù†Ø©', titleEn: 'SIEM Retention 1 Year', severity: 'High', domain: 'MON', evidenceStatus: 'Accepted', evidenceId: 'EVD-010' },
      { id: 11, code: 'SAMA-CYB-011', title: 'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ø®ØªØ±Ø§Ù‚ Ù†ØµÙ Ø³Ù†ÙˆÙŠØ©', titleEn: 'Semi-Annual Penetration Tests', severity: 'Critical', domain: 'MON', evidenceStatus: 'Accepted', evidenceId: 'EVD-011' },
      { id: 12, code: 'SAMA-CYB-012', title: 'ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ', titleEn: 'Monthly Vulnerability Scans', severity: 'Medium', domain: 'MON', evidenceStatus: 'Accepted', evidenceId: 'EVD-012' },
      { id: 13, code: 'SAMA-CYB-013', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', titleEn: 'Incident Reporting within 72h', severity: 'Critical', domain: 'INC', evidenceStatus: 'Accepted', evidenceId: 'EVD-013' },
      { id: 14, code: 'SAMA-CYB-014', title: 'Ø®Ø·Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ù…Ø®ØªØ¨Ø±Ø©', titleEn: 'Tested Incident Response Plan', severity: 'Critical', domain: 'INC', evidenceStatus: 'Accepted', evidenceId: 'EVD-014' },
      { id: 15, code: 'SAMA-CYB-015', title: 'ØªÙ‚ÙŠÙŠÙ… Ø£Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†', titleEn: 'Vendor Security Assessment', severity: 'High', domain: 'TPR', evidenceStatus: 'Missing', evidenceId: null },
    ],
    // Evidence Samples
    evidence: [
      { id: 'EVD-001', title: 'Ù…Ø­Ø¶Ø± Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥Ø·Ø§Ø± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', status: 'Accepted', uploadDate: '2025-01-10', expiryDate: '2026-01-10', fileType: 'PDF' },
      { id: 'EVD-002', title: 'Ø®Ø·Ø§Ø¨ ØªØ¹ÙŠÙŠÙ† CISO', status: 'Accepted', uploadDate: '2024-06-01', expiryDate: null, fileType: 'PDF' },
      { id: 'EVD-004', title: 'Ø³Ø¬Ù„ Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠ', status: 'Accepted', uploadDate: '2025-01-15', expiryDate: '2026-01-15', fileType: 'XLSX' },
      { id: 'EVD-005', title: 'ØªÙ‚Ø±ÙŠØ± MFA Ù…Ù† Azure AD', status: 'Accepted', uploadDate: '2025-01-20', expiryDate: '2025-04-20', fileType: 'PDF' },
      { id: 'EVD-006', title: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', status: 'PendingReview', uploadDate: '2025-02-01', expiryDate: '2025-05-01', fileType: 'XLSX' },
      { id: 'EVD-007', title: 'ØªÙ‚Ø±ÙŠØ± PAM CyberArk', status: 'Accepted', uploadDate: '2025-01-18', expiryDate: '2025-07-18', fileType: 'PDF' },
      { id: 'EVD-008', title: 'Ù…ØµÙÙˆÙØ© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…', status: 'Expired', uploadDate: '2024-01-15', expiryDate: '2025-01-15', fileType: 'XLSX' },
      { id: 'EVD-009', title: 'Ø´Ù‡Ø§Ø¯Ø© SOC 24/7', status: 'Accepted', uploadDate: '2025-01-01', expiryDate: '2026-01-01', fileType: 'PDF' },
      { id: 'EVD-010', title: 'ØªÙ‚Ø±ÙŠØ± SIEM Retention', status: 'Accepted', uploadDate: '2025-01-25', expiryDate: '2025-07-25', fileType: 'PDF' },
      { id: 'EVD-011', title: 'ØªÙ‚Ø±ÙŠØ± Pentest Q4 2024', status: 'Accepted', uploadDate: '2024-12-20', expiryDate: '2025-06-20', fileType: 'PDF' },
      { id: 'EVD-012', title: 'ØªÙ‚Ø±ÙŠØ± Vulnerability Scan', status: 'Accepted', uploadDate: '2025-01-28', expiryDate: '2025-02-28', fileType: 'PDF' },
      { id: 'EVD-013', title: 'Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', status: 'Accepted', uploadDate: '2025-01-30', expiryDate: null, fileType: 'XLSX' },
      { id: 'EVD-014', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± IRP', status: 'Accepted', uploadDate: '2024-11-15', expiryDate: '2025-11-15', fileType: 'PDF' },
    ],
    // Breach Samples
    breaches: [
      { id: 'BRH-001', code: 'BRH-2025-001', title: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± SOC', severity: 'Critical', status: 'Open', exceptionApproved: false, obligationCode: 'SAMA-CYB-009', daysOpen: 12 },
      { id: 'BRH-002', code: 'BRH-2025-002', title: 'Ø¹Ø¯Ù… Ø¥Ø¬Ø±Ø§Ø¡ Pentest ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯', severity: 'Critical', status: 'Open', exceptionApproved: true, exceptionApprovedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', exceptionDate: '2025-01-20', obligationCode: 'SAMA-CYB-011', daysOpen: 8 },
      { id: 'BRH-003', code: 'BRH-2025-003', title: 'Ù†Ù‚Øµ ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†', severity: 'High', status: 'InProgress', exceptionApproved: false, obligationCode: 'SAMA-CYB-015', daysOpen: 5 },
      { id: 'BRH-004', code: 'BRH-2024-010', title: 'ØªØ£Ø®Ø± ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', severity: 'Medium', status: 'Closed', exceptionApproved: false, obligationCode: 'SAMA-CYB-004', daysOpen: 0 },
    ],
    // Test Results
    tests: [
      { id: 'TST-001', code: 'TST-SAMA-001', title: 'Ø§Ø®ØªØ¨Ø§Ø± MFA Enforcement', result: 'Pass', executedDate: '2025-01-15', obligationCode: 'SAMA-CYB-005' },
      { id: 'TST-002', code: 'TST-SAMA-002', title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… SoD', result: 'Fail', executedDate: '2025-01-18', obligationCode: 'SAMA-CYB-008' },
      { id: 'TST-003', code: 'TST-SAMA-003', title: 'Ø§Ø®ØªØ¨Ø§Ø± SIEM Retention', result: 'Pass', executedDate: '2025-01-20', obligationCode: 'SAMA-CYB-010' },
      { id: 'TST-004', code: 'TST-SAMA-004', title: 'Ø§Ø®ØªØ¨Ø§Ø± Incident SLA', result: 'Pass', executedDate: '2025-01-22', obligationCode: 'SAMA-CYB-013' },
    ],
    // Approvers
    approvers: [
      { id: 1, name: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', role: 'Chief Compliance Officer', email: 'mutaibi@company.sa' },
      { id: 2, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Head of GRC', email: 'sqahtani@company.sa' },
      { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø´Ù…Ø±ÙŠ', role: 'CISO', email: 'kshammari@company.sa' },
    ],
    // Pack Codes by Authority
    packCodes: {
      SAMA: 'SA-SAMA-CYBER-PACK-V1', NCA: 'SA-NCA-ECC-PACK-V1', SDAIA: 'SA-PDPL-PACK-V1', CMA: 'SA-CMA-GOV-PACK-V1',
      ZATCA: 'SA-ZATCA-VAT-PACK-V1',
      MOI: 'SA-MOI-SHOMOOS-V1'
    }
  };

  // PACK GENERATOR - useReducer State Management
  const packGenInitialState = {
    step: 0, authorityCode: 'SAMA', sessionId: null, quickSession: { dueDate: '', scope: '' },
    packCode: 'SA-SAMA-CYBER-PACK-V1',
    sections: { obligations: true, evidence: true, tests: true, breaches: true, auditTrail: true },
    counters: { obligations: 0, evidence: 0, tests: 0, breaches: 0 },
    hardGates: [], gatesPassed: false, approver: null, confirmText: '', confirmed: false, signOffTime: null,
    loading: false, error: null, generated: false, exportCount: 0, generatedPackId: null,
    generatedBy: null // Track who generated the pack for SoD
  };

  const packGenReducer = (state, action) => {
    switch (action.type) {
      case 'SET_AUTHORITY':
        return { ...state, authorityCode: action.payload, packCode: PACK_API.packCodes[action.payload] || 'SA-SAMA-CYBER-PACK-V1' };
      case 'SET_SESSION':
        return { ...state, sessionId: action.payload };
      case 'SET_QUICK_SESSION':
        return { ...state, quickSession: { ...state.quickSession, ...action.payload } };
      case 'TOGGLE_SECTION':
        return { ...state, sections: { ...state.sections, [action.payload]: !state.sections[action.payload] } };
      case 'SET_COUNTERS':
        return { ...state, counters: action.payload };
      case 'SET_HARD_GATES':
        const allPassed = action.payload.filter(g => g.blocking).every(g => g.passed);
        return { ...state, hardGates: action.payload, gatesPassed: allPassed };
      case 'SET_APPROVER':
        return { ...state, approver: action.payload };
      case 'SET_CONFIRM_TEXT':
        return { ...state, confirmText: action.payload };
      case 'SET_CONFIRMED':
        return { ...state, confirmed: action.payload, signOffTime: action.payload ? new Date().toISOString() : null };
      case 'NEXT_STEP':
        return { ...state, step: Math.min(state.step + 1, 4) };
      case 'PREV_STEP':
        return { ...state, step: Math.max(state.step - 1, 0) };
      case 'SET_LOADING':
        return { ...state, loading: action.payload };
      case 'SET_ERROR':
        return { ...state, error: action.payload };
      case 'SET_GENERATED':
        return { ...state, generated: true, generatedPackId: action.payload, generatedBy: action.userId || null };
      case 'INCREMENT_EXPORT':
        return { ...state, exportCount: state.exportCount + 1 };
      case 'RESET':
        return { ...packGenInitialState, authorityCode: action.payload || 'SAMA', packCode: PACK_API.packCodes[action.payload] || 'SA-SAMA-CYBER-PACK-V1' };
      default:
        return state;
    }
  };

  const [packGen, dispatchPG] = useReducer(packGenReducer, packGenInitialState);

  // PACK GENERATOR - Functions
  const openPackGenerator = (preselectedAuth = null) => {
    dispatchPG({ type: 'RESET', payload: preselectedAuth || 'SAMA' });
    setPackGeneratorPreselect(preselectedAuth);
    setShowPackGenerator(true);
  };

  const closePackGenerator = () => {
    setShowPackGenerator(false);
    setPackGeneratorPreselect(null);
  };

  const computePackCounters = () => {
    const obls = PACK_API.obligations.length;
    const evds = PACK_API.evidence.filter(e => e.status === 'Accepted').length;
    const tests = PACK_API.tests.length;
    const breaches = PACK_API.breaches.filter(b => b.status !== 'Closed').length;
    dispatchPG({ type: 'SET_COUNTERS', payload: { obligations: obls, evidence: evds, tests, breaches } });
  };

  const computeHardGates = () => {
    const gates = [];
    // Gate 1: Critical obligations with Missing or Expired evidence
    const criticalBad = PACK_API.obligations.filter(o => o.severity === 'Critical' && (o.evidenceStatus === 'Missing' || o.evidenceStatus === 'Expired'));
    gates.push({
      id: 'critical_evidence', label: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© Ù„Ù‡Ø§ Ø£Ø¯Ù„Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©', passed: criticalBad.length === 0,
      blocking: true,
      reason: criticalBad.length > 0 ? `${criticalBad.length} Ø§Ù„ØªØ²Ø§Ù… Ø­Ø±Ø¬ Ø¨Ø¯ÙˆÙ† Ø¯Ù„ÙŠÙ„ ØµØ§Ù„Ø­: ${criticalBad.map(o => o.code).join(', ')}` : null,
      items: criticalBad
    });
    // Gate 2: Open Critical breaches without exception
    const criticalBreaches = PACK_API.breaches.filter(b => b.severity === 'Critical' && b.status === 'Open' && !b.exceptionApproved);
    gates.push({
      id: 'critical_breaches', label: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø±Ø¬Ø© Ù…ÙØªÙˆØ­Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ«Ù†Ø§Ø¡', passed: criticalBreaches.length === 0,
      blocking: true,
      reason: criticalBreaches.length > 0 ? `${criticalBreaches.length} Ù…Ø®Ø§Ù„ÙØ© Ø­Ø±Ø¬Ø© Ù…ÙØªÙˆØ­Ø©: ${criticalBreaches.map(b => b.code).join(', ')}` : null,
      items: criticalBreaches
    });
    // Gate 3: PendingReview evidence
    const pendingEvd = PACK_API.obligations.filter(o => o.evidenceStatus === 'PendingReview');
    gates.push({
      id: 'pending_review', label: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Pending Review)', passed: pendingEvd.length === 0,
      blocking: true,
      reason: pendingEvd.length > 0 ? `${pendingEvd.length} Ø¯Ù„ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©` : null,
      items: pendingEvd
    });
    // Gate 4: Session active or quick session provided
    const hasSession = packGen.sessionId || (packGen.quickSession.dueDate && packGen.quickSession.scope);
    gates.push({
      id: 'session_active', label: 'Ø¬Ù„Ø³Ø© ØªÙØªÙŠØ´ Ù…Ø­Ø¯Ø¯Ø© Ø£Ùˆ Ø¬Ù„Ø³Ø© Ø³Ø±ÙŠØ¹Ø©', passed: hasSession, blocking: true,
      reason: !hasSession ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø³Ø±ÙŠØ¹Ø©' : null
    });
    dispatchPG({ type: 'SET_HARD_GATES', payload: gates });
  };

  const generatePackContent = () => {
    const ts = new Date().toISOString();
    return {
      '01_Executive_Summary': {
        'summary.txt': `SAMA Cybersecurity Compliance Pack\n${'='.repeat(50)}\nGenerated: ${ts}\nAuthority: ${packGen.authorityCode}\nPack Code: ${packGen.packCode}\nApproved By: ${packGen.approver?.name || 'N/A'}\nSign-off Time: ${packGen.signOffTime || 'N/A'}\n\nSUMMARY:\n- Total Obligations: ${packGen.counters.obligations}\n- Accepted Evidence: ${packGen.counters.evidence}\n- Test Results: ${packGen.counters.tests}\n- Open Breaches: ${packGen.counters.breaches}\n\nSECTIONS INCLUDED:\n${Object.entries(packGen.sections).filter(([k, v]) => v).map(([k]) => `- ${k}`).join('\n')}`
      },
      '02_Obligation_Register': {
        'index.csv': 'Code,Title,Severity,Domain,Evidence Status\n' + PACK_API.obligations.map(o => `${o.code},"${o.title}",${o.severity},${o.domain},${o.evidenceStatus}`).join('\n')
      },
      '03_Evidence': {
        'evidence_index.csv': 'ID,Title,Status,Upload Date,Expiry Date,File Type\n' + PACK_API.evidence.map(e => `${e.id},"${e.title}",${e.status},${e.uploadDate},${e.expiryDate || 'N/A'},${e.fileType}`).join('\n')
      },
      '04_Test_Results': {
        'test_results.csv': 'Code,Title,Result,Executed Date,Obligation\n' + PACK_API.tests.map(t => `${t.code},"${t.title}",${t.result},${t.executedDate},${t.obligationCode}`).join('\n')
      },
      '05_Breaches_and_CAPA': {
        'breaches.csv': 'Code,Title,Severity,Status,Exception Approved,Days Open\n' + PACK_API.breaches.map(b => `${b.code},"${b.title}",${b.severity},${b.status},${b.exceptionApproved},${b.daysOpen}`).join('\n')
      },
      '06_Audit_Trail_Log': {
        'audit.txt': `AUDIT TRAIL LOG\n${'='.repeat(50)}\n${ts} - Pack generation initiated by ${CURRENT_USER.name}\n${ts} - Authority: ${packGen.authorityCode}\n${ts} - Hard gates validated: ${packGen.gatesPassed ? 'PASSED' : 'BLOCKED'}\n${packGen.signOffTime} - Approver sign-off by ${packGen.approver?.name}\n${ts} - Pack generated successfully\n${ts} - Pack ID: ${packGen.packCode}-${Date.now()}`
      }
    };
  };

  const exportZIP = () => {
    // SoD Check: Generator cannot export their own pack
    if (packGen.generatedBy) {
      const sodResult = guardAction('INSPECTIONS', 'EXPORT', { generatedBy: packGen.generatedBy }, 'Critical');
      if (!sodResult.allowed) {
        showNotification(`â›” ${sodResult.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ - Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…'}`, 'error');
        return;
      }
    }
    // DOA Check: Critical pack export requires approval
    const doaCheck = ApprovalService.requiresApproval('INSPECTIONS', 'EXPORT', 'Critical');
    if (doaCheck.required && doaCheck.rule?.requiresDualApproval) {
      const existingRequests = ApprovalService.getRecordApprovalStatus('PACK', packGen.packCode);
      const approvedRequest = existingRequests.find(r => r.status === 'Approved');

      if (!approvedRequest) {
        setExportType('zip');
        setExportApprovalNotes('');
        setShowExportApprovalModal(true);
        return;
      }
    }
    // Proceed with export
    performExportZIP();
  };

  const performExportZIP = () => {
    const content = generatePackContent();
    let manifest = `${packGen.packCode}\nPack Manifest\n${'='.repeat(50)}\n\n`;
    Object.entries(content).forEach(([folder, files]) => {
      manifest += `ğŸ“ /${folder}/\n`;
      Object.entries(files).forEach(([filename, data]) => {
        manifest += `   ğŸ“„ ${filename} (${data.length} bytes)\n`;
      });
    });
    manifest += `\n${'='.repeat(50)}\nGenerated: ${new Date().toISOString()}\nApproved By: ${packGen.approver?.name}`;
    const blob = new Blob([manifest], { type: 'application/zip' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${packGen.packCode}_${new Date().toISOString().split('T')[0]}.zip`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    dispatchPG({ type: 'INCREMENT_EXPORT' });
  };

  const exportPDF = () => {
    // SoD Check: Generator cannot export their own pack
    if (packGen.generatedBy) {
      const sodResult = guardAction('INSPECTIONS', 'EXPORT', { generatedBy: packGen.generatedBy }, 'Critical');
      if (!sodResult.allowed) {
        showNotification(`â›” ${sodResult.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ - Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…'}`, 'error');
        return;
      }
    }
    // DOA Check: Critical pack export requires approval
    const doaCheck = ApprovalService.requiresApproval('INSPECTIONS', 'EXPORT', 'Critical');
    if (doaCheck.required && doaCheck.rule?.requiresDualApproval) {
      const existingRequests = ApprovalService.getRecordApprovalStatus('PACK', packGen.packCode);
      const approvedRequest = existingRequests.find(r => r.status === 'Approved');

      if (!approvedRequest) {
        setExportType('pdf');
        setExportApprovalNotes('');
        setShowExportApprovalModal(true);
        return;
      }
    }
    // Proceed with export
    performExportPDF();
  };

  const performExportPDF = () => {
    const content = generatePackContent();
    let pdfText = `${packGen.packCode}\nSAMA Cybersecurity Compliance Submission Pack\n${'='.repeat(60)}\n\n`;
    pdfText += content['01_Executive_Summary']['summary.txt'];
    pdfText += `\n\n${'='.repeat(60)}\nOBLIGATIONS REGISTER\n${'='.repeat(60)}\n\n`;
    PACK_API.obligations.forEach(o => {
      pdfText += `[${o.severity}] ${o.code}: ${o.title}\n   Domain: ${o.domain} | Evidence: ${o.evidenceStatus}\n\n`;
    });
    pdfText += `\n${'='.repeat(60)}\nBREACHES & EXCEPTIONS\n${'='.repeat(60)}\n\n`;
    PACK_API.breaches.forEach(b => {
      pdfText += `[${b.severity}] ${b.code}: ${b.title}\n   Status: ${b.status} | Exception: ${b.exceptionApproved ? 'Yes' : 'No'}\n\n`;
    });
    const blob = new Blob([pdfText], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${packGen.packCode}_${new Date().toISOString().split('T')[0]}.pdf`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    dispatchPG({ type: 'INCREMENT_EXPORT' });
  };

  const exportExcelIndex = () => {
    // SoD Check: Generator cannot export their own pack
    if (packGen.generatedBy) {
      const sodResult = guardAction('INSPECTIONS', 'EXPORT', { generatedBy: packGen.generatedBy }, 'Critical');
      if (!sodResult.allowed) {
        showNotification(`â›” ${sodResult.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ - Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…'}`, 'error');
        return;
      }
    }
    let csv = 'Pack Index Report\n\nSection,Item Count,Status\n';
    csv += `Obligations,${packGen.counters.obligations},Complete\n`;
    csv += `Evidence (Accepted),${packGen.counters.evidence},Complete\n`;
    csv += `Test Results,${packGen.counters.tests},Complete\n`;
    csv += `Open Breaches,${packGen.counters.breaches},Included\n`;
    csv += `Audit Trail,1,Complete\n\n`;
    csv += 'OBLIGATIONS DETAIL\nCode,Title,Severity,Domain,Evidence Status\n';
    csv += PACK_API.obligations.map(o => `${o.code},"${o.title}",${o.severity},${o.domain},${o.evidenceStatus}`).join('\n');
    csv += '\n\nEVIDENCE DETAIL\nID,Title,Status,Upload Date,Expiry Date\n';
    csv += PACK_API.evidence.map(e => `${e.id},"${e.title}",${e.status},${e.uploadDate},${e.expiryDate || 'N/A'}`).join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${packGen.packCode}_Index_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    dispatchPG({ type: 'INCREMENT_EXPORT' });
  };

  const finalizePackGeneration = () => {
    dispatchPG({ type: 'SET_LOADING', payload: true });
    setTimeout(() => {
      const newPackId = `${packGen.packCode}-${Date.now()}`;
      const archiveRecord = {
        id: submissionArchive.length + 1, packId: newPackId, authority: packGen.authorityCode,
        sessionCode: packGen.sessionId ? `INS-${packGen.sessionId}` : 'Quick Session',
        approvedBy: packGen.approver?.name, generatedAt: new Date().toISOString(), exportCount: 0,
        contents: generatePackContent()
      };
      setSubmissionArchive(prev => [archiveRecord, ...prev]);
      dispatchPG({ type: 'SET_LOADING', payload: false });
      dispatchPG({ type: 'SET_GENERATED', payload: newPackId, userId: currentUser?.id });
      showNotification('âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    }, 2000);
  };

  const CURRENT_USER = { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Compliance Officer' };

  // REGULATORY AUTHORITIES CONFIG
  const AUTHORITIES_CONFIG = [
    {
      id: 1, code: 'SAMA', nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', nameEn: 'Saudi Central Bank',
      color: 'emerald', icon: 'ğŸ¦',
      packs: [
        { id: 'sama-cyber', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'Cyber Compliance Pack', type: 'Quarterly' },
        { id: 'sama-aml', name: 'Ø­Ø²Ù…Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', nameEn: 'AML Compliance Pack', type: 'Monthly' },
        { id: 'sama-bcm', name: 'Ø­Ø²Ù…Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', nameEn: 'BCM Compliance Pack', type: 'Annual' },
        { id: 'sama-governance', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', nameEn: 'Corporate Governance Pack', type: 'Annual' },
      ],
      obligations: 45, controls: 120, lastInspection: '2024-11-15'
    },
    {
      id: 2, code: 'NCA', nameAr: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'National Cybersecurity Authority',
      color: 'purple', icon: 'ğŸ›¡ï¸',
      packs: [
        { id: 'nca-ecc', name: 'Ø­Ø²Ù…Ø© Ø¶ÙˆØ§Ø¨Ø· ECC', nameEn: 'ECC Controls Evidence Pack', type: 'Annual' },
        { id: 'nca-ccc', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', nameEn: 'Critical Systems Pack', type: 'Semi-Annual' },
        { id: 'nca-incident', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', nameEn: 'Incident Report Pack', type: 'On-Demand' },
      ],
      obligations: 114, controls: 89, lastInspection: '2024-09-20'
    },
    {
      id: 3, code: 'SDAIA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'Saudi Data & AI Authority',
      color: 'indigo', icon: 'ğŸ”',
      packs: [
        { id: 'pdpl-annual', name: 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ PDPL', nameEn: 'Annual Privacy Compliance Pack', type: 'Annual' },
        { id: 'pdpl-breach', name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Breach Notification Pack', type: 'On-Demand' },
        { id: 'pdpl-dpia', name: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©', nameEn: 'DPIA Pack', type: 'Per-Project' },
      ],
      obligations: 32, controls: 45, lastInspection: '2024-12-01'
    },
    {
      id: 4, code: 'CMA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Capital Market Authority',
      color: 'blue', icon: 'ğŸ“Š',
      packs: [
        { id: 'cma-governance', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ø¥ÙØµØ§Ø­', nameEn: 'Governance & Disclosure Pack', type: 'Annual' },
        { id: 'cma-aml', name: 'Ø­Ø²Ù…Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', nameEn: 'AML Compliance Pack', type: 'Quarterly' },
      ],
      obligations: 28, controls: 56, lastInspection: '2024-10-10'
    },
    {
      id: 5, code: 'ZATCA', nameAr: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', nameEn: 'Zakat, Tax & Customs Authority',
      color: 'amber', icon: 'ğŸ’°',
      packs: [
        { id: 'zatca-vat', name: 'Ø­Ø²Ù…Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', nameEn: 'VAT Audit Pack', type: 'Monthly' },
        { id: 'zatca-einvoice', name: 'Ø­Ø²Ù…Ø© Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', nameEn: 'E-Invoice Compliance Pack', type: 'On-Demand' },
        { id: 'zatca-audit', name: 'Ù…Ù„Ù Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', nameEn: 'Tax Audit File Pack', type: 'Annual' },
      ],
      obligations: 18, controls: 32, lastInspection: '2025-01-05'
    },
    {
      id: 6, code: 'MOI', nameAr: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© - Ø´Ù…ÙˆØ³', nameEn: 'Ministry of Interior - Shomoos',
      color: 'red', icon: 'ğŸ›ï¸',
      packs: [
        { id: 'shomoos-cert', name: 'Ø´Ù‡Ø§Ø¯Ø© Ø´Ù…ÙˆØ³ + Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…', nameEn: 'Shomoos Certificate & Logs Pack', type: 'Annual' },
      ],
      obligations: 12, controls: 20, lastInspection: '2024-08-15'
    },
  ];

  // INSPECTION SESSIONS DATA
  const [sessions, setSessions] = useState([
    {
      id: 1, code: 'INS-2025-001', authorityId: 1, authorityCode: 'SAMA',
      inspectionType: 'Routine', scope: 'Full Compliance Review', startDate: '2025-02-01', dueDate: '2025-02-28',
      status: 'Active', progress: 75,
      findings: { missingEvidence: 3, overdueObligations: 1, openBreaches: 2, openCAPAs: 4 },
      packStatus: 'InProgress', packId: null,
      createdBy: 1, createdAt: '2025-01-25'
    },
    {
      id: 2, code: 'INS-2025-002', authorityId: 2, authorityCode: 'NCA',
      inspectionType: 'Renewal', scope: 'ECC Certification Renewal',
      startDate: '2025-01-15', dueDate: '2025-03-15', status: 'Active', progress: 45,
      findings: { missingEvidence: 8, overdueObligations: 3, openBreaches: 1, openCAPAs: 6 },
      packStatus: 'NotStarted', packId: null,
      createdBy: 1, createdAt: '2025-01-10'
    },]);
  // AUTHORITY READINESS DATA
  const [authorityReadiness, setAuthorityReadiness] = useState([
    {
      authorityId: 1, code: 'SAMA', readinessScore: 92,
      compliance: { total: 45, compliant: 42, partial: 2, nonCompliant: 1 },
      evidence: { total: 120, accepted: 112, pending: 5, missing: 3, expired: 0 },
      breaches: { total: 5, open: 2, inProgress: 1, closed: 2 },
      tasks: { total: 25, completed: 22, overdue: 1, pending: 2 },
      lastUpdated: '2025-02-03'
    },
    {
      authorityId: 2, code: 'NCA', readinessScore: 85,
      compliance: { total: 114, compliant: 95, partial: 12, nonCompliant: 7 },
      evidence: { total: 89, accepted: 76, pending: 5, missing: 5, expired: 3 },
      breaches: { total: 3, open: 1, inProgress: 1, closed: 1 },
      tasks: { total: 40, completed: 32, overdue: 3, pending: 5 },
      lastUpdated: '2025-02-03'
    },
    {
      authorityId: 3, code: 'SDAIA', readinessScore: 96,
      compliance: { total: 32, compliant: 31, partial: 1, nonCompliant: 0 },
      evidence: { total: 45, accepted: 44, pending: 0, missing: 1, expired: 0 },
      breaches: { total: 1, open: 0, inProgress: 0, closed: 1 },
      tasks: { total: 15, completed: 14, overdue: 0, pending: 1 },
      lastUpdated: '2025-02-03'
    },
    {
      authorityId: 4, code: 'CMA', readinessScore: 78,
      compliance: { total: 28, compliant: 20, partial: 5, nonCompliant: 3 },
      evidence: { total: 56, accepted: 42, pending: 6, missing: 5, expired: 3 },
      breaches: { total: 6, open: 3, inProgress: 2, closed: 1 },
      tasks: { total: 20, completed: 13, overdue: 4, pending: 3 },
      lastUpdated: '2025-02-03'
    },
    {
      authorityId: 5, code: 'ZATCA', readinessScore: 88,
      compliance: { total: 18, compliant: 16, partial: 1, nonCompliant: 1 },
      evidence: { total: 32, accepted: 28, pending: 2, missing: 1, expired: 1 },
      breaches: { total: 2, open: 1, inProgress: 0, closed: 1 },
      tasks: { total: 12, completed: 10, overdue: 1, pending: 1 },
      lastUpdated: '2025-02-03'
    },
    {
      authorityId: 6, code: 'MOI', readinessScore: 94,
      compliance: { total: 12, compliant: 11, partial: 1, nonCompliant: 0 },
      evidence: { total: 20, accepted: 19, pending: 1, missing: 0, expired: 0 },
      breaches: { total: 0, open: 0, inProgress: 0, closed: 0 }, tasks: { total: 8, completed: 7, overdue: 0, pending: 1 },
      lastUpdated: '2025-02-03'
    },]);
  // SUBMISSION PACKS DATA
  const [submissionPacks, setSubmissionPacks] = useState([
    {
      id: 1, code: 'PACK-2025-001', sessionId: 1, authorityId: 1, authorityCode: 'SAMA',
      packType: 'sama-cyber', packName: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      status: 'Draft', progress: 60,
      contents: { obligations: 15, evidence: 42, testResults: 8, breachClosures: 2, commLogs: 5 },
      hardGates: { evidenceAccepted: true, noExpired: true, criticalBreachesClosed: false, approverSignOff: false },
      generatedFile: null, exportedAt: null,
      createdBy: 1, createdAt: '2025-02-01', approvedBy: null, approvedAt: null
    },]);
  // OBLIGATION DRILLDOWN DATA (for selected authority)
  const [obligationsDrilldown, setObligationsDrilldown] = useState([
    { id: 1, code: 'OBL-SAMA-001', title: 'Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', category: 'Governance', hasEvidence: true, lastTest: 'Pass', lastTestDate: '2025-01-15', lastChange: null, openBreach: false },
    { id: 2, code: 'OBL-SAMA-002', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« ÙˆØ§Ù„Ø¥Ø¨Ù„Ø§Øº', category: 'Incident', hasEvidence: true, lastTest: 'Pass', lastTestDate: '2025-01-20', lastChange: '2025-01-10', openBreach: false },
    { id: 3, code: 'OBL-SAMA-003', title: 'Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«', category: 'Third Party', hasEvidence: false, lastTest: 'Fail', lastTestDate: '2024-12-10', lastChange: null, openBreach: true },
    { id: 4, code: 'OBL-SAMA-004', title: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ©', category: 'Training', hasEvidence: true, lastTest: 'Pass', lastTestDate: '2025-01-25', lastChange: null, openBreach: false },
    { id: 5, code: 'OBL-SAMA-005', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', category: 'Access', hasEvidence: true, lastTest: 'Partial', lastTestDate: '2025-01-18', lastChange: null, openBreach: false },
  ]);

  // HELPER FUNCTIONS
  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const getAuthority = (id) => AUTHORITIES_CONFIG.find(a => a.id === id);
  const getAuthorityByCode = (code) => AUTHORITIES_CONFIG.find(a => a.code === code);
  const getReadiness = (authorityId) => authorityReadiness.find(r => r.authorityId === authorityId);

  const getReadinessColor = (score) => {
    if (score >= 90) return 'emerald';
    if (score >= 75) return 'amber';
    if (score >= 60) return 'orange';
    return 'red';
  };

  const overallReadiness = Math.round(authorityReadiness.reduce((sum, r) => sum + r.readinessScore, 0) / authorityReadiness.length);

  // HARD GATES CHECK
  const checkHardGates = (authorityId) => {
    const readiness = getReadiness(authorityId);
    if (!readiness) return { canGenerate: false, gates: [] };

    const gates = [
      { id: 'evidence', label: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©', passed: readiness.evidence.pending === 0 && readiness.evidence.missing === 0 },
      { id: 'expired', label: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø© Ù…Ù†ØªÙ‡ÙŠØ©', passed: readiness.evidence.expired === 0 },
      { id: 'breaches', label: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© Ù…ØºÙ„Ù‚Ø©', passed: readiness.breaches.open === 0 },
      { id: 'tasks', label: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ØªØ£Ø®Ø±Ø©', passed: readiness.tasks.overdue === 0 },
    ];

    return { canGenerate: gates.every(g => g.passed), gates };
  };

  const generatePack = (authorityId, packType) => {
    const { canGenerate, gates } = checkHardGates(authorityId);

    if (!canGenerate) {
      showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø© - ÙŠØ±Ø¬Ù‰ Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }

    setGeneratingPack(true);
    setPackStep(0);

    // Simulate pack generation steps
    const steps = ['Ø¬Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', 'Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø£Ø¯Ù„Ø©', 'Ø¥Ø¶Ø§ÙØ© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', 'Ø¥Ø±ÙØ§Ù‚ Ø¥ØºÙ„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', 'ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ'];
    let currentStep = 0;

    const interval = setInterval(() => {
      currentStep++;
      setPackStep(currentStep);
      if (currentStep >= steps.length) {
        clearInterval(interval);
        setGeneratingPack(false);
        showNotification('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø­Ø²Ù…Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØµØ¯ÙŠØ±.');
      }
    }, 800);
  };

  return (
    <div className="h-full flex flex-col bg-slate-100">
      {notification && (
        <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg ${notification.type === 'success' ? 'bg-emerald-500' : 'bg-red-500'
          } text-white font-bold flex items-center gap-2`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <XCircle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}

      <div className="bg-gradient-to-l from-teal-600 via-cyan-700 to-blue-800 text-white px-6 py-5">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center backdrop-blur-sm shadow-lg">
              <Shield className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-2xl font-black">Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªÙØªÙŠØ´ ÙˆÙ…ØµÙ†Ø¹ Ø­Ø²Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ…</h1>
              <p className="text-cyan-200">Inspection Readiness & Submission Factory - Module 4.10</p>
            </div> </div>
          <div className="flex items-center gap-6">
            <div className="text-center">
              <div className="relative w-24 h-24">
                <svg className="w-24 h-24 transform -rotate-90">
                  <circle cx="48" cy="48" r="42" stroke="rgba(255,255,255,0.2)" strokeWidth="8" fill="none" />
                  <circle cx="48" cy="48" r="42"
                    stroke={overallReadiness >= 90 ? '#10b981' : overallReadiness >= 75 ? '#f59e0b' : '#ef4444'}
                    strokeWidth="8" fill="none" strokeDasharray={`${(overallReadiness / 100) * 264} 264`} strokeLinecap="round" />
                </svg>
                <div className="absolute inset-0 flex flex-col items-center justify-center">
                  <span className="text-3xl font-black">{overallReadiness}%</span>
                </div> </div>
              <p className="text-sm text-cyan-200 mt-1 font-bold">Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©</p>
            </div>

            <div className="h-20 w-px bg-white/20"></div>

            <div className="grid grid-cols-3 gap-4 text-center">
              <div>
                <p className="text-3xl font-black text-emerald-400">{sessions.filter(s => s.status === 'Active').length}</p>
                <p className="text-xs text-cyan-200">Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</p>
              </div>
              <div>
                <p className="text-3xl font-black text-amber-400">{submissionPacks.filter(p => p.status === 'Draft').length}</p>
                <p className="text-xs text-cyan-200">Ø­Ø²Ù… Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</p>
              </div>
              <div>
                <p className="text-3xl font-black text-cyan-300">{AUTHORITIES_CONFIG.length}</p>
                <p className="text-xs text-cyan-200">Ø¬Ù‡Ø§Øª Ø±Ù‚Ø§Ø¨ÙŠØ©</p>
              </div> </div>
            <button onClick={() => openPackGenerator()}
              className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
              <Package className="w-5 h-5" />
              ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø©
            </button>

            <button onClick={() => setShowSessionModal(true)}
              className="flex items-center gap-2 px-6 py-3 bg-white text-cyan-700 rounded-xl font-bold shadow-lg hover:bg-cyan-50">
              <Plus className="w-5 h-5" />
              Ø¬Ù„Ø³Ø© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯Ø©
            </button> </div> </div>
        <div className="flex gap-2 mt-6">
          {[
            { id: 'dashboard', label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©', icon: LayoutGrid },
            { id: 'authorities', label: 'Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Building2 },
            { id: 'sessions', label: 'Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªÙØªÙŠØ´', icon: ClipboardCheck },
            { id: 'packs', label: 'Ù…ØµÙ†Ø¹ Ø§Ù„Ø­Ø²Ù…', icon: FolderOpen },
            { id: 'archive', label: 'Ø£Ø±Ø´ÙŠÙ Ø§Ù„ØªØ³Ù„ÙŠÙ…', icon: Archive },
          ].map(tab => (
            <button key={tab.id} onClick={() => { setActiveTab(tab.id); setSelectedAuthority(null); }}
              className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-bold transition-all ${activeTab === tab.id ? 'bg-white text-cyan-700 shadow-lg' : 'bg-white/10 text-white hover:bg-white/20'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
            </button>
          ))}
        </div> </div>
      <div className="flex-1 overflow-auto p-6">

        {activeTab === 'dashboard' && !selectedAuthority && (
          <div className="space-y-6">
            <div className="grid grid-cols-3 gap-4">
              {AUTHORITIES_CONFIG.map(auth => {
                const readiness = getReadiness(auth.id);
                const readinessColor = getReadinessColor(readiness?.readinessScore || 0);
                return (
                  <div key={auth.id}
                    onClick={() => setSelectedAuthority(auth)}
                    className={`bg-white rounded-2xl p-5 border-2 border-${auth.color}-200 hover:border-${auth.color}-400 hover:shadow-xl cursor-pointer transition-all`}>
                    <div className="flex items-center justify-between mb-4">
                      <div className="flex items-center gap-3">
                        <div className={`w-14 h-14 rounded-xl bg-${auth.color}-100 flex items-center justify-center text-2xl`}>
                          {auth.icon}
                        </div>
                        <div>
                          <h3 className="font-black text-slate-800">{auth.code}</h3>
                          <p className="text-xs text-slate-500">{auth.nameAr}</p>
                        </div> </div>
                      <div className={`text-3xl font-black text-${readinessColor}-600`}>
                        {readiness?.readinessScore || 0}%
                      </div> </div>
                    <div className="w-full h-3 bg-slate-100 rounded-full overflow-hidden mb-4">
                      <div className={`h-full bg-${readinessColor}-500 rounded-full transition-all`}
                        style={{ width: `${readiness?.readinessScore || 0}%` }}></div>
                    </div>

                    <div className="grid grid-cols-4 gap-2 text-center">
                      <div className="bg-slate-50 rounded-lg p-2">
                        <p className="text-lg font-bold text-slate-700">{readiness?.compliance.total || 0}</p>
                        <p className="text-[10px] text-slate-500">Ø§Ù„ØªØ²Ø§Ù…</p>
                      </div>
                      <div className={`rounded-lg p-2 ${readiness?.evidence.missing > 0 ? 'bg-red-50' : 'bg-emerald-50'}`}>
                        <p className={`text-lg font-bold ${readiness?.evidence.missing > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                          {readiness?.evidence.missing || 0}
                        </p>
                        <p className="text-[10px] text-slate-500">Ø£Ø¯Ù„Ø© Ù†Ø§Ù‚ØµØ©</p>
                      </div>
                      <div className={`rounded-lg p-2 ${readiness?.breaches.open > 0 ? 'bg-red-50' : 'bg-emerald-50'}`}>
                        <p className={`text-lg font-bold ${readiness?.breaches.open > 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                          {readiness?.breaches.open || 0}
                        </p>
                        <p className="text-[10px] text-slate-500">Ù…Ø®Ø§Ù„ÙØ§Øª</p>
                      </div>
                      <div className={`rounded-lg p-2 ${readiness?.tasks.overdue > 0 ? 'bg-orange-50' : 'bg-emerald-50'}`}>
                        <p className={`text-lg font-bold ${readiness?.tasks.overdue > 0 ? 'text-orange-600' : 'text-emerald-600'}`}>
                          {readiness?.tasks.overdue || 0}
                        </p>
                        <p className="text-[10px] text-slate-500">Ù…ØªØ£Ø®Ø±</p>
                      </div> </div>
                    <div className="mt-4 pt-3 border-t border-slate-100 flex items-center justify-between">
                      <span className="text-xs text-slate-500">{auth.packs.length} Ø­Ø²Ù… ØªØ³Ù„ÙŠÙ… Ù…ØªØ§Ø­Ø©</span>
                      <button onClick={(e) => { e.stopPropagation(); openPackGenerator(auth.code); }}
                        className="flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold hover:bg-emerald-200">
                        <Package className="w-3 h-3" />
                        ØªÙˆÙ„ÙŠØ¯
                      </button> </div> </div>);
              })}
            </div>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
                <h2 className="text-lg font-black text-white flex items-center gap-2">
                  <ClipboardCheck className="w-5 h-5 text-cyan-400" />
                  Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ù†Ø´Ø·Ø©
                </h2>
                <span className="bg-cyan-500 text-white px-3 py-1 rounded-lg text-sm font-bold">
                  {sessions.filter(s => s.status === 'Active').length} Ø¬Ù„Ø³Ø©
                </span> </div>
              <div className="divide-y divide-slate-100">
                {sessions.filter(s => s.status === 'Active').map(session => {
                  const auth = getAuthorityByCode(session.authorityCode);
                  return (
                    <div key={session.id} className="px-6 py-4 flex items-center justify-between hover:bg-slate-50">
                      <div className="flex items-center gap-4">
                        <div className={`w-12 h-12 rounded-xl bg-${auth?.color || 'slate'}-100 flex items-center justify-center text-xl`}>
                          {auth?.icon}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{session.code}</p>
                          <p className="text-sm text-slate-500">{auth?.nameAr} â€¢ {session.scope}</p>
                        </div> </div>
                      <div className="flex items-center gap-6">
                        <div className="text-center">
                          <p className="text-lg font-bold text-slate-800">{session.progress}%</p>
                          <p className="text-xs text-slate-500">Ø§Ù„ØªÙ‚Ø¯Ù…</p>
                        </div>
                        <div className="text-center">
                          <p className="text-lg font-bold text-red-600">{session.findings.missingEvidence + session.findings.openBreaches}</p>
                          <p className="text-xs text-slate-500">ÙØ¬ÙˆØ§Øª</p>
                        </div>
                        <div className="text-center">
                          <p className="text-sm font-bold text-slate-600">{session.dueDate}</p>
                          <p className="text-xs text-slate-500">Ø§Ù„Ù…ÙˆØ¹Ø¯</p>
                        </div>
                        <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg font-bold hover:bg-cyan-600">
                          Ù…ØªØ§Ø¨Ø¹Ø©
                        </button> </div> </div>);
                })}
              </div> </div> </div>
        )}

        {activeTab === 'dashboard' && selectedAuthority && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <button onClick={() => setSelectedAuthority(null)}
                className="flex items-center gap-2 text-slate-600 hover:text-slate-800 font-bold">
                <ChevronRight className="w-5 h-5" />
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©
              </button> </div>
            <div className={`bg-gradient-to-l from-${selectedAuthority.color}-500 to-${selectedAuthority.color}-700 rounded-2xl p-6 text-white`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-20 h-20 rounded-2xl bg-white/20 flex items-center justify-center text-4xl">
                    {selectedAuthority.icon}
                  </div>
                  <div>
                    <h2 className="text-3xl font-black">{selectedAuthority.code}</h2>
                    <p className="text-lg opacity-80">{selectedAuthority.nameAr}</p>
                    <p className="text-sm opacity-60">{selectedAuthority.nameEn}</p>
                  </div> </div>
                <div className="text-center">
                  <div className="relative w-28 h-28">
                    <svg className="w-28 h-28 transform -rotate-90">
                      <circle cx="56" cy="56" r="50" stroke="rgba(255,255,255,0.2)" strokeWidth="8" fill="none" />
                      <circle cx="56" cy="56" r="50" stroke="white" strokeWidth="8" fill="none"
                        strokeDasharray={`${(getReadiness(selectedAuthority.id)?.readinessScore / 100) * 314} 314`} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                      <span className="text-4xl font-black">{getReadiness(selectedAuthority.id)?.readinessScore}%</span>
                    </div> </div>
                  <p className="text-sm opacity-80 mt-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</p>
                </div> </div> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5 text-purple-500" />
                  Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…ØªÙˆØ§ÙÙ‚</span>
                    <span className="font-bold text-emerald-600">{getReadiness(selectedAuthority.id)?.compliance.compliant}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ø¬Ø²Ø¦ÙŠ</span>
                    <span className="font-bold text-amber-600">{getReadiness(selectedAuthority.id)?.compliance.partial}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">ØºÙŠØ± Ù…ØªÙˆØ§ÙÙ‚</span>
                    <span className="font-bold text-red-600">{getReadiness(selectedAuthority.id)?.compliance.nonCompliant}</span>
                  </div> </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <FileCheck className="w-5 h-5 text-blue-500" />
                  Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ù„Ø©
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…Ù‚Ø¨ÙˆÙ„Ø©</span>
                    <span className="font-bold text-emerald-600">{getReadiness(selectedAuthority.id)?.evidence.accepted}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    <span className="font-bold text-amber-600">{getReadiness(selectedAuthority.id)?.evidence.pending}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù†Ø§Ù‚ØµØ©</span>
                    <span className="font-bold text-red-600">{getReadiness(selectedAuthority.id)?.evidence.missing}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…Ù†ØªÙ‡ÙŠØ©</span>
                    <span className="font-bold text-red-600">{getReadiness(selectedAuthority.id)?.evidence.expired}</span>
                  </div> </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <AlertTriangle className="w-5 h-5 text-red-500" />
                  Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…ÙØªÙˆØ­Ø©</span>
                    <span className="font-bold text-red-600">{getReadiness(selectedAuthority.id)?.breaches.open}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                    <span className="font-bold text-amber-600">{getReadiness(selectedAuthority.id)?.breaches.inProgress}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…ØºÙ„Ù‚Ø©</span>
                    <span className="font-bold text-emerald-600">{getReadiness(selectedAuthority.id)?.breaches.closed}</span>
                  </div> </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <ClipboardList className="w-5 h-5 text-cyan-500" />
                  Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…ÙƒØªÙ…Ù„Ø©</span>
                    <span className="font-bold text-emerald-600">{getReadiness(selectedAuthority.id)?.tasks.completed}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…Ø¹Ù„Ù‚Ø©</span>
                    <span className="font-bold text-amber-600">{getReadiness(selectedAuthority.id)?.tasks.pending}</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-slate-600">Ù…ØªØ£Ø®Ø±Ø©</span>
                    <span className="font-bold text-red-600">{getReadiness(selectedAuthority.id)?.tasks.overdue}</span>
                  </div> </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-slate-800 px-6 py-4">
                <h3 className="font-bold text-white flex items-center gap-2">
                  <Shield className="w-5 h-5 text-cyan-400" />
                  Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ (Hard Gates) - Ù…ØªØ·Ù„Ø¨Ø§Øª ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø©
                </h3>
              </div>
              <div className="p-6">
                <div className="grid grid-cols-4 gap-4">
                  {checkHardGates(selectedAuthority.id).gates.map(gate => (
                    <div key={gate.id} className={`p-4 rounded-xl border-2 ${gate.passed ? 'border-emerald-300 bg-emerald-50' : 'border-red-300 bg-red-50'}`}>
                      <div className="flex items-center gap-3">
                        {gate.passed ? (
                          <CheckCircle2 className="w-8 h-8 text-emerald-500" />
                        ) : (
                          <XCircle className="w-8 h-8 text-red-500" />
                        )}
                        <div>
                          <p className={`font-bold ${gate.passed ? 'text-emerald-700' : 'text-red-700'}`}>
                            {gate.passed ? 'Ù…Ø³ØªÙˆÙÙ‰' : 'ØºÙŠØ± Ù…Ø³ØªÙˆÙÙ‰'}
                          </p>
                          <p className="text-sm text-slate-600">{gate.label}</p>
                        </div> </div> </div>
                  ))}
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className={`bg-${selectedAuthority.color}-500 px-6 py-4`}>
                <h3 className="font-bold text-white flex items-center gap-2">
                  <FolderOpen className="w-5 h-5" />
                  Ø­Ø²Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªØ§Ø­Ø©
                </h3>
              </div>
              <div className="p-4 grid grid-cols-2 gap-4">
                {selectedAuthority.packs.map(pack => {
                  const { canGenerate } = checkHardGates(selectedAuthority.id);
                  return (
                    <div key={pack.id} className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                      <div className="flex items-center justify-between mb-3">
                        <h4 className="font-bold text-slate-800">{pack.name}</h4>
                        <span className="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded">{pack.type}</span>
                      </div>
                      <p className="text-sm text-slate-500 mb-4">{pack.nameEn}</p>
                      <button onClick={() => generatePack(selectedAuthority.id, pack.id)}
                        disabled={!canGenerate || generatingPack}
                        className={`w-full flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${canGenerate
                          ? `bg-${selectedAuthority.color}-500 text-white hover:bg-${selectedAuthority.color}-600`
                          : 'bg-slate-200 text-slate-400 cursor-not-allowed'
                          }`}>
                        {generatingPack ? (
                          <>
                            <RefreshCw className="w-5 h-5 animate-spin" />
                            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...
                          </>
                        ) : (
                          <>
                            <Download className="w-5 h-5" />
                            {canGenerate ? 'ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø©' : 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹'}
                          </>
                        )}
                      </button> </div>);
                })}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-purple-500 px-6 py-4 flex items-center justify-between">
                <h3 className="font-bold text-white flex items-center gap-2">
                  <FileText className="w-5 h-5" />
                  Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ({selectedAuthority.code} Pack)
                </h3>
                <span className="bg-white/20 text-white px-3 py-1 rounded-lg text-sm font-bold">
                  {obligationsDrilldown.length} Ø§Ù„ØªØ²Ø§Ù…
                </span> </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¯Ù„ÙŠÙ„</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¢Ø®Ø± Ø§Ø®ØªØ¨Ø§Ø±</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ù…Ø®Ø§Ù„ÙØ©</th>
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {obligationsDrilldown.map(obl => (
                      <tr key={obl.id} className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-mono text-sm text-slate-600">{obl.code}</td>
                        <td className="px-4 py-3 font-bold text-slate-800">{obl.title}</td>
                        <td className="px-4 py-3 text-center">
                          {obl.hasEvidence ? (
                            <span className="inline-flex items-center gap-1 text-emerald-600"><CheckCircle2 className="w-4 h-4" /></span>
                          ) : (
                            <span className="inline-flex items-center gap-1 text-red-600"><XCircle className="w-4 h-4" /></span>
                          )}
                        </td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${obl.lastTest === 'Pass' ? 'bg-emerald-100 text-emerald-700' :
                            obl.lastTest === 'Fail' ? 'bg-red-100 text-red-700' :
                              'bg-amber-100 text-amber-700'
                            }`}>{obl.lastTest}</span>
                        </td>
                        <td className="px-4 py-3 text-center">
                          {obl.lastChange ? (
                            <span className="text-amber-600 text-sm">{obl.lastChange}</span>
                          ) : (
                            <span className="text-slate-400">-</span>
                          )}
                        </td>
                        <td className="px-4 py-3 text-center">
                          {obl.openBreach ? (
                            <span className="inline-flex items-center gap-1 text-red-600"><AlertTriangle className="w-4 h-4" /></span>
                          ) : (
                            <span className="text-slate-400">-</span>
                          )}
                        </td> </tr>
                    ))}
                  </tbody> </table> </div> </div> </div>
        )}

        {activeTab === 'authorities' && (
          <div className="grid grid-cols-2 gap-6">
            {AUTHORITIES_CONFIG.map(auth => {
              const readiness = getReadiness(auth.id);
              return (
                <div key={auth.id} className={`bg-white rounded-2xl border-2 border-${auth.color}-200 overflow-hidden`}>
                  <div className={`bg-${auth.color}-500 px-6 py-4 flex items-center justify-between`}>
                    <div className="flex items-center gap-3 text-white">
                      <span className="text-3xl">{auth.icon}</span>
                      <div>
                        <h3 className="font-black text-xl">{auth.code}</h3>
                        <p className="text-sm opacity-80">{auth.nameAr}</p>
                      </div> </div>
                    <div className="text-4xl font-black text-white">{readiness?.readinessScore}%</div>
                  </div>
                  <div className="p-5 space-y-4">
                    <div className="grid grid-cols-3 gap-3 text-center">
                      <div className="bg-slate-50 rounded-xl p-3">
                        <p className="text-2xl font-bold text-slate-700">{auth.obligations}</p>
                        <p className="text-xs text-slate-500">Ø§Ù„ØªØ²Ø§Ù…</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-3">
                        <p className="text-2xl font-bold text-slate-700">{auth.controls}</p>
                        <p className="text-xs text-slate-500">Ø¶Ø§Ø¨Ø·</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-3">
                        <p className="text-2xl font-bold text-slate-700">{auth.packs.length}</p>
                        <p className="text-xs text-slate-500">Ø­Ø²Ù…</p>
                      </div> </div>
                    <div className="text-sm text-slate-500">
                      Ø¢Ø®Ø± ØªÙØªÙŠØ´: {auth.lastInspection}
                    </div>
                    <button onClick={() => { setActiveTab('dashboard'); setSelectedAuthority(auth); }}
                      className={`w-full py-3 bg-${auth.color}-100 text-${auth.color}-700 rounded-xl font-bold hover:bg-${auth.color}-200 transition-all`}>
                      Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©
                    </button> </div> </div>);
            })}
          </div>
        )}

        {activeTab === 'sessions' && (
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
              <h2 className="text-lg font-black text-white">Ø¬Ù…ÙŠØ¹ Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªÙØªÙŠØ´</h2>
              <button onClick={() => setShowSessionModal(true)}
                className="flex items-center gap-2 px-4 py-2 bg-cyan-500 text-white rounded-lg font-bold hover:bg-cyan-600">
                <Plus className="w-4 h-4" />
                Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù†ÙˆØ¹</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù†Ø·Ø§Ù‚</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„ÙØ¬ÙˆØ§Øª</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¥Ø¬Ø±Ø§Ø¡</th>
                  </tr> </thead>
                <tbody className="divide-y divide-slate-100">
                  {sessions.map(session => {
                    const auth = getAuthorityByCode(session.authorityCode);
                    return (
                      <tr key={session.id} className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-mono text-sm font-bold text-slate-800">{session.code}</td>
                        <td className="px-4 py-3">
                          <div className="flex items-center gap-2">
                            <span className="text-xl">{auth?.icon}</span>
                            <span className="font-bold text-slate-700">{session.authorityCode}</span>
                          </div> </td>
                        <td className="px-4 py-3 text-slate-600">{session.inspectionType}</td>
                        <td className="px-4 py-3 text-slate-600 text-sm">{session.scope}</td>
                        <td className="px-4 py-3 text-center">
                          <div className="w-20 mx-auto">
                            <div className="text-sm font-bold text-slate-700 mb-1">{session.progress}%</div>
                            <div className="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                              <div className="h-full bg-cyan-500 rounded-full" style={{ width: `${session.progress}%` }}></div>
                            </div> </div> </td>
                        <td className="px-4 py-3 text-center">
                          <span className="text-red-600 font-bold">
                            {session.findings.missingEvidence + session.findings.openBreaches}
                          </span> </td>
                        <td className="px-4 py-3 text-center text-sm text-slate-600">{session.dueDate}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded-lg text-xs font-bold ${session.status === 'Active' ? 'bg-emerald-100 text-emerald-700' :
                            session.status === 'Submitted' ? 'bg-blue-100 text-blue-700' :
                              'bg-slate-100 text-slate-700'
                            }`}>{session.status}</span>
                        </td>
                        <td className="px-4 py-3 text-center">
                          <button className="px-3 py-1 bg-cyan-500 text-white rounded-lg text-sm font-bold hover:bg-cyan-600">
                            Ù…ØªØ§Ø¨Ø¹Ø©
                          </button> </td> </tr>);
                  })}
                </tbody> </table> </div> </div>
        )}

        {activeTab === 'packs' && (
          <div className="space-y-6">
            {AUTHORITIES_CONFIG.map(auth => (
              <div key={auth.id} className={`bg-white rounded-2xl border-2 border-${auth.color}-200 overflow-hidden`}>
                <div className={`bg-${auth.color}-500 px-6 py-4 flex items-center justify-between`}>
                  <div className="flex items-center gap-3 text-white">
                    <span className="text-2xl">{auth.icon}</span>
                    <div>
                      <h3 className="font-bold">{auth.code}</h3>
                      <p className="text-sm opacity-80">{auth.nameAr}</p>
                    </div> </div>
                  <span className="bg-white/20 text-white px-3 py-1 rounded-lg text-sm font-bold">
                    {auth.packs.length} Ø­Ø²Ù…
                  </span> </div>
                <div className="p-4 grid grid-cols-4 gap-4">
                  {auth.packs.map(pack => {
                    const { canGenerate } = checkHardGates(auth.id);
                    return (
                      <div key={pack.id} className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                        <div className="flex items-center justify-between mb-2">
                          <span className="text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded">{pack.type}</span>
                          {canGenerate ? (
                            <CheckCircle2 className="w-4 h-4 text-emerald-500" />
                          ) : (
                            <AlertCircle className="w-4 h-4 text-amber-500" />
                          )}
                        </div>
                        <h4 className="font-bold text-slate-800 text-sm mb-1">{pack.name}</h4>
                        <p className="text-xs text-slate-500 mb-3">{pack.nameEn}</p>
                        <button onClick={() => { setSelectedAuthority(auth); setActiveTab('dashboard'); }}
                          className={`w-full py-2 rounded-lg text-sm font-bold transition-all ${canGenerate
                            ? `bg-${auth.color}-500 text-white hover:bg-${auth.color}-600`
                            : 'bg-slate-200 text-slate-500'
                            }`}>
                          {canGenerate ? 'ğŸ“¦ ØªÙˆÙ„ÙŠØ¯' : 'â³ ØºÙŠØ± Ø¬Ø§Ù‡Ø²'}
                        </button> </div>);
                  })}
                </div> </div>
            ))}
          </div>
        )}
      </div>

      {showSessionModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-cyan-500 to-blue-600 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <ClipboardCheck className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ø¬Ù„Ø³Ø© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯Ø©</h2>
                    <p className="text-cyan-200">New Inspection Session</p>
                  </div> </div>
                <button onClick={() => setShowSessionModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                <div className="grid grid-cols-3 gap-3">
                  {AUTHORITIES_CONFIG.slice(0, 6).map(auth => (
                    <button key={auth.id}
                      className={`p-4 rounded-xl border-2 border-${auth.color}-200 hover:border-${auth.color}-400 text-center transition-all`}>
                      <span className="text-2xl block mb-1">{auth.icon}</span>
                      <span className="font-bold text-slate-700">{auth.code}</span>
                    </button>
                  ))}
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙØªÙŠØ´</label>
                  <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option>Ø±ÙˆØªÙŠÙ†ÙŠ (Routine)</option>
                    <option>Ø­Ø§Ø¯Ø« (Incident)</option>
                    <option>ØªØ¬Ø¯ÙŠØ¯ (Renewal)</option>
                    <option>Ø®Ø§Øµ (Special)</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                  <input type="date" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙØªÙŠØ´</label>
                <textarea rows={3} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none"
                  placeholder="ÙˆØµÙ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙØªÙŠØ´..."></textarea>
              </div> </div>
            <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex justify-between">
              <button onClick={() => setShowSessionModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button className="flex items-center gap-2 px-8 py-3 bg-cyan-500 text-white rounded-xl font-bold shadow-lg">
                <Plus className="w-5 h-5" />
                Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          PACK GENERATOR WIZARD MODAL
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showPackGenerator && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-emerald-600 to-teal-700 px-8 py-5 text-white flex-shrink-0">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Package className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ù…Ø¹Ø§Ù„Ø¬ ØªÙˆÙ„ÙŠØ¯ Ø­Ø²Ù…Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ</h2>
                    <p className="text-emerald-200 text-sm">Regulator Submission Pack Generator</p>
                  </div> </div>
                <button onClick={closePackGenerator} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div>
              <div className="flex items-center justify-between">
                {['Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„Ø¬Ù„Ø³Ø©', 'Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø²Ù…Ø©', 'Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚', 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', 'Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±'].map((label, idx) => (
                  <div key={idx} className="flex items-center">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${packGen.step > idx ? 'bg-white text-emerald-600' : packGen.step === idx ? 'bg-white/30 text-white ring-2 ring-white' : 'bg-white/10 text-white/50'
                      }`}>
                      {packGen.step > idx ? <Check className="w-4 h-4" /> : idx}
                    </div>
                    <span className={`mr-1 text-xs hidden lg:inline ${packGen.step >= idx ? 'text-white' : 'text-white/50'}`}>{label}</span>
                    {idx < 4 && <div className={`w-4 lg:w-8 h-0.5 mx-1 ${packGen.step > idx ? 'bg-white' : 'bg-white/20'}`}></div>}
                  </div>
                ))}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              {packGen.step === 0 && (
                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                    <div className="grid grid-cols-6 gap-2">
                      {AUTHORITIES_CONFIG.map(auth => (
                        <button key={auth.code} type="button" onClick={() => dispatchPG({ type: 'SET_AUTHORITY', payload: auth.code })}
                          className={`p-3 rounded-xl border-2 text-center transition-all ${packGen.authorityCode === auth.code ? `border-emerald-500 bg-emerald-50 ring-2 ring-emerald-300` : 'border-slate-200 hover:border-slate-400'
                            }`}>
                          <span className="text-2xl block mb-1">{auth.icon}</span>
                          <span className="text-xs font-bold text-slate-700">{auth.code}</span>
                        </button>
                      ))}
                    </div> </div>
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <p className="text-sm text-slate-500 mb-1">ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø© (Pack Code)</p>
                    <p className="font-mono font-bold text-lg text-slate-800">{packGen.packCode}</p>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-3">Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙØªÙŠØ´</label>
                    <select value={packGen.sessionId || ''} onChange={(e) => dispatchPG({ type: 'SET_SESSION', payload: e.target.value ? parseInt(e.target.value) : null })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl mb-3">
                      <option value="">-- Ø§Ø®ØªØ± Ø¬Ù„Ø³Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ø³Ø±ÙŠØ¹Ø© --</option>
                      {sessions.filter(s => s.authorityCode === packGen.authorityCode).map(s => (
                        <option key={s.id} value={s.id}>{s.code} - {s.scope} ({s.status})</option>
                      ))}
                    </select>
                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                      <p className="text-sm font-bold text-blue-700 mb-3">Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø³Ø±ÙŠØ¹Ø©</p>
                      <div className="grid grid-cols-2 gap-3">
                        <input type="date" value={packGen.quickSession.dueDate} onChange={(e) => dispatchPG({ type: 'SET_QUICK_SESSION', payload: { dueDate: e.target.value } })}
                          className="px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                        <input type="text" placeholder="Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙØªÙŠØ´" value={packGen.quickSession.scope} onChange={(e) => dispatchPG({ type: 'SET_QUICK_SESSION', payload: { scope: e.target.value } })}
                          className="px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                      </div> </div> </div> </div>
              )}

              {packGen.step === 1 && (
                <div className="space-y-6">
                  <h3 className="text-lg font-bold text-slate-800">Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø­Ø²Ù…Ø©</h3>
                  <div className="space-y-3">
                    {[
                      { key: 'obligations', label: 'Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', labelEn: 'Obligations Register', count: packGen.counters.obligations },
                      { key: 'evidence', label: 'Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©', labelEn: 'Evidence (Accepted)', count: packGen.counters.evidence },
                      { key: 'tests', label: 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', labelEn: 'Test Results', count: packGen.counters.tests },
                      { key: 'breaches', label: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ÙˆØ§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', labelEn: 'Breaches & Exceptions', count: packGen.counters.breaches },
                      { key: 'auditTrail', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', labelEn: 'Audit Trail', count: 1 },
                    ].map(item => (
                      <label key={item.key} className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer ${packGen.sections[item.key] ? 'border-emerald-400 bg-emerald-50' : 'border-slate-200 bg-white'
                        }`}>
                        <div className="flex items-center gap-3">
                          <input type="checkbox" checked={packGen.sections[item.key]} onChange={() => dispatchPG({ type: 'TOGGLE_SECTION', payload: item.key })}
                            className="w-5 h-5 text-emerald-500 rounded" />
                          <div>
                            <p className="font-bold text-slate-800">{item.label}</p>
                            <p className="text-xs text-slate-500">{item.labelEn}</p>
                          </div> </div>
                        <span className="bg-slate-100 text-slate-700 px-3 py-1 rounded-lg font-bold">{item.count}</span>
                      </label>
                    ))}
                  </div>
                  <div className="bg-slate-100 rounded-xl p-4">
                    <p className="text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª:</p>
                    <div className="grid grid-cols-4 gap-3 text-center">
                      <div className="bg-white rounded-lg p-3"><p className="text-2xl font-black text-purple-600">{packGen.counters.obligations}</p><p className="text-xs text-slate-500">Ø§Ù„ØªØ²Ø§Ù…</p></div>
                      <div className="bg-white rounded-lg p-3"><p className="text-2xl font-black text-blue-600">{packGen.counters.evidence}</p><p className="text-xs text-slate-500">Ø¯Ù„ÙŠÙ„ Ù…Ù‚Ø¨ÙˆÙ„</p></div>
                      <div className="bg-white rounded-lg p-3"><p className="text-2xl font-black text-cyan-600">{packGen.counters.tests}</p><p className="text-xs text-slate-500">Ø§Ø®ØªØ¨Ø§Ø±</p></div>
                      <div className="bg-white rounded-lg p-3"><p className="text-2xl font-black text-amber-600">{packGen.counters.breaches}</p><p className="text-xs text-slate-500">Ù…Ø®Ø§Ù„ÙØ©</p></div>
                    </div> </div> </div>
              )}

              {packGen.step === 2 && (
                <div className="space-y-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-bold text-slate-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© (Hard Gates)</h3>
                    <button onClick={computeHardGates} className="text-sm text-blue-600 hover:underline flex items-center gap-1">
                      <RefreshCw className="w-4 h-4" /> ØªØ­Ø¯ÙŠØ«
                    </button> </div>
                  <div className="space-y-3">
                    {packGen.hardGates.map((gate, idx) => (
                      <div key={idx} className={`p-4 rounded-xl border-2 ${gate.passed ? 'border-emerald-300 bg-emerald-50' : 'border-red-300 bg-red-50'}`}>
                        <div className="flex items-start justify-between">
                          <div className="flex items-start gap-3">
                            {gate.passed ? <CheckCircle2 className="w-6 h-6 text-emerald-500 mt-0.5" /> : <XCircle className="w-6 h-6 text-red-500 mt-0.5" />}
                            <div>
                              <p className={`font-bold ${gate.passed ? 'text-emerald-700' : 'text-red-700'}`}>{gate.label}</p>
                              {gate.reason && <p className="text-sm text-red-600 mt-1">{gate.reason}</p>}
                            </div> </div>
                          <div className="flex items-center gap-2">
                            {gate.blocking && !gate.passed && <span className="text-xs bg-red-200 text-red-700 px-2 py-1 rounded font-bold">Ø­Ø§Ø¬Ø²</span>}
                            {!gate.passed && gate.items && gate.items.length > 0 && (
                              <button className="text-xs bg-blue-500 text-white px-3 py-1 rounded-lg font-bold hover:bg-blue-600">Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¢Ù†</button>
                            )}
                          </div> </div> </div>
                    ))}
                  </div>
                  <div className={`p-4 rounded-xl ${packGen.gatesPassed ? 'bg-emerald-100 border-2 border-emerald-300' : 'bg-red-100 border-2 border-red-300'}`}>
                    <p className={`font-bold ${packGen.gatesPassed ? 'text-emerald-700' : 'text-red-700'}`}>
                      {packGen.gatesPassed ? 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ø¬Ø²Ø© Ù…Ø³ØªÙˆÙØ§Ø© - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'âŒ ØªÙˆØ¬Ø¯ Ø¨ÙˆØ§Ø¨Ø§Øª Ø­Ø§Ø¬Ø²Ø© ØºÙŠØ± Ù…Ø³ØªÙˆÙØ§Ø©'}
                    </p> </div> </div>
              )}

              {packGen.step === 3 && (
                <div className="space-y-6">
                  <h3 className="text-lg font-bold text-slate-800">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ *</label>
                    <select value={packGen.approver?.id || ''} onChange={(e) => {
                      const app = PACK_API.approvers.find(a => a.id === parseInt(e.target.value));
                      dispatchPG({ type: 'SET_APPROVER', payload: app });
                    }} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ --</option>
                      {PACK_API.approvers.map(a => <option key={a.id} value={a.id}>{a.name} - {a.role}</option>)}
                    </select>
                  </div>
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø²Ù…Ø©: <span className="font-mono text-blue-600">{packGen.packCode}</span></label>
                    <input type="text" placeholder={packGen.packCode} value={packGen.confirmText} onChange={(e) => dispatchPG({ type: 'SET_CONFIRM_TEXT', payload: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl font-mono" />
                  </div>
                  <label className={`flex items-start gap-3 p-4 rounded-xl border-2 cursor-pointer ${packGen.confirmed ? 'border-emerald-400 bg-emerald-50' : 'border-slate-200 bg-white'}`}>
                    <input type="checkbox" checked={packGen.confirmed} disabled={packGen.confirmText !== packGen.packCode || !packGen.approver}
                      onChange={(e) => dispatchPG({ type: 'SET_CONFIRMED', payload: e.target.checked })} className="w-5 h-5 text-emerald-500 rounded mt-0.5" />
                    <div>
                      <p className="font-bold text-slate-700">Ø£Ù‚Ø± Ø¨Ø£Ù†Ù†ÙŠ Ø±Ø§Ø¬Ø¹Øª Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø­Ø²Ù…Ø© ÙˆØ£Ø¹ØªÙ…Ø¯Ù‡Ø§ Ù„Ù„ØªØ³Ù„ÙŠÙ…</p>
                      <p className="text-sm text-slate-500">Ø¨ØµÙØªÙŠ {packGen.approver?.name || '...'} - {packGen.approver?.role || '...'}</p>
                    </div>
                  </label>
                  {packGen.signOffTime && (
                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <p className="text-emerald-700 font-bold">âœ… ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ÙÙŠ: {new Date(packGen.signOffTime).toLocaleString('ar-SA')}</p>
                    </div>
                  )}
                </div>
              )}

              {packGen.step === 4 && (
                <div className="space-y-6">
                  {!packGen.generated && !packGen.loading && (
                    <>
                      <h3 className="text-lg font-bold text-slate-800">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø©</h3>
                      <div className="bg-slate-50 rounded-xl p-4 font-mono text-sm text-slate-600">
                        <p className="font-bold text-slate-700 mb-2">Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø²Ù…Ø©:</p>
                        <p>ğŸ“ /01_Executive_Summary/summary.txt</p>
                        <p>ğŸ“ /02_Obligation_Register/index.csv</p>
                        <p>ğŸ“ /03_Evidence/evidence_index.csv</p>
                        <p>ğŸ“ /04_Test_Results/test_results.csv</p>
                        <p>ğŸ“ /05_Breaches_and_CAPA/breaches.csv</p>
                        <p>ğŸ“ /06_Audit_Trail_Log/audit.txt</p>
                      </div>
                      <button onClick={finalizePackGeneration} className="w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl">
                        ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯
                      </button>
                    </>
                  )}
                  {packGen.loading && (
                    <div className="text-center py-12">
                      <RefreshCw className="w-16 h-16 text-emerald-500 mx-auto animate-spin mb-4" />
                      <p className="text-xl font-bold text-slate-800">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø©...</p>
                    </div>
                  )}
                  {packGen.generated && (
                    <div className="space-y-6">
                      <div className="bg-emerald-100 rounded-xl p-6 border-2 border-emerald-300 text-center">
                        <CheckCircle2 className="w-16 h-16 text-emerald-500 mx-auto mb-3" />
                        <p className="text-xl font-bold text-emerald-700">âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!</p>
                        <p className="text-emerald-600 font-mono">{packGen.generatedPackId}</p>
                      </div>
                      <div>
                        <p className="font-bold text-slate-700 mb-3">ØªØµØ¯ÙŠØ± Ø§Ù„Ø­Ø²Ù…Ø©:</p>
                        <div className="grid grid-cols-3 gap-4">
                          <button onClick={exportZIP} className="flex flex-col items-center gap-2 p-6 bg-blue-50 rounded-xl border-2 border-blue-200 hover:border-blue-400">
                            <FolderOpen className="w-10 h-10 text-blue-500" /><span className="font-bold text-blue-700">ZIP Package</span><span className="text-xs text-blue-500">.zip</span>
                          </button>
                          <button onClick={exportPDF} className="flex flex-col items-center gap-2 p-6 bg-red-50 rounded-xl border-2 border-red-200 hover:border-red-400">
                            <FileText className="w-10 h-10 text-red-500" /><span className="font-bold text-red-700">PDF Report</span><span className="text-xs text-red-500">.pdf</span>
                          </button>
                          <button onClick={exportExcelIndex} className="flex flex-col items-center gap-2 p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200 hover:border-emerald-400">
                            <Table className="w-10 h-10 text-emerald-500" /><span className="font-bold text-emerald-700">Excel Index</span><span className="text-xs text-emerald-500">.csv</span>
                          </button> </div> </div>
                      <div className="bg-slate-100 rounded-xl p-4 flex justify-between">
                        <span className="text-sm text-slate-600">Ø¹Ø¯Ø¯ Ø§Ù„ØªØµØ¯ÙŠØ±Ø§Øª: <span className="font-bold">{packGen.exportCount}</span></span>
                        <span className="text-sm text-slate-600">ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø£Ø±Ø´ÙŠÙ Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>
                      </div> </div>
                  )}
                </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-8 py-4 bg-slate-50 flex justify-between flex-shrink-0">
              <button onClick={() => packGen.step > 0 ? dispatchPG({ type: 'PREV_STEP' }) : closePackGenerator()}
                className="px-6 py-2 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                {packGen.step === 0 ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø§Ù„Ø³Ø§Ø¨Ù‚'}
              </button>
              {packGen.step < 4 && (
                <button onClick={() => {
                  if (packGen.step === 0) computePackCounters();
                  if (packGen.step === 1) computeHardGates();
                  dispatchPG({ type: 'NEXT_STEP' });
                }}
                  disabled={
                    (packGen.step === 0 && !packGen.sessionId && (!packGen.quickSession.dueDate || !packGen.quickSession.scope)) ||
                    (packGen.step === 2 && !packGen.gatesPassed) ||
                    (packGen.step === 3 && !packGen.confirmed)
                  }
                  className={`flex items-center gap-2 px-8 py-2 rounded-xl font-bold ${((packGen.step === 0 && (packGen.sessionId || (packGen.quickSession.dueDate && packGen.quickSession.scope))) ||
                    packGen.step === 1 ||
                    (packGen.step === 2 && packGen.gatesPassed) ||
                    (packGen.step === 3 && packGen.confirmed))
                    ? 'bg-emerald-500 text-white hover:bg-emerald-600' : 'bg-slate-200 text-slate-400 cursor-not-allowed'
                    }`}>
                  Ø§Ù„ØªØ§Ù„ÙŠ <ChevronLeft className="w-4 h-4" />
                </button>
              )}
              {packGen.step === 4 && packGen.generated && (
                <button onClick={closePackGenerator} className="px-8 py-2 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">Ø¥ØºÙ„Ø§Ù‚</button>
              )}
            </div> </div> </div>
      )}

      {activeTab === 'archive' && (
        <div className="p-6 space-y-6">
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="bg-slate-800 px-6 py-4">
              <h2 className="text-lg font-black text-white flex items-center gap-2">
                <Archive className="w-5 h-5 text-cyan-400" />
                Ø£Ø±Ø´ÙŠÙ Ø­Ø²Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ…
              </h2>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Pack ID</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¬Ù„Ø³Ø©</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙ„ÙŠØ¯</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„ØªØµØ¯ÙŠØ±Ø§Øª</th>
                  </tr> </thead>
                <tbody className="divide-y divide-slate-100">
                  {submissionArchive.map(record => (
                    <tr key={record.id} className="hover:bg-slate-50 cursor-pointer">
                      <td className="px-4 py-3 font-mono text-sm font-bold text-slate-800">{record.packId}</td>
                      <td className="px-4 py-3">
                        <span className={`px-2 py-1 rounded text-xs font-bold ${record.authority === 'SAMA' ? 'bg-emerald-100 text-emerald-700' :
                          record.authority === 'NCA' ? 'bg-purple-100 text-purple-700' : 'bg-slate-100 text-slate-700'
                          }`}>{record.authority}</span>
                      </td>
                      <td className="px-4 py-3 text-slate-600">{record.sessionCode}</td>
                      <td className="px-4 py-3 text-slate-600">{record.approvedBy}</td>
                      <td className="px-4 py-3 text-center text-sm text-slate-600">{new Date(record.generatedAt).toLocaleDateString('ar-SA')}</td>
                      <td className="px-4 py-3 text-center"><span className="bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">{record.exportCount}</span></td>
                    </tr>
                  ))}
                </tbody> </table> </div> </div> </div>
      )}

      {showExportApprovalModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden">
            <div className="bg-gradient-to-l from-teal-500 to-cyan-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><FileCheck className="w-6 h-6" /></div>
                <div>
                  <h2 className="text-xl font-bold">Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ ØªØµØ¯ÙŠØ± Ø§Ù„Ø­Ø²Ù…Ø©</h2>
                  <p className="text-teal-200 text-sm">DOA - ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙÙˆØ¶Ø©</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-4">
                <div className="flex items-center gap-2 text-amber-700 font-bold mb-2">
                  <AlertTriangle className="w-5 h-5" />
                  <span>ÙŠØªØ·Ù„Ø¨ ØªØµØ¯ÙŠØ± Ø§Ù„Ø­Ø²Ù…Ø© Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø³Ø¨Ù‚</span>
                </div>
                <p className="text-sm text-amber-600">
                  ØªØµØ¯ÙŠØ± Ø­Ø²Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© ÙŠØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ø§Ù„Ù…Ø®ÙˆÙ„ÙŠÙ† (CCO)
                </p> </div>
              <div className="bg-slate-50 rounded-xl p-4 mb-4">
                <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ø­Ø²Ù…Ø©:</p>
                <p className="font-bold text-slate-800">{packGen.packCode}</p>
                <p className="text-slate-600">Ø§Ù„Ø¬Ù‡Ø©: {packGen.authorityCode}</p>
                <div className="flex items-center gap-2 mt-2">
                  <span className="px-2 py-1 rounded text-xs font-bold bg-teal-100 text-teal-700">
                    {exportType === 'zip' ? 'ZIP' : exportType === 'pdf' ? 'PDF' : 'Excel'}
                  </span>
                  <span className="px-2 py-1 rounded text-xs font-bold bg-red-100 text-red-700">Critical</span>
                </div> </div>
              <div className="mb-4">
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø·Ù„Ø¨ Ø§Ù„ØªØµØ¯ÙŠØ±</label>
                <textarea
                  value={exportApprovalNotes}
                  onChange={(e) => setExportApprovalNotes(e.target.value)}
                  placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„ØºØ±Ø¶ Ù…Ù†Ù‡..."
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-500 focus:outline-none resize-none h-24"
                />
              </div>

              <div className="bg-teal-50 rounded-xl p-4">
                <p className="text-sm font-bold text-teal-700 mb-2">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙˆÙ† Ø§Ù„Ù…Ø®ÙˆÙ„ÙˆÙ†:</p>
                <div className="flex flex-wrap gap-2">
                  <span className="px-3 py-1 bg-teal-100 text-teal-700 rounded-lg text-sm font-bold">Ø±Ø¦ÙŠØ³ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ (CCO)</span>
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowExportApprovalModal(false); setExportType(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => {
                const result = ApprovalService.createRequest(
                  currentUser?.id || 1,
                  'INSPECTIONS',
                  'EXPORT',
                  'Critical',
                  'LE-001',
                  'PACK',
                  packGen.packCode,
                  `ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© ${packGen.authorityCode}`,
                  exportApprovalNotes
                );
                if (result.success) {
                  showNotification(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØµØ¯ÙŠØ± - ÙŠØªØ·Ù„Ø¨ ${result.chain.requiresDualApproval ? 'Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠÙ†' : 'Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ§Ø­Ø¯'}`);
                  setShowExportApprovalModal(false);
                  setExportType(null);
                  setExportApprovalNotes('');
                } else {
                  showNotification(`â›” ${result.error}`, 'error');
                }
              }}
                className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-xl font-bold">
                <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 5.3: Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ
// Maturity Assessment - World-Class Premium Edition
// Features: Multi-level Assessment, Gap Analysis, Benchmarking, Trends, Improvements

const MaturityAssessment = () => {
  const [activeTab, setActiveTab] = useState('overview');
  const [selectedAuthority, setSelectedAuthority] = useState(null);
  const [selectedFramework, setSelectedFramework] = useState(null);
  const [showAssessmentModal, setShowAssessmentModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [assessmentMode, setAssessmentMode] = useState('authority'); // authority | framework | control
  const [viewMode, setViewMode] = useState('cards'); // cards | table | chart

  const [showAddModal, setShowAddModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [showViewModal, setShowViewModal] = useState(false);
  const [selectedAssessment, setSelectedAssessment] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);

  // Wizard State
  const [wizardStep, setWizardStep] = useState(1);
  const [viewTab, setViewTab] = useState('overview');

  const [showQuestionnaireModal, setShowQuestionnaireModal] = useState(false);
  const [showRoadmapModal, setShowRoadmapModal] = useState(false);
  const [showInitiativeModal, setShowInitiativeModal] = useState(false);
  const [showBenchmarkModal, setShowBenchmarkModal] = useState(false);
  const [showRadarChart, setShowRadarChart] = useState(false);
  const [showHeatMap, setShowHeatMap] = useState(false);
  const [assessmentType, setAssessmentType] = useState('self'); // self | external
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [questionAnswers, setQuestionAnswers] = useState({});

  const [showFrameworkModal, setShowFrameworkModal] = useState(false);
  const [showFrameworkDetailModal, setShowFrameworkDetailModal] = useState(false);
  const [showTemplateModal, setShowTemplateModal] = useState(false);
  const [frameworkModalMode, setFrameworkModalMode] = useState('create'); // create | edit
  const [searchFramework, setSearchFramework] = useState('');
  const [frameworkFormData, setFrameworkFormData] = useState({
    id: null, code: '', name: '', nameAr: '', version: '1.0', levels: 5, domains: 5, status: 'Active', description: ''
  });
  const [templateFormData, setTemplateFormData] = useState({
    id: null, code: '', name: '', frameworkId: null, questionCount: 20, duration: '2 Ø³Ø§Ø¹Ø§Øª', status: 'Active'
  });
  const [notification, setNotification] = useState(null);

  const showNotificationMsg = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  // Framework CRUD handlers
  const handleOpenAddFramework = () => {
    setFrameworkFormData({ id: null, code: '', name: '', nameAr: '', version: '1.0', levels: 5, domains: 5, status: 'Active', description: '' });
    setFrameworkModalMode('create');
    setShowFrameworkModal(true);
  };

  const handleOpenEditFramework = (fw) => {
    setFrameworkFormData({ ...fw });
    setFrameworkModalMode('edit');
    setShowFrameworkModal(true);
  };

  const handleSaveFramework = () => {
    if (!frameworkFormData.code || !frameworkFormData.nameAr) {
      showNotificationMsg('Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
      return;
    }
    if (frameworkModalMode === 'create') {
      const newFw = { ...frameworkFormData, id: frameworks.length + 1 };
      setFrameworks([...frameworks, newFw]);
      showNotificationMsg('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
    } else {
      setFrameworks(frameworks.map(f => f.id === frameworkFormData.id ? frameworkFormData : f));
      showNotificationMsg('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
    }
    setShowFrameworkModal(false);
  };

  const handleDeleteFramework = (fw) => {
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø± "${fw.nameAr}"ØŸ`)) {
      setFrameworks(frameworks.filter(f => f.id !== fw.id));
      setSelectedFramework(null);
      showNotificationMsg('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
    }
  };

  const handleToggleFrameworkStatus = (fw) => {
    setFrameworks(frameworks.map(f => f.id === fw.id ? { ...f, status: f.status === 'Active' ? 'Inactive' : 'Active' } : f));
    showNotificationMsg(`ØªÙ… ${fw.status === 'Active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'} Ø§Ù„Ø¥Ø·Ø§Ø±`);
  };

  // Template CRUD handlers
  const handleOpenAddTemplate = () => {
    setTemplateFormData({ id: null, code: '', name: '', frameworkId: null, questionCount: 20, duration: '2 Ø³Ø§Ø¹Ø§Øª', status: 'Active' });
    setShowTemplateModal(true);
  };

  const handleSaveTemplate = () => {
    if (!templateFormData.code || !templateFormData.name) {
      showNotificationMsg('Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
      return;
    }
    const newTpl = { ...templateFormData, id: assessmentTemplates.length + 1 };
    setAssessmentTemplates([...assessmentTemplates, newTpl]);
    showNotificationMsg('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    setShowTemplateModal(false);
  };

  const filteredFrameworks = frameworks.filter(fw =>
    searchFramework === '' ||
    fw.nameAr.includes(searchFramework) ||
    fw.name.toLowerCase().includes(searchFramework.toLowerCase()) ||
    fw.code.toLowerCase().includes(searchFramework.toLowerCase())
  );

  const [frameworks, setFrameworks] = useState([
    {
      id: 1, code: 'CMMI', name: 'CMMI for Services', nameAr: 'Ù†Ù…ÙˆØ°Ø¬ Ù†Ø¶Ø¬ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª', version: 'v2.0', levels: 5, domains: 10, status: 'Active',
      description: 'Ù†Ù…ÙˆØ°Ø¬ Ø´Ø§Ù…Ù„ Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ø¶Ø¬ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª'
    },
    {
      id: 2, code: 'COBIT', name: 'COBIT 2019', nameAr: 'Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', version: '2019', levels: 5, domains: 40, status: 'Active',
      description: 'Ø¥Ø·Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©'
    },
    {
      id: 3, code: 'ISO27001', name: 'ISO 27001 Maturity', nameAr: 'Ù†Ø¶Ø¬ Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', version: '2022', levels: 5, domains: 14, status: 'Active',
      description: 'ØªÙ‚ÙŠÙŠÙ… Ù†Ø¶Ø¬ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'
    },
    {
      id: 4, code: 'CUSTOM-GRC', name: 'GRC Custom Framework', nameAr: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ù…Ø®ØµØµ', version: '1.0', levels: 5, domains: 8, status: 'Active',
      description: 'Ø¥Ø·Ø§Ø± ØªÙ‚ÙŠÙŠÙ… Ù…Ø®ØµØµ Ù„Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„'
    },
    {
      id: 5, code: 'NIST-CSF', name: 'NIST Cybersecurity Framework', nameAr: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', version: '2.0', levels: 4, domains: 6, status: 'Active',
      description: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±'
    },
  ]);

  const [assessmentTemplates, setAssessmentTemplates] = useState([
    { id: 1, code: 'TPL-SAMA', name: 'Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… SAMA', frameworkId: 4, authorityId: 1, questionCount: 45, duration: '4 Ø³Ø§Ø¹Ø§Øª', status: 'Active' },
    { id: 2, code: 'TPL-NCA', name: 'Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… NCA ECC', frameworkId: 3, authorityId: 3, questionCount: 60, duration: '6 Ø³Ø§Ø¹Ø§Øª', status: 'Active' },
    { id: 3, code: 'TPL-COBIT', name: 'Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… COBIT', frameworkId: 2, authorityId: null, questionCount: 80, duration: '8 Ø³Ø§Ø¹Ø§Øª', status: 'Active' },
    { id: 4, code: 'TPL-QUICK', name: 'ØªÙ‚ÙŠÙŠÙ… Ø³Ø±ÙŠØ¹', frameworkId: 4, authorityId: null, questionCount: 20, duration: '1 Ø³Ø§Ø¹Ø©', status: 'Active' },
  ]);

  const [assessmentQuestions, setAssessmentQuestions] = useState([
    {
      id: 1, templateId: 1, domain: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', question: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ù‡ÙŠÙƒÙ„ Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ø¶Ø­ ÙˆÙ…Ø¹ØªÙ…Ø¯ØŸ', weight: 3, evidenceRequired: true,
      options: [
        { value: 1, label: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯', description: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡ÙŠÙƒÙ„ Ø­ÙˆÙƒÙ…Ø© Ù…Ø­Ø¯Ø¯' },
        { value: 2, label: 'Ø¬Ø²Ø¦ÙŠ', description: 'ÙŠÙˆØ¬Ø¯ Ù‡ÙŠÙƒÙ„ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„' },
        { value: 3, label: 'Ù…Ø­Ø¯Ø¯', description: 'ÙŠÙˆØ¬Ø¯ Ù‡ÙŠÙƒÙ„ Ù…Ø­Ø¯Ø¯ ÙˆÙ…ÙˆØ«Ù‚' },
        { value: 4, label: 'Ù…ÙØ·Ø¨Ù‚', description: 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ù…Ø·Ø¨Ù‚ ÙˆÙØ¹Ø§Ù„' },
        { value: 5, label: 'Ù…Ø­Ø³Ù‘Ù†', description: 'Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙŠØ®Ø¶Ø¹ Ù„Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø±' },
      ]
    },
    {
      id: 2, templateId: 1, domain: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', question: 'Ù‡Ù„ ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠØŸ', weight: 2, evidenceRequired: true,
      options: [
        { value: 1, label: 'Ø£Ø¨Ø¯Ø§Ù‹', description: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø©' },
        { value: 2, label: 'Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨ÙŠØ© ÙÙ‚Ø·' },
        { value: 3, label: 'Ø³Ù†ÙˆÙŠØ§Ù‹', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ù†ÙˆÙŠØ© Ù…Ù†ØªØ¸Ù…Ø©' },
        { value: 4, label: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒÙ„ 6 Ø£Ø´Ù‡Ø±' },
        { value: 5, label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª' },
      ]
    },
    {
      id: 3, templateId: 1, domain: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', question: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù…Ø®Ø§Ø·Ø± Ù…Ø­Ø¯Ø«ØŸ', weight: 3, evidenceRequired: true,
      options: [
        { value: 1, label: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯', description: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù…Ø®Ø§Ø·Ø±' },
        { value: 2, label: 'Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ø§Ø³ÙŠØ©', description: 'Ù‚Ø§Ø¦Ù…Ø© Ù…Ø®Ø§Ø·Ø± Ø¨Ø³ÙŠØ·Ø©' },
        { value: 3, label: 'Ø³Ø¬Ù„ Ù…ÙˆØ«Ù‚', description: 'Ø³Ø¬Ù„ Ù…Ø®Ø§Ø·Ø± Ø±Ø³Ù…ÙŠ' },
        { value: 4, label: 'Ø³Ø¬Ù„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ', description: 'Ø³Ø¬Ù„ ÙŠÙØ­Ø¯Ø« Ø¨Ø§Ù†ØªØ¸Ø§Ù…' },
        { value: 5, label: 'Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„', description: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø´Ø§Ù…Ù„' },
      ]
    },
    {
      id: 4, templateId: 1, domain: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', question: 'Ù…Ø§ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©ØŸ', weight: 4, evidenceRequired: true,
      options: [
        { value: 1, label: 'ØºÙŠØ± Ù…Ù…ØªØ«Ù„', description: 'Ø¹Ø¯Ù… Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ø¶Ø­' },
        { value: 2, label: 'Ø§Ù…ØªØ«Ø§Ù„ Ø¬Ø²Ø¦ÙŠ', description: 'Ø§Ù…ØªØ«Ø§Ù„ Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª' },
        { value: 3, label: 'Ø§Ù…ØªØ«Ø§Ù„ Ø£Ø³Ø§Ø³ÙŠ', description: 'Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' },
        { value: 4, label: 'Ø§Ù…ØªØ«Ø§Ù„ ÙƒØ§Ù…Ù„', description: 'Ø§Ù…ØªØ«Ø§Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª' },
        { value: 5, label: 'ØªÙ…ÙŠØ²', description: 'ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª' },
      ]
    },
    {
      id: 5, templateId: 1, domain: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨', question: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ ÙˆØªÙˆØ¹ÙŠØ© Ø´Ø§Ù…Ù„ØŸ', weight: 2, evidenceRequired: false,
      options: [
        { value: 1, label: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯', description: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨' },
        { value: 2, label: 'ØªØ¯Ø±ÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ', description: 'ØªØ¯Ø±ÙŠØ¨ ØºÙŠØ± Ù…Ù†ØªØ¸Ù…' },
        { value: 3, label: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ø³Ø§Ø³ÙŠ', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ Ù…Ø­Ø¯Ø¯' },
        { value: 4, label: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø´Ø§Ù…Ù„', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙŠØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†' },
        { value: 5, label: 'ØªØ¹Ù„Ù… Ù…Ø³ØªÙ…Ø±', description: 'Ø«Ù‚Ø§ÙØ© ØªØ¹Ù„Ù… Ù…Ø³ØªÙ…Ø± Ù…Ø¹ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±' },
      ]
    },
  ]);

  const [initiatives, setInitiatives] = useState([
    {
      id: 1, assessmentId: 1, title: 'Ù…Ø´Ø±ÙˆØ¹ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', description: 'ØªØ­Ø¯ÙŠØ« Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØªØ¹Ø²ÙŠØ² Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©',
      targetDomain: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', currentLevel: 4, targetLevel: 5, priority: 'High',
      status: 'InProgress', startDate: '2025-01-15', endDate: '2025-06-30',
      budget: 250000, spentBudget: 85000, progress: 35,
      resources: [
        { type: 'Internal', name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', allocation: 50 },
        { type: 'Internal', name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Ù…Ø­Ù„Ù„ Ø­ÙˆÙƒÙ…Ø©', allocation: 100 },
        { type: 'External', name: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª', role: 'Ù…Ø³ØªØ´Ø§Ø± Ø®Ø§Ø±Ø¬ÙŠ', allocation: 30 },
      ],
      milestones: [
        { id: 1, title: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ', status: 'Completed', date: '2025-02-01' },
        { id: 2, title: 'ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯', status: 'InProgress', date: '2025-03-15' },
        { id: 3, title: 'Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨', status: 'Planned', date: '2025-05-01' },
        { id: 4, title: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†', status: 'Planned', date: '2025-06-30' },
      ]
    },
    {
      id: 2, assessmentId: 2, title: 'ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', description: 'Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ù†Ø¶Ø¬ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      targetDomain: 'Ø£Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª', currentLevel: 3, targetLevel: 5, priority: 'Critical',
      status: 'InProgress', startDate: '2025-02-01', endDate: '2025-08-31',
      budget: 500000, spentBudget: 120000, progress: 25,
      resources: [
        { type: 'Internal', name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', allocation: 60 },
        { type: 'Internal', name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Ù…Ø­Ù„Ù„ Ø£Ù…Ù†ÙŠ', allocation: 100 },
        { type: 'External', name: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ù…Ù†', role: 'Ø®Ø¨ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', allocation: 40 },
      ],
      milestones: [
        { id: 1, title: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø«ØºØ±Ø§Øª', status: 'Completed', date: '2025-02-28' },
        { id: 2, title: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', status: 'InProgress', date: '2025-04-30' },
        { id: 3, title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', status: 'Planned', date: '2025-06-30' },
        { id: 4, title: 'Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚', status: 'Planned', date: '2025-08-31' },
      ]
    },]);
  const [benchmarkData, setBenchmarkData] = useState({
    industry: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…ØµØ±ÙÙŠØ©', sampleSize: 45, lastUpdated: '2025-01-01',
    categories: [
      { domain: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', ourScore: 85, industryAvg: 72, topQuartile: 88, bottomQuartile: 58 },
      { domain: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', ourScore: 78, industryAvg: 68, topQuartile: 82, bottomQuartile: 52 },
      { domain: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', ourScore: 88, industryAvg: 75, topQuartile: 90, bottomQuartile: 60 },
      { domain: 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', ourScore: 72, industryAvg: 70, topQuartile: 85, bottomQuartile: 55 },
      { domain: 'Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', ourScore: 71, industryAvg: 65, topQuartile: 80, bottomQuartile: 48 },
      { domain: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©', ourScore: 80, industryAvg: 62, topQuartile: 78, bottomQuartile: 45 },
    ]
  });

  // Domain Scores State
  const [domainScores, setDomainScores] = useState({
    governance: { score: 70, level: 3 }, riskManagement: { score: 65, level: 3 }, compliance: { score: 75, level: 4 },
    audit: { score: 60, level: 3 }, training: { score: 70, level: 3 },
  });

  // Improvement Actions
  const [improvementActions, setImprovementActions] = useState([]);

  // Form State for Add/Edit
  const [formData, setFormData] = useState({
    authorityCode: '', currentLevel: 1, targetLevel: 3, assessor: '',
    assessmentDate: new Date().toISOString().split('T')[0], nextAssessment: '', status: 'InProgress', notes: '',
    domains: [], frameworkId: null, templateId: null,
    assessmentType: 'self'
  });

  // Reset Form
  const resetForm = () => {
    setFormData({
      authorityCode: '', currentLevel: 1, targetLevel: 3, assessor: '',
      assessmentDate: new Date().toISOString().split('T')[0], nextAssessment: '', status: 'InProgress', notes: '',
      domains: []
    });
    setWizardStep(1);
    setDomainScores({
      governance: { score: 70, level: 3 }, riskManagement: { score: 65, level: 3 }, compliance: { score: 75, level: 4 },
      audit: { score: 60, level: 3 }, training: { score: 70, level: 3 },
    });
    setImprovementActions([]);
  };

  const openAddModal = () => {
    resetForm();
    setWizardStep(1);
    setShowAddModal(true);
  };

  const openEditModal = (assessment) => {
    setSelectedAssessment(assessment);
    setFormData({
      authorityCode: assessment.authorityCode, currentLevel: assessment.currentLevel, targetLevel: assessment.targetLevel,
      assessor: assessment.assessor, assessmentDate: assessment.assessmentDate, nextAssessment: assessment.nextAssessment,
      status: assessment.status, notes: assessment.notes || '',
      domains: assessment.domains || []
    });
    setWizardStep(1);
    setShowEditModal(true);
  };

  const openViewModal = (assessment) => {
    setSelectedAssessment(assessment);
    setViewTab('overview');
    setShowViewModal(true);
  };

  const openDeleteModal = (assessment) => {
    setSelectedAssessment(assessment);
    setShowDeleteModal(true);
  };

  // Handle Add Assessment
  const handleAddAssessment = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      const newId = Math.max(...assessments.map(a => a.id)) + 1;
      const authority = AUTHORITIES.find(a => a.code === formData.authorityCode);
      const newAssessment = {
        id: newId, authorityId: authority?.id || newId, authorityCode: formData.authorityCode,
        currentLevel: parseInt(formData.currentLevel), targetLevel: parseInt(formData.targetLevel),
        previousLevel: parseInt(formData.currentLevel) - 1, assessmentDate: formData.assessmentDate,
        nextAssessment: formData.nextAssessment, assessor: formData.assessor, status: formData.status,
        score: parseInt(formData.currentLevel) * 20,
        domains: formData.domains.length > 0 ? formData.domains : [
          { name: 'Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„', nameEn: 'Domain 1', score: 70, level: parseInt(formData.currentLevel) },
          { name: 'Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ', nameEn: 'Domain 2', score: 65, level: parseInt(formData.currentLevel) },
          { name: 'Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø«', nameEn: 'Domain 3', score: 75, level: parseInt(formData.currentLevel) },
        ]
      };
      setAssessments([...assessments, newAssessment]);
      setIsSubmitting(false);
      setShowAddModal(false);
      resetForm();
    }, 1000);
  };

  // Handle Edit Assessment
  const handleEditAssessment = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setAssessments(assessments.map(a =>
        a.id === selectedAssessment.id ? {
          ...a,
          authorityCode: formData.authorityCode, currentLevel: parseInt(formData.currentLevel),
          targetLevel: parseInt(formData.targetLevel), assessor: formData.assessor, assessmentDate: formData.assessmentDate,
          nextAssessment: formData.nextAssessment, status: formData.status, score: parseInt(formData.currentLevel) * 20,
        } : a
      ));
      setIsSubmitting(false);
      setShowEditModal(false);
      setSelectedAssessment(null);
    }, 1000);
  };

  // Handle Delete Assessment
  const handleDeleteAssessment = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setAssessments(assessments.filter(a => a.id !== selectedAssessment.id));
      setIsSubmitting(false);
      setShowDeleteModal(false);
      setSelectedAssessment(null);
    }, 800);
  };

  // Maturity Levels Configuration
  const MATURITY_LEVELS = {
    1: { level: 1, name: 'Ù…Ø¨Ø¯Ø¦ÙŠ', nameEn: 'Initial', color: 'red', description: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØºÙŠØ± Ù…Ù†Ø¸Ù…Ø© ÙˆØ¹Ø´ÙˆØ§Ø¦ÙŠØ©', icon: 'ğŸ”´' },
    2: { level: 2, name: 'Ù…ÙØ¯Ø§Ø±', nameEn: 'Managed', color: 'orange', description: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø®Ø·Ø·Ø© ÙˆÙ…ØªØªØ¨Ø¹Ø©', icon: 'ğŸŸ ' },
    3: { level: 3, name: 'Ù…Ø¹Ø±Ù‘Ù', nameEn: 'Defined', color: 'amber', description: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…ÙˆØ­Ø¯Ø© ÙˆÙ…ÙˆØ«Ù‚Ø©', icon: 'ğŸŸ¡' },
    4: { level: 4, name: 'Ù…ÙÙ‚Ø§Ø³', nameEn: 'Quantitatively Managed', color: 'blue', description: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù‚Ø§Ø³Ø© ÙˆÙ…ØªØ­ÙƒÙ… Ø¨Ù‡Ø§', icon: 'ğŸ”µ' },
    5: { level: 5, name: 'Ù…ÙØ­Ø³Ù‘Ù†', nameEn: 'Optimizing', color: 'emerald', description: 'Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø±', icon: 'ğŸŸ¢' },
  };

  // Assessment Data per Authority
  const [assessments, setAssessments] = useState([
    {
      id: 1, authorityId: 1, authorityCode: 'SAMA', currentLevel: 4, targetLevel: 5, previousLevel: 3, assessmentDate: '2025-01-15', nextAssessment: '2025-04-15', assessor: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', status: 'Completed', score: 82, domains: [
        { name: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', nameEn: 'Governance', score: 85, level: 4 },
        { name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk Management', score: 78, level: 4 },
        { name: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance', score: 88, level: 4 },
        { name: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal Audit', score: 75, level: 4 },
        { name: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©', nameEn: 'Training', score: 80, level: 4 },
      ]
    },
    {
      id: 2, authorityId: 3, authorityCode: 'NCA', currentLevel: 3, targetLevel: 5, previousLevel: 2, assessmentDate: '2025-01-10', nextAssessment: '2025-04-10', assessor: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', status: 'Completed', score: 68, domains: [
        { name: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£ØµÙˆÙ„', nameEn: 'Asset Protection', score: 72, level: 3 },
        { name: 'Ø£Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª', nameEn: 'Network Security', score: 65, level: 3 },
        { name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©', nameEn: 'Identity Management', score: 70, level: 3 },
        { name: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', nameEn: 'Incident Response', score: 62, level: 3 },
        { name: 'Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', nameEn: 'Business Continuity', score: 71, level: 4 },
      ]
    },
    {
      id: 3, authorityId: 4, authorityCode: 'SDAIA', currentLevel: 2, targetLevel: 4, previousLevel: 1, assessmentDate: '2025-01-20', nextAssessment: '2025-04-20', assessor: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', status: 'Completed', score: 52, domains: [
        { name: 'Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Collection', score: 55, level: 3 },
        { name: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Processing', score: 48, level: 2 },
        { name: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Protection', score: 58, level: 3 },
        { name: 'Ø­Ù‚ÙˆÙ‚ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Subject Rights', score: 45, level: 2 },
        { name: 'Ø§Ù„Ù†Ù‚Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯', nameEn: 'Cross-border Transfer', score: 54, level: 2 },
      ]
    },
    {
      id: 4, authorityId: 2, authorityCode: 'CMA', currentLevel: 4, targetLevel: 5, previousLevel: 4, assessmentDate: '2025-01-05', nextAssessment: '2025-04-05', assessor: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', status: 'Completed', score: 85, domains: [
        { name: 'Ø§Ù„Ø¥ÙØµØ§Ø­ ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©', nameEn: 'Disclosure', score: 90, level: 5 },
        { name: 'Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª', nameEn: 'Corporate Governance', score: 88, level: 4 },
        { name: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', nameEn: 'AML', score: 82, level: 4 },
        { name: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†', nameEn: 'Investor Protection', score: 80, level: 4 },
        { name: 'Ø§Ù„Ù†Ø²Ø§Ù‡Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©', nameEn: 'Market Integrity', score: 85, level: 4 },
      ]
    },
    {
      id: 5, authorityId: 5, authorityCode: 'ZATCA', currentLevel: 3, targetLevel: 4, previousLevel: 3, assessmentDate: '2025-01-25', nextAssessment: '2025-04-25', assessor: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ', status: 'InProgress', score: 65, domains: [
        { name: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', nameEn: 'Tax Compliance', score: 70, level: 3 },
        { name: 'Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', nameEn: 'E-Invoicing', score: 75, level: 4 },
        { name: 'Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª', nameEn: 'Returns', score: 60, level: 3 },
        { name: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', nameEn: 'Tax Audit', score: 55, level: 3 },
        { name: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', nameEn: 'Reporting', score: 65, level: 3 },
      ]
    },
  ]);

  // Improvement Actions
  const [improvements, setImprovements] = useState([
    { id: 1, assessmentId: 1, domain: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', action: 'ØªØ·ÙˆÙŠØ± Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', priority: 'High', status: 'InProgress', dueDate: '2025-03-15', progress: 60 },
    { id: 2, assessmentId: 1, domain: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', action: 'ØªØ­Ø¯ÙŠØ« Ù…Ù†Ù‡Ø¬ÙŠØ© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', priority: 'Medium', status: 'Planned', dueDate: '2025-04-30', progress: 20 },
    { id: 3, assessmentId: 2, domain: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', action: 'Ø¥Ù†Ø´Ø§Ø¡ ÙØ±ÙŠÙ‚ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©', priority: 'High', status: 'InProgress', dueDate: '2025-02-28', progress: 75 },
    { id: 4, assessmentId: 3, domain: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', action: 'ØªØ·Ø¨ÙŠÙ‚ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', priority: 'High', status: 'Planned', dueDate: '2025-03-31', progress: 10 },
    { id: 5, assessmentId: 3, domain: 'Ø­Ù‚ÙˆÙ‚ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', action: 'ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø¨Ø© Ø·Ù„Ø¨Ø§Øª Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', priority: 'Critical', status: 'InProgress', dueDate: '2025-02-15', progress: 45 },
  ]);

  // Historical Trend Data
  const trendData = [
    { period: 'Q1 2024', SAMA: 3.2, NCA: 2.1, SDAIA: 1.5, CMA: 3.8, ZATCA: 2.8 },
    { period: 'Q2 2024', SAMA: 3.5, NCA: 2.4, SDAIA: 1.8, CMA: 4.0, ZATCA: 2.9 },
    { period: 'Q3 2024', SAMA: 3.7, NCA: 2.7, SDAIA: 2.0, CMA: 4.1, ZATCA: 3.0 },
    { period: 'Q4 2024', SAMA: 3.9, NCA: 2.9, SDAIA: 2.2, CMA: 4.2, ZATCA: 3.1 },
    { period: 'Q1 2025', SAMA: 4.1, NCA: 3.2, SDAIA: 2.5, CMA: 4.3, ZATCA: 3.2 },
  ];

  // Calculate Overall Stats
  const stats = useMemo(() => {
    const avgScore = assessments.reduce((sum, a) => sum + a.score, 0) / assessments.length;
    const avgLevel = assessments.reduce((sum, a) => sum + a.currentLevel, 0) / assessments.length;
    const atTarget = assessments.filter(a => a.currentLevel >= a.targetLevel).length;
    const improving = assessments.filter(a => a.currentLevel > a.previousLevel).length;
    return { avgScore: Math.round(avgScore), avgLevel: avgLevel.toFixed(1), atTarget, improving, total: assessments.length };
  }, [assessments]);

  // Get Level Config
  const getLevelConfig = (level) => MATURITY_LEVELS[level] || MATURITY_LEVELS[1];

  const tabs = [
    { id: 'overview', label: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', icon: LayoutDashboard, count: null },
    { id: 'frameworks', label: 'Ø£ÙØ·Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', icon: Layers, count: frameworks.length },
    { id: 'authorities', label: 'Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: Building2, count: assessments.length },
    { id: 'questionnaire', label: 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ', icon: FileQuestion, count: null },
    { id: 'domains', label: 'Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', icon: Target, count: null },
    { id: 'improvements', label: 'Ø®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†', icon: TrendingUp, count: improvements.filter(i => i.status === 'InProgress').length },
    { id: 'initiatives', label: 'Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª', icon: Rocket, count: initiatives.filter(i => i.status === 'InProgress').length },
    { id: 'benchmark', label: 'Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ©', icon: Scale, count: null },
    { id: 'trends', label: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ', icon: BarChart3, count: null },
  ];

  // Calculate weighted score
  const calculateWeightedScore = (answers, questions) => {
    let totalWeight = 0;
    let weightedSum = 0;
    questions.forEach(q => {
      if (answers[q.id]) {
        totalWeight += q.weight;
        weightedSum += answers[q.id] * q.weight;
      }
    });
    return totalWeight > 0 ? Math.round((weightedSum / totalWeight) * 20) : 0;
  };

  // Handle answer question
  const handleAnswerQuestion = (questionId, value) => {
    setQuestionAnswers({ ...questionAnswers, [questionId]: value });
  };

  // Get next question
  const getNextQuestion = () => {
    const templateQuestions = assessmentQuestions.filter(q => q.templateId === selectedTemplate?.id);
    if (currentQuestionIndex < templateQuestions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    }
  };

  // Get previous question
  const getPreviousQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(currentQuestionIndex - 1);
    }
  };

  // Submit questionnaire
  const handleSubmitQuestionnaire = () => {
    const score = calculateWeightedScore(questionAnswers, assessmentQuestions.filter(q => q.templateId === selectedTemplate?.id));
    const level = Math.ceil(score / 20);
    alert(`ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…! Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${score}% - Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${level}`);
    setShowQuestionnaireModal(false);
    setQuestionAnswers({});
    setCurrentQuestionIndex(0);
  };

  // Add initiative
  const handleAddInitiative = (data) => {
    const newInitiative = {
      id: initiatives.length + 1,
      ...data,
      status: 'Planned', progress: 0, spentBudget: 0,
      milestones: []
    };
    setInitiatives([...initiatives, newInitiative]);
  };

  // Update initiative progress
  const handleUpdateInitiativeProgress = (initiativeId, milestoneId, newStatus) => {
    setInitiatives(initiatives.map(init => {
      if (init.id !== initiativeId) return init;
      const updatedMilestones = init.milestones.map(m =>
        m.id === milestoneId ? { ...m, status: newStatus } : m
      );
      const completed = updatedMilestones.filter(m => m.status === 'Completed').length;
      const progress = Math.round((completed / updatedMilestones.length) * 100);
      return { ...init, milestones: updatedMilestones, progress };
    }));
  };

  // Get radar chart data
  const getRadarChartData = (assessment) => {
    if (!assessment?.domains) return [];
    return assessment.domains.map(d => ({
      domain: d.name, current: d.score, target: assessment.targetLevel * 20,
      industry: benchmarkData.categories.find(c => c.domain === d.name)?.industryAvg || 60
    }));
  };

  // Get heat map color
  const getHeatMapColor = (score) => {
    if (score >= 80) return 'bg-emerald-500';
    if (score >= 60) return 'bg-amber-500';
    if (score >= 40) return 'bg-orange-500';
    return 'bg-red-500';
  };

  return (
    <div className="space-y-6">
      <div className="relative overflow-hidden bg-gradient-to-br from-violet-600 via-purple-600 to-indigo-700 rounded-3xl p-8 text-white">
        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtOS45NDEgMC0xOCA4LjA1OS0xOCAxOHM4LjA1OSAxOCAxOCAxOGM5Ljk0MSAwIDE4LTguMDU5IDE4LTE4cy04LjA1OS0xOC0xOC0xOHptMCAzMmMtNy43MzIgMC0xNC02LjI2OC0xNC0xNHM2LjI2OC0xNCAxNC0xNHMxNCA2LjI2OCAxNCAxNC02LjI2OCAxNC0xNCAxNHoiIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iLjA1Ii8+PC9nPjwvc3ZnPg==')] opacity-30"></div>
        <div className="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
        <div className="absolute bottom-0 left-0 w-64 h-64 bg-cyan-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-3xl"></div>

        <div className="relative">
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center gap-5">
              <div className="w-20 h-20 rounded-2xl bg-white/20 backdrop-blur-xl flex items-center justify-center border border-white/30 shadow-2xl">
                <TrendingUp className="w-10 h-10" />
              </div>
              <div>
                <h1 className="text-3xl font-black mb-1">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</h1>
                <p className="text-purple-200 text-lg">Maturity Assessment & Continuous Improvement</p>
              </div> </div>
            <div className="flex items-center gap-3">
              <button className="flex items-center gap-2 px-5 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-xl border border-white/20 font-bold transition-all">
                <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button>
              <button onClick={() => setShowAssessmentModal(true)} className="flex items-center gap-2 px-6 py-3 bg-white text-purple-600 rounded-xl font-bold shadow-xl hover:shadow-2xl transition-all">
                <Plus className="w-5 h-5" />ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯
              </button> </div> </div>
          <div className="grid grid-cols-5 gap-4">
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
              <div className="flex items-center justify-between mb-3">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Target className="w-6 h-6" />
                </div>
                <span className="text-4xl font-black">{stats.avgScore}%</span>
              </div>
              <p className="text-purple-200 font-medium">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ø¹Ø§Ù…</p>
              <div className="mt-2 h-2 bg-white/20 rounded-full overflow-hidden">
                <div className="h-full bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full" style={{ width: `${stats.avgScore}%` }}></div>
              </div> </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
              <div className="flex items-center justify-between mb-3">
                <div className="w-12 h-12 rounded-xl bg-emerald-500/30 flex items-center justify-center">
                  <CheckCircle2 className="w-6 h-6 text-emerald-300" />
                </div>
                <span className="text-4xl font-black">{stats.atTarget}</span>
              </div>
              <p className="text-purple-200 font-medium">ÙˆØµÙ„ÙˆØ§ Ù„Ù„Ù‡Ø¯Ù</p>
              <p className="text-xs text-purple-300 mt-1">Ù…Ù† {stats.total} Ø¬Ù‡Ø©</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
              <div className="flex items-center justify-between mb-3">
                <div className="w-12 h-12 rounded-xl bg-blue-500/30 flex items-center justify-center">
                  <TrendingUp className="w-6 h-6 text-blue-300" />
                </div>
                <span className="text-4xl font-black">{stats.improving}</span>
              </div>
              <p className="text-purple-200 font-medium">ÙÙŠ ØªØ­Ø³Ù†</p>
              <p className="text-xs text-emerald-300 mt-1">â†‘ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
              <div className="flex items-center justify-between mb-3">
                <div className="w-12 h-12 rounded-xl bg-amber-500/30 flex items-center justify-center">
                  <Activity className="w-6 h-6 text-amber-300" />
                </div>
                <span className="text-4xl font-black">{stats.avgLevel}</span>
              </div>
              <p className="text-purple-200 font-medium">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
              <p className="text-xs text-purple-300 mt-1">Ù…Ù† 5 Ù…Ø³ØªÙˆÙŠØ§Øª</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
              <div className="flex items-center justify-between mb-3">
                <div className="w-12 h-12 rounded-xl bg-purple-500/30 flex items-center justify-center">
                  <Calendar className="w-6 h-6 text-purple-300" />
                </div>
                <span className="text-2xl font-black">Q1</span>
              </div>
              <p className="text-purple-200 font-medium">Ø¯ÙˆØ±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
              <p className="text-xs text-purple-300 mt-1">2025</p>
            </div> </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm">
        <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
          <Scale className="w-5 h-5 text-purple-500" />Ù…Ù‚ÙŠØ§Ø³ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬ - Maturity Scale
        </h3>
        <div className="flex items-center gap-2">
          {Object.values(MATURITY_LEVELS).map((level, idx) => (
            <div key={level.level} className="flex-1 relative">
              <div className={`p-4 rounded-xl border-2 text-center transition-all hover:shadow-lg hover:scale-[1.02] cursor-pointer ${level.color === 'red' ? 'bg-red-50 border-red-200 hover:border-red-400' :
                level.color === 'orange' ? 'bg-orange-50 border-orange-200 hover:border-orange-400' :
                  level.color === 'amber' ? 'bg-amber-50 border-amber-200 hover:border-amber-400' :
                    level.color === 'blue' ? 'bg-blue-50 border-blue-200 hover:border-blue-400' :
                      'bg-emerald-50 border-emerald-200 hover:border-emerald-400'
                }`}>
                <div className="text-3xl mb-2">{level.icon}</div>
                <div className={`text-2xl font-black ${level.color === 'red' ? 'text-red-600' :
                  level.color === 'orange' ? 'text-orange-600' :
                    level.color === 'amber' ? 'text-amber-600' :
                      level.color === 'blue' ? 'text-blue-600' :
                        'text-emerald-600'
                  }`}>L{level.level}</div>
                <p className="font-bold text-slate-800 mt-1">{level.name}</p>
                <p className="text-xs text-slate-500">{level.nameEn}</p>
                <p className="text-[10px] text-slate-400 mt-2 leading-tight">{level.description}</p>
              </div>
              {idx < 4 && (
                <div className="absolute top-1/2 -left-1 w-2 h-2 bg-slate-300 rounded-full -translate-y-1/2 z-10"></div>
              )}
            </div>
          ))}
        </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden shadow-sm">
        <div className="flex border-b-2 border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100 overflow-x-auto">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-6 py-4 font-bold transition-all whitespace-nowrap border-b-2 ${activeTab === tab.id
                ? 'text-purple-600 border-purple-500 bg-white -mb-[2px]'
                : 'text-slate-500 border-transparent hover:text-purple-500 hover:bg-white/50'
                }`}>
              <tab.icon className="w-5 h-5" />{tab.label}
              {tab.count !== null && (
                <span className={`px-2.5 py-1 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-600'
                  }`}>{tab.count}</span>
              )}
            </button>
          ))}
        </div>

        {activeTab === 'overview' && (
          <div className="p-6 space-y-6">
            <div>
              <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <Building2 className="w-5 h-5 text-purple-500" />Ù†Ø¶Ø¬ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
              </h3>
              <div className="grid grid-cols-5 gap-4">
                {assessments.map(assessment => {
                  const levelConfig = getLevelConfig(assessment.currentLevel);
                  const targetConfig = getLevelConfig(assessment.targetLevel);
                  const gap = assessment.targetLevel - assessment.currentLevel;
                  return (
                    <div key={assessment.id} onClick={() => { setSelectedAuthority(assessment); setShowDetailModal(true); }}
                      className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:shadow-xl hover:border-purple-300 cursor-pointer transition-all group relative overflow-hidden">
                      <div className={`absolute top-0 left-0 w-full h-1 ${levelConfig.color === 'red' ? 'bg-red-500' :
                        levelConfig.color === 'orange' ? 'bg-orange-500' :
                          levelConfig.color === 'amber' ? 'bg-amber-500' :
                            levelConfig.color === 'blue' ? 'bg-blue-500' :
                              'bg-emerald-500'
                        }`}></div>

                      <div className="flex items-center justify-between mb-4">
                        <div className={`w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-lg ${assessment.authorityCode === 'SAMA' ? 'bg-gradient-to-br from-emerald-500 to-teal-600' :
                          assessment.authorityCode === 'NCA' ? 'bg-gradient-to-br from-purple-500 to-violet-600' :
                            assessment.authorityCode === 'SDAIA' ? 'bg-gradient-to-br from-indigo-500 to-blue-600' :
                              assessment.authorityCode === 'CMA' ? 'bg-gradient-to-br from-blue-500 to-cyan-600' :
                                'bg-gradient-to-br from-amber-500 to-orange-600'
                          }`}>
                          {assessment.authorityCode.substring(0, 2)}
                        </div>
                        <div className="text-4xl">{levelConfig.icon}</div>
                      </div>

                      <h4 className="font-bold text-slate-800 text-lg mb-1">{assessment.authorityCode}</h4>
                      <p className="text-sm text-slate-500 mb-3">{AUTHORITIES.find(a => a.id === assessment.authorityId)?.nameAr}</p>

                      <div className="flex items-center gap-2 mb-3">
                        <span className={`text-3xl font-black ${levelConfig.color === 'red' ? 'text-red-600' :
                          levelConfig.color === 'orange' ? 'text-orange-600' :
                            levelConfig.color === 'amber' ? 'text-amber-600' :
                              levelConfig.color === 'blue' ? 'text-blue-600' :
                                'text-emerald-600'
                          }`}>L{assessment.currentLevel}</span>
                        <ChevronRight className="w-4 h-4 text-slate-300" />
                        <span className="text-lg text-slate-400">L{assessment.targetLevel}</span>
                      </div>

                      <div className="mb-3">
                        <div className="flex items-center justify-between text-xs mb-1">
                          <span className="text-slate-500">Ø§Ù„Ù†Ø¶Ø¬</span>
                          <span className="font-bold text-slate-700">{assessment.score}%</span>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full transition-all ${assessment.score >= 80 ? 'bg-emerald-500' :
                            assessment.score >= 60 ? 'bg-blue-500' :
                              assessment.score >= 40 ? 'bg-amber-500' :
                                'bg-red-500'
                            }`} style={{ width: `${assessment.score}%` }}></div>
                        </div> </div>
                      <div className="flex items-center justify-between text-xs">
                        {gap > 0 ? (
                          <span className="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg font-bold">ÙØ¬ÙˆØ©: {gap} Ù…Ø³ØªÙˆÙ‰</span>
                        ) : (
                          <span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg font-bold flex items-center gap-1">
                            <CheckCircle2 className="w-3 h-3" />Ù‡Ø¯Ù Ù…Ø­Ù‚Ù‚
                          </span>
                        )}
                        {assessment.currentLevel > assessment.previousLevel && (
                          <span className="text-emerald-500 flex items-center gap-1">
                            <TrendingUp className="w-3 h-3" />+{assessment.currentLevel - assessment.previousLevel}
                          </span>
                        )}
                      </div> </div>);
                })}
              </div> </div>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-200 p-6">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <PieChart className="w-5 h-5 text-purple-500" />ØªÙˆØ²ÙŠØ¹ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬
                </h3>
                <div className="flex items-center justify-around py-8">
                  {[1, 2, 3, 4, 5].map(level => {
                    const count = assessments.filter(a => a.currentLevel === level).length;
                    const config = getLevelConfig(level);
                    return (
                      <div key={level} className="text-center">
                        <div className={`w-16 h-16 rounded-2xl flex items-center justify-center text-2xl font-black mx-auto mb-2 ${config.color === 'red' ? 'bg-red-100 text-red-600' :
                          config.color === 'orange' ? 'bg-orange-100 text-orange-600' :
                            config.color === 'amber' ? 'bg-amber-100 text-amber-600' :
                              config.color === 'blue' ? 'bg-blue-100 text-blue-600' :
                                'bg-emerald-100 text-emerald-600'
                          }`}>{count}</div>
                        <p className="text-xs font-bold text-slate-600">L{level}</p>
                        <p className="text-[10px] text-slate-400">{config.name}</p>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-200 p-6">
                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <TrendingUp className="w-5 h-5 text-emerald-500" />Ø§Ù„ØªÙ‚Ø¯Ù… Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                </h3>
                <div className="space-y-3">
                  {assessments.map(a => {
                    const change = a.currentLevel - a.previousLevel;
                    return (
                      <div key={a.id} className="flex items-center gap-3">
                        <span className="w-16 font-bold text-slate-700">{a.authorityCode}</span>
                        <div className="flex-1 h-3 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full ${a.score >= 80 ? 'bg-emerald-500' :
                            a.score >= 60 ? 'bg-blue-500' :
                              a.score >= 40 ? 'bg-amber-500' : 'bg-red-500'
                            }`} style={{ width: `${a.score}%` }}></div>
                        </div>
                        <span className="w-12 text-sm font-bold text-slate-700">{a.score}%</span>
                        <span className={`w-12 text-sm font-bold ${change > 0 ? 'text-emerald-500' : change < 0 ? 'text-red-500' : 'text-slate-400'}`}>
                          {change > 0 ? `+${change}` : change < 0 ? change : 'â€”'}
                        </span> </div>);
                  })}
                </div> </div> </div>
            <div className="grid grid-cols-4 gap-4">
              <button onClick={() => setShowAssessmentModal(true)} className="p-5 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl text-white hover:shadow-xl transition-all group">
                <Plus className="w-8 h-8 mb-3 group-hover:scale-110 transition-transform" />
                <p className="font-bold">Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</p>
                <p className="text-xs text-purple-200 mt-1">New Assessment</p>
              </button>
              <button className="p-5 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl text-white hover:shadow-xl transition-all group">
                <FileText className="w-8 h-8 mb-3 group-hover:scale-110 transition-transform" />
                <p className="font-bold">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ø´Ø§Ù…Ù„</p>
                <p className="text-xs text-emerald-200 mt-1">Maturity Report</p>
              </button>
              <button onClick={() => setActiveTab('improvements')} className="p-5 bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl text-white hover:shadow-xl transition-all group">
                <TrendingUp className="w-8 h-8 mb-3 group-hover:scale-110 transition-transform" />
                <p className="font-bold">Ø®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†</p>
                <p className="text-xs text-amber-200 mt-1">Improvement Plans</p>
              </button>
              <button onClick={() => setActiveTab('benchmark')} className="p-5 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl text-white hover:shadow-xl transition-all group">
                <Scale className="w-8 h-8 mb-3 group-hover:scale-110 transition-transform" />
                <p className="font-bold">Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ©</p>
                <p className="text-xs text-blue-200 mt-1">Benchmarking</p>
              </button> </div> </div>
        )}

        {activeTab === 'authorities' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between mb-4">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <Building2 className="w-5 h-5 text-purple-500" />ØªÙ‚ÙŠÙŠÙ… Ù†Ø¶Ø¬ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
              </h3>
              <div className="flex items-center gap-3">
                <button onClick={openAddModal} className="px-4 py-2.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white rounded-xl font-bold flex items-center gap-2 hover:shadow-lg transition-all">
                  <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯
                </button>
                <div className="flex items-center gap-2">
                  <button onClick={() => setViewMode('cards')} className={`p-2.5 rounded-lg transition-all ${viewMode === 'cards' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                    <LayoutGrid className="w-5 h-5" />
                  </button>
                  <button onClick={() => setViewMode('table')} className={`p-2.5 rounded-lg transition-all ${viewMode === 'table' ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                    <Table className="w-5 h-5" />
                  </button> </div> </div> </div>
            {viewMode === 'table' ? (
              <div className="overflow-hidden rounded-xl border-2 border-slate-200">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gradient-to-r from-slate-50 to-slate-100">
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙØ¬ÙˆØ©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø¢Ø®Ø± ØªÙ‚ÙŠÙŠÙ…</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700 w-32">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {assessments.map((assessment, idx) => {
                      const levelConfig = getLevelConfig(assessment.currentLevel);
                      const gap = assessment.targetLevel - assessment.currentLevel;
                      const change = assessment.currentLevel - assessment.previousLevel;
                      return (
                        <tr key={assessment.id} className={`border-b border-slate-100 hover:bg-purple-50/50 transition-all ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`}>
                          <td className="px-4 py-4">
                            <div className="flex items-center gap-3">
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-sm ${assessment.authorityCode === 'SAMA' ? 'bg-emerald-500' :
                                assessment.authorityCode === 'NCA' ? 'bg-purple-500' :
                                  assessment.authorityCode === 'SDAIA' ? 'bg-indigo-500' :
                                    assessment.authorityCode === 'CMA' ? 'bg-blue-500' : 'bg-amber-500'
                                }`}>{assessment.authorityCode.substring(0, 2)}</div>
                              <div>
                                <p className="font-bold text-slate-800">{assessment.authorityCode}</p>
                                <p className="text-xs text-slate-500">{AUTHORITIES.find(a => a.id === assessment.authorityId)?.nameAr}</p>
                              </div> </div> </td>
                          <td className="px-4 py-4 text-center">
                            <div className="inline-flex items-center gap-2">
                              <span className="text-2xl">{levelConfig.icon}</span>
                              <span className={`text-xl font-black ${levelConfig.color === 'emerald' ? 'text-emerald-600' :
                                levelConfig.color === 'blue' ? 'text-blue-600' :
                                  levelConfig.color === 'amber' ? 'text-amber-600' :
                                    levelConfig.color === 'orange' ? 'text-orange-600' : 'text-red-600'
                                }`}>L{assessment.currentLevel}</span>
                            </div> </td>
                          <td className="px-4 py-4 text-center">
                            <span className="text-lg font-bold text-slate-600">L{assessment.targetLevel}</span>
                          </td>
                          <td className="px-4 py-4 text-center">
                            {gap > 0 ? (
                              <span className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg font-bold text-sm">{gap} Ù…Ø³ØªÙˆÙ‰</span>
                            ) : (
                              <span className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg font-bold text-sm flex items-center gap-1 justify-center">
                                <CheckCircle2 className="w-4 h-4" />Ù…Ø­Ù‚Ù‚
                              </span>
                            )}
                          </td>
                          <td className="px-4 py-4 text-center">
                            <div className="inline-flex flex-col items-center">
                              <span className="text-xl font-black text-slate-800">{assessment.score}%</span>
                              <div className="w-20 h-1.5 bg-slate-200 rounded-full mt-1">
                                <div className={`h-full rounded-full ${assessment.score >= 80 ? 'bg-emerald-500' : assessment.score >= 60 ? 'bg-blue-500' : assessment.score >= 40 ? 'bg-amber-500' : 'bg-red-500'}`} style={{ width: `${assessment.score}%` }}></div>
                              </div> </div> </td>
                          <td className="px-4 py-4 text-center">
                            <span className={`font-bold ${change > 0 ? 'text-emerald-500' : change < 0 ? 'text-red-500' : 'text-slate-400'}`}>
                              {change > 0 ? `â†‘ +${change}` : change < 0 ? `â†“ ${change}` : 'â€”'}
                            </span> </td>
                          <td className="px-4 py-4 text-center text-sm text-slate-600">{assessment.assessmentDate}</td>
                          <td className="px-4 py-4 text-center">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${assessment.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'
                              }`}>{assessment.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ø¬Ø§Ø±ÙŠ'}</span>
                          </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={(e) => { e.stopPropagation(); openViewModal(assessment); }} className="p-2 hover:bg-blue-100 rounded-lg transition-all" title="Ø¹Ø±Ø¶">
                                <Eye className="w-4 h-4 text-blue-500" />
                              </button>
                              <button onClick={(e) => { e.stopPropagation(); openEditModal(assessment); }} className="p-2 hover:bg-amber-100 rounded-lg transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                                <Edit className="w-4 h-4 text-amber-500" />
                              </button>
                              <button onClick={(e) => { e.stopPropagation(); openDeleteModal(assessment); }} className="p-2 hover:bg-red-100 rounded-lg transition-all" title="Ø­Ø°Ù">
                                <Trash2 className="w-4 h-4 text-red-500" />
                              </button> </div> </td> </tr>);
                    })}
                  </tbody> </table> </div>
            ) : (
              <div className="grid grid-cols-3 gap-5">
                {assessments.map(assessment => {
                  const levelConfig = getLevelConfig(assessment.currentLevel);
                  const gap = assessment.targetLevel - assessment.currentLevel;
                  return (
                    <div key={assessment.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-xl hover:border-purple-300 transition-all group">
                      <div className={`h-2 ${levelConfig.color === 'emerald' ? 'bg-emerald-500' :
                        levelConfig.color === 'blue' ? 'bg-blue-500' :
                          levelConfig.color === 'amber' ? 'bg-amber-500' :
                            levelConfig.color === 'orange' ? 'bg-orange-500' : 'bg-red-500'
                        }`}></div>
                      <div className="p-5">
                        <div className="flex items-start justify-between mb-4">
                          <div className={`w-16 h-16 rounded-xl flex items-center justify-center text-white font-bold text-xl ${assessment.authorityCode === 'SAMA' ? 'bg-gradient-to-br from-emerald-500 to-teal-600' :
                            assessment.authorityCode === 'NCA' ? 'bg-gradient-to-br from-purple-500 to-violet-600' :
                              assessment.authorityCode === 'SDAIA' ? 'bg-gradient-to-br from-indigo-500 to-blue-600' :
                                assessment.authorityCode === 'CMA' ? 'bg-gradient-to-br from-blue-500 to-cyan-600' :
                                  'bg-gradient-to-br from-amber-500 to-orange-600'
                            } shadow-lg cursor-pointer`} onClick={() => openViewModal(assessment)}>{assessment.authorityCode.substring(0, 2)}</div>
                          <div className="flex items-center gap-2">
                            <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${assessment.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'
                              }`}>{assessment.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ø¬Ø§Ø±ÙŠ'}</span>
                          </div> </div>
                        <h4 className="font-bold text-slate-800 text-xl group-hover:text-purple-600 transition-colors cursor-pointer" onClick={() => openViewModal(assessment)}>{assessment.authorityCode}</h4>
                        <p className="text-sm text-slate-500 mb-4">{AUTHORITIES.find(a => a.id === assessment.authorityId)?.nameAr}</p>

                        <div className="flex items-center gap-4 mb-4">
                          <div className="flex-1 text-center p-3 bg-slate-50 rounded-xl">
                            <div className="text-3xl mb-1">{levelConfig.icon}</div>
                            <p className={`text-2xl font-black ${levelConfig.color === 'emerald' ? 'text-emerald-600' :
                              levelConfig.color === 'blue' ? 'text-blue-600' :
                                levelConfig.color === 'amber' ? 'text-amber-600' :
                                  levelConfig.color === 'orange' ? 'text-orange-600' : 'text-red-600'
                              }`}>L{assessment.currentLevel}</p>
                            <p className="text-xs text-slate-500">Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                          </div>
                          <ChevronRight className="w-6 h-6 text-slate-300" />
                          <div className="flex-1 text-center p-3 bg-purple-50 rounded-xl">
                            <div className="text-3xl mb-1">ğŸ¯</div>
                            <p className="text-2xl font-black text-purple-600">L{assessment.targetLevel}</p>
                            <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                          </div> </div>
                        <div className="mb-4">
                          <div className="flex items-center justify-between text-sm mb-2">
                            <span className="text-slate-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¶Ø¬</span>
                            <span className="font-bold text-slate-800">{assessment.score}%</span>
                          </div>
                          <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                            <div className={`h-full rounded-full transition-all ${assessment.score >= 80 ? 'bg-gradient-to-r from-emerald-400 to-emerald-500' :
                              assessment.score >= 60 ? 'bg-gradient-to-r from-blue-400 to-blue-500' :
                                assessment.score >= 40 ? 'bg-gradient-to-r from-amber-400 to-amber-500' :
                                  'bg-gradient-to-r from-red-400 to-red-500'
                              }`} style={{ width: `${assessment.score}%` }}></div>
                          </div> </div>
                        <div className="flex items-center justify-between text-sm pt-4 border-t border-slate-100">
                          <span className="text-slate-500">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…: {assessment.assessor}</span>
                          {gap > 0 ? (
                            <span className="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">ÙØ¬ÙˆØ©: {gap}</span>
                          ) : (
                            <span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">âœ“ Ù…Ø­Ù‚Ù‚</span>
                          )}
                        </div>

                        <div className="flex items-center gap-2 mt-4 pt-4 border-t border-slate-100">
                          <button onClick={() => openViewModal(assessment)} className="flex-1 py-2.5 bg-blue-50 text-blue-600 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-blue-100 transition-all">
                            <Eye className="w-4 h-4" />Ø¹Ø±Ø¶
                          </button>
                          <button onClick={() => openEditModal(assessment)} className="flex-1 py-2.5 bg-amber-50 text-amber-600 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-amber-100 transition-all">
                            <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                          </button>
                          <button onClick={() => openDeleteModal(assessment)} className="py-2.5 px-3 bg-red-50 text-red-600 rounded-xl font-bold text-sm flex items-center justify-center hover:bg-red-100 transition-all">
                            <Trash2 className="w-4 h-4" />
                          </button> </div> </div> </div>);
                })}
              </div>
            )}
          </div>
        )}

        {activeTab === 'domains' && (
          <div className="p-6 space-y-6">
            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
              <Layers className="w-5 h-5 text-purple-500" />ØªØ­Ù„ÙŠÙ„ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø©
            </h3>

            {assessments.map(assessment => (
              <div key={assessment.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className={`p-4 flex items-center justify-between ${assessment.authorityCode === 'SAMA' ? 'bg-gradient-to-r from-emerald-500 to-teal-600' :
                  assessment.authorityCode === 'NCA' ? 'bg-gradient-to-r from-purple-500 to-violet-600' :
                    assessment.authorityCode === 'SDAIA' ? 'bg-gradient-to-r from-indigo-500 to-blue-600' :
                      assessment.authorityCode === 'CMA' ? 'bg-gradient-to-r from-blue-500 to-cyan-600' :
                        'bg-gradient-to-r from-amber-500 to-orange-600'
                  } text-white`}>
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center font-bold text-lg">{assessment.authorityCode.substring(0, 2)}</div>
                    <div>
                      <h4 className="font-bold text-lg">{assessment.authorityCode}</h4>
                      <p className="text-sm opacity-80">{AUTHORITIES.find(a => a.id === assessment.authorityId)?.nameAr}</p>
                    </div> </div>
                  <div className="flex items-center gap-4">
                    <div className="text-center">
                      <p className="text-3xl font-black">{assessment.score}%</p>
                      <p className="text-xs opacity-80">Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„ÙƒÙ„ÙŠ</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-black">L{assessment.currentLevel}</p>
                      <p className="text-xs opacity-80">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
                    </div> </div> </div>
                <div className="p-5">
                  <div className="grid grid-cols-5 gap-4">
                    {assessment.domains.map((domain, idx) => {
                      const levelConfig = getLevelConfig(domain.level);
                      return (
                        <div key={idx} className="p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:shadow-lg transition-all cursor-pointer text-center">
                          <div className="text-2xl mb-2">{levelConfig.icon}</div>
                          <p className="font-bold text-slate-800 text-sm mb-1">{domain.name}</p>
                          <p className="text-[10px] text-slate-400 mb-3">{domain.nameEn}</p>
                          <div className="mb-2">
                            <p className={`text-2xl font-black ${domain.score >= 80 ? 'text-emerald-600' :
                              domain.score >= 60 ? 'text-blue-600' :
                                domain.score >= 40 ? 'text-amber-600' : 'text-red-600'
                              }`}>{domain.score}%</p>
                          </div>
                          <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div className={`h-full rounded-full ${domain.score >= 80 ? 'bg-emerald-500' :
                              domain.score >= 60 ? 'bg-blue-500' :
                                domain.score >= 40 ? 'bg-amber-500' : 'bg-red-500'
                              }`} style={{ width: `${domain.score}%` }}></div>
                          </div>
                          <p className="text-xs text-slate-500 mt-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: L{domain.level}</p>
                        </div>);
                    })}
                  </div> </div> </div>
            ))}
          </div>
        )}

        {activeTab === 'improvements' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-amber-500" />Ø®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ³Ø¯ Ø§Ù„ÙØ¬ÙˆØ§Øª
              </h3>
              <button className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ø³ÙŠÙ†
              </button> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
                <Activity className="w-8 h-8 mb-3 opacity-80" />
                <p className="text-3xl font-black">{improvements.length}</p>
                <p className="text-amber-100">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-blue-200">
                <Clock className="w-8 h-8 mb-3 text-blue-500" />
                <p className="text-3xl font-black text-blue-600">{improvements.filter(i => i.status === 'InProgress').length}</p>
                <p className="text-slate-500">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-emerald-200">
                <CheckCircle2 className="w-8 h-8 mb-3 text-emerald-500" />
                <p className="text-3xl font-black text-emerald-600">{improvements.filter(i => i.status === 'Completed').length}</p>
                <p className="text-slate-500">Ù…ÙƒØªÙ…Ù„Ø©</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-red-200">
                <AlertTriangle className="w-8 h-8 mb-3 text-red-500" />
                <p className="text-3xl font-black text-red-600">{improvements.filter(i => i.priority === 'Critical').length}</p>
                <p className="text-slate-500">Ø­Ø±Ø¬Ø©</p>
              </div> </div>
            <div className="space-y-3">
              {improvements.map(imp => {
                const assessment = assessments.find(a => a.id === imp.assessmentId);
                return (
                  <div key={imp.id} className="bg-white rounded-xl border-2 border-slate-200 p-5 hover:shadow-lg hover:border-purple-300 transition-all">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-4">
                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold ${imp.priority === 'Critical' ? 'bg-red-500' :
                          imp.priority === 'High' ? 'bg-orange-500' :
                            imp.priority === 'Medium' ? 'bg-amber-500' : 'bg-blue-500'
                          }`}>
                          {imp.priority === 'Critical' ? '!!' : imp.priority === 'High' ? '!' : 'â€¢'}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${imp.priority === 'Critical' ? 'bg-red-100 text-red-700' :
                              imp.priority === 'High' ? 'bg-orange-100 text-orange-700' :
                                imp.priority === 'Medium' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                              }`}>{imp.priority === 'Critical' ? 'Ø­Ø±Ø¬' : imp.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : imp.priority === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}</span>
                            <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-bold">{assessment?.authorityCode}</span>
                            <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">{imp.domain}</span>
                          </div>
                          <h4 className="font-bold text-slate-800 text-lg">{imp.action}</h4>
                          <p className="text-sm text-slate-500 mt-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {imp.dueDate}</p>
                        </div> </div>
                      <div className="text-left w-40">
                        <div className="flex items-center justify-between text-sm mb-2">
                          <span className={`font-bold ${imp.status === 'Completed' ? 'text-emerald-600' :
                            imp.status === 'InProgress' ? 'text-blue-600' : 'text-slate-500'
                            }`}>{imp.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : imp.status === 'InProgress' ? 'Ø¬Ø§Ø±ÙŠ' : 'Ù…Ø®Ø·Ø·'}</span>
                          <span className="font-bold text-slate-800">{imp.progress}%</span>
                        </div>
                        <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                          <div className={`h-full rounded-full transition-all ${imp.progress >= 80 ? 'bg-emerald-500' :
                            imp.progress >= 50 ? 'bg-blue-500' :
                              imp.progress >= 25 ? 'bg-amber-500' : 'bg-slate-300'
                            }`} style={{ width: `${imp.progress}%` }}></div>
                        </div> </div> </div> </div>);
              })}
            </div> </div>
        )}

        {activeTab === 'trends' && (
          <div className="p-6 space-y-6">
            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
              <BarChart3 className="w-5 h-5 text-blue-500" />Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬
            </h3>

            <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-200 p-6">
              <div className="flex items-center justify-between mb-6">
                <h4 className="font-bold text-slate-700">ØªØ·ÙˆØ± Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬ Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†</h4>
                <div className="flex items-center gap-4">
                  {['SAMA', 'NCA', 'SDAIA', 'CMA', 'ZATCA'].map((code, idx) => (
                    <div key={code} className="flex items-center gap-2">
                      <div className={`w-3 h-3 rounded-full ${idx === 0 ? 'bg-emerald-500' :
                        idx === 1 ? 'bg-purple-500' :
                          idx === 2 ? 'bg-indigo-500' :
                            idx === 3 ? 'bg-blue-500' : 'bg-amber-500'
                        }`}></div>
                      <span className="text-sm text-slate-600">{code}</span>
                    </div>
                  ))}
                </div> </div>
              <div className="relative h-64">
                <div className="absolute inset-0 flex flex-col justify-between text-xs text-slate-400 py-2">
                  {[5, 4, 3, 2, 1].map(level => (
                    <div key={level} className="flex items-center gap-2">
                      <span className="w-6">L{level}</span>
                      <div className="flex-1 border-t border-dashed border-slate-200"></div>
                    </div>
                  ))}
                </div>

                <div className="absolute inset-0 flex items-end justify-around pt-4 pb-8">
                  {trendData.map((data, idx) => (
                    <div key={idx} className="flex flex-col items-center gap-2 w-1/5">
                      <div className="flex items-end gap-1 h-48">
                        <div className="w-4 rounded-t-lg bg-emerald-500 transition-all hover:opacity-80" style={{ height: `${(data.SAMA / 5) * 100}%` }} title={`SAMA: ${data.SAMA}`}></div>
                        <div className="w-4 rounded-t-lg bg-purple-500 transition-all hover:opacity-80" style={{ height: `${(data.NCA / 5) * 100}%` }} title={`NCA: ${data.NCA}`}></div>
                        <div className="w-4 rounded-t-lg bg-indigo-500 transition-all hover:opacity-80" style={{ height: `${(data.SDAIA / 5) * 100}%` }} title={`SDAIA: ${data.SDAIA}`}></div>
                        <div className="w-4 rounded-t-lg bg-blue-500 transition-all hover:opacity-80" style={{ height: `${(data.CMA / 5) * 100}%` }} title={`CMA: ${data.CMA}`}></div>
                        <div className="w-4 rounded-t-lg bg-amber-500 transition-all hover:opacity-80" style={{ height: `${(data.ZATCA / 5) * 100}%` }} title={`ZATCA: ${data.ZATCA}`}></div>
                      </div>
                      <span className="text-xs text-slate-500 font-medium">{data.period}</span>
                    </div>
                  ))}
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <table className="w-full">
                <thead>
                  <tr className="bg-slate-50">
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„ÙØªØ±Ø©</th>
                    {['SAMA', 'NCA', 'SDAIA', 'CMA', 'ZATCA'].map(code => (
                      <th key={code} className="text-center px-4 py-3 font-bold text-slate-700">{code}</th>
                    ))}
                  </tr> </thead>
                <tbody>
                  {trendData.map((data, idx) => (
                    <tr key={idx} className="border-t border-slate-100">
                      <td className="px-4 py-3 font-bold text-slate-700">{data.period}</td>
                      <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded font-bold">{data.SAMA}</span></td>
                      <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-purple-100 text-purple-700 rounded font-bold">{data.NCA}</span></td>
                      <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded font-bold">{data.SDAIA}</span></td>
                      <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-blue-100 text-blue-700 rounded font-bold">{data.CMA}</span></td>
                      <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-amber-100 text-amber-700 rounded font-bold">{data.ZATCA}</span></td>
                    </tr>
                  ))}
                </tbody> </table> </div> </div>
        )}

        {activeTab === 'benchmark' && (
          <div className="p-6 space-y-6">
            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
              <Scale className="w-5 h-5 text-indigo-500" />Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ© - Industry Benchmarking
            </h3>

            <div className="grid grid-cols-3 gap-6">
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between mb-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    <TrendingUp className="w-7 h-7" />
                  </div>
                  <span className="text-4xl font-black">{stats.avgScore}%</span>
                </div>
                <h4 className="font-bold text-lg mb-1">Ù…ØªÙˆØ³Ø· Ù†Ø¶Ø¬Ùƒ</h4>
                <p className="text-emerald-100 text-sm">Your Average Maturity</p>
                <div className="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                  <div className="h-full bg-white rounded-full" style={{ width: `${stats.avgScore}%` }}></div>
                </div> </div>
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between mb-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    <Building2 className="w-7 h-7" />
                  </div>
                  <span className="text-4xl font-black">72%</span>
                </div>
                <h4 className="font-bold text-lg mb-1">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚Ø·Ø§Ø¹</h4>
                <p className="text-blue-100 text-sm">Industry Average</p>
                <div className="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                  <div className="h-full bg-white rounded-full" style={{ width: '72%' }}></div>
                </div> </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between mb-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    <Target className="w-7 h-7" />
                  </div>
                  <span className="text-4xl font-black">85%</span>
                </div>
                <h4 className="font-bold text-lg mb-1">Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª</h4>
                <p className="text-purple-100 text-sm">Best Practice</p>
                <div className="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                  <div className="h-full bg-white rounded-full" style={{ width: '85%' }}></div>
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="p-4 bg-slate-50 border-b border-slate-200">
                <h4 className="font-bold text-slate-700">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</h4>
              </div>
              <div className="p-5">
                {['Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'].map((domain, idx) => {
                  const yourScore = [85, 78, 82, 68, 52][idx];
                  const industryScore = [75, 70, 72, 65, 60][idx];
                  const bestPractice = [90, 85, 88, 82, 78][idx];
                  const diff = yourScore - industryScore;
                  return (
                    <div key={idx} className="mb-6 last:mb-0">
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-bold text-slate-700">{domain}</span>
                        <span className={`text-sm font-bold ${diff >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                          {diff >= 0 ? `+${diff}%` : `${diff}%`} Ø¹Ù† Ø§Ù„Ù‚Ø·Ø§Ø¹
                        </span> </div>
                      <div className="relative h-8 bg-slate-100 rounded-lg overflow-hidden">
                        <div className="absolute inset-y-0 right-0 bg-emerald-500/30 rounded-lg" style={{ width: `${yourScore}%` }}>
                          <div className="absolute inset-y-0 right-0 bg-emerald-500 rounded-lg flex items-center justify-end px-2" style={{ width: '100%' }}>
                            <span className="text-xs font-bold text-white">{yourScore}%</span>
                          </div> </div>
                        <div className="absolute top-1/2 -translate-y-1/2 w-1 h-6 bg-blue-500 rounded" style={{ right: `${industryScore}%` }} title="Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚Ø·Ø§Ø¹"></div>
                        <div className="absolute top-1/2 -translate-y-1/2 w-1 h-6 bg-purple-500 rounded" style={{ right: `${bestPractice}%` }} title="Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª"></div>
                      </div>
                      <div className="flex items-center gap-4 mt-1 text-xs text-slate-500">
                        <span className="flex items-center gap-1"><span className="w-2 h-2 bg-blue-500 rounded-full"></span>Ø§Ù„Ù‚Ø·Ø§Ø¹: {industryScore}%</span>
                        <span className="flex items-center gap-1"><span className="w-2 h-2 bg-purple-500 rounded-full"></span>Ø£ÙØ¶Ù„: {bestPractice}%</span>
                      </div> </div>);
                })}
              </div> </div>
            <div className="bg-gradient-to-r from-slate-50 to-purple-50 rounded-2xl border-2 border-purple-200 p-6">
              <h4 className="font-bold text-purple-800 mb-4 flex items-center gap-2">
                <Target className="w-5 h-5" />Ù…ÙˆÙ‚Ø¹Ùƒ ÙÙŠ Ø§Ù„Ù‚Ø·Ø§Ø¹
              </h4>
              <div className="flex items-center gap-4">
                <div className="flex-1">
                  <div className="relative h-4 bg-gradient-to-r from-red-200 via-amber-200 via-emerald-200 to-emerald-400 rounded-full">
                    <div className="absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-white border-4 border-purple-500 rounded-full shadow-lg transition-all"
                      style={{ right: `calc(${stats.avgScore}% - 12px)` }}>
                    </div>
                    <div className="absolute -bottom-6 right-[25%] text-xs text-slate-500">25%</div>
                    <div className="absolute -bottom-6 right-[50%] text-xs text-slate-500">50%</div>
                    <div className="absolute -bottom-6 right-[75%] text-xs text-slate-500">75%</div>
                  </div> </div>
                <div className="w-32 text-center">
                  <p className="text-3xl font-black text-purple-600">{stats.avgScore >= 80 ? 'Ù…ØªÙ…ÙŠØ²' : stats.avgScore >= 60 ? 'Ø¬ÙŠØ¯' : stats.avgScore >= 40 ? 'Ù…ØªÙˆØ³Ø·' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}</p>
                  <p className="text-sm text-slate-500">ØªØµÙ†ÙŠÙÙƒ</p>
                </div> </div> </div> </div>
        )}

        {activeTab === 'frameworks' && (
          <div className="p-6 space-y-6">
            <div className="grid grid-cols-5 gap-4">
              <div className="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl p-4 text-white">
                <div className="flex items-center justify-between">
                  <Layers className="w-8 h-8 text-white/80" />
                  <span className="text-3xl font-black">{frameworks.length}</span>
                </div>
                <p className="text-purple-100 text-sm mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙØ·Ø±</p>
              </div>
              <div className="bg-white rounded-2xl p-4 border-2 border-emerald-200">
                <div className="flex items-center justify-between">
                  <CheckCircle2 className="w-8 h-8 text-emerald-500" />
                  <span className="text-3xl font-black text-emerald-600">{frameworks.filter(f => f.status === 'Active').length}</span>
                </div>
                <p className="text-slate-600 text-sm mt-2">Ø£ÙØ·Ø± Ù†Ø´Ø·Ø©</p>
              </div>
              <div className="bg-white rounded-2xl p-4 border-2 border-blue-200">
                <div className="flex items-center justify-between">
                  <FileQuestion className="w-8 h-8 text-blue-500" />
                  <span className="text-3xl font-black text-blue-600">{assessmentTemplates.length}</span>
                </div>
                <p className="text-slate-600 text-sm mt-2">Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©</p>
              </div>
              <div className="bg-white rounded-2xl p-4 border-2 border-amber-200">
                <div className="flex items-center justify-between">
                  <Target className="w-8 h-8 text-amber-500" />
                  <span className="text-3xl font-black text-amber-600">{frameworks.reduce((sum, f) => sum + f.domains, 0)}</span>
                </div>
                <p className="text-slate-600 text-sm mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</p>
              </div>
              <div className="bg-white rounded-2xl p-4 border-2 border-violet-200">
                <div className="flex items-center justify-between">
                  <BarChart3 className="w-8 h-8 text-violet-500" />
                  <span className="text-3xl font-black text-violet-600">{assessmentQuestions.length}</span>
                </div>
                <p className="text-slate-600 text-sm mt-2">Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
              </div> </div>
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <Layers className="w-5 h-5 text-purple-500" />Ø£ÙØ·Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ØªØ§Ø­Ø©
                <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-sm">{filteredFrameworks.length}</span>
              </h3>
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ÙØ·Ø±..."
                    value={searchFramework} onChange={(e) => setSearchFramework(e.target.value)}
                    className="pl-4 pr-10 py-2 border-2 border-slate-200 rounded-xl text-sm w-64 focus:border-purple-400 focus:outline-none" />
                  {searchFramework && (
                    <button onClick={() => setSearchFramework('')} className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                      <X className="w-4 h-4" />
                    </button>
                  )}
                </div>
                <button onClick={handleOpenAddFramework} className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">
                  <Plus className="w-4 h-4" />Ø¥Ø·Ø§Ø± Ù…Ø®ØµØµ Ø¬Ø¯ÙŠØ¯
                </button> </div> </div>
            <div className="grid grid-cols-3 gap-6">
              {filteredFrameworks.length === 0 ? (
                <div className="col-span-3 text-center py-12 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-300">
                  <Layers className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                  <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙØ·Ø± Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>
                  <button onClick={() => setSearchFramework('')} className="mt-3 px-4 py-2 bg-purple-500 text-white rounded-xl text-sm font-bold">
                    Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
                  </button> </div>
              ) : filteredFrameworks.map(fw => (
                <div key={fw.id} className={`bg-white rounded-2xl border-2 overflow-hidden transition-all hover:shadow-xl ${selectedFramework?.id === fw.id ? 'border-purple-400 shadow-lg ring-2 ring-purple-200' : 'border-slate-200 hover:border-purple-300'}`}>
                  <div className={`px-5 py-4 ${fw.code === 'CMMI' ? 'bg-gradient-to-r from-purple-500 to-indigo-600' :
                    fw.code === 'COBIT' ? 'bg-gradient-to-r from-blue-500 to-cyan-600' :
                      fw.code === 'ISO27001' ? 'bg-gradient-to-r from-emerald-500 to-teal-600' :
                        fw.code === 'NIST-CSF' ? 'bg-gradient-to-r from-orange-500 to-amber-600' :
                          'bg-gradient-to-r from-violet-500 to-purple-600'
                    } text-white`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center font-black text-lg">
                          {fw.code.slice(0, 2)}
                        </div>
                        <div>
                          <h4 className="font-bold">{fw.nameAr}</h4>
                          <p className="text-white/80 text-sm">{fw.name}</p>
                        </div> </div>
                      <span className={`px-2.5 py-1 rounded-lg text-xs font-bold ${fw.status === 'Active' ? 'bg-white/20 text-white' : 'bg-white/10 text-white/70'}`}>
                        {fw.status === 'Active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                      </span> </div> </div>
                  <div className="p-5">
                    <p className="text-sm text-slate-600 mb-4 leading-relaxed">{fw.description}</p>

                    <div className="grid grid-cols-3 gap-3 mb-4">
                      <div className="bg-purple-50 rounded-xl p-3 text-center">
                        <p className="text-2xl font-black text-purple-600">{fw.levels}</p>
                        <p className="text-xs text-purple-700">Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬</p>
                      </div>
                      <div className="bg-blue-50 rounded-xl p-3 text-center">
                        <p className="text-2xl font-black text-blue-600">{fw.domains}</p>
                        <p className="text-xs text-blue-700">Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                      </div>
                      <div className="bg-emerald-50 rounded-xl p-3 text-center">
                        <p className="text-2xl font-black text-emerald-600">{assessmentTemplates.filter(t => t.frameworkId === fw.id).length}</p>
                        <p className="text-xs text-emerald-700">Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©</p>
                      </div> </div>
                    <div className="flex items-center gap-2 mb-4">
                      <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold">Ø§Ù„Ø¥ØµØ¯Ø§Ø±: {fw.version}</span>
                      <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-bold">
                        {fw.code === 'CUSTOM-GRC' ? 'Ù…Ø®ØµØµ' : 'Ù…Ø¹ÙŠØ§Ø±ÙŠ Ø¹Ø§Ù„Ù…ÙŠ'}
                      </span> </div>
                    <div className="flex items-center gap-2 pt-4 border-t border-slate-100">
                      <button onClick={() => { setSelectedFramework(fw); setShowFrameworkDetailModal(true); }} className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-500 text-white rounded-xl text-sm font-bold hover:bg-purple-600 transition-all">
                        <Eye className="w-4 h-4" />Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                      </button>
                      <button onClick={() => {
                        const template = assessmentTemplates.find(t => t.frameworkId === fw.id);
                        if (template) { setSelectedTemplate(template); setShowQuestionnaireModal(true); }
                        else { showNotificationMsg('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ù„Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø±', 'error'); }
                      }} className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-emerald-500 text-white rounded-xl text-sm font-bold hover:bg-emerald-600 transition-all">
                        <Play className="w-4 h-4" />Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                      </button>
                      <div className="relative group">
                        <button className="p-2 border-2 border-slate-200 rounded-xl hover:bg-slate-50">
                          <MoreVertical className="w-4 h-4 text-slate-400" />
                        </button>
                        <div className="absolute left-0 top-full mt-1 bg-white rounded-xl shadow-xl border-2 border-slate-200 py-2 w-48 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10">
                          <button onClick={() => handleOpenEditFramework(fw)} className="w-full flex items-center gap-2 px-4 py-2 text-right text-sm text-slate-700 hover:bg-slate-50">
                            <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±
                          </button>
                          <button onClick={() => handleToggleFrameworkStatus(fw)} className="w-full flex items-center gap-2 px-4 py-2 text-right text-sm text-slate-700 hover:bg-slate-50">
                            {fw.status === 'Active' ? <XCircle className="w-4 h-4" /> : <CheckCircle2 className="w-4 h-4" />}
                            {fw.status === 'Active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}
                          </button>
                          <button onClick={() => { setSelectedFramework(fw); handleOpenAddTemplate(); }} className="w-full flex items-center gap-2 px-4 py-2 text-right text-sm text-slate-700 hover:bg-slate-50">
                            <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨
                          </button>
                          <div className="border-t border-slate-100 my-1"></div>
                          <button onClick={() => handleDeleteFramework(fw)} className="w-full flex items-center gap-2 px-4 py-2 text-right text-sm text-red-600 hover:bg-red-50">
                            <Trash2 className="w-4 h-4" />Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø±
                          </button> </div> </div> </div> </div> </div>
              ))}
            </div>

            {selectedFramework && (
              <div className="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl border-2 border-purple-200 p-6">
                <div className="flex items-center justify-between mb-6">
                  <h4 className="font-bold text-purple-800 text-lg flex items-center gap-2">
                    <Target className="w-5 h-5" />
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±: {selectedFramework.nameAr}
                  </h4>
                  <div className="flex items-center gap-2">
                    <button onClick={() => handleOpenEditFramework(selectedFramework)} className="flex items-center gap-2 px-3 py-2 bg-purple-500 text-white rounded-xl text-sm font-bold hover:bg-purple-600">
                      <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button onClick={() => handleToggleFrameworkStatus(selectedFramework)} className={`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-bold ${selectedFramework.status === 'Active' ? 'bg-amber-500 text-white hover:bg-amber-600' : 'bg-emerald-500 text-white hover:bg-emerald-600'}`}>
                      {selectedFramework.status === 'Active' ? <><XCircle className="w-4 h-4" />ØªØ¹Ø·ÙŠÙ„</> : <><CheckCircle2 className="w-4 h-4" />ØªÙØ¹ÙŠÙ„</>}
                    </button>
                    <button onClick={() => setSelectedFramework(null)} className="p-2 hover:bg-purple-100 rounded-lg">
                      <X className="w-5 h-5 text-purple-600" />
                    </button> </div> </div>
                <div className="grid grid-cols-3 gap-6">
                  <div className="bg-white rounded-xl p-5 border border-purple-200">
                    <h5 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <FileText className="w-4 h-4 text-purple-500" />Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø·Ø§Ø±
                    </h5>
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯</span>
                        <span className="font-mono font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded">{selectedFramework.code}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</span>
                        <span className="font-bold text-slate-800">{selectedFramework.name}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</span>
                        <span className="font-bold text-slate-800 bg-slate-100 px-2 py-1 rounded">{selectedFramework.version}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</span>
                        <span className="font-bold text-purple-600">{selectedFramework.levels}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</span>
                        <span className="font-bold text-blue-600">{selectedFramework.domains}</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                        <button onClick={() => handleToggleFrameworkStatus(selectedFramework)} className={`px-3 py-1 rounded-lg text-xs font-bold cursor-pointer ${selectedFramework.status === 'Active' ? 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                          {selectedFramework.status === 'Active' ? 'Ù†Ø´Ø· âœ“' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                        </button> </div> </div> </div>
                  <div className="bg-white rounded-xl p-5 border border-purple-200">
                    <h5 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <TrendingUp className="w-4 h-4 text-blue-500" />Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬
                    </h5>
                    <div className="space-y-2">
                      {[
                        { level: 5, name: 'Ù…Ø­Ø³Ù‘Ù†', nameEn: 'Optimizing', color: 'emerald', bg: 'bg-emerald-500', bgLight: 'bg-emerald-50' },
                        { level: 4, name: 'Ù…ÙÙ‚Ø§Ø³', nameEn: 'Measured', color: 'blue', bg: 'bg-blue-500', bgLight: 'bg-blue-50' },
                        { level: 3, name: 'Ù…Ø¹Ø±Ù‘Ù', nameEn: 'Defined', color: 'amber', bg: 'bg-amber-500', bgLight: 'bg-amber-50' },
                        { level: 2, name: 'Ù…ÙØ¯Ø§Ø±', nameEn: 'Managed', color: 'orange', bg: 'bg-orange-500', bgLight: 'bg-orange-50' },
                        { level: 1, name: 'Ù…Ø¨Ø¯Ø¦ÙŠ', nameEn: 'Initial', color: 'red', bg: 'bg-red-500', bgLight: 'bg-red-50' },
                      ].slice(0, selectedFramework.levels).map(lvl => (
                        <div key={lvl.level} className={`flex items-center gap-3 p-2 rounded-lg ${lvl.bgLight} hover:shadow transition-all`}>
                          <div className={`w-8 h-8 rounded-lg ${lvl.bg} text-white flex items-center justify-center font-bold text-sm`}>
                            L{lvl.level}
                          </div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-700 text-sm">{lvl.name}</p>
                            <p className="text-xs text-slate-500">{lvl.nameEn}</p>
                          </div>
                          <div className={`w-4 h-4 rounded-full ${lvl.bg}`}></div>
                        </div>
                      ))}
                    </div> </div>
                  <div className="bg-white rounded-xl p-5 border border-purple-200">
                    <h5 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                      <Zap className="w-4 h-4 text-amber-500" />Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
                    </h5>
                    <div className="space-y-3">
                      <button onClick={() => {
                        const template = assessmentTemplates.find(t => t.frameworkId === selectedFramework.id);
                        if (template) { setSelectedTemplate(template); setShowQuestionnaireModal(true); }
                        else { showNotificationMsg('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ù„Ø¨ - Ø£Ø¶Ù Ù‚Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹', 'error'); }
                      }} className="w-full flex items-center gap-3 p-3 bg-emerald-50 hover:bg-emerald-100 rounded-xl transition-all border border-emerald-200">
                        <div className="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center">
                          <Play className="w-5 h-5" />
                        </div>
                        <div className="text-right flex-1">
                          <p className="font-bold text-emerald-700">Ø¨Ø¯Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</p>
                          <p className="text-xs text-emerald-600">Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø±</p>
                        </div> </button>
                      <button onClick={() => { setSelectedFramework(selectedFramework); handleOpenAddTemplate(); }} className="w-full flex items-center gap-3 p-3 bg-blue-50 hover:bg-blue-100 rounded-xl transition-all border border-blue-200">
                        <div className="w-10 h-10 rounded-lg bg-blue-500 text-white flex items-center justify-center">
                          <Plus className="w-5 h-5" />
                        </div>
                        <div className="text-right flex-1">
                          <p className="font-bold text-blue-700">Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ…</p>
                          <p className="text-xs text-blue-600">{assessmentTemplates.filter(t => t.frameworkId === selectedFramework.id).length} Ù‚Ø§Ù„Ø¨ Ø­Ø§Ù„ÙŠ</p>
                        </div> </button>
                      <button onClick={() => handleDeleteFramework(selectedFramework)} className="w-full flex items-center gap-3 p-3 bg-red-50 hover:bg-red-100 rounded-xl transition-all border border-red-200">
                        <div className="w-10 h-10 rounded-lg bg-red-500 text-white flex items-center justify-center">
                          <Trash2 className="w-5 h-5" />
                        </div>
                        <div className="text-right flex-1">
                          <p className="font-bold text-red-700">Ø­Ø°Ù Ø§Ù„Ø¥Ø·Ø§Ø±</p>
                          <p className="text-xs text-red-600">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
                        </div> </button> </div> </div> </div> </div>
            )}

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-gradient-to-r from-slate-50 to-indigo-50 border-b border-slate-200">
                <div className="flex items-center justify-between">
                  <h4 className="font-bold text-slate-800 flex items-center gap-2">
                    <FileText className="w-5 h-5 text-indigo-500" />Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
                  </h4>
                  <button className="flex items-center gap-2 px-3 py-1.5 bg-indigo-500 text-white rounded-lg text-sm font-bold">
                    <Plus className="w-4 h-4" />Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                  </button> </div> </div>
              <div className="p-6">
                <div className="grid grid-cols-4 gap-4">
                  {assessmentTemplates.map(tpl => {
                    const framework = frameworks.find(f => f.id === tpl.frameworkId);
                    return (
                      <div key={tpl.id} className="bg-gradient-to-br from-slate-50 to-indigo-50 rounded-xl p-4 border-2 border-slate-200 hover:border-indigo-400 hover:shadow-lg transition-all cursor-pointer group">
                        <div className="flex items-center justify-between mb-3">
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${framework?.code === 'CMMI' ? 'bg-purple-100' :
                            framework?.code === 'COBIT' ? 'bg-blue-100' :
                              framework?.code === 'ISO27001' ? 'bg-emerald-100' :
                                'bg-indigo-100'
                            }`}>
                            <FileQuestion className={`w-5 h-5 ${framework?.code === 'CMMI' ? 'text-purple-600' :
                              framework?.code === 'COBIT' ? 'text-blue-600' :
                                framework?.code === 'ISO27001' ? 'text-emerald-600' :
                                  'text-indigo-600'
                              }`} />
                          </div>
                          <span className="font-mono text-xs text-slate-500 bg-white px-2 py-1 rounded">{tpl.code}</span>
                        </div>
                        <h5 className="font-bold text-slate-800 text-sm mb-2">{tpl.name}</h5>
                        <p className="text-xs text-slate-500 mb-3">Ø§Ù„Ø¥Ø·Ø§Ø±: {framework?.nameAr || 'Ø¹Ø§Ù…'}</p>
                        <div className="flex items-center justify-between text-xs">
                          <div className="flex items-center gap-2">
                            <span className="px-2 py-1 bg-white rounded text-slate-600">{tpl.questionCount} Ø³Ø¤Ø§Ù„</span>
                            <span className="px-2 py-1 bg-white rounded text-slate-600">{tpl.duration}</span>
                          </div> </div>
                        <button onClick={() => { setSelectedTemplate(tpl); setShowQuestionnaireModal(true); }}
                          className="w-full mt-3 py-2 bg-indigo-500 text-white rounded-lg font-bold text-sm opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center gap-2">
                          <Play className="w-4 h-4" />Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                        </button> </div>);
                  })}
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-slate-50 border-b border-slate-200">
                <h4 className="font-bold text-slate-800 flex items-center gap-2">
                  <Scale className="w-5 h-5 text-purple-500" />Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£ÙØ·Ø±
                </h4>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-700">Ø§Ù„Ø¥Ø·Ø§Ø±</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-700">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {frameworks.map(fw => (
                      <tr key={fw.id} className="hover:bg-slate-50">
                        <td className="px-4 py-3">
                          <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center font-bold text-white ${fw.code === 'CMMI' ? 'bg-purple-500' :
                              fw.code === 'COBIT' ? 'bg-blue-500' :
                                fw.code === 'ISO27001' ? 'bg-emerald-500' :
                                  fw.code === 'NIST-CSF' ? 'bg-orange-500' :
                                    'bg-violet-500'
                              }`}>
                              {fw.code.slice(0, 2)}
                            </div>
                            <div>
                              <p className="font-bold text-slate-800 text-sm">{fw.nameAr}</p>
                              <p className="text-xs text-slate-500">{fw.version}</p>
                            </div> </div> </td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded-lg text-xs font-bold ${fw.code === 'CUSTOM-GRC' ? 'bg-violet-100 text-violet-700' : 'bg-blue-100 text-blue-700'}`}>
                            {fw.code === 'CUSTOM-GRC' ? 'Ù…Ø®ØµØµ' : 'Ù…Ø¹ÙŠØ§Ø±ÙŠ'}
                          </span> </td>
                        <td className="px-4 py-3 text-center font-bold text-purple-600">{fw.levels}</td>
                        <td className="px-4 py-3 text-center font-bold text-blue-600">{fw.domains}</td>
                        <td className="px-4 py-3 text-center font-bold text-emerald-600">{assessmentTemplates.filter(t => t.frameworkId === fw.id).length}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded-full text-xs font-bold ${fw.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>
                            {fw.status === 'Active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                          </span> </td>
                        <td className="px-4 py-3 text-center">
                          <button onClick={() => { setSelectedTemplate(assessmentTemplates.find(t => t.frameworkId === fw.id)); setShowQuestionnaireModal(true); }}
                            className="px-3 py-1.5 bg-purple-500 text-white rounded-lg text-xs font-bold hover:bg-purple-600">
                            Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                          </button> </td> </tr>
                    ))}
                  </tbody> </table> </div> </div> </div>
        )}

        {activeTab === 'questionnaire' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between mb-6">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <FileQuestion className="w-5 h-5 text-indigo-500" />Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ (Question-based)
              </h3>
              <div className="flex items-center gap-3">
                <div className="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden">
                  <button onClick={() => setAssessmentType('self')} className={`px-4 py-2 font-bold text-sm ${assessmentType === 'self' ? 'bg-indigo-500 text-white' : 'text-slate-600'}`}>ØªÙ‚ÙŠÙŠÙ… Ø°Ø§ØªÙŠ</button>
                  <button onClick={() => setAssessmentType('external')} className={`px-4 py-2 font-bold text-sm ${assessmentType === 'external' ? 'bg-indigo-500 text-white' : 'text-slate-600'}`}>ØªÙ‚ÙŠÙŠÙ… Ø®Ø§Ø±Ø¬ÙŠ</button>
                </div>
                <button onClick={() => setShowQuestionnaireModal(true)} className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold">
                  <Play className="w-4 h-4" />Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </button> </div> </div>
            <div className="grid grid-cols-4 gap-4">
              {assessmentTemplates.map(tpl => (
                <div key={tpl.id} onClick={() => { setSelectedTemplate(tpl); setShowQuestionnaireModal(true); }}
                  className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border-2 border-indigo-200 hover:border-indigo-400 cursor-pointer transition-all">
                  <div className="w-12 h-12 rounded-xl bg-indigo-100 flex items-center justify-center mb-4">
                    <FileQuestion className="w-6 h-6 text-indigo-600" />
                  </div>
                  <h4 className="font-bold text-slate-800 mb-2">{tpl.name}</h4>
                  <div className="flex items-center gap-2 text-sm text-slate-600 mb-3">
                    <span className="px-2 py-0.5 bg-white rounded text-xs">{tpl.questionCount} Ø³Ø¤Ø§Ù„</span>
                    <span className="px-2 py-0.5 bg-white rounded text-xs">{tpl.duration}</span>
                  </div>
                  <button className="w-full py-2 bg-indigo-500 text-white rounded-xl font-bold text-sm flex items-center justify-center gap-2">
                    <Play className="w-4 h-4" />Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†
                  </button> </div>
              ))}
            </div>

            <div className="bg-amber-50 rounded-2xl p-5 border border-amber-200">
              <h4 className="font-bold text-amber-800 mb-3 flex items-center gap-2">
                <Scale className="w-5 h-5" />Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ (Weighted Scoring)
              </h4>
              <div className="grid grid-cols-3 gap-4">
                <div className="bg-white rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-amber-600">Ø§Ù„ÙˆØ²Ù† Ã— Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>
                  <p className="text-sm text-slate-500 mt-1">Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ø³Ø¤Ø§Ù„</p>
                </div>
                <div className="bg-white rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-purple-600">âˆ‘ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ / âˆ‘ Ø§Ù„Ø£ÙˆØ²Ø§Ù†</p>
                  <p className="text-sm text-slate-500 mt-1">Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¬Ø­</p>
                </div>
                <div className="bg-white rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-emerald-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ = Ø§Ù„Ù†ØªÙŠØ¬Ø© Ã· 20</p>
                  <p className="text-sm text-slate-500 mt-1">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
                </div> </div> </div> </div>
        )}

        {activeTab === 'initiatives' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between mb-6">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <Rocket className="w-5 h-5 text-violet-500" />Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±
              </h3>
              <button onClick={() => setShowInitiativeModal(true)} className="flex items-center gap-2 px-4 py-2 bg-violet-500 text-white rounded-xl font-bold">
                <Plus className="w-4 h-4" />Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="grid grid-cols-4 gap-4 mb-6">
              <div className="bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl p-5 text-white">
                <div className="flex items-center justify-between mb-3">
                  <Rocket className="w-8 h-8 text-white/80" />
                  <span className="text-3xl font-black">{initiatives.length}</span>
                </div>
                <p className="font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-blue-200">
                <div className="flex items-center justify-between mb-3">
                  <Play className="w-8 h-8 text-blue-500" />
                  <span className="text-3xl font-black text-blue-600">{initiatives.filter(i => i.status === 'InProgress').length}</span>
                </div>
                <p className="font-bold text-slate-700">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-emerald-200">
                <div className="flex items-center justify-between mb-3">
                  <CheckCircle2 className="w-8 h-8 text-emerald-500" />
                  <span className="text-3xl font-black text-emerald-600">{initiatives.filter(i => i.status === 'Completed').length}</span>
                </div>
                <p className="font-bold text-slate-700">Ù…ÙƒØªÙ…Ù„Ø©</p>
              </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-amber-200">
                <div className="flex items-center justify-between mb-3">
                  <DollarSign className="w-8 h-8 text-amber-500" />
                  <span className="text-2xl font-black text-amber-600">{(initiatives.reduce((sum, i) => sum + i.budget, 0) / 1000).toFixed(0)}K</span>
                </div>
                <p className="font-bold text-slate-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</p>
              </div> </div>
            <div className="space-y-4">
              {initiatives.map(init => (
                <div key={init.id} className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                  <div className="flex items-start justify-between mb-4">
                    <div>
                      <div className="flex items-center gap-2 mb-2">
                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${init.priority === 'Critical' ? 'bg-red-100 text-red-700' : init.priority === 'High' ? 'bg-orange-100 text-orange-700' : 'bg-amber-100 text-amber-700'}`}>
                          {init.priority === 'Critical' ? 'Ø­Ø±Ø¬' : init.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}
                        </span>
                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${init.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : init.status === 'InProgress' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'}`}>
                          {init.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : init.status === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…Ø®Ø·Ø·'}
                        </span> </div>
                      <h4 className="font-bold text-slate-800 text-lg">{init.title}</h4>
                      <p className="text-sm text-slate-500 mt-1">{init.description}</p>
                    </div>
                    <div className="text-left">
                      <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                      <p className="font-bold text-purple-600">{init.targetDomain}</p>
                      <p className="text-xs text-slate-400 mt-1">L{init.currentLevel} â†’ L{init.targetLevel}</p>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6 mb-4">
                    <div>
                      <div className="flex items-center justify-between text-sm mb-1">
                        <span className="text-slate-600">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                        <span className="font-bold text-slate-800">{init.progress}%</span>
                      </div>
                      <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full ${init.progress === 100 ? 'bg-emerald-500' : 'bg-violet-500'}`} style={{ width: `${init.progress}%` }}></div>
                      </div> </div>
                    <div>
                      <div className="flex items-center justify-between text-sm mb-1">
                        <span className="text-slate-600">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span>
                        <span className="font-bold text-slate-800">{Math.round((init.spentBudget / init.budget) * 100)}% ({init.spentBudget.toLocaleString()} / {init.budget.toLocaleString()})</span>
                      </div>
                      <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                        <div className="h-full bg-amber-500 rounded-full" style={{ width: `${(init.spentBudget / init.budget) * 100}%` }}></div>
                      </div> </div> </div>
                  <div className="flex items-center gap-3 mb-4">
                    <span className="text-sm text-slate-500">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯:</span>
                    {init.resources.slice(0, 3).map((res, idx) => (
                      <span key={idx} className={`px-2 py-1 rounded-lg text-xs font-bold ${res.type === 'Internal' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                        {res.name} ({res.allocation}%)
                      </span>
                    ))}
                  </div>

                  <div className="flex items-center gap-2 pt-4 border-t border-slate-100">
                    {init.milestones.map((m, idx) => (
                      <button key={m.id} onClick={() => handleUpdateInitiativeProgress(init.id, m.id, m.status === 'Completed' ? 'Pending' : 'Completed')}
                        className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${m.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' : m.status === 'InProgress' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'}`}>
                        {m.status === 'Completed' ? <Check className="w-3 h-3" /> : <Circle className="w-3 h-3" />}
                        {m.title}
                      </button>
                    ))}
                  </div> </div>
              ))}
            </div> </div>
        )}
      </div>

      {showQuestionnaireModal && selectedTemplate && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <FileQuestion className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">{selectedTemplate.name}</h2>
                    <p className="text-indigo-200 text-sm">Ø§Ù„Ø³Ø¤Ø§Ù„ {currentQuestionIndex + 1} Ù…Ù† {assessmentQuestions.filter(q => q.templateId === selectedTemplate.id).length}</p>
                  </div> </div>
                <button onClick={() => { setShowQuestionnaireModal(false); setQuestionAnswers({}); setCurrentQuestionIndex(0); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div>
              <div className="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                <div className="h-full bg-white rounded-full transition-all" style={{ width: `${((currentQuestionIndex + 1) / assessmentQuestions.filter(q => q.templateId === selectedTemplate.id).length) * 100}%` }}></div>
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              {assessmentQuestions.filter(q => q.templateId === selectedTemplate.id).map((question, idx) => (
                idx === currentQuestionIndex && (
                  <div key={question.id} className="space-y-6">
                    <div className="bg-indigo-50 rounded-2xl p-5 border border-indigo-200">
                      <div className="flex items-center gap-2 mb-3">
                        <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-bold">{question.domain}</span>
                        <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-xs font-bold">Ø§Ù„ÙˆØ²Ù†: {question.weight}</span>
                        {question.evidenceRequired && <span className="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">ÙŠØªØ·Ù„Ø¨ Ø¯Ù„ÙŠÙ„</span>}
                      </div>
                      <h3 className="text-lg font-bold text-slate-800">{question.question}</h3>
                    </div>

                    <div className="space-y-3">
                      {question.options.map(opt => (
                        <button key={opt.value} onClick={() => handleAnswerQuestion(question.id, opt.value)}
                          className={`w-full p-4 rounded-xl border-2 text-right transition-all ${questionAnswers[question.id] === opt.value ? 'border-indigo-500 bg-indigo-50' : 'border-slate-200 hover:border-indigo-300'}`}>
                          <div className="flex items-center gap-4">
                            <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${questionAnswers[question.id] === opt.value ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                              {opt.value}
                            </div>
                            <div className="flex-1">
                              <p className="font-bold text-slate-800">{opt.label}</p>
                              <p className="text-sm text-slate-500">{opt.description}</p>
                            </div> </div> </button>
                      ))}
                    </div> </div>)
              ))}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={getPreviousQuestion} disabled={currentQuestionIndex === 0} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold disabled:opacity-50">
                <ChevronRight className="w-5 h-5" />
              </button>
              <div className="flex items-center gap-2">
                {assessmentQuestions.filter(q => q.templateId === selectedTemplate.id).map((_, idx) => (
                  <div key={idx} className={`w-3 h-3 rounded-full ${idx === currentQuestionIndex ? 'bg-indigo-500' : idx < currentQuestionIndex ? 'bg-emerald-500' : 'bg-slate-200'}`}></div>
                ))}
              </div>
              {currentQuestionIndex === assessmentQuestions.filter(q => q.templateId === selectedTemplate.id).length - 1 ? (
                <button onClick={handleSubmitQuestionnaire} className="flex items-center gap-2 px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold">
                  <CheckCircle2 className="w-5 h-5" />Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </button>
              ) : (
                <button onClick={getNextQuestion} className="flex items-center gap-2 px-6 py-3 bg-indigo-500 text-white rounded-xl font-bold">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                </button>
              )}
            </div> </div> </div>
      )}

      {showDetailModal && selectedAuthority && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white ${selectedAuthority.authorityCode === 'SAMA' ? 'bg-gradient-to-r from-emerald-500 to-teal-600' :
              selectedAuthority.authorityCode === 'NCA' ? 'bg-gradient-to-r from-purple-500 to-violet-600' :
                selectedAuthority.authorityCode === 'SDAIA' ? 'bg-gradient-to-r from-indigo-500 to-blue-600' :
                  selectedAuthority.authorityCode === 'CMA' ? 'bg-gradient-to-r from-blue-500 to-cyan-600' :
                    'bg-gradient-to-r from-amber-500 to-orange-600'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center font-bold text-2xl">{selectedAuthority.authorityCode.substring(0, 2)}</div>
                  <div>
                    <h2 className="text-2xl font-bold">{selectedAuthority.authorityCode}</h2>
                    <p className="opacity-80">{AUTHORITIES.find(a => a.id === selectedAuthority.authorityId)?.nameAr}</p>
                  </div> </div>
                <button onClick={() => setShowDetailModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/20 hover:bg-white/30 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-4 gap-4">
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-3xl mb-1">{getLevelConfig(selectedAuthority.currentLevel).icon}</p>
                  <p className="text-2xl font-black text-slate-800">L{selectedAuthority.currentLevel}</p>
                  <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                </div>
                <div className="bg-purple-50 rounded-xl p-4 text-center">
                  <p className="text-3xl mb-1">ğŸ¯</p>
                  <p className="text-2xl font-black text-purple-600">L{selectedAuthority.targetLevel}</p>
                  <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                </div>
                <div className="bg-blue-50 rounded-xl p-4 text-center">
                  <p className="text-3xl font-black text-blue-600">{selectedAuthority.score}%</p>
                  <p className="text-xs text-slate-500 mt-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¶Ø¬</p>
                </div>
                <div className="bg-emerald-50 rounded-xl p-4 text-center">
                  <p className="text-3xl font-black text-emerald-600">+{selectedAuthority.currentLevel - selectedAuthority.previousLevel}</p>
                  <p className="text-xs text-slate-500 mt-2">Ø§Ù„ØªØ­Ø³Ù†</p>
                </div> </div>
              <div>
                <h4 className="font-bold text-slate-800 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</h4>
                <div className="space-y-3">
                  {selectedAuthority.domains.map((domain, idx) => (
                    <div key={idx} className="bg-slate-50 rounded-xl p-4">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-3">
                          <span className="text-xl">{getLevelConfig(domain.level).icon}</span>
                          <div>
                            <p className="font-bold text-slate-800">{domain.name}</p>
                            <p className="text-xs text-slate-500">{domain.nameEn}</p>
                          </div> </div>
                        <div className="text-left">
                          <p className="text-xl font-black text-slate-800">{domain.score}%</p>
                          <p className="text-xs text-slate-500">L{domain.level}</p>
                        </div> </div>
                      <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full ${domain.score >= 80 ? 'bg-emerald-500' :
                          domain.score >= 60 ? 'bg-blue-500' :
                            domain.score >= 40 ? 'bg-amber-500' : 'bg-red-500'
                          }`} style={{ width: `${domain.score}%` }}></div>
                      </div> </div>
                  ))}
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</p>
                  <p className="font-bold text-slate-800">{selectedAuthority.assessor}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                  <p className="font-bold text-slate-800">{selectedAuthority.assessmentDate}</p>
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowDetailModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-2">
                <button className="flex items-center gap-2 px-5 py-2.5 bg-amber-100 text-amber-700 rounded-xl font-bold hover:bg-amber-200">
                  <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button className="flex items-center gap-2 px-5 py-2.5 bg-purple-100 text-purple-700 rounded-xl font-bold hover:bg-purple-200">
                  <FileText className="w-4 h-4" />ØªÙ‚Ø±ÙŠØ±
                </button> </div> </div> </div> </div>
      )}

      {showAssessmentModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Plus className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</h2>
                    <p className="text-purple-200">New Maturity Assessment</p>
                  </div> </div>
                <button onClick={() => setShowAssessmentModal(false)} className="w-12 h-12 flex items-center justify-center bg-white/20 hover:bg-white/30 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option>
                  {AUTHORITIES.map(a => <option key={a.id} value={a.id}>{a.code} - {a.nameAr}</option>)}
                </select>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                  <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    {Object.values(MATURITY_LEVELS).map(l => (
                      <option key={l.level} value={l.level}>{l.icon} L{l.level} - {l.name}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
                  <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    {Object.values(MATURITY_LEVELS).map(l => (
                      <option key={l.level} value={l.level}>{l.icon} L{l.level} - {l.name}</option>
                    ))}
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</label>
                <select className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                  <option>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯</option>
                  <option>ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯</option>
                  <option>Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea rows={3} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowAssessmentModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => { alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!'); setShowAssessmentModal(false); }} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
              </button> </div> </div> </div>
      )}

      {(showAddModal || showEditModal) && (
        <div className="fixed inset-0 bg-gradient-to-br from-slate-900/90 via-purple-900/70 to-slate-900/90 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => { setShowAddModal(false); setShowEditModal(false); }}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>

            <div className={`relative overflow-hidden ${showEditModal ? 'bg-gradient-to-r from-amber-500 via-orange-500 to-amber-600' : 'bg-gradient-to-r from-purple-600 via-violet-600 to-purple-700'}`}>
              <div className="absolute inset-0 opacity-20">
                <div className="absolute top-0 left-0 w-40 h-40 bg-white rounded-full -translate-x-1/2 -translate-y-1/2" />
                <div className="absolute bottom-0 right-0 w-60 h-60 bg-white rounded-full translate-x-1/3 translate-y-1/3" />
              </div>

              <div className="relative px-8 py-6 flex items-center justify-between">
                <div className="flex items-center gap-5">
                  <div className="w-16 h-16 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center">
                    {showEditModal ? <Edit className="w-8 h-8 text-white" /> : <Plus className="w-8 h-8 text-white" />}
                  </div>
                  <div className="text-white">
                    <h2 className="text-2xl font-black">{showEditModal ? `ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ… ${formData.authorityCode}` : 'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ù†Ø¶Ø¬ Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="opacity-80">{showEditModal ? 'ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' : 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¶Ø¬ Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©'}</p>
                  </div> </div>
                <button onClick={() => { setShowAddModal(false); setShowEditModal(false); resetForm(); }} className="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center text-white transition-all">
                  <X className="w-6 h-6" />
                </button> </div>
              <div className="relative px-8 pb-6">
                <div className="flex items-center justify-between">
                  {[
                    { num: 1, title: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: Building2 },
                    { num: 2, title: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª', icon: Layers },
                    { num: 3, title: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰', icon: Target },
                    { num: 4, title: 'Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†', icon: TrendingUp },
                    { num: 5, title: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø­ÙØ¸', icon: CheckCircle2 },
                  ].map((step, idx) => (
                    <div key={step.num} className="flex items-center flex-1">
                      <button onClick={() => setWizardStep(step.num)} className={`flex flex-col items-center transition-all ${wizardStep >= step.num ? 'opacity-100' : 'opacity-50'}`}>
                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center mb-2 transition-all ${wizardStep === step.num ? 'bg-white text-purple-600 shadow-lg scale-110' :
                          wizardStep > step.num ? 'bg-white/30 text-white' : 'bg-white/10 text-white/60'
                          }`}>
                          {wizardStep > step.num ? <CheckCircle2 className="w-7 h-7" /> : <step.icon className="w-7 h-7" />}
                        </div>
                        <span className={`text-sm font-bold ${wizardStep === step.num ? 'text-white' : 'text-white/70'}`}>{step.title}</span>
                      </button>
                      {idx < 4 && <div className={`flex-1 h-1 mx-3 rounded-full ${wizardStep > step.num ? 'bg-white/50' : 'bg-white/20'}`} />}
                    </div>
                  ))}
                </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-8">
              {wizardStep === 1 && (
                <div className="space-y-6 animate-fadeIn">
                  <div className="bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl p-6 border-2 border-purple-200">
                    <h3 className="text-xl font-black text-purple-800 mb-2 flex items-center gap-3">
                      <Building2 className="w-6 h-6" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªÙ‚ÙŠÙŠÙ…
                    </h3>
                    <p className="text-purple-600">Ø­Ø¯Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù… ÙˆØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6 hover:border-purple-300 transition-all">
                      <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                        <Building2 className="w-4 h-4 text-purple-500" />Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *
                      </label>
                      <select value={formData.authorityCode} onChange={e => setFormData({ ...formData, authorityCode: e.target.value })} disabled={showEditModal}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl text-lg outline-none focus:border-purple-400 disabled:bg-slate-100">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©...</option>
                        {AUTHORITIES.map(a => <option key={a.id} value={a.code}>{a.code} - {a.nameAr}</option>)}
                      </select>
                      {formData.authorityCode && (
                        <div className="mt-4 p-4 bg-purple-50 rounded-xl">
                          <p className="text-purple-800 font-bold">{AUTHORITIES.find(a => a.code === formData.authorityCode)?.nameAr}</p>
                          <p className="text-purple-600 text-sm">{AUTHORITIES.find(a => a.code === formData.authorityCode)?.nameEn}</p>
                        </div>
                      )}
                    </div>

                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6 hover:border-purple-300 transition-all">
                      <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                        <User className="w-4 h-4 text-purple-500" />Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù… *
                      </label>
                      <input type="text" value={formData.assessor} onChange={e => setFormData({ ...formData, assessor: e.target.value })}
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…..." className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl text-lg outline-none focus:border-purple-400" />
                      <div className="mt-4 grid grid-cols-2 gap-2">
                        {['Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ'].map(name => (
                          <button key={name} onClick={() => setFormData({ ...formData, assessor: name })}
                            className={`p-2 text-sm rounded-lg transition-all ${formData.assessor === name ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                            {name}
                          </button>
                        ))}
                      </div> </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                        <Calendar className="w-4 h-4 text-blue-500" />ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ… *
                      </label>
                      <input type="date" value={formData.assessmentDate} onChange={e => setFormData({ ...formData, assessmentDate: e.target.value })}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl text-lg outline-none focus:border-blue-400" />
                    </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                        <Clock className="w-4 h-4 text-amber-500" />ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø§Ø¯Ù…
                      </label>
                      <input type="date" value={formData.nextAssessment} onChange={e => setFormData({ ...formData, nextAssessment: e.target.value })}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl text-lg outline-none focus:border-amber-400" />
                    </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                    <div className="grid grid-cols-3 gap-4">
                      {[
                        { value: 'Planned', label: 'Ù…Ø®Ø·Ø·', icon: Calendar, color: 'slate' },
                        { value: 'InProgress', label: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°', icon: Clock, color: 'amber' },
                        { value: 'Completed', label: 'Ù…ÙƒØªÙ…Ù„', icon: CheckCircle2, color: 'emerald' },
                      ].map(status => (
                        <button key={status.value} onClick={() => setFormData({ ...formData, status: status.value })}
                          className={`p-5 rounded-2xl border-2 transition-all flex flex-col items-center gap-3 ${formData.status === status.value
                            ? status.color === 'emerald' ? 'bg-emerald-50 border-emerald-400 text-emerald-700' :
                              status.color === 'amber' ? 'bg-amber-50 border-amber-400 text-amber-700' :
                                'bg-slate-50 border-slate-400 text-slate-700'
                            : 'bg-white border-slate-200 text-slate-500 hover:border-slate-300'
                            }`}>
                          <status.icon className="w-8 h-8" />
                          <span className="font-bold">{status.label}</span>
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-6 animate-fadeIn">
                  <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 border-2 border-blue-200">
                    <h3 className="text-xl font-black text-blue-800 mb-2 flex items-center gap-3">
                      <Layers className="w-6 h-6" />ØªÙ‚ÙŠÙŠÙ… Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ù†Ø¶Ø¬
                    </h3>
                    <p className="text-blue-600">Ù‚ÙŠÙ‘Ù… ÙƒÙ„ Ù…Ø¬Ø§Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ ÙˆØ­Ø¯Ø¯ Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¶Ø¬</p>
                  </div>

                  <div className="space-y-4">
                    {[
                      { id: 'governance', name: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', nameEn: 'Governance', icon: Building2, color: 'purple' },
                      { id: 'riskManagement', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk Management', icon: AlertTriangle, color: 'red' },
                      { id: 'compliance', name: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance', icon: Shield, color: 'blue' },
                      { id: 'audit', name: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal Audit', icon: ClipboardCheck, color: 'amber' },
                      { id: 'training', name: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©', nameEn: 'Training & Awareness', icon: Users, color: 'emerald' },
                    ].map(domain => (
                      <div key={domain.id} className={`bg-white rounded-2xl border-2 border-slate-200 p-6 hover:shadow-lg transition-all`}>
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center gap-4">
                            <div className={`w-14 h-14 rounded-xl bg-${domain.color}-100 flex items-center justify-center`}>
                              <domain.icon className={`w-7 h-7 text-${domain.color}-600`} />
                            </div>
                            <div>
                              <h4 className="font-bold text-slate-800 text-lg">{domain.name}</h4>
                              <p className="text-slate-500 text-sm">{domain.nameEn}</p>
                            </div> </div>
                          <div className="text-left">
                            <p className="text-3xl font-black text-slate-800">{domainScores[domain.id]?.score || 70}%</p>
                            <p className="text-slate-500 text-sm">L{domainScores[domain.id]?.level || 3}</p>
                          </div> </div>
                        <div className="space-y-3">
                          <div>
                            <label className="text-sm text-slate-600 mb-2 block">Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: {domainScores[domain.id]?.score || 70}%</label>
                            <input type="range" min="0" max="100" value={domainScores[domain.id]?.score || 70}
                              onChange={e => setDomainScores({ ...domainScores, [domain.id]: { ...domainScores[domain.id], score: parseInt(e.target.value), level: Math.ceil(parseInt(e.target.value) / 20) } })}
                              className="w-full h-3 bg-slate-200 rounded-full appearance-none cursor-pointer accent-purple-500" />
                          </div>
                          <div className="flex gap-2">
                            {[1, 2, 3, 4, 5].map(level => (
                              <button key={level} onClick={() => setDomainScores({ ...domainScores, [domain.id]: { ...domainScores[domain.id], level, score: level * 20 } })}
                                className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${(domainScores[domain.id]?.level || 3) === level
                                  ? level <= 2 ? 'bg-red-500 text-white' : level === 3 ? 'bg-amber-500 text-white' : level === 4 ? 'bg-blue-500 text-white' : 'bg-emerald-500 text-white'
                                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                  }`}>L{level}</button>
                            ))}
                          </div> </div> </div>
                    ))}
                  </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-6 animate-fadeIn">
                  <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200">
                    <h3 className="text-xl font-black text-amber-800 mb-2 flex items-center gap-3">
                      <Target className="w-6 h-6" />ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ„ÙŠ
                    </h3>
                    <p className="text-amber-600">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ù„Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</p>
                  </div>

                  <div className="grid grid-cols-2 gap-8">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 text-lg mb-6 text-center">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
                      <div className="grid grid-cols-5 gap-3">
                        {[1, 2, 3, 4, 5].map(level => {
                          const config = MATURITY_LEVELS[level];
                          return (
                            <button key={level} onClick={() => setFormData({ ...formData, currentLevel: level })}
                              className={`p-4 rounded-2xl border-2 transition-all flex flex-col items-center ${formData.currentLevel === level
                                ? `bg-${config.color}-50 border-${config.color}-400 shadow-lg scale-105`
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <span className="text-4xl mb-2">{config.icon}</span>
                              <span className={`text-2xl font-black ${formData.currentLevel === level ? `text-${config.color}-600` : 'text-slate-600'}`}>L{level}</span>
                              <span className="text-xs text-slate-500 mt-1">{config.name}</span>
                            </button>);
                        })}
                      </div>
                      <div className="mt-6 p-4 bg-slate-50 rounded-xl text-center">
                        <p className="text-slate-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <p className="text-4xl font-black text-slate-800 my-2">{MATURITY_LEVELS[formData.currentLevel]?.icon} L{formData.currentLevel}</p>
                        <p className="text-slate-500">{MATURITY_LEVELS[formData.currentLevel]?.description}</p>
                      </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-purple-200 p-6">
                      <h4 className="font-bold text-purple-800 text-lg mb-6 text-center">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</h4>
                      <div className="grid grid-cols-5 gap-3">
                        {[1, 2, 3, 4, 5].map(level => (
                          <button key={level} onClick={() => setFormData({ ...formData, targetLevel: level })}
                            className={`p-4 rounded-2xl border-2 transition-all flex flex-col items-center ${formData.targetLevel === level
                              ? 'bg-purple-50 border-purple-400 shadow-lg scale-105'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <span className="text-4xl mb-2">ğŸ¯</span>
                            <span className={`text-2xl font-black ${formData.targetLevel === level ? 'text-purple-600' : 'text-slate-600'}`}>L{level}</span>
                          </button>
                        ))}
                      </div>
                      <div className="mt-6 p-4 bg-purple-50 rounded-xl text-center">
                        <p className="text-purple-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                        <p className="text-4xl font-black text-purple-800 my-2">ğŸ¯ L{formData.targetLevel}</p>
                        <p className="text-purple-500">{MATURITY_LEVELS[formData.targetLevel]?.description}</p>
                      </div> </div> </div>
                  <div className={`rounded-2xl p-6 ${formData.targetLevel - formData.currentLevel > 0
                    ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200'
                    : 'bg-gradient-to-r from-emerald-50 to-teal-50 border-2 border-emerald-200'
                    }`}>
                    <div className="flex items-center justify-between">
                      <div>
                        <h4 className={`font-bold text-xl ${formData.targetLevel - formData.currentLevel > 0 ? 'text-amber-800' : 'text-emerald-800'}`}>
                          ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ©
                        </h4>
                        <p className={formData.targetLevel - formData.currentLevel > 0 ? 'text-amber-600' : 'text-emerald-600'}>
                          {formData.targetLevel - formData.currentLevel > 0
                            ? `ÙŠÙ„Ø²Ù… ØªØ­Ø³ÙŠÙ† ${formData.targetLevel - formData.currentLevel} Ù…Ø³ØªÙˆÙ‰ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù`
                            : 'ØªÙ… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ø£Ùˆ ØªØ¬Ø§ÙˆØ²Ù‡ âœ“'}
                        </p> </div>
                      <div className={`w-24 h-24 rounded-full flex items-center justify-center ${formData.targetLevel - formData.currentLevel > 0 ? 'bg-amber-100' : 'bg-emerald-100'
                        }`}>
                        <span className={`text-4xl font-black ${formData.targetLevel - formData.currentLevel > 0 ? 'text-amber-600' : 'text-emerald-600'}`}>
                          {formData.targetLevel - formData.currentLevel > 0 ? `+${formData.targetLevel - formData.currentLevel}` : 'âœ“'}
                        </span> </div> </div> </div> </div>
              )}

              {wizardStep === 4 && (
                <div className="space-y-6 animate-fadeIn">
                  <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-6 border-2 border-emerald-200">
                    <h3 className="text-xl font-black text-emerald-800 mb-2 flex items-center gap-3">
                      <TrendingUp className="w-6 h-6" />Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†
                    </h3>
                    <p className="text-emerald-600">Ø­Ø¯Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø³Ø¯ Ø§Ù„ÙØ¬ÙˆØ§Øª</p>
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-slate-800">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†</h4>
                      <button onClick={() => setImprovementActions([...improvementActions, { id: Date.now(), domain: '', action: '', priority: 'Medium', dueDate: '' }])}
                        className="px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold flex items-center gap-2 hover:bg-emerald-600">
                        <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡
                      </button> </div>
                    {improvementActions.length === 0 ? (
                      <div className="text-center py-12 bg-slate-50 rounded-xl">
                        <TrendingUp className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                        <p className="text-slate-500">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØ­Ø³ÙŠÙ† Ø¨Ø¹Ø¯</p>
                        <button onClick={() => setImprovementActions([{ id: Date.now(), domain: 'governance', action: '', priority: 'High', dueDate: '' }])}
                          className="mt-4 px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold">
                          Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¥Ø¬Ø±Ø§Ø¡
                        </button> </div>
                    ) : (
                      <div className="space-y-4">
                        {improvementActions.map((action, idx) => (
                          <div key={action.id} className="p-4 bg-slate-50 rounded-xl border border-slate-200">
                            <div className="flex items-center justify-between mb-3">
                              <span className="px-3 py-1 bg-slate-200 rounded-lg text-sm font-bold">Ø¥Ø¬Ø±Ø§Ø¡ #{idx + 1}</span>
                              <button onClick={() => setImprovementActions(improvementActions.filter(a => a.id !== action.id))}
                                className="p-1 text-red-500 hover:bg-red-100 rounded-lg">
                                <X className="w-4 h-4" />
                              </button> </div>
                            <div className="grid grid-cols-4 gap-3">
                              <select value={action.domain} onChange={e => setImprovementActions(improvementActions.map(a => a.id === action.id ? { ...a, domain: e.target.value } : a))}
                                className="px-3 py-2 border border-slate-200 rounded-lg text-sm">
                                <option value="">Ø§Ù„Ù…Ø¬Ø§Ù„</option>
                                <option value="governance">Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</option>
                                <option value="risk">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                                <option value="compliance">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</option>
                                <option value="audit">Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚</option>
                                <option value="training">Ø§Ù„ØªØ¯Ø±ÙŠØ¨</option>
                              </select>
                              <input type="text" placeholder="ÙˆØµÙ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡" value={action.action}
                                onChange={e => setImprovementActions(improvementActions.map(a => a.id === action.id ? { ...a, action: e.target.value } : a))}
                                className="px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                              <select value={action.priority} onChange={e => setImprovementActions(improvementActions.map(a => a.id === action.id ? { ...a, priority: e.target.value } : a))}
                                className="px-3 py-2 border border-slate-200 rounded-lg text-sm">
                                <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                              </select>
                              <input type="date" value={action.dueDate}
                                onChange={e => setImprovementActions(improvementActions.map(a => a.id === action.id ? { ...a, dueDate: e.target.value } : a))}
                                className="px-3 py-2 border border-slate-200 rounded-lg text-sm" />
                            </div> </div>
                        ))}
                      </div>
                    )}
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-3">Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª</label>
                    <textarea value={formData.notes} onChange={e => setFormData({ ...formData, notes: e.target.value })}
                      rows={4} placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªÙ‚ÙŠÙŠÙ…..."
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-emerald-400 resize-none" />
                  </div> </div>
              )}

              {wizardStep === 5 && (
                <div className="space-y-6 animate-fadeIn">
                  <div className="bg-gradient-to-r from-violet-50 to-purple-50 rounded-2xl p-6 border-2 border-violet-200">
                    <h3 className="text-xl font-black text-violet-800 mb-2 flex items-center gap-3">
                      <CheckCircle2 className="w-6 h-6" />Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                    </h3>
                    <p className="text-violet-600">Ø±Ø§Ø¬Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className={`p-4 text-white ${formData.authorityCode === 'SAMA' ? 'bg-gradient-to-r from-emerald-500 to-teal-600' :
                        formData.authorityCode === 'NCA' ? 'bg-gradient-to-r from-purple-500 to-violet-600' :
                          formData.authorityCode === 'SDAIA' ? 'bg-gradient-to-r from-indigo-500 to-blue-600' :
                            formData.authorityCode === 'CMA' ? 'bg-gradient-to-r from-blue-500 to-cyan-600' :
                              'bg-gradient-to-r from-amber-500 to-orange-600'
                        }`}>
                        <div className="flex items-center gap-4">
                          <div className="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center font-bold text-xl">
                            {formData.authorityCode?.substring(0, 2) || '??'}
                          </div>
                          <div>
                            <h4 className="font-bold text-xl">{formData.authorityCode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h4>
                            <p className="opacity-80">{AUTHORITIES.find(a => a.code === formData.authorityCode)?.nameAr || '-'}</p>
                          </div> </div> </div>
                      <div className="p-6 space-y-4">
                        <div className="flex justify-between items-center py-2 border-b border-slate-100">
                          <span className="text-slate-500">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</span>
                          <span className="font-bold text-slate-800">{formData.assessor || '-'}</span>
                        </div>
                        <div className="flex justify-between items-center py-2 border-b border-slate-100">
                          <span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
                          <span className="font-bold text-slate-800">{formData.assessmentDate || '-'}</span>
                        </div>
                        <div className="flex justify-between items-center py-2 border-b border-slate-100">
                          <span className="text-slate-500">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø§Ø¯Ù…</span>
                          <span className="font-bold text-slate-800">{formData.nextAssessment || '-'}</span>
                        </div>
                        <div className="flex justify-between items-center py-2">
                          <span className="text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                          <span className={`px-3 py-1 rounded-lg text-sm font-bold ${formData.status === 'Completed' ? 'bg-emerald-100 text-emerald-700' :
                            formData.status === 'InProgress' ? 'bg-amber-100 text-amber-700' :
                              'bg-slate-100 text-slate-700'
                            }`}>{formData.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„' : formData.status === 'InProgress' ? 'Ø¬Ø§Ø±ÙŠ' : 'Ù…Ø®Ø·Ø·'}</span>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-6">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h4>
                      <div className="flex items-center justify-center gap-8 mb-6">
                        <div className="text-center">
                          <p className="text-6xl mb-2">{MATURITY_LEVELS[formData.currentLevel]?.icon}</p>
                          <p className="text-3xl font-black text-slate-800">L{formData.currentLevel}</p>
                          <p className="text-slate-500">Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        </div>
                        <ArrowLeft className="w-10 h-10 text-slate-300" />
                        <div className="text-center">
                          <p className="text-6xl mb-2">ğŸ¯</p>
                          <p className="text-3xl font-black text-purple-600">L{formData.targetLevel}</p>
                          <p className="text-slate-500">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                        </div> </div>
                      <div className={`p-4 rounded-xl text-center ${formData.targetLevel - formData.currentLevel > 0 ? 'bg-amber-50' : 'bg-emerald-50'
                        }`}>
                        <p className={`font-bold ${formData.targetLevel - formData.currentLevel > 0 ? 'text-amber-700' : 'text-emerald-700'}`}>
                          {formData.targetLevel - formData.currentLevel > 0
                            ? `Ø§Ù„ÙØ¬ÙˆØ©: ${formData.targetLevel - formData.currentLevel} Ù…Ø³ØªÙˆÙ‰`
                            : 'âœ“ Ø§Ù„Ù‡Ø¯Ù Ù…Ø­Ù‚Ù‚'}
                        </p> </div> </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <h4 className="font-bold text-slate-800 mb-4">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</h4>
                    <div className="grid grid-cols-5 gap-4">
                      {Object.entries(domainScores).map(([key, value]) => {
                        const names = { governance: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', riskManagement: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±', compliance: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', audit: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', training: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨' };
                        return (
                          <div key={key} className="text-center p-4 bg-slate-50 rounded-xl">
                            <p className="text-2xl mb-1">{MATURITY_LEVELS[value.level]?.icon}</p>
                            <p className="font-bold text-slate-800">L{value.level}</p>
                            <p className="text-sm text-slate-500">{names[key]}</p>
                            <p className="text-lg font-bold text-purple-600">{value.score}%</p>
                          </div>);
                      })}
                    </div> </div>
                  {improvementActions.length > 0 && (
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† ({improvementActions.length})</h4>
                      <div className="space-y-2">
                        {improvementActions.map((action, idx) => (
                          <div key={action.id} className="flex items-center gap-4 p-3 bg-slate-50 rounded-xl">
                            <span className="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600 font-bold">{idx + 1}</span>
                            <span className="flex-1 text-slate-700">{action.action || 'Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                            <span className={`px-2 py-1 rounded-lg text-xs font-bold ${action.priority === 'Critical' ? 'bg-red-100 text-red-700' :
                              action.priority === 'High' ? 'bg-amber-100 text-amber-700' :
                                'bg-slate-100 text-slate-700'
                              }`}>{action.priority}</span>
                          </div>
                        ))}
                      </div> </div>
                  )}
                </div>
              )}
            </div>

            <div className="border-t-2 border-slate-100 px-8 py-5 flex items-center justify-between bg-slate-50">
              <button onClick={() => setWizardStep(Math.max(1, wizardStep - 1))} disabled={wizardStep === 1}
                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all ${wizardStep === 1 ? 'bg-slate-200 text-slate-400 cursor-not-allowed' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'
                  }`}>
                <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
              </button>

              <div className="flex items-center gap-2">
                {[1, 2, 3, 4, 5].map(step => (
                  <button key={step} onClick={() => setWizardStep(step)}
                    className={`w-3 h-3 rounded-full transition-all ${wizardStep === step ? 'bg-purple-500 scale-125' : wizardStep > step ? 'bg-emerald-400' : 'bg-slate-300'
                      }`} />
                ))}
              </div>

              {wizardStep < 5 ? (
                <button onClick={() => setWizardStep(Math.min(5, wizardStep + 1))}
                  className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                </button>
              ) : (
                <button onClick={showEditModal ? handleEditAssessment : handleAddAssessment} disabled={isSubmitting}
                  className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold transition-all ${isSubmitting ? 'bg-slate-300 text-slate-500' : 'bg-gradient-to-r from-emerald-500 to-teal-600 text-white hover:shadow-lg'
                    }`}>
                  {isSubmitting ? (
                    <><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</>
                  ) : (
                    <><Save className="w-5 h-5" />{showEditModal ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</>
                  )}
                </button>
              )}
            </div> </div> </div>
      )}

      {showViewModal && selectedAssessment && (
        <div className="fixed inset-0 bg-gradient-to-br from-slate-900/90 via-purple-900/70 to-slate-900/90 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowViewModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>

            <div className={`relative overflow-hidden ${selectedAssessment.authorityCode === 'SAMA' ? 'bg-gradient-to-r from-emerald-500 via-teal-500 to-emerald-600' :
              selectedAssessment.authorityCode === 'NCA' ? 'bg-gradient-to-r from-purple-500 via-violet-500 to-purple-600' :
                selectedAssessment.authorityCode === 'SDAIA' ? 'bg-gradient-to-r from-indigo-500 via-blue-500 to-indigo-600' :
                  selectedAssessment.authorityCode === 'CMA' ? 'bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-600' :
                    'bg-gradient-to-r from-amber-500 via-orange-500 to-amber-600'
              }`}>
              <div className="absolute inset-0 opacity-20">
                <div className="absolute top-0 left-0 w-40 h-40 bg-white rounded-full -translate-x-1/2 -translate-y-1/2" />
                <div className="absolute bottom-0 right-0 w-60 h-60 bg-white rounded-full translate-x-1/3 translate-y-1/3" />
              </div>

              <div className="relative px-8 py-6 flex items-center justify-between">
                <div className="flex items-center gap-5">
                  <div className="w-20 h-20 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center font-black text-3xl text-white">
                    {selectedAssessment.authorityCode.substring(0, 2)}
                  </div>
                  <div className="text-white">
                    <h2 className="text-3xl font-black">{selectedAssessment.authorityCode}</h2>
                    <p className="opacity-80 text-lg">{AUTHORITIES.find(a => a.id === selectedAssessment.authorityId)?.nameAr}</p>
                  </div> </div>
                <div className="flex items-center gap-4">
                  <span className={`px-4 py-2 rounded-xl font-bold ${selectedAssessment.status === 'Completed' ? 'bg-white/20 text-white' : 'bg-amber-400 text-amber-900'
                    }`}>{selectedAssessment.status === 'Completed' ? 'âœ“ Ù…ÙƒØªÙ…Ù„' : 'â³ Ø¬Ø§Ø±ÙŠ'}</span>
                  <button onClick={() => setShowViewModal(false)} className="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center text-white">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="relative px-8 pb-4">
                <div className="flex gap-2">
                  {[
                    { id: 'overview', label: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', icon: LayoutDashboard },
                    { id: 'domains', label: 'Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª', icon: Layers },
                    { id: 'history', label: 'Ø§Ù„Ø³Ø¬Ù„', icon: History },
                  ].map(tab => (
                    <button key={tab.id} onClick={() => setViewTab(tab.id)}
                      className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all ${viewTab === tab.id ? 'bg-white text-slate-800' : 'bg-white/10 text-white hover:bg-white/20'
                        }`}>
                      <tab.icon className="w-5 h-5" />{tab.label}
                    </button>
                  ))}
                </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-8">
              {viewTab === 'overview' && (
                <div className="space-y-6">
                  <div className="grid grid-cols-4 gap-4">
                    <div className="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-6 text-center border-2 border-slate-200">
                      <p className="text-5xl mb-2">{MATURITY_LEVELS[selectedAssessment.currentLevel]?.icon}</p>
                      <p className="text-4xl font-black text-slate-800">L{selectedAssessment.currentLevel}</p>
                      <p className="text-slate-500">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                    </div>
                    <div className="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-6 text-center border-2 border-purple-200">
                      <p className="text-5xl mb-2">ğŸ¯</p>
                      <p className="text-4xl font-black text-purple-600">L{selectedAssessment.targetLevel}</p>
                      <p className="text-slate-500">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                    </div>
                    <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-6 text-center border-2 border-blue-200">
                      <p className="text-5xl mb-2">ğŸ“Š</p>
                      <p className="text-4xl font-black text-blue-600">{selectedAssessment.score}%</p>
                      <p className="text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¶Ø¬</p>
                    </div>
                    <div className={`rounded-2xl p-6 text-center border-2 ${selectedAssessment.targetLevel - selectedAssessment.currentLevel > 0
                      ? 'bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200'
                      : 'bg-gradient-to-br from-emerald-50 to-teal-50 border-emerald-200'
                      }`}>
                      <p className="text-5xl mb-2">{selectedAssessment.targetLevel - selectedAssessment.currentLevel > 0 ? 'âš ï¸' : 'âœ…'}</p>
                      <p className={`text-4xl font-black ${selectedAssessment.targetLevel - selectedAssessment.currentLevel > 0 ? 'text-amber-600' : 'text-emerald-600'}`}>
                        {selectedAssessment.targetLevel - selectedAssessment.currentLevel > 0 ? selectedAssessment.targetLevel - selectedAssessment.currentLevel : '0'}
                      </p>
                      <p className="text-slate-500">Ø§Ù„ÙØ¬ÙˆØ©</p>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Calendar className="w-5 h-5 text-blue-500" />Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                      <div className="space-y-3">
                        <div className="flex justify-between py-2 border-b border-slate-100"><span className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span><span className="font-bold">{selectedAssessment.assessmentDate}</span></div>
                        <div className="flex justify-between py-2 border-b border-slate-100"><span className="text-slate-500">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø§Ø¯Ù…</span><span className="font-bold">{selectedAssessment.nextAssessment}</span></div>
                        <div className="flex justify-between py-2 border-b border-slate-100"><span className="text-slate-500">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</span><span className="font-bold">{selectedAssessment.assessor}</span></div>
                        <div className="flex justify-between py-2"><span className="text-slate-500">Ø§Ù„ØªØ­Ø³Ù†</span>
                          <span className={`font-bold ${selectedAssessment.currentLevel > selectedAssessment.previousLevel ? 'text-emerald-600' : 'text-slate-500'}`}>
                            {selectedAssessment.currentLevel > selectedAssessment.previousLevel ? `â†‘ +${selectedAssessment.currentLevel - selectedAssessment.previousLevel}` : 'â€”'}
                          </span> </div> </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><BarChart3 className="w-5 h-5 text-purple-500" />Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬</h4>
                      <div className="space-y-2">
                        {[5, 4, 3, 2, 1].map(level => (
                          <div key={level} className={`flex items-center gap-3 p-2 rounded-lg ${selectedAssessment.currentLevel === level ? 'bg-purple-50' : ''}`}>
                            <span className="text-2xl">{MATURITY_LEVELS[level].icon}</span>
                            <span className="font-bold">L{level}</span>
                            <span className="text-slate-500 flex-1">{MATURITY_LEVELS[level].name}</span>
                            {selectedAssessment.currentLevel === level && <span className="px-2 py-1 bg-purple-500 text-white text-xs rounded-lg font-bold">Ø§Ù„Ø­Ø§Ù„ÙŠ</span>}
                            {selectedAssessment.targetLevel === level && <span className="px-2 py-1 bg-amber-500 text-white text-xs rounded-lg font-bold">Ø§Ù„Ù‡Ø¯Ù</span>}
                          </div>
                        ))}
                      </div> </div> </div> </div>
              )}

              {viewTab === 'domains' && (
                <div className="space-y-4">
                  {selectedAssessment.domains?.map((domain, idx) => (
                    <div key={idx} className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-4">
                          <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <Layers className="w-6 h-6 text-purple-600" />
                          </div>
                          <div>
                            <h4 className="font-bold text-slate-800 text-lg">{domain.name}</h4>
                            <p className="text-slate-500 text-sm">{domain.nameEn}</p>
                          </div> </div>
                        <div className="flex items-center gap-4">
                          <span className="text-3xl">{MATURITY_LEVELS[domain.level]?.icon}</span>
                          <div className="text-left">
                            <p className="text-2xl font-black text-slate-800">L{domain.level}</p>
                            <p className="text-slate-500">{domain.score}%</p>
                          </div> </div> </div>
                      <div className="h-4 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full rounded-full transition-all ${domain.score >= 80 ? 'bg-gradient-to-r from-emerald-400 to-emerald-500' :
                          domain.score >= 60 ? 'bg-gradient-to-r from-blue-400 to-blue-500' :
                            domain.score >= 40 ? 'bg-gradient-to-r from-amber-400 to-amber-500' :
                              'bg-gradient-to-r from-red-400 to-red-500'
                          }`} style={{ width: `${domain.score}%` }} />
                      </div> </div>
                  ))}
                </div>
              )}

              {viewTab === 'history' && (
                <div className="space-y-4">
                  {[
                    { date: selectedAssessment.assessmentDate, action: 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', user: selectedAssessment.assessor, type: 'complete' },
                    { date: '2024-12-01', action: 'Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', user: selectedAssessment.assessor, type: 'start' },
                    { date: '2024-11-15', action: 'Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', user: 'Ø§Ù„Ù†Ø¸Ø§Ù…', type: 'schedule' },
                  ].map((item, idx) => (
                    <div key={idx} className="flex items-center gap-4 p-4 bg-white rounded-xl border border-slate-200">
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${item.type === 'complete' ? 'bg-emerald-100' : item.type === 'start' ? 'bg-blue-100' : 'bg-slate-100'
                        }`}>
                        {item.type === 'complete' ? <CheckCircle2 className="w-6 h-6 text-emerald-600" /> :
                          item.type === 'start' ? <Play className="w-6 h-6 text-blue-600" /> :
                            <Calendar className="w-6 h-6 text-slate-600" />}
                      </div>
                      <div className="flex-1">
                        <p className="font-bold text-slate-800">{item.action}</p>
                        <p className="text-slate-500 text-sm">Ø¨ÙˆØ§Ø³Ø·Ø©: {item.user}</p>
                      </div>
                      <span className="text-slate-500">{item.date}</span>
                    </div>
                  ))}
                </div>
              )}
            </div>

            <div className="border-t-2 border-slate-100 px-8 py-5 flex items-center justify-between bg-slate-50">
              <button onClick={() => setShowViewModal(false)} className="px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex gap-3">
                <button onClick={() => { setShowViewModal(false); openEditModal(selectedAssessment); }}
                  className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold flex items-center gap-2 hover:bg-amber-600">
                  <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button className="px-6 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white rounded-xl font-bold flex items-center gap-2 hover:shadow-lg">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± PDF
                </button> </div> </div> </div> </div>
      )}

      {showDeleteModal && selectedAssessment && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowDeleteModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-8 py-8 text-white text-center">
              <div className="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-12 h-12" />
              </div>
              <h2 className="text-2xl font-black">ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h2>
            </div>

            <div className="p-8 text-center">
              <p className="text-slate-600 text-lg mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØªÙ‚ÙŠÙŠÙ…</p>
              <div className={`inline-flex items-center gap-3 px-6 py-3 rounded-xl ${selectedAssessment.authorityCode === 'SAMA' ? 'bg-emerald-50' :
                selectedAssessment.authorityCode === 'NCA' ? 'bg-purple-50' : 'bg-slate-50'
                }`}>
                <span className={`w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold ${selectedAssessment.authorityCode === 'SAMA' ? 'bg-emerald-500' :
                  selectedAssessment.authorityCode === 'NCA' ? 'bg-purple-500' : 'bg-slate-500'
                  }`}>{selectedAssessment.authorityCode.substring(0, 2)}</span>
                <div className="text-right">
                  <p className="text-xl font-black text-slate-800">{selectedAssessment.authorityCode}</p>
                  <p className="text-slate-500">{AUTHORITIES.find(a => a.id === selectedAssessment.authorityId)?.nameAr}</p>
                </div> </div>
              <div className="mt-6 p-4 bg-red-50 rounded-xl border border-red-200">
                <p className="text-red-600 font-bold">âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
                <p className="text-red-500 text-sm mt-1">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</p>
              </div> </div>
            <div className="px-8 py-5 bg-slate-50 flex items-center justify-center gap-4 border-t">
              <button onClick={() => setShowDeleteModal(false)} className="px-8 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDeleteAssessment} disabled={isSubmitting}
                className={`px-8 py-3 rounded-xl font-bold flex items-center gap-2 ${isSubmitting ? 'bg-slate-300 text-slate-500' : 'bg-gradient-to-r from-red-500 to-rose-600 text-white hover:shadow-lg'
                  }`}>
                {isSubmitting ? <><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...</> : <><Trash2 className="w-5 h-5" />Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</>}
              </button> </div> </div> </div>
      )}

      {showFrameworkModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    {frameworkModalMode === 'create' ? <Plus className="w-7 h-7" /> : <Edit className="w-7 h-7" />}
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">{frameworkModalMode === 'create' ? 'Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯' : 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</h2>
                    <p className="text-purple-200 text-sm">Assessment Framework</p>
                  </div> </div>
                <button onClick={() => setShowFrameworkModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø·Ø§Ø± *</label>
                  <input type="text" value={frameworkFormData.code} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, code: e.target.value.toUpperCase() })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none font-mono"
                    placeholder="Ù…Ø«Ø§Ù„: CMMI, COBIT" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                  <input type="text" value={frameworkFormData.version} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, version: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                    placeholder="Ù…Ø«Ø§Ù„: v2.0, 2019" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *</label>
                <input type="text" value={frameworkFormData.nameAr} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, nameAr: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                  placeholder="Ù…Ø«Ø§Ù„: Ù†Ù…ÙˆØ°Ø¬ Ù†Ø¶Ø¬ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                <input type="text" value={frameworkFormData.name} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, name: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                  placeholder="e.g. CMMI for Services" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
                <textarea value={frameworkFormData.description} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, description: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none h-24 resize-none"
                  placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø¥Ø·Ø§Ø±..." />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ø¯Ø¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¶Ø¬</label>
                  <div className="flex items-center gap-2">
                    {[3, 4, 5, 6].map(n => (
                      <button key={n} type="button" onClick={() => setFrameworkFormData({ ...frameworkFormData, levels: n })}
                        className={`flex-1 py-3 rounded-xl font-bold transition-all ${frameworkFormData.levels === n ? 'bg-purple-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                        {n}
                      </button>
                    ))}
                  </div> </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ø¯Ø¯ Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                  <input type="number" min="1" max="50" value={frameworkFormData.domains} onChange={(e) => setFrameworkFormData({ ...frameworkFormData, domains: parseInt(e.target.value) || 1 })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none"
                    placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                <div className="flex items-center gap-3">
                  <button type="button" onClick={() => setFrameworkFormData({ ...frameworkFormData, status: 'Active' })}
                    className={`flex-1 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${frameworkFormData.status === 'Active' ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                    <CheckCircle2 className="w-5 h-5" />Ù†Ø´Ø·
                  </button>
                  <button type="button" onClick={() => setFrameworkFormData({ ...frameworkFormData, status: 'Inactive' })}
                    className={`flex-1 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${frameworkFormData.status === 'Inactive' ? 'bg-slate-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                    <XCircle className="w-5 h-5" />ØºÙŠØ± Ù†Ø´Ø·
                  </button> </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowFrameworkModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleSaveFramework} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                <Save className="w-5 h-5" />{frameworkModalMode === 'create' ? 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø·Ø§Ø±' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
              </button> </div> </div> </div>
      )}

      {showTemplateModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-xl overflow-hidden">
            <div className="bg-gradient-to-r from-indigo-600 to-blue-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    <FileQuestion className="w-7 h-7" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</h2>
                    <p className="text-indigo-200 text-sm">Assessment Template</p>
                  </div> </div>
                <button onClick={() => setShowTemplateModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø§Ù„Ø¨ *</label>
                  <input type="text" value={templateFormData.code} onChange={(e) => setTemplateFormData({ ...templateFormData, code: e.target.value.toUpperCase() })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none font-mono"
                    placeholder="TPL-XXX" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·</label>
                  <select value={templateFormData.frameworkId || ''} onChange={(e) => setTemplateFormData({ ...templateFormData, frameworkId: parseInt(e.target.value) })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø·Ø§Ø±</option>
                    {frameworks.map(fw => (
                      <option key={fw.id} value={fw.id}>{fw.nameAr}</option>
                    ))}
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ *</label>
                <input type="text" value={templateFormData.name} onChange={(e) => setTemplateFormData({ ...templateFormData, name: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none"
                  placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø§Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… SAMA Ø§Ù„Ø´Ø§Ù…Ù„" />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label>
                  <input type="number" min="5" max="200" value={templateFormData.questionCount} onChange={(e) => setTemplateFormData({ ...templateFormData, questionCount: parseInt(e.target.value) || 20 })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</label>
                  <select value={templateFormData.duration} onChange={(e) => setTemplateFormData({ ...templateFormData, duration: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    <option value="1 Ø³Ø§Ø¹Ø©">1 Ø³Ø§Ø¹Ø©</option>
                    <option value="2 Ø³Ø§Ø¹Ø§Øª">2 Ø³Ø§Ø¹Ø§Øª</option>
                    <option value="4 Ø³Ø§Ø¹Ø§Øª">4 Ø³Ø§Ø¹Ø§Øª</option>
                    <option value="6 Ø³Ø§Ø¹Ø§Øª">6 Ø³Ø§Ø¹Ø§Øª</option>
                    <option value="8 Ø³Ø§Ø¹Ø§Øª">8 Ø³Ø§Ø¹Ø§Øª</option>
                  </select>
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowTemplateModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleSaveTemplate} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-xl font-bold shadow-lg hover:shadow-xl">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ù„Ø¨
              </button> </div> </div> </div>
      )}

      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-[60] px-6 py-3 rounded-xl shadow-lg font-bold flex items-center gap-2 ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertCircle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}
    </div>);
};

// Module 5.4: Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
// Saudi Regulatory Pack v1 - World-Class Premium Edition

// ADVANCED ACTIVATION WIZARD
const SaudiRegulatoryPack = () => {
  // STATE MANAGEMENT - Premium Edition
  const [activeTab, setActiveTab] = useState('catalog');
  const [searchQuery, setSearchQuery] = useState('');
  const [filterAuthority, setFilterAuthority] = useState('');
  const [filterSeverity, setFilterSeverity] = useState('');
  const [filterSector, setFilterSector] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterCountry, setFilterCountry] = useState('');
  const [viewMode, setViewMode] = useState('table');

  const [showProgramModal, setShowProgramModal] = useState(false);
  const [showObligationModal, setShowObligationModal] = useState(false);
  const [showStandardModal, setShowStandardModal] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [showAdvancedWizard, setShowAdvancedWizard] = useState(false);
  const [programModalTab, setProgramModalTab] = useState(0);

  // Edit States
  const [editMode, setEditMode] = useState(false);
  const [selectedProgram, setSelectedProgram] = useState(null);
  const [selectedObligation, setSelectedObligation] = useState(null);
  const [deleteTarget, setDeleteTarget] = useState(null);

  const [selectedRequirement, setSelectedRequirement] = useState(null);
  const [showRequirementModal, setShowRequirementModal] = useState(false);
  const [gapAnalysisFramework, setGapAnalysisFramework] = useState('');
  const [selectedChangeItem, setSelectedChangeItem] = useState(null);
  const [impactAssessmentData, setImpactAssessmentData] = useState(null);

  // Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ØªÙØ³ÙŠØ±ÙŠØ© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
  const [regulatoryRequirements] = useState([
    // SAMA-AML Requirements - Full Text
    {
      id: 'REQ-SAMA-AML-001', code: 'SAMA-AML-1.1', frameworkCode: 'SAMA-AML', authority: 'SAMA',
      titleAr: 'Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ (CDD)', titleEn: 'Customer Due Diligence', articleNumber: 'Ø§Ù„Ù…Ø§Ø¯Ø© 1 - Ø§Ù„Ø¨Ù†Ø¯ 1.1',
      fullTextAr: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ¶Ø¹ ÙˆØªÙ†ÙÙŠØ° Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ØªØªØ¶Ù…Ù†: (Ø£) Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© ÙˆÙ…Ø³ØªÙ‚Ù„Ø©ØŒ (Ø¨) Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙ‡ØŒ (Ø¬) ÙÙ‡Ù… Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„ØºØ±Ø¶ Ù…Ù†Ù‡Ø§ØŒ (Ø¯) Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©.',
      fullTextEn: 'Financial institutions must establish and implement Customer Due Diligence policies and procedures including: (a) Verifying customer identity using reliable and independent sources, (b) Identifying beneficial owners and verifying their identity, (c) Understanding the nature and purpose of the business relationship, (d) Conducting ongoing monitoring of the business relationship.',
      guidanceNotes: [
        'ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø© Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø£Ùˆ ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨',
        'ÙŠÙ…ÙƒÙ† ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù†Ø®ÙØ¶ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØªØ¹Ø²ÙŠØ²Ù‡Ø§ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø±ØªÙØ¹ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
        'ÙŠØ¬Ø¨ ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù†Ø³Ø® Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª',
        'ÙŠØªØ·Ù„Ø¨ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø³ÙŠØ§Ø³ÙŠÙŠÙ† Ø§Ù„Ø¨Ø§Ø±Ø²ÙŠÙ† (PEPs) Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø¹Ø²Ø²Ø©'
      ],
      officialDocuments: [
        { name: 'Ù‚ÙˆØ§Ø¹Ø¯ Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ - Ø³Ø§Ù…Ø§', url: 'https://sama.gov.sa/ar-sa/Laws/Documents/AML_Rules_AR.pdf', type: 'PDF' },
        { name: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', url: 'https://sama.gov.sa/ar-sa/Laws/Documents/AML_Guide_AR.pdf', type: 'PDF' }
      ],
      effectiveDate: '2023-03-01', lastUpdated: '2024-06-15', nextReviewDate: '2025-03-01',
      versionHistory: [
        { version: '2.0', date: '2023-03-01', changes: 'ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ¥Ø¶Ø§ÙØ© KYC Ø§Ù„Ø±Ù‚Ù…ÙŠ' },
        { version: '1.5', date: '2021-01-01', changes: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ' },
        { version: '1.0', date: '2017-01-01', changes: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„' }
      ],
      relatedRequirements: ['SAMA-AML-1.2', 'SAMA-AML-1.3', 'NCA-ECC-3.1'],
      crossFrameworkMapping: [
        { framework: 'NCA-ECC', requirement: 'NCA-ECC-3.1', description: 'Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„' },
        { framework: 'SDAIA-PDPL', requirement: 'PDPL-5', description: 'Ù…ÙˆØ§ÙÙ‚Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' }
      ],
      complianceStatus: 'Compliant', gapStatus: 'No Gap',
      implementationNotes: 'ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù†Ø¸Ø§Ù… KYC Ø±Ù‚Ù…ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠ',
      criticality: 'Critical',
      category: 'Compliance'
    },
    {
      id: 'REQ-SAMA-AML-002', code: 'SAMA-AML-2.1', frameworkCode: 'SAMA-AML', authority: 'SAMA',
      titleAr: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', titleEn: 'Suspicious Transaction Reporting',
      articleNumber: 'Ø§Ù„Ù…Ø§Ø¯Ø© 2 - Ø§Ù„Ø¨Ù†Ø¯ 2.1',
      fullTextAr: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙÙˆØ±Ø§Ù‹ Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¹Ù† Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© ÙŠØ´ØªØ¨Ù‡ ÙÙŠ Ø£Ù†Ù‡Ø§ Ù…ØªØ­ØµÙ„Ø§Øª Ø¬Ø±ÙŠÙ…Ø© Ø£Ùˆ Ù…Ø±ØªØ¨Ø·Ø© Ø¨ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨ØŒ ÙˆØ°Ù„Ùƒ Ø®Ù„Ø§Ù„ Ù…Ø¯Ø© Ø£Ù‚ØµØ§Ù‡Ø§ 24 Ø³Ø§Ø¹Ø© Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ¨Ø§Ù‡. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¶Ù…Ù† Ø§Ù„Ø¨Ù„Ø§Øº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ù…Ø¹Ù†ÙŠØ©.',
      fullTextEn: 'Financial institutions must immediately report to the Financial Intelligence Unit any transaction suspected to be proceeds of crime or related to money laundering or terrorist financing, within a maximum of 24 hours from the date of suspicion. The report must include all available information about the transaction and parties involved.',
      guidanceNotes: [
        'ÙŠØ¨Ø¯Ø£ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ 24 Ø³Ø§Ø¹Ø© Ù…Ù† Ù„Ø­Ø¸Ø© ØªÙƒÙˆÙ‘Ù† Ø§Ù„Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆÙ„ÙŠØ³ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©',
        'ÙŠØ¬Ø¨ Ø¹Ø¯Ù… Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ù„Ø§Ø´ØªØ¨Ø§Ù‡ Ø£Ùˆ Ø§Ù„Ø¨Ù„Ø§Øº (Tipping-off)',
        'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª ÙˆØ§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø©',
        'ÙŠØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… "Ù‚ÙˆØ§ÙÙ„" Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„ØªØ§Ø¨Ø¹ Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©'
      ],
      officialDocuments: [
        { name: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', url: 'https://sama.gov.sa/Documents/STR_Guide.pdf', type: 'PDF' },
        { name: 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ù„Ø§Øº STR', url: 'https://safiu.gov.sa/str-form', type: 'Online' }
      ],
      effectiveDate: '2023-03-01', lastUpdated: '2024-08-01', nextReviewDate: '2025-03-01',
      versionHistory: [
        { version: '2.0', date: '2023-03-01', changes: 'ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ù…Ø¯Ø© Ù…Ù† 48 Ø¥Ù„Ù‰ 24 Ø³Ø§Ø¹Ø©' },
        { version: '1.0', date: '2017-01-01', changes: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„' }
      ],
      relatedRequirements: ['SAMA-AML-2.2', 'SAMA-AML-2.3'], crossFrameworkMapping: [], complianceStatus: 'Compliant',
      gapStatus: 'No Gap',
      implementationNotes: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù‚ÙˆØ§ÙÙ„',
      criticality: 'Critical',
      category: 'Compliance'
    },
    // NCA-ECC Requirements
    {
      id: 'REQ-NCA-ECC-001', code: 'NCA-ECC-1.1', frameworkCode: 'NCA-ECC', authority: 'NCA',
      titleAr: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', titleEn: 'Cybersecurity Strategy', articleNumber: 'Ø§Ù„Ø¶Ø§Ø¨Ø· 1-1',
      fullTextAr: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø© ÙˆØ¶Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ ØªØªØ¶Ù…Ù†: Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„ØºØ§ÙŠØ§ØªØŒ Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ØªØºØ·ÙŠØ©ØŒ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§ØªØŒ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŒ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ ÙˆØ¢Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±ÙŠ.',
      fullTextEn: 'The organization must establish a cybersecurity strategy approved by senior management that includes: objectives and goals, scope and coverage, roles and responsibilities, required resources, performance indicators, and periodic review and update mechanism.',
      guidanceNotes: [
        'ÙŠØ¬Ø¨ Ø£Ù† ØªØªÙˆØ§ÙÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ù‡Ø©',
        'ÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø³Ù†ÙˆÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø£Ùˆ Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« ØªØºÙŠÙŠØ±Ø§Øª Ø¬ÙˆÙ‡Ø±ÙŠØ©',
        'ÙŠØ¬Ø¨ Ø£Ù† ØªØ´Ù…Ù„ Ø®Ø§Ø±Ø·Ø© Ø·Ø±ÙŠÙ‚ Ù„Ù„ØªÙ†ÙÙŠØ° Ù…Ø¹ Ø¬Ø¯Ø§ÙˆÙ„ Ø²Ù…Ù†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©',
        'ÙŠØ¬Ø¨ Ø¥Ø´Ø±Ø§Ùƒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©'
      ],
      officialDocuments: [
        { name: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ECC-1:2018', url: 'https://nca.gov.sa/files/ecc.pdf', type: 'PDF' },
        { name: 'Ø¯Ù„ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ ECC', url: 'https://nca.gov.sa/files/ecc-guide.pdf', type: 'PDF' }
      ],
      effectiveDate: '2023-04-01', lastUpdated: '2024-01-15', nextReviewDate: '2025-04-01',
      versionHistory: [
        { version: '2.0', date: '2023-04-01', changes: 'ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„ Ù„Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø©' },
        { version: '1.0', date: '2018-01-01', changes: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„' }
      ],
      relatedRequirements: ['NCA-ECC-1.2', 'NCA-ECC-1.3'],
      crossFrameworkMapping: [
        { framework: 'SAMA-CSF', requirement: 'SAMA-CSF-001', description: 'Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ' },
        { framework: 'ISO27001', requirement: 'A.5.1', description: 'Ø³ÙŠØ§Ø³Ø§Øª Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' }
      ],
      complianceStatus: 'Partial', gapStatus: 'Minor Gap',
      implementationNotes: 'Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„ÙƒÙ† ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ« Ù„ØªØ´Ù…Ù„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
      criticality: 'High',
      category: 'Governance'
    },
    {
      id: 'REQ-NCA-ECC-002', code: 'NCA-ECC-2.1', frameworkCode: 'NCA-ECC', authority: 'NCA',
      titleAr: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©', titleEn: 'Information Asset Classification', articleNumber: 'Ø§Ù„Ø¶Ø§Ø¨Ø· 2-1',
      fullTextAr: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø© ØªØ­Ø¯ÙŠØ¯ ÙˆØªØµÙ†ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…Ø³ØªÙˆÙ‰ Ø­Ø³Ø§Ø³ÙŠØªÙ‡Ø§ ÙˆØ£Ù‡Ù…ÙŠØªÙ‡Ø§ØŒ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„ÙƒÙ„ Ø£ØµÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ†ÙŠÙ.',
      fullTextEn: 'The organization must identify and classify all information assets according to their sensitivity and importance level, designate an owner for each asset, and apply appropriate security controls based on classification.',
      guidanceNotes: [
        'ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… ØªØµÙ†ÙŠÙ Ù…ÙˆØ­Ø¯ (Ù…Ø«Ù„: Ø³Ø±ÙŠ Ù„Ù„ØºØ§ÙŠØ©ØŒ Ø³Ø±ÙŠØŒ Ø¯Ø§Ø®Ù„ÙŠØŒ Ø¹Ø§Ù…)',
        'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆÙ„ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ (Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)',
        'ÙŠØ¬Ø¨ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰ ØªØµÙ†ÙŠÙ',
        'ÙŠØ¬Ø¨ Ø±Ø¨Ø· Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„ØªØ´ÙÙŠØ±'
      ],
      officialDocuments: [
        { name: 'Ø¯Ù„ÙŠÙ„ ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©', url: 'https://nca.gov.sa/files/asset-classification.pdf', type: 'PDF' }
      ],
      effectiveDate: '2023-04-01', lastUpdated: '2024-03-01', nextReviewDate: '2025-04-01',
      versionHistory: [
        { version: '2.0', date: '2023-04-01', changes: 'Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©' },
        { version: '1.0', date: '2018-01-01', changes: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„' }
      ],
      relatedRequirements: ['NCA-ECC-2.2', 'SDAIA-PDPL-3'],
      crossFrameworkMapping: [
        { framework: 'SDAIA-PDPL', requirement: 'PDPL-3', description: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©' },
        { framework: 'ISO27001', requirement: 'A.8.2', description: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' }
      ],
      complianceStatus: 'Compliant', gapStatus: 'No Gap',
      implementationNotes: 'Ù†Ø¸Ø§Ù… CMDB Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ ØªØµÙ†ÙŠÙ Ø¢Ù„ÙŠ Ù„Ù„Ø£ØµÙˆÙ„',
      criticality: 'High',
      category: 'Asset Management'
    },
    // SDAIA-PDPL Requirements
    {
      id: 'REQ-SDAIA-PDPL-001', code: 'SDAIA-PDPL-5', frameworkCode: 'SDAIA-PDPL', authority: 'SDAIA',
      titleAr: 'Ù…ÙˆØ§ÙÙ‚Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'Data Subject Consent', articleNumber: 'Ø§Ù„Ù…Ø§Ø¯Ø© 5',
      fullTextAr: 'Ù„Ø§ ÙŠØ¬ÙˆØ² Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ùˆ Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© Ù…Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù…Ø§ Ù„Ù… ÙŠÙ†Øµ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù„Ù‰ Ø®Ù„Ø§Ù Ø°Ù„Ùƒ. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø­Ø±Ø© ÙˆÙ…Ø³ØªÙ†ÙŠØ±Ø© ÙˆÙ…Ø­Ø¯Ø¯Ø© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø«Ø¨Ø§Øª.',
      fullTextEn: 'Personal data may not be collected or processed without obtaining explicit consent from the data subject, unless otherwise stipulated by the law. Consent must be freely given, informed, specific, and demonstrable.',
      guidanceNotes: [
        'ÙŠØ¬Ø¨ ØªÙˆØ¶ÙŠØ­ Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
        'ÙŠØ­Ù‚ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø¨ Ù…ÙˆØ§ÙÙ‚ØªÙ‡ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª',
        'ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª ÙŠØªØ¶Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ØºØ±Ø¶',
        'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¶Ù…Ù†ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©'
      ],
      officialDocuments: [
        { name: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', url: 'https://sdaia.gov.sa/pdpl/law.pdf', type: 'PDF' },
        { name: 'Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', url: 'https://sdaia.gov.sa/pdpl/regulations.pdf', type: 'PDF' }
      ],
      effectiveDate: '2023-09-14', lastUpdated: '2024-03-17', nextReviewDate: '2025-09-14',
      versionHistory: [
        { version: '1.0', date: '2023-09-14', changes: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ Ù„Ù†Ø¸Ø§Ù… PDPL' }
      ],
      relatedRequirements: ['SDAIA-PDPL-6', 'SDAIA-PDPL-7'],
      crossFrameworkMapping: [
        { framework: 'EU-GDPR', requirement: 'Article 6', description: 'Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' }
      ],
      complianceStatus: 'Partial', gapStatus: 'Major Gap',
      implementationNotes: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø¢Ù„ÙŠØ© Ø³Ø­Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
      criticality: 'Critical',
      category: 'Data Protection'
    }]);
  // ØªØªØ¨Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
  const [regulatoryChanges, setRegulatoryChanges] = useState([
    {
      id: 'CHG-001', authority: 'SAMA', framework: 'SAMA-AML', changeType: 'Amendment',
      title: 'ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©',
      titleEn: 'Digital Identity Verification Requirements Update',
      description: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ©',
      descriptionEn: 'New requirements for identity verification using biometric technologies',
      impactLevel: 'High', affectedRequirements: ['SAMA-AML-1.1', 'SAMA-AML-1.2'], publishDate: '2024-11-01',
      effectiveDate: '2025-03-01', gracePeriod: '120 days', status: 'Upcoming',
      documentUrl: 'https://sama.gov.sa/circular/2024-11.pdf',
      impactAssessment: {
        systems: ['Ù†Ø¸Ø§Ù… KYC', 'Ù†Ø¸Ø§Ù… ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª'],
        processes: ['Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯'],
        training: ['ØªØ¯Ø±ÙŠØ¨ Ù…ÙˆØ¸ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'ØªØ¯Ø±ÙŠØ¨ Ù…Ø³Ø¤ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„'],
        estimatedCost: 750000, estimatedEffort: '3-6 Ø£Ø´Ù‡Ø±', riskLevel: 'Medium',
        complianceDeadline: '2025-03-01'
      },
      actionPlan: [
        { step: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', status: 'Completed', dueDate: '2024-12-01' },
        { step: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', status: 'In Progress', dueDate: '2025-01-15' },
        { step: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©', status: 'Pending', dueDate: '2025-02-15' },
        { step: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªÙ†ÙÙŠØ°', status: 'Pending', dueDate: '2025-02-28' }
      ],
      owner: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', ownerEmail: 'compliance@company.sa', createdAt: '2024-11-05', updatedAt: '2025-01-15',
      progress: 35,
      notes: 'ÙŠØªØ·Ù„Ø¨ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£Ø¨Ø´Ø± Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ'
    },
    {
      id: 'CHG-002', authority: 'NCA', framework: 'NCA-ECC', changeType: 'New Requirement', title: 'Ø¶ÙˆØ§Ø¨Ø· Ø£Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
      titleEn: 'Cloud Security Controls',
      description: 'Ø¥ØµØ¯Ø§Ø± Ø¶ÙˆØ§Ø¨Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©',
      descriptionEn: 'New cybersecurity controls for cloud computing',
      impactLevel: 'Critical',
      affectedRequirements: ['NCA-ECC-1.1', 'NCA-ECC-2.1', 'NCA-ECC-3.1'],
      publishDate: '2024-10-15', effectiveDate: '2025-04-15', gracePeriod: '180 days', status: 'Upcoming',
      documentUrl: 'https://nca.gov.sa/csc/2024.pdf',
      impactAssessment: {
        systems: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', 'Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©', 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†'],
        processes: ['Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±'],
        training: ['ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ IT', 'ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†'],
        estimatedCost: 3500000, estimatedEffort: '6-12 Ø´Ù‡Ø±', riskLevel: 'High',
        complianceDeadline: '2025-04-15'
      },
      actionPlan: [
        { step: 'Ø¬Ø±Ø¯ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', status: 'Completed', dueDate: '2024-12-01' },
        { step: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', status: 'Completed', dueDate: '2024-12-31' },
        { step: 'ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', status: 'In Progress', dueDate: '2025-02-28' },
        { step: 'ØªÙ†ÙÙŠØ° Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', status: 'Pending', dueDate: '2025-03-31' },
        { step: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚', status: 'Pending', dueDate: '2025-04-10' }
      ],
      owner: 'CISO', ownerEmail: 'ciso@company.sa', createdAt: '2024-10-20', updatedAt: '2025-01-10', progress: 45,
      notes: 'Ù…Ø´Ø±ÙˆØ¹ Ø°Ùˆ Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰ - ÙŠØªØ·Ù„Ø¨ Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©'
    },
    {
      id: 'CHG-003', authority: 'SDAIA', framework: 'SDAIA-PDPL', changeType: 'Amendment',
      title: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', titleEn: 'PDPL Executive Regulations Amendment',
      description: 'ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯',
      descriptionEn: 'Amendments to cross-border data transfer requirements',
      impactLevel: 'High', affectedRequirements: ['SDAIA-PDPL-5', 'SDAIA-PDPL-29'], publishDate: '2024-09-01',
      effectiveDate: '2025-01-01', gracePeriod: '120 days', status: 'Active',
      documentUrl: 'https://sdaia.gov.sa/pdpl/amendment-2024.pdf',
      impactAssessment: {
        systems: ['Ø£Ù†Ø¸Ù…Ø© Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©'],
        processes: ['Ø¹Ù‚ÙˆØ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©'],
        training: ['ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ', 'ØªØ¯Ø±ÙŠØ¨ Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'],
        estimatedCost: 350000, estimatedEffort: '2-4 Ø£Ø´Ù‡Ø±', riskLevel: 'Medium',
        complianceDeadline: '2025-01-01'
      },
      actionPlan: [
        { step: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©', status: 'Completed', dueDate: '2024-10-15' },
        { step: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', status: 'Completed', dueDate: '2024-11-15' },
        { step: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¯', status: 'Completed', dueDate: '2024-12-15' },
        { step: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', status: 'In Progress', dueDate: '2025-01-15' }
      ],
      owner: 'Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', ownerEmail: 'dpo@company.sa', createdAt: '2024-09-05', updatedAt: '2025-01-05',
      progress: 85,
      notes: 'Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„ - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ'
    },
    {
      id: 'CHG-004', authority: 'SAMA', framework: 'SAMA-CSF', changeType: 'New Requirement',
      title: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø£Ù…Ù† ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø©', titleEn: 'Open Banking API Security Requirements',
      description: 'Ø¶ÙˆØ§Ø¨Ø· Ø£Ù…Ù†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© ÙÙŠ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù…ØµØ±ÙÙŠ',
      descriptionEn: 'New security controls for Open Banking APIs',
      impactLevel: 'Critical',
      affectedRequirements: ['SAMA-CSF-4.1', 'SAMA-CSF-4.2', 'SAMA-CSF-5.1'],
      publishDate: '2025-01-01', effectiveDate: '2025-07-01', gracePeriod: '180 days', status: 'Upcoming',
      documentUrl: 'https://sama.gov.sa/openbanking/security-2025.pdf',
      impactAssessment: {
        systems: ['Ù…Ù†ØµØ© API Gateway', 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©'],
        processes: ['Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ API', 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡'],
        training: ['ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†', 'ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†', 'ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…'],
        estimatedCost: 2000000, estimatedEffort: '4-8 Ø£Ø´Ù‡Ø±', riskLevel: 'High',
        complianceDeadline: '2025-07-01'
      },
      actionPlan: [
        { step: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª', status: 'In Progress', dueDate: '2025-02-15' },
        { step: 'ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ©', status: 'Pending', dueDate: '2025-03-31' },
        { step: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ø­Ù„ÙˆÙ„', status: 'Pending', dueDate: '2025-05-31' },
        { step: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„Ø¥Ø·Ù„Ø§Ù‚', status: 'Pending', dueDate: '2025-06-30' }
      ],
      owner: 'Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ‚Ù†ÙŠØ©', ownerEmail: 'cto@company.sa', createdAt: '2025-01-05', updatedAt: '2025-01-10', progress: 10,
      notes: 'Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ - ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·'
    },
    {
      id: 'CHG-005', authority: 'NCA', framework: 'NCA-ECC', changeType: 'Amendment',
      title: 'ØªØ­Ø¯ÙŠØ« Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', titleEn: 'Vulnerability Management Controls Update',
      description: 'ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª ÙˆØ§Ù„ØªØµØ­ÙŠØ­Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      descriptionEn: 'Updates to vulnerability and patch management requirements',
      impactLevel: 'Medium', affectedRequirements: ['NCA-ECC-6.1', 'NCA-ECC-6.2'], publishDate: '2024-12-01',
      effectiveDate: '2025-06-01', gracePeriod: '180 days', status: 'Upcoming',
      documentUrl: 'https://nca.gov.sa/vm/2024.pdf',
      impactAssessment: {
        systems: ['Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª', 'Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµØ­ÙŠØ­Ø§Øª'], processes: ['Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­'],
        training: ['ØªØ¯Ø±ÙŠØ¨ ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ'], estimatedCost: 250000, estimatedEffort: '2-3 Ø£Ø´Ù‡Ø±', riskLevel: 'Low',
        complianceDeadline: '2025-06-01'
      },
      actionPlan: [
        { step: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©', status: 'Completed', dueDate: '2025-01-15' },
        { step: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', status: 'In Progress', dueDate: '2025-02-28' },
        { step: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', status: 'Pending', dueDate: '2025-04-30' }
      ],
      owner: 'Ù…Ø¯ÙŠØ± Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', ownerEmail: 'infosec@company.sa', createdAt: '2024-12-05', updatedAt: '2025-01-08',
      progress: 40,
      notes: 'ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©'
    }]);
  // Impact Assessment Modal States
  const [showImpactModal, setShowImpactModal] = useState(false);
  const [showImpactDetailModal, setShowImpactDetailModal] = useState(false);
  const [showImpactDeleteModal, setShowImpactDeleteModal] = useState(false);
  const [selectedImpact, setSelectedImpact] = useState(null);
  const [impactModalMode, setImpactModalMode] = useState('add');
  const [impactForm, setImpactForm] = useState({
    authority: '', framework: '', changeType: 'Amendment', title: '', titleEn: '', description: '', descriptionEn: '',
    impactLevel: 'Medium', affectedRequirements: [], publishDate: '', effectiveDate: '', gracePeriod: '',
    status: 'Upcoming', documentUrl: '',
    impactAssessment: {
      systems: [], processes: [], training: [], estimatedCost: 0, estimatedEffort: '', riskLevel: 'Medium',
      complianceDeadline: ''
    },
    actionPlan: [], owner: '', ownerEmail: '',
    notes: ''
  });

  const resetImpactForm = () => {
    setImpactForm({
      authority: '', framework: '', changeType: 'Amendment', title: '', titleEn: '',
      description: '', descriptionEn: '', impactLevel: 'Medium', affectedRequirements: [],
      publishDate: '', effectiveDate: '', gracePeriod: '', status: 'Upcoming', documentUrl: '',
      impactAssessment: { systems: [], processes: [], training: [], estimatedCost: 0, estimatedEffort: '', riskLevel: 'Medium', complianceDeadline: '' },
      actionPlan: [], owner: '', ownerEmail: '', notes: ''
    });
  };

  const openAddImpact = () => {
    resetImpactForm();
    setImpactModalMode('add');
    setShowImpactModal(true);
  };

  const openEditImpact = (impact) => {
    setImpactForm({ ...impact });
    setSelectedImpact(impact);
    setImpactModalMode('edit');
    setShowImpactModal(true);
  };

  const openViewImpact = (impact) => {
    setSelectedImpact(impact);
    setShowImpactDetailModal(true);
  };

  const openDeleteImpact = (impact) => {
    setSelectedImpact(impact);
    setShowImpactDeleteModal(true);
  };

  const handleSaveImpact = () => {
    if (impactModalMode === 'add') {
      const newImpact = {
        ...impactForm,
        id: `CHG-${String(regulatoryChanges.length + 1).padStart(3, '0')}`,
        createdAt: new Date().toISOString().split('T')[0], updatedAt: new Date().toISOString().split('T')[0],
        progress: 0
      };
      setRegulatoryChanges(prev => [...prev, newImpact]);
    } else {
      setRegulatoryChanges(prev => prev.map(c => c.id === selectedImpact.id ? { ...impactForm, updatedAt: new Date().toISOString().split('T')[0] } : c));
    }
    setShowImpactModal(false);
    resetImpactForm();
  };

  const handleDeleteImpact = () => {
    setRegulatoryChanges(prev => prev.filter(c => c.id !== selectedImpact.id));
    setShowImpactDeleteModal(false);
    setSelectedImpact(null);
  };

  const updateImpactProgress = (impactId, newProgress) => {
    setRegulatoryChanges(prev => prev.map(c => c.id === impactId ? { ...c, progress: newProgress, updatedAt: new Date().toISOString().split('T')[0] } : c));
  };

  // Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
  const [crossFrameworkMappings] = useState([
    {
      id: 'MAP-001', category: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', categoryEn: 'Identity & Access Management',
      mappings: [
        { framework: 'SAMA-CSF', code: 'SAMA-CSF-003', requirement: 'Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„' },
        { framework: 'NCA-ECC', code: 'NCA-ECC-3.1', requirement: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„' },
        { framework: 'ISO27001', code: 'A.9', requirement: 'Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„' },
        { framework: 'PCI-DSS', code: 'Req 7-8', requirement: 'ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©' }
      ],
      commonControls: ['MFA Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', 'Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„']
    },
    {
      id: 'MAP-002', category: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', categoryEn: 'Data Protection',
      mappings: [
        { framework: 'SDAIA-PDPL', code: 'PDPL-5', requirement: 'Ù…ÙˆØ§ÙÙ‚Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' },
        { framework: 'SAMA-AML', code: 'SAMA-AML-3.1', requirement: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¬Ù„Ø§Øª' },
        { framework: 'NCA-ECC', code: 'NCA-ECC-2.1', requirement: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©' },
        { framework: 'EU-GDPR', code: 'Art. 5-6', requirement: 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ' }
      ],
      commonControls: ['ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª']
    },
    {
      id: 'MAP-003', category: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', categoryEn: 'Incident Management',
      mappings: [
        { framework: 'SAMA-CSF', code: 'SAMA-CSF-002', requirement: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©' },
        { framework: 'NCA-ECC', code: 'NCA-ECC-5.1', requirement: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©' },
        { framework: 'SDAIA-PDPL', code: 'PDPL-20', requirement: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø®Ø±Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' },
        { framework: 'ISO27001', code: 'A.16', requirement: 'Ø¥Ø¯Ø§Ø±Ø© Ø­ÙˆØ§Ø¯Ø« Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' }
      ],
      commonControls: ['Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© CSIRT', 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©']
    }]);
  // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª
  const [gapAnalysisData, setGapAnalysisData] = useState([
    {
      id: 'GAP-001', framework: 'SAMA-CSF', requirement: 'SAMA-CSF-003',
      requirementTitle: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„',
      requirementTitleEn: 'Identity & Access Management Controls',
      currentStatus: 'Partial', targetStatus: 'Compliant', gapDescription: 'Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ MFA Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©',
      gapDescriptionEn: 'MFA not enabled for all sensitive systems',
      gapLevel: 'Medium', currentMaturity: 3, targetMaturity: 5, remediationPlan: 'ØªÙØ¹ÙŠÙ„ MFA Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø®Ù„Ø§Ù„ Q1 2025',
      remediationSteps: [
        'Ø­ØµØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©',
        'Ø§Ø®ØªÙŠØ§Ø± Ø­Ù„ MFA Ù…Ù†Ø§Ø³Ø¨',
        'ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©',
        'Ø§Ù„ØªØ¹Ù…ÙŠÙ… Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'
      ],
      estimatedCost: 150000, estimatedEffort: '45 ÙŠÙˆÙ…', priority: 'High', owner: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      ownerEmail: 'ciso@company.sa', dueDate: '2025-03-31', createdAt: '2024-10-15', updatedAt: '2024-12-01', progress: 35,
      evidence: ['Ø³Ø¬Ù„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¨Ø¯ÙˆÙ† MFA', 'Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°'], risks: ['ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ³Ù„ÙŠÙ…', 'Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'],
      dependencies: ['Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', 'ØªÙˆÙØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©'],
      notes: 'ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙÙŠ Q4 2024'
    },
    {
      id: 'GAP-002', framework: 'NCA-ECC', requirement: 'NCA-ECC-1.1', requirementTitle: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      requirementTitleEn: 'Cybersecurity Strategy', currentStatus: 'Partial', targetStatus: 'Compliant',
      gapDescription: 'Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø§ ØªØ´Ù…Ù„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
      gapDescriptionEn: 'Current strategy does not include cloud requirements',
      gapLevel: 'Low', currentMaturity: 4, targetMaturity: 5,
      remediationPlan: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©',
      remediationSteps: [
        'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
        'ØªØ­Ø¯ÙŠØ¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
        'ØµÙŠØ§ØºØ© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
        'Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§'
      ],
      estimatedCost: 50000, estimatedEffort: '30 ÙŠÙˆÙ…', priority: 'Medium', owner: 'CISO', ownerEmail: 'ciso@company.sa',
      dueDate: '2025-02-28', createdAt: '2024-11-01', updatedAt: '2024-12-15', progress: 60,
      evidence: ['Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ©'], risks: ['ØªØ£Ø®Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯'], dependencies: ['Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'],
      notes: 'Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
    },
    {
      id: 'GAP-003', framework: 'SDAIA-PDPL', requirement: 'SDAIA-PDPL-5', requirementTitle: 'Ù…ÙˆØ§ÙÙ‚Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      requirementTitleEn: 'Data Subject Consent', currentStatus: 'Non-Compliant', targetStatus: 'Compliant',
      gapDescription: 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø§ ØªØ³ØªÙˆÙÙŠ Ù…ØªØ·Ù„Ø¨Ø§Øª PDPL Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
      gapDescriptionEn: 'Current consent forms do not meet new PDPL requirements',
      gapLevel: 'High', currentMaturity: 2, targetMaturity: 5,
      remediationPlan: 'ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØªØ·ÙˆÙŠØ± Ø¢Ù„ÙŠØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª',
      remediationSteps: [
        'ØªØ­Ù„ÙŠÙ„ Ù…ØªØ·Ù„Ø¨Ø§Øª PDPL',
        'ØªØµÙ…ÙŠÙ… Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
        'ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª',
        'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ¹Ù…ÙŠÙ…'
      ],
      estimatedCost: 300000, estimatedEffort: '90 ÙŠÙˆÙ…', priority: 'Critical', owner: 'Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      ownerEmail: 'dpo@company.sa', dueDate: '2025-01-31', createdAt: '2024-09-01', updatedAt: '2024-12-20', progress: 15,
      evidence: ['Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'], risks: ['ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', 'Ø¶ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª'],
      dependencies: ['ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', 'Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©'],
      notes: 'Ù…Ø´Ø±ÙˆØ¹ Ø°Ùˆ Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰'
    },
    {
      id: 'GAP-004', framework: 'SAMA-AML', requirement: 'SAMA-AML-2.1', requirementTitle: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      requirementTitleEn: 'Suspicious Transaction Reporting', currentStatus: 'Partial', targetStatus: 'Compliant',
      gapDescription: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ø§ ÙŠØ¶Ù…Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…Ù‡Ù„Ø© 24 Ø³Ø§Ø¹Ø©',
      gapDescriptionEn: 'Manual reporting system does not ensure 24-hour compliance',
      gapLevel: 'High', currentMaturity: 3, targetMaturity: 5,
      remediationPlan: 'ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ Ù„Ù„ÙƒØ´Ù ÙˆØ§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      remediationSteps: [
        'Ø§Ø®ØªÙŠØ§Ø± Ø­Ù„ ØªÙ‚Ù†ÙŠ Ù…Ù†Ø§Ø³Ø¨',
        'ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©',
        'ØªØ·ÙˆÙŠØ± Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙƒØ´Ù',
        'Ø±Ø¨Ø· Ù…Ø¹ Ù†Ø¸Ø§Ù… Ù‚ÙˆØ§ÙÙ„'
      ],
      estimatedCost: 500000, estimatedEffort: '120 ÙŠÙˆÙ…', priority: 'Critical', owner: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„',
      ownerEmail: 'compliance@company.sa', dueDate: '2025-04-30', createdAt: '2024-08-15', updatedAt: '2024-12-10',
      progress: 25, evidence: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ', 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ù„'], risks: ['ØªØ£Ø®Ø± Ø§Ù„Ù…ÙˆØ±Ø¯', 'ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„ØªÙƒØ§Ù…Ù„'],
      dependencies: ['Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', 'Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯'],
      notes: 'ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ ÙˆØ¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯'
    },
    {
      id: 'GAP-005', framework: 'NCA-ECC', requirement: 'NCA-ECC-5.1', requirementTitle: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©',
      requirementTitleEn: 'Cybersecurity Incident Management', currentStatus: 'Compliant', targetStatus: 'Compliant',
      gapDescription: 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ© - Ù…Ù„ØªØ²Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', gapDescriptionEn: 'No gap - Fully compliant', gapLevel: 'None',
      currentMaturity: 5, targetMaturity: 5, remediationPlan: 'Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ',
      remediationSteps: ['Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯ÙˆØ±ÙŠØ©', 'ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙ…Ø±'], estimatedCost: 0, estimatedEffort: 'Ù…Ø³ØªÙ…Ø±', priority: 'Low',
      owner: 'ÙØ±ÙŠÙ‚ SOC', ownerEmail: 'soc@company.sa', dueDate: null, createdAt: '2024-06-01', updatedAt: '2024-12-01',
      progress: 100, evidence: ['ØªÙ‚Ø§Ø±ÙŠØ± SOC', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø¯Ø«'], risks: [], dependencies: [],
      notes: 'ÙŠØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒÙ„ Ø±Ø¨Ø¹ Ø³Ù†Ø©'
    }]);
  // Gap Analysis Modal States
  const [showGapModal, setShowGapModal] = useState(false);
  const [showGapDetailModal, setShowGapDetailModal] = useState(false);
  const [showGapDeleteModal, setShowGapDeleteModal] = useState(false);
  const [selectedGap, setSelectedGap] = useState(null);
  const [gapModalMode, setGapModalMode] = useState('add'); // add, edit
  const [gapForm, setGapForm] = useState({
    framework: '', requirement: '', requirementTitle: '', requirementTitleEn: '', currentStatus: 'Non-Compliant',
    targetStatus: 'Compliant', gapDescription: '', gapDescriptionEn: '', gapLevel: 'Medium', currentMaturity: 1,
    targetMaturity: 5, remediationPlan: '', remediationSteps: [], estimatedCost: 0, estimatedEffort: '',
    priority: 'Medium', owner: '', ownerEmail: '', dueDate: '', evidence: [], risks: [], dependencies: [],
    notes: ''
  });

  const resetGapForm = () => {
    setGapForm({
      framework: '', requirement: '', requirementTitle: '', requirementTitleEn: '',
      currentStatus: 'Non-Compliant', targetStatus: 'Compliant', gapDescription: '', gapDescriptionEn: '',
      gapLevel: 'Medium', currentMaturity: 1, targetMaturity: 5, remediationPlan: '', remediationSteps: [],
      estimatedCost: 0, estimatedEffort: '', priority: 'Medium', owner: '', ownerEmail: '',
      dueDate: '', evidence: [], risks: [], dependencies: [], notes: ''
    });
  };

  const openAddGap = () => {
    resetGapForm();
    setGapModalMode('add');
    setShowGapModal(true);
  };

  const openEditGap = (gap) => {
    setGapForm({ ...gap });
    setSelectedGap(gap);
    setGapModalMode('edit');
    setShowGapModal(true);
  };

  const openViewGap = (gap) => {
    setSelectedGap(gap);
    setShowGapDetailModal(true);
  };

  const openDeleteGap = (gap) => {
    setSelectedGap(gap);
    setShowGapDeleteModal(true);
  };

  const handleSaveGap = () => {
    if (gapModalMode === 'add') {
      const newGap = {
        ...gapForm,
        id: `GAP-${String(gapAnalysisData.length + 1).padStart(3, '0')}`,
        createdAt: new Date().toISOString().split('T')[0], updatedAt: new Date().toISOString().split('T')[0],
        progress: 0
      };
      setGapAnalysisData(prev => [...prev, newGap]);
    } else {
      setGapAnalysisData(prev => prev.map(g => g.id === selectedGap.id ? { ...gapForm, updatedAt: new Date().toISOString().split('T')[0] } : g));
    }
    setShowGapModal(false);
    resetGapForm();
  };

  const handleDeleteGap = () => {
    setGapAnalysisData(prev => prev.filter(g => g.id !== selectedGap.id));
    setShowGapDeleteModal(false);
    setSelectedGap(null);
  };

  const handleUpdateProgress = (gapId, newProgress) => {
    setGapAnalysisData(prev => prev.map(g => g.id === gapId ? { ...g, progress: newProgress, updatedAt: new Date().toISOString().split('T')[0] } : g));
  };

  // REFERENCE DATA - Comprehensive
  const authorities = [
    { code: 'MOI-NIC', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© - Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠ', nameEn: 'Ministry of Interior - NIC', country: 'SA' },
    { code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', nameEn: 'Saudi Central Bank', country: 'SA' },
    { code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'National Cybersecurity Authority', country: 'SA' },
    { code: 'SDAIA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', nameEn: 'Saudi Data & AI Authority', country: 'SA' },
    { code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', nameEn: 'Zakat, Tax & Customs Authority', country: 'SA' },
    { code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Capital Market Authority', country: 'SA' },
    { code: 'CITC', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'Communications & IT Commission', country: 'SA' },
    { code: 'MHRSD', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', nameEn: 'Ministry of Human Resources', country: 'SA' },
    { code: 'MOH', name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©', nameEn: 'Ministry of Health', country: 'SA' },
    { code: 'CBAHI', name: 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ©', nameEn: 'CBAHI', country: 'SA' },
    { code: 'SFDA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØºØ°Ø§Ø¡ ÙˆØ§Ù„Ø¯ÙˆØ§Ø¡', nameEn: 'Saudi FDA', country: 'SA' },
    { code: 'CD', name: 'Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', nameEn: 'Civil Defense', country: 'SA' },
    { code: 'GOSI', name: 'Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', nameEn: 'GOSI', country: 'SA' },
    { code: 'ISO', name: 'Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±', nameEn: 'ISO', country: 'INT' },
    { code: 'PCI-SSC', name: 'Ù…Ø¬Ù„Ø³ Ù…Ø¹Ø§ÙŠÙŠØ± Ø£Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹', nameEn: 'PCI Security Standards Council', country: 'INT' },
    { code: 'AICPA', name: 'Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ Ù„Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠÙ†', nameEn: 'AICPA', country: 'INT' },
    { code: 'EU', name: 'Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ', nameEn: 'European Union', country: 'INT' },
  ];

  const sectors = [
    'Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
    'Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ø¶ÙŠØ§ÙØ©', 'ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'Ø§Ù„Ø¹Ù‚Ø§Ø±', 'Ø§Ù„Ø°Ù‡Ø¨ ÙˆØ§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª',
    'Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©', 'Ø§Ù„Ø£Ø¯ÙˆÙŠØ©', 'Ø§Ù„ØªØ¬Ø²Ø¦Ø©', 'Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
    'Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª', 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ø·Ø§Ù‚Ø©', 'Ø§Ù„Ù†ÙØ· ÙˆØ§Ù„ØºØ§Ø²',
    'Ø§Ù„ØªØµÙ†ÙŠØ¹', 'Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª', 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…', 'Ø§Ù„Ø­ÙƒÙˆÙ…Ø©',
    'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'
  ];

  const severities = ['Critical', 'High', 'Medium', 'Low'];
  const recurrences = ['Once', 'Daily', 'Weekly', 'Monthly', 'Quarterly', 'Semi-Annual', 'Annual', 'Continuous', 'On Demand', 'On Incident', 'Per Transaction'];
  const programTypes = ['Mandatory', 'Voluntary', 'Conditional', 'Industry Standard'];
  const countries = [
    { code: 'SA', name: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
    { code: 'INT', name: 'Ø¯ÙˆÙ„ÙŠ', flag: 'ğŸŒ' },
    { code: 'US', name: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©', flag: 'ğŸ‡ºğŸ‡¸' },
    { code: 'EU', name: 'Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ', flag: 'ğŸ‡ªğŸ‡º' },
  ];
  const icons = ['ğŸ›¡ï¸', 'ğŸ¦', 'ğŸ”', 'ğŸ“Š', 'ğŸ§¾', 'ğŸ“ˆ', 'ğŸ¥', 'ğŸ‘¥', 'ğŸš’', 'ğŸ“‹', 'âš–ï¸', 'ğŸ”’', 'ğŸ’³', 'ğŸŒ', 'ğŸ“¡', 'ğŸ­', 'ğŸš—', 'ğŸ¨', 'ğŸ’Š', 'ğŸ“', 'ğŸ›ï¸', 'â˜ï¸', 'ğŸ”‘', 'ğŸ“±'];

  // PROGRAMS DATA - Complete Saudi & International Regulatory Programs
  const [programs, setPrograms] = useState([
    // 1. SHOMOOS - MOI
    {
      id: 1, code: 'SA-MOI-SHOMOOS', name: 'Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ Ø§Ù„Ø£Ù…Ù†ÙŠ', nameEn: 'Shomoos Security System', authority: 'MOI-NIC',
      authorityName: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© - Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠ', icon: 'ğŸ›¡ï¸', color: 'red', criticality: 'Critical',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '2.0', effectiveDate: '2020-01-01',
      lastUpdated: '2024-06-15',
      description: 'Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ Ø§Ù„Ø£Ù…Ù†ÙŠ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø±ØµØ¯ Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„Ù†Ø²Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…ØªØ¹Ø§Ù…Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ø®Ø§Ø¶Ø¹Ø© Ù„Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      scope: 'ÙŠØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªÙŠ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØªØªØ·Ù„Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©',
      sectorAr: ['Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ø¶ÙŠØ§ÙØ©', 'ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'Ø§Ù„Ø¹Ù‚Ø§Ø±', 'Ø§Ù„Ø°Ù‡Ø¨ ÙˆØ§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª'],
      penalty: 'ØºØ±Ø§Ù…Ø© Ù…Ø§Ù„ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ 100,000 Ø±ÙŠØ§Ù„ + Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø´Ø§Ø· + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª',
      penaltyDetails: {
        financial: { min: 10000, max: 100000, currency: 'SAR' },
        operational: ['Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø®ØµØ©', 'Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©'],
        criminal: 'Ù‚Ø¯ ØªØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ³ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†'
      },
      complianceRate: 85, riskScore: 9,
      obligations: [
        { code: 'SHM-OBL-001', title: 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠ ÙÙŠ Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ Ù‚Ø¨Ù„ Ù…Ø²Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø´Ø§Ø·', description: 'ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ø®Ø§Ø¶Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù†Ø´Ø§Ø·', severity: 'Critical', recurrence: 'Once', deadline: 'Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø§Ø·', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'Ø¹Ù‚Ø¯ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ'] },
        { code: 'SHM-OBL-002', title: 'Ø±ÙØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡/Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ ÙÙˆØ±ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…', description: 'Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ù†Ø²ÙŠÙ„ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø§Ù…Ù„', severity: 'Critical', recurrence: 'Per Transaction', deadline: 'â‰¤ 1 Ø³Ø§Ø¹Ø©', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ£Ø®ÙŠØ±'] },
        { code: 'SHM-OBL-003', title: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø±Ø¦ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯', description: 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¬Ù‡Ø²Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† NIC Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚', severity: 'High', recurrence: 'Per Transaction', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø­', 'ØµÙˆØ± Ø§Ù„Ù‡ÙˆÙŠØ©'] },
        { code: 'SHM-OBL-004', title: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø§Ù…Ù„ÙŠÙ† Ù„Ù…Ø¯Ø© 5 Ø³Ù†ÙˆØ§Øª', description: 'Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù…Ø¯Ø© Ù„Ø§ ØªÙ‚Ù„ Ø¹Ù† 5 Ø³Ù†ÙˆØ§Øª', severity: 'High', recurrence: 'Continuous', deadline: '5 Ø³Ù†ÙˆØ§Øª', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ', 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸'] },
        { code: 'SHM-OBL-005', title: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØªÙŠØ´ ÙˆØ§Ù„ØªØ­Ø±ÙŠØ§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙˆØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙˆØ±Ø§Ù‹', severity: 'Critical', recurrence: 'On Demand', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª', 'Ù…Ø­Ø§Ø¶Ø± Ø§Ù„ØªÙØªÙŠØ´'] },
        { code: 'SHM-OBL-006', title: 'Ø¹Ø¯Ù… Ø¥ÙŠÙˆØ§Ø¡ Ø£Ùˆ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙÙŠÙ† Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©', description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© ÙˆØ§Ù„ØªØ£Ø´ÙŠØ±Ø© ÙˆØ¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙÙŠÙ†', severity: 'Critical', recurrence: 'Continuous', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚Ù‚', 'Ø³Ø¬Ù„ Ø§Ù„Ø±ÙØ¶'] },
        { code: 'SHM-OBL-007', title: 'ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…', description: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…', severity: 'Medium', recurrence: 'On Demand', deadline: '7 Ø£ÙŠØ§Ù…', evidenceRequired: ['Ø·Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯'] },
      ],
      standards: [
        { code: 'STD-SHM-01', title: 'ØªØ³Ø¬ÙŠÙ„ ÙƒÙ„ Ù†Ø²ÙŠÙ„ Ø®Ù„Ø§Ù„ â‰¤ 1 Ø³Ø§Ø¹Ø©', metric: 'â‰¤ 60 Ø¯Ù‚ÙŠÙ‚Ø©', target: 100, unit: '%' },
        { code: 'STD-SHM-02', title: 'Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', metric: 'â‰¥ 99.5%', target: 99.5, unit: '%' },
        { code: 'STD-SHM-03', title: 'ØªÙˆÙØ± Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ', metric: 'â‰¥ 99.9%', target: 99.9, unit: '%' },
        { code: 'STD-SHM-04', title: 'Ø¯Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø´Ù…ÙˆØ³', 'ØªÙ‚Ø±ÙŠØ± Ù…Ø³Ø­ Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ'],
      schedule: [
        { frequency: 'Real-time', task: 'Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²Ù„Ø§Ø¡/Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', responsible: 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ' },
        { frequency: 'Daily', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„ØªØ£Ø®ÙŠØ±', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
        { frequency: 'Weekly', task: 'ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ', responsible: 'Ù‚Ø³Ù… IT' },
        { frequency: 'Monthly', task: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„', responsible: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
        { frequency: 'Quarterly', task: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ NIC', responsible: 'Ù‚Ø³Ù… IT' },
      ],
      breachTriggers: ['TaskOverdue>0', 'SubmissionDelay>1h', 'SystemDowntime>1h', 'IdentityMismatch>0'],
      contacts: [
        { name: 'Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ', email: 'support@nic.gov.sa', phone: '920000911' },
        { name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', email: 'compliance@nic.gov.sa', phone: '0114567890' },
      ],
      resources: [
        { name: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', url: 'https://nic.gov.sa/shomoos/guide', type: 'PDF' },
        { name: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©', url: 'https://nic.gov.sa/shomoos/tech', type: 'PDF' },
      ],
    },
    // 2. SAMA Cybersecurity Framework
    {
      id: 2, code: 'SA-SAMA-CSF', name: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ø³Ø§Ù…Ø§', nameEn: 'SAMA Cybersecurity Framework',
      authority: 'SAMA', authorityName: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', icon: 'ğŸ¦', color: 'emerald', criticality: 'Critical',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '3.0', effectiveDate: '2017-05-01',
      lastUpdated: '2024-01-15',
      description: 'Ø¥Ø·Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙŠØ­Ø¯Ø¯ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø§Ø¶Ø¹Ø© Ù„Ø¥Ø´Ø±Ø§Ù Ø³Ø§Ù…Ø§',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ† ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø®ØµØ©',
      sectorAr: ['Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 10 Ù…Ù„Ø§ÙŠÙŠÙ† Ø±ÙŠØ§Ù„ + ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ØªØ±Ø®ÙŠØµ + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª',
      penaltyDetails: {
        financial: { min: 100000, max: 10000000, currency: 'SAR' },
        operational: ['ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ØªØ±Ø®ÙŠØµ', 'Ø¥ÙŠÙ‚Ø§Ù Ø®Ø¯Ù…Ø§Øª Ù…Ø¹ÙŠÙ†Ø©', 'Ø²ÙŠØ§Ø¯Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„'],
        criminal: 'Ù‚Ø¯ ØªØ´Ù…Ù„ Ø¹Ù‚ÙˆØ¨Ø§Øª Ø¬Ù†Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ù‡Ù…Ø§Ù„ Ø§Ù„Ø¬Ø³ÙŠÙ…'
      },
      complianceRate: 78, riskScore: 10,
      obligations: [
        { code: 'SAMA-CSF-001', title: 'ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', description: 'Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø­ÙˆÙƒÙ…Ø© Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙŠØ´Ù…Ù„ Ø§Ù„Ù„Ø¬Ø§Ù† ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ù„Ø¬Ø§Ù†', 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©'] },
        { code: 'SAMA-CSF-002', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©', description: 'Ø¥Ø¨Ù„Ø§Øº Ø³Ø§Ù…Ø§ Ø¹Ù† Ø£ÙŠ Ø­Ø§Ø¯Ø« Ø£Ù…Ù†ÙŠ Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙƒØªØ´Ø§ÙÙ‡', severity: 'Critical', recurrence: 'On Incident', deadline: '24 Ø³Ø§Ø¹Ø©', evidenceRequired: ['Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¯Ø«', 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'] },
        { code: 'SAMA-CSF-003', title: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', description: 'ØªØ·Ø¨ÙŠÙ‚ MFA ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø© IAM', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„'] },
        { code: 'SAMA-CSF-004', title: 'Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©', description: 'ØªÙ‚ÙŠÙŠÙ… ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠÙŠÙ†', severity: 'High', recurrence: 'Quarterly', deadline: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù†', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©'] },
        { code: 'SAMA-CSF-005', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø³Ù†ÙˆÙŠ', description: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ø´Ø§Ù…Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹ Ù…Ù† Ø¬Ù‡Ø© Ù…Ø³ØªÙ‚Ù„Ø© Ù…Ø¹ØªÙ…Ø¯Ø©', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¬Ù‡Ø©'] },
        { code: 'SAMA-CSF-006', title: 'ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'ØªØ¯Ø±ÙŠØ¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ø®Ø·Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª'] },
        { code: 'SAMA-CSF-007', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'ÙØ­Øµ ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ', severity: 'Critical', recurrence: 'Monthly', deadline: 'Ø´Ù‡Ø±ÙŠ', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ', 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡'] },
        { code: 'SAMA-CSF-008', title: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', description: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ Ø´Ø§Ù…Ù„ Ø¹Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ø³Ø§Ù…Ø§', severity: 'High', recurrence: 'Annual', deadline: 'Q1', evidenceRequired: ['Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ', 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø¯Ù‚Ù‚', 'Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†'] },
      ],
      standards: [
        { code: 'STD-SAMA-01', title: 'ØªØ·Ø¨ÙŠÙ‚ MFA Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-SAMA-02', title: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©', metric: 'â‰¤ 7 Ø£ÙŠØ§Ù…', target: 7, unit: 'days' },
        { code: 'STD-SAMA-03', title: 'ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', metric: 'AES-256', target: 100, unit: '%' },
        { code: 'STD-SAMA-04', title: 'ØªÙˆÙØ± SOC 24/7', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-SAMA-05', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', metric: 'Ø³Ù†ÙˆÙŠ', target: 1, unit: 'per year' },
      ],
      evidenceTypes: ['Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', 'ØªÙ‚Ø§Ø±ÙŠØ± SOC', 'Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚'],
      schedule: [
        { frequency: 'Daily', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙ†Ø¨ÙŠÙ‡Ø§Øª SOC', responsible: 'ÙØ±ÙŠÙ‚ SOC' },
        { frequency: 'Weekly', task: 'ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø«ØºØ±Ø§Øª', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†' },
        { frequency: 'Monthly', task: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ù„Ø¬Ù†Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', responsible: 'CISO' },
        { frequency: 'Quarterly', task: 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø©', responsible: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±' },
        { frequency: 'Annual', task: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ù†ÙˆÙŠ', responsible: 'CISO' },
      ],
      breachTriggers: ['IncidentNotReported>24h', 'CriticalVulnerability>7d', 'MFANotEnabled', 'PenTestOverdue'],
      contacts: [
        { name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ - Ø³Ø§Ù…Ø§', email: 'cybersecurity@sama.gov.sa', phone: '0114662333' },
      ],
      resources: [
        { name: 'Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', url: 'https://sama.gov.sa/csf', type: 'PDF' },
        { name: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', url: 'https://sama.gov.sa/incident', type: 'PDF' },
      ],
    },
    // 3. NCA ECC
    {
      id: 3, code: 'SA-NCA-ECC', name: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', nameEn: 'Essential Cybersecurity Controls (ECC)',
      authority: 'NCA', authorityName: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: 'ğŸ”', color: 'purple', criticality: 'Critical',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '2.0', effectiveDate: '2018-09-01',
      lastUpdated: '2024-03-01',
      description: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ECC 2.0 - Ø¥Ø·Ø§Ø± ÙˆØ·Ù†ÙŠ Ø´Ø§Ù…Ù„ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ø§Ù„Ø­Ø±Ø¬Ø© ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ',
      sectorAr: ['Ø§Ù„Ø­ÙƒÙˆÙ…Ø©', 'Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ø§Ù„Ø­Ø±Ø¬Ø©', 'Ø§Ù„Ø·Ø§Ù‚Ø©', 'Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª', 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©'],
      penalty: 'Ø¹Ù‚ÙˆØ¨Ø§Øª ØªÙ†Ø¸ÙŠÙ…ÙŠØ© + Ø¥Ù„Ø²Ø§Ù… Ø¨Ø§Ù„Ø¥ØµÙ„Ø§Ø­ + ØºØ±Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©',
      penaltyDetails: {
        financial: { min: 50000, max: 5000000, currency: 'SAR' },
        operational: ['Ø¥Ù„Ø²Ø§Ù… Ø¨Ø§Ù„Ø¥ØµÙ„Ø§Ø­', 'ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹'],
        criminal: 'Ø¹Ù‚ÙˆØ¨Ø§Øª Ø¬Ù†Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¬Ø±Ø§Ø¦Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©'
      },
      complianceRate: 72, riskScore: 9,
      obligations: [
        { code: 'NCA-ECC-001', title: 'Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', description: 'Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØ«ÙŠÙ‚ Ø¥Ø·Ø§Ø± Ø­ÙˆÙƒÙ…Ø© Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª'] },
        { code: 'NCA-ECC-002', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©', description: 'Ø¬Ø±Ø¯ ÙˆØªØµÙ†ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆÙ„', 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø§Ù„Ù…Ø§Ù„ÙƒÙŠÙ†'] },
        { code: 'NCA-ECC-003', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ù‚ÙˆÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø© IAM', 'Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'] },
        { code: 'NCA-ECC-004', title: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø´Ø¨ÙƒØ§Øª', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø´Ø¨ÙƒØ§Øª', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«'] },
        { code: 'NCA-ECC-005', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'Ø§ÙƒØªØ´Ø§Ù ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', severity: 'High', recurrence: 'Monthly', deadline: 'Ø´Ù‡Ø±ÙŠ', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ', 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª'] },
        { code: 'NCA-ECC-006', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', description: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', severity: 'Critical', recurrence: 'On Incident', deadline: '4 Ø³Ø§Ø¹Ø§Øª', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¯Ø«', 'Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©', 'Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©'] },
        { code: 'NCA-ECC-007', title: 'Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', description: 'Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ø®Ø·Ø© BCP', 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'ØªÙ‚Ø±ÙŠØ± DR'] },
        { code: 'NCA-ECC-008', title: 'Ø£Ù…Ù† Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· Ø£Ù…Ù† Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø²ÙˆØ¯', 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©'] },
      ],
      standards: [
        { code: 'STD-NCA-01', title: 'Ù†Ø³Ø¨Ø© Ø¬Ø±Ø¯ Ø§Ù„Ø£ØµÙˆÙ„', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-NCA-02', title: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©', metric: 'â‰¤ 48 Ø³Ø§Ø¹Ø©', target: 48, unit: 'hours' },
        { code: 'STD-NCA-03', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', metric: 'â‰¤ 4 Ø³Ø§Ø¹Ø§Øª', target: 4, unit: 'hours' },
        { code: 'STD-NCA-04', title: 'Ø§Ø®ØªØ¨Ø§Ø± BCP/DR', metric: 'Ø³Ù†ÙˆÙŠ', target: 1, unit: 'per year' },
      ],
      evidenceTypes: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„ ECC', 'Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆÙ„', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø«ØºØ±Ø§Øª', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª'],
      schedule: [
        { frequency: 'Daily', task: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', responsible: 'ÙØ±ÙŠÙ‚ SOC' },
        { frequency: 'Monthly', task: 'ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†' },
        { frequency: 'Quarterly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù…ØªØ«Ø§Ù„ ECC', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
        { frequency: 'Annual', task: 'ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ ÙˆØªÙ‚Ø±ÙŠØ± NCA', responsible: 'CISO' },
      ],
      breachTriggers: ['ECCControlFailed', 'IncidentNotReported>4h', 'CriticalAssetUnpatched>48h'],
      contacts: [
        { name: 'Ø¨ÙˆØ§Ø¨Ø© Ø­ØµÙŠÙ†', email: 'haseen@nca.gov.sa', phone: '920020405' },
      ],
      resources: [
        { name: 'Ø¶ÙˆØ§Ø¨Ø· ECC 2.0', url: 'https://nca.gov.sa/ecc', type: 'PDF' },
      ],
    },
    // 4. PDPL
    {
      id: 4, code: 'SA-SDAIA-PDPL', name: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', nameEn: 'Personal Data Protection Law (PDPL)',
      authority: 'SDAIA', authorityName: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', icon: 'ğŸ“Š', color: 'indigo',
      criticality: 'Critical', status: 'Active', type: 'Mandatory', country: 'SA', version: '1.0',
      effectiveDate: '2023-09-14', lastUpdated: '2024-03-01',
      description: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© - Ø¥Ø·Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø´Ø§Ù…Ù„ Ù„Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ØªÙŠ ØªØ¬Ù…Ø¹ Ø£Ùˆ ØªØ¹Ø§Ù„Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù…Ù„ÙƒØ©',
      sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'], penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 5 Ù…Ù„Ø§ÙŠÙŠÙ† Ø±ÙŠØ§Ù„ + Ø§Ù„Ø³Ø¬Ù† Ø­ØªÙ‰ Ø³Ù†ØªÙŠÙ†',
      penaltyDetails: {
        financial: { min: 5000, max: 5000000, currency: 'SAR' },
        operational: ['Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù†Ø´Ø± Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©'],
        criminal: 'Ø§Ù„Ø³Ø¬Ù† Ø­ØªÙ‰ Ø³Ù†ØªÙŠÙ† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥ÙØ´Ø§Ø¡ Ø£Ùˆ Ø¥Ø³Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…'
      },
      complianceRate: 65, riskScore: 8,
      obligations: [
        { code: 'PDPL-OBL-001', title: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© ÙˆÙ…Ø³ØªÙ†ÙŠØ±Ø© Ù‚Ø¨Ù„ Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', severity: 'Critical', recurrence: 'Per Collection', deadline: 'Ù‚Ø¨Ù„ Ø§Ù„Ø¬Ù…Ø¹', evidenceRequired: ['Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª', 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø®ØµÙˆØµÙŠØ©'] },
        { code: 'PDPL-OBL-002', title: 'ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø¯Ø£ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØºØ±Ø¶', description: 'Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¹Ø©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø£ØºØ±Ø§Ø¶', 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¶Ø±ÙˆØ±Ø©'] },
        { code: 'PDPL-OBL-003', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', description: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØµØ© ÙˆØ£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù† Ø£ÙŠ Ø§Ø®ØªØ±Ø§Ù‚', severity: 'Critical', recurrence: 'On Breach', deadline: '72 Ø³Ø§Ø¹Ø©', evidenceRequired: ['Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†'] },
        { code: 'PDPL-OBL-004', title: 'ØªÙ…ÙƒÙŠÙ† Ø­Ù‚ÙˆÙ‚ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„ØªØµØ­ÙŠØ­ ÙˆØ§Ù„Ø­Ø°Ù', severity: 'High', recurrence: 'On Request', deadline: '30 ÙŠÙˆÙ…', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©'] },
        { code: 'PDPL-OBL-005', title: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'ØªØ¹ÙŠÙŠÙ† DPO Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ØªÙŠ ØªØ¹Ø§Ù„Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø£Ùˆ ÙˆØ§Ø³Ø¹Ø© Ø§Ù„Ù†Ø·Ø§Ù‚', severity: 'High', recurrence: 'Once', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ù‚Ø±Ø§Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„'] },
        { code: 'PDPL-OBL-006', title: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©', description: 'DPIA Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', severity: 'High', recurrence: 'On Demand', deadline: 'Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± DPIA', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ®ÙÙŠÙ', 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª'] },
        { code: 'PDPL-OBL-007', title: 'Ø¶Ù…Ø§Ù† Ø£Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', description: 'ØªØ·Ø¨ÙŠÙ‚ ØªØ¯Ø§Ø¨ÙŠØ± Ø£Ù…Ù†ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©'] },
      ],
      standards: [
        { code: 'STD-PDPL-01', title: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª DSR', metric: 'â‰¤ 30 ÙŠÙˆÙ…', target: 30, unit: 'days' },
        { code: 'STD-PDPL-02', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª', metric: 'â‰¤ 72 Ø³Ø§Ø¹Ø©', target: 72, unit: 'hours' },
        { code: 'STD-PDPL-03', title: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± DPIA', 'Ø³Ø¬Ù„Ø§Øª DSR', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª'],
      schedule: [
        { frequency: 'On Request', task: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ø§Øª Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', responsible: 'DPO' },
        { frequency: 'Monthly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', responsible: 'DPO' },
        { frequency: 'Quarterly', task: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
        { frequency: 'Annual', task: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', responsible: 'DPO' },
      ],
      breachTriggers: ['BreachNotReported>72h', 'DSRNotProcessed>30d', 'NoConsent', 'DataRetentionExceeded'],
      contacts: [
        { name: 'SDAIA', email: 'pdpl@sdaia.gov.sa', phone: '920000985' },
      ],
      resources: [
        { name: 'Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©', url: 'https://sdaia.gov.sa/pdpl', type: 'PDF' },
        { name: 'Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', url: 'https://sdaia.gov.sa/pdpl/regulations', type: 'PDF' },
      ],
    },
    // 5. ZATCA VAT & E-Invoicing
    {
      id: 5, code: 'SA-ZATCA-VAT', name: 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙˆØ§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', nameEn: 'VAT & FATOORA E-Invoicing',
      authority: 'ZATCA', authorityName: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', icon: 'ğŸ§¾', color: 'amber', criticality: 'Critical',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '2.0', effectiveDate: '2018-01-01',
      lastUpdated: '2024-01-01',
      description: 'Ù†Ø¸Ø§Ù… Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© (ÙØ§ØªÙˆØ±Ø©) ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 50% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© + ØºØ±Ø§Ù…Ø§Øª ØªØ£Ø®ÙŠØ±',
      penaltyDetails: {
        financial: { min: 1000, max: 50, currency: '%' },
        operational: ['Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©', 'Ø­Ø¬Ø¨ Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©'],
        criminal: 'Ù‚Ø¯ ØªØµÙ„ Ù„Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‡Ø±Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ'
      },
      complianceRate: 88, riskScore: 8,
      obligations: [
        { code: 'ZATCA-VAT-001', title: 'ØªÙ‚Ø¯ÙŠÙ… Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', description: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', severity: 'Critical', recurrence: 'Monthly', deadline: 'Ø¢Ø®Ø± ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ', evidenceRequired: ['Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', 'Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯', 'Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©'] },
        { code: 'ZATCA-VAT-002', title: 'ØªØ·Ø¨ÙŠÙ‚ Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØªØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© - Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©', description: 'Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù…Ù†Ø¸ÙˆÙ…Ø© ÙØ§ØªÙˆØ±Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø±Ø¨Ø·', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'] },
        { code: 'ZATCA-VAT-003', title: 'Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©', description: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ© Ù„Ù…Ø¯Ø© 6 Ø³Ù†ÙˆØ§Øª', severity: 'High', recurrence: 'Continuous', deadline: '6 Ø³Ù†ÙˆØ§Øª', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ', 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸'] },
        { code: 'ZATCA-VAT-004', title: 'Ø¥ØµØ¯Ø§Ø± ÙÙˆØ§ØªÙŠØ± Ø¶Ø±ÙŠØ¨ÙŠØ© ØµØ­ÙŠØ­Ø©', description: 'Ø¥ØµØ¯Ø§Ø± ÙÙˆØ§ØªÙŠØ± ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', severity: 'High', recurrence: 'Per Transaction', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ÙÙˆØ§ØªÙŠØ±', 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…'] },
        { code: 'ZATCA-VAT-005', title: 'Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©', description: 'Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', severity: 'Critical', recurrence: 'Monthly', deadline: 'Ù…Ø¹ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±', evidenceRequired: ['Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø³Ø¯Ø§Ø¯', 'ÙƒØ´Ù Ø§Ù„Ø¨Ù†Ùƒ'] },
      ],
      standards: [
        { code: 'STD-ZATCA-01', title: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯', metric: 'On Time', target: 100, unit: '%' },
        { code: 'STD-ZATCA-02', title: 'Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±', metric: 'â‰¥ 99.5%', target: 99.5, unit: '%' },
        { code: 'STD-ZATCA-03', title: 'Ø¯Ù‚Ø© Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©', 'Ø´Ù‡Ø§Ø¯Ø© ÙØ§ØªÙˆØ±Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±', 'Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø³Ø¯Ø§Ø¯'],
      schedule: [
        { frequency: 'Per Transaction', task: 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', responsible: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª' },
        { frequency: 'Monthly', task: 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', responsible: 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©' },
        { frequency: 'Quarterly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', responsible: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ' },
      ],
      breachTriggers: ['VATReturnLate', 'InvoiceNotCompliant', 'PaymentOverdue', 'IntegrationFailure'],
      contacts: [{ name: 'Ù…Ø±ÙƒØ² Ø§ØªØµØ§Ù„ ZATCA', email: 'info@zatca.gov.sa', phone: '19993' }],
      resources: [{ name: 'Ø¯Ù„ÙŠÙ„ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', url: 'https://zatca.gov.sa/vat', type: 'PDF' }],
    },
    // 6. CMA
    {
      id: 6, code: 'SA-CMA-REGS', name: 'Ø£Ù†Ø¸Ù…Ø© ÙˆÙ„ÙˆØ§Ø¦Ø­ Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'CMA Regulations', authority: 'CMA',
      authorityName: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ“ˆ', color: 'blue', criticality: 'Critical', status: 'Active',
      type: 'Mandatory', country: 'SA', version: '2024', effectiveDate: '2004-07-31', lastUpdated: '2024-06-01',
      description: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù„ÙˆØ§Ø¦Ø­ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ù„Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†',
      scope: 'Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø¬Ø© ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ÙˆØ³Ø§Ø·Ø© ÙˆØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±', sectorAr: ['Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'Ø§Ù„ÙˆØ³Ø§Ø·Ø©', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 100 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„ + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¯Ø§ÙˆÙ„',
      penaltyDetails: {
        financial: { min: 10000, max: 100000000, currency: 'SAR' },
        operational: ['Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¯Ø§ÙˆÙ„', 'Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ', 'Ù…Ù†Ø¹ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚'],
        criminal: 'Ø§Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ø§Ø­ØªÙŠØ§Ù„'
      },
      complianceRate: 82, riskScore: 9,
      obligations: [
        { code: 'CMA-OBL-001', title: 'Ø§Ù„Ø¥ÙØµØ§Ø­ Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠØ©', description: 'Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬ÙˆÙ‡Ø±ÙŠØ© ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù…', severity: 'Critical', recurrence: 'On Demand', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­', 'Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«'] },
        { code: 'CMA-OBL-002', title: 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©', description: 'Ù†Ø´Ø± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø±Ø¨Ø¹ÙŠØ© ÙˆØ§Ù„Ø³Ù†ÙˆÙŠØ©', severity: 'Critical', recurrence: 'Quarterly', deadline: '30 ÙŠÙˆÙ… Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©', evidenceRequired: ['Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹'] },
        { code: 'CMA-OBL-003', title: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª', description: 'ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§Ø¦Ø­Ø© Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ù…Ø­Ø§Ø¶Ø± Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'] },
        { code: 'CMA-OBL-004', title: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙÙŠ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª KYC ÙˆAML', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø§Øª AML', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©'] },
        { code: 'CMA-OBL-005', title: 'Ø­Ù…Ø§ÙŠØ© Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', description: 'ÙØµÙ„ Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ­Ù…Ø§ÙŠØªÙ‡Ø§', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ÙƒØ´ÙˆÙ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ù†ÙØµÙ„Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©'] },
      ],
      standards: [
        { code: 'STD-CMA-01', title: 'Ø§Ù„Ø¥ÙØµØ§Ø­ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©', metric: 'â‰¤ 24 Ø³Ø§Ø¹Ø©', target: 24, unit: 'hours' },
        { code: 'STD-CMA-02', title: 'Ø¯Ù‚Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-CMA-03', title: 'ÙØµÙ„ Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­', 'Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ÙˆÙƒÙ…Ø©', 'Ø³Ø¬Ù„Ø§Øª AML'],
      schedule: [
        { frequency: 'On Demand', task: 'Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ', responsible: 'Ø³ÙƒØ±ØªÙŠØ± Ø§Ù„Ø´Ø±ÙƒØ©' },
        { frequency: 'Quarterly', task: 'Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', responsible: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
        { frequency: 'Annual', task: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø³Ù†ÙˆÙŠ', responsible: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' },
      ],
      breachTriggers: ['DisclosureDelay>24h', 'FinancialStatementsLate', 'AMLViolation'],
      contacts: [{ name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', email: 'info@cma.org.sa', phone: '920005555' }],
      resources: [{ name: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù„ÙˆØ§Ø¦Ø­', url: 'https://cma.org.sa/regulations', type: 'PDF' }],
    },
    // 7. SAMA AML/CFT
    {
      id: 7, code: 'SA-SAMA-AML', name: 'Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨', nameEn: 'AML/CFT Regulations',
      authority: 'SAMA', authorityName: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', icon: 'âš–ï¸', color: 'slate', criticality: 'Critical',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '2023', effectiveDate: '2017-08-01',
      lastUpdated: '2023-12-01',
      description: 'Ù†Ø¸Ø§Ù… Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø±Ù‡Ø§Ø¨ ÙˆØ§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
      scope: 'Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ† ÙˆÙ…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ±Ø§ÙØ©',
      sectorAr: ['Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Ø§Ù„ØµØ±Ø§ÙØ©', 'Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 25 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„ + Ø§Ù„Ø³Ø¬Ù† Ø­ØªÙ‰ 15 Ø³Ù†Ø©',
      penaltyDetails: {
        financial: { min: 100000, max: 25000000, currency: 'SAR' },
        operational: ['Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø·', 'Ø­Ø¸Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†'],
        criminal: 'Ø§Ù„Ø³Ø¬Ù† Ù…Ù† 2 Ø¥Ù„Ù‰ 15 Ø³Ù†Ø©'
      },
      complianceRate: 75, riskScore: 10,
      obligations: [
        { code: 'AML-OBL-001', title: 'ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ø¹Ø±Ù Ø¹Ù…ÙŠÙ„Ùƒ (KYC)', description: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', severity: 'Critical', recurrence: 'Per Customer', deadline: 'Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©', evidenceRequired: ['Ù…Ù„ÙØ§Øª KYC', 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù‡ÙˆÙŠØ©'] },
        { code: 'AML-OBL-002', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© (STR)', description: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø£ÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø´Ø¨ÙˆÙ‡Ø©', severity: 'Critical', recurrence: 'On Incident', deadline: '10 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± STR', 'Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„'] },
        { code: 'AML-OBL-003', title: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ AML', description: 'ØªØ¹ÙŠÙŠÙ† MLRO Ù…Ø³ØªÙ‚Ù„ ÙˆÙ…Ø¤Ù‡Ù„', severity: 'Critical', recurrence: 'Once', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ù‚Ø±Ø§Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª'] },
        { code: 'AML-OBL-004', title: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ AML', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ Ø³Ù†ÙˆÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ø®Ø·Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±'] },
        { code: 'AML-OBL-005', title: 'ÙØ­Øµ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', description: 'ÙØ­Øµ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¶Ø¯ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„Ø¯ÙˆÙ„ÙŠØ©', severity: 'Critical', recurrence: 'Continuous', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©'] },
        { code: 'AML-OBL-006', title: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¬Ù„Ø§Øª 10 Ø³Ù†ÙˆØ§Øª', description: 'Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', severity: 'High', recurrence: 'Continuous', deadline: '10 Ø³Ù†ÙˆØ§Øª', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ'] },
      ],
      standards: [
        { code: 'STD-AML-01', title: 'Ø¥ØªÙ…Ø§Ù… KYC Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-AML-02', title: 'ØªÙ‚Ø¯ÙŠÙ… STR Ø®Ù„Ø§Ù„ 10 Ø£ÙŠØ§Ù…', metric: 'â‰¤ 10 Ø£ÙŠØ§Ù…', target: 10, unit: 'days' },
        { code: 'STD-AML-03', title: 'ÙØ­Øµ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª ÙÙˆØ±ÙŠ', metric: 'Real-time', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ù…Ù„ÙØ§Øª KYC', 'ØªÙ‚Ø§Ø±ÙŠØ± STR', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨', 'Ù†ØªØ§Ø¦Ø¬ ÙØ­Øµ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª'],
      schedule: [
        { frequency: 'Real-time', task: 'ÙØ­Øµ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', responsible: 'Ù†Ø¸Ø§Ù… AML' },
        { frequency: 'On Demand', task: 'ØªÙ‚Ø§Ø±ÙŠØ± STR', responsible: 'MLRO' },
        { frequency: 'Annual', task: 'ØªØ¯Ø±ÙŠØ¨ AML', responsible: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' },
      ],
      breachTriggers: ['STRNotFiled>10d', 'KYCIncomplete', 'SanctionMatch', 'TrainingOverdue'],
      contacts: [{ name: 'ÙˆØ­Ø¯Ø© Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', email: 'aml@sama.gov.sa', phone: '0114662000' }],
      resources: [{ name: 'Ù†Ø¸Ø§Ù… Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', url: 'https://sama.gov.sa/aml', type: 'PDF' }],
    },
    // 8. CBAHI/GAHAR
    {
      id: 8, code: 'SA-CBAHI-GAHAR', name: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØµØ­ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠØ©', nameEn: 'CBAHI Healthcare Accreditation',
      authority: 'CBAHI', authorityName: 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ©', icon: 'ğŸ¥', color: 'teal',
      criticality: 'High', status: 'Active', type: 'Mandatory', country: 'SA', version: '4.0', effectiveDate: '2006-01-01',
      lastUpdated: '2024-01-01',
      description: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© ÙˆØ³Ù„Ø§Ù…Ø© Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ© (Ù…Ø³ØªØ´ÙÙŠØ§ØªØŒ Ù…Ø±Ø§ÙƒØ² Ø·Ø¨ÙŠØ©ØŒ Ø¹ÙŠØ§Ø¯Ø§Øª)',
      sectorAr: ['Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©'], penalty: 'Ø³Ø­Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ±Ø®ÙŠØµ + ØºØ±Ø§Ù…Ø§Øª',
      penaltyDetails: {
        financial: { min: 10000, max: 1000000, currency: 'SAR' },
        operational: ['Ø³Ø­Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ±Ø®ÙŠØµ', 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø³Ù…'],
        criminal: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¬Ù†Ø§Ø¦ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ù‡Ù…Ø§Ù„ Ø§Ù„Ø·Ø¨ÙŠ'
      },
      complianceRate: 70, riskScore: 8,
      obligations: [
        { code: 'CBAHI-OBL-001', title: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙˆØ·Ù†ÙŠ', description: 'Ø§Ø¬ØªÙŠØ§Ø² ØªÙ‚ÙŠÙŠÙ… CBAHI ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', severity: 'Critical', recurrence: 'Once', deadline: 'Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'] },
        { code: 'CBAHI-OBL-002', title: 'ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ù„Ù„Ù…Ø±Ø¶Ù‰', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ÙˆØ§Ø¯Ø«'] },
        { code: 'CBAHI-OBL-003', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø±', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆÙ‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø©', 'Ø®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†'] },
        { code: 'CBAHI-OBL-004', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©', description: 'ØªÙˆØ«ÙŠÙ‚ ÙƒØ§Ù…Ù„ ÙˆØ¯Ù‚ÙŠÙ‚ Ù„Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©', 'ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ«ÙŠÙ‚'] },
        { code: 'CBAHI-OBL-005', title: 'Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰', description: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø´Ø§Ù…Ù„ Ù„Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø§Øª Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰', 'Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø¹Ø¯ÙˆÙ‰'] },
      ],
      standards: [
        { code: 'STD-CBAHI-01', title: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø¯ÙˆÙ‰ Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©', metric: '< 5%', target: 5, unit: '%' },
        { code: 'STD-CBAHI-02', title: 'Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©', metric: 'â‰¥ 95%', target: 95, unit: '%' },
        { code: 'STD-CBAHI-03', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³Ù„Ø§Ù…Ø©', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©', 'Ø³Ø¬Ù„Ø§Øª Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰', 'Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©'],
      schedule: [
        { frequency: 'Daily', task: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰', responsible: 'Ù‚Ø³Ù… Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ø¹Ø¯ÙˆÙ‰' },
        { frequency: 'Monthly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø©', responsible: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©' },
        { frequency: 'Annual', task: 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø°Ø§ØªÙŠ', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' },
      ],
      breachTriggers: ['InfectionRateHigh', 'SafetyIncident', 'DocumentationGap'],
      contacts: [{ name: 'CBAHI', email: 'info@cbahi.gov.sa', phone: '920000943' }],
      resources: [{ name: 'Ù…Ø¹Ø§ÙŠÙŠØ± CBAHI', url: 'https://cbahi.gov.sa/standards', type: 'PDF' }],
    },
    // 9. Civil Defense
    {
      id: 9, code: 'SA-CD-SAFETY', name: 'Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø±ÙŠÙ‚', nameEn: 'Civil Defense Fire Safety', authority: 'CD',
      authorityName: 'Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', icon: 'ğŸš’', color: 'orange', criticality: 'Critical', status: 'Active',
      type: 'Mandatory', country: 'SA', version: '2023', effectiveDate: '1986-01-01', lastUpdated: '2023-06-01',
      description: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø±ÙŠÙ‚ Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„ØµÙ†Ø§Ø¹ÙŠØ©',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„ØµÙ†Ø§Ø¹ÙŠØ© ÙˆØ§Ù„Ø³ÙƒÙ†ÙŠØ©', sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª + Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†Ø´Ø£Ø© + Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¬Ù†Ø§Ø¦ÙŠØ©',
      penaltyDetails: {
        financial: { min: 5000, max: 500000, currency: 'SAR' }, operational: ['Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'Ø³Ø­Ø¨ Ø§Ù„Ø±Ø®ØµØ©'],
        criminal: 'Ø§Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ù…Ø§Ù„ Ø§Ù„Ù…ØªØ³Ø¨Ø¨ ÙÙŠ Ø­ÙˆØ§Ø¯Ø«'
      },
      complianceRate: 80, riskScore: 9,
      obligations: [
        { code: 'CD-OBL-001', title: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', description: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø³Ù„Ø§Ù…Ø© Ø³Ø§Ø±ÙŠØ© Ù…Ù† Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', severity: 'Critical', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©'] },
        { code: 'CD-OBL-002', title: 'ØµÙŠØ§Ù†Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ø·ÙØ§Ø¡', description: 'ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ø£Ù†Ø¸Ù…Ø© Ø¥Ø·ÙØ§Ø¡ Ø§Ù„Ø­Ø±ÙŠÙ‚', severity: 'Critical', recurrence: 'Monthly', deadline: 'Ø´Ù‡Ø±ÙŠ', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ÙØ­Øµ'] },
        { code: 'CD-OBL-003', title: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', description: 'ØªØ¯Ø±ÙŠØ¨ Ø¯ÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø®Ø·Ø· Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ ÙˆØ§Ù„Ø·ÙˆØ§Ø±Ø¦', severity: 'High', recurrence: 'Semi-Annual', deadline: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†'] },
        { code: 'CD-OBL-004', title: 'ØªÙˆÙÙŠØ± Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', description: 'Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø®Ø§Ø±Ø¬ Ø·ÙˆØ§Ø±Ø¦ ÙƒØ§ÙÙŠØ© ÙˆÙ…Ø¶Ø§Ø¡Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø±Ø¬', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©'] },
        { code: 'CD-OBL-005', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø­Ø±ÙŠÙ‚', description: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø£ÙŠ Ø­ÙˆØ§Ø¯Ø« Ø­Ø±ÙŠÙ‚', severity: 'Critical', recurrence: 'On Incident', deadline: 'ÙÙˆØ±ÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¯Ø«', 'Ù…Ø­Ø¶Ø± Ø§Ù„ØªØ­Ù‚ÙŠÙ‚'] },
      ],
      standards: [
        { code: 'STD-CD-01', title: 'ØµÙ„Ø§Ø­ÙŠØ© Ø·ÙØ§ÙŠØ§Øª Ø§Ù„Ø­Ø±ÙŠÙ‚', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-CD-02', title: 'Ø¥Ø¶Ø§Ø¡Ø© Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-CD-03', title: 'ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', metric: '2 Ø³Ù†ÙˆÙŠØ§Ù‹', target: 2, unit: 'per year' },
      ],
      evidenceTypes: ['Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¨', 'Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡'],
      schedule: [
        { frequency: 'Monthly', task: 'ÙØ­Øµ Ø·ÙØ§ÙŠØ§Øª Ø§Ù„Ø­Ø±ÙŠÙ‚', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø³Ù„Ø§Ù…Ø©' },
        { frequency: 'Quarterly', task: 'ÙØ­Øµ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø±', responsible: 'Ø´Ø±ÙƒØ© Ø§Ù„ØµÙŠØ§Ù†Ø©' },
        { frequency: 'Semi-Annual', task: 'ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦' },
        { frequency: 'Annual', task: 'ØªØ¬Ø¯ÙŠØ¯ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³Ù„Ø§Ù…Ø©', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø³Ù„Ø§Ù…Ø©' },
      ],
      breachTriggers: ['CertificateExpired', 'MaintenanceOverdue', 'FireIncident'],
      contacts: [{ name: 'Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ', email: 'info@998.gov.sa', phone: '998' }],
      resources: [{ name: 'ÙƒÙˆØ¯ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ - Ø§Ù„Ø­Ø±ÙŠÙ‚', url: 'https://998.gov.sa/codes', type: 'PDF' }],
    },
    // 10. MHRSD Labor Law
    {
      id: 10, code: 'SA-MHRSD-LABOR', name: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', nameEn: 'Labor Law & Social Insurance',
      authority: 'MHRSD', authorityName: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', icon: 'ğŸ‘¥', color: 'cyan',
      criticality: 'High', status: 'Active', type: 'Mandatory', country: 'SA', version: '2024', effectiveDate: '2005-04-23',
      lastUpdated: '2024-03-01',
      description: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØ¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ø·Ø§Ù‚Ø§Øª',
      scope: 'Ø¬Ù…ÙŠØ¹ Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ', sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'], penalty: 'ØºØ±Ø§Ù…Ø§Øª + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª + Ø­Ø¸Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ø¯Ø§Ù…',
      penaltyDetails: {
        financial: { min: 1000, max: 100000, currency: 'SAR' },
        operational: ['Ø¥ÙŠÙ‚Ø§Ù Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆØ²Ø§Ø±Ø©', 'Ø­Ø¸Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ø¯Ø§Ù…', 'Ø¥ÙŠÙ‚Ø§Ù ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„'],
        criminal: 'Ù‚Ø¯ ØªØµÙ„ Ù„Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„'
      },
      complianceRate: 85, riskScore: 7,
      obligations: [
        { code: 'MHRSD-OBL-001', title: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ† (Ù†Ø·Ø§Ù‚Ø§Øª)', description: 'ØªØ­Ù‚ÙŠÙ‚ Ù†Ø³Ø¨ Ø§Ù„Ø³Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†Ø´Ø§Ø·', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø© Ù†Ø·Ø§Ù‚Ø§Øª', 'Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†'] },
        { code: 'MHRSD-OBL-002', title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª', description: 'ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', severity: 'Critical', recurrence: 'Per Employee', deadline: '15 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„ØªØ¹ÙŠÙŠÙ†', evidenceRequired: ['Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'Ø³Ø¬Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª'] },
        { code: 'MHRSD-OBL-003', title: 'ØµØ±Ù Ø§Ù„Ø£Ø¬ÙˆØ± Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬ÙˆØ±', description: 'ØµØ±Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ Ø¹Ø¨Ø± WPS', severity: 'Critical', recurrence: 'Monthly', deadline: 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±', evidenceRequired: ['Ù…Ù„ÙØ§Øª WPS', 'ÙƒØ´ÙˆÙ Ø§Ù„Ø±ÙˆØ§ØªØ¨'] },
        { code: 'MHRSD-OBL-004', title: 'ØªÙˆØ«ÙŠÙ‚ Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹', description: 'ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙÙŠ Ù…Ù†ØµØ© Ù‚ÙˆÙ‰', severity: 'High', recurrence: 'Per Employee', deadline: '30 ÙŠÙˆÙ…', evidenceRequired: ['Ø¹Ù‚ÙˆØ¯ Ù…ÙˆØ«Ù‚Ø©', 'Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚'] },
        { code: 'MHRSD-OBL-005', title: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª', description: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø£Ø­ÙƒØ§Ù… Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] },
        { code: 'MHRSD-OBL-006', title: 'ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø¢Ù…Ù†Ø©', description: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª'] },
      ],
      standards: [
        { code: 'STD-MHRSD-01', title: 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ·ÙŠÙ†', metric: 'Ø­Ø³Ø¨ Ø§Ù„Ù†Ø´Ø§Ø·', target: 100, unit: '%' },
        { code: 'STD-MHRSD-02', title: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù€ WPS', metric: '100%', target: 100, unit: '%' },
        { code: 'STD-MHRSD-03', title: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ù‚ÙˆØ¯', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø´Ù‡Ø§Ø¯Ø© Ù†Ø·Ø§Ù‚Ø§Øª', 'Ù…Ù„ÙØ§Øª WPS', 'Ø¹Ù‚ÙˆØ¯ Ù…ÙˆØ«Ù‚Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª'],
      schedule: [
        { frequency: 'Monthly', task: 'ØµØ±Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¹Ø¨Ø± WPS', responsible: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' },
        { frequency: 'Monthly', task: 'Ø³Ø¯Ø§Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª', responsible: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
        { frequency: 'Quarterly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ø³Ø¨ Ø§Ù„ØªÙˆØ·ÙŠÙ†', responsible: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' },
      ],
      breachTriggers: ['NitaqatRed', 'WPSDelayed', 'GOSIUnpaid', 'ContractNotDocumented'],
      contacts: [{ name: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', email: 'cs@hrsd.gov.sa', phone: '19911' }],
      resources: [{ name: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„', url: 'https://hrsd.gov.sa/labor-law', type: 'PDF' }],
    },
    // 11. ISO 27001
    {
      id: 11, code: 'INT-ISO-27001', name: 'ISO 27001 Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'ISO 27001 ISMS', authority: 'ISO',
      authorityName: 'Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±', icon: 'ğŸ”’', color: 'gray', criticality: 'High', status: 'Active',
      type: 'Voluntary', country: 'INT', version: '2022', effectiveDate: '2005-10-15', lastUpdated: '2022-10-25',
      description: 'Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ³Ø¹Ù‰ Ù„Ø´Ù‡Ø§Ø¯Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
      sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª'], penalty: 'ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© + Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯',
      penaltyDetails: {
        financial: { min: 0, max: 0, currency: 'SAR' }, operational: ['Ø³Ø­Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©', 'Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯', 'Ø¶Ø±Ø± Ø§Ù„Ø³Ù…Ø¹Ø©'],
        criminal: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'
      },
      complianceRate: 90, riskScore: 6,
      obligations: [
        { code: 'ISO27K-OBL-001', title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', description: 'ØªØµÙ…ÙŠÙ… ÙˆØªÙˆØ«ÙŠÙ‚ ISMS Ø´Ø§Ù…Ù„', severity: 'Critical', recurrence: 'Once', deadline: 'Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø© ISMS', 'Ù†Ø·Ø§Ù‚ ISMS', 'Ø¨ÙŠØ§Ù† Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'] },
        { code: 'ISO27K-OBL-002', title: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø£Ù…Ù†ÙŠØ©', severity: 'Critical', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'] },
        { code: 'ISO27K-OBL-003', title: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ù…Ù† Annex A', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['SoA', 'Ø£Ø¯Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'] },
        { code: 'ISO27K-OBL-004', title: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', description: 'ØªØ¯Ù‚ÙŠÙ‚ Ø¯Ø§Ø®Ù„ÙŠ Ø³Ù†ÙˆÙŠ Ù„Ù„Ù€ ISMS', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'Ø®Ø·Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©'] },
        { code: 'ISO27K-OBL-005', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', description: 'Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù€ ISMS', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†'] },
        { code: 'ISO27K-OBL-006', title: 'Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ…Ø±', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø¯ÙˆØ±Ø© PDCA Ù„Ù„ØªØ­Ø³ÙŠÙ†', severity: 'Medium', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª', 'Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡'] },
      ],
      standards: [
        { code: 'STD-ISO-01', title: 'ØªØºØ·ÙŠØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', metric: '100% Ù…Ù† SoA', target: 100, unit: '%' },
        { code: 'STD-ISO-02', title: 'Ø¥ØºÙ„Ø§Ù‚ Ø¹Ø¯Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª', metric: '< 30 ÙŠÙˆÙ…', target: 30, unit: 'days' },
        { code: 'STD-ISO-03', title: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„Ø£Ù…Ù†ÙŠ', metric: '100%', target: 100, unit: '%' },
      ],
      evidenceTypes: ['Ø´Ù‡Ø§Ø¯Ø© ISO 27001', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'SoA'],
      schedule: [
        { frequency: 'Quarterly', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', responsible: 'Ù…Ø³Ø¤ÙˆÙ„ Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' },
        { frequency: 'Annual', task: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚' },
        { frequency: 'Annual', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', responsible: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§' },
        { frequency: 'Annual', task: 'ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©/Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', responsible: 'Ø¬Ù‡Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' },
      ],
      breachTriggers: ['MajorNonConformity', 'RiskAssessmentOverdue', 'AuditOverdue'],
      contacts: [{ name: 'Ø¬Ù‡Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©', email: 'certification@example.com', phone: '+1234567890' }],
      resources: [{ name: 'ISO 27001:2022', url: 'https://iso.org/27001', type: 'Standard' }],
    },
    // 12. PCI DSS
    {
      id: 12, code: 'INT-PCI-DSS', name: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ø§Ù† Ø¨ÙŠØ§Ù†Ø§Øª ØµÙ†Ø§Ø¹Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹', nameEn: 'PCI DSS', authority: 'PCI-SSC',
      authorityName: 'Ù…Ø¬Ù„Ø³ Ù…Ø¹Ø§ÙŠÙŠØ± Ø£Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹', icon: 'ğŸ’³', color: 'violet', criticality: 'Critical', status: 'Active',
      type: 'Conditional', country: 'INT', version: '4.0', effectiveDate: '2022-03-31', lastUpdated: '2024-03-31',
      description: 'Ù…Ø¹ÙŠØ§Ø± Ø£Ù…Ø§Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø§Ù…Ù„ÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª',
      scope: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªÙŠ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª',
      sectorAr: ['Ø§Ù„ØªØ¬Ø²Ø¦Ø©', 'Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', 'Ø§Ù„Ø¨Ù†ÙˆÙƒ', 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª Ù…Ù† Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª + Ø³Ø­Ø¨ Ø­Ù‚ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª',
      penaltyDetails: {
        financial: { min: 5000, max: 100000, currency: 'USD' },
        operational: ['Ø³Ø­Ø¨ Ø­Ù‚ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª', 'Ø²ÙŠØ§Ø¯Ø© Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'],
        criminal: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª'
      },
      complianceRate: 75, riskScore: 9,
      obligations: [
        { code: 'PCI-OBL-001', title: 'ØªØ«Ø¨ÙŠØª ÙˆØµÙŠØ§Ù†Ø© Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', description: 'Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯Ø§Ø±', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'] },
        { code: 'PCI-OBL-002', title: 'Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', description: 'ØªØ´ÙÙŠØ± ÙˆØ­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªØ´ÙÙŠØ±', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ'] },
        { code: 'PCI-OBL-003', title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', description: 'ÙØ­Øµ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ', severity: 'High', recurrence: 'Quarterly', deadline: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± ASV', 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'] },
        { code: 'PCI-OBL-004', title: 'ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø¹Ø±ÙØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„'] },
        { code: 'PCI-OBL-005', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø³Ù†ÙˆÙŠ', description: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ø³Ù†ÙˆÙŠ', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'] },
        { code: 'PCI-OBL-006', title: 'ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', description: 'ØªÙ‚Ø¯ÙŠÙ… SAQ Ø£Ùˆ ROC Ø³Ù†ÙˆÙŠØ§Ù‹', severity: 'Critical', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['SAQ/ROC', 'AOC'] },
      ],
      standards: [
        { code: 'STD-PCI-01', title: 'ØªØ´ÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', metric: 'AES-256', target: 100, unit: '%' },
        { code: 'STD-PCI-02', title: 'ÙØ­Øµ ASV Ù†Ø§Ø¬Ø­', metric: 'Pass', target: 100, unit: '%' },
        { code: 'STD-PCI-03', title: 'Ø¹Ø¯Ù… ØªØ®Ø²ÙŠÙ† CVV/PIN', metric: '0', target: 0, unit: 'instances' },
      ],
      evidenceTypes: ['SAQ', 'ROC', 'AOC', 'ØªÙ‚Ø§Ø±ÙŠØ± ASV', 'Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚'],
      schedule: [
        { frequency: 'Quarterly', task: 'ÙØ­Øµ ASV', responsible: 'Ù…Ø²ÙˆØ¯ ASV' },
        { frequency: 'Annual', task: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', responsible: 'Ø¬Ù‡Ø© Ù…Ø¹ØªÙ…Ø¯Ø©' },
        { frequency: 'Annual', task: 'ØªÙ‚ÙŠÙŠÙ… PCI DSS', responsible: 'QSA/ISA' },
      ],
      breachTriggers: ['ASVScanFailed', 'DataBreach', 'ComplianceExpired'],
      contacts: [{ name: 'PCI SSC', email: 'info@pcissc.org', phone: '+1-781-876-8855' }],
      resources: [{ name: 'PCI DSS v4.0', url: 'https://pcisecuritystandards.org/document_library', type: 'Standard' }],
    },
    // 13. SOC 2
    {
      id: 13, code: 'INT-SOC2', name: 'ØªÙ‚Ø±ÙŠØ± SOC 2', nameEn: 'SOC 2 Type II', authority: 'AICPA',
      authorityName: 'Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ Ù„Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠÙŠÙ†', icon: 'â˜ï¸', color: 'sky', criticality: 'High', status: 'Active',
      type: 'Voluntary', country: 'INT', version: '2017', effectiveDate: '2017-04-01', lastUpdated: '2023-01-01',
      description: 'ØªÙ‚Ø±ÙŠØ± Ø±Ù‚Ø§Ø¨ÙŠ Ù„Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©',
      scope: 'Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© ÙˆØ´Ø±ÙƒØ§Øª SaaS',
      sectorAr: ['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù‡ÙŠØ¯'],
      penalty: 'Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯',
      penaltyDetails: {
        financial: { min: 0, max: 0, currency: 'USD' }, operational: ['Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯', 'ÙÙ‚Ø¯Ø§Ù† Ø«Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'],
        criminal: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'
      },
      complianceRate: 85, riskScore: 6,
      obligations: [
        { code: 'SOC2-OBL-001', title: 'ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§ÙŠÙŠØ± Trust Services', description: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªÙˆØ§ÙØ± ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø³Ø±ÙŠØ© ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', 'Ø§Ù„Ø£Ø¯Ù„Ø©'] },
        { code: 'SOC2-OBL-002', title: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¯Ù‚ÙŠÙ‚ SOC 2', description: 'ØªØ¯Ù‚ÙŠÙ‚ Ø³Ù†ÙˆÙŠ Ù…Ù† Ù…Ø¯Ù‚Ù‚ Ù…Ø³ØªÙ‚Ù„', severity: 'High', recurrence: 'Annual', deadline: 'Ø³Ù†ÙˆÙŠ', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± SOC 2', 'Ø®Ø·Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'] },
        { code: 'SOC2-OBL-003', title: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª', description: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙŠ Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ù…Ù† Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', severity: 'High', recurrence: 'On Demand', deadline: '90 ÙŠÙˆÙ…', evidenceRequired: ['Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­'] },
      ],
      standards: [
        { code: 'STD-SOC2-01', title: 'ØªÙ‚Ø±ÙŠØ± Ù†Ø¸ÙŠÙ', metric: 'No Exceptions', target: 0, unit: 'exceptions' },
        { code: 'STD-SOC2-02', title: 'ØªÙˆÙØ± Ø§Ù„Ø®Ø¯Ù…Ø©', metric: 'â‰¥ 99.9%', target: 99.9, unit: '%' },
      ],
      evidenceTypes: ['ØªÙ‚Ø±ÙŠØ± SOC 2 Type II', 'Bridge Letter', 'Ø®Ø·Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­'],
      schedule: [
        { frequency: 'Continuous', task: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', responsible: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„' },
        { frequency: 'Annual', task: 'ØªØ¯Ù‚ÙŠÙ‚ SOC 2', responsible: 'Ø§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ' },
      ],
      breachTriggers: ['ExceptionIdentified', 'ControlFailure', 'ReportExpired'],
      contacts: [{ name: 'Ø§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ', email: 'audit@example.com', phone: '+1234567890' }],
      resources: [{ name: 'AICPA Trust Services', url: 'https://aicpa.org/soc', type: 'Guide' }],
    },
    // 14. GDPR
    {
      id: 14, code: 'INT-EU-GDPR', name: 'Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'GDPR', authority: 'EU',
      authorityName: 'Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ', icon: 'ğŸ‡ªğŸ‡º', color: 'blue', criticality: 'Critical', status: 'Active',
      type: 'Conditional', country: 'INT', version: '2016/679', effectiveDate: '2018-05-25', lastUpdated: '2018-05-25',
      description: 'Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
      scope: 'Ø£ÙŠ Ù…Ù†Ø´Ø£Ø© ØªØ¹Ø§Ù„Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ø·Ù†ÙŠ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ', sectorAr: ['Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 20 Ù…Ù„ÙŠÙˆÙ† ÙŠÙˆØ±Ùˆ Ø£Ùˆ 4% Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©',
      penaltyDetails: {
        financial: { min: 10000000, max: 20000000, currency: 'EUR' },
        operational: ['Ø­Ø¸Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ø£ÙˆØ§Ù…Ø± Ù‚Ø¶Ø§Ø¦ÙŠØ©'],
        criminal: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø´Ø®ØµÙŠØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†'
      },
      complianceRate: 70, riskScore: 9,
      obligations: [
        { code: 'GDPR-OBL-001', title: 'Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', description: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„ÙƒÙ„ Ù†Ø´Ø§Ø· Ù…Ø¹Ø§Ù„Ø¬Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ'] },
        { code: 'GDPR-OBL-002', title: 'Ø­Ù‚ÙˆÙ‚ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'ØªÙ…ÙƒÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚ GDPR', severity: 'Critical', recurrence: 'On Request', deadline: '30 ÙŠÙˆÙ…', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©'] },
        { code: 'GDPR-OBL-003', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª 72 Ø³Ø§Ø¹Ø©', description: 'Ø¥Ø¨Ù„Ø§Øº DPA Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©', severity: 'Critical', recurrence: 'On Breach', deadline: '72 Ø³Ø§Ø¹Ø©', evidenceRequired: ['Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚'] },
        { code: 'GDPR-OBL-004', title: 'ØªØ¹ÙŠÙŠÙ† DPO', description: 'ØªØ¹ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ Ù…Ø·Ù„ÙˆØ¨', severity: 'High', recurrence: 'Once', deadline: 'Ø­Ø³Ø¨ Ø§Ù„Ù†Ø´Ø§Ø·', evidenceRequired: ['Ù‚Ø±Ø§Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'ØªØ³Ø¬ÙŠÙ„ DPA'] },
        { code: 'GDPR-OBL-005', title: 'Ø¥Ø¬Ø±Ø§Ø¡ DPIA', description: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø± Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', severity: 'High', recurrence: 'On Demand', deadline: 'Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', evidenceRequired: ['ØªÙ‚Ø±ÙŠØ± DPIA'] },
        { code: 'GDPR-OBL-006', title: 'Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø¨Ø§Ù„ØªØµÙ…ÙŠÙ…', description: 'ØªØ·Ø¨ÙŠÙ‚ Privacy by Design', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ØªØµÙ…ÙŠÙ…', 'ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©'] },
      ],
      standards: [
        { code: 'STD-GDPR-01', title: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù€ DSR', metric: 'â‰¤ 30 ÙŠÙˆÙ…', target: 30, unit: 'days' },
        { code: 'STD-GDPR-02', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', metric: 'â‰¤ 72 Ø³Ø§Ø¹Ø©', target: 72, unit: 'hours' },
      ],
      evidenceTypes: ['Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'ØªÙ‚Ø§Ø±ÙŠØ± DPIA', 'Ø³Ø¬Ù„Ø§Øª DSR', 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚'],
      schedule: [
        { frequency: 'On Request', task: 'Ù…Ø¹Ø§Ù„Ø¬Ø© DSR', responsible: 'DPO' },
        { frequency: 'Annual', task: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', responsible: 'DPO' },
      ],
      breachTriggers: ['BreachNotReported>72h', 'DSROverdue>30d', 'NoLegalBasis'],
      contacts: [{ name: 'Data Protection Authority', email: 'dpa@eu-dpa.eu', phone: '+3212345678' }],
      resources: [{ name: 'GDPR Full Text', url: 'https://gdpr.eu/tag/gdpr/', type: 'Regulation' }],
    },
    // 15. CITC
    {
      id: 15, code: 'SA-CITC-TELECOM', name: 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'CITC Telecom Regulations',
      authority: 'CITC', authorityName: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', icon: 'ğŸ“¡', color: 'pink', criticality: 'High',
      status: 'Active', type: 'Mandatory', country: 'SA', version: '2024', effectiveDate: '2001-06-12',
      lastUpdated: '2024-01-01',
      description: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù„ÙˆØ§Ø¦Ø­ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
      scope: 'Ù…Ø´ØºÙ„ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆÙ…Ø²ÙˆØ¯ÙŠ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', sectorAr: ['Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª', 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'],
      penalty: 'ØºØ±Ø§Ù…Ø§Øª + Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ',
      penaltyDetails: {
        financial: { min: 50000, max: 10000000, currency: 'SAR' }, operational: ['Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø¯Ù…Ø§Øª'],
        criminal: 'Ù‚Ø¯ ØªØµÙ„ Ù„Ù„Ø³Ø¬Ù† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ù…Ø¹ÙŠÙ†Ø©'
      },
      complianceRate: 88, riskScore: 7,
      obligations: [
        { code: 'CITC-OBL-001', title: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø´Ø±ÙˆØ· Ø§Ù„ØªØ±Ø®ÙŠØµ', description: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø´Ø±ÙˆØ· Ø±Ø®ØµØ© Ø§Ù„ØªØ´ØºÙŠÙ„', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø§Ù„Ø±Ø®ØµØ©', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„'] },
        { code: 'CITC-OBL-002', title: 'Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© QoS', description: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['ØªÙ‚Ø§Ø±ÙŠØ± QoS', 'Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡'] },
        { code: 'CITC-OBL-003', title: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ', description: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù„ÙˆØ§Ø¦Ø­ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ', severity: 'High', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ù„'] },
        { code: 'CITC-OBL-004', title: 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†', description: 'Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', severity: 'Critical', recurrence: 'Continuous', deadline: 'Ù…Ø³ØªÙ…Ø±', evidenceRequired: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸'] },
      ],
      standards: [
        { code: 'STD-CITC-01', title: 'ØªÙˆÙØ± Ø§Ù„Ø´Ø¨ÙƒØ©', metric: 'â‰¥ 99.9%', target: 99.9, unit: '%' },
        { code: 'STD-CITC-02', title: 'Ø­Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰', metric: 'â‰¤ 5 Ø£ÙŠØ§Ù…', target: 5, unit: 'days' },
      ],
      evidenceTypes: ['ØªÙ‚Ø§Ø±ÙŠØ± QoS', 'Ø³Ø¬Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰', 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„'],
      schedule: [
        { frequency: 'Monthly', task: 'ØªÙ‚Ø±ÙŠØ± Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©', responsible: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' },
        { frequency: 'Quarterly', task: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', responsible: 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©' },
      ],
      breachTriggers: ['QoSBelowStandard', 'ComplaintBacklog', 'LicenseViolation'],
      contacts: [{ name: 'CITC', email: 'info@citc.gov.sa', phone: '19966' }],
      resources: [{ name: 'Ø£Ù†Ø¸Ù…Ø© CITC', url: 'https://citc.gov.sa/regulations', type: 'PDF' }],
    },]);
  const [activatedPrograms, setActivatedPrograms] = useState([1, 2, 3, 4, 5, 7]);

  const [programForm, setProgramForm] = useState({
    name: '', nameEn: '', code: '', description: '', scope: '', version: '',
    authority: '', authorityName: '', country: 'SA', type: 'Mandatory', criticality: 'High', icon: 'ğŸ“‹', color: 'emerald',
    sectorAr: [],
    effectiveDate: '', lastUpdated: new Date().toISOString().split('T')[0],
    penalty: '',
    penaltyDetails: { financial: { min: 0, max: 0, currency: 'SAR' }, operational: [], criminal: '' },
    contacts: [], resources: [],
    complianceRate: 0, riskScore: 5,
    // Arrays
    obligations: [], standards: [], evidenceTypes: [], schedule: [], breachTriggers: [],
  });

  const [obligationForm, setObligationForm] = useState({
    code: '', title: '', description: '', severity: 'High', recurrence: 'Monthly', deadline: '', evidenceRequired: [],
  });

  const [standardForm, setStandardForm] = useState({
    code: '', title: '', metric: '', target: 0, unit: '%',
  });

  const handleAddProgram = () => {
    const newProgram = {
      id: Date.now(),
      code: programForm.code || `SA-${programForm.authority}-${Date.now().toString().slice(-4)}`,
      ...programForm,
      status: 'Active',
    };
    setPrograms(prev => [...prev, newProgram]);
    setShowProgramModal(false);
    resetProgramForm();
  };

  const handleEditProgram = () => {
    setPrograms(prev => prev.map(p => p.id === selectedProgram.id ? { ...p, ...programForm } : p));
    setShowProgramModal(false);
    setEditMode(false);
    setSelectedProgram(null);
    resetProgramForm();
  };

  const handleDeleteProgram = () => {
    setPrograms(prev => prev.filter(p => p.id !== deleteTarget.id));
    setActivatedPrograms(prev => prev.filter(id => id !== deleteTarget.id));
    setShowDeleteModal(false);
    setDeleteTarget(null);
  };

  const handleAddObligation = () => {
    if (!selectedProgram) return;
    const newObl = {
      code: obligationForm.code || `${selectedProgram.authority}-OBL-${Date.now().toString().slice(-4)}`,
      ...obligationForm,
    };
    setPrograms(prev => prev.map(p =>
      p.id === selectedProgram.id ? { ...p, obligations: [...p.obligations, newObl] } : p
    ));
    setShowObligationModal(false);
    resetObligationForm();
  };

  const handleEditObligation = () => {
    setPrograms(prev => prev.map(p => {
      if (p.id === selectedProgram.id) {
        return { ...p, obligations: p.obligations.map(o => o.code === selectedObligation.code ? { ...obligationForm } : o) };
      }
      return p;
    }));
    setShowObligationModal(false);
    setEditMode(false);
    setSelectedObligation(null);
    resetObligationForm();
  };

  const handleDeleteObligation = () => {
    setPrograms(prev => prev.map(p => ({
      ...p, obligations: p.obligations.filter(o => o.code !== deleteTarget.code)
    })));
    setShowDeleteModal(false);
    setDeleteTarget(null);
  };

  const handleAddStandard = () => {
    if (!selectedProgram) return;
    const newStd = {
      code: standardForm.code || `STD-${selectedProgram.authority}-${Date.now().toString().slice(-4)}`,
      ...standardForm,
    };
    setPrograms(prev => prev.map(p =>
      p.id === selectedProgram.id ? { ...p, standards: [...(p.standards || []), newStd] } : p
    ));
    setShowStandardModal(false);
    setStandardForm({ code: '', title: '', metric: '', target: 0, unit: '%' });
  };

  const handleActivateProgram = (id) => {
    if (!activatedPrograms.includes(id)) setActivatedPrograms(prev => [...prev, id]);
  };

  const handleDeactivateProgram = (id) => {
    setActivatedPrograms(prev => prev.filter(pid => pid !== id));
  };

  const resetProgramForm = () => {
    setProgramForm({
      name: '', nameEn: '', code: '', description: '', scope: '', version: '',
      authority: '', authorityName: '', country: 'SA', type: 'Mandatory', criticality: 'High', icon: 'ğŸ“‹', color: 'emerald',
      sectorAr: [], effectiveDate: '', lastUpdated: new Date().toISOString().split('T')[0],
      penalty: '', penaltyDetails: { financial: { min: 0, max: 0, currency: 'SAR' }, operational: [], criminal: '' },
      contacts: [], resources: [], complianceRate: 0, riskScore: 5,
      obligations: [], standards: [], evidenceTypes: [], schedule: [], breachTriggers: [],
    });
    setProgramModalTab(0);
  };

  const resetObligationForm = () => {
    setObligationForm({ code: '', title: '', description: '', severity: 'High', recurrence: 'Monthly', deadline: '', evidenceRequired: [] });
  };

  const openAddProgram = () => { setEditMode(false); resetProgramForm(); setShowProgramModal(true); };

  const openEditProgram = (prog) => {
    setEditMode(true);
    setSelectedProgram(prog);
    setProgramForm({ ...prog });
    setProgramModalTab(0);
    setShowProgramModal(true);
  };

  const openAddObligation = (prog) => { setEditMode(false); setSelectedProgram(prog); resetObligationForm(); setShowObligationModal(true); };

  const openEditObligation = (prog, obl) => {
    setEditMode(true);
    setSelectedProgram(prog);
    setSelectedObligation(obl);
    setObligationForm({ ...obl });
    setShowObligationModal(true);
  };

  const openDeleteProgram = (prog) => { setDeleteTarget({ ...prog, type: 'program' }); setShowDeleteModal(true); };
  const openDeleteObligation = (obl) => { setDeleteTarget({ ...obl, type: 'obligation' }); setShowDeleteModal(true); };

  // COMPUTED VALUES
  const allObligations = useMemo(() => {
    const result = [];
    programs.forEach(prog => {
      prog.obligations.forEach(obl => {
        result.push({ ...obl, programId: prog.id, programName: prog.name, authority: prog.authority, programIcon: prog.icon });
      });
    });
    return result;
  }, [programs]);

  const filteredPrograms = useMemo(() => {
    let result = [...programs];
    if (searchQuery) {
      result = result.filter(p =>
        p.name.includes(searchQuery) || p.nameEn.toLowerCase().includes(searchQuery.toLowerCase()) || p.code.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }
    if (filterAuthority) result = result.filter(p => p.authority === filterAuthority);
    if (filterCountry) result = result.filter(p => p.country === filterCountry);
    if (filterSector) result = result.filter(p => p.sectorAr?.includes(filterSector));
    if (filterStatus === 'activated') result = result.filter(p => activatedPrograms.includes(p.id));
    if (filterStatus === 'inactive') result = result.filter(p => !activatedPrograms.includes(p.id));
    return result;
  }, [programs, searchQuery, filterAuthority, filterCountry, filterSector, filterStatus, activatedPrograms]);

  const filteredObligations = useMemo(() => {
    let result = [...allObligations];
    if (searchQuery) result = result.filter(o => o.title.includes(searchQuery) || o.code.toLowerCase().includes(searchQuery.toLowerCase()));
    if (filterAuthority) result = result.filter(o => o.authority === filterAuthority);
    if (filterSeverity) result = result.filter(o => o.severity === filterSeverity);
    return result;
  }, [allObligations, searchQuery, filterAuthority, filterSeverity]);

  const stats = useMemo(() => ({
    totalPrograms: programs.length, activatedCount: activatedPrograms.length, totalObligations: allObligations.length,
    criticalPrograms: programs.filter(p => p.criticality === 'Critical').length,
    saudiPrograms: programs.filter(p => p.country === 'SA').length,
    internationalPrograms: programs.filter(p => p.country === 'INT').length,
    criticalObligations: allObligations.filter(o => o.severity === 'Critical').length,
  }), [programs, activatedPrograms, allObligations]);

  const tabs = [
    { id: 'catalog', label: 'ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬', icon: FolderOpen, count: programs.length },
    { id: 'activated', label: 'Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø©', icon: CheckCircle2, count: activatedPrograms.length },
    { id: 'obligations', label: 'Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', icon: FileText, count: allObligations.length },
    { id: 'requirements', label: 'Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©', icon: BookOpen, count: null },
    { id: 'gapanalysis', label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª', icon: Target, count: null },
    { id: 'crossmapping', label: 'Ø±Ø¨Ø· Ø§Ù„Ø£Ø·Ø±', icon: GitBranch, count: null },
    { id: 'changetracker', label: 'ØªØªØ¨Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', icon: History, count: null },
    { id: 'impact', label: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø±', icon: AlertTriangle, count: null },
    { id: 'analytics', label: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', icon: BarChart3, count: null },
  ];

  const programModalTabs = [
    { id: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
    { id: 1, label: 'Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„ØªØµÙ†ÙŠÙ', icon: Building },
    { id: 2, label: 'Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª', icon: Layers },
    { id: 3, label: 'Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®', icon: Calendar },
    { id: 4, label: 'Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', icon: AlertTriangle },
    { id: 5, label: 'Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„', icon: Users },
    { id: 6, label: 'Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³', icon: Target },
  ];

  return (
    <div className="space-y-6">
      <div className="relative overflow-hidden bg-gradient-to-br from-green-600 via-emerald-600 to-teal-700 rounded-3xl p-8 text-white">
        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtOS45NDEgMC0xOCA4LjA1OS0xOCAxOHM4LjA1OSAxOCAxOCAxOGM5Ljk0MSAwIDE4LTguMDU5IDE4LTE4cy04LjA1OS0xOC0xOC0xOHptMCAzMmMtNy43MzIgMC0xNC02LjI2OC0xNC0xNHM2LjI2OC0xNCAxNC0xNHMxNCA2LjI2OCAxNCAxNC02LjI2OCAxNC0xNCAxNHoiIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iLjA1Ii8+PC9nPjwvc3ZnPg==')] opacity-30"></div>
        <div className="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>

        <div className="relative">
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center gap-5">
              <div className="w-20 h-20 rounded-2xl bg-white/20 backdrop-blur-xl flex items-center justify-center border border-white/30 shadow-2xl text-4xl">ğŸ‡¸ğŸ‡¦</div>
              <div>
                <div className="flex items-center gap-3 mb-1">
                  <h1 className="text-3xl font-black">Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</h1>
                  <span className="px-3 py-1 bg-white/20 rounded-full text-xs font-bold">Premium v3.0</span>
                </div>
                <p className="text-emerald-200 text-lg">Saudi & International Regulatory Programs â€¢ {programs.length} Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
              </div> </div>
            <div className="flex items-center gap-3">
              <button className="flex items-center gap-2 px-5 py-3 bg-white/10 hover:bg-white/20 rounded-xl border border-white/20 font-bold transition-all">
                <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ±
              </button>
              <button onClick={openAddProgram} className="flex items-center gap-2 px-6 py-3 bg-white text-emerald-600 rounded-xl font-bold shadow-xl hover:shadow-2xl transition-all">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬
              </button> </div> </div>
          <div className="grid grid-cols-6 gap-4">
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <FolderOpen className="w-6 h-6 text-white/80" />
                <span className="text-3xl font-black">{stats.totalPrograms}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <CheckCircle2 className="w-6 h-6 text-emerald-300" />
                <span className="text-3xl font-black">{stats.activatedCount}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ù…ÙØ¹Ù‘Ù„Ø©</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <FileText className="w-6 h-6 text-blue-300" />
                <span className="text-3xl font-black">{stats.totalObligations}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ø§Ù„ØªØ²Ø§Ù…</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <AlertTriangle className="w-6 h-6 text-red-300" />
                <span className="text-3xl font-black">{stats.criticalObligations}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ø§Ù„ØªØ²Ø§Ù… Ø­Ø±Ø¬</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <span className="text-xl">ğŸ‡¸ğŸ‡¦</span>
                <span className="text-3xl font-black">{stats.saudiPrograms}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø³Ø¹ÙˆØ¯ÙŠ</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
              <div className="flex items-center justify-between mb-2">
                <Globe className="w-6 h-6 text-purple-300" />
                <span className="text-3xl font-black">{stats.internationalPrograms}</span>
              </div>
              <p className="text-emerald-200 text-sm">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¯ÙˆÙ„ÙŠ</p>
            </div> </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden shadow-sm">
        <div className="flex border-b-2 border-slate-200 bg-slate-50">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-6 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-emerald-600 border-emerald-500 bg-white -mb-[2px]' : 'text-slate-500 border-transparent hover:text-emerald-500'
                }`}>
              <tab.icon className="w-5 h-5" />{tab.label}
              {tab.count !== null && (
                <span className={`px-2.5 py-1 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'}`}>{tab.count}</span>
              )}
            </button>
          ))}
        </div>

        {activeTab === 'catalog' && (
          <div className="p-6 space-y-4">
            <div className="flex items-center justify-between gap-4 flex-wrap">
              <div className="flex items-center gap-3 flex-wrap">
                <div className="relative">
                  <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-56 pr-12 pl-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" />
                </div>
                <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)} className="px-4 py-2.5 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                  {authorities.map(a => <option key={a.code} value={a.code}>{a.code} - {a.name}</option>)}
                </select>
                <select value={filterCountry} onChange={(e) => setFilterCountry(e.target.value)} className="px-4 py-2.5 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„</option>
                  {countries.map(c => <option key={c.code} value={c.code}>{c.flag} {c.name}</option>)}
                </select>
                <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="px-4 py-2.5 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="activated">Ù…ÙØ¹Ù‘Ù„</option>
                  <option value="inactive">ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„</option>
                </select>
              </div>
              <div className="flex items-center gap-2">
                <button onClick={() => setViewMode(viewMode === 'table' ? 'grid' : 'table')} className="p-2.5 border-2 border-slate-200 rounded-xl hover:bg-slate-50">
                  {viewMode === 'table' ? <LayoutGrid className="w-5 h-5" /> : <List className="w-5 h-5" />}
                </button>
                <button onClick={openAddProgram} className="flex items-center gap-2 px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                  <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬
                </button> </div> </div>
            {viewMode === 'table' ? (
              <div className="overflow-hidden rounded-xl border-2 border-slate-200">
                <table className="w-full">
                  <thead>
                    <tr className="bg-slate-50">
                      <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¬Ù‡Ø©</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¯ÙˆÙ„Ø©</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredPrograms.map(prog => {
                      const isActivated = activatedPrograms.includes(prog.id);
                      const country = countries.find(c => c.code === prog.country);
                      return (
                        <tr key={prog.id} className="border-t border-slate-100 hover:bg-slate-50">
                          <td className="px-4 py-3">
                            <div className="flex items-center gap-3">
                              <span className="text-2xl">{prog.icon}</span>
                              <div>
                                <p className="font-bold text-slate-800">{prog.name}</p>
                                <p className="text-xs text-slate-500">{prog.code}</p>
                              </div> </div> </td>
                          <td className="px-4 py-3 text-center">
                            <span className="px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs font-bold">{prog.authority}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-lg">{country?.flag}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${prog.type === 'Mandatory' ? 'bg-red-100 text-red-700' :
                              prog.type === 'Conditional' ? 'bg-amber-100 text-amber-700' :
                                'bg-blue-100 text-blue-700'
                              }`}>{prog.type === 'Mandatory' ? 'Ø¥Ù„Ø²Ø§Ù…ÙŠ' : prog.type === 'Conditional' ? 'Ù…Ø´Ø±ÙˆØ·' : 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ'}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${prog.criticality === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>
                              {prog.criticality === 'Critical' ? 'Ø­Ø±Ø¬' : 'Ø¹Ø§Ù„ÙŠ'}
                            </span> </td>
                          <td className="px-4 py-3 text-center">
                            <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm font-bold">{prog.obligations.length}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <div className="flex items-center justify-center gap-2">
                              <div className="w-16 h-2 bg-slate-200 rounded-full overflow-hidden">
                                <div className={`h-full rounded-full ${prog.complianceRate >= 80 ? 'bg-emerald-500' : prog.complianceRate >= 60 ? 'bg-amber-500' : 'bg-red-500'}`}
                                  style={{ width: `${prog.complianceRate}%` }}></div>
                              </div>
                              <span className="text-xs font-bold text-slate-600">{prog.complianceRate}%</span>
                            </div> </td>
                          <td className="px-4 py-3 text-center">
                            {isActivated ? (
                              <span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-bold flex items-center gap-1 justify-center">
                                <CheckCircle2 className="w-3 h-3" />Ù…ÙØ¹Ù‘Ù„
                              </span>
                            ) : (
                              <span className="px-2 py-1 bg-slate-100 text-slate-500 rounded text-xs font-bold">ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„</span>
                            )}
                          </td>
                          <td className="px-4 py-3">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => { setSelectedProgram(prog); setShowDetailModal(true); }} className="p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg" title="Ø¹Ø±Ø¶">
                                <Eye className="w-4 h-4" />
                              </button>
                              <button onClick={() => openEditProgram(prog)} className="p-1.5 text-amber-600 hover:bg-amber-50 rounded-lg" title="ØªØ¹Ø¯ÙŠÙ„">
                                <Edit className="w-4 h-4" />
                              </button>
                              <button onClick={() => openDeleteProgram(prog)} className="p-1.5 text-red-600 hover:bg-red-50 rounded-lg" title="Ø­Ø°Ù">
                                <Trash2 className="w-4 h-4" />
                              </button>
                              {!isActivated ? (
                                <button onClick={() => { setSelectedProgram(prog); setShowAdvancedWizard(true); }} className="p-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg" title="ØªÙØ¹ÙŠÙ„">
                                  <Zap className="w-4 h-4" />
                                </button>
                              ) : (
                                <button onClick={() => handleDeactivateProgram(prog.id)} className="p-1.5 text-slate-400 hover:bg-slate-50 rounded-lg" title="Ø¥Ù„ØºØ§Ø¡">
                                  <XCircle className="w-4 h-4" />
                                </button>
                              )}
                            </div> </td> </tr>);
                    })}
                  </tbody> </table> </div>
            ) : (
              <div className="grid grid-cols-3 gap-4">
                {filteredPrograms.map(prog => {
                  const isActivated = activatedPrograms.includes(prog.id);
                  const country = countries.find(c => c.code === prog.country);
                  return (
                    <div key={prog.id} className={`rounded-2xl p-5 border-2 transition-all hover:shadow-lg ${isActivated ? 'bg-gradient-to-br from-emerald-50 to-teal-50 border-emerald-200' : 'bg-white border-slate-200'}`}>
                      <div className="flex items-start justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <span className="text-3xl">{prog.icon}</span>
                          <div>
                            <p className="font-bold text-slate-800">{prog.name}</p>
                            <p className="text-xs text-slate-500">{prog.authority} â€¢ {country?.flag}</p>
                          </div> </div>
                        {isActivated && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                      </div>
                      <p className="text-sm text-slate-600 mb-4 line-clamp-2">{prog.description}</p>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${prog.criticality === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>
                            {prog.criticality === 'Critical' ? 'Ø­Ø±Ø¬' : 'Ø¹Ø§Ù„ÙŠ'}
                          </span>
                          <span className="text-xs text-slate-500">{prog.obligations.length} Ø§Ù„ØªØ²Ø§Ù…</span>
                        </div>
                        <div className="flex items-center gap-1">
                          <button onClick={() => { setSelectedProgram(prog); setShowDetailModal(true); }} className="p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg"><Eye className="w-4 h-4" /></button>
                          <button onClick={() => openEditProgram(prog)} className="p-1.5 text-amber-600 hover:bg-amber-50 rounded-lg"><Edit className="w-4 h-4" /></button>
                          {!isActivated && <button onClick={() => { setSelectedProgram(prog); setShowAdvancedWizard(true); }} className="p-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg"><Zap className="w-4 h-4" /></button>}
                        </div> </div> </div>);
                })}
              </div>
            )}
            <p className="text-sm text-slate-500">{filteredPrograms.length} Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
          </div>
        )}

        {activeTab === 'activated' && (
          <div className="p-6 space-y-4">
            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
              <CheckCircle2 className="w-5 h-5 text-emerald-500" />Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø© ÙÙŠ Ù…Ù†Ø¸Ù…ØªÙƒ ({activatedPrograms.length})
            </h3>

            {activatedPrograms.length > 0 ? (
              <div className="grid grid-cols-3 gap-4">
                {programs.filter(p => activatedPrograms.includes(p.id)).map(prog => (
                  <div key={prog.id} className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white relative overflow-hidden group">
                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                    <div className="relative">
                      <div className="flex items-center justify-between mb-4">
                        <span className="text-4xl">{prog.icon}</span>
                        <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                          <button onClick={() => openEditProgram(prog)} className="p-2 bg-white/20 hover:bg-white/30 rounded-lg"><Edit className="w-4 h-4" /></button>
                          <button onClick={() => handleDeactivateProgram(prog.id)} className="p-2 bg-white/20 hover:bg-white/30 rounded-lg"><XCircle className="w-4 h-4" /></button>
                        </div> </div>
                      <h4 className="font-bold text-xl mb-1">{prog.name}</h4>
                      <p className="text-emerald-100 text-sm mb-4">{prog.authority} â€¢ {prog.country === 'SA' ? 'ğŸ‡¸ğŸ‡¦' : 'ğŸŒ'}</p>
                      <div className="grid grid-cols-3 gap-2">
                        <div className="bg-white/20 rounded-xl p-2 text-center">
                          <p className="text-xl font-black">{prog.obligations.length}</p>
                          <p className="text-xs text-emerald-100">Ø§Ù„ØªØ²Ø§Ù…</p>
                        </div>
                        <div className="bg-white/20 rounded-xl p-2 text-center">
                          <p className="text-xl font-black">{prog.standards?.length || 0}</p>
                          <p className="text-xs text-emerald-100">Ù…Ø¹ÙŠØ§Ø±</p>
                        </div>
                        <div className="bg-white/20 rounded-xl p-2 text-center">
                          <p className="text-xl font-black">{prog.complianceRate}%</p>
                          <p className="text-xs text-emerald-100">Ø§Ù…ØªØ«Ø§Ù„</p>
                        </div> </div> </div> </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12 bg-slate-50 rounded-2xl">
                <FolderOpen className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                <p className="text-slate-500 text-lg mb-4">Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø£ÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø¹Ø¯</p>
                <button onClick={() => setActiveTab('catalog')} className="px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬</button>
              </div>
            )}
          </div>
        )}

        {activeTab === 'obligations' && (
          <div className="p-6 space-y-4">
            <div className="flex items-center justify-between gap-4 flex-wrap">
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-64 pr-12 pl-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" />
                </div>
                <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)} className="px-4 py-2.5 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                  {authorities.map(a => <option key={a.code} value={a.code}>{a.code}</option>)}
                </select>
                <select value={filterSeverity} onChange={(e) => setFilterSeverity(e.target.value)} className="px-4 py-2.5 border-2 border-slate-200 rounded-xl">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‡Ù…ÙŠØ§Øª</option>
                  <option value="Critical">Ø­Ø±Ø¬</option>
                  <option value="High">Ø¹Ø§Ù„ÙŠ</option>
                  <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                </select>
              </div> </div>
            <div className="overflow-hidden rounded-xl border-2 border-slate-200">
              <table className="w-full">
                <thead>
                  <tr className="bg-slate-50">
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="text-right px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„ØªÙƒØ±Ø§Ø±</th>
                    <th className="text-center px-4 py-3 font-bold text-slate-700">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr> </thead>
                <tbody>
                  {filteredObligations.slice(0, 50).map((obl, idx) => {
                    const prog = programs.find(p => p.id === obl.programId);
                    return (
                      <tr key={`${obl.code}-${idx}`} className="border-t border-slate-100 hover:bg-slate-50">
                        <td className="px-4 py-3">
                          <span className="font-mono text-xs bg-slate-100 px-2 py-1 rounded font-bold">{obl.code}</span>
                        </td>
                        <td className="px-4 py-3">
                          <p className="text-slate-800 font-medium">{obl.title}</p>
                          {obl.description && <p className="text-xs text-slate-500 mt-1 line-clamp-1">{obl.description}</p>}
                        </td>
                        <td className="px-4 py-3 text-center">
                          <div className="flex items-center justify-center gap-1">
                            <span className="text-lg">{obl.programIcon}</span>
                            <span className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-bold">{obl.authority}</span>
                          </div> </td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${obl.severity === 'Critical' ? 'bg-red-100 text-red-700' :
                            obl.severity === 'High' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                            }`}>{obl.severity === 'Critical' ? 'Ø­Ø±Ø¬' : obl.severity === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span>
                        </td>
                        <td className="px-4 py-3 text-center text-sm text-slate-600">{obl.recurrence}</td>
                        <td className="px-4 py-3">
                          <div className="flex items-center justify-center gap-1">
                            <button onClick={() => prog && openEditObligation(prog, obl)} className="p-1.5 text-amber-600 hover:bg-amber-50 rounded-lg"><Edit className="w-4 h-4" /></button>
                            <button onClick={() => openDeleteObligation(obl)} className="p-1.5 text-red-600 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /></button>
                          </div> </td> </tr>);
                  })}
                </tbody> </table> </div>
            <p className="text-sm text-slate-500">{filteredObligations.length} Ø§Ù„ØªØ²Ø§Ù… (Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50)</p>
          </div>
        )}

        {activeTab === 'requirements' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <BookOpen className="w-5 h-5 text-blue-500" />
                Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
              </h3>
              <div className="flex items-center gap-3">
                <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)} className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                  {authorities.map(a => <option key={a.code} value={a.code}>{a.code}</option>)}
                </select>
              </div> </div>
            <div className="space-y-4">
              {regulatoryRequirements.filter(r => !filterAuthority || r.authority === filterAuthority).map(req => (
                <div key={req.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:border-blue-300 transition-all">
                  <div className="bg-gradient-to-r from-slate-50 to-slate-100 px-6 py-4 border-b border-slate-200">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${req.criticality === 'Critical' ? 'bg-red-100 text-red-600' :
                          req.criticality === 'High' ? 'bg-orange-100 text-orange-600' : 'bg-blue-100 text-blue-600'
                          }`}>
                          <FileText className="w-6 h-6" />
                        </div>
                        <div>
                          <div className="flex items-center gap-2">
                            <span className="text-xs font-mono bg-slate-200 px-2 py-1 rounded">{req.code}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${req.complianceStatus === 'Compliant' ? 'bg-emerald-100 text-emerald-700' :
                              req.complianceStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                              }`}>
                              {req.complianceStatus === 'Compliant' ? 'Ù…Ù„ØªØ²Ù…' : req.complianceStatus === 'Partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…'}
                            </span> </div>
                          <h4 className="font-bold text-slate-800 mt-1">{req.titleAr}</h4>
                          <p className="text-sm text-slate-500">{req.titleEn}</p>
                        </div> </div>
                      <div className="flex items-center gap-2">
                        <span className="text-xs text-slate-500">{req.authority}</span>
                        <button onClick={() => { setSelectedRequirement(req); setShowRequirementModal(true); }}
                          className="px-4 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold hover:bg-blue-600">
                          Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button> </div> </div> </div>
                  <div className="p-6 space-y-4">
                    <div className="flex items-center gap-6 text-sm">
                      <span className="text-slate-500"><strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> {req.articleNumber}</span>
                      <span className="text-slate-500"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†:</strong> {req.effectiveDate}</span>
                      <span className="text-slate-500"><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> {req.lastUpdated}</span>
                    </div>

                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                      <p className="text-sm text-slate-700 leading-relaxed line-clamp-3">{req.fullTextAr}</p>
                    </div>

                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                      <h5 className="font-bold text-amber-800 text-sm mb-2 flex items-center gap-2">
                        <AlertCircle className="w-4 h-4" />Ø¥Ø±Ø´Ø§Ø¯Ø§Øª ØªÙØ³ÙŠØ±ÙŠØ©
                      </h5>
                      <ul className="text-sm text-amber-700 space-y-1">
                        {req.guidanceNotes.slice(0, 2).map((note, idx) => (
                          <li key={idx} className="flex items-start gap-2">
                            <span className="text-amber-500">â€¢</span>{note}
                          </li>
                        ))}
                        {req.guidanceNotes.length > 2 && (
                          <li className="text-amber-600 font-bold">+{req.guidanceNotes.length - 2} Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰...</li>
                        )}
                      </ul>
                    </div>

                    <div className="flex items-center gap-3">
                      <span className="text-sm font-bold text-slate-600">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø±Ø³Ù…ÙŠØ©:</span>
                      {req.officialDocuments.map((doc, idx) => (
                        <a key={idx} href={doc.url} target="_blank" rel="noopener noreferrer"
                          className="flex items-center gap-1 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-lg text-xs font-bold hover:bg-emerald-100">
                          <ExternalLink className="w-3 h-3" />{doc.name}
                        </a>
                      ))}
                    </div>

                    <div className="flex items-center gap-4">
                      <span className="text-sm font-bold text-slate-600">Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª:</span>
                      {req.versionHistory.slice(0, 2).map((ver, idx) => (
                        <span key={idx} className="text-xs bg-slate-100 px-2 py-1 rounded">
                          v{ver.version} ({ver.date})
                        </span>
                      ))}
                    </div> </div> </div>
              ))}
            </div> </div>
        )}

        {activeTab === 'gapanalysis' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h3 className="font-bold text-slate-800 text-xl flex items-center gap-2">
                <Target className="w-6 h-6 text-red-500" />
                ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª - Gap Analysis
              </h3>
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-48 pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl text-sm focus:border-red-400 focus:outline-none" />
                </div>
                <select value={gapAnalysisFramework} onChange={(e) => setGapAnalysisFramework(e.target.value)} className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø·Ø±</option>
                  <option value="SAMA-CSF">SAMA-CSF</option>
                  <option value="SAMA-AML">SAMA-AML</option>
                  <option value="NCA-ECC">NCA-ECC</option>
                  <option value="SDAIA-PDPL">SDAIA-PDPL</option>
                </select>
                <select className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                  <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                </select>
                <button className="px-4 py-2 bg-slate-100 text-slate-700 rounded-xl text-sm font-bold hover:bg-slate-200 flex items-center gap-2">
                  <Download className="w-4 h-4" />ØªØµØ¯ÙŠØ±
                </button>
                <button onClick={openAddGap} className="px-4 py-2 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl text-sm font-bold hover:from-red-600 hover:to-rose-700 flex items-center gap-2 shadow-lg">
                  <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© ÙØ¬ÙˆØ©
                </button> </div> </div>
            <div className="grid grid-cols-6 gap-4">
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-emerald-100 text-sm font-bold">Ù…Ù„ØªØ²Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                    <p className="text-4xl font-black mt-1">{gapAnalysisData.filter(g => g.currentStatus === 'Compliant').length}</p>
                  </div>
                  <CheckCircle2 className="w-12 h-12 text-emerald-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-amber-100 text-sm font-bold">Ø§Ù…ØªØ«Ø§Ù„ Ø¬Ø²Ø¦ÙŠ</p>
                    <p className="text-4xl font-black mt-1">{gapAnalysisData.filter(g => g.currentStatus === 'Partial').length}</p>
                  </div>
                  <AlertCircle className="w-12 h-12 text-amber-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-red-100 text-sm font-bold">ØºÙŠØ± Ù…Ù„ØªØ²Ù…</p>
                    <p className="text-4xl font-black mt-1">{gapAnalysisData.filter(g => g.currentStatus === 'Non-Compliant').length}</p>
                  </div>
                  <XCircle className="w-12 h-12 text-red-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-blue-100 text-sm font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</p>
                    <p className="text-2xl font-black mt-1">{(gapAnalysisData.reduce((sum, g) => sum + g.estimatedCost, 0) / 1000000).toFixed(1)}M</p>
                  </div>
                  <Wallet className="w-12 h-12 text-blue-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-purple-100 text-sm font-bold">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…</p>
                    <p className="text-4xl font-black mt-1">{Math.round(gapAnalysisData.reduce((sum, g) => sum + (g.progress || 0), 0) / gapAnalysisData.length)}%</p>
                  </div>
                  <Activity className="w-12 h-12 text-purple-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-slate-600 to-slate-800 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-300 text-sm font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ¬ÙˆØ§Øª</p>
                    <p className="text-4xl font-black mt-1">{gapAnalysisData.length}</p>
                  </div>
                  <Target className="w-12 h-12 text-slate-400 opacity-80" />
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
              <h4 className="font-bold text-slate-800 mb-4">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø¯Ù…</h4>
              <div className="grid grid-cols-5 gap-3">
                {gapAnalysisData.filter(g => !gapAnalysisFramework || g.framework === gapAnalysisFramework).map(gap => (
                  <div key={gap.id} className="bg-slate-50 rounded-xl p-3">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-xs font-mono text-slate-500">{gap.requirement}</span>
                      <span className={`text-xs font-bold px-2 py-0.5 rounded ${gap.currentStatus === 'Compliant' ? 'bg-emerald-100 text-emerald-700' :
                        gap.currentStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                        }`}>{gap.progress || 0}%</span>
                    </div>
                    <div className="w-full bg-slate-200 rounded-full h-2">
                      <div className={`h-2 rounded-full transition-all ${gap.currentStatus === 'Compliant' ? 'bg-emerald-500' :
                        gap.currentStatus === 'Partial' ? 'bg-amber-500' : 'bg-red-500'
                        }`} style={{ width: `${gap.progress || 0}%` }}></div>
                    </div>
                    <p className="text-xs text-slate-600 mt-1 line-clamp-1">{gap.requirementTitle}</p>
                  </div>
                ))}
              </div> </div>
            <div className="space-y-4">
              {gapAnalysisData.filter(g => !gapAnalysisFramework || g.framework === gapAnalysisFramework).map(gap => (
                <div key={gap.id} className={`bg-white rounded-2xl border-2 overflow-hidden transition-all hover:shadow-lg ${gap.gapLevel === 'High' ? 'border-red-200 hover:border-red-400' :
                  gap.gapLevel === 'Medium' ? 'border-amber-200 hover:border-amber-400' :
                    gap.gapLevel === 'None' ? 'border-emerald-200 hover:border-emerald-400' : 'border-slate-200 hover:border-slate-400'
                  }`}>
                  <div className={`px-6 py-4 ${gap.gapLevel === 'High' ? 'bg-gradient-to-r from-red-50 to-rose-50' :
                    gap.gapLevel === 'Medium' ? 'bg-gradient-to-r from-amber-50 to-orange-50' :
                      gap.gapLevel === 'None' ? 'bg-gradient-to-r from-emerald-50 to-teal-50' : 'bg-gradient-to-r from-slate-50 to-gray-50'
                    }`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-xl flex items-center justify-center shadow-lg ${gap.gapLevel === 'High' ? 'bg-gradient-to-br from-red-500 to-rose-600 text-white' :
                          gap.gapLevel === 'Medium' ? 'bg-gradient-to-br from-amber-500 to-orange-600 text-white' :
                            gap.gapLevel === 'None' ? 'bg-gradient-to-br from-emerald-500 to-teal-600 text-white' : 'bg-gradient-to-br from-slate-500 to-gray-600 text-white'
                          }`}>
                          <Target className="w-7 h-7" />
                        </div>
                        <div>
                          <div className="flex items-center gap-2 flex-wrap">
                            <span className="text-xs font-mono bg-white px-2 py-1 rounded border shadow-sm">{gap.id}</span>
                            <span className="text-xs font-mono bg-slate-200 px-2 py-1 rounded">{gap.requirement}</span>
                            <span className="text-xs font-bold bg-purple-100 text-purple-700 px-2 py-1 rounded">{gap.framework}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${gap.priority === 'Critical' ? 'bg-red-500 text-white' :
                              gap.priority === 'High' ? 'bg-orange-500 text-white' :
                                gap.priority === 'Medium' ? 'bg-blue-500 text-white' : 'bg-slate-500 text-white'
                              }`}>{gap.priority === 'Critical' ? 'Ø­Ø±Ø¬' : gap.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : gap.priority === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${gap.currentStatus === 'Compliant' ? 'bg-emerald-500 text-white' :
                              gap.currentStatus === 'Partial' ? 'bg-amber-500 text-white' : 'bg-red-500 text-white'
                              }`}>{gap.currentStatus === 'Compliant' ? 'Ù…Ù„ØªØ²Ù…' : gap.currentStatus === 'Partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…'}</span>
                          </div>
                          <h4 className="font-bold text-slate-800 text-lg mt-2">{gap.requirementTitle}</h4>
                          {gap.requirementTitleEn && <p className="text-sm text-slate-500">{gap.requirementTitleEn}</p>}
                        </div> </div>
                      <div className="flex items-center gap-4">
                        <div className="relative">
                          <svg className="w-16 h-16 transform -rotate-90">
                            <circle cx="32" cy="32" r="28" stroke="#e2e8f0" strokeWidth="6" fill="none" />
                            <circle cx="32" cy="32" r="28" stroke={gap.currentStatus === 'Compliant' ? '#10b981' : gap.currentStatus === 'Partial' ? '#f59e0b' : '#ef4444'}
                              strokeWidth="6" fill="none" strokeLinecap="round"
                              strokeDasharray={`${(gap.progress || 0) * 1.76} 176`} />
                          </svg>
                          <span className="absolute inset-0 flex items-center justify-center text-sm font-bold">{gap.progress || 0}%</span>
                        </div>
                        <div className="flex flex-col gap-2">
                          <button onClick={() => openViewGap(gap)} className="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <Eye className="w-4 h-4" />
                          </button>
                          <button onClick={() => openEditGap(gap)} className="p-2 bg-amber-100 text-amber-600 rounded-lg hover:bg-amber-200" title="ØªØ¹Ø¯ÙŠÙ„">
                            <Edit className="w-4 h-4" />
                          </button>
                          <button onClick={() => openDeleteGap(gap)} className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200" title="Ø­Ø°Ù">
                            <Trash2 className="w-4 h-4" />
                          </button> </div> </div> </div> </div>
                  <div className="p-6 space-y-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm font-bold text-slate-600 mb-1">ÙˆØµÙ Ø§Ù„ÙØ¬ÙˆØ©:</p>
                      <p className="text-slate-700">{gap.gapDescription}</p>
                    </div>

                    <div className="grid grid-cols-3 gap-4">
                      <div className={`rounded-xl p-4 border ${gap.currentStatus === 'Compliant' ? 'bg-emerald-50 border-emerald-200' :
                        gap.currentStatus === 'Partial' ? 'bg-amber-50 border-amber-200' : 'bg-red-50 border-red-200'
                        }`}>
                        <p className="text-xs font-bold mb-2">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <div className="flex items-center gap-3">
                          <div className="flex-1 bg-white rounded-full h-3">
                            <div className={`h-3 rounded-full ${gap.currentStatus === 'Compliant' ? 'bg-emerald-500' :
                              gap.currentStatus === 'Partial' ? 'bg-amber-500' : 'bg-red-500'
                              }`} style={{ width: `${gap.currentMaturity * 20}%` }}></div>
                          </div>
                          <span className="font-bold">{gap.currentMaturity}/5</span>
                        </div> </div>
                      <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                        <p className="text-xs text-emerald-600 font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</p>
                        <div className="flex items-center gap-3">
                          <div className="flex-1 bg-emerald-200 rounded-full h-3">
                            <div className="bg-emerald-500 h-3 rounded-full" style={{ width: `${gap.targetMaturity * 20}%` }}></div>
                          </div>
                          <span className="font-bold text-emerald-700">{gap.targetMaturity}/5</span>
                        </div> </div>
                      <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                        <p className="text-xs text-blue-600 font-bold mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
                        <div className="flex items-center gap-3">
                          <div className="flex-1 bg-blue-200 rounded-full h-3">
                            <div className="bg-blue-500 h-3 rounded-full" style={{ width: `${gap.progress || 0}%` }}></div>
                          </div>
                          <span className="font-bold text-blue-700">{gap.progress || 0}%</span>
                        </div> </div> </div>
                    {gap.remediationSteps && gap.remediationSteps.length > 0 && (
                      <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                        <p className="text-xs text-blue-600 font-bold mb-3">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</p>
                        <div className="grid grid-cols-2 gap-2">
                          {gap.remediationSteps.map((step, idx) => (
                            <div key={idx} className="flex items-center gap-2 bg-white rounded-lg p-2">
                              <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${idx < Math.ceil((gap.progress || 0) / 25) ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-600'
                                }`}>{idx + 1}</span>
                              <span className="text-sm text-slate-700">{step}</span>
                            </div>
                          ))}
                        </div> </div>
                    )}

                    <div className="flex items-center justify-between flex-wrap gap-4 pt-4 border-t border-slate-200">
                      <div className="flex items-center gap-6 text-sm">
                        <span className="flex items-center gap-2 text-slate-600">
                          <DollarSign className="w-4 h-4 text-blue-500" />
                          <strong>Ø§Ù„ØªÙƒÙ„ÙØ©:</strong> {gap.estimatedCost?.toLocaleString()} Ø±ÙŠØ§Ù„
                        </span>
                        <span className="flex items-center gap-2 text-slate-600">
                          <Clock className="w-4 h-4 text-purple-500" />
                          <strong>Ø§Ù„Ø¬Ù‡Ø¯:</strong> {gap.estimatedEffort}
                        </span>
                        <span className="flex items-center gap-2 text-slate-600">
                          <User className="w-4 h-4 text-emerald-500" />
                          <strong>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> {gap.owner}
                        </span> </div>
                      <div className="flex items-center gap-4">
                        {gap.dueDate && (
                          <span className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-bold ${new Date(gap.dueDate) < new Date() ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-700'
                            }`}>
                            <Calendar className="w-4 h-4" />
                            {gap.dueDate}
                          </span>
                        )}
                        <button onClick={() => openViewGap(gap)} className="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 flex items-center gap-2">
                          <Eye className="w-4 h-4" />Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button> </div> </div> </div> </div>
              ))}
            </div>

            {gapAnalysisData.filter(g => !gapAnalysisFramework || g.framework === gapAnalysisFramework).length === 0 && (
              <div className="text-center py-12 bg-slate-50 rounded-2xl">
                <Target className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                <p className="text-slate-500 text-lg mb-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                <button onClick={openAddGap} className="px-6 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                  <Plus className="w-5 h-5 inline ml-2" />Ø¥Ø¶Ø§ÙØ© ÙØ¬ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©
                </button> </div>
            )}
          </div>
        )}

        {activeTab === 'crossmapping' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <GitBranch className="w-5 h-5 text-purple-500" />
                Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© - Cross-Framework Mapping
              </h3>
              <button className="px-4 py-2 bg-purple-500 text-white rounded-xl text-sm font-bold hover:bg-purple-600 flex items-center gap-2">
                <Download className="w-4 h-4" />ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØµÙÙˆÙØ©
              </button> </div>
            <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-200">
              <div className="flex items-center gap-3">
                <Info className="w-6 h-6 text-purple-600" />
                <p className="text-purple-800">
                  <strong>Ø±Ø¨Ø· Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</strong> ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ø²Ø¯ÙˆØ§Ø¬ÙŠØ© ÙÙŠ Ø¬Ù‡ÙˆØ¯ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© Ø¹Ø¨Ø± Ø§Ù„Ø£Ø·Ø± Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                </p> </div> </div>
            <div className="space-y-6">
              {crossFrameworkMappings.map(mapping => (
                <div key={mapping.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className="bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4">
                    <h4 className="font-bold text-white text-lg">{mapping.category}</h4>
                    <p className="text-purple-200 text-sm">{mapping.categoryEn}</p>
                  </div>

                  <div className="p-6">
                    <div className="grid grid-cols-4 gap-4 mb-6">
                      {mapping.mappings.map((m, idx) => (
                        <div key={idx} className="bg-slate-50 rounded-xl p-4 border border-slate-200 hover:border-purple-300 transition-all">
                          <div className="flex items-center gap-2 mb-2">
                            <span className="text-xs font-bold bg-purple-100 text-purple-700 px-2 py-1 rounded">{m.framework}</span>
                          </div>
                          <p className="text-xs font-mono text-slate-500 mb-1">{m.code}</p>
                          <p className="text-sm font-bold text-slate-700">{m.requirement}</p>
                        </div>
                      ))}
                    </div>

                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <h5 className="font-bold text-emerald-800 text-sm mb-3 flex items-center gap-2">
                        <Shield className="w-4 h-4" />Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
                      </h5>
                      <div className="flex flex-wrap gap-2">
                        {mapping.commonControls.map((control, idx) => (
                          <span key={idx} className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold">
                            {control}
                          </span>
                        ))}
                      </div> </div> </div> </div>
              ))}
            </div> </div>
        )}

        {activeTab === 'changetracker' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                <History className="w-5 h-5 text-orange-500" />
                ØªØªØ¨Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© - Regulatory Change Tracker
              </h3>
              <div className="flex items-center gap-3">
                <button className="px-4 py-2 bg-orange-500 text-white rounded-xl text-sm font-bold hover:bg-orange-600 flex items-center gap-2">
                  <Bell className="w-4 h-4" />Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                </button> </div> </div>
            <div className="space-y-4">
              {regulatoryChanges.map((change, idx) => (
                <div key={change.id} className={`bg-white rounded-2xl border-2 overflow-hidden ${change.status === 'Active' ? 'border-emerald-300' : change.status === 'Upcoming' ? 'border-amber-300' : 'border-slate-200'
                  }`}>
                  <div className={`px-6 py-4 ${change.status === 'Active' ? 'bg-emerald-50' : change.status === 'Upcoming' ? 'bg-amber-50' : 'bg-slate-50'
                    }`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-xl flex items-center justify-center ${change.impactLevel === 'Critical' ? 'bg-red-200 text-red-700' :
                          change.impactLevel === 'High' ? 'bg-orange-200 text-orange-700' : 'bg-blue-200 text-blue-700'
                          }`}>
                          <AlertTriangle className="w-7 h-7" />
                        </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className="text-xs font-bold bg-purple-100 text-purple-700 px-2 py-1 rounded">{change.authority}</span>
                            <span className="text-xs font-bold bg-blue-100 text-blue-700 px-2 py-1 rounded">{change.framework}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${change.changeType === 'New Requirement' ? 'bg-red-500 text-white' :
                              change.changeType === 'Amendment' ? 'bg-amber-500 text-white' : 'bg-blue-500 text-white'
                              }`}>{change.changeType}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${change.status === 'Active' ? 'bg-emerald-500 text-white' : 'bg-amber-500 text-white'
                              }`}>{change.status === 'Active' ? 'Ø³Ø§Ø±ÙŠ' : 'Ù‚Ø§Ø¯Ù…'}</span>
                          </div>
                          <h4 className="font-bold text-slate-800">{change.title}</h4>
                          <p className="text-sm text-slate-500">{change.titleEn}</p>
                        </div> </div>
                      <div className="text-left">
                        <p className="text-xs text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                        <p className="font-bold text-slate-800 text-lg">{change.effectiveDate}</p>
                        <p className="text-xs text-orange-600">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­: {change.gracePeriod}</p>
                      </div> </div> </div>
                  <div className="p-6 space-y-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-slate-700">{change.description}</p>
                    </div>

                    <div className="flex items-center gap-2 flex-wrap">
                      <span className="text-sm font-bold text-slate-600">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</span>
                      {change.affectedRequirements.map((req, i) => (
                        <span key={i} className="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-mono">{req}</span>
                      ))}
                    </div>

                    <div className="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-4 border border-orange-200">
                      <h5 className="font-bold text-orange-800 text-sm mb-3 flex items-center gap-2">
                        <AlertTriangle className="w-4 h-4" />ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø±
                      </h5>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                          <p className="text-orange-600 font-bold">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</p>
                          <ul className="text-slate-700 mt-1">
                            {change.impactAssessment.systems.map((s, i) => <li key={i}>â€¢ {s}</li>)}
                          </ul>
                        </div>
                        <div>
                          <p className="text-orange-600 font-bold">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</p>
                          <ul className="text-slate-700 mt-1">
                            {change.impactAssessment.processes.map((p, i) => <li key={i}>â€¢ {p}</li>)}
                          </ul>
                        </div>
                        <div>
                          <p className="text-orange-600 font-bold">Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</p>
                          <ul className="text-slate-700 mt-1">
                            {change.impactAssessment.training.map((t, i) => <li key={i}>â€¢ {t}</li>)}
                          </ul>
                        </div>
                        <div>
                          <p className="text-orange-600 font-bold">Ø§Ù„ØªÙƒÙ„ÙØ© ÙˆØ§Ù„Ø¬Ù‡Ø¯:</p>
                          <p className="text-slate-700 mt-1">{change.impactAssessment.estimatedCost}</p>
                          <p className="text-slate-700">{change.impactAssessment.estimatedEffort}</p>
                        </div> </div> </div>
                    <a href={change.documentUrl} target="_blank" rel="noopener noreferrer"
                      className="flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl text-sm font-bold hover:bg-blue-100 w-fit">
                      <ExternalLink className="w-4 h-4" />Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©
                    </a>
                  </div> </div>
              ))}
            </div> </div>
        )}

        {activeTab === 'impact' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h3 className="font-bold text-slate-800 text-xl flex items-center gap-2">
                <AlertTriangle className="w-6 h-6 text-red-500" />
                ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ - Impact Assessment
              </h3>
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                  <input type="text" placeholder="Ø¨Ø­Ø«..." className="w-48 pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl text-sm focus:border-orange-400 focus:outline-none" />
                </div>
                <select className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
                  <option value="SAMA">SAMA</option>
                  <option value="NCA">NCA</option>
                  <option value="SDAIA">SDAIA</option>
                </select>
                <select className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="Active">Ù†Ø´Ø·</option>
                  <option value="Upcoming">Ù‚Ø§Ø¯Ù…</option>
                </select>
                <button className="px-4 py-2 bg-slate-100 text-slate-700 rounded-xl text-sm font-bold hover:bg-slate-200 flex items-center gap-2">
                  <Download className="w-4 h-4" />ØªØµØ¯ÙŠØ±
                </button>
                <button onClick={openAddImpact} className="px-4 py-2 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl text-sm font-bold hover:from-orange-600 hover:to-red-700 flex items-center gap-2 shadow-lg">
                  <Plus className="w-4 h-4" />ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯
                </button> </div> </div>
            <div className="grid grid-cols-6 gap-4">
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-red-100 text-sm font-bold">ØªØºÙŠÙŠØ±Ø§Øª Ø­Ø±Ø¬Ø©</p>
                    <p className="text-4xl font-black mt-1">{regulatoryChanges.filter(c => c.impactLevel === 'Critical').length}</p>
                  </div>
                  <AlertTriangle className="w-12 h-12 text-red-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-orange-500 to-amber-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-orange-100 text-sm font-bold">ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ø§Ù„ÙŠØ©</p>
                    <p className="text-4xl font-black mt-1">{regulatoryChanges.filter(c => c.impactLevel === 'High').length}</p>
                  </div>
                  <AlertCircle className="w-12 h-12 text-orange-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-blue-100 text-sm font-bold">ØªØºÙŠÙŠØ±Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</p>
                    <p className="text-4xl font-black mt-1">{regulatoryChanges.filter(c => c.status === 'Upcoming').length}</p>
                  </div>
                  <Clock className="w-12 h-12 text-blue-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-emerald-100 text-sm font-bold">ØªØºÙŠÙŠØ±Ø§Øª Ù†Ø´Ø·Ø©</p>
                    <p className="text-4xl font-black mt-1">{regulatoryChanges.filter(c => c.status === 'Active').length}</p>
                  </div>
                  <CheckCircle2 className="w-12 h-12 text-emerald-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-purple-100 text-sm font-bold">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…</p>
                    <p className="text-4xl font-black mt-1">{Math.round(regulatoryChanges.reduce((sum, c) => sum + (c.progress || 0), 0) / regulatoryChanges.length)}%</p>
                  </div>
                  <Activity className="w-12 h-12 text-purple-200 opacity-80" />
                </div> </div>
              <div className="bg-gradient-to-br from-cyan-500 to-sky-600 rounded-2xl p-4 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-cyan-100 text-sm font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</p>
                    <p className="text-2xl font-black mt-1">{(regulatoryChanges.reduce((sum, c) => sum + (c.impactAssessment?.estimatedCost || 0), 0) / 1000000).toFixed(1)}M</p>
                  </div>
                  <Wallet className="w-12 h-12 text-cyan-200 opacity-80" />
                </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-100 to-slate-50 px-6 py-4 border-b border-slate-200 flex items-center justify-between">
                <h4 className="font-bold text-slate-800 flex items-center gap-2">
                  <Building className="w-5 h-5 text-purple-500" />
                  Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø«Ø± Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                </h4>
              </div>
              <div className="p-6">
                <div className="grid grid-cols-3 gap-4">
                  {['SAMA', 'NCA', 'SDAIA'].map(auth => {
                    const authChanges = regulatoryChanges.filter(c => c.authority === auth);
                    const criticalCount = authChanges.filter(c => c.impactLevel === 'Critical').length;
                    const highCount = authChanges.filter(c => c.impactLevel === 'High').length;
                    const totalCost = authChanges.reduce((sum, c) => sum + (c.impactAssessment?.estimatedCost || 0), 0);
                    const avgProgress = authChanges.length > 0 ? Math.round(authChanges.reduce((sum, c) => sum + (c.progress || 0), 0) / authChanges.length) : 0;
                    return (
                      <div key={auth} className="bg-gradient-to-br from-slate-50 to-white rounded-xl p-5 border-2 border-slate-200 hover:border-purple-300 transition-all">
                        <div className="flex items-center gap-4 mb-4">
                          <div className="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg">
                            <Building className="w-7 h-7 text-white" />
                          </div>
                          <div>
                            <p className="font-bold text-slate-800 text-lg">{authorities.find(a => a.code === auth)?.name}</p>
                            <p className="text-sm text-slate-500">{auth} â€¢ {authChanges.length} ØªØºÙŠÙŠØ±Ø§Øª</p>
                          </div> </div>
                        <div className="grid grid-cols-4 gap-2 mb-4">
                          <div className="text-center p-2 bg-red-50 rounded-lg">
                            <p className="text-xl font-black text-red-600">{criticalCount}</p>
                            <p className="text-xs text-red-500">Ø­Ø±Ø¬</p>
                          </div>
                          <div className="text-center p-2 bg-orange-50 rounded-lg">
                            <p className="text-xl font-black text-orange-600">{highCount}</p>
                            <p className="text-xs text-orange-500">Ø¹Ø§Ù„ÙŠ</p>
                          </div>
                          <div className="text-center p-2 bg-blue-50 rounded-lg">
                            <p className="text-xl font-black text-blue-600">{authChanges.length - criticalCount - highCount}</p>
                            <p className="text-xs text-blue-500">Ù…ØªÙˆØ³Ø·</p>
                          </div>
                          <div className="text-center p-2 bg-emerald-50 rounded-lg">
                            <p className="text-xl font-black text-emerald-600">{avgProgress}%</p>
                            <p className="text-xs text-emerald-500">ØªÙ‚Ø¯Ù…</p>
                          </div> </div>
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-slate-500">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©:</span>
                          <span className="font-bold text-purple-600">{(totalCost / 1000000).toFixed(1)}M Ø±ÙŠØ§Ù„</span>
                        </div>
                        <div className="mt-2 bg-slate-200 rounded-full h-2">
                          <div className="bg-purple-500 h-2 rounded-full" style={{ width: `${avgProgress}%` }}></div>
                        </div> </div>);
                  })}
                </div> </div> </div>
            <div className="space-y-4">
              <h4 className="font-bold text-slate-800 flex items-center gap-2">
                <FileText className="w-5 h-5 text-orange-500" />
                Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ({regulatoryChanges.length})
              </h4>
              {regulatoryChanges.sort((a, b) => new Date(a.effectiveDate) - new Date(b.effectiveDate)).map(change => (
                <div key={change.id} className={`bg-white rounded-2xl border-2 overflow-hidden transition-all hover:shadow-lg ${change.impactLevel === 'Critical' ? 'border-red-200 hover:border-red-400' :
                  change.impactLevel === 'High' ? 'border-orange-200 hover:border-orange-400' : 'border-blue-200 hover:border-blue-400'
                  }`}>
                  <div className={`px-6 py-4 ${change.impactLevel === 'Critical' ? 'bg-gradient-to-r from-red-50 to-rose-50' :
                    change.impactLevel === 'High' ? 'bg-gradient-to-r from-orange-50 to-amber-50' : 'bg-gradient-to-r from-blue-50 to-indigo-50'
                    }`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className={`w-14 h-14 rounded-xl flex items-center justify-center shadow-lg ${change.impactLevel === 'Critical' ? 'bg-gradient-to-br from-red-500 to-rose-600 text-white' :
                          change.impactLevel === 'High' ? 'bg-gradient-to-br from-orange-500 to-amber-600 text-white' : 'bg-gradient-to-br from-blue-500 to-indigo-600 text-white'
                          }`}>
                          {change.changeType === 'New Requirement' ? <FilePlus className="w-7 h-7" /> : <FileText className="w-7 h-7" />}
                        </div>
                        <div>
                          <div className="flex items-center gap-2 flex-wrap mb-1">
                            <span className="text-xs font-mono bg-white px-2 py-1 rounded border shadow-sm">{change.id}</span>
                            <span className="text-xs font-bold bg-purple-100 text-purple-700 px-2 py-1 rounded">{change.authority}</span>
                            <span className="text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded">{change.framework}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${change.changeType === 'New Requirement' ? 'bg-emerald-500 text-white' : 'bg-blue-500 text-white'
                              }`}>{change.changeType === 'New Requirement' ? 'Ù…ØªØ·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯' : 'ØªØ¹Ø¯ÙŠÙ„'}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${change.impactLevel === 'Critical' ? 'bg-red-500 text-white' :
                              change.impactLevel === 'High' ? 'bg-orange-500 text-white' : 'bg-blue-500 text-white'
                              }`}>{change.impactLevel === 'Critical' ? 'Ø­Ø±Ø¬' : change.impactLevel === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</span>
                            <span className={`text-xs px-2 py-1 rounded font-bold ${change.status === 'Active' ? 'bg-emerald-500 text-white' : 'bg-amber-500 text-white'
                              }`}>{change.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù‚Ø§Ø¯Ù…'}</span>
                          </div>
                          <h4 className="font-bold text-slate-800 text-lg">{change.title}</h4>
                          <p className="text-sm text-slate-500">{change.titleEn}</p>
                        </div> </div>
                      <div className="flex items-center gap-4">
                        <div className="relative">
                          <svg className="w-16 h-16 transform -rotate-90">
                            <circle cx="32" cy="32" r="28" stroke="#e2e8f0" strokeWidth="6" fill="none" />
                            <circle cx="32" cy="32" r="28"
                              stroke={change.impactLevel === 'Critical' ? '#ef4444' : change.impactLevel === 'High' ? '#f59e0b' : '#3b82f6'}
                              strokeWidth="6" fill="none" strokeLinecap="round"
                              strokeDasharray={`${(change.progress || 0) * 1.76} 176`} />
                          </svg>
                          <span className="absolute inset-0 flex items-center justify-center text-sm font-bold">{change.progress || 0}%</span>
                        </div>
                        <div className="flex flex-col gap-2">
                          <button onClick={() => openViewImpact(change)} className="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200" title="Ø¹Ø±Ø¶">
                            <Eye className="w-4 h-4" />
                          </button>
                          <button onClick={() => openEditImpact(change)} className="p-2 bg-amber-100 text-amber-600 rounded-lg hover:bg-amber-200" title="ØªØ¹Ø¯ÙŠÙ„">
                            <Edit className="w-4 h-4" />
                          </button>
                          <button onClick={() => openDeleteImpact(change)} className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200" title="Ø­Ø°Ù">
                            <Trash2 className="w-4 h-4" />
                          </button> </div> </div> </div> </div>
                  <div className="p-6 space-y-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-slate-700">{change.description}</p>
                    </div>

                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-blue-50 rounded-xl p-3 border border-blue-200">
                        <p className="text-xs text-blue-600 font-bold mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</p>
                        <p className="font-bold text-blue-800">{change.publishDate}</p>
                      </div>
                      <div className={`rounded-xl p-3 border ${new Date(change.effectiveDate) < new Date() ? 'bg-emerald-50 border-emerald-200' : 'bg-orange-50 border-orange-200'
                        }`}>
                        <p className={`text-xs font-bold mb-1 ${new Date(change.effectiveDate) < new Date() ? 'text-emerald-600' : 'text-orange-600'}`}>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                        <p className={`font-bold ${new Date(change.effectiveDate) < new Date() ? 'text-emerald-800' : 'text-orange-800'}`}>{change.effectiveDate}</p>
                      </div>
                      <div className="bg-purple-50 rounded-xl p-3 border border-purple-200">
                        <p className="text-xs text-purple-600 font-bold mb-1">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­</p>
                        <p className="font-bold text-purple-800">{change.gracePeriod}</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-3 border border-slate-200">
                        <p className="text-xs text-slate-600 font-bold mb-1">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                        <p className="font-bold text-slate-800">{change.affectedRequirements?.length || 0} Ù…ØªØ·Ù„Ø¨</p>
                      </div> </div>
                    {change.actionPlan && change.actionPlan.length > 0 && (
                      <div className="bg-gradient-to-r from-slate-50 to-white rounded-xl p-4 border border-slate-200">
                        <p className="text-sm font-bold text-slate-700 mb-3">Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„:</p>
                        <div className="grid grid-cols-2 gap-2">
                          {change.actionPlan.map((step, idx) => (
                            <div key={idx} className={`flex items-center gap-2 p-2 rounded-lg ${step.status === 'Completed' ? 'bg-emerald-50 border border-emerald-200' :
                              step.status === 'In Progress' ? 'bg-blue-50 border border-blue-200' : 'bg-slate-50 border border-slate-200'
                              }`}>
                              <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${step.status === 'Completed' ? 'bg-emerald-500 text-white' :
                                step.status === 'In Progress' ? 'bg-blue-500 text-white' : 'bg-slate-300 text-slate-600'
                                }`}>{idx + 1}</span>
                              <span className={`text-sm flex-1 ${step.status === 'Completed' ? 'line-through text-emerald-600' : 'text-slate-700'}`}>{step.step}</span>
                              {step.status === 'Completed' && <CheckCircle2 className="w-4 h-4 text-emerald-500" />}
                            </div>
                          ))}
                        </div> </div>
                    )}

                    <div className="grid grid-cols-3 gap-4">
                      <div className="bg-cyan-50 rounded-xl p-3 border border-cyan-200">
                        <p className="text-xs text-cyan-600 font-bold mb-1">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                        <p className="font-bold text-cyan-800">{change.impactAssessment?.systems?.length || 0} Ù†Ø¸Ø§Ù…</p>
                      </div>
                      <div className="bg-violet-50 rounded-xl p-3 border border-violet-200">
                        <p className="text-xs text-violet-600 font-bold mb-1">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</p>
                        <p className="font-bold text-violet-800">{((change.impactAssessment?.estimatedCost || 0) / 1000).toLocaleString()}K Ø±ÙŠØ§Ù„</p>
                      </div>
                      <div className="bg-rose-50 rounded-xl p-3 border border-rose-200">
                        <p className="text-xs text-rose-600 font-bold mb-1">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
                        <p className="font-bold text-rose-800">{change.impactAssessment?.estimatedEffort || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                      </div> </div>
                    <div className="flex items-center justify-between pt-4 border-t border-slate-200">
                      <div className="flex items-center gap-4 text-sm text-slate-600">
                        <span className="flex items-center gap-1"><User className="w-4 h-4" />{change.owner}</span>
                        <span className="flex items-center gap-1"><Calendar className="w-4 h-4" />Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {change.updatedAt}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        {change.documentUrl && (
                          <a href={change.documentUrl} target="_blank" rel="noopener noreferrer"
                            className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200 flex items-center gap-1">
                            <ExternalLink className="w-4 h-4" />Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                          </a>
                        )}
                        <button onClick={() => openViewImpact(change)} className="px-4 py-2 bg-orange-500 text-white rounded-lg text-sm font-bold hover:bg-orange-600 flex items-center gap-2">
                          <Eye className="w-4 h-4" />Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button> </div> </div> </div> </div>
              ))}
            </div>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-100 to-slate-50 px-6 py-4 border-b border-slate-200">
                <h4 className="font-bold text-slate-800 flex items-center gap-2">
                  <Clock className="w-5 h-5 text-blue-500" />
                  Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </h4>
              </div>
              <div className="p-6">
                <div className="relative">
                  <div className="absolute right-6 top-0 bottom-0 w-1 bg-gradient-to-b from-red-300 via-orange-300 to-emerald-300"></div>
                  <div className="space-y-4">
                    {regulatoryChanges.sort((a, b) => new Date(a.effectiveDate) - new Date(b.effectiveDate)).map((change, idx) => (
                      <div key={change.id} className="flex items-center gap-4 pr-10 relative group">
                        <div className={`absolute right-4 w-6 h-6 rounded-full border-4 z-10 transition-transform group-hover:scale-125 ${change.impactLevel === 'Critical' ? 'bg-red-500 border-red-200' :
                          change.impactLevel === 'High' ? 'bg-orange-500 border-orange-200' : 'bg-blue-500 border-blue-200'
                          }`}></div>
                        <div className={`flex-1 p-4 rounded-xl transition-all group-hover:shadow-md ${change.status === 'Active' ? 'bg-emerald-50 border border-emerald-200' : 'bg-slate-50 border border-slate-200'
                          }`}>
                          <div className="flex items-center justify-between">
                            <div>
                              <p className="font-bold text-slate-800">{change.title}</p>
                              <div className="flex items-center gap-2 mt-1">
                                <span className="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded">{change.authority}</span>
                                <span className={`text-xs px-2 py-0.5 rounded ${change.impactLevel === 'Critical' ? 'bg-red-100 text-red-700' :
                                  change.impactLevel === 'High' ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700'
                                  }`}>{change.impactLevel}</span>
                              </div> </div>
                            <div className="text-left">
                              <p className="font-bold text-slate-800">{change.effectiveDate}</p>
                              <p className="text-xs text-slate-500">{change.progress || 0}% Ù…ÙƒØªÙ…Ù„</p>
                            </div> </div> </div> </div>
                    ))}
                  </div> </div> </div> </div> </div>
        )}

        {activeTab === 'analytics' && (
          <div className="p-6 space-y-6">
            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
              <BarChart3 className="w-5 h-5 text-purple-500" />ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
            </h3>

            <div className="grid grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
                <h4 className="font-bold mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„</h4>
                <p className="text-5xl font-black">{Math.round((stats.activatedCount / Math.max(stats.totalPrograms, 1)) * 100)}%</p>
                <p className="text-emerald-100 text-sm mt-2">{stats.activatedCount} Ù…Ù† {stats.totalPrograms}</p>
              </div>
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-5 text-white">
                <h4 className="font-bold mb-2">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</h4>
                <p className="text-5xl font-black">{Math.round(programs.reduce((sum, p) => sum + p.complianceRate, 0) / programs.length)}%</p>
                <p className="text-blue-100 text-sm mt-2">Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</p>
              </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-5 text-white">
                <h4 className="font-bold mb-2">Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø­Ø±Ø¬Ø©</h4>
                <p className="text-5xl font-black">{stats.criticalObligations}</p>
                <p className="text-red-100 text-sm mt-2">ØªØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Ù‹ ÙÙˆØ±ÙŠØ§Ù‹</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-5 text-white">
                <h4 className="font-bold mb-2">Ø¨Ø±Ø§Ù…Ø¬ Ø¯ÙˆÙ„ÙŠØ©</h4>
                <p className="text-5xl font-black">{stats.internationalPrograms}</p>
                <p className="text-purple-100 text-sm mt-2">ISO, PCI, SOC, GDPR</p>
              </div> </div>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <h4 className="font-bold text-slate-700 mb-4">ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø©</h4>
                <div className="space-y-3">
                  {authorities.slice(0, 8).map(auth => {
                    const oblCount = allObligations.filter(o => o.authority === auth.code).length;
                    return (
                      <div key={auth.code} className="flex items-center gap-3">
                        <span className="w-20 text-xs font-bold text-slate-600">{auth.code}</span>
                        <div className="flex-1 h-5 bg-slate-100 rounded-full overflow-hidden">
                          <div className="h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full" style={{ width: `${Math.min((oblCount / Math.max(allObligations.length, 1)) * 100 * 3, 100)}%` }}></div>
                        </div>
                        <span className="w-8 text-sm font-bold text-slate-700">{oblCount}</span>
                      </div>);
                  })}
                </div> </div>
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <h4 className="font-bold text-slate-700 mb-4">ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</h4>
                <div className="flex items-center justify-around py-4">
                  <div className="text-center">
                    <div className="w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-2">
                      <span className="text-2xl font-black text-red-600">{allObligations.filter(o => o.severity === 'Critical').length}</span>
                    </div>
                    <p className="text-sm font-bold text-slate-600">Ø­Ø±Ø¬</p>
                  </div>
                  <div className="text-center">
                    <div className="w-20 h-20 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-2">
                      <span className="text-2xl font-black text-amber-600">{allObligations.filter(o => o.severity === 'High').length}</span>
                    </div>
                    <p className="text-sm font-bold text-slate-600">Ø¹Ø§Ù„ÙŠ</p>
                  </div>
                  <div className="text-center">
                    <div className="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-2">
                      <span className="text-2xl font-black text-blue-600">{allObligations.filter(o => o.severity === 'Medium').length}</span>
                    </div>
                    <p className="text-sm font-bold text-slate-600">Ù…ØªÙˆØ³Ø·</p>
                  </div> </div> </div> </div> </div>
        )}
      </div>

      {showProgramModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center text-3xl">{programForm.icon || 'ğŸ“‹'}</div>
                  <div>
                    <h2 className="text-xl font-bold">{editMode ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="text-emerald-200 text-sm">{editMode ? 'Edit Regulatory Program' : 'Add New Regulatory Program'}</p>
                  </div> </div>
                <button onClick={() => { setShowProgramModal(false); setEditMode(false); resetProgramForm(); }} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex border-b border-slate-200 bg-slate-50 px-4 shrink-0 overflow-x-auto">
              {programModalTabs.map(tab => (
                <button key={tab.id} onClick={() => setProgramModalTab(tab.id)}
                  className={`flex items-center gap-2 px-4 py-3 text-sm font-bold whitespace-nowrap border-b-2 transition-all ${programModalTab === tab.id ? 'text-emerald-600 border-emerald-500 bg-white -mb-[1px]' : 'text-slate-500 border-transparent hover:text-emerald-500'
                    }`}>
                  <tab.icon className="w-4 h-4" />{tab.label}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-y-auto p-6">
              {programModalTab === 0 && (
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *</label>
                      <input type="text" value={programForm.name} onChange={(e) => setProgramForm(p => ({ ...p, name: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø¸Ø§Ù… Ø´Ù…ÙˆØ³ Ø§Ù„Ø£Ù…Ù†ÙŠ" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© *</label>
                      <input type="text" value={programForm.nameEn} onChange={(e) => setProgramForm(p => ({ ...p, nameEn: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" placeholder="Shomoos Security System" />
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label>
                      <input type="text" value={programForm.code} onChange={(e) => setProgramForm(p => ({ ...p, code: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none font-mono" placeholder="SA-MOI-SHOMOOS (ÙŠÙÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                      <input type="text" value={programForm.version} onChange={(e) => setProgramForm(p => ({ ...p, version: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" placeholder="2.0" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                    <textarea value={programForm.description} onChange={(e) => setProgramForm(p => ({ ...p, description: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none h-24 resize-none" placeholder="ÙˆØµÙ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡..." />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                    <textarea value={programForm.scope} onChange={(e) => setProgramForm(p => ({ ...p, scope: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none h-20 resize-none" placeholder="Ø§Ù„Ø¬Ù‡Ø§Øª ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø®Ø§Ø¶Ø¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬..." />
                  </div> </div>
              )}

              {programModalTab === 1 && (
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                      <select value={programForm.authority} onChange={(e) => {
                        const auth = authorities.find(a => a.code === e.target.value);
                        setProgramForm(p => ({ ...p, authority: e.target.value, authorityName: auth?.name || '', country: auth?.country || 'SA' }));
                      }} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</option>
                        {authorities.map(a => <option key={a.code} value={a.code}>{a.code} - {a.name}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©</label>
                      <input type="text" value={programForm.authorityName} onChange={(e) => setProgramForm(p => ({ ...p, authorityName: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none" placeholder="ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©" />
                    </div> </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¯ÙˆÙ„Ø© *</label>
                      <select value={programForm.country} onChange={(e) => setProgramForm(p => ({ ...p, country: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400">
                        {countries.map(c => <option key={c.code} value={c.code}>{c.flag} {c.name}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ *</label>
                      <select value={programForm.type} onChange={(e) => setProgramForm(p => ({ ...p, type: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400">
                        {programTypes.map(t => <option key={t} value={t}>{t === 'Mandatory' ? 'Ø¥Ù„Ø²Ø§Ù…ÙŠ' : t === 'Voluntary' ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ' : t === 'Conditional' ? 'Ù…Ø´Ø±ÙˆØ·' : 'Ù…Ø¹ÙŠØ§Ø± ØµÙ†Ø§Ø¹ÙŠ'}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© *</label>
                      <select value={programForm.criticality} onChange={(e) => setProgramForm(p => ({ ...p, criticality: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400">
                        <option value="Critical">Ø­Ø±Ø¬ (Critical)</option>
                        <option value="High">Ø¹Ø§Ù„ÙŠ (High)</option>
                        <option value="Medium">Ù…ØªÙˆØ³Ø· (Medium)</option>
                      </select>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                      <div className="flex flex-wrap gap-2 p-3 border-2 border-slate-200 rounded-xl">
                        {icons.map(ic => (
                          <button key={ic} type="button" onClick={() => setProgramForm(p => ({ ...p, icon: ic }))}
                            className={`w-10 h-10 rounded-lg text-xl flex items-center justify-center transition-all ${programForm.icon === ic ? 'bg-emerald-100 ring-2 ring-emerald-500' : 'hover:bg-slate-100'}`}>{ic}</button>
                        ))}
                      </div> </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù„ÙˆÙ†</label>
                      <div className="flex flex-wrap gap-2 p-3 border-2 border-slate-200 rounded-xl">
                        {['red', 'emerald', 'blue', 'purple', 'amber', 'indigo', 'teal', 'pink', 'orange', 'cyan', 'violet', 'slate'].map(c => (
                          <button key={c} type="button" onClick={() => setProgramForm(p => ({ ...p, color: c }))}
                            className={`w-8 h-8 rounded-lg bg-${c}-500 transition-all ${programForm.color === c ? 'ring-2 ring-offset-2 ring-slate-400' : ''}`}></button>
                        ))}
                      </div> </div> </div> </div>
              )}

              {programModalTab === 2 && (
                <div className="space-y-5">
                  <div className="bg-amber-50 border border-amber-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-amber-700">
                      <Layers className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</p>
                    </div>
                    <p className="text-amber-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                  </div>

                  <div className="flex items-center justify-between">
                    <label className="block text-sm font-bold text-slate-700">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©</label>
                    <div className="flex gap-2">
                      <button type="button" onClick={() => setProgramForm(p => ({ ...p, sectorAr: [...sectors] }))}
                        className="text-sm text-emerald-600 hover:text-emerald-700 font-bold flex items-center gap-1">
                        <CheckCircle2 className="w-4 h-4" />ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                      </button>
                      <span className="text-slate-300">|</span>
                      <button type="button" onClick={() => setProgramForm(p => ({ ...p, sectorAr: [] }))}
                        className="text-sm text-red-600 hover:text-red-700 font-bold flex items-center gap-1">
                        <XCircle className="w-4 h-4" />Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„
                      </button> </div> </div>
                  <div className="grid grid-cols-4 gap-2 p-4 border-2 border-slate-200 rounded-xl max-h-72 overflow-y-auto bg-slate-50">
                    {sectors.map(sector => (
                      <label key={sector} className={`flex items-center gap-2 p-3 rounded-xl cursor-pointer transition-all border-2 ${programForm.sectorAr?.includes(sector)
                        ? 'bg-emerald-100 border-emerald-500 text-emerald-700'
                        : 'bg-white border-slate-200 hover:border-emerald-300 text-slate-700'
                        }`}>
                        <input type="checkbox" checked={programForm.sectorAr?.includes(sector)} onChange={(e) => {
                          if (e.target.checked) {
                            setProgramForm(p => ({ ...p, sectorAr: [...(p.sectorAr || []), sector] }));
                          } else {
                            setProgramForm(p => ({ ...p, sectorAr: (p.sectorAr || []).filter(s => s !== sector) }));
                          }
                        }} className="w-4 h-4 text-emerald-500 rounded border-2" />
                        <span className="text-sm font-medium">{sector}</span>
                      </label>
                    ))}
                  </div>

                  <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                    <div className="flex items-center justify-between mb-3">
                      <p className="text-sm font-bold text-emerald-700">Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</p>
                      <span className="px-3 py-1 bg-emerald-500 text-white rounded-full text-sm font-bold">{programForm.sectorAr?.length || 0} Ù‚Ø·Ø§Ø¹</span>
                    </div>
                    {programForm.sectorAr?.length > 0 ? (
                      <div className="flex flex-wrap gap-2">
                        {programForm.sectorAr.map((sector, idx) => (
                          <span key={idx} className="inline-flex items-center gap-1 px-3 py-1.5 bg-emerald-500 text-white rounded-full text-sm font-bold">
                            {sector}
                            <button type="button" onClick={() => setProgramForm(p => ({ ...p, sectorAr: p.sectorAr.filter(s => s !== sector) }))}
                              className="hover:bg-white/20 rounded-full p-0.5 transition-all">
                              <X className="w-3 h-3" />
                            </button> </span>
                        ))}
                      </div>
                    ) : (
                      <p className="text-emerald-600 text-sm">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù‚Ø·Ø§Ø¹ Ø¨Ø¹Ø¯</p>
                    )}
                  </div> </div>
              )}

              {programModalTab === 3 && (
                <div className="space-y-5">
                  <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-blue-700">
                      <Calendar className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø²Ù…Ù†ÙŠØ©</p>
                    </div>
                    <p className="text-blue-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center">ğŸ“…</span>
                        ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†
                      </label>
                      <input type="date" value={programForm.effectiveDate} onChange={(e) => setProgramForm(p => ({ ...p, effectiveDate: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white" />
                      <p className="text-xs text-slate-500 mt-2">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø¯Ø£ ÙÙŠÙ‡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">ğŸ”„</span>
                        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                      </label>
                      <input type="date" value={programForm.lastUpdated} onChange={(e) => setProgramForm(p => ({ ...p, lastUpdated: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white" />
                      <p className="text-xs text-slate-500 mt-2">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center">ğŸ”</span>
                        ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                      </label>
                      <input type="date" value={programForm.reviewDate || ''} onChange={(e) => setProgramForm(p => ({ ...p, reviewDate: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white" />
                      <p className="text-xs text-slate-500 mt-2">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-8 h-8 rounded-lg bg-red-100 flex items-center justify-center">â°</span>
                        ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø¥Ù† ÙˆØ¬Ø¯)
                      </label>
                      <input type="date" value={programForm.expiryDate || ''} onChange={(e) => setProgramForm(p => ({ ...p, expiryDate: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white" />
                      <p className="text-xs text-slate-500 mt-2">Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø°Ø§Øª Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                    </div> </div>
                  <div className="bg-purple-50 rounded-xl p-5 border border-purple-200">
                    <h4 className="font-bold text-purple-700 mb-4 flex items-center gap-2">
                      <Clock className="w-5 h-5" />
                      Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ©
                    </h4>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                        <input type="number" min="0" value={programForm.gracePeriod || 0} onChange={(e) => setProgramForm(p => ({ ...p, gracePeriod: parseInt(e.target.value) || 0 }))}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none bg-white" />
                        <p className="text-xs text-slate-500 mt-1">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ù…Ù†ÙˆØ­Ø© Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">ÙØªØ±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                        <input type="number" min="0" value={programForm.transitionPeriod || 0} onChange={(e) => setProgramForm(p => ({ ...p, transitionPeriod: parseInt(e.target.value) || 0 }))}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none bg-white" />
                        <p className="text-xs text-slate-500 mt-1">ÙØªØ±Ø© Ø§Ù„ØªØ­ÙˆÙ„ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…</p>
                      </div> </div> </div> </div>
              )}

              {programModalTab === 4 && (
                <div className="space-y-5">
                  <div className="bg-red-50 border border-red-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-red-700">
                      <AlertTriangle className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±</p>
                    </div>
                    <p className="text-red-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…ØªØ±ØªØ¨Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</p>
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ“ Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª</label>
                    <textarea value={programForm.penalty} onChange={(e) => setProgramForm(p => ({ ...p, penalty: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none h-24 resize-none"
                      placeholder="ÙˆØµÙ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…ØªØ±ØªØ¨Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ØŒ Ù…Ø«Ù„: ØºØ±Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ© ØªØµÙ„ Ø¥Ù„Ù‰ X Ø±ÙŠØ§Ù„ + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø· + Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµ..." />
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <h4 className="font-bold text-slate-700 flex items-center gap-2">ğŸ’° Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h4>
                    <div className="grid grid-cols-4 gap-4">
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</label>
                        <input type="number" value={programForm.penaltyDetails?.financial?.min || 0} onChange={(e) => setProgramForm(p => ({
                          ...p, penaltyDetails: { ...p.penaltyDetails, financial: { ...p.penaltyDetails?.financial, min: parseInt(e.target.value) || 0 } }
                        }))} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-red-400 focus:outline-none" />
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</label>
                        <input type="number" value={programForm.penaltyDetails?.financial?.max || 0} onChange={(e) => setProgramForm(p => ({
                          ...p, penaltyDetails: { ...p.penaltyDetails, financial: { ...p.penaltyDetails?.financial, max: parseInt(e.target.value) || 0 } }
                        }))} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-red-400 focus:outline-none" />
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                        <select value={programForm.penaltyDetails?.financial?.currency || 'SAR'} onChange={(e) => setProgramForm(p => ({
                          ...p, penaltyDetails: { ...p.penaltyDetails, financial: { ...p.penaltyDetails?.financial, currency: e.target.value } }
                        }))} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-red-400">
                          <option value="SAR">ğŸ‡¸ğŸ‡¦ Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                          <option value="USD">ğŸ‡ºğŸ‡¸ Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                          <option value="EUR">ğŸ‡ªğŸ‡º ÙŠÙˆØ±Ùˆ</option>
                          <option value="%">ğŸ“Š Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <select value={programForm.penaltyDetails?.financial?.method || 'Fixed'} onChange={(e) => setProgramForm(p => ({
                          ...p, penaltyDetails: { ...p.penaltyDetails, financial: { ...p.penaltyDetails?.financial, method: e.target.value } }
                        }))} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-red-400">
                          <option value="Fixed">Ø«Ø§Ø¨Øª</option>
                          <option value="PerViolation">Ù„ÙƒÙ„ Ù…Ø®Ø§Ù„ÙØ©</option>
                          <option value="PerDay">ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                          <option value="Revenue">% Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</option>
                        </select>
                      </div> </div> </div>
                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <h4 className="font-bold text-slate-700 flex items-center gap-2">ğŸš« Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h4>
                    <div className="flex gap-2 mb-3">
                      <input type="text" id="opPenaltyInput" placeholder="Ù…Ø«Ø§Ù„: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŒ Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø®ÙŠØµØŒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø·..."
                        className="flex-1 px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-red-400 focus:outline-none"
                        onKeyPress={(e) => {
                          if (e.key === 'Enter' && e.target.value) {
                            setProgramForm(p => ({
                              ...p,
                              penaltyDetails: {
                                ...p.penaltyDetails,
                                operational: [...(p.penaltyDetails?.operational || []), e.target.value]
                              }
                            }));
                            e.target.value = '';
                          }
                        }} />
                      <button type="button" onClick={() => {
                        const input = document.getElementById('opPenaltyInput');
                        if (input.value) {
                          setProgramForm(p => ({
                            ...p,
                            penaltyDetails: {
                              ...p.penaltyDetails,
                              operational: [...(p.penaltyDetails?.operational || []), input.value]
                            }
                          }));
                          input.value = '';
                        }
                      }} className="px-4 py-2.5 bg-red-500 text-white rounded-lg hover:bg-red-600 font-bold flex items-center gap-1">
                        <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ©
                      </button> </div>
                    <div className="flex flex-wrap gap-2">
                      {programForm.penaltyDetails?.operational?.map((penalty, idx) => (
                        <span key={idx} className="inline-flex items-center gap-1 px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-bold">
                          ğŸš« {penalty}
                          <button type="button" onClick={() => setProgramForm(p => ({
                            ...p,
                            penaltyDetails: {
                              ...p.penaltyDetails,
                              operational: (p.penaltyDetails?.operational || []).filter((_, i) => i !== idx)
                            }
                          }))} className="hover:bg-red-200 rounded-full p-0.5 transition-all">
                            <X className="w-3 h-3" />
                          </button> </span>
                      ))}
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">âš–ï¸ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©</label>
                    <input type="text" value={programForm.penaltyDetails?.criminal || ''} onChange={(e) => setProgramForm(p => ({
                      ...p, penaltyDetails: { ...p.penaltyDetails, criminal: e.target.value }
                    }))} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                      placeholder="Ø§Ù„Ø³Ø¬Ù† Ø­ØªÙ‰ Ø³Ù†ØªÙŠÙ† ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ù‡Ù…Ø§Ù„ Ø§Ù„Ø¬Ø³ÙŠÙ…ØŒ Ø£Ùˆ 5 Ø³Ù†ÙˆØ§Øª ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ¹Ù…Ø¯..." />
                  </div> </div>
              )}

              {programModalTab === 5 && (
                <div className="space-y-6">
                  <div className="bg-indigo-50 border border-indigo-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-indigo-700">
                      <Users className="w-5 h-5" />
                      <p className="font-bold">Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</p>
                    </div>
                    <p className="text-indigo-600 text-sm mt-1">Ø£Ø¶Ù Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù‡Ù…Ø©</p>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <div className="flex items-center justify-between">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <User className="w-5 h-5 text-indigo-600" />
                        Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ({programForm.contacts?.length || 0})
                      </h4>
                    </div>

                    <div className="bg-white rounded-xl p-4 border-2 border-dashed border-slate-300">
                      <div className="grid grid-cols-4 gap-3 mb-3">
                        <input type="text" id="contactName" placeholder="Ø§Ù„Ø§Ø³Ù… *" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-indigo-400 focus:outline-none text-sm" />
                        <input type="text" id="contactRole" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-indigo-400 focus:outline-none text-sm" />
                        <input type="email" id="contactEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-indigo-400 focus:outline-none text-sm" />
                        <input type="tel" id="contactPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-indigo-400 focus:outline-none text-sm" />
                      </div>
                      <button type="button" onClick={() => {
                        const name = document.getElementById('contactName').value;
                        const email = document.getElementById('contactEmail').value;
                        if (name && email) {
                          const newContact = {
                            name,
                            role: document.getElementById('contactRole').value,
                            email,
                            phone: document.getElementById('contactPhone').value
                          };
                          setProgramForm(p => ({ ...p, contacts: [...(p.contacts || []), newContact] }));
                          document.getElementById('contactName').value = '';
                          document.getElementById('contactRole').value = '';
                          document.getElementById('contactEmail').value = '';
                          document.getElementById('contactPhone').value = '';
                        }
                      }} className="w-full py-2.5 bg-indigo-500 text-white rounded-lg font-bold hover:bg-indigo-600 flex items-center justify-center gap-2">
                        <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„
                      </button> </div>
                    {programForm.contacts?.length > 0 && (
                      <div className="space-y-2">
                        {programForm.contacts.map((contact, idx) => (
                          <div key={idx} className="flex items-center justify-between p-3 bg-white rounded-xl border border-slate-200 hover:border-indigo-300 transition-all">
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                <User className="w-5 h-5 text-indigo-600" />
                              </div>
                              <div>
                                <p className="font-bold text-slate-800">{contact.name} {contact.role && <span className="font-normal text-slate-500 text-sm">({contact.role})</span>}</p>
                                <div className="flex items-center gap-3 text-sm text-slate-600">
                                  <span className="flex items-center gap-1">ğŸ“§ {contact.email}</span>
                                  {contact.phone && <span className="flex items-center gap-1">ğŸ“ {contact.phone}</span>}
                                </div> </div> </div>
                            <button type="button" onClick={() => setProgramForm(p => ({ ...p, contacts: p.contacts.filter((_, i) => i !== idx) }))}
                              className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                              <Trash2 className="w-4 h-4" />
                            </button> </div>
                        ))}
                      </div>
                    )}
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <div className="flex items-center justify-between">
                      <h4 className="font-bold text-slate-700 flex items-center gap-2">
                        <ExternalLink className="w-5 h-5 text-blue-600" />
                        Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹ ({programForm.resources?.length || 0})
                      </h4>
                    </div>

                    <div className="bg-white rounded-xl p-4 border-2 border-dashed border-slate-300">
                      <div className="grid grid-cols-4 gap-3 mb-3">
                        <input type="text" id="resourceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ *" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-blue-400 focus:outline-none text-sm" />
                        <input type="url" id="resourceUrl" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· (URL) *" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-blue-400 focus:outline-none text-sm col-span-2" />
                        <select id="resourceType" className="px-3 py-2.5 border-2 border-slate-200 rounded-lg focus:border-blue-400 text-sm">
                          <option value="PDF">ğŸ“„ PDF</option>
                          <option value="Website">ğŸŒ Ù…ÙˆÙ‚Ø¹ ÙˆÙŠØ¨</option>
                          <option value="Video">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ</option>
                          <option value="Template">ğŸ“ Ù‚Ø§Ù„Ø¨</option>
                          <option value="Checklist">âœ… Ù‚Ø§Ø¦Ù…Ø© ØªØ­Ù‚Ù‚</option>
                          <option value="FAQ">â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</option>
                          <option value="API">ğŸ”Œ API</option>
                          <option value="Portal">ğŸšª Ø¨ÙˆØ§Ø¨Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option>
                        </select>
                      </div>
                      <button type="button" onClick={() => {
                        const name = document.getElementById('resourceName').value;
                        const url = document.getElementById('resourceUrl').value;
                        if (name && url) {
                          const newResource = {
                            name,
                            url,
                            type: document.getElementById('resourceType').value
                          };
                          setProgramForm(p => ({ ...p, resources: [...(p.resources || []), newResource] }));
                          document.getElementById('resourceName').value = '';
                          document.getElementById('resourceUrl').value = '';
                        }
                      }} className="w-full py-2.5 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 flex items-center justify-center gap-2">
                        <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯
                      </button> </div>
                    {programForm.resources?.length > 0 && (
                      <div className="grid grid-cols-2 gap-2">
                        {programForm.resources.map((resource, idx) => (
                          <div key={idx} className="flex items-center justify-between p-3 bg-white rounded-xl border border-slate-200 hover:border-blue-300 transition-all">
                            <div className="flex items-center gap-3">
                              <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${resource.type === 'PDF' ? 'bg-red-100 text-red-600' :
                                resource.type === 'Video' ? 'bg-purple-100 text-purple-600' :
                                  resource.type === 'Template' ? 'bg-amber-100 text-amber-600' :
                                    'bg-blue-100 text-blue-600'
                                }`}>
                                <FileText className="w-5 h-5" />
                              </div>
                              <div>
                                <p className="font-bold text-slate-800 text-sm">{resource.name}</p>
                                <p className="text-xs text-blue-600 truncate max-w-[150px]">{resource.url}</p>
                              </div>
                              <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold">{resource.type}</span>
                            </div>
                            <button type="button" onClick={() => setProgramForm(p => ({ ...p, resources: p.resources.filter((_, i) => i !== idx) }))}
                              className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                              <Trash2 className="w-4 h-4" />
                            </button> </div>
                        ))}
                      </div>
                    )}
                  </div> </div>
              )}

              {programModalTab === 6 && (
                <div className="space-y-6">
                  <div className="bg-teal-50 border border-teal-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-teal-700">
                      <Target className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
                    </div>
                    <p className="text-teal-600 text-sm mt-1">Ø­Ø¯Ø¯ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-slate-50 rounded-xl p-5">
                      <label className="block text-sm font-bold text-slate-700 mb-4">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                      <div className="flex items-center gap-4">
                        <input type="range" min="0" max="100" value={programForm.complianceRate || 0}
                          onChange={(e) => setProgramForm(p => ({ ...p, complianceRate: parseInt(e.target.value) }))}
                          className="flex-1 h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500" />
                        <div className={`w-16 h-16 rounded-2xl flex items-center justify-center font-black text-white text-xl shadow-lg ${(programForm.complianceRate || 0) >= 80 ? 'bg-gradient-to-br from-emerald-400 to-emerald-600' :
                          (programForm.complianceRate || 0) >= 60 ? 'bg-gradient-to-br from-amber-400 to-amber-600' :
                            'bg-gradient-to-br from-red-400 to-red-600'
                          }`}>{programForm.complianceRate || 0}%</div>
                      </div>
                      <div className="h-4 bg-slate-200 rounded-full mt-4 overflow-hidden">
                        <div className={`h-full rounded-full transition-all duration-300 ${(programForm.complianceRate || 0) >= 80 ? 'bg-emerald-500' :
                          (programForm.complianceRate || 0) >= 60 ? 'bg-amber-500' : 'bg-red-500'
                          }`} style={{ width: `${programForm.complianceRate || 0}%` }}></div>
                      </div>
                      <p className="text-xs text-slate-500 mt-2 text-center">
                        {(programForm.complianceRate || 0) >= 80 ? 'âœ… Ù…Ù…ØªØ§Ø² - Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¬ÙŠØ¯' :
                          (programForm.complianceRate || 0) >= 60 ? 'âš ï¸ Ù…ØªÙˆØ³Ø· - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†' :
                            'ğŸ”´ Ù…Ù†Ø®ÙØ¶ - ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ø§Ø¬Ù„'}
                      </p> </div>
                    <div className="bg-slate-50 rounded-xl p-5">
                      <label className="block text-sm font-bold text-slate-700 mb-4">ğŸ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
                      <div className="flex items-center gap-4">
                        <input type="range" min="0" max="100" value={programForm.targetComplianceRate || 100}
                          onChange={(e) => setProgramForm(p => ({ ...p, targetComplianceRate: parseInt(e.target.value) }))}
                          className="flex-1 h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500" />
                        <div className="w-16 h-16 rounded-2xl flex items-center justify-center font-black text-white text-xl shadow-lg bg-gradient-to-br from-blue-400 to-blue-600">
                          {programForm.targetComplianceRate || 100}%
                        </div> </div>
                      <div className="h-4 bg-slate-200 rounded-full mt-4 overflow-hidden">
                        <div className="h-full rounded-full bg-blue-500 transition-all duration-300" style={{ width: `${programForm.targetComplianceRate || 100}%` }}></div>
                      </div>
                      <p className="text-xs text-slate-500 mt-2 text-center">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ­Ù‚ÙŠÙ‚Ù‡</p>
                    </div> </div>
                  <div className="bg-slate-50 rounded-xl p-5">
                    <label className="block text-sm font-bold text-slate-700 mb-4">âš ï¸ Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± (1-10)</label>
                    <div className="flex items-center gap-4">
                      <span className="text-green-600 font-bold">Ù…Ù†Ø®ÙØ¶</span>
                      <input type="range" min="1" max="10" value={programForm.riskScore || 5}
                        onChange={(e) => setProgramForm(p => ({ ...p, riskScore: parseInt(e.target.value) }))}
                        className="flex-1 h-3 bg-gradient-to-r from-green-200 via-amber-200 to-red-200 rounded-lg appearance-none cursor-pointer" />
                      <span className="text-red-600 font-bold">Ø¹Ø§Ù„ÙŠ</span>
                      <div className={`w-14 h-14 rounded-xl flex items-center justify-center font-black text-white text-xl shadow-lg ${(programForm.riskScore || 5) >= 8 ? 'bg-gradient-to-br from-red-400 to-red-600' :
                        (programForm.riskScore || 5) >= 5 ? 'bg-gradient-to-br from-amber-400 to-amber-600' :
                          'bg-gradient-to-br from-green-400 to-green-600'
                        }`}>{programForm.riskScore || 5}</div>
                    </div> </div>
                  <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-5 border border-emerald-200">
                    <h4 className="font-bold text-emerald-700 mb-4 flex items-center gap-2">ğŸ“ˆ Ù…Ù„Ø®Øµ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h4>
                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-white rounded-xl p-4 text-center shadow-sm">
                        <p className="text-3xl font-black text-emerald-600">{programForm.complianceRate || 0}%</p>
                        <p className="text-xs text-slate-600 mt-1">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 text-center shadow-sm">
                        <p className="text-3xl font-black text-blue-600">{programForm.targetComplianceRate || 100}%</p>
                        <p className="text-xs text-slate-600 mt-1">Ø§Ù„Ù‡Ø¯Ù</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 text-center shadow-sm">
                        <p className="text-3xl font-black text-amber-600">{(programForm.targetComplianceRate || 100) - (programForm.complianceRate || 0)}%</p>
                        <p className="text-xs text-slate-600 mt-1">Ø§Ù„ÙØ¬ÙˆØ©</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 text-center shadow-sm">
                        <p className={`text-3xl font-black ${(programForm.riskScore || 5) >= 8 ? 'text-red-600' :
                          (programForm.riskScore || 5) >= 5 ? 'text-amber-600' : 'text-green-600'
                          }`}>{programForm.riskScore || 5}/10</p>
                        <p className="text-xs text-slate-600 mt-1">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</p>
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-3">
                <button disabled={programModalTab === 0} onClick={() => setProgramModalTab(t => t - 1)}
                  className="px-5 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2 transition-all shadow-sm">
                  <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <button disabled={programModalTab === programModalTabs.length - 1} onClick={() => setProgramModalTab(t => t + 1)}
                  className="px-5 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2 transition-all shadow-sm">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                </button> </div>
              <div className="flex items-center gap-4 text-sm">
                <span className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg font-bold flex items-center gap-1">
                  <Layers className="w-4 h-4" />{programForm.sectorAr?.length || 0} Ù‚Ø·Ø§Ø¹
                </span>
                <span className="px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg font-bold flex items-center gap-1">
                  <Users className="w-4 h-4" />{programForm.contacts?.length || 0} Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„
                </span>
                <span className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg font-bold flex items-center gap-1">
                  <ExternalLink className="w-4 h-4" />{programForm.resources?.length || 0} Ù…ÙˆØ±Ø¯
                </span> </div>
              <div className="flex items-center gap-3">
                <button onClick={() => { setShowProgramModal(false); setEditMode(false); resetProgramForm(); }}
                  className="px-6 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition-all shadow-sm">
                  Ø¥Ù„ØºØ§Ø¡
                </button>
                <button onClick={editMode ? handleEditProgram : handleAddProgram} disabled={!programForm.name || !programForm.authority}
                  className="flex items-center gap-2 px-8 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl disabled:opacity-50 transition-all">
                  {editMode ? <><Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</> : <><Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</>}
                </button> </div> </div> </div> </div>
      )}

      {showObligationModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center">
                    <ClipboardCheck className="w-8 h-8" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">{editMode ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ²Ø§Ù… ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø¬Ø¯ÙŠØ¯'}</h2>
                    <p className="text-blue-200">Program-Driven Compliance Object Creator</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <div className="text-left bg-white/10 rounded-xl px-4 py-2">
                    <p className="text-xs text-blue-200">Ø§Ù„Ø®Ø·ÙˆØ©</p>
                    <p className="text-lg font-bold">{(obligationForm.wizardTab || 0) + 1} / 10</p>
                  </div>
                  <button onClick={() => { setShowObligationModal(false); setEditMode(false); resetObligationForm(); }}
                    className="w-12 h-12 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all">
                    <X className="w-6 h-6" />
                  </button> </div> </div> </div>
            <div className="bg-slate-100 px-6 py-3 shrink-0">
              <div className="flex items-center gap-1">
                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((idx) => (
                  <div key={idx} className={`flex-1 h-2 rounded-full transition-all ${idx <= (obligationForm.wizardTab || 0) ? 'bg-blue-500' : 'bg-slate-300'}`} />
                ))}
              </div> </div>
            <div className="flex border-b border-slate-200 bg-slate-50 px-2 shrink-0 overflow-x-auto">
              {[
                { id: 0, label: 'Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', icon: FileText },
                { id: 1, label: 'Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: BookOpen },
                { id: 2, label: 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆØ§Ù„Ù‚Ø§Ù„Ø¨', icon: Layers },
                { id: 3, label: 'Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', icon: CheckSquare },
                { id: 4, label: 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FileCheck },
                { id: 5, label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…', icon: Calendar },
                { id: 6, label: 'Ø®Ø·Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardList },
                { id: 7, label: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ø°', icon: AlertTriangle },
                { id: 8, label: 'Ø§Ù„ØªØ£Ø«ÙŠØ± ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', icon: Scale },
                { id: 9, label: 'Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', icon: GitBranch },
              ].map((tab, idx) => (
                <button key={tab.id} onClick={() => setObligationForm(o => ({ ...o, wizardTab: idx }))}
                  className={`flex items-center gap-1 px-3 py-2.5 text-xs font-bold whitespace-nowrap border-b-2 transition-all ${(obligationForm.wizardTab || 0) === idx ? 'text-blue-600 border-blue-500 bg-white -mb-[1px]' :
                    idx < (obligationForm.wizardTab || 0) ? 'text-blue-500 border-transparent' :
                      'text-slate-500 border-transparent hover:text-blue-500'
                    }`}>
                  <tab.icon className="w-3 h-3" />
                  <span className="hidden xl:inline">{tab.label}</span>
                  {idx < (obligationForm.wizardTab || 0) && <CheckCircle2 className="w-3 h-3 text-blue-500" />}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-y-auto p-6">
              {(obligationForm.wizardTab || 0) === 0 && (
                <div className="space-y-5">
                  <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-blue-700">
                      <FileText className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                    </div>
                    <p className="text-blue-600 text-sm mt-1">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¹Ø±Ù‘Ù Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                        ÙƒÙˆØ¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… <span className="text-red-500">*</span>
                      </label>
                      <input type="text" value={obligationForm.code} onChange={(e) => setObligationForm(o => ({ ...o, code: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none font-mono"
                        placeholder="SHM-OBL-001" />
                      <p className="text-xs text-slate-500 mt-1">Ù…Ø«Ø§Ù„: SHM-OBL-001, PDPL-ART-18</p>
                    </div>
                    <div className="col-span-2">
                      <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                        Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… <span className="text-red-500">*</span>
                      </label>
                      <input type="text" value={obligationForm.title} onChange={(e) => setObligationForm(o => ({ ...o, title: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none"
                        placeholder="Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø¶Ø­ ÙˆÙ…Ø­Ø¯Ø¯ Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØµÙŠØ§ØºØ© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© / Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                    <textarea value={obligationForm.legalText || ''} onChange={(e) => setObligationForm(o => ({ ...o, legalText: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none h-24 resize-none font-mono text-sm"
                      placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù…Ù† Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…..." />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
                    <textarea value={obligationForm.description} onChange={(e) => setObligationForm(o => ({ ...o, description: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400 focus:outline-none h-20 resize-none"
                      placeholder="Ø´Ø±Ø­ ØªÙØµÙŠÙ„ÙŠ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆÙƒÙŠÙÙŠØ© ØªØ·Ø¨ÙŠÙ‚Ù‡..." />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</label>
                      <select value={obligationForm.severity} onChange={(e) => setObligationForm(o => ({ ...o, severity: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400">
                        <option value="Critical">ğŸ”´ Ø­Ø±Ø¬ (Critical)</option>
                        <option value="High">ğŸŸ  Ø¹Ø§Ù„ÙŠ (High)</option>
                        <option value="Medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø· (Medium)</option>
                        <option value="Low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶ (Low)</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© (Control Type)</label>
                      <select value={obligationForm.controlType || 'Preventive'} onChange={(e) => setObligationForm(o => ({ ...o, controlType: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-400">
                        <option value="Preventive">ğŸ›¡ï¸ ÙˆÙ‚Ø§Ø¦ÙŠ (Preventive)</option>
                        <option value="Detective">ğŸ” ÙƒØ´ÙÙŠ (Detective)</option>
                        <option value="Corrective">ğŸ”§ ØªØµØ­ÙŠØ­ÙŠ (Corrective)</option>
                        <option value="Directive">ğŸ“‹ ØªÙˆØ¬ÙŠÙ‡ÙŠ (Directive)</option>
                        <option value="Compensating">âš–ï¸ ØªØ¹ÙˆÙŠØ¶ÙŠ (Compensating)</option>
                      </select>
                    </div> </div> </div>
              )}

              {(obligationForm.wizardTab || 0) === 1 && (
                <div className="space-y-5">
                  <div className="bg-purple-50 border border-purple-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-purple-700">
                      <BookOpen className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                    </div>
                    <p className="text-purple-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div>
                      <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                        Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© <span className="text-red-500">*</span>
                      </label>
                      <select value={obligationForm.authority || ''} onChange={(e) => setObligationForm(o => ({ ...o, authority: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</option>
                        <optgroup label="ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">
                          {authorities.filter(a => a.country === 'SA').map(a => <option key={a.code} value={a.code}>{a.code} - {a.name}</option>)}
                        </optgroup>
                        <optgroup label="ğŸŒ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©">
                          {authorities.filter(a => a.country === 'INT').map(a => <option key={a.code} value={a.code}>{a.code} - {a.name}</option>)}
                        </optgroup>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                      <input type="text" value={obligationForm.framework || ''} onChange={(e) => setObligationForm(o => ({ ...o, framework: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                        placeholder="Ù…Ø«Ø§Ù„: ECC 2.0, PDPL, VAT Regulations" />
                    </div> </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø©/Ø§Ù„Ø¨Ù†Ø¯</label>
                      <input type="text" value={obligationForm.articleNumber || ''} onChange={(e) => setObligationForm(o => ({ ...o, articleNumber: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                        placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© 18" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„ÙÙ‚Ø±Ø©</label>
                      <input type="text" value={obligationForm.clauseNumber || ''} onChange={(e) => setObligationForm(o => ({ ...o, clauseNumber: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                        placeholder="Ø§Ù„ÙÙ‚Ø±Ø© 3" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù„Ø§Ø¦Ø­Ø©</label>
                      <input type="text" value={obligationForm.regulationVersion || ''} onChange={(e) => setObligationForm(o => ({ ...o, regulationVersion: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                        placeholder="v2.0 - 2024" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                    <input type="url" value={obligationForm.referenceUrl || ''} onChange={(e) => setObligationForm(o => ({ ...o, referenceUrl: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-400 focus:outline-none"
                      placeholder="https://..." />
                  </div> </div>
              )}

              {(obligationForm.wizardTab || 0) === 2 && (
                <div className="space-y-5">
                  <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-emerald-700">
                      <Layers className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆÙ…ØµØ¯Ø± Ø§Ù„Ù‚Ø§Ù„Ø¨</p>
                    </div>
                    <p className="text-emerald-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆÙ†ÙˆØ¹ Ù…ØµØ¯Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                  </div>

                  <div>
                    <label className="flex items-center gap-1 text-sm font-bold text-slate-700 mb-2">
                      Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ <span className="text-red-500">*</span>
                    </label>
                    <select value={obligationForm.programId || ''} onChange={(e) => setObligationForm(o => ({ ...o, programId: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-400">
                      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</option>
                      {programs.map(p => (
                        <option key={p.id} value={p.id}>{p.icon} {p.name} ({p.authority})</option>
                      ))}
                    </select>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ù…ØµØ¯Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (Obligation Source)</label>
                    <div className="grid grid-cols-2 gap-4">
                      <label className={`flex items-center gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all ${obligationForm.sourceType === 'template' ? 'bg-emerald-100 border-emerald-500' : 'bg-white border-slate-200 hover:border-emerald-300'
                        }`}>
                        <input type="radio" name="sourceType" value="template" checked={obligationForm.sourceType === 'template'}
                          onChange={(e) => setObligationForm(o => ({ ...o, sourceType: e.target.value }))} className="w-5 h-5 text-emerald-500" />
                        <div>
                          <p className="font-bold text-slate-800">âœ… Ù…ÙˆÙ„Ù‘Ø¯ Ù…Ù† Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                          <p className="text-sm text-slate-600">Template-Generated</p>
                          <p className="text-xs text-slate-500 mt-1">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù…Ø³ØªÙˆØ±Ø¯ Ù…Ù† Saudi Regulatory Pack</p>
                        </div>
                      </label>
                      <label className={`flex items-center gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all ${obligationForm.sourceType === 'custom' ? 'bg-blue-100 border-blue-500' : 'bg-white border-slate-200 hover:border-blue-300'
                        }`}>
                        <input type="radio" name="sourceType" value="custom" checked={obligationForm.sourceType === 'custom'}
                          onChange={(e) => setObligationForm(o => ({ ...o, sourceType: e.target.value }))} className="w-5 h-5 text-blue-500" />
                        <div>
                          <p className="font-bold text-slate-800">âœï¸ Ø§Ù„ØªØ²Ø§Ù… ÙŠØ¯ÙˆÙŠ Ù…Ø®ØµØµ</p>
                          <p className="text-sm text-slate-600">Custom Manual</p>
                          <p className="text-xs text-slate-500 mt-1">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹</p>
                        </div>
                      </label>
                    </div> </div>
                  {obligationForm.sourceType === 'template' && (
                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <p className="text-emerald-700 font-bold mb-2">ğŸ“‹ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…ØµØ¯Ø±</p>
                      <p className="text-sm text-emerald-600">Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ù† Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
                    </div>
                  )}
                </div>
              )}

              {(obligationForm.wizardTab || 0) === 3 && (
                <div className="space-y-5">
                  <div className="bg-amber-50 border border-amber-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-amber-700">
                      <CheckSquare className="w-5 h-5" />
                      <p className="font-bold">Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª</p>
                    </div>
                    <p className="text-amber-600 text-sm mt-1">Ø­Ø¯Ø¯ Ù…Ø¯Ù‰ Ø§Ù†Ø·Ø¨Ø§Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</p>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Applicability Status)</label>
                    <div className="grid grid-cols-3 gap-4">
                      <label className={`flex flex-col items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-center ${obligationForm.applicability === 'applicable' ? 'bg-emerald-100 border-emerald-500' : 'bg-white border-slate-200 hover:border-emerald-300'
                        }`}>
                        <input type="radio" name="applicability" value="applicable" checked={obligationForm.applicability === 'applicable'}
                          onChange={(e) => setObligationForm(o => ({ ...o, applicability: e.target.value }))} className="w-5 h-5 text-emerald-500" />
                        <div className="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-2xl">âœ…</div>
                        <div>
                          <p className="font-bold text-slate-800">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                          <p className="text-xs text-slate-500">Applicable</p>
                        </div>
                      </label>
                      <label className={`flex flex-col items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-center ${obligationForm.applicability === 'partial' ? 'bg-amber-100 border-amber-500' : 'bg-white border-slate-200 hover:border-amber-300'
                        }`}>
                        <input type="radio" name="applicability" value="partial" checked={obligationForm.applicability === 'partial'}
                          onChange={(e) => setObligationForm(o => ({ ...o, applicability: e.target.value }))} className="w-5 h-5 text-amber-500" />
                        <div className="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-2xl">âš ï¸</div>
                        <div>
                          <p className="font-bold text-slate-800">ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø²Ø¦ÙŠ</p>
                          <p className="text-xs text-slate-500">Partial</p>
                        </div>
                      </label>
                      <label className={`flex flex-col items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all text-center ${obligationForm.applicability === 'not_applicable' ? 'bg-red-100 border-red-500' : 'bg-white border-slate-200 hover:border-red-300'
                        }`}>
                        <input type="radio" name="applicability" value="not_applicable" checked={obligationForm.applicability === 'not_applicable'}
                          onChange={(e) => setObligationForm(o => ({ ...o, applicability: e.target.value }))} className="w-5 h-5 text-red-500" />
                        <div className="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center text-2xl">âŒ</div>
                        <div>
                          <p className="font-bold text-slate-800">ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                          <p className="text-xs text-slate-500">Not Applicable</p>
                        </div>
                      </label>
                    </div> </div>
                  {(obligationForm.applicability === 'not_applicable' || obligationForm.applicability === 'partial') && (
                    <div className="bg-red-50 rounded-xl p-5 border border-red-200 space-y-4">
                      <h4 className="font-bold text-red-700 flex items-center gap-2">
                        <AlertCircle className="w-5 h-5" />
                        ÙŠØªØ·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø±Ø³Ù…ÙŠ
                      </h4>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø¨Ø±Ø± Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ *</label>
                        <textarea value={obligationForm.exceptionJustification || ''} onChange={(e) => setObligationForm(o => ({ ...o, exceptionJustification: e.target.value }))}
                          className="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-400 focus:outline-none h-20 resize-none"
                          placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù†Ø·Ø¨Ø§Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…..." />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Approver) *</label>
                          <input type="text" value={obligationForm.exceptionApprover || ''} onChange={(e) => setObligationForm(o => ({ ...o, exceptionApprover: e.target.value }))}
                            className="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-400 focus:outline-none"
                            placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</label>
                          <input type="date" value={obligationForm.exceptionDate || ''} onChange={(e) => setObligationForm(o => ({ ...o, exceptionDate: e.target.value }))}
                            className="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-400 focus:outline-none" />
                        </div> </div> </div>
                  )}
                </div>
              )}

              {(obligationForm.wizardTab || 0) === 4 && (
                <div className="space-y-5">
                  <div className="bg-teal-50 border border-teal-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-teal-700">
                      <FileCheck className="w-5 h-5" />
                      <p className="font-bold">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„Ø¥Ø«Ø¨Ø§Øª</p>
                    </div>
                    <p className="text-teal-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5">
                    <div className="flex items-center justify-between mb-4">
                      <label className="font-bold text-slate-700">Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø£Ø¯Ù„Ø©ØŸ</label>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked={obligationForm.evidenceRequired !== false} onChange={(e) => setObligationForm(o => ({ ...o, evidenceRequired: e.target.checked }))}
                          className="sr-only peer" />
                        <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-teal-500"></div>
                        <span className="mr-3 text-sm font-bold text-slate-700">{obligationForm.evidenceRequired !== false ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span>
                      </label>
                    </div> </div>
                  {obligationForm.evidenceRequired !== false && (
                    <>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                        <div className="grid grid-cols-3 gap-2">
                          {['Ø´Ù‡Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„', 'ØªÙ‚Ø±ÙŠØ± ØªØ¯Ù‚ÙŠÙ‚', 'Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª', 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', 'Ù…Ø­Ø¶Ø± Ø§Ø¬ØªÙ…Ø§Ø¹', 'ØªÙ‚Ø±ÙŠØ± Ù†Ø¸Ø§Ù…', 'ÙˆØ«ÙŠÙ‚Ø© Ù…Ø¹ØªÙ…Ø¯Ø©', 'ØµÙˆØ±Ø© ÙÙˆØªÙˆØºØ±Ø§ÙÙŠØ©', 'Ø¹Ù‚Ø¯/Ø§ØªÙØ§Ù‚ÙŠØ©'].map(type => (
                            <label key={type} className={`flex items-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${(obligationForm.evidenceTypes || []).includes(type) ? 'bg-teal-100 border-teal-500' : 'bg-white border-slate-200 hover:border-teal-300'
                              }`}>
                              <input type="checkbox" checked={(obligationForm.evidenceTypes || []).includes(type)} onChange={(e) => {
                                if (e.target.checked) {
                                  setObligationForm(o => ({ ...o, evidenceTypes: [...(o.evidenceTypes || []), type] }));
                                } else {
                                  setObligationForm(o => ({ ...o, evidenceTypes: (o.evidenceTypes || []).filter(t => t !== type) }));
                                }
                              }} className="w-4 h-4 text-teal-500 rounded" />
                              <span className="text-sm text-slate-700">{type}</span>
                            </label>
                          ))}
                        </div> </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">ÙØªØ±Ø© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ù„ÙŠÙ„ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                          <input type="number" min="1" value={obligationForm.evidenceValidityDays || 365} onChange={(e) => setObligationForm(o => ({ ...o, evidenceValidityDays: parseInt(e.target.value) || 365 }))}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-400 focus:outline-none" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                          <input type="number" min="1" value={obligationForm.minEvidenceCount || 1} onChange={(e) => setObligationForm(o => ({ ...o, minEvidenceCount: parseInt(e.target.value) || 1 }))}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-400 focus:outline-none" />
                        </div> </div>
                    </>
                  )}
                </div>
              )}

              {(obligationForm.wizardTab || 0) === 5 && (
                <div className="space-y-5">
                  <div className="bg-indigo-50 border border-indigo-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-indigo-700">
                      <Calendar className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…</p>
                    </div>
                    <p className="text-indigo-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø¯ÙˆØ±ÙŠØ© Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
                      <select value={obligationForm.recurrence} onChange={(e) => setObligationForm(o => ({ ...o, recurrence: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-400">
                        {recurrences.map(r => <option key={r} value={r}>{r}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                      <input type="text" value={obligationForm.deadline} onChange={(e) => setObligationForm(o => ({ ...o, deadline: e.target.value }))}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-400 focus:outline-none"
                        placeholder="Ù…Ø«Ø§Ù„: Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©ØŒ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±" />
                    </div> </div>
                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <h4 className="font-bold text-slate-700">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ (Due Rule)</h4>
                    <div className="grid grid-cols-3 gap-4">
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</label>
                        <select value={obligationForm.dueRuleType || 'fixed'} onChange={(e) => setObligationForm(o => ({ ...o, dueRuleType: e.target.value }))}
                          className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg">
                          <option value="fixed">ÙŠÙˆÙ… Ø«Ø§Ø¨Øª</option>
                          <option value="relative">Ù†Ø³Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø­Ø¯Ø«</option>
                          <option value="realtime">ÙÙˆØ±ÙŠ (Real-time)</option>
                          <option value="ondemand">Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„Ù‚ÙŠÙ…Ø©</label>
                        <input type="number" value={obligationForm.dueRuleValue || 1} onChange={(e) => setObligationForm(o => ({ ...o, dueRuleValue: parseInt(e.target.value) || 1 }))}
                          className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg" />
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-600 mb-1">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                        <select value={obligationForm.dueRuleUnit || 'days'} onChange={(e) => setObligationForm(o => ({ ...o, dueRuleUnit: e.target.value }))}
                          className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg">
                          <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                          <option value="days">Ø£ÙŠØ§Ù…</option>
                          <option value="weeks">Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                          <option value="months">Ø£Ø´Ù‡Ø±</option>
                        </select>
                      </div> </div> </div>
                  <div className="bg-indigo-50 rounded-xl p-5 border border-indigo-200">
                    <div className="flex items-center justify-between mb-4">
                      <h4 className="font-bold text-indigo-700 flex items-center gap-2">
                        <Zap className="w-5 h-5" />
                        ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                      </h4>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked={obligationForm.autoTaskGeneration !== false} onChange={(e) => setObligationForm(o => ({ ...o, autoTaskGeneration: e.target.checked }))}
                          className="sr-only peer" />
                        <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-500"></div>
                      </label>
                    </div>
                    <p className="text-sm text-indigo-600">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                  </div> </div>
              )}

              {(obligationForm.wizardTab || 0) === 6 && (
                <div className="space-y-5">
                  <div className="bg-cyan-50 border border-cyan-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-cyan-700">
                      <ClipboardList className="w-5 h-5" />
                      <p className="font-bold">Ø®Ø·Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                    </div>
                    <p className="text-cyan-600 text-sm mt-1">Ø­Ø¯Ø¯ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5">
                    <div className="flex items-center justify-between mb-4">
                      <label className="font-bold text-slate-700">Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù…ØªØ«Ø§Ù„ØŸ</label>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked={obligationForm.testingRequired !== false} onChange={(e) => setObligationForm(o => ({ ...o, testingRequired: e.target.checked }))}
                          className="sr-only peer" />
                        <div className="w-14 h-7 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-cyan-500"></div>
                        <span className="mr-3 text-sm font-bold text-slate-700">{obligationForm.testingRequired !== false ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span>
                      </label>
                    </div> </div>
                  {obligationForm.testingRequired !== false && (
                    <>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                          <select value={obligationForm.testType || 'manual'} onChange={(e) => setObligationForm(o => ({ ...o, testType: e.target.value }))}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-400">
                            <option value="manual">Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ</option>
                            <option value="automated">Ø§Ø®ØªØ¨Ø§Ø± Ø¢Ù„ÙŠ</option>
                            <option value="sampling">Ø§Ø®ØªØ¨Ø§Ø± Ø¹ÙŠÙ†Ø§Øª</option>
                            <option value="walkthrough">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                          <select value={obligationForm.testFrequency || 'Quarterly'} onChange={(e) => setObligationForm(o => ({ ...o, testFrequency: e.target.value }))}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-400">
                            <option value="Monthly">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="Quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                            <option value="Semi-Annual">Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option>
                            <option value="Annual">Ø³Ù†ÙˆÙŠ</option>
                          </select>
                        </div> </div>
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                        <input type="text" value={obligationForm.testTemplate || ''} onChange={(e) => setObligationForm(o => ({ ...o, testTemplate: e.target.value }))}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-400 focus:outline-none"
                          placeholder="Ø§Ø®ØªØ± Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±" />
                      </div>
                    </>
                  )}
                </div>
              )}

              {(obligationForm.wizardTab || 0) === 7 && (
                <div className="space-y-5">
                  <div className="bg-red-50 border border-red-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-red-700">
                      <AlertTriangle className="w-5 h-5" />
                      <p className="font-bold">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ø° ÙˆÙ…Ø­ÙØ²Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚</p>
                    </div>
                    <p className="text-red-600 text-sm mt-1">Ø­Ø¯Ø¯ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø±ØµØ¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª ÙˆØ§Ù„ØªØµØ¹ÙŠØ¯</p>
                  </div>

                  <div className="bg-slate-50 rounded-xl p-5 space-y-4">
                    <h4 className="font-bold text-slate-700">Ù…Ø­ÙØ²Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Auto Breach Triggers)</h4>

                    <div className="space-y-3">
                      <label className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer transition-all ${obligationForm.breachOnOverdue ? 'bg-red-100 border-red-400' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center gap-3">
                          <input type="checkbox" checked={obligationForm.breachOnOverdue} onChange={(e) => setObligationForm(o => ({ ...o, breachOnOverdue: e.target.checked }))}
                            className="w-5 h-5 text-red-500 rounded" />
                          <div>
                            <p className="font-bold text-slate-800">ğŸš¨ Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®Ø±</p>
                            <p className="text-sm text-slate-600">Overdue 0 days â†’ Critical Breach</p>
                          </div> </div>
                        <input type="number" value={obligationForm.overdueThreshold || 0} onChange={(e) => setObligationForm(o => ({ ...o, overdueThreshold: parseInt(e.target.value) || 0 }))}
                          className="w-20 px-3 py-2 border-2 border-slate-200 rounded-lg text-center" placeholder="Ø£ÙŠØ§Ù…" />
                      </label>

                      <label className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer transition-all ${obligationForm.breachOnRejection ? 'bg-red-100 border-red-400' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center gap-3">
                          <input type="checkbox" checked={obligationForm.breachOnRejection} onChange={(e) => setObligationForm(o => ({ ...o, breachOnRejection: e.target.checked }))}
                            className="w-5 h-5 text-red-500 rounded" />
                          <div>
                            <p className="font-bold text-slate-800">âŒ ØªØµØ¹ÙŠØ¯ Ø¹Ù†Ø¯ Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                            <p className="text-sm text-slate-600">Evidence Rejected Twice â†’ Escalate</p>
                          </div> </div>
                        <input type="number" value={obligationForm.rejectionThreshold || 2} onChange={(e) => setObligationForm(o => ({ ...o, rejectionThreshold: parseInt(e.target.value) || 2 }))}
                          className="w-20 px-3 py-2 border-2 border-slate-200 rounded-lg text-center" placeholder="Ù…Ø±Ø§Øª" />
                      </label>

                      <label className={`flex items-center justify-between p-4 rounded-xl border-2 cursor-pointer transition-all ${obligationForm.breachOnMissing ? 'bg-red-100 border-red-400' : 'bg-white border-slate-200'
                        }`}>
                        <div className="flex items-center gap-3">
                          <input type="checkbox" checked={obligationForm.breachOnMissing} onChange={(e) => setObligationForm(o => ({ ...o, breachOnMissing: e.target.checked }))}
                            className="w-5 h-5 text-red-500 rounded" />
                          <div>
                            <p className="font-bold text-slate-800">ğŸ“­ Ø§Ø®ØªØ±Ø§Ù‚ Ø¹Ù†Ø¯ ÙÙ‚Ø¯ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                            <p className="text-sm text-slate-600">Missing Evidence â†’ Auto Breach</p>
                          </div> </div>
                      </label>
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ù‚ÙˆØ§Ø¹Ø¯ Ø¥Ù†ÙØ§Ø° Ù…Ø®ØµØµØ©</label>
                    <textarea value={obligationForm.customEnforcementRules || ''} onChange={(e) => setObligationForm(o => ({ ...o, customEnforcementRules: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none h-20 resize-none font-mono text-sm"
                      placeholder="Ø£Ø¯Ø®Ù„ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø®ØµØµØ©..." />
                  </div> </div>
              )}

              {(obligationForm.wizardTab || 0) === 8 && (
                <div className="space-y-5">
                  <div className="bg-orange-50 border border-orange-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-orange-700">
                      <Scale className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„ØªØ£Ø«ÙŠØ± ÙˆØ§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                    </div>
                    <p className="text-orange-600 text-sm mt-1">Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ£Ø«ÙŠØ± ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-slate-50 rounded-xl p-5">
                      <label className="block text-sm font-bold text-slate-700 mb-4">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ£Ø«ÙŠØ± (Impact Level)</label>
                      <div className="flex items-center gap-4">
                        <input type="range" min="1" max="5" value={obligationForm.impactLevel || 3} onChange={(e) => setObligationForm(o => ({ ...o, impactLevel: parseInt(e.target.value) }))}
                          className="flex-1 h-3 bg-gradient-to-r from-green-200 via-amber-200 to-red-200 rounded-lg appearance-none cursor-pointer" />
                        <span className={`w-12 h-12 rounded-xl flex items-center justify-center font-black text-white text-lg ${(obligationForm.impactLevel || 3) >= 4 ? 'bg-red-500' : (obligationForm.impactLevel || 3) >= 3 ? 'bg-amber-500' : 'bg-green-500'
                          }`}>{obligationForm.impactLevel || 3}</span>
                      </div>
                      <div className="flex justify-between text-xs text-slate-500 mt-2">
                        <span>Ù…Ù†Ø®ÙØ¶</span>
                        <span>Ù…ØªÙˆØ³Ø·</span>
                        <span>Ø¹Ø§Ù„ÙŠ</span>
                      </div> </div>
                    <div className="bg-slate-50 rounded-xl p-5">
                      <label className="block text-sm font-bold text-slate-700 mb-4">Ù†ÙˆØ¹ Ø§Ù„ØªØ¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</label>
                      <div className="space-y-2">
                        {[
                          { value: 'financial', label: 'ğŸ’° Ù…Ø§Ù„ÙŠ (ØºØ±Ø§Ù…Ø§Øª)', color: 'red' },
                          { value: 'license', label: 'ğŸ“œ ØªØ±Ø®ÙŠØµ (Ø¥ÙŠÙ‚Ø§Ù/Ø³Ø­Ø¨)', color: 'purple' },
                          { value: 'reputation', label: 'ğŸ¢ Ø³Ù…Ø¹Ø© (ØªØ´Ù‡ÙŠØ±)', color: 'orange' },
                          { value: 'criminal', label: 'âš–ï¸ Ø¬Ù†Ø§Ø¦ÙŠ (Ù…Ø­Ø§ÙƒÙ…Ø©)', color: 'slate' },
                        ].map(exp => (
                          <label key={exp.value} className={`flex items-center gap-2 p-2 rounded-lg cursor-pointer ${(obligationForm.exposureTypes || []).includes(exp.value) ? `bg-${exp.color}-100` : 'hover:bg-slate-100'
                            }`}>
                            <input type="checkbox" checked={(obligationForm.exposureTypes || []).includes(exp.value)} onChange={(e) => {
                              if (e.target.checked) {
                                setObligationForm(o => ({ ...o, exposureTypes: [...(o.exposureTypes || []), exp.value] }));
                              } else {
                                setObligationForm(o => ({ ...o, exposureTypes: (o.exposureTypes || []).filter(t => t !== exp.value) }));
                              }
                            }} className="w-4 h-4 rounded" />
                            <span className="text-sm">{exp.label}</span>
                          </label>
                        ))}
                      </div> </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</label>
                    <textarea value={obligationForm.penaltyDetails || ''} onChange={(e) => setObligationForm(o => ({ ...o, penaltyDetails: e.target.value }))}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none h-20 resize-none"
                      placeholder="Ù…Ø«Ø§Ù„: ØºØ±Ø§Ù…Ø© ØªØµÙ„ Ø¥Ù„Ù‰ 100,000 Ø±ÙŠØ§Ù„ + Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…..." />
                  </div> </div>
              )}

              {(obligationForm.wizardTab || 0) === 9 && (
                <div className="space-y-5">
                  <div className="bg-violet-50 border border-violet-200 rounded-xl p-4">
                    <div className="flex items-center gap-2 text-violet-700">
                      <GitBranch className="w-5 h-5" />
                      <p className="font-bold">Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Golden Thread)</p>
                    </div>
                    <p className="text-violet-600 text-sm mt-1">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª</p>
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                      <h4 className="font-bold text-blue-700 mb-3 flex items-center gap-2">
                        <Shield className="w-5 h-5" />
                        Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                      </h4>
                      <div className="space-y-2">
                        <div className="p-2 bg-white rounded-lg border border-blue-100 text-sm">
                          <p className="font-bold text-slate-800">CTRL-001</p>
                          <p className="text-slate-600 text-xs">Ø¶Ø§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ù‡ÙˆÙŠØ©</p>
                        </div>
                        <div className="p-2 bg-white rounded-lg border border-blue-100 text-sm">
                          <p className="font-bold text-slate-800">CTRL-002</p>
                          <p className="text-slate-600 text-xs">Ø¶Ø§Ø¨Ø· Ø§Ù„ØªØ´ÙÙŠØ±</p>
                        </div>
                        <button className="w-full py-2 text-blue-600 hover:bg-blue-100 rounded-lg text-sm font-bold">+ Ø±Ø¨Ø· Ø¶Ø§Ø¨Ø·</button>
                      </div> </div>
                    <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                      <h4 className="font-bold text-red-700 mb-3 flex items-center gap-2">
                        <AlertTriangle className="w-5 h-5" />
                        Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                      </h4>
                      <div className="space-y-2">
                        <div className="p-2 bg-white rounded-lg border border-red-100 text-sm">
                          <p className="font-bold text-slate-800">RISK-001</p>
                          <p className="text-slate-600 text-xs">Ù…Ø®Ø§Ø·Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                        </div>
                        <button className="w-full py-2 text-red-600 hover:bg-red-100 rounded-lg text-sm font-bold">+ Ø±Ø¨Ø· Ù…Ø®Ø§Ø·Ø±Ø©</button>
                      </div> </div>
                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                      <h4 className="font-bold text-emerald-700 mb-3 flex items-center gap-2">
                        <FileText className="w-5 h-5" />
                        Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                      </h4>
                      <div className="space-y-2">
                        <div className="p-2 bg-white rounded-lg border border-emerald-100 text-sm">
                          <p className="font-bold text-slate-800">POL-001</p>
                          <p className="text-slate-600 text-xs">Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                        </div>
                        <button className="w-full py-2 text-emerald-600 hover:bg-emerald-100 rounded-lg text-sm font-bold">+ Ø±Ø¨Ø· Ø³ÙŠØ§Ø³Ø©</button>
                      </div> </div> </div>
                  <div className="bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl p-5 border border-violet-200">
                    <h4 className="font-bold text-violet-700 mb-4">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</h4>
                    <div className="grid grid-cols-4 gap-4 text-sm">
                      <div className="bg-white rounded-lg p-3 text-center">
                        <p className="text-2xl font-black text-blue-600">{obligationForm.code || '-'}</p>
                        <p className="text-slate-500">Ø§Ù„ÙƒÙˆØ¯</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 text-center">
                        <p className="text-2xl font-black text-emerald-600">{obligationForm.severity || '-'}</p>
                        <p className="text-slate-500">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 text-center">
                        <p className="text-2xl font-black text-amber-600">{obligationForm.recurrence || '-'}</p>
                        <p className="text-slate-500">Ø§Ù„Ø¯ÙˆØ±ÙŠØ©</p>
                      </div>
                      <div className="bg-white rounded-lg p-3 text-center">
                        <p className="text-2xl font-black text-purple-600">{(obligationForm.evidenceTypes || []).length}</p>
                        <p className="text-slate-500">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©</p>
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-3">
                <button disabled={(obligationForm.wizardTab || 0) === 0} onClick={() => setObligationForm(o => ({ ...o, wizardTab: (o.wizardTab || 0) - 1 }))}
                  className="px-5 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2 transition-all shadow-sm">
                  <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <button disabled={(obligationForm.wizardTab || 0) === 9} onClick={() => setObligationForm(o => ({ ...o, wizardTab: (o.wizardTab || 0) + 1 }))}
                  className="px-5 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 disabled:opacity-50 flex items-center gap-2 transition-all shadow-sm">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                </button> </div>
              <div className="flex items-center gap-3">
                <button onClick={() => { setShowObligationModal(false); setEditMode(false); resetObligationForm(); }}
                  className="px-6 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition-all shadow-sm">
                  Ø¥Ù„ØºØ§Ø¡
                </button>
                <button onClick={editMode ? handleEditObligation : handleAddObligation} disabled={!obligationForm.title || !obligationForm.code}
                  className="flex items-center gap-2 px-8 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl disabled:opacity-50 transition-all">
                  {editMode ? <><Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</> : <><Plus className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</>}
                </button> </div> </div> </div> </div>
      )}

      {showDeleteModal && deleteTarget && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="p-6 text-center">
              <div className="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-8 h-8 text-red-600" />
              </div>
              <h3 className="text-xl font-bold text-slate-800 mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
              <p className="text-slate-600 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù {deleteTarget.type === 'program' ? 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…'}ØŸ</p>
              <div className="p-3 bg-slate-100 rounded-xl mb-4">
                <p className="font-bold text-slate-800">{deleteTarget.name || deleteTarget.title}</p>
                <p className="text-sm text-slate-500">{deleteTarget.code}</p>
              </div>
              <p className="text-red-600 text-sm font-bold">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-center gap-3">
              <button onClick={() => { setShowDeleteModal(false); setDeleteTarget(null); }} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={deleteTarget.type === 'program' ? handleDeleteProgram : handleDeleteObligation}
                className="flex items-center gap-2 px-6 py-2.5 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                <Trash2 className="w-5 h-5" />Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
              </button> </div> </div> </div>
      )}

      {showDetailModal && selectedProgram && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white shrink-0 bg-gradient-to-r ${selectedProgram.color === 'red' ? 'from-red-500 to-rose-600' :
              selectedProgram.color === 'emerald' ? 'from-emerald-500 to-teal-600' :
                selectedProgram.color === 'purple' ? 'from-purple-500 to-violet-600' :
                  selectedProgram.color === 'indigo' ? 'from-indigo-500 to-blue-600' :
                    selectedProgram.color === 'amber' ? 'from-amber-500 to-orange-600' :
                      selectedProgram.color === 'blue' ? 'from-blue-500 to-indigo-600' :
                        selectedProgram.color === 'teal' ? 'from-teal-500 to-cyan-600' :
                          selectedProgram.color === 'pink' ? 'from-pink-500 to-rose-600' :
                            selectedProgram.color === 'orange' ? 'from-orange-500 to-amber-600' :
                              selectedProgram.color === 'cyan' ? 'from-cyan-500 to-teal-600' :
                                selectedProgram.color === 'violet' ? 'from-violet-500 to-purple-600' :
                                  'from-slate-500 to-gray-600'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center text-4xl">{selectedProgram.icon}</div>
                  <div>
                    <div className="flex items-center gap-2">
                      <h2 className="text-2xl font-bold">{selectedProgram.name}</h2>
                      <span className="text-lg">{selectedProgram.country === 'SA' ? 'ğŸ‡¸ğŸ‡¦' : 'ğŸŒ'}</span>
                    </div>
                    <p className="opacity-80">{selectedProgram.nameEn} â€¢ {selectedProgram.code}</p>
                  </div> </div>
                <button onClick={() => { setShowDetailModal(false); setSelectedProgram(null); }} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-5 gap-3">
                <div className="bg-slate-50 rounded-xl p-3 text-center">
                  <p className="text-2xl font-black text-slate-800">{selectedProgram.obligations?.length || 0}</p>
                  <p className="text-xs text-slate-500">Ø§Ù„ØªØ²Ø§Ù…</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-3 text-center">
                  <p className="text-2xl font-black text-slate-800">{selectedProgram.standards?.length || 0}</p>
                  <p className="text-xs text-slate-500">Ù…Ø¹ÙŠØ§Ø±</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-3 text-center">
                  <p className="text-2xl font-black text-emerald-600">{selectedProgram.complianceRate}%</p>
                  <p className="text-xs text-slate-500">Ø§Ù…ØªØ«Ø§Ù„</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-3 text-center">
                  <p className="text-2xl font-black text-red-600">{selectedProgram.riskScore}/10</p>
                  <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø®Ø§Ø·Ø±</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-3 text-center">
                  <span className={`px-2 py-1 rounded text-xs font-bold ${selectedProgram.criticality === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>
                    {selectedProgram.criticality === 'Critical' ? 'Ø­Ø±Ø¬' : 'Ø¹Ø§Ù„ÙŠ'}
                  </span> </div> </div>
              <div className="grid grid-cols-3 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</p>
                  <p className="font-bold text-slate-800">{selectedProgram.authority}</p>
                  <p className="text-sm text-slate-600">{selectedProgram.authorityName}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                  <span className={`px-2 py-1 rounded text-xs font-bold ${selectedProgram.type === 'Mandatory' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'
                    }`}>{selectedProgram.type === 'Mandatory' ? 'Ø¥Ù„Ø²Ø§Ù…ÙŠ' : selectedProgram.type}</span>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</p>
                  <p className="font-bold text-slate-800">{selectedProgram.version}</p>
                </div> </div>
              {selectedProgram.description && (
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-xs text-slate-500 mb-2">Ø§Ù„ÙˆØµÙ</p>
                  <p className="text-slate-700">{selectedProgram.description}</p>
                </div>
              )}

              {selectedProgram.sectorAr?.length > 0 && (
                <div>
                  <h4 className="font-bold text-slate-700 mb-3">Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</h4>
                  <div className="flex flex-wrap gap-2">
                    {selectedProgram.sectorAr.map((sector, idx) => (
                      <span key={idx} className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold">{sector}</span>
                    ))}
                  </div> </div>
              )}

              {selectedProgram.penalty && (
                <div className="bg-red-50 rounded-xl p-4 border border-red-100">
                  <p className="text-xs text-red-500 mb-2 font-bold">âš ï¸ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</p>
                  <p className="text-red-700 font-medium">{selectedProgram.penalty}</p>
                </div>
              )}

              <div>
                <div className="flex items-center justify-between mb-3">
                  <h4 className="font-bold text-slate-700">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ({selectedProgram.obligations?.length || 0})</h4>
                  <button onClick={() => { setShowDetailModal(false); openAddObligation(selectedProgram); }} className="text-sm text-emerald-600 hover:underline flex items-center gap-1">
                    <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ²Ø§Ù…
                  </button> </div>
                <div className="space-y-2 max-h-60 overflow-y-auto">
                  {selectedProgram.obligations?.map((obl, idx) => (
                    <div key={idx} className="flex items-start justify-between p-3 bg-slate-50 rounded-xl group hover:bg-slate-100">
                      <div className="flex items-start gap-3 flex-1">
                        <span className="font-mono text-xs bg-white px-2 py-1 rounded border shrink-0">{obl.code}</span>
                        <div className="flex-1">
                          <p className="text-slate-800 font-medium">{obl.title}</p>
                          {obl.description && <p className="text-xs text-slate-500 mt-1">{obl.description}</p>}
                        </div>
                        <span className={`px-2 py-1 rounded text-xs font-bold shrink-0 ${obl.severity === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>{obl.severity}</span>
                      </div>
                      <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all mr-2">
                        <button onClick={() => { setShowDetailModal(false); openEditObligation(selectedProgram, obl); }} className="p-1.5 text-amber-600 hover:bg-amber-50 rounded-lg"><Edit className="w-4 h-4" /></button>
                        <button onClick={() => { setShowDetailModal(false); openDeleteObligation(obl); }} className="p-1.5 text-red-600 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /></button>
                      </div> </div>
                  ))}
                </div> </div>
              {selectedProgram.standards?.length > 0 && (
                <div>
                  <h4 className="font-bold text-slate-700 mb-3">Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ÙˆØ§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ ({selectedProgram.standards.length})</h4>
                  <div className="grid grid-cols-2 gap-2">
                    {selectedProgram.standards.map((std, idx) => (
                      <div key={idx} className="flex items-center justify-between p-3 bg-blue-50 rounded-xl">
                        <div>
                          <p className="font-mono text-xs text-blue-600">{std.code}</p>
                          <p className="text-sm text-slate-700">{std.title}</p>
                        </div>
                        <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">{std.metric}</span>
                      </div>
                    ))}
                  </div> </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => { setShowDetailModal(false); setSelectedProgram(null); }} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-2">
                <button onClick={() => { setShowDetailModal(false); openEditProgram(selectedProgram); }} className="flex items-center gap-2 px-4 py-2.5 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600">
                  <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                </button>
                {!activatedPrograms.includes(selectedProgram.id) && (
                  <button onClick={() => { setShowDetailModal(false); setShowAdvancedWizard(true); }} className="flex items-center gap-2 px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                    <Zap className="w-5 h-5" />ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                  </button>
                )}
              </div> </div> </div> </div>
      )}

      {showAdvancedWizard && selectedProgram && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center text-3xl">{selectedProgram.icon}</div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</h2>
                    <p className="text-emerald-200 text-sm">{selectedProgram.name}</p>
                  </div> </div>
                <button onClick={() => { setShowAdvancedWizard(false); setSelectedProgram(null); }} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <p className="text-emerald-700 font-bold mb-2">âœ… Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ:</p>
                <p className="text-slate-700">{selectedProgram.name} ({selectedProgram.nameEn})</p>
                <p className="text-sm text-slate-500 mt-1">Ø§Ù„Ø¬Ù‡Ø©: {selectedProgram.authorityName}</p>
              </div>
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <p className="text-amber-700 font-bold mb-2">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</p>
                <ul className="text-sm text-amber-600 space-y-1">
                  <li>â€¢ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© {selectedProgram.obligations?.length || 0} Ø§Ù„ØªØ²Ø§Ù… Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</li>
                  <li>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¨Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª</li>
                  <li>â€¢ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø©</li>
                </ul>
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowAdvancedWizard(false); setSelectedProgram(null); }} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => { handleActivateProgram(selectedProgram.id); setShowAdvancedWizard(false); setSelectedProgram(null); }}
                className="flex items-center gap-2 px-6 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                <Zap className="w-5 h-5" />ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
              </button> </div> </div> </div>
      )}

      {showRequirementModal && selectedRequirement && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center">
                    <FileText className="w-8 h-8" />
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-1 rounded">{selectedRequirement.code}</span>
                      <span className="text-xs bg-purple-400/30 px-2 py-1 rounded">{selectedRequirement.authority}</span>
                      <span className={`text-xs px-2 py-1 rounded font-bold ${selectedRequirement.criticality === 'Critical' ? 'bg-red-500' :
                        selectedRequirement.criticality === 'High' ? 'bg-orange-500' : 'bg-blue-500'
                        }`}>{selectedRequirement.criticality}</span>
                    </div>
                    <h2 className="text-xl font-bold">{selectedRequirement.titleAr}</h2>
                    <p className="text-blue-200 text-sm">{selectedRequirement.titleEn}</p>
                  </div> </div>
                <button onClick={() => { setShowRequirementModal(false); setSelectedRequirement(null); }}
                  className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-5 gap-4">
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-xs text-slate-500 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</p>
                  <p className="font-bold text-slate-800">{selectedRequirement.articleNumber}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</p>
                  <p className="font-bold text-slate-800">{selectedRequirement.frameworkCode}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-xs text-slate-500 mb-1">Ø§Ù„ØªØµÙ†ÙŠÙ</p>
                  <p className="font-bold text-slate-800">{selectedRequirement.category}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-xs text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                  <p className="font-bold text-slate-800">{selectedRequirement.effectiveDate}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-xs text-slate-500 mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                  <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedRequirement.complianceStatus === 'Compliant' ? 'bg-emerald-100 text-emerald-700' :
                    selectedRequirement.complianceStatus === 'Partial' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'
                    }`}>
                    {selectedRequirement.complianceStatus === 'Compliant' ? 'Ù…Ù„ØªØ²Ù…' :
                      selectedRequirement.complianceStatus === 'Partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…'}
                  </span> </div> </div>
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200">
                <h4 className="font-bold text-blue-800 mb-3 flex items-center gap-2">
                  <FileText className="w-5 h-5" />
                  Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨ (Ø¹Ø±Ø¨ÙŠ)
                </h4>
                <p className="text-slate-700 leading-loose text-lg">{selectedRequirement.fullTextAr}</p>
              </div>

              <div className="bg-gradient-to-r from-slate-50 to-gray-50 rounded-2xl p-6 border border-slate-200">
                <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                  <Globe className="w-5 h-5" />
                  Full Requirement Text (English)
                </h4>
                <p className="text-slate-600 leading-relaxed" dir="ltr">{selectedRequirement.fullTextEn}</p>
              </div>

              <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200">
                <h4 className="font-bold text-amber-800 mb-4 flex items-center gap-2">
                  <AlertCircle className="w-5 h-5" />
                  Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ØªÙØ³ÙŠØ±ÙŠØ© - Guidance Notes
                </h4>
                <ul className="space-y-3">
                  {selectedRequirement.guidanceNotes.map((note, idx) => (
                    <li key={idx} className="flex items-start gap-3 bg-white/60 rounded-xl p-3">
                      <span className="w-6 h-6 rounded-full bg-amber-200 text-amber-700 flex items-center justify-center text-sm font-bold shrink-0">{idx + 1}</span>
                      <p className="text-amber-900">{note}</p>
                    </li>
                  ))}
                </ul>
              </div>

              <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-6 border-2 border-emerald-200">
                <h4 className="font-bold text-emerald-800 mb-4 flex items-center gap-2">
                  <ExternalLink className="w-5 h-5" />
                  Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø±Ø³Ù…ÙŠØ© - Official Documents
                </h4>
                <div className="grid grid-cols-2 gap-4">
                  {selectedRequirement.officialDocuments.map((doc, idx) => (
                    <a key={idx} href={doc.url} target="_blank" rel="noopener noreferrer"
                      className="flex items-center gap-4 bg-white rounded-xl p-4 border border-emerald-200 hover:border-emerald-400 hover:shadow-lg transition-all group">
                      <div className="w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-200">
                        {doc.type === 'PDF' ? <FileText className="w-6 h-6 text-emerald-600" /> : <Globe className="w-6 h-6 text-emerald-600" />}
                      </div>
                      <div className="flex-1">
                        <p className="font-bold text-slate-800">{doc.name}</p>
                        <p className="text-sm text-slate-500">{doc.type} â€¢ Ø§Ù†Ù‚Ø± Ù„Ù„ÙØªØ­</p>
                      </div>
                      <ExternalLink className="w-5 h-5 text-emerald-500 group-hover:translate-x-1 transition-transform" />
                    </a>
                  ))}
                </div> </div>
              <div className="bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl p-6 border-2 border-purple-200">
                <h4 className="font-bold text-purple-800 mb-4 flex items-center gap-2">
                  <History className="w-5 h-5" />
                  Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª - Version History
                </h4>
                <div className="space-y-3">
                  {selectedRequirement.versionHistory.map((ver, idx) => (
                    <div key={idx} className={`flex items-start gap-4 p-4 rounded-xl ${idx === 0 ? 'bg-purple-100 border-2 border-purple-300' : 'bg-white border border-purple-100'}`}>
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center shrink-0 ${idx === 0 ? 'bg-purple-500 text-white' : 'bg-purple-100 text-purple-600'}`}>
                        <span className="font-bold">v{ver.version}</span>
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-1">
                          <span className="font-bold text-slate-800">Ø§Ù„Ø¥ØµØ¯Ø§Ø± {ver.version} {idx === 0 && <span className="text-xs bg-emerald-500 text-white px-2 py-0.5 rounded mr-2">Ø§Ù„Ø­Ø§Ù„ÙŠ</span>}</span>
                          <span className="text-sm text-slate-500">{ver.date}</span>
                        </div>
                        <p className="text-slate-600">{ver.changes}</p>
                      </div> </div>
                  ))}
                </div> </div>
              {selectedRequirement.crossFrameworkMapping?.length > 0 && (
                <div className="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-6 border-2 border-indigo-200">
                  <h4 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                    <GitBranch className="w-5 h-5" />
                    Ø±Ø¨Ø· Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© - Cross-Framework Mapping
                  </h4>
                  <div className="grid grid-cols-2 gap-4">
                    {selectedRequirement.crossFrameworkMapping.map((mapping, idx) => (
                      <div key={idx} className="bg-white rounded-xl p-4 border border-indigo-200">
                        <div className="flex items-center gap-2 mb-2">
                          <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{mapping.framework}</span>
                          <span className="font-mono text-sm text-slate-600">{mapping.requirement}</span>
                        </div>
                        <p className="text-slate-700">{mapping.description}</p>
                      </div>
                    ))}
                  </div> </div>
              )}

              {selectedRequirement.relatedRequirements?.length > 0 && (
                <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                  <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <Link2 className="w-5 h-5" />
                    Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©
                  </h4>
                  <div className="flex flex-wrap gap-2">
                    {selectedRequirement.relatedRequirements.map((req, idx) => (
                      <span key={idx} className="px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-mono hover:bg-slate-100 cursor-pointer">
                        {req}
                      </span>
                    ))}
                  </div> </div>
              )}

              {selectedRequirement.implementationNotes && (
                <div className="bg-gradient-to-r from-cyan-50 to-sky-50 rounded-2xl p-6 border-2 border-cyan-200">
                  <h4 className="font-bold text-cyan-800 mb-3 flex items-center gap-2">
                    <Settings className="w-5 h-5" />
                    Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                  </h4>
                  <p className="text-slate-700">{selectedRequirement.implementationNotes}</p>
                </div>
              )}

              <div className="grid grid-cols-3 gap-4">
                <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                  <p className="text-xs text-blue-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                  <p className="font-bold text-blue-800 text-lg">{selectedRequirement.effectiveDate}</p>
                </div>
                <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                  <p className="text-xs text-amber-500 mb-1">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</p>
                  <p className="font-bold text-amber-800 text-lg">{selectedRequirement.lastUpdated}</p>
                </div>
                <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                  <p className="text-xs text-purple-500 mb-1">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>
                  <p className="font-bold text-purple-800 text-lg">{selectedRequirement.nextReviewDate}</p>
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => { setShowRequirementModal(false); setSelectedRequirement(null); }}
                className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥ØºÙ„Ø§Ù‚
              </button>
              <div className="flex items-center gap-3">
                <button className="flex items-center gap-2 px-4 py-2.5 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± PDF
                </button>
                <button className="flex items-center gap-2 px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                  <Plus className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ²Ø§Ù…
                </button> </div> </div> </div> </div>
      )}

      {showGapModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-red-600 via-rose-600 to-pink-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    {gapModalMode === 'add' ? <Plus className="w-7 h-7" /> : <Edit className="w-7 h-7" />}
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">{gapModalMode === 'add' ? 'Ø¥Ø¶Ø§ÙØ© ÙØ¬ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©' : 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ©'}</h2>
                    <p className="text-red-200">Gap Analysis - {gapModalMode === 'add' ? 'New Gap' : 'Edit Gap'}</p>
                  </div> </div>
                <button onClick={() => setShowGapModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ *</label>
                  <select value={gapForm.framework} onChange={(e) => setGapForm({ ...gapForm, framework: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø·Ø§Ø±</option>
                    <option value="SAMA-CSF">SAMA-CSF - Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                    <option value="SAMA-AML">SAMA-AML - Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</option>
                    <option value="NCA-ECC">NCA-ECC - Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                    <option value="SDAIA-PDPL">SDAIA-PDPL - Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</option>
                    <option value="ISO27001">ISO 27001 - Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                    <option value="PCI-DSS">PCI-DSS - Ø£Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·Ù„Ø¨ *</label>
                  <input type="text" value={gapForm.requirement} onChange={(e) => setGapForm({ ...gapForm, requirement: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="Ù…Ø«Ø§Ù„: SAMA-CSF-003" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨ (Ø¹Ø±Ø¨ÙŠ) *</label>
                  <input type="text" value={gapForm.requirementTitle} onChange={(e) => setGapForm({ ...gapForm, requirementTitle: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                  <input type="text" value={gapForm.requirementTitleEn} onChange={(e) => setGapForm({ ...gapForm, requirementTitleEn: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="Requirement Title in English" dir="ltr" />
                </div> </div>
              <div className="grid grid-cols-4 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© *</label>
                  <select value={gapForm.currentStatus} onChange={(e) => setGapForm({ ...gapForm, currentStatus: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none">
                    <option value="Non-Compliant">ØºÙŠØ± Ù…Ù„ØªØ²Ù…</option>
                    <option value="Partial">Ø¬Ø²Ø¦ÙŠ</option>
                    <option value="Compliant">Ù…Ù„ØªØ²Ù…</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ¬ÙˆØ© *</label>
                  <select value={gapForm.gapLevel} onChange={(e) => setGapForm({ ...gapForm, gapLevel: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none">
                    <option value="High">Ø¹Ø§Ù„ÙŠ</option>
                    <option value="Medium">Ù…ØªÙˆØ³Ø·</option>
                    <option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                    <option value="None">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ©</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© *</label>
                  <select value={gapForm.priority} onChange={(e) => setGapForm({ ...gapForm, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                  <input type="date" value={gapForm.dueDate} onChange={(e) => setGapForm({ ...gapForm, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                  <label className="block text-sm font-bold text-red-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ (1-5)</label>
                  <div className="flex items-center gap-4">
                    <input type="range" min="1" max="5" value={gapForm.currentMaturity}
                      onChange={(e) => setGapForm({ ...gapForm, currentMaturity: parseInt(e.target.value) })}
                      className="flex-1 h-2 bg-red-200 rounded-lg appearance-none cursor-pointer" />
                    <span className="w-12 h-12 rounded-xl bg-red-500 text-white flex items-center justify-center text-xl font-bold">{gapForm.currentMaturity}</span>
                  </div> </div>
                <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                  <label className="block text-sm font-bold text-emerald-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (1-5)</label>
                  <div className="flex items-center gap-4">
                    <input type="range" min="1" max="5" value={gapForm.targetMaturity}
                      onChange={(e) => setGapForm({ ...gapForm, targetMaturity: parseInt(e.target.value) })}
                      className="flex-1 h-2 bg-emerald-200 rounded-lg appearance-none cursor-pointer" />
                    <span className="w-12 h-12 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-xl font-bold">{gapForm.targetMaturity}</span>
                  </div> </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„ÙØ¬ÙˆØ© *</label>
                <textarea value={gapForm.gapDescription} onChange={(e) => setGapForm({ ...gapForm, gapDescription: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none h-24 resize-none"
                  placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„ÙØ¬ÙˆØ© Ø¨ÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…Ø·Ù„ÙˆØ¨" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© *</label>
                <textarea value={gapForm.remediationPlan} onChange={(e) => setGapForm({ ...gapForm, remediationPlan: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none h-24 resize-none"
                  placeholder="Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø³Ø¯ Ø§Ù„ÙØ¬ÙˆØ©" />
              </div>

              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø© (Ø±ÙŠØ§Ù„)</label>
                  <input type="number" value={gapForm.estimatedCost} onChange={(e) => setGapForm({ ...gapForm, estimatedCost: parseInt(e.target.value) || 0 })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="0" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                  <input type="text" value={gapForm.estimatedEffort} onChange={(e) => setGapForm({ ...gapForm, estimatedEffort: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="Ù…Ø«Ø§Ù„: 30 ÙŠÙˆÙ…" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                  <input type="text" value={gapForm.owner} onChange={(e) => setGapForm({ ...gapForm, owner: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none"
                    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                <textarea value={gapForm.notes} onChange={(e) => setGapForm({ ...gapForm, notes: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-400 focus:outline-none h-20 resize-none"
                  placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" />
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowGapModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleSaveGap} disabled={!gapForm.framework || !gapForm.requirement || !gapForm.requirementTitle || !gapForm.gapDescription}
                className="px-6 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold hover:from-red-600 hover:to-rose-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                <Save className="w-5 h-5" />{gapModalMode === 'add' ? 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¬ÙˆØ©' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
              </button> </div> </div> </div>
      )}

      {showGapDetailModal && selectedGap && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white shrink-0 bg-gradient-to-r ${selectedGap.gapLevel === 'High' ? 'from-red-600 to-rose-700' :
              selectedGap.gapLevel === 'Medium' ? 'from-amber-500 to-orange-600' :
                selectedGap.gapLevel === 'None' ? 'from-emerald-500 to-teal-600' : 'from-slate-600 to-gray-700'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center">
                    <Target className="w-8 h-8" />
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-1 rounded">{selectedGap.id}</span>
                      <span className="text-xs bg-white/20 px-2 py-1 rounded">{selectedGap.framework}</span>
                      <span className={`text-xs px-2 py-1 rounded font-bold ${selectedGap.priority === 'Critical' ? 'bg-red-400' : selectedGap.priority === 'High' ? 'bg-orange-400' : 'bg-blue-400'
                        }`}>{selectedGap.priority}</span>
                    </div>
                    <h2 className="text-xl font-bold">{selectedGap.requirementTitle}</h2>
                    <p className="opacity-80 text-sm">{selectedGap.requirementTitleEn}</p>
                  </div> </div>
                <button onClick={() => setShowGapDetailModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-4 gap-4">
                <div className={`rounded-xl p-4 ${selectedGap.currentStatus === 'Compliant' ? 'bg-emerald-50 border-2 border-emerald-200' :
                  selectedGap.currentStatus === 'Partial' ? 'bg-amber-50 border-2 border-amber-200' : 'bg-red-50 border-2 border-red-200'
                  }`}>
                  <p className="text-xs font-bold mb-1">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                  <p className="text-xl font-black">{selectedGap.currentStatus === 'Compliant' ? 'Ù…Ù„ØªØ²Ù…' : selectedGap.currentStatus === 'Partial' ? 'Ø¬Ø²Ø¦ÙŠ' : 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…'}</p>
                </div>
                <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                  <p className="text-xs text-blue-600 font-bold mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
                  <p className="text-xl font-black text-blue-700">{selectedGap.progress || 0}%</p>
                </div>
                <div className="bg-purple-50 rounded-xl p-4 border-2 border-purple-200">
                  <p className="text-xs text-purple-600 font-bold mb-1">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</p>
                  <p className="text-xl font-black text-purple-700">{selectedGap.estimatedCost?.toLocaleString()} Ø±ÙŠØ§Ù„</p>
                </div>
                <div className={`rounded-xl p-4 ${selectedGap.dueDate && new Date(selectedGap.dueDate) < new Date() ? 'bg-red-50 border-2 border-red-200' : 'bg-slate-50 border-2 border-slate-200'
                  }`}>
                  <p className="text-xs font-bold mb-1">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                  <p className="text-xl font-black">{selectedGap.dueDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                </div> </div>
              <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                  <AlertCircle className="w-5 h-5 text-red-500" />ÙˆØµÙ Ø§Ù„ÙØ¬ÙˆØ©
                </h4>
                <p className="text-slate-700 leading-relaxed">{selectedGap.gapDescription}</p>
                {selectedGap.gapDescriptionEn && (
                  <p className="text-slate-500 text-sm mt-2" dir="ltr">{selectedGap.gapDescriptionEn}</p>
                )}
              </div>

              <div className="grid grid-cols-2 gap-6">
                <div className={`rounded-2xl p-6 border-2 ${selectedGap.currentStatus === 'Compliant' ? 'bg-emerald-50 border-emerald-200' :
                  selectedGap.currentStatus === 'Partial' ? 'bg-amber-50 border-amber-200' : 'bg-red-50 border-red-200'
                  }`}>
                  <h4 className="font-bold mb-4">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
                  <div className="flex items-center gap-4 mb-4">
                    <div className="flex-1">
                      <div className="flex justify-between text-sm mb-1">
                        <span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¶Ø¬</span>
                        <span className="font-bold">{selectedGap.currentMaturity}/5</span>
                      </div>
                      <div className="w-full bg-white rounded-full h-4">
                        <div className={`h-4 rounded-full ${selectedGap.currentStatus === 'Compliant' ? 'bg-emerald-500' :
                          selectedGap.currentStatus === 'Partial' ? 'bg-amber-500' : 'bg-red-500'
                          }`} style={{ width: `${selectedGap.currentMaturity * 20}%` }}></div>
                      </div> </div> </div>
                  <div className="grid grid-cols-5 gap-1">
                    {[1, 2, 3, 4, 5].map(level => (
                      <div key={level} className={`h-8 rounded flex items-center justify-center text-xs font-bold ${level <= selectedGap.currentMaturity ? (
                        selectedGap.currentStatus === 'Compliant' ? 'bg-emerald-500 text-white' :
                          selectedGap.currentStatus === 'Partial' ? 'bg-amber-500 text-white' : 'bg-red-500 text-white'
                      ) : 'bg-white text-slate-400'
                        }`}>{level}</div>
                    ))}
                  </div> </div>
                <div className="bg-emerald-50 rounded-2xl p-6 border-2 border-emerald-200">
                  <h4 className="font-bold text-emerald-800 mb-4">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</h4>
                  <div className="flex items-center gap-4 mb-4">
                    <div className="flex-1">
                      <div className="flex justify-between text-sm mb-1">
                        <span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¶Ø¬</span>
                        <span className="font-bold">{selectedGap.targetMaturity}/5</span>
                      </div>
                      <div className="w-full bg-emerald-200 rounded-full h-4">
                        <div className="bg-emerald-500 h-4 rounded-full" style={{ width: `${selectedGap.targetMaturity * 20}%` }}></div>
                      </div> </div> </div>
                  <div className="grid grid-cols-5 gap-1">
                    {[1, 2, 3, 4, 5].map(level => (
                      <div key={level} className={`h-8 rounded flex items-center justify-center text-xs font-bold ${level <= selectedGap.targetMaturity ? 'bg-emerald-500 text-white' : 'bg-white text-slate-400'
                        }`}>{level}</div>
                    ))}
                  </div> </div> </div>
              <div className="bg-blue-50 rounded-2xl p-6 border-2 border-blue-200">
                <h4 className="font-bold text-blue-800 mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5" />Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                </h4>
                <p className="text-slate-700 mb-4">{selectedGap.remediationPlan}</p>

                {selectedGap.remediationSteps && selectedGap.remediationSteps.length > 0 && (
                  <div className="mt-4">
                    <p className="font-bold text-blue-700 mb-3">Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°:</p>
                    <div className="space-y-2">
                      {selectedGap.remediationSteps.map((step, idx) => (
                        <div key={idx} className={`flex items-center gap-3 p-3 rounded-xl ${idx < Math.ceil((selectedGap.progress || 0) / 25) ? 'bg-emerald-100 border border-emerald-300' : 'bg-white border border-blue-200'
                          }`}>
                          <span className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${idx < Math.ceil((selectedGap.progress || 0) / 25) ? 'bg-emerald-500 text-white' : 'bg-blue-200 text-blue-700'
                            }`}>{idx + 1}</span>
                          <span className={idx < Math.ceil((selectedGap.progress || 0) / 25) ? 'text-emerald-800 line-through' : 'text-slate-700'}>{step}</span>
                          {idx < Math.ceil((selectedGap.progress || 0) / 25) && <CheckCircle2 className="w-5 h-5 text-emerald-500 mr-auto" />}
                        </div>
                      ))}
                    </div> </div>
                )}
              </div>

              <div className="grid grid-cols-2 gap-6">
                <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                  <h4 className="font-bold text-slate-800 mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h4>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span>
                      <span className="font-bold">{selectedGap.owner}</span>
                    </div>
                    {selectedGap.ownerEmail && (
                      <div className="flex items-center justify-between">
                        <span className="text-slate-600">Ø§Ù„Ø¨Ø±ÙŠØ¯:</span>
                        <span className="font-mono text-sm">{selectedGap.ownerEmail}</span>
                      </div>
                    )}
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
                      <span className="font-bold">{selectedGap.estimatedEffort}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</span>
                      <span>{selectedGap.createdAt}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                      <span>{selectedGap.updatedAt}</span>
                    </div> </div> </div>
                <div className="space-y-4">
                  {selectedGap.risks && selectedGap.risks.length > 0 && (
                    <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                      <h5 className="font-bold text-red-700 mb-2">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</h5>
                      <ul className="space-y-1">
                        {selectedGap.risks.map((risk, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-red-600">
                            <AlertTriangle className="w-4 h-4" />{risk}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {selectedGap.dependencies && selectedGap.dependencies.length > 0 && (
                    <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                      <h5 className="font-bold text-purple-700 mb-2">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©</h5>
                      <ul className="space-y-1">
                        {selectedGap.dependencies.map((dep, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-purple-600">
                            <Link2 className="w-4 h-4" />{dep}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div> </div>
              {selectedGap.notes && (
                <div className="bg-amber-50 rounded-2xl p-6 border border-amber-200">
                  <h4 className="font-bold text-amber-800 mb-3 flex items-center gap-2">
                    <FileText className="w-5 h-5" />Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                  </h4>
                  <p className="text-slate-700">{selectedGap.notes}</p>
                </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowGapDetailModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥ØºÙ„Ø§Ù‚
              </button>
              <div className="flex items-center gap-3">
                <button onClick={() => { setShowGapDetailModal(false); openEditGap(selectedGap); }}
                  className="px-4 py-2.5 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 flex items-center gap-2">
                  <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button className="px-4 py-2.5 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600 flex items-center gap-2">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± PDF
                </button> </div> </div> </div> </div>
      )}

      {showGapDeleteModal && selectedGap && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Trash2 className="w-6 h-6" />
                </div>
                <div>
                  <h3 className="text-lg font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
                  <p className="text-red-200 text-sm">Delete Confirmation</p>
                </div> </div> </div>
            <div className="p-6">
              <p className="text-slate-700 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ¬ÙˆØ©ØŸ</p>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <p className="font-mono text-sm text-red-600 mb-1">{selectedGap.id} - {selectedGap.requirement}</p>
                <p className="font-bold text-slate-800">{selectedGap.requirementTitle}</p>
              </div>
              <p className="text-red-600 text-sm mt-4">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-end gap-3">
              <button onClick={() => setShowGapDeleteModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleDeleteGap} className="px-6 py-2.5 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 flex items-center gap-2">
                <Trash2 className="w-5 h-5" />Ø­Ø°Ù
              </button> </div> </div> </div>
      )}

      {showImpactModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-orange-600 via-red-600 to-rose-700 px-6 py-5 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center">
                    {impactModalMode === 'add' ? <Plus className="w-7 h-7" /> : <Edit className="w-7 h-7" />}
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">{impactModalMode === 'add' ? 'Ø¥Ø¶Ø§ÙØ© ØªØºÙŠÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ' : 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ'}</h2>
                    <p className="text-orange-200">Impact Assessment - {impactModalMode === 'add' ? 'New' : 'Edit'}</p>
                  </div> </div>
                <button onClick={() => setShowImpactModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                  <select value={impactForm.authority} onChange={(e) => setImpactForm({ ...impactForm, authority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©</option>
                    <option value="SAMA">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
                    <option value="NCA">NCA - Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                    <option value="SDAIA">SDAIA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                    <option value="CMA">CMA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                    <option value="ZATCA">ZATCA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø©</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ *</label>
                  <input type="text" value={impactForm.framework} onChange={(e) => setImpactForm({ ...impactForm, framework: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="Ù…Ø«Ø§Ù„: SAMA-AML" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¹Ø±Ø¨ÙŠ) *</label>
                  <input type="text" value={impactForm.title} onChange={(e) => setImpactForm({ ...impactForm, title: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                  <input type="text" value={impactForm.titleEn} onChange={(e) => setImpactForm({ ...impactForm, titleEn: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="Title in English" dir="ltr" />
                </div> </div>
              <div className="grid grid-cols-4 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ± *</label>
                  <select value={impactForm.changeType} onChange={(e) => setImpactForm({ ...impactForm, changeType: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none">
                    <option value="Amendment">ØªØ¹Ø¯ÙŠÙ„</option>
                    <option value="New Requirement">Ù…ØªØ·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø± *</label>
                  <select value={impactForm.impactLevel} onChange={(e) => setImpactForm({ ...impactForm, impactLevel: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø© *</label>
                  <select value={impactForm.status} onChange={(e) => setImpactForm({ ...impactForm, status: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none">
                    <option value="Upcoming">Ù‚Ø§Ø¯Ù…</option>
                    <option value="Active">Ù†Ø´Ø·</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­</label>
                  <input type="text" value={impactForm.gracePeriod} onChange={(e) => setImpactForm({ ...impactForm, gracePeriod: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="Ù…Ø«Ø§Ù„: 90 days" />
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</label>
                  <input type="date" value={impactForm.publishDate} onChange={(e) => setImpactForm({ ...impactForm, publishDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù† *</label>
                  <input type="date" value={impactForm.effectiveDate} onChange={(e) => setImpactForm({ ...impactForm, effectiveDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ *</label>
                <textarea value={impactForm.description} onChange={(e) => setImpactForm({ ...impactForm, description: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none h-24 resize-none"
                  placeholder="ÙˆØµÙ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ" />
              </div>

              <div className="bg-orange-50 rounded-xl p-4 border border-orange-200">
                <h4 className="font-bold text-orange-800 mb-4">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø±</h4>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© (Ø±ÙŠØ§Ù„)</label>
                    <input type="number" value={impactForm.impactAssessment?.estimatedCost || 0}
                      onChange={(e) => setImpactForm({ ...impactForm, impactAssessment: { ...impactForm.impactAssessment, estimatedCost: parseInt(e.target.value) || 0 } })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none" />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                    <input type="text" value={impactForm.impactAssessment?.estimatedEffort || ''}
                      onChange={(e) => setImpactForm({ ...impactForm, impactAssessment: { ...impactForm.impactAssessment, estimatedEffort: e.target.value } })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                      placeholder="Ù…Ø«Ø§Ù„: 3-6 Ø£Ø´Ù‡Ø±" />
                  </div> </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                  <input type="text" value={impactForm.owner} onChange={(e) => setImpactForm({ ...impactForm, owner: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</label>
                  <input type="url" value={impactForm.documentUrl} onChange={(e) => setImpactForm({ ...impactForm, documentUrl: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none"
                    placeholder="https://..." dir="ltr" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea value={impactForm.notes} onChange={(e) => setImpactForm({ ...impactForm, notes: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-orange-400 focus:outline-none h-20 resize-none"
                  placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" />
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowImpactModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleSaveImpact} disabled={!impactForm.authority || !impactForm.title || !impactForm.effectiveDate}
                className="px-6 py-2.5 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl font-bold hover:from-orange-600 hover:to-red-700 disabled:opacity-50 flex items-center gap-2">
                <Save className="w-5 h-5" />{impactModalMode === 'add' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
              </button> </div> </div> </div>
      )}

      {showImpactDetailModal && selectedImpact && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white shrink-0 bg-gradient-to-r ${selectedImpact.impactLevel === 'Critical' ? 'from-red-600 to-rose-700' :
              selectedImpact.impactLevel === 'High' ? 'from-orange-500 to-amber-600' : 'from-blue-500 to-indigo-600'
              }`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center">
                    {selectedImpact.changeType === 'New Requirement' ? <FilePlus className="w-8 h-8" /> : <FileText className="w-8 h-8" />}
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-1 rounded">{selectedImpact.id}</span>
                      <span className="text-xs bg-white/20 px-2 py-1 rounded">{selectedImpact.authority}</span>
                      <span className={`text-xs px-2 py-1 rounded font-bold ${selectedImpact.status === 'Active' ? 'bg-emerald-400' : 'bg-amber-400'
                        }`}>{selectedImpact.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù‚Ø§Ø¯Ù…'}</span>
                    </div>
                    <h2 className="text-xl font-bold">{selectedImpact.title}</h2>
                    <p className="opacity-80 text-sm">{selectedImpact.titleEn}</p>
                  </div> </div>
                <button onClick={() => setShowImpactDetailModal(false)} className="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 flex items-center justify-center">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="grid grid-cols-5 gap-4">
                <div className={`rounded-xl p-4 ${selectedImpact.impactLevel === 'Critical' ? 'bg-red-50 border-2 border-red-200' :
                  selectedImpact.impactLevel === 'High' ? 'bg-orange-50 border-2 border-orange-200' : 'bg-blue-50 border-2 border-blue-200'
                  }`}>
                  <p className="text-xs font-bold mb-1">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±</p>
                  <p className="text-xl font-black">{selectedImpact.impactLevel === 'Critical' ? 'Ø­Ø±Ø¬' : selectedImpact.impactLevel === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}</p>
                </div>
                <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                  <p className="text-xs text-blue-600 font-bold mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
                  <p className="text-xl font-black text-blue-700">{selectedImpact.progress || 0}%</p>
                </div>
                <div className="bg-purple-50 rounded-xl p-4 border-2 border-purple-200">
                  <p className="text-xs text-purple-600 font-bold mb-1">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</p>
                  <p className="text-lg font-black text-purple-700">{((selectedImpact.impactAssessment?.estimatedCost || 0) / 1000).toLocaleString()}K</p>
                </div>
                <div className="bg-cyan-50 rounded-xl p-4 border-2 border-cyan-200">
                  <p className="text-xs text-cyan-600 font-bold mb-1">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­</p>
                  <p className="text-lg font-black text-cyan-700">{selectedImpact.gracePeriod}</p>
                </div>
                <div className={`rounded-xl p-4 ${new Date(selectedImpact.effectiveDate) < new Date() ? 'bg-emerald-50 border-2 border-emerald-200' : 'bg-amber-50 border-2 border-amber-200'
                  }`}>
                  <p className="text-xs font-bold mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†</p>
                  <p className="text-lg font-black">{selectedImpact.effectiveDate}</p>
                </div> </div>
              <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                <h4 className="font-bold text-slate-800 mb-3">Ø§Ù„ÙˆØµÙ</h4>
                <p className="text-slate-700 leading-relaxed">{selectedImpact.description}</p>
                {selectedImpact.descriptionEn && (
                  <p className="text-slate-500 text-sm mt-2" dir="ltr">{selectedImpact.descriptionEn}</p>
                )}
              </div>

              {selectedImpact.affectedRequirements?.length > 0 && (
                <div className="bg-purple-50 rounded-2xl p-6 border border-purple-200">
                  <h4 className="font-bold text-purple-800 mb-3">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</h4>
                  <div className="flex flex-wrap gap-2">
                    {selectedImpact.affectedRequirements.map((req, idx) => (
                      <span key={idx} className="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-mono text-sm font-bold">{req}</span>
                    ))}
                  </div> </div>
              )}

              <div className="bg-orange-50 rounded-2xl p-6 border border-orange-200">
                <h4 className="font-bold text-orange-800 mb-4">ØªÙØ§ØµÙŠÙ„ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø±</h4>
                <div className="grid grid-cols-3 gap-6">
                  {selectedImpact.impactAssessment?.systems?.length > 0 && (
                    <div>
                      <p className="text-sm font-bold text-orange-700 mb-2">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                      <ul className="space-y-1">
                        {selectedImpact.impactAssessment.systems.map((sys, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-sm text-slate-700">
                            <span className="w-2 h-2 rounded-full bg-orange-400"></span>{sys}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {selectedImpact.impactAssessment?.processes?.length > 0 && (
                    <div>
                      <p className="text-sm font-bold text-orange-700 mb-2">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                      <ul className="space-y-1">
                        {selectedImpact.impactAssessment.processes.map((proc, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-sm text-slate-700">
                            <span className="w-2 h-2 rounded-full bg-orange-400"></span>{proc}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {selectedImpact.impactAssessment?.training?.length > 0 && (
                    <div>
                      <p className="text-sm font-bold text-orange-700 mb-2">Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
                      <ul className="space-y-1">
                        {selectedImpact.impactAssessment.training.map((train, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-sm text-slate-700">
                            <span className="w-2 h-2 rounded-full bg-orange-400"></span>{train}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div> </div>
              {selectedImpact.actionPlan?.length > 0 && (
                <div className="bg-blue-50 rounded-2xl p-6 border border-blue-200">
                  <h4 className="font-bold text-blue-800 mb-4">Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„</h4>
                  <div className="space-y-3">
                    {selectedImpact.actionPlan.map((step, idx) => (
                      <div key={idx} className={`flex items-center justify-between p-4 rounded-xl ${step.status === 'Completed' ? 'bg-emerald-100 border border-emerald-300' :
                        step.status === 'In Progress' ? 'bg-blue-100 border border-blue-300' : 'bg-white border border-slate-200'
                        }`}>
                        <div className="flex items-center gap-3">
                          <span className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${step.status === 'Completed' ? 'bg-emerald-500 text-white' :
                            step.status === 'In Progress' ? 'bg-blue-500 text-white' : 'bg-slate-300 text-slate-600'
                            }`}>{idx + 1}</span>
                          <span className={step.status === 'Completed' ? 'line-through text-emerald-700' : 'text-slate-700'}>{step.step}</span>
                        </div>
                        <div className="flex items-center gap-3">
                          <span className="text-sm text-slate-500">{step.dueDate}</span>
                          {step.status === 'Completed' && <CheckCircle2 className="w-5 h-5 text-emerald-500" />}
                          {step.status === 'In Progress' && <Clock className="w-5 h-5 text-blue-500" />}
                        </div> </div>
                    ))}
                  </div> </div>
              )}

              <div className="grid grid-cols-2 gap-6">
                <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                  <h4 className="font-bold text-slate-800 mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h4>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span>
                      <span className="font-bold">{selectedImpact.owner}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
                      <span className="font-bold">{selectedImpact.impactAssessment?.estimatedEffort || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±:</span>
                      <span>{selectedImpact.publishDate}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                      <span>{selectedImpact.updatedAt}</span>
                    </div> </div> </div>
                {selectedImpact.notes && (
                  <div className="bg-amber-50 rounded-2xl p-6 border border-amber-200">
                    <h4 className="font-bold text-amber-800 mb-3">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
                    <p className="text-slate-700">{selectedImpact.notes}</p>
                  </div>
                )}
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <button onClick={() => setShowImpactDetailModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥ØºÙ„Ø§Ù‚
              </button>
              <div className="flex items-center gap-3">
                {selectedImpact.documentUrl && (
                  <a href={selectedImpact.documentUrl} target="_blank" rel="noopener noreferrer"
                    className="px-4 py-2.5 bg-slate-500 text-white rounded-xl font-bold hover:bg-slate-600 flex items-center gap-2">
                    <ExternalLink className="w-5 h-5" />Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©
                  </a>
                )}
                <button onClick={() => { setShowImpactDetailModal(false); openEditImpact(selectedImpact); }}
                  className="px-4 py-2.5 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 flex items-center gap-2">
                  <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                </button> </div> </div> </div> </div>
      )}

      {showImpactDeleteModal && selectedImpact && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <Trash2 className="w-6 h-6" />
                </div>
                <div>
                  <h3 className="text-lg font-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
                  <p className="text-red-200 text-sm">Delete Regulatory Change</p>
                </div> </div> </div>
            <div className="p-6">
              <p className="text-slate-700 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØŸ</p>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <p className="font-mono text-sm text-red-600 mb-1">{selectedImpact.id} - {selectedImpact.authority}</p>
                <p className="font-bold text-slate-800">{selectedImpact.title}</p>
              </div>
              <p className="text-red-600 text-sm mt-4">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-end gap-3">
              <button onClick={() => setShowImpactDeleteModal(false)} className="px-6 py-2.5 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-white">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={handleDeleteImpact} className="px-6 py-2.5 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 flex items-center gap-2">
                <Trash2 className="w-5 h-5" />Ø­Ø°Ù
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 0: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Identity & Access Management)
// Bank-Grade RBAC + SoD + DOA + Multi-Entity System

// IAM API LAYER - Mock In-Memory Database with Async Operations

const IAM_API = {
  // MULTI-ENTITY HIERARCHY (Tenant â†’ Legal Entities â†’ BUs â†’ Sites)
  tenant: {
    id: 'TENANT-001', name: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©', nameEn: 'Al-Bousairy Holding Group', country: 'SA',
    industry: 'Financial Services', status: 'Active', createdAt: '2020-01-01',
  },

  legalEntities: [
    { id: 'LE-001', tenantId: 'TENANT-001', code: 'ABB', name: 'Ø¨Ù†Ùƒ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ', nameEn: 'Al-Bousairy Bank', type: 'Bank', regulator: 'SAMA', status: 'Active', parentId: null },
    { id: 'LE-002', tenantId: 'TENANT-001', code: 'ABI', name: 'Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±', nameEn: 'Al-Bousairy Investment', type: 'Investment', regulator: 'CMA', status: 'Active', parentId: null },
    { id: 'LE-003', tenantId: 'TENANT-001', code: 'ABT', name: 'Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ù„Ù„ØªØ£Ù…ÙŠÙ†', nameEn: 'Al-Bousairy Insurance', type: 'Insurance', regulator: 'SAMA', status: 'Active', parentId: null },
    { id: 'LE-004', tenantId: 'TENANT-001', code: 'ABF', name: 'Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ù„Ù„ØªÙ…ÙˆÙŠÙ„', nameEn: 'Al-Bousairy Finance', type: 'Finance', regulator: 'SAMA', status: 'Active', parentId: 'LE-001' },
  ],

  businessUnits: [
    { id: 'BU-001', entityId: 'LE-001', code: 'GRC', name: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'GRC', status: 'Active' },
    { id: 'BU-002', entityId: 'LE-001', code: 'OPS', name: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ©', nameEn: 'Banking Operations', status: 'Active' },
    { id: 'BU-003', entityId: 'LE-001', code: 'IT', name: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'IT', status: 'Active' },
    { id: 'BU-004', entityId: 'LE-001', code: 'HR', name: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', nameEn: 'Human Resources', status: 'Active' },
    { id: 'BU-005', entityId: 'LE-001', code: 'FIN', name: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Finance', status: 'Active' },
    { id: 'BU-006', entityId: 'LE-002', code: 'AM', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„', nameEn: 'Asset Management', status: 'Active' },
    { id: 'BU-007', entityId: 'LE-002', code: 'WM', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«Ø±ÙˆØ§Øª', nameEn: 'Wealth Management', status: 'Active' },
    { id: 'BU-008', entityId: 'LE-003', code: 'UW', name: 'Ø§Ù„Ø§ÙƒØªØªØ§Ø¨', nameEn: 'Underwriting', status: 'Active' },
  ],

  sites: [
    { id: 'SITE-001', entityId: 'LE-001', buId: 'BU-002', code: 'HQ', name: 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ù„Ø±ÙŠØ§Ø¶', nameEn: 'HQ Riyadh', city: 'Riyadh', status: 'Active' },
    { id: 'SITE-002', entityId: 'LE-001', buId: 'BU-002', code: 'JED', name: 'ÙØ±Ø¹ Ø¬Ø¯Ø©', nameEn: 'Jeddah Branch', city: 'Jeddah', status: 'Active' },
    { id: 'SITE-003', entityId: 'LE-001', buId: 'BU-002', code: 'DMM', name: 'ÙØ±Ø¹ Ø§Ù„Ø¯Ù…Ø§Ù…', nameEn: 'Dammam Branch', city: 'Dammam', status: 'Active' },
    { id: 'SITE-004', entityId: 'LE-002', buId: null, code: 'INV-HQ', name: 'Ù…Ù‚Ø± Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±', nameEn: 'Investment HQ', city: 'Riyadh', status: 'Active' },
    { id: 'SITE-005', entityId: 'LE-001', buId: 'BU-002', code: 'MEK', name: 'ÙØ±Ø¹ Ù…ÙƒØ©', nameEn: 'Makkah Branch', city: 'Makkah', status: 'Active' },
    { id: 'SITE-006', entityId: 'LE-001', buId: 'BU-002', code: 'MED', name: 'ÙØ±Ø¹ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', nameEn: 'Madinah Branch', city: 'Madinah', status: 'Active' },
    { id: 'SITE-007', entityId: 'LE-003', buId: 'BU-008', code: 'INS-HQ', name: 'Ù…Ù‚Ø± Ø§Ù„ØªØ£Ù…ÙŠÙ† - Ø§Ù„Ø±ÙŠØ§Ø¶', nameEn: 'Insurance HQ', city: 'Riyadh', status: 'Active' },
    { id: 'SITE-008', entityId: 'LE-003', buId: 'BU-008', code: 'INS-JED', name: 'ÙØ±Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ† - Ø¬Ø¯Ø©', nameEn: 'Insurance Jeddah', city: 'Jeddah', status: 'Active' },
    { id: 'SITE-009', entityId: 'LE-004', buId: null, code: 'FIN-HQ', name: 'Ù…Ù‚Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„', nameEn: 'Finance HQ', city: 'Riyadh', status: 'Active' },
    { id: 'SITE-010', entityId: 'LE-002', buId: 'BU-007', code: 'WM-HQ', name: 'Ù…Ù‚Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«Ø±ÙˆØ§Øª', nameEn: 'Wealth Management HQ', city: 'Riyadh', status: 'Active' },
  ],

  // USERS WITH ENTITY SCOPE
  users: [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', email: 'ahmed.ghamdi@albousairy.sa', phone: '+966501234567', entityScope: 'LE-001', buScope: 'BU-001', siteScope: null, department: 'GRC', jobTitle: 'Compliance Officer', managerId: 2, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-04T08:30:00Z', createdAt: '2024-01-15' },
    { id: 2, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', email: 'sara.qahtani@albousairy.sa', phone: '+966502345678', entityScope: 'TENANT-001', buScope: null, siteScope: null, department: 'GRC', jobTitle: 'Compliance Manager', managerId: 3, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-04T09:15:00Z', createdAt: '2024-02-01' },
    { id: 3, name: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', email: 'mohammed.otaibi@albousairy.sa', phone: '+966503456789', entityScope: 'TENANT-001', buScope: null, siteScope: null, department: 'Executive', jobTitle: 'CCO', managerId: null, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-03T14:20:00Z', createdAt: '2024-01-10' },
    { id: 4, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', email: 'fatima.dosari@albousairy.sa', phone: '+966504567890', entityScope: 'LE-001', buScope: null, siteScope: null, department: 'Audit', jobTitle: 'Internal Auditor', managerId: 3, status: 'Active', mfaEnabled: false, lastLogin: '2025-02-02T11:00:00Z', createdAt: '2024-03-01' },
    { id: 5, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø´Ù…Ø±ÙŠ', email: 'khaled.shammari@albousairy.sa', phone: '+966505678901', entityScope: 'TENANT-001', buScope: null, siteScope: null, department: 'IT', jobTitle: 'System Admin', managerId: 3, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-04T07:45:00Z', createdAt: '2024-01-20' },
    { id: 6, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠ', email: 'noura.amri@albousairy.sa', phone: '+966506789012', entityScope: 'LE-002', buScope: 'BU-006', siteScope: null, department: 'GRC', jobTitle: 'Compliance Officer', managerId: 2, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-03T10:00:00Z', createdAt: '2024-04-01' },
    { id: 7, name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø¨ÙŠ', email: 'abdullah.harbi@albousairy.sa', phone: '+966507890123', entityScope: 'LE-001', buScope: 'BU-002', siteScope: 'SITE-002', department: 'Operations', jobTitle: 'Branch Compliance', managerId: 1, status: 'Active', mfaEnabled: true, lastLogin: '2025-02-04T08:00:00Z', createdAt: '2024-05-15' },
    { id: 8, name: 'Ø±ÙŠÙ… Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ', email: 'reem.subaie@albousairy.sa', phone: '+966508901234', entityScope: 'LE-003', buScope: null, siteScope: null, department: 'GRC', jobTitle: 'Compliance Officer', managerId: 2, status: 'Inactive', mfaEnabled: false, lastLogin: '2024-12-15T10:00:00Z', createdAt: '2024-06-01' },
  ],

  // ROLES
  roles: [
    { id: 1, code: 'COMPLIANCE_OFFICER', name: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance Officer', description: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', level: 3, status: 'Active' },
    { id: 2, code: 'COMPLIANCE_MANAGER', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance Manager', description: 'Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©', level: 2, status: 'Active' },
    { id: 3, code: 'CCO', name: 'Ø±Ø¦ÙŠØ³ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Chief Compliance Officer', description: 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø±Ù‚Ø§Ø¨Ø©', level: 1, status: 'Active' },
    { id: 4, code: 'AUDITOR_VIEWER', name: 'Ù…Ø±Ø§Ø¬Ø¹ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·)', nameEn: 'Auditor Viewer', description: 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„', level: 4, status: 'Active' },
    { id: 5, code: 'ADMIN', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', nameEn: 'System Admin', description: 'Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', level: 0, status: 'Active' },
    { id: 6, code: 'ENTITY_ADMIN', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„ÙƒÙŠØ§Ù†', nameEn: 'Entity Admin', description: 'Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙŠØ§Ù†', level: 1, status: 'Active' },
    { id: 7, code: 'RISK_OFFICER', name: 'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk Officer', description: 'Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', level: 3, status: 'Active' },
    { id: 8, code: 'EVIDENCE_REVIEWER', name: 'Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©', nameEn: 'Evidence Reviewer', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø© ÙÙ‚Ø·', level: 3, status: 'Active' },
  ],

  // SCOPED ROLE ASSIGNMENTS (User + Role + Scope)
  roleAssignments: [
    { id: 1, userId: 1, roleId: 1, scopeType: 'ENTITY', scopeId: 'LE-001', validFrom: '2024-01-15', validTo: null, status: 'Active' },
    { id: 2, userId: 2, roleId: 2, scopeType: 'TENANT', scopeId: 'TENANT-001', validFrom: '2024-02-01', validTo: null, status: 'Active' },
    { id: 3, userId: 3, roleId: 3, scopeType: 'TENANT', scopeId: 'TENANT-001', validFrom: '2024-01-10', validTo: null, status: 'Active' },
    { id: 4, userId: 4, roleId: 4, scopeType: 'ENTITY', scopeId: 'LE-001', validFrom: '2024-03-01', validTo: null, status: 'Active' },
    { id: 5, userId: 5, roleId: 5, scopeType: 'TENANT', scopeId: 'TENANT-001', validFrom: '2024-01-20', validTo: null, status: 'Active' },
    { id: 6, userId: 6, roleId: 1, scopeType: 'ENTITY', scopeId: 'LE-002', validFrom: '2024-04-01', validTo: null, status: 'Active' },
    { id: 7, userId: 7, roleId: 1, scopeType: 'SITE', scopeId: 'SITE-002', validFrom: '2024-05-15', validTo: null, status: 'Active' },
    { id: 8, userId: 2, roleId: 6, scopeType: 'ENTITY', scopeId: 'LE-001', validFrom: '2024-06-01', validTo: null, status: 'Active' },
    { id: 9, userId: 4, roleId: 7, scopeType: 'ENTITY', scopeId: 'LE-001', validFrom: '2024-07-01', validTo: null, status: 'Active' },
    { id: 10, userId: 1, roleId: 8, scopeType: 'BU', scopeId: 'BU-001', validFrom: '2024-08-01', validTo: null, status: 'Active' },
    { id: 11, userId: 6, roleId: 7, scopeType: 'ENTITY', scopeId: 'LE-002', validFrom: '2024-08-15', validTo: null, status: 'Active' },
    { id: 12, userId: 8, roleId: 1, scopeType: 'ENTITY', scopeId: 'LE-003', validFrom: '2024-09-01', validTo: null, status: 'Inactive' },
  ],

  // PERMISSION MATRIX
  modules: ['OBLIGATIONS', 'EVIDENCE', 'TESTING', 'BREACHES', 'INSPECTIONS', 'COMMUNICATIONS', 'IAM'],
  actions: ['VIEW', 'CREATE', 'EDIT', 'SUBMIT', 'APPROVE', 'ACTIVATE', 'RETIRE', 'EXPORT', 'ADMIN'],

  rolePermissions: {
    COMPLIANCE_OFFICER: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      IAM: { VIEW: false, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
    },
    COMPLIANCE_MANAGER: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: false, EDIT: true, SUBMIT: false, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      IAM: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
    },
    CCO: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      EVIDENCE: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      BREACHES: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      INSPECTIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      IAM: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
    },
    AUDITOR_VIEWER: {
      OBLIGATIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      IAM: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
    },
    ADMIN: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      EVIDENCE: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      BREACHES: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      INSPECTIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
      IAM: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: true, EXPORT: true, ADMIN: true },
    },
    ENTITY_ADMIN: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: true, RETIRE: false, EXPORT: true, ADMIN: false },
      IAM: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
    },
    RISK_OFFICER: {
      OBLIGATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: true, EDIT: true, SUBMIT: true, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      IAM: { VIEW: false, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
    },
    EVIDENCE_REVIEWER: {
      OBLIGATIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      EVIDENCE: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: true, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      TESTING: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      BREACHES: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: true, ADMIN: false },
      INSPECTIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
      COMMUNICATIONS: { VIEW: true, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
      IAM: { VIEW: false, CREATE: false, EDIT: false, SUBMIT: false, APPROVE: false, ACTIVATE: false, RETIRE: false, EXPORT: false, ADMIN: false },
    },
  },
  // SEGREGATION OF DUTIES RULES
  sodRules: [
    { id: 1, code: 'SOD-EVD-001', name: 'ÙØµÙ„ Ø±ÙØ¹ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø©', nameEn: 'Evidence Upload/Approve Separation', description: 'Ù…Ù† ÙŠØ±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡', module: 'EVIDENCE', blockedAction: 'APPROVE', condition: 'UPLOADER', conditionField: 'uploadedBy', severity: 'Critical', status: 'Active' },
    { id: 2, code: 'SOD-OBL-001', name: 'ÙØµÙ„ Ù…Ù„ÙƒÙŠØ© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', nameEn: 'Obligation Owner/Activate Separation', description: 'Ù…Ø§Ù„Ùƒ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯ ØªÙØ¹ÙŠÙ„Ù‡', module: 'OBLIGATIONS', blockedAction: 'ACTIVATE', condition: 'OWNER', conditionField: 'ownerId', severity: 'Critical', status: 'Active' },
    { id: 3, code: 'SOD-OBL-002', name: 'ÙØµÙ„ Ù…Ù„ÙƒÙŠØ© ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', nameEn: 'Obligation Owner/Retire Separation', description: 'Ù…Ø§Ù„Ùƒ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥ØºÙ„Ø§Ù‚Ù‡', module: 'OBLIGATIONS', blockedAction: 'RETIRE', condition: 'OWNER', conditionField: 'ownerId', severity: 'Critical', status: 'Active' },
    { id: 4, code: 'SOD-BRH-001', name: 'ÙØµÙ„ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', nameEn: 'Breach Create/Close Separation', description: 'Ù…Ù† ÙŠÙ†Ø´Ø¦ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§', module: 'BREACHES', blockedAction: 'APPROVE', condition: 'CREATOR', conditionField: 'createdBy', severity: 'Critical', status: 'Active' },
    { id: 5, code: 'SOD-TST-001', name: 'ÙØµÙ„ ØªÙ†ÙÙŠØ° ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', nameEn: 'Test Execute/Review Separation', description: 'Ù…Ù† ÙŠÙ†ÙØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡', module: 'TESTING', blockedAction: 'APPROVE', condition: 'EXECUTOR', conditionField: 'executedBy', severity: 'High', status: 'Active' },
    { id: 6, code: 'SOD-INS-001', name: 'ÙØµÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„ØªÙØªÙŠØ´', nameEn: 'Inspection Pack Prepare/Approve', description: 'Ù…Ù† ÙŠÙØ¹Ø¯ Ø§Ù„Ø­Ø²Ù…Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§', module: 'INSPECTIONS', blockedAction: 'APPROVE', condition: 'PREPARER', conditionField: 'preparedBy', severity: 'Critical', status: 'Active' },
    { id: 7, code: 'SOD-INS-002', name: 'ÙØµÙ„ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„Ø­Ø²Ù…Ø©', nameEn: 'Pack Generator/Exporter Separation', description: 'Ù…Ù† ÙŠÙ†Ø´Ø¦ Ø§Ù„Ø­Ø²Ù…Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ ØªØµØ¯ÙŠØ±Ù‡Ø§', module: 'INSPECTIONS', blockedAction: 'EXPORT', condition: 'GENERATOR', conditionField: 'generatedBy', severity: 'Critical', status: 'Active' },
  ],

  // DELEGATION OF AUTHORITY (DOA) MATRIX
  doaMatrix: [
    // Evidence Approval
    { id: 1, module: 'EVIDENCE', action: 'APPROVE', severity: 'Medium', minRoleLevel: 3, approverRoles: ['COMPLIANCE_MANAGER', 'CCO', 'ADMIN'], requiresDualApproval: false, entitySpecific: true },
    { id: 2, module: 'EVIDENCE', action: 'APPROVE', severity: 'High', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 3, module: 'EVIDENCE', action: 'APPROVE', severity: 'Critical', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: true, entitySpecific: false },

    // Obligation Activation
    { id: 4, module: 'OBLIGATIONS', action: 'ACTIVATE', severity: 'Medium', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO', 'ADMIN'], requiresDualApproval: false, entitySpecific: true },
    { id: 5, module: 'OBLIGATIONS', action: 'ACTIVATE', severity: 'High', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 6, module: 'OBLIGATIONS', action: 'ACTIVATE', severity: 'Critical', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: true, entitySpecific: false },

    // Obligation Retirement
    { id: 7, module: 'OBLIGATIONS', action: 'RETIRE', severity: 'Medium', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 8, module: 'OBLIGATIONS', action: 'RETIRE', severity: 'High', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: false, entitySpecific: false },
    { id: 9, module: 'OBLIGATIONS', action: 'RETIRE', severity: 'Critical', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: true, entitySpecific: false },

    // Breach Closure
    { id: 10, module: 'BREACHES', action: 'APPROVE', severity: 'Medium', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 11, module: 'BREACHES', action: 'APPROVE', severity: 'High', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: true, entitySpecific: true },
    { id: 12, module: 'BREACHES', action: 'APPROVE', severity: 'Critical', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: true, entitySpecific: false },

    // Pack Export
    { id: 13, module: 'INSPECTIONS', action: 'EXPORT', severity: 'Medium', minRoleLevel: 3, approverRoles: ['COMPLIANCE_OFFICER', 'COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 14, module: 'INSPECTIONS', action: 'EXPORT', severity: 'High', minRoleLevel: 2, approverRoles: ['COMPLIANCE_MANAGER', 'CCO'], requiresDualApproval: false, entitySpecific: true },
    { id: 15, module: 'INSPECTIONS', action: 'EXPORT', severity: 'Critical', minRoleLevel: 1, approverRoles: ['CCO'], requiresDualApproval: true, entitySpecific: false },
  ],

  // AUDIT TRAIL
  auditLogs: [],

  // DOA APPROVAL REQUESTS (Module 0.6)
  approvalRequests: [
    // Seed data for demo
    {
      id: 1, module: 'BREACHES', action: 'APPROVE', severity: 'Critical', entityId: 'LE-001',
      recordType: 'BREACH', recordId: 'BRH-2025-001', recordTitle: 'ØªØ£Ø®Ø± ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„',
      requesterId: 1, requesterName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', requestedAt: '2025-02-03T10:00:00Z',
      requiredApprovers: [2, 3], approvals: [], rejections: [],
      requiresDualApproval: true, status: 'Pending', notes: 'Ø·Ù„Ø¨ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø¨Ø¹Ø¯ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©'
    },
  ],

  // IAM EXTENDED FEATURES - v5.24.0

  userGroups: [
    { id: 1, code: 'GRP-GRC', name: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'GRC Team', description: 'Ø¬Ù…ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', memberIds: [1, 2, 6], entityScope: 'TENANT-001', status: 'Active', createdAt: '2024-01-15', createdBy: 3 },
    { id: 2, code: 'GRP-AUDIT', name: 'ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal Audit Team', description: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ù‚Ù‚ÙŠÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', memberIds: [4], entityScope: 'LE-001', status: 'Active', createdAt: '2024-02-01', createdBy: 3 },
    { id: 3, code: 'GRP-IT', name: 'ÙØ±ÙŠÙ‚ ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'IT Team', description: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', memberIds: [5], entityScope: 'TENANT-001', status: 'Active', createdAt: '2024-01-20', createdBy: 3 },
    { id: 4, code: 'GRP-MGMT', name: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§', nameEn: 'Executive Management', description: 'Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠÙŠÙ† ÙˆØ±Ø¤Ø³Ø§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', memberIds: [3, 2], entityScope: 'TENANT-001', status: 'Active', createdAt: '2024-01-10', createdBy: 3 },
    { id: 5, code: 'GRP-BRANCH', name: 'ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ±ÙˆØ¹', nameEn: 'Branch Team', description: 'Ù…ÙˆØ¸ÙÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙÙŠ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©', memberIds: [7], entityScope: 'LE-001', status: 'Active', createdAt: '2024-05-01', createdBy: 2 },
    { id: 6, code: 'GRP-RISK', name: 'ÙØ±ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk Management Team', description: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† ØªØ­Ø¯ÙŠØ¯ ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©', memberIds: [1, 4, 6], entityScope: 'TENANT-001', status: 'Inactive', createdAt: '2024-03-15', createdBy: 3 },
  ],

  delegations: [
    { id: 1, fromUserId: 2, toUserId: 1, type: 'Full', reason: 'Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©', startDate: '2025-02-10', endDate: '2025-02-20', modules: ['OBLIGATIONS', 'EVIDENCE', 'TESTING'], status: 'Scheduled', createdAt: '2025-02-01', approvedBy: 3 },
    { id: 2, fromUserId: 3, toUserId: 2, type: 'Partial', reason: 'Ù…Ù‡Ù…Ø© Ø®Ø§Ø±Ø¬ÙŠØ©', startDate: '2025-01-15', endDate: '2025-01-20', modules: ['BREACHES'], status: 'Completed', createdAt: '2025-01-10', approvedBy: null },
  ],

  activeSessions: [
    { id: 'SES-001', userId: 1, ipAddress: '192.168.1.100', userAgent: 'Chrome 120 / Windows', device: 'Desktop', location: 'Riyadh, SA', startedAt: '2025-02-05T08:30:00Z', lastActivity: '2025-02-05T10:45:00Z', status: 'Active' },
    { id: 'SES-002', userId: 2, ipAddress: '192.168.1.101', userAgent: 'Firefox 121 / macOS', device: 'Desktop', location: 'Riyadh, SA', startedAt: '2025-02-05T07:45:00Z', lastActivity: '2025-02-05T10:50:00Z', status: 'Active' },
    { id: 'SES-003', userId: 5, ipAddress: '192.168.1.150', userAgent: 'Chrome 120 / Windows', device: 'Desktop', location: 'Riyadh, SA', startedAt: '2025-02-05T06:30:00Z', lastActivity: '2025-02-05T10:40:00Z', status: 'Active' },
  ],

  loginHistory: [
    { id: 1, userId: 1, ipAddress: '192.168.1.100', location: 'Riyadh, SA', loginAt: '2025-02-05T08:30:00Z', logoutAt: null, status: 'Active', method: 'Password+MFA' },
    { id: 2, userId: 1, ipAddress: '192.168.1.100', location: 'Riyadh, SA', loginAt: '2025-02-04T08:15:00Z', logoutAt: '2025-02-04T17:30:00Z', status: 'Completed', method: 'Password+MFA' },
    { id: 3, userId: 2, ipAddress: '192.168.1.101', location: 'Riyadh, SA', loginAt: '2025-02-05T07:45:00Z', logoutAt: null, status: 'Active', method: 'Password+MFA' },
    { id: 4, userId: 5, ipAddress: '192.168.1.150', location: 'Riyadh, SA', loginAt: '2025-02-05T06:30:00Z', logoutAt: null, status: 'Active', method: 'Password+MFA' },
  ],

  failedLogins: [
    { id: 1, email: 'ahmed.ghamdi@albousairy.sa', ipAddress: '203.0.113.50', location: 'Unknown', attemptAt: '2025-02-04T03:15:00Z', reason: 'Invalid Password', blocked: false },
    { id: 2, email: 'unknown@hacker.com', ipAddress: '198.51.100.25', location: 'Unknown', attemptAt: '2025-02-03T14:30:00Z', reason: 'User Not Found', blocked: true },
    { id: 3, email: 'admin@albousairy.sa', ipAddress: '198.51.100.100', location: 'Unknown', attemptAt: '2025-02-01T22:45:00Z', reason: 'IP Blocked', blocked: true },
  ],

  ipRules: [
    { id: 1, type: 'Whitelist', ipAddress: '192.168.1.0/24', description: 'Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', status: 'Active', createdBy: 5, createdAt: '2024-01-15' },
    { id: 2, type: 'Whitelist', ipAddress: '172.16.0.0/16', description: 'VPN Ø§Ù„Ø´Ø±ÙƒØ©', status: 'Active', createdBy: 5, createdAt: '2024-01-15' },
    { id: 3, type: 'Blacklist', ipAddress: '198.51.100.0/24', description: 'Ù†Ø·Ø§Ù‚ Ù…Ø´Ø¨ÙˆÙ‡', status: 'Active', createdBy: 5, createdAt: '2025-02-02' },
  ],

  passwordPolicy: {
    minLength: 12, requireUppercase: true, requireLowercase: true, requireNumbers: true, requireSpecialChars: true,
    maxAge: 90, historyCount: 5, lockoutThreshold: 5, lockoutDuration: 30, mfaRequired: true,
    mfaMethods: ['TOTP', 'SMS', 'Email'], sessionTimeout: 480, concurrentSessions: 3, lastUpdated: '2024-06-01', updatedBy: 5
  },

  permissionTemplates: [
    { id: 1, name: 'Ù‚Ø§Ù„Ø¨ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'Compliance Officer Template', description: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', roleIds: [1, 8], modules: ['OBLIGATIONS', 'EVIDENCE', 'TESTING'], status: 'Active', usageCount: 12, createdBy: 3, createdAt: '2024-03-01' },
    { id: 2, name: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal Auditor Template', description: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ø±Ø¶ ÙÙ‚Ø·', roleIds: [4], modules: ['OBLIGATIONS', 'EVIDENCE', 'TESTING', 'BREACHES'], status: 'Active', usageCount: 5, createdBy: 3, createdAt: '2024-03-15' },
  ],

  permissionRequests: [
    { id: 1, requesterId: 7, requestType: 'NewRole', roleId: 2, scopeType: 'ENTITY', scopeId: 'LE-001', reason: 'ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø¯ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙØ±Ø¹ Ø¨Ø¹Ø¯ Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ Ø¨ØªÙ‚Ø¯ÙŠØ± Ù…Ù…ØªØ§Ø²', validFrom: '2025-03-01', validTo: null, status: 'Pending', approverId: null, createdAt: '2025-02-01' },
    { id: 2, requesterId: 1, requestType: 'Extension', roleId: 1, scopeType: 'ENTITY', scopeId: 'LE-002', reason: 'Ù…Ù‡Ù…Ø© Ù…Ø¤Ù‚ØªØ© ÙÙŠ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ù„Ø¯Ø¹Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', validFrom: '2025-02-15', validTo: '2025-03-15', status: 'Approved', approverId: 3, approvedAt: '2025-02-03T10:30:00Z', createdAt: '2025-02-01' },
    { id: 3, requesterId: 4, requestType: 'NewRole', roleId: 7, scopeType: 'TENANT', scopeId: 'TENANT-001', reason: 'Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ± Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', validFrom: '2025-03-01', validTo: null, status: 'Rejected', approverId: 3, approvedAt: '2025-02-02T14:00:00Z', rejectionReason: 'ØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (SoD) - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', createdAt: '2025-02-01' },
    { id: 4, requesterId: 6, requestType: 'Modification', roleId: 8, scopeType: 'ENTITY', scopeId: 'LE-002', reason: 'ØªÙˆØ³ÙŠØ¹ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ù„Ø© Ù„ØªØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', validFrom: '2025-02-20', validTo: '2025-06-30', status: 'Pending', approverId: null, createdAt: '2025-02-05' },
    { id: 5, requesterId: 5, requestType: 'Extension', roleId: 5, scopeType: 'TENANT', scopeId: 'TENANT-001', reason: 'ØªÙ…Ø¯ÙŠØ¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù…Ø¯Ø© Ø³Ù†Ø© Ø¥Ø¶Ø§ÙÙŠØ©', validFrom: '2025-01-20', validTo: '2026-01-20', status: 'Approved', approverId: 3, approvedAt: '2025-01-18T09:00:00Z', createdAt: '2025-01-15' },
  ],

};

// Backward compatibility alias
const IAM_DB = IAM_API;

// AUDIT TRAIL - Global Audit Logger with Before/After Snapshot
const createAuditLog = (userId, userName, action, module, entityType, entityId, details = {}, beforeSnapshot = null, afterSnapshot = null) => {
  const log = {
    id: Date.now() + Math.random(),
    userId,
    userName,
    action,
    module,
    entityType,
    entityId,
    details,
    beforeSnapshot,
    afterSnapshot,
    timestamp: new Date().toISOString(), ip: '192.168.1.' + Math.floor(Math.random() * 255), userAgent: 'Mozilla/5.0',
    sessionId: 'SES-' + Date.now(),
  };
  IAM_API.auditLogs.unshift(log);
  return log;
};

// PERMISSION HELPERS - Bank-Grade Enforcement Layer
const PermissionService = {
  // Get user's role assignments with scope
  getUserRoleAssignments: (userId) => {
    return IAM_API.roleAssignments.filter(ra => ra.userId === userId && ra.status === 'Active');
  },

  scopeMatches: (userScope, targetScope) => {
    if (!userScope || userScope.scopeType === 'TENANT') return true;
    if (userScope.scopeType === 'ENTITY' && userScope.scopeId === targetScope?.entityId) return true;
    if (userScope.scopeType === 'BU' && userScope.scopeId === targetScope?.buId) return true;
    if (userScope.scopeType === 'SITE' && userScope.scopeId === targetScope?.siteId) return true;
    if (userScope.scopeType === 'ENTITY') {
      const entity = IAM_API.legalEntities.find(e => e.id === targetScope?.entityId);
      if (entity?.parentId === userScope.scopeId) return true;
    }
    return false;
  },

  // Main permission check: can(user, permission, scope)
  can: (user, permission, scope = null) => {
    if (!user) return false;
    const [module, action] = permission.split('_');
    const assignments = PermissionService.getUserRoleAssignments(user.id);

    for (const assignment of assignments) {
      const role = IAM_API.roles.find(r => r.id === assignment.roleId);
      if (!role) continue;

      const rolePerms = IAM_API.rolePermissions[role.code];
      if (!rolePerms || !rolePerms[module]) continue;

      if (rolePerms[module][action]) {
        if (!scope || PermissionService.scopeMatches(assignment, scope)) {
          return true;
        }
      }
    }
    return false;
  },

  // Explain why permission was denied
  explainDeny: (user, permission, scope = null) => {
    if (!user) return 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹Ø±Ù';

    const [module, action] = permission.split('_');
    const assignments = PermissionService.getUserRoleAssignments(user.id);

    if (assignments.length === 0) {
      return `Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø¯ÙˆØ§Ø± Ù…Ø¹ÙŠÙ†Ø© - ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…`;
    }

    const userRoles = assignments.map(a => {
      const role = IAM_API.roles.find(r => r.id === a.roleId);
      return role?.name || 'Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    });

    let hasPermissionInAnyRole = false;
    let scopeMismatch = false;

    for (const assignment of assignments) {
      const role = IAM_API.roles.find(r => r.id === assignment.roleId);
      if (!role) continue;

      const rolePerms = IAM_API.rolePermissions[role.code];
      if (rolePerms && rolePerms[module] && rolePerms[module][action]) {
        hasPermissionInAnyRole = true;
        if (scope && !PermissionService.scopeMatches(assignment, scope)) {
          scopeMismatch = true;
        }
      }
    }
    const moduleNames = {
      OBLIGATIONS: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', EVIDENCE: 'Ø§Ù„Ø£Ø¯Ù„Ø©', TESTING: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', BREACHES: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', INSPECTIONS: 'Ø§Ù„ØªÙØªÙŠØ´',
      COMMUNICATIONS: 'Ø§Ù„ØªÙˆØ§ØµÙ„',
      IAM: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©'
    };

    const actionNames = {
      VIEW: 'Ø§Ù„Ø¹Ø±Ø¶', CREATE: 'Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', EDIT: 'Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', SUBMIT: 'Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', APPROVE: 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', ACTIVATE: 'Ø§Ù„ØªÙØ¹ÙŠÙ„',
      RETIRE: 'Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù', EXPORT: 'Ø§Ù„ØªØµØ¯ÙŠØ±',
      ADMIN: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'
    };

    if (scopeMismatch) {
      return `ØµÙ„Ø§Ø­ÙŠØ© ${actionNames[action] || action} ÙÙŠ ${moduleNames[module] || module} ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ - Ø£Ø¯ÙˆØ§Ø±Ùƒ: ${userRoles.join('ØŒ ')}`;
    }

    if (!hasPermissionInAnyRole) {
      return `ØµÙ„Ø§Ø­ÙŠØ© ${actionNames[action] || action} ÙÙŠ ${moduleNames[module] || module} ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ø£Ø¯ÙˆØ§Ø±Ùƒ: ${userRoles.join('ØŒ ')}`;
    }

    return `Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ - ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…`;
  },

  checkSoD: (user, module, action, recordMetadata) => {
    if (!user || !recordMetadata) return { blocked: false, rule: null, reason: null };

    const rules = IAM_API.sodRules.filter(r =>
      r.module === module &&
      r.blockedAction === action &&
      r.status === 'Active'
    );

    for (const rule of rules) {
      const recordOwnerId = recordMetadata[rule.conditionField];
      if (recordOwnerId === user.id) {
        return {
          blocked: true,
          rule,
          reason: `${rule.name}: ${rule.description}`
        };
      }
    }
    return { blocked: false, rule: null, reason: null };
  },

  // Get approver chain based on DOA matrix
  getApproverChain: (module, action, severity, entityId) => {
    const doaRule = IAM_API.doaMatrix.find(d =>
      d.module === module &&
      d.action === action &&
      d.severity === severity
    );

    if (!doaRule) return { approvers: [], requiresDualApproval: false, rule: null };

    // Find users with required roles
    const approvers = [];
    const assignments = IAM_API.roleAssignments.filter(ra => ra.status === 'Active');

    for (const assignment of assignments) {
      const role = IAM_API.roles.find(r => r.id === assignment.roleId);
      if (!role || !doaRule.approverRoles.includes(role.code)) continue;

      if (doaRule.entitySpecific) {
        if (assignment.scopeType !== 'TENANT' && assignment.scopeId !== entityId) continue;
      }

      const user = IAM_API.users.find(u => u.id === assignment.userId);
      if (user && user.status === 'Active') {
        approvers.push({ user, role, assignment });
      }
    }
    return {
      approvers,
      requiresDualApproval: doaRule.requiresDualApproval, minRoleLevel: doaRule.minRoleLevel,
      rule: doaRule
    };
  },

  // Guard action: comprehensive check combining permission + SoD + DOA
  guardAction: (user, module, action, entityId, recordMetadata = {}, severity = 'Medium') => {
    const result = {
      allowed: false, reason: null, sodBlocked: false, permissionBlocked: false, doaBlocked: false, approvers: [],
    };

    // 1. Check base permission
    const scope = entityId ? { entityId } : null;
    if (!PermissionService.can(user, `${module}_${action}`, scope)) {
      result.permissionBlocked = true;
      result.reason = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡';
      return result;
    }

    // 2. Check SoD
    const sodCheck = PermissionService.checkSoD(user, module, action, recordMetadata);
    if (sodCheck.blocked) {
      result.sodBlocked = true;
      result.reason = sodCheck.reason;
      return result;
    }

    // 3. Check DOA for approval actions
    if (['APPROVE', 'ACTIVATE', 'RETIRE', 'EXPORT'].includes(action)) {
      const doaCheck = PermissionService.getApproverChain(module, action, severity, entityId);
      const userRole = IAM_API.roles.find(r => {
        const assignment = IAM_API.roleAssignments.find(ra => ra.userId === user.id && ra.status === 'Active');
        return assignment && r.id === assignment.roleId;
      });

      if (doaCheck.rule && userRole && userRole.level > doaCheck.minRoleLevel) {
        result.doaBlocked = true;
        result.reason = `ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù† ${doaCheck.approvers.map(a => a.role.name).join(' Ø£Ùˆ ')}`;
        result.approvers = doaCheck.approvers;
        return result;
      }
    }
    result.allowed = true;
    return result;
  },

  // Guard route/screen access
  guardRoute: (user, requiredPermission) => {
    return PermissionService.can(user, requiredPermission);
  },

  // Get all effective permissions for a user
  getUserPermissions: (user) => {
    const permissions = {};
    if (!user) return permissions;

    const assignments = PermissionService.getUserRoleAssignments(user.id);

    for (const assignment of assignments) {
      const role = IAM_API.roles.find(r => r.id === assignment.roleId);
      if (!role) continue;

      const rolePerms = IAM_API.rolePermissions[role.code];
      if (!rolePerms) continue;

      Object.entries(rolePerms).forEach(([module, actions]) => {
        if (!permissions[module]) permissions[module] = {};
        Object.entries(actions).forEach(([action, allowed]) => {
          if (allowed) permissions[module][action] = true;
        });
      });
    }
    return permissions;
  },
};

// MODULE 0.6: DOA APPROVAL SERVICE - Approval Chain Resolution & Workflow
const ApprovalService = {
  // Create approval request
  createRequest: (requesterId, module, action, severity, entityId, recordType, recordId, recordTitle, notes = '') => {
    const chain = PermissionService.getApproverChain(module, action, severity, entityId);
    if (!chain.approvers || chain.approvers.length === 0) {
      return { success: false, error: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' };
    }

    const requester = IAM_API.users.find(u => u.id === requesterId);
    const request = {
      id: Date.now(),
      module,
      action,
      severity,
      entityId,
      recordType,
      recordId,
      recordTitle,
      requesterId,
      requesterName: requester?.name || 'Unknown', requestedAt: new Date().toISOString(),
      requiredApprovers: chain.approvers.map(a => a.user.id),
      approverDetails: chain.approvers.map(a => ({ userId: a.user.id, userName: a.user.name, roleName: a.role.name })),
      approvals: [], rejections: [], requiresDualApproval: chain.requiresDualApproval, minRoleLevel: chain.minRoleLevel,
      status: 'Pending',
      notes,
      completedAt: null,
      completedAction: null
    };

    IAM_API.approvalRequests.push(request);
    return { success: true, request, chain };
  },

  // Approve request
  approve: (requestId, approverId, comment = '') => {
    const request = IAM_API.approvalRequests.find(r => r.id === requestId);
    if (!request) return { success: false, error: 'Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
    if (request.status !== 'Pending') return { success: false, error: 'Ø§Ù„Ø·Ù„Ø¨ Ù„ÙŠØ³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' };

    const approver = IAM_API.users.find(u => u.id === approverId);
    if (!request.requiredApprovers.includes(approverId)) {
      return { success: false, error: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨' };
    }

    if (request.approvals.some(a => a.approverId === approverId)) {
      return { success: false, error: 'Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹' };
    }

    request.approvals.push({
      approverId,
      approverName: approver?.name || 'Unknown', approvedAt: new Date().toISOString(),
      comment
    });

    const requiredCount = request.requiresDualApproval ? 2 : 1;
    if (request.approvals.length >= requiredCount) {
      request.status = 'Approved';
      request.completedAt = new Date().toISOString();
      request.completedAction = 'APPROVED';
    }

    return { success: true, request, isComplete: request.status === 'Approved' };
  },

  // Reject request
  reject: (requestId, rejecterId, reason) => {
    const request = IAM_API.approvalRequests.find(r => r.id === requestId);
    if (!request) return { success: false, error: 'Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
    if (request.status !== 'Pending') return { success: false, error: 'Ø§Ù„Ø·Ù„Ø¨ Ù„ÙŠØ³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯' };

    const rejecter = IAM_API.users.find(u => u.id === rejecterId);
    if (!request.requiredApprovers.includes(rejecterId)) {
      return { success: false, error: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨' };
    }

    request.rejections.push({
      rejecterId,
      rejecterName: rejecter?.name || 'Unknown', rejectedAt: new Date().toISOString(),
      reason
    });

    request.status = 'Rejected';
    request.completedAt = new Date().toISOString();
    request.completedAction = 'REJECTED';

    return { success: true, request };
  },

  // Get pending approvals for user
  getMyPendingApprovals: (userId) => {
    return IAM_API.approvalRequests.filter(r =>
      r.status === 'Pending' &&
      r.requiredApprovers.includes(userId) &&
      !r.approvals.some(a => a.approverId === userId)
    );
  },
  // Get my submitted requests
  getMyRequests: (userId) => {
    return IAM_API.approvalRequests.filter(r => r.requesterId === userId);
  },

  // Get request by ID
  getRequest: (requestId) => {
    return IAM_API.approvalRequests.find(r => r.id === requestId);
  },

  requiresApproval: (module, action, severity) => {
    const rule = IAM_API.doaMatrix.find(d =>
      d.module === module &&
      d.action === action &&
      d.severity === severity
    );
    return rule ? { required: true, rule } : { required: false, rule: null };
  },

  // Get approval status for a record
  getRecordApprovalStatus: (recordType, recordId) => {
    return IAM_API.approvalRequests.filter(r =>
      r.recordType === recordType &&
      r.recordId === recordId
    ).sort((a, b) => new Date(b.requestedAt) - new Date(a.requestedAt));
  }
};

// GLOBAL AUTH CONTEXT - Functional RBAC with Entity Scope
const AuthContext = createContext(null);

const AuthProvider = ({ children, initialUserId = 5, initialEntityId = 'TENANT-001' }) => {
  // Current authenticated user
  const [currentUserId, setCurrentUserId] = useState(() => {
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('iam_currentUserId');
      return saved ? parseInt(saved) : initialUserId;
    }
    return initialUserId;
  });
  const [selectedEntityId, setSelectedEntityId] = useState(() => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('iam_selectedEntityId') || initialEntityId;
    }
    return initialEntityId;
  });
  const [selectedBUId, setSelectedBUId] = useState(() => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('iam_selectedBUId') || null;
    }
    return null;
  });
  const [selectedSiteId, setSelectedSiteId] = useState(() => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('iam_selectedSiteId') || null;
    }
    return null;
  });

  // Persist selections to localStorage
  useEffect(() => {
    if (typeof window !== 'undefined') {
      localStorage.setItem('iam_currentUserId', currentUserId.toString());
      localStorage.setItem('iam_selectedEntityId', selectedEntityId || '');
      localStorage.setItem('iam_selectedBUId', selectedBUId || '');
      localStorage.setItem('iam_selectedSiteId', selectedSiteId || '');
    }
  }, [currentUserId, selectedEntityId, selectedBUId, selectedSiteId]);

  // Get full user object
  const currentUser = useMemo(() => {
    return IAM_API.users.find(u => u.id === currentUserId) || IAM_API.users[0];
  }, [currentUserId]);

  // Get entity context
  const entityContext = useMemo(() => ({
    entityId: selectedEntityId, buId: selectedBUId, siteId: selectedSiteId,
    entity: selectedEntityId === 'TENANT-001'
      ? IAM_API.tenant
      : IAM_API.legalEntities.find(e => e.id === selectedEntityId),
    bu: selectedBUId ? IAM_API.businessUnits.find(b => b.id === selectedBUId) : null,
    site: selectedSiteId ? IAM_API.sites.find(s => s.id === selectedSiteId) : null,
  }), [selectedEntityId, selectedBUId, selectedSiteId]);

  // Permission check with scope
  const can = (permission, scope = null) => {
    const effectiveScope = scope || entityContext;
    return PermissionService.can(currentUser, permission, effectiveScope);
  };

  // SoD check
  const checkSoD = (module, action, recordMetadata) => {
    return PermissionService.checkSoD(currentUser, module, action, recordMetadata);
  };

  // Full action guard
  const guardAction = (module, action, recordMetadata = {}, severity = 'Medium') => {
    return PermissionService.guardAction(currentUser, module, action, entityContext.entityId, recordMetadata, severity);
  };

  // Switch user (for demo)
  const switchUser = (userId) => {
    const user = IAM_API.users.find(u => u.id === userId);
    if (user) {
      setCurrentUserId(userId);
      // Reset entity scope based on user's scope
      if (user.entityScope === 'TENANT-001') {
        setSelectedEntityId('TENANT-001');
      } else {
        setSelectedEntityId(user.entityScope);
      }
      setSelectedBUId(user.buScope || null);
      setSelectedSiteId(user.siteScope || null);
      // Audit log
      createAuditLog(userId, user.name, 'LOGIN', 'IAM', 'SESSION', `SES-${Date.now()}`, { loginTime: new Date().toISOString() });
    }
  };

  // Select entity context
  const selectEntity = (entityId, buId = null, siteId = null) => {
    // Validate user has access to this entity
    const userAssignments = PermissionService.getUserRoleAssignments(currentUser.id);
    const hasAccess = userAssignments.some(ra => {
      if (ra.scopeType === 'TENANT') return true;
      if (ra.scopeType === 'ENTITY' && ra.scopeId === entityId) return true;
      if (ra.scopeType === 'BU' && ra.scopeId === buId) return true;
      if (ra.scopeType === 'SITE' && ra.scopeId === siteId) return true;
      return false;
    });

    if (hasAccess || can('IAM_ADMIN')) {
      setSelectedEntityId(entityId);
      setSelectedBUId(buId);
      setSelectedSiteId(siteId);
    }
  };

  // Get user's accessible entities
  const getAccessibleEntities = () => {
    const assignments = PermissionService.getUserRoleAssignments(currentUser.id);
    const hasTenantAccess = assignments.some(ra => ra.scopeType === 'TENANT');

    if (hasTenantAccess) {
      return ['TENANT-001', ...IAM_API.legalEntities.map(e => e.id)];
    }

    const entityIds = new Set();
    assignments.forEach(ra => {
      if (ra.scopeType === 'ENTITY') entityIds.add(ra.scopeId);
      if (ra.scopeType === 'BU') {
        const bu = IAM_API.businessUnits.find(b => b.id === ra.scopeId);
        if (bu) entityIds.add(bu.entityId);
      }
      if (ra.scopeType === 'SITE') {
        const site = IAM_API.sites.find(s => s.id === ra.scopeId);
        if (site) entityIds.add(site.entityId);
      }
    });
    return Array.from(entityIds);
  };

  const value = {
    currentUser,
    currentUserId,
    entityContext,
    selectedEntityId,
    selectedBUId,
    selectedSiteId,
    can,
    explainDeny: (permission, scope) => PermissionService.explainDeny(currentUser, permission, scope),
    checkSoD,
    guardAction,
    switchUser,
    selectEntity,
    getAccessibleEntities,
    // Direct access for admin functions
    setCurrentUserId,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};

// Hook to use auth context
const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    // Fallback for components outside provider
    return {
      currentUser: IAM_API.users[0],
      can: (permission) => PermissionService.can(IAM_API.users[0], permission),
      explainDeny: (permission) => PermissionService.explainDeny(IAM_API.users[0], permission),
      checkSoD: () => ({ blocked: false }),
      guardAction: () => ({ allowed: true }),
      entityContext: { entityId: 'TENANT-001' },
    };
  }
  return context;
};

// Route guard component
const RouteGuard = ({ permission, children, fallback = null }) => {
  const { can } = useAuth();
  if (!can(permission)) {
    return fallback || (
      <div className="flex flex-col items-center justify-center h-96 text-center">
        <Lock className="w-16 h-16 text-red-300 mb-4" />
        <h2 className="text-xl font-bold text-slate-700 mb-2">ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„</h2>
        <p className="text-slate-500">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</p>
      </div>);
  }
  return children;
};

// Button guard component with tooltip
const GuardedButton = ({ permission, module, action, recordMetadata, children, className, onClick, disabled, title, ...props }) => {
  const { can, explainDeny, checkSoD } = useAuth();

  const hasPermission = can(permission);
  const sodResult = recordMetadata ? checkSoD(module, action, recordMetadata) : { blocked: false };
  const isBlocked = !hasPermission || sodResult.blocked;

  const getTooltip = () => {
    if (!hasPermission) return explainDeny(permission);
    if (sodResult.blocked) return `â›” ${sodResult.reason}`;
    return title;
  };

  return (
    <button
      className={`${className} ${isBlocked ? 'opacity-50 cursor-not-allowed' : ''}`}
      onClick={isBlocked ? undefined : onClick}
      disabled={disabled || isBlocked}
      title={getTooltip()}
      {...props}
    >
      {children}
    </button>);
};

// IAM COMPONENT - Module 0: Bank-Grade Access Governance
// Features: Multi-Entity, RBAC, SoD, DOA, Scoped Assignments, Audit Trail
const IdentityAccessManagement = () => {
  const [activeTab, setActiveTab] = useState('entities');
  const [users, setUsers] = useState(IAM_API.users);
  const [roles, setRoles] = useState(IAM_API.roles);
  const [rolePermissions, setRolePermissions] = useState(IAM_API.rolePermissions);
  const [sodRules, setSodRules] = useState(IAM_API.sodRules);
  const [roleAssignments, setRoleAssignments] = useState(IAM_API.roleAssignments);
  const [doaMatrix, setDoaMatrix] = useState(IAM_API.doaMatrix);
  const [legalEntities, setLegalEntities] = useState(IAM_API.legalEntities);
  const [businessUnits, setBusinessUnits] = useState(IAM_API.businessUnits);
  const [sites, setSites] = useState(IAM_API.sites);
  const [auditLogs, setAuditLogs] = useState(IAM_API.auditLogs);

  const [selectedUser, setSelectedUser] = useState(null);
  const [selectedRole, setSelectedRole] = useState(null);
  const [showUserDrawer, setShowUserDrawer] = useState(false);
  const [showCreateUserModal, setShowCreateUserModal] = useState(false);
  const [showRoleModal, setShowRoleModal] = useState(false);
  const [roleForm, setRoleForm] = useState({ code: '', name: '', nameEn: '', description: '', level: 3, templatePermissions: {}, selectedTemplate: null });
  const [showEditUserModal, setShowEditUserModal] = useState(false);
  const [editUserData, setEditUserData] = useState(null);
  const [userEditMode, setUserEditMode] = useState(false);
  const [editingUserId, setEditingUserId] = useState(null);
  const [roleWizardStep, setRoleWizardStep] = useState(0);
  const [showAssignmentModal, setShowAssignmentModal] = useState(false);
  const [editingAssignment, setEditingAssignment] = useState(null);
  const [assignmentForm, setAssignmentForm] = useState({ userId: '', roleId: '', scopeType: 'ENTITY', scopeId: '', validFrom: '', validTo: '', status: 'Active' });
  const [assignmentFilterUser, setAssignmentFilterUser] = useState(null);
  const [assignmentFilterRole, setAssignmentFilterRole] = useState(null);
  const [assignmentFilterScope, setAssignmentFilterScope] = useState(null);
  const [assignmentFilterStatus, setAssignmentFilterStatus] = useState(null);
  const [assignmentWizardStep, setAssignmentWizardStep] = useState(0);

  // SoD CRUD States
  const [showSodModal, setShowSodModal] = useState(false);
  const [sodEditMode, setSodEditMode] = useState(false);
  const [editingSodRule, setEditingSodRule] = useState(null);
  const [sodForm, setSodForm] = useState({ code: '', name: '', nameEn: '', description: '', module: 'OBLIGATIONS', blockedAction: 'APPROVE', condition: 'CREATOR', severity: 'Critical', status: 'Active' });
  const [sodFilterModule, setSodFilterModule] = useState(null);
  const [sodFilterSeverity, setSodFilterSeverity] = useState(null);
  const [sodFilterStatus, setSodFilterStatus] = useState(null);
  const [showSodDetailsModal, setShowSodDetailsModal] = useState(false);
  const [selectedSodRule, setSelectedSodRule] = useState(null);
  const [sodWizardStep, setSodWizardStep] = useState(0);

  // DOA CRUD States
  const [showDoaModal, setShowDoaModal] = useState(false);
  const [doaEditMode, setDoaEditMode] = useState(false);
  const [editingDoaRule, setEditingDoaRule] = useState(null);
  const [doaForm, setDoaForm] = useState({ module: 'OBLIGATIONS', action: 'APPROVE', severity: 'Medium', minRoleLevel: 2, approverRoles: [], requiresDualApproval: false });
  const [doaFilterModule, setDoaFilterModule] = useState(null);
  const [doaFilterSeverity, setDoaFilterSeverity] = useState(null);
  const [doaFilterDual, setDoaFilterDual] = useState(null);
  const [doaWizardStep, setDoaWizardStep] = useState(0);
  const [notification, setNotification] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterEntity, setFilterEntity] = useState('all');

  const [userGroups, setUserGroups] = useState(IAM_API.userGroups || []);
  const [delegations, setDelegations] = useState(IAM_API.delegations || []);
  const [activeSessions, setActiveSessions] = useState(IAM_API.activeSessions || []);
  const [loginHistory, setLoginHistory] = useState(IAM_API.loginHistory || []);
  const [failedLogins, setFailedLogins] = useState(IAM_API.failedLogins || []);
  const [ipRules, setIpRules] = useState(IAM_API.ipRules || []);
  const [passwordPolicy, setPasswordPolicy] = useState(IAM_API.passwordPolicy || {});
  const [permissionTemplates, setPermissionTemplates] = useState(IAM_API.permissionTemplates || []);
  const [permissionRequests, setPermissionRequests] = useState(IAM_API.permissionRequests || []);
  const [showRequestModal, setShowRequestModal] = useState(false);
  const [selectedRequest, setSelectedRequest] = useState(null);
  const [requestForm, setRequestForm] = useState({ requesterId: '', requestType: 'NewRole', roleId: '', scopeType: 'ENTITY', scopeId: '', reason: '', validFrom: '', validTo: '', status: 'Pending' });
  const [requestWizardStep, setRequestWizardStep] = useState(0);
  const [selectedUsers, setSelectedUsers] = useState([]);
  const [showImportModal, setShowImportModal] = useState(false);
  const [showCompareModal, setShowCompareModal] = useState(false);
  const [compareUser1, setCompareUser1] = useState(null);
  const [compareUser2, setCompareUser2] = useState(null);
  const [showGroupModal, setShowGroupModal] = useState(false);
  const [selectedGroup, setSelectedGroup] = useState(null);
  const [groupForm, setGroupForm] = useState({ code: '', name: '', nameEn: '', description: '', memberIds: [], entityScope: 'TENANT-001', status: 'Active' });

  // Delete Confirmation State
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [userToDelete, setUserToDelete] = useState(null);

  // SoD Simulation State
  const [sodSimUser, setSodSimUser] = useState(null);
  const [sodSimModule, setSodSimModule] = useState('EVIDENCE');
  const [sodSimAction, setSodSimAction] = useState('APPROVE');
  const [sodSimOwnerId, setSodSimOwnerId] = useState(null);
  const [sodSimResult, setSodSimResult] = useState(null);

  // BANK-GRADE USER WIZARD STATE - v5.34 Enhanced (5-Step International)
  // Compliant: SAMA, NCA, CMA, SDAIA, CBE, CBUAE, ISO 27001, NIST, SOX
  const [wizardStep, setWizardStep] = useState(0); // 0-4: Identity, Scope, Access, Security, Review
  const [wizardData, setWizardData] = useState({
    // Step 0: Identity & Employment
    fullNameAr: '', fullNameEn: '', email: '', secondaryEmail: '', employeeId: '', nationalId: '',
    idType: 'SA_ID', // SA_ID, IQAMA, PASSPORT, GCC_ID, EG_ID
    nationality: 'SA', department: '', jobTitle: '', jobTitleEn: '', managerId: '', phone: '', extensionNumber: '',
    employmentType: 'FullTime', // FullTime, Contract, Consultant, Vendor, Temporary
    startDate: '', status: 'Invite',
    // Step 1: Entity Scope & Boundaries
    scopeType: 'ENTITY', // GROUP | ENTITY | BU | SITE
    selectedEntities: [], selectedBUs: [], selectedSites: [],
    dataClassificationAccess: 'Internal', // Public, Internal, Confidential, Restricted, TopSecret
    regulatoryScope: [], // SAMA, CMA, NCA, SDAIA, ZATCA, CBE, CBUAE
    // Step 2: Access & Role Controls
    selectedRoles: [], customPermOverrides: {}, delegationEnabled: false, delegateTo: '', delegationExpiry: '',
    // Step 3: Security & Compliance
    sessionPolicy: 'Standard', doaLevel: 'Medium', requireMFA: true,
    mfaMethod: 'APP', // APP, SMS, EMAIL, HARDWARE
    accessExpiry: '', ipRestriction: false, allowedIPs: '', workingHoursOnly: false, workingHoursStart: '08:00',
    workingHoursEnd: '17:00', vpnRequired: false,
    passwordPolicy: 'Standard', // Standard, Enhanced, Critical
    deviceTrust: 'Any', // Any, Managed, Certified
    geoRestriction: 'None', // None, Country, City
    allowedCountries: ['SA'], complianceAcknowledgment: false, ndaSigned: false, securityTrainingCompleted: false,
    dataProtectionTraining: false, notes: '',
    // Step 4: Review & Confirm (computed, no new fields)
  });
  const [wizardErrors, setWizardErrors] = useState({});
  const [wizardLoading, setWizardLoading] = useState(false);
  const [managerSearch, setManagerSearch] = useState('');
  const [showManagerDropdown, setShowManagerDropdown] = useState(false);

  // ID Type Options - International
  const ID_TYPES = [
    { code: 'SA_ID', label: 'Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ© Ø³Ø¹ÙˆØ¯ÙŠØ©', labelEn: 'Saudi National ID', pattern: /^[12]\d{9}$/, placeholder: 'ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 1 Ø£Ùˆ 2 (10 Ø£Ø±Ù‚Ø§Ù…)', countries: ['SA'] },
    { code: 'IQAMA', label: 'Ø¥Ù‚Ø§Ù…Ø©', labelEn: 'Iqama (Residency)', pattern: /^[2]\d{9}$/, placeholder: 'ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 2 (10 Ø£Ø±Ù‚Ø§Ù…)', countries: ['SA'] },
    { code: 'GCC_ID', label: 'Ù‡ÙˆÙŠØ© Ø®Ù„ÙŠØ¬ÙŠØ©', labelEn: 'GCC National ID', pattern: /^\d{10,12}$/, placeholder: '10-12 Ø±Ù‚Ù…', countries: ['AE', 'BH', 'KW', 'OM', 'QA'] },
    { code: 'EG_ID', label: 'Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ Ù…ØµØ±ÙŠ', labelEn: 'Egyptian National ID', pattern: /^\d{14}$/, placeholder: '14 Ø±Ù‚Ù…', countries: ['EG'] },
    { code: 'PASSPORT', label: 'Ø¬ÙˆØ§Ø² Ø³ÙØ±', labelEn: 'Passport', pattern: /^[A-Z0-9]{6,12}$/, placeholder: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²', countries: ['ALL'] },
  ];

  // Nationality Options
  const NATIONALITIES = [
    { code: 'SA', label: 'Ø³Ø¹ÙˆØ¯ÙŠ', labelEn: 'Saudi', flag: 'ğŸ‡¸ğŸ‡¦' },
    { code: 'AE', label: 'Ø¥Ù…Ø§Ø±Ø§ØªÙŠ', labelEn: 'Emirati', flag: 'ğŸ‡¦ğŸ‡ª' },
    { code: 'BH', label: 'Ø¨Ø­Ø±ÙŠÙ†ÙŠ', labelEn: 'Bahraini', flag: 'ğŸ‡§ğŸ‡­' },
    { code: 'KW', label: 'ÙƒÙˆÙŠØªÙŠ', labelEn: 'Kuwaiti', flag: 'ğŸ‡°ğŸ‡¼' },
    { code: 'OM', label: 'Ø¹Ù…Ø§Ù†ÙŠ', labelEn: 'Omani', flag: 'ğŸ‡´ğŸ‡²' },
    { code: 'QA', label: 'Ù‚Ø·Ø±ÙŠ', labelEn: 'Qatari', flag: 'ğŸ‡¶ğŸ‡¦' },
    { code: 'EG', label: 'Ù…ØµØ±ÙŠ', labelEn: 'Egyptian', flag: 'ğŸ‡ªğŸ‡¬' },
    { code: 'JO', label: 'Ø£Ø±Ø¯Ù†ÙŠ', labelEn: 'Jordanian', flag: 'ğŸ‡¯ğŸ‡´' },
    { code: 'LB', label: 'Ù„Ø¨Ù†Ø§Ù†ÙŠ', labelEn: 'Lebanese', flag: 'ğŸ‡±ğŸ‡§' },
    { code: 'OTHER', label: 'Ø£Ø®Ø±Ù‰', labelEn: 'Other', flag: 'ğŸŒ' },
  ];

  // Employment Types
  const EMPLOYMENT_TYPES = [
    { code: 'FullTime', label: 'Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„', labelEn: 'Full-Time', icon: 'ğŸ‘¤', color: 'emerald' },
    { code: 'Contract', label: 'Ø¹Ù‚Ø¯ Ù…Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø©', labelEn: 'Fixed-Term Contract', icon: 'ğŸ“‹', color: 'blue' },
    { code: 'Consultant', label: 'Ø§Ø³ØªØ´Ø§Ø±ÙŠ', labelEn: 'Consultant', icon: 'ğŸ’¼', color: 'purple' },
    { code: 'Vendor', label: 'Ø·Ø±Ù Ø«Ø§Ù„Ø« / Ù…ÙˆØ±Ø¯', labelEn: 'Third-Party / Vendor', icon: 'ğŸ¢', color: 'amber' },
    { code: 'Temporary', label: 'Ù…Ø¤Ù‚Øª', labelEn: 'Temporary', icon: 'â³', color: 'slate' },
  ];

  // Regulatory Scope Options
  const REGULATORY_SCOPES = [
    { code: 'SAMA', label: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', labelEn: 'SAMA', flag: 'ğŸ‡¸ğŸ‡¦', color: 'emerald' },
    { code: 'CMA', label: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', labelEn: 'CMA', flag: 'ğŸ‡¸ğŸ‡¦', color: 'blue' },
    { code: 'NCA', label: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', labelEn: 'NCA', flag: 'ğŸ‡¸ğŸ‡¦', color: 'red' },
    { code: 'SDAIA', label: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', labelEn: 'SDAIA', flag: 'ğŸ‡¸ğŸ‡¦', color: 'purple' },
    { code: 'ZATCA', label: 'Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', labelEn: 'ZATCA', flag: 'ğŸ‡¸ğŸ‡¦', color: 'amber' },
    { code: 'CBUAE', label: 'Ù…ØµØ±Ù Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', labelEn: 'CBUAE', flag: 'ğŸ‡¦ğŸ‡ª', color: 'teal' },
    { code: 'CBE', label: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ', labelEn: 'CBE', flag: 'ğŸ‡ªğŸ‡¬', color: 'orange' },
    { code: 'CBB', label: 'Ù…ØµØ±Ù Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', labelEn: 'CBB', flag: 'ğŸ‡§ğŸ‡­', color: 'rose' },
  ];

  // Data Classification Levels
  const DATA_CLASSIFICATIONS = [
    { code: 'Public', label: 'Ø¹Ø§Ù…', labelEn: 'Public', color: 'emerald', icon: 'ğŸŸ¢', desc: 'Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹' },
    { code: 'Internal', label: 'Ø¯Ø§Ø®Ù„ÙŠ', labelEn: 'Internal', color: 'blue', icon: 'ğŸ”µ', desc: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ù…Ù†Ø´Ø£Ø©' },
    { code: 'Confidential', label: 'Ø³Ø±ÙŠ', labelEn: 'Confidential', color: 'amber', icon: 'ğŸŸ¡', desc: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø±ÙŠØ© Ù…Ø­Ø¯ÙˆØ¯Ø© Ø§Ù„ÙˆØµÙˆÙ„' },
    { code: 'Restricted', label: 'Ù…Ù‚ÙŠØ¯', labelEn: 'Restricted', color: 'orange', icon: 'ğŸŸ ', desc: 'Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚ÙŠØ¯Ø© - ØµÙ„Ø§Ø­ÙŠØ§Øª Ø®Ø§ØµØ©' },
    { code: 'TopSecret', label: 'Ø³Ø±ÙŠ Ù„Ù„ØºØ§ÙŠØ©', labelEn: 'Top Secret', color: 'red', icon: 'ğŸ”´', desc: 'Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ ØªØµÙ†ÙŠÙ' },
  ];

  // Wizard Validation - Enhanced 5-Step International
  const validateWizardStep = (step) => {
    const errors = {};
    if (step === 0) {
      if (!wizardData.fullNameAr.trim()) errors.fullNameAr = 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…Ø·Ù„ÙˆØ¨';
      if (!wizardData.email.trim()) errors.email = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨';
      else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(wizardData.email)) errors.email = 'ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      if (wizardData.nationalId) {
        const idConfig = ID_TYPES.find(t => t.code === wizardData.idType);
        if (idConfig && !idConfig.pattern.test(wizardData.nationalId)) errors.nationalId = `ØµÙŠØºØ© ${idConfig.label} ØºÙŠØ± ØµØ­ÙŠØ­Ø© - ${idConfig.placeholder}`;
      }
      if (!wizardData.department) errors.department = 'Ø§Ù„Ù‚Ø³Ù… Ù…Ø·Ù„ÙˆØ¨';
      if (!wizardData.employmentType) errors.employmentType = 'Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù…Ø·Ù„ÙˆØ¨';
      if (wizardData.employmentType === 'Vendor' && !wizardData.ndaSigned) errors.nda = 'ÙŠØ¬Ø¨ ØªÙˆÙ‚ÙŠØ¹ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¹Ø¯Ù… Ø§Ù„Ø¥ÙØµØ§Ø­ Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†';
    }
    if (step === 1) {
      if (wizardData.scopeType === 'ENTITY' && wizardData.selectedEntities.length === 0) errors.scope = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙŠØ§Ù† ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      if (wizardData.scopeType === 'BU' && wizardData.selectedBUs.length === 0) errors.scope = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      if (wizardData.scopeType === 'SITE' && wizardData.selectedSites.length === 0) errors.scope = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
    }
    if (step === 2) {
      if (wizardData.selectedRoles.length === 0) errors.roles = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
    }
    if (step === 3) {
      if (!wizardData.requireMFA && wizardData.dataClassificationAccess !== 'Public') {
        errors.mfa = 'MFA Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¹Ø§Ù…';
      }
      if (wizardData.employmentType === 'Vendor' && !wizardData.accessExpiry) {
        errors.expiry = 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†';
      }
    }
    setWizardErrors(errors);
    return Object.keys(errors).length === 0;
  };

  // SoD Live Check for Wizard
  const checkWizardSoD = () => {
    const conflicts = [];
    const aggregatedPerms = {};

    wizardData.selectedRoles.forEach(roleId => {
      const role = roles.find(r => r.id === roleId);
      if (role && IAM_API.rolePermissions[role.code]) {
        Object.entries(IAM_API.rolePermissions[role.code]).forEach(([module, actions]) => {
          if (!aggregatedPerms[module]) aggregatedPerms[module] = {};
          Object.entries(actions).forEach(([action, allowed]) => {
            if (allowed) aggregatedPerms[module][action] = true;
          });
        });
      }
    });
    if (aggregatedPerms.EVIDENCE?.CREATE && aggregatedPerms.EVIDENCE?.APPROVE) {
      conflicts.push({ severity: 'Critical', rule: 'SOD-EVD-001', message: 'ØªØ¹Ø§Ø±Ø¶: Ø±ÙØ¹ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø©', fix: 'Ø£Ø²Ù„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£Ùˆ Ø§Ù„Ø±ÙØ¹' });
    }
    if (aggregatedPerms.BREACHES?.CREATE && aggregatedPerms.BREACHES?.APPROVE) {
      conflicts.push({ severity: 'Critical', rule: 'SOD-BRH-001', message: 'ØªØ¹Ø§Ø±Ø¶: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', fix: 'Ø£Ø²Ù„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡' });
    }
    if (aggregatedPerms.INSPECTIONS?.CREATE && aggregatedPerms.INSPECTIONS?.EXPORT) {
      conflicts.push({ severity: 'Critical', rule: 'SOD-INS-002', message: 'ØªØ¹Ø§Ø±Ø¶: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØµØ¯ÙŠØ± Ø­Ø²Ù… Ø§Ù„ØªÙØªÙŠØ´', fix: 'Ø£Ø²Ù„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡' });
    }
    if (aggregatedPerms.OBLIGATIONS?.CREATE && aggregatedPerms.OBLIGATIONS?.ACTIVATE) {
      conflicts.push({ severity: 'High', rule: 'SOD-OBL-001', message: 'ØªØ¹Ø§Ø±Ø¶: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', fix: 'Ø£Ø²Ù„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡' });
    }

    return conflicts;
  };

  // Get aggregated permissions for preview
  const getWizardPermissionPreview = () => {
    const perms = {};
    wizardData.selectedRoles.forEach(roleId => {
      const role = roles.find(r => r.id === roleId);
      if (role && IAM_API.rolePermissions[role.code]) {
        Object.entries(IAM_API.rolePermissions[role.code]).forEach(([module, actions]) => {
          if (!perms[module]) perms[module] = {};
          Object.entries(actions).forEach(([action, allowed]) => {
            if (allowed) perms[module][action] = true;
          });
        });
      }
    });
    return perms;
  };

  // Create User from Wizard
  const handleWizardSubmit = async (sendInvite = false) => {
    if (!validateWizardStep(3)) return;

    const sodConflicts = checkWizardSoD();
    if (sodConflicts.some(c => c.severity === 'Critical')) {
      showNotification('ÙŠÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø­Ø±Ø¬Ø© ÙŠØ¬Ø¨ Ø­Ù„Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }

    setWizardLoading(true);

    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 800));

    if (userEditMode && editingUserId) {
      // UPDATE EXISTING USER
      const updatedUser = {
        id: editingUserId, name: wizardData.fullNameAr, nameEn: wizardData.fullNameEn, email: wizardData.email,
        employeeId: wizardData.employeeId, nationalId: wizardData.nationalId, department: wizardData.department,
        jobTitle: wizardData.jobTitle,
        managerId: wizardData.managerId ? parseInt(wizardData.managerId) : null,
        phone: wizardData.phone, status: wizardData.status,
        entityScope: wizardData.scopeType === 'TENANT' ? 'TENANT-001' : wizardData.selectedEntities[0],
        buScope: wizardData.selectedBUs[0] || null, siteScope: wizardData.selectedSites[0] || null,
        sessionPolicy: wizardData.sessionPolicy, doaLevel: wizardData.doaLevel,
        mfaEnabled: wizardData.requireMFA
      };

      // Update user in state
      setUsers(prev => prev.map(u => u.id === editingUserId ? { ...u, ...updatedUser } : u));

      // Update role assignments - remove old ones and add new ones
      setRoleAssignments(prev => prev.filter(ra => ra.userId !== editingUserId));

      wizardData.selectedRoles.forEach(roleId => {
        const assignment = {
          id: Date.now() + Math.random(), userId: editingUserId, roleId: roleId, scopeType: wizardData.scopeType,
          scopeId: wizardData.scopeType === 'TENANT' ? 'TENANT-001' :
            wizardData.scopeType === 'ENTITY' ? wizardData.selectedEntities[0] :
              wizardData.scopeType === 'BU' ? wizardData.selectedBUs[0] : wizardData.selectedSites[0],
          validFrom: new Date().toISOString().split('T')[0], validTo: wizardData.accessExpiry || null, status: 'Active',
          createdAt: new Date().toISOString()
        };
        setRoleAssignments(prev => [...prev, assignment]);
      });

      // Audit log for update
      logAction('UPDATE_USER', 'IAM', 'USER', editingUserId, {
        name: updatedUser.name, email: updatedUser.email,
        roles: wizardData.selectedRoles.map(id => roles.find(r => r.id === id)?.name),
        scope: wizardData.scopeType,
        changes: 'User data and roles updated via wizard'
      });

      setWizardLoading(false);
      showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');

    } else {
      // CREATE NEW USER
      const newUser = {
        id: Date.now(), name: wizardData.fullNameAr, nameEn: wizardData.fullNameEn, email: wizardData.email,
        employeeId: wizardData.employeeId, nationalId: wizardData.nationalId, department: wizardData.department,
        jobTitle: wizardData.jobTitle,
        managerId: wizardData.managerId ? parseInt(wizardData.managerId) : null,
        phone: wizardData.phone, status: sendInvite ? 'Invite' : 'Active',
        entityScope: wizardData.scopeType === 'TENANT' ? 'TENANT-001' : wizardData.selectedEntities[0],
        buScope: wizardData.selectedBUs[0] || null, siteScope: wizardData.selectedSites[0] || null,
        sessionPolicy: wizardData.sessionPolicy, doaLevel: wizardData.doaLevel, mfaEnabled: wizardData.requireMFA,
        createdAt: new Date().toISOString(), lastLogin: new Date().toISOString(),
        inviteToken: sendInvite ? `INV-${Date.now()}-${Math.random().toString(36).substr(2, 9)}` : null,
        inviteExpiry: sendInvite ? new Date(Date.now() + 72 * 60 * 60 * 1000).toISOString() : null
      };

      // Add user
      setUsers(prev => [newUser, ...prev]);

      // Create role assignments
      wizardData.selectedRoles.forEach(roleId => {
        const assignment = {
          id: Date.now() + Math.random(), userId: newUser.id, roleId: roleId, scopeType: wizardData.scopeType,
          scopeId: wizardData.scopeType === 'TENANT' ? 'TENANT-001' :
            wizardData.scopeType === 'ENTITY' ? wizardData.selectedEntities[0] :
              wizardData.scopeType === 'BU' ? wizardData.selectedBUs[0] : wizardData.selectedSites[0],
          validFrom: new Date().toISOString().split('T')[0], validTo: wizardData.accessExpiry || null, status: 'Active',
          createdAt: new Date().toISOString()
        };
        setRoleAssignments(prev => [assignment, ...prev]);
      });

      // Audit log
      logAction(sendInvite ? 'INVITE_USER' : 'CREATE_USER', 'IAM', 'USER', newUser.id, {
        name: newUser.name, email: newUser.email,
        roles: wizardData.selectedRoles.map(id => roles.find(r => r.id === id)?.name),
        scope: wizardData.scopeType
      });

      setWizardLoading(false);
      showNotification(sendInvite ? 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­' : 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­');
    }

    setShowCreateUserModal(false);

    // Reset wizard
    setWizardStep(0);
    setUserEditMode(false);
    setEditingUserId(null);
    setWizardData({
      fullNameAr: '', fullNameEn: '', email: '', secondaryEmail: '', employeeId: '', nationalId: '',
      idType: 'SA_ID', nationality: 'SA',
      department: '', jobTitle: '', jobTitleEn: '', managerId: '', phone: '', extensionNumber: '',
      employmentType: 'FullTime', startDate: '', status: 'Invite',
      scopeType: 'ENTITY', selectedEntities: [], selectedBUs: [], selectedSites: [],
      dataClassificationAccess: 'Internal', regulatoryScope: [],
      selectedRoles: [], customPermOverrides: {}, delegationEnabled: false, delegateTo: '', delegationExpiry: '',
      sessionPolicy: 'Standard', doaLevel: 'Medium', requireMFA: true, mfaMethod: 'APP',
      accessExpiry: '', ipRestriction: false, allowedIPs: '', workingHoursOnly: false,
      workingHoursStart: '08:00', workingHoursEnd: '17:00', vpnRequired: false,
      passwordPolicy: 'Standard', deviceTrust: 'Any', geoRestriction: 'None', allowedCountries: ['SA'],
      complianceAcknowledgment: false, ndaSigned: false, securityTrainingCompleted: false,
      dataProtectionTraining: false, notes: ''
    });
    setWizardErrors({});
  };

  // Department options
  const DEPARTMENTS = [
    { id: 'GRC', name: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„', nameEn: 'GRC' },
    { id: 'IT', name: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'IT' },
    { id: 'FINANCE', name: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ©', nameEn: 'Finance' },
    { id: 'HR', name: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', nameEn: 'HR' },
    { id: 'OPERATIONS', name: 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', nameEn: 'Operations' },
    { id: 'LEGAL', name: 'Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©', nameEn: 'Legal' },
    { id: 'AUDIT', name: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Internal Audit' },
    { id: 'EXECUTIVE', name: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©', nameEn: 'Executive' },
    { id: 'RISK', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', nameEn: 'Risk Management' },
    { id: 'SECURITY', name: 'Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', nameEn: 'Information Security' }
  ];

  // Current logged-in user (mock auth)
  const [currentUser, setCurrentUser] = useState(IAM_API.users[4]); // Admin user

  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const logAction = (action, module, entityType, entityId, details = {}, before = null, after = null) => {
    const log = createAuditLog(currentUser.id, currentUser.name, action, module, entityType, entityId, details, before, after);
    setAuditLogs(prev => [log, ...prev]);
  };

  // Entity Helpers
  const getEntityName = (entityId) => {
    if (entityId === 'TENANT-001') return IAM_API.tenant.name;
    const entity = legalEntities.find(e => e.id === entityId);
    return entity?.name || entityId;
  };

  const getBUName = (buId) => {
    const bu = businessUnits.find(b => b.id === buId);
    return bu?.name || buId;
  };

  const getSiteName = (siteId) => {
    const site = sites.find(s => s.id === siteId);
    return site?.name || siteId;
  };

  const getUserScopeLabel = (user) => {
    if (user.entityScope === 'TENANT-001') return 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©';
    if (user.siteScope) return getSiteName(user.siteScope);
    if (user.buScope) return getBUName(user.buScope);
    return getEntityName(user.entityScope);
  };

  // User Actions
  const deactivateUser = (userId) => {
    const user = users.find(u => u.id === userId);
    setUsers(prev => prev.map(u => u.id === userId ? { ...u, status: 'Inactive' } : u));
    logAction('DEACTIVATE_USER', 'IAM', 'USER', userId, { reason: 'Manual deactivation' }, { status: 'Active' }, { status: 'Inactive' });
    showNotification('ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
  };

  const activateUser = (userId) => {
    setUsers(prev => prev.map(u => u.id === userId ? { ...u, status: 'Active' } : u));
    logAction('ACTIVATE_USER', 'IAM', 'USER', userId, { reason: 'Manual activation' }, { status: 'Inactive' }, { status: 'Active' });
    showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
  };

  const resetMFA = (userId) => {
    setUsers(prev => prev.map(u => u.id === userId ? { ...u, mfaEnabled: false } : u));
    logAction('RESET_MFA', 'IAM', 'USER', userId);
    showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† MFA Ø¨Ù†Ø¬Ø§Ø­');
  };

  // Edit User - Open wizard with user data
  const handleEditUser = (user) => {
    setWizardData({
      fullNameAr: user.name || '', fullNameEn: user.nameEn || '', email: user.email || '', employeeId: user.employeeId || '',
      nationalId: user.nationalId || '', department: user.department || '', jobTitle: user.jobTitle || '',
      managerId: user.managerId || '', phone: user.phone || '', status: user.status || 'Active',
      scopeType: user.entityScope?.startsWith('TENANT') ? 'TENANT' : 'ENTITY',
      selectedEntities: user.entityScope ? [user.entityScope] : [],
      selectedBUs: [], selectedSites: [],
      selectedRoles: roleAssignments.filter(ra => ra.userId === user.id).map(ra => ra.roleId),
      sessionPolicy: 'Standard', doaLevel: 'Medium', requireMFA: user.mfaEnabled || false, accessExpiry: '',
      notes: ''
    });
    setEditingUserId(user.id);
    setUserEditMode(true);
    setWizardStep(0);
    setShowCreateUserModal(true);
  };

  // Delete User - Show confirmation
  const handleDeleteUser = (user) => {
    setUserToDelete(user);
    setShowDeleteConfirm(true);
  };

  // Confirm Delete User
  const confirmDeleteUser = () => {
    if (userToDelete) {
      const deletedUser = userToDelete;
      setUsers(prev => prev.filter(u => u.id !== userToDelete.id));
      // Also remove role assignments
      setRoleAssignments(prev => prev.filter(ra => ra.userId !== userToDelete.id));
      logAction('DELETE_USER', 'IAM', 'USER', userToDelete.id, { userName: deletedUser.name });
      showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${deletedUser.name}" Ø¨Ù†Ø¬Ø§Ø­`);
      setShowDeleteConfirm(false);
      setUserToDelete(null);
    }
  };

  // Cancel Delete
  const cancelDeleteUser = () => {
    setShowDeleteConfirm(false);
    setUserToDelete(null);
  };

  // Permission Toggle
  const togglePermission = (roleCode, module, action) => {
    const before = rolePermissions[roleCode]?.[module]?.[action];
    setRolePermissions(prev => ({
      ...prev,
      [roleCode]: {
        ...prev[roleCode],
        [module]: {
          ...prev[roleCode]?.[module],
          [action]: !prev[roleCode]?.[module]?.[action]
        }
      }
    }));
    logAction('TOGGLE_PERMISSION', 'IAM', 'PERMISSION', `${roleCode}-${module}-${action}`, {}, { value: before }, { value: !before });
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©');
  };

  // SoD Rule Toggle
  const toggleSodRule = (ruleId) => {
    setSodRules(prev => prev.map(r => r.id === ruleId ? { ...r, status: r.status === 'Active' ? 'Inactive' : 'Active' } : r));
    const rule = sodRules.find(r => r.id === ruleId);
    logAction('TOGGLE_SOD_RULE', 'IAM', 'SOD_RULE', ruleId, { newStatus: rule?.status === 'Active' ? 'Inactive' : 'Active' });
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ù‚Ø§Ø¹Ø¯Ø© SoD');
  };

  // SoD Simulation
  const runSodSimulation = () => {
    if (!sodSimUser) {
      showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù…', 'error');
      return;
    }
    const user = users.find(u => u.id === parseInt(sodSimUser));
    const recordMetadata = sodSimOwnerId ? { uploadedBy: parseInt(sodSimOwnerId), createdBy: parseInt(sodSimOwnerId), ownerId: parseInt(sodSimOwnerId), executedBy: parseInt(sodSimOwnerId), preparedBy: parseInt(sodSimOwnerId) } : {};
    const result = PermissionService.guardAction(user, sodSimModule, sodSimAction, 'LE-001', recordMetadata, 'Medium');
    setSodSimResult(result);
  };

  const filteredUsers = useMemo(() => {
    return users.filter(u => {
      const matchSearch = u.name.includes(searchTerm) || u.email.includes(searchTerm);
      const matchStatus = filterStatus === 'all' || u.status.toLowerCase() === filterStatus;
      const matchEntity = filterEntity === 'all' || u.entityScope === filterEntity || u.entityScope === 'TENANT-001';
      return matchSearch && matchStatus && matchEntity;
    });
  }, [users, searchTerm, filterStatus, filterEntity]);

  // Get user's roles with scope
  const getUserRolesWithScope = (userId) => {
    return roleAssignments.filter(ra => ra.userId === userId && ra.status === 'Active').map(ra => {
      const role = roles.find(r => r.id === ra.roleId);
      return { ...ra, role };
    });
  };

  // Role Assignment Management with Audit
  const assignRole = (userId, roleId, scopeType, scopeId) => {
    const user = users.find(u => u.id === userId);
    const role = roles.find(r => r.id === roleId);
    const newAssignment = {
      id: Date.now(),
      userId,
      roleId,
      scopeType,
      scopeId,
      validFrom: new Date().toISOString().split('T')[0], validTo: null,
      status: 'Active'
    };
    setRoleAssignments(prev => [...prev, newAssignment]);
    logAction('ASSIGN_ROLE', 'IAM', 'ROLE_ASSIGNMENT', newAssignment.id,
      { userId, roleId, scopeType, scopeId, userName: user?.name, roleName: role?.name },
      null,
      newAssignment
    );
    showNotification(`ØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ø¯ÙˆØ± "${role?.name}" Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user?.name}"`);
  };

  const revokeRole = (assignmentId) => {
    const assignment = roleAssignments.find(ra => ra.id === assignmentId);
    const user = users.find(u => u.id === assignment?.userId);
    const role = roles.find(r => r.id === assignment?.roleId);

    setRoleAssignments(prev => prev.map(ra =>
      ra.id === assignmentId ? { ...ra, status: 'Revoked', validTo: new Date().toISOString().split('T')[0] } : ra
    ));
    logAction('REVOKE_ROLE', 'IAM', 'ROLE_ASSIGNMENT', assignmentId,
      { userId: assignment?.userId, roleId: assignment?.roleId, userName: user?.name, roleName: role?.name },
      { status: 'Active' },
      { status: 'Revoked' }
    );
    showNotification(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ± "${role?.name}" Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user?.name}"`);
  };

  const updateRoleAssignment = (assignmentId, updates) => {
    const assignment = roleAssignments.find(ra => ra.id === assignmentId);
    const before = { ...assignment };

    setRoleAssignments(prev => prev.map(ra =>
      ra.id === assignmentId ? { ...ra, ...updates } : ra
    ));
    logAction('UPDATE_ROLE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', assignmentId,
      { changes: Object.keys(updates) },
      before,
      { ...before, ...updates }
    );
    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ±');
  };

  const MODULES = IAM_API.modules;
  const ACTIONS = IAM_API.actions;
  const MODULE_LABELS = { OBLIGATIONS: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª', EVIDENCE: 'Ø§Ù„Ø£Ø¯Ù„Ø©', TESTING: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', BREACHES: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', INSPECTIONS: 'Ø§Ù„ØªÙØªÙŠØ´', COMMUNICATIONS: 'Ø§Ù„ØªÙˆØ§ØµÙ„', IAM: 'Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª' };
  const ACTION_LABELS = { VIEW: 'Ø¹Ø±Ø¶', CREATE: 'Ø¥Ù†Ø´Ø§Ø¡', EDIT: 'ØªØ¹Ø¯ÙŠÙ„', SUBMIT: 'ØªÙ‚Ø¯ÙŠÙ…', APPROVE: 'Ø§Ø¹ØªÙ…Ø§Ø¯', ACTIVATE: 'ØªÙØ¹ÙŠÙ„', RETIRE: 'Ø¥ÙŠÙ‚Ø§Ù', EXPORT: 'ØªØµØ¯ÙŠØ±', ADMIN: 'Ø¥Ø¯Ø§Ø±Ø©' };

  return (
    <div className="h-full flex flex-col bg-slate-100 min-w-0">
      {notification && (
        <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg ${notification.type === 'success' ? 'bg-emerald-500' : notification.type === 'warning' ? 'bg-amber-500' : notification.type === 'info' ? 'bg-blue-500' : 'bg-red-500'
          } text-white font-bold flex items-center gap-2`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertTriangle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}

      <div className="bg-gradient-to-l from-violet-600 via-purple-700 to-indigo-800 text-white px-4 py-4">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
              <Lock className="w-6 h-6" />
            </div>
            <div>
              <h1 className="text-xl font-black">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h1>
              <p className="text-purple-200 text-sm">Identity & Access Management - Module 0</p>
            </div> </div>
          <div className="flex items-center gap-3 bg-white/10 rounded-xl px-4 py-2">
            <div className="text-center px-2 border-l border-white/20">
              <p className="text-lg font-black">{legalEntities.length}</p>
              <p className="text-[10px] text-purple-200">ÙƒÙŠØ§Ù†</p>
            </div>
            <div className="text-center px-2 border-l border-white/20">
              <p className="text-lg font-black">{roles.length}</p>
              <p className="text-[10px] text-purple-200">Ø¯ÙˆØ±</p>
            </div>
            <div className="text-center px-2 border-l border-white/20">
              <p className="text-lg font-black">{users.filter(u => u.status === 'Active').length}</p>
              <p className="text-[10px] text-purple-200">Ù…Ø³ØªØ®Ø¯Ù…</p>
            </div>
            <div className="text-center px-2 border-l border-white/20">
              <p className="text-lg font-black text-amber-300">{permissionRequests.filter(r => r.status === 'Pending').length}</p>
              <p className="text-[10px] text-purple-200">Ù…Ø¹Ù„Ù‚</p>
            </div>
            <div className="text-center px-2 border-l border-white/20">
              <p className="text-lg font-black">{sodRules.filter(r => r.status === 'Active').length}</p>
              <p className="text-[10px] text-purple-200">ÙØµÙ„ Ù…Ù‡Ø§Ù…</p>
            </div>
            <div className="text-center px-2">
              <p className="text-lg font-black">{doaMatrix.length}</p>
              <p className="text-[10px] text-purple-200">Ø§Ø¹ØªÙ…Ø§Ø¯</p>
            </div> </div> </div>
        <div className="flex items-center gap-2 overflow-x-auto pb-1">
          {[
            { id: 'entities', label: 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: Building2 },
            { id: 'roles', label: 'Ø§Ù„Ø£Ø¯ÙˆØ§Ø±', icon: Shield },
            { id: 'groups', label: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª', icon: FolderOpen },
            { id: 'users', label: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', icon: Users },
            { id: 'assignments', label: 'Ø§Ù„ØªØ¹ÙŠÙŠÙ†Ø§Øª', icon: UserCheck },
            { id: 'requests', label: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª', icon: Send },
            { id: 'delegations', label: 'Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª', icon: RefreshCw },
            { id: 'sod', label: 'ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…', icon: GitBranch },
            { id: 'doa', label: 'Ù…ØµÙÙˆÙØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', icon: Scale },
            { id: 'security', label: 'Ø§Ù„Ø£Ù…Ø§Ù†', icon: Lock },
            { id: 'sessions', label: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª', icon: Activity },
            { id: 'audit', label: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', icon: History },
          ].map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold transition-all whitespace-nowrap ${activeTab === tab.id
                ? 'bg-white text-purple-700 shadow-lg'
                : 'bg-white/10 text-white hover:bg-white/20'
                }`}>
              <tab.icon className="w-4 h-4" />
              {tab.label}
            </button>
          ))}
        </div> </div>
      <div className="flex-1 overflow-auto p-4 lg:p-6">
        {activeTab === 'entities' && (
          <div className="space-y-6">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 rounded-2xl p-6 text-white">
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center flex-shrink-0">
                  <Building className="w-6 h-6 lg:w-8 lg:h-8" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-purple-200 text-xs lg:text-sm">Holding Company (Tenant)</p>
                  <h2 className="text-lg lg:text-2xl font-black truncate">{IAM_API.tenant.name}</h2>
                  <p className="text-purple-200 text-sm truncate">{IAM_API.tenant.nameEn}</p>
                </div>
                <div className="text-right flex-shrink-0">
                  <span className="bg-emerald-400 text-emerald-900 px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-bold">{IAM_API.tenant.status}</span>
                  <p className="text-xs text-purple-200 mt-2">{IAM_API.tenant.industry}</p>
                </div> </div> </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
                  <h2 className="text-lg font-black text-white flex items-center gap-2">
                    <Building2 className="w-5 h-5 text-purple-400" />
                    Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ({legalEntities.length})
                  </h2>
                  <button className="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-bold hover:bg-purple-600">
                    <Plus className="w-4 h-4 inline ml-1" />Ø¥Ø¶Ø§ÙØ©
                  </button> </div>
                <div className="divide-y divide-slate-100">
                  {legalEntities.map(entity => (
                    <div key={entity.id} className="p-4 hover:bg-slate-50">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${entity.type === 'Bank' ? 'bg-emerald-100 text-emerald-600' :
                            entity.type === 'Investment' ? 'bg-blue-100 text-blue-600' :
                              entity.type === 'Insurance' ? 'bg-amber-100 text-amber-600' :
                                'bg-purple-100 text-purple-600'
                            }`}>
                            {entity.type === 'Bank' ? 'ğŸ¦' : entity.type === 'Investment' ? 'ğŸ“ˆ' : entity.type === 'Insurance' ? 'ğŸ›¡ï¸' : 'ğŸ’°'}
                          </div>
                          <div>
                            <p className="font-bold text-slate-800">{entity.name}</p>
                            <p className="text-xs text-slate-500">{entity.code} â€¢ {entity.regulator}</p>
                          </div> </div>
                        <div className="flex items-center gap-2">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${entity.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                            }`}>{entity.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</span>
                          <button className="p-2 text-slate-400 hover:text-slate-600"><Edit className="w-4 h-4" /></button>
                        </div> </div>
                      {entity.parentId && (
                        <p className="text-xs text-slate-400 mt-2 mr-13">â†³ ØªØ§Ø¨Ø¹ Ù„Ù€: {getEntityName(entity.parentId)}</p>
                      )}
                    </div>
                  ))}
                </div> </div>
              <div className="space-y-6">
                <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
                    <h2 className="text-lg font-black text-white flex items-center gap-2">
                      <Briefcase className="w-5 h-5 text-cyan-400" />
                      Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ({businessUnits.length})
                    </h2>
                    <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-bold hover:bg-cyan-600">
                      <Plus className="w-4 h-4 inline ml-1" />Ø¥Ø¶Ø§ÙØ©
                    </button> </div>
                  <div className="divide-y divide-slate-100 max-h-48 overflow-y-auto">
                    {businessUnits.map(bu => (
                      <div key={bu.id} className="p-3 hover:bg-slate-50 flex items-center justify-between">
                        <div>
                          <p className="font-bold text-slate-800 text-sm">{bu.name}</p>
                          <p className="text-xs text-slate-500">{bu.code} â€¢ {getEntityName(bu.entityId)}</p>
                        </div>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${bu.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                          }`}>{bu.status === 'Active' ? 'âœ“' : 'âœ—'}</span>
                      </div>
                    ))}
                  </div> </div>
                <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
                    <h2 className="text-lg font-black text-white flex items-center gap-2">
                      <MapPin className="w-5 h-5 text-amber-400" />
                      Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ§Ù„ÙØ±ÙˆØ¹ ({sites.length})
                    </h2>
                    <button className="px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-bold hover:bg-amber-600">
                      <Plus className="w-4 h-4 inline ml-1" />Ø¥Ø¶Ø§ÙØ©
                    </button> </div>
                  <div className="divide-y divide-slate-100 max-h-48 overflow-y-auto">
                    {sites.map(site => (
                      <div key={site.id} className="p-3 hover:bg-slate-50 flex items-center justify-between">
                        <div>
                          <p className="font-bold text-slate-800 text-sm">{site.name}</p>
                          <p className="text-xs text-slate-500">{site.code} â€¢ {site.city}</p>
                        </div>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${site.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                          }`}>{site.status === 'Active' ? 'âœ“' : 'âœ—'}</span>
                      </div>
                    ))}
                  </div> </div> </div> </div> </div>
        )}

        {activeTab === 'users' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between flex-wrap gap-3">
              <div className="flex items-center gap-3">
                <div className="relative">
                  <Search className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5" />
                  <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..." value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl w-64" />
                </div>
                <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="active">Ù†Ø´Ø·</option>
                  <option value="inactive">Ù…Ø¹Ø·Ù„</option>
                </select>
                <select value={filterEntity} onChange={(e) => setFilterEntity(e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª</option>
                  {legalEntities.map(e => <option key={e.id} value={e.id}>{e.name}</option>)}
                </select>
              </div>

              <div className="flex items-center gap-2">
                {selectedUsers.length > 0 && (
                  <div className="flex items-center gap-2 px-3 py-1.5 bg-purple-100 rounded-xl border border-purple-200">
                    <span className="text-sm font-bold text-purple-700">{selectedUsers.length} Ù…Ø­Ø¯Ø¯</span>
                    <button onClick={() => {
                      setUsers(prev => prev.map(u => selectedUsers.includes(u.id) ? { ...u, status: 'Active' } : u));
                      setSelectedUsers([]);
                      showNotification('success', `ØªÙ… ØªÙØ¹ÙŠÙ„ ${selectedUsers.length} Ù…Ø³ØªØ®Ø¯Ù…`);
                    }} className="p-1.5 bg-emerald-500 text-white rounded-lg" title="ØªÙØ¹ÙŠÙ„">
                      <UserCheck className="w-4 h-4" />
                    </button>
                    <button onClick={() => {
                      setUsers(prev => prev.map(u => selectedUsers.includes(u.id) ? { ...u, status: 'Inactive' } : u));
                      setSelectedUsers([]);
                      showNotification('warning', `ØªÙ… ØªØ¹Ø·ÙŠÙ„ ${selectedUsers.length} Ù…Ø³ØªØ®Ø¯Ù…`);
                    }} className="p-1.5 bg-amber-500 text-white rounded-lg" title="ØªØ¹Ø·ÙŠÙ„">
                      <UserX className="w-4 h-4" />
                    </button>
                    <button onClick={() => setSelectedUsers([])} className="p-1.5 bg-slate-400 text-white rounded-lg" title="Ø¥Ù„ØºØ§Ø¡">
                      <X className="w-4 h-4" />
                    </button> </div>
                )}

                <button onClick={() => setShowImportModal(true)}
                  className="flex items-center gap-2 px-3 py-2 bg-emerald-100 text-emerald-700 border border-emerald-300 rounded-xl font-bold hover:bg-emerald-200">
                  <FileUp className="w-4 h-4" />Ø§Ø³ØªÙŠØ±Ø§Ø¯
                </button>

                <button onClick={() => {
                  const csvContent = "Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ø¨Ø±ÙŠØ¯,Ø§Ù„Ø¬ÙˆØ§Ù„,Ø§Ù„ÙˆØ¸ÙŠÙØ©,Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©,Ø§Ù„Ø­Ø§Ù„Ø©\n" +
                    users.map(u => `${u.name},${u.email},${u.phone},${u.jobTitle},${u.department},${u.status}`).join('\n');
                  const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = 'users_export.csv';
                  a.click();
                  showNotification('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
                }} className="flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 border border-blue-300 rounded-xl font-bold hover:bg-blue-200">
                  <FileDown className="w-4 h-4" />ØªØµØ¯ÙŠØ±
                </button>

                <button onClick={() => setShowCompareModal(true)}
                  className="flex items-center gap-2 px-3 py-2 bg-amber-100 text-amber-700 border border-amber-300 rounded-xl font-bold hover:bg-amber-200">
                  <Scale className="w-4 h-4" />Ù…Ù‚Ø§Ø±Ù†Ø©
                </button>

                <button onClick={() => setShowCreateUserModal(true)}
                  className="flex items-center gap-2 px-6 py-2 bg-purple-500 text-white rounded-xl font-bold hover:bg-purple-600">
                  <Plus className="w-5 h-5" />
                  Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                </button> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="px-3 py-3 text-center w-10">
                      <input type="checkbox"
                        checked={selectedUsers.length === filteredUsers.length && filteredUsers.length > 0}
                        onChange={(e) => setSelectedUsers(e.target.checked ? filteredUsers.map(u => u.id) : [])}
                        className="w-4 h-4 rounded border-slate-300" />
                    </th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙƒÙŠØ§Ù†</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">MFA</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr> </thead>
                <tbody className="divide-y divide-slate-100">
                  {filteredUsers.map(user => (
                    <tr key={user.id} className={`hover:bg-slate-50 ${selectedUsers.includes(user.id) ? 'bg-purple-50' : ''}`}>
                      <td className="px-3 py-3 text-center">
                        <input type="checkbox"
                          checked={selectedUsers.includes(user.id)}
                          onChange={(e) => {
                            if (e.target.checked) {
                              setSelectedUsers(prev => [...prev, user.id]);
                            } else {
                              setSelectedUsers(prev => prev.filter(id => id !== user.id));
                            }
                          }}
                          className="w-4 h-4 rounded border-slate-300" />
                      </td>
                      <td className="px-4 py-3">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                            {user.name.charAt(0)}
                          </div>
                          <div>
                            <p className="font-bold text-slate-800">{user.name}</p>
                            <p className="text-xs text-slate-500">{user.jobTitle}</p>
                          </div> </div> </td>
                      <td className="px-4 py-3 text-slate-600 text-sm">{user.email}</td>
                      <td className="px-4 py-3">
                        <span className={`px-2 py-1 rounded text-xs font-bold ${user.entityScope === 'TENANT-001' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'
                          }`}>{getUserScopeLabel(user)}</span>
                      </td>
                      <td className="px-4 py-3 text-center">
                        <span className={`px-2 py-1 rounded-lg text-xs font-bold ${user.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                          }`}>{user.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</span>
                      </td>
                      <td className="px-4 py-3 text-center">
                        {user.mfaEnabled ? (
                          <CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto" />
                        ) : (
                          <XCircle className="w-5 h-5 text-red-500 mx-auto" />
                        )}
                      </td>
                      <td className="px-4 py-3 text-center text-sm text-slate-600">
                        {new Date(user.lastLogin).toLocaleDateString('ar-SA')}
                      </td>
                      <td className="px-4 py-3 text-center">
                        <div className="flex items-center justify-center gap-1">
                          <button onClick={() => { setSelectedUser(user); setShowUserDrawer(true); }}
                            className="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-all" title="Ø¹Ø±Ø¶">
                            <Eye className="w-4 h-4" />
                          </button>
                          <button onClick={() => handleEditUser(user)}
                            className="p-2 bg-amber-100 text-amber-600 rounded-lg hover:bg-amber-200 transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                            <Edit className="w-4 h-4" />
                          </button>
                          {user.status === 'Active' ? (
                            <button onClick={() => deactivateUser(user.id)}
                              className="p-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-all" title="ØªØ¹Ø·ÙŠÙ„">
                              <UserX className="w-4 h-4" />
                            </button>
                          ) : (
                            <button onClick={() => activateUser(user.id)}
                              className="p-2 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200 transition-all" title="ØªÙØ¹ÙŠÙ„">
                              <UserCheck className="w-4 h-4" />
                            </button>
                          )}
                          <button onClick={() => handleDeleteUser(user)}
                            className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-all" title="Ø­Ø°Ù">
                            <Trash2 className="w-4 h-4" />
                          </button> </div> </td> </tr>
                  ))}
                </tbody> </table> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB 0.3: USER GROUPS - Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'groups' && (
          <div className="space-y-4 lg:space-y-6">
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div>
                <h2 className="text-xl lg:text-2xl font-black text-slate-800 flex items-center gap-3">
                  <div className="w-10 h-10 lg:w-12 lg:h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0">
                    <Users className="w-5 h-5 lg:w-6 lg:h-6 text-white" />
                  </div>
                  Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </h2>
                <p className="text-slate-500 mt-1 text-sm lg:text-base">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„ØªØ³Ù‡ÙŠÙ„ ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
              </div>
              <button onClick={() => {
                setGroupForm({ code: '', name: '', nameEn: '', description: '', memberIds: [], entityScope: 'TENANT-001', status: 'Active' });
                setSelectedGroup(null);
                setShowGroupModal(true);
              }}
                className="flex items-center justify-center gap-2 px-4 lg:px-6 py-2.5 lg:py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg transition-all whitespace-nowrap flex-shrink-0">
                <Plus className="w-5 h-5" />
                <span>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
              </button> </div>
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
              <div className="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl lg:rounded-2xl p-4 lg:p-5 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-purple-100 text-xs lg:text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</p>
                    <p className="text-2xl lg:text-4xl font-black mt-1">{userGroups.length}</p>
                  </div>
                  <FolderOpen className="w-8 h-8 lg:w-12 lg:h-12 text-white/30" />
                </div> </div>
              <div className="bg-white rounded-2xl p-5 border-2 border-slate-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†Ø´Ø·Ø©</p>
                    <p className="text-2xl lg:text-4xl font-black text-emerald-600 mt-1">{userGroups.filter(g => g.status === 'Active').length}</p>
                  </div>
                  <CheckCircle2 className="w-8 h-8 lg:w-12 lg:h-12 text-emerald-200" />
                </div> </div>
              <div className="bg-white rounded-xl lg:rounded-2xl p-4 lg:p-5 border-2 border-slate-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                    <p className="text-2xl lg:text-4xl font-black text-blue-600 mt-1">{userGroups.reduce((sum, g) => sum + (g.memberIds?.length || 0), 0)}</p>
                  </div>
                  <Users className="w-8 h-8 lg:w-12 lg:h-12 text-blue-200" />
                </div> </div>
              <div className="bg-white rounded-xl lg:rounded-2xl p-4 lg:p-5 border-2 border-slate-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                    <p className="text-2xl lg:text-4xl font-black text-amber-600 mt-1">{userGroups.length > 0 ? Math.round(userGroups.reduce((sum, g) => sum + (g.memberIds?.length || 0), 0) / userGroups.length) : 0}</p>
                  </div>
                  <TrendingUp className="w-8 h-8 lg:w-12 lg:h-12 text-amber-200" />
                </div> </div> </div>
            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-5">
              {userGroups.map(group => (
                <div key={group.id} className="bg-white rounded-xl lg:rounded-2xl border-2 border-slate-200 overflow-hidden hover:border-purple-300 hover:shadow-xl transition-all group">
                  <div className="bg-gradient-to-r from-slate-50 to-slate-100 px-4 lg:px-5 py-3 lg:py-4 border-b border-slate-200">
                    <div className="flex items-start justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 lg:w-14 lg:h-14 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg flex-shrink-0">
                          <Users className="w-7 h-7 text-white" />
                        </div>
                        <div>
                          <h3 className="font-bold text-slate-800 text-lg">{group.name}</h3>
                          <p className="text-sm text-slate-500">{group.nameEn}</p>
                          <span className="text-xs text-slate-400 font-mono">{group.code}</span>
                        </div> </div>
                      <span className={`px-3 py-1 rounded-lg text-xs font-bold ${group.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-200 text-slate-600'}`}>
                        {group.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                      </span> </div> </div>
                  <div className="p-5">
                    <p className="text-sm text-slate-600 mb-4 line-clamp-2 min-h-[40px]">{group.description}</p>

                    <div className="mb-4">
                      <p className="text-xs text-slate-500 mb-2 font-bold">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ({group.memberIds?.length || 0})</p>
                      <div className="flex items-center gap-2">
                        <div className="flex -space-x-2 rtl:space-x-reverse">
                          {group.memberIds?.slice(0, 5).map(memberId => {
                            const member = users.find(u => u.id === memberId);
                            return member ? (
                              <div key={memberId} className="w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 border-2 border-white flex items-center justify-center text-xs font-bold text-white shadow-md" title={member.name}>
                                {member.name.charAt(0)}
                              </div>
                            ) : null;
                          })}
                          {(group.memberIds?.length || 0) > 5 && (
                            <div className="w-9 h-9 rounded-full bg-slate-300 border-2 border-white flex items-center justify-center text-xs font-bold text-slate-700 shadow-md">
                              +{group.memberIds.length - 5}
                            </div>
                          )}
                        </div>
                        {(!group.memberIds || group.memberIds.length === 0) && (
                          <span className="text-sm text-slate-400 italic">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡</span>
                        )}
                      </div> </div>
                    <div className="flex items-center gap-4 text-xs text-slate-400 mb-4">
                      <span className="flex items-center gap-1">
                        <Calendar className="w-3 h-3" />
                        {group.createdAt}
                      </span>
                      <span className="flex items-center gap-1">
                        <Building2 className="w-3 h-3" />
                        {group.entityScope === 'TENANT-001' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' : legalEntities.find(e => e.id === group.entityScope)?.name || group.entityScope}
                      </span> </div> </div>
                  <div className="bg-slate-50 px-5 py-3 border-t border-slate-200 flex items-center justify-between">
                    <button onClick={() => {
                      setSelectedGroup(group);
                      setGroupForm({ ...group });
                      setShowGroupModal(true);
                    }} className="flex items-center gap-1 text-sm text-slate-600 hover:text-purple-600 font-bold transition-all">
                      <Eye className="w-4 h-4" />Ø¹Ø±Ø¶
                    </button>
                    <div className="flex items-center gap-1">
                      <button onClick={() => {
                        setSelectedGroup(group);
                        setGroupForm({ ...group });
                        setShowGroupModal(true);
                      }} className="p-2 hover:bg-blue-100 rounded-lg transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                        <Edit className="w-4 h-4 text-blue-500" />
                      </button>
                      <button onClick={() => {
                        setUserGroups(prev => prev.map(g => g.id === group.id ? { ...g, status: g.status === 'Active' ? 'Inactive' : 'Active' } : g));
                        showNotification('info', group.status === 'Active' ? 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' : 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©');
                      }} className="p-2 hover:bg-amber-100 rounded-lg transition-all" title={group.status === 'Active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}>
                        {group.status === 'Active' ? <XCircle className="w-4 h-4 text-amber-500" /> : <CheckCircle2 className="w-4 h-4 text-emerald-500" />}
                      </button>
                      <button onClick={() => {
                        if (window.confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© "${group.name}"ØŸ`)) {
                          setUserGroups(prev => prev.filter(g => g.id !== group.id));
                          showNotification('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
                        }
                      }} className="p-2 hover:bg-red-100 rounded-lg transition-all" title="Ø­Ø°Ù">
                        <Trash2 className="w-4 h-4 text-red-500" />
                      </button> </div> </div> </div>
              ))}

              <div onClick={() => {
                setGroupForm({ code: '', name: '', nameEn: '', description: '', memberIds: [], entityScope: 'TENANT-001', status: 'Active' });
                setSelectedGroup(null);
                setShowGroupModal(true);
              }}
                className="bg-slate-50 rounded-2xl border-2 border-dashed border-slate-300 p-8 flex flex-col items-center justify-center min-h-[320px] cursor-pointer hover:border-purple-400 hover:bg-purple-50/50 transition-all group">
                <div className="w-16 h-16 rounded-full bg-slate-200 group-hover:bg-purple-200 flex items-center justify-center mb-4 transition-all">
                  <Plus className="w-8 h-8 text-slate-400 group-hover:text-purple-600" />
                </div>
                <p className="font-bold text-slate-500 group-hover:text-purple-600 text-lg">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                <p className="text-sm text-slate-400 mt-1">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø©</p>
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            GROUP MODAL - Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„/Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showGroupModal && (
          <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setShowGroupModal(false)}>
            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden" onClick={e => e.stopPropagation()}>
              <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-4 flex items-center justify-between">
                <h2 className="text-xl font-bold text-white flex items-center gap-3">
                  <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                    {selectedGroup ? <Edit className="w-5 h-5" /> : <Plus className="w-5 h-5" />}
                  </div>
                  {selectedGroup ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' : 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©'}
                </h2>
                <button onClick={() => setShowGroupModal(false)} className="text-white/80 hover:text-white p-1">
                  <X className="w-6 h-6" />
                </button> </div>
              <div className="p-6 overflow-y-auto flex-1 space-y-6">
                <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <Info className="w-5 h-5 text-purple-500" />
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                  </h3>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© *</label>
                      <input type="text" value={groupForm.code} onChange={(e) => setGroupForm({ ...groupForm, code: e.target.value.toUpperCase() })}
                        placeholder="Ù…Ø«Ø§Ù„: GRP-GRC" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all font-mono" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                      <select value={groupForm.status} onChange={(e) => setGroupForm({ ...groupForm, status: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500">
                        <option value="Active">Ù†Ø´Ø·</option>
                        <option value="Inactive">Ù…Ø¹Ø·Ù„</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø¹Ø±Ø¨ÙŠ) *</label>
                      <input type="text" value={groupForm.name} onChange={(e) => setGroupForm({ ...groupForm, name: e.target.value })}
                        placeholder="Ù…Ø«Ø§Ù„: ÙØ±ÙŠÙ‚ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                      <input type="text" value={groupForm.nameEn} onChange={(e) => setGroupForm({ ...groupForm, nameEn: e.target.value })}
                        placeholder="e.g. GRC Team" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" />
                    </div>
                    <div className="col-span-2">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙƒÙŠØ§Ù†</label>
                      <select value={groupForm.entityScope} onChange={(e) => setGroupForm({ ...groupForm, entityScope: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500">
                        <option value="TENANT-001">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Tenant)</option>
                        {legalEntities.map(e => <option key={e.id} value={e.id}>{e.name}</option>)}
                      </select>
                    </div>
                    <div className="col-span-2">
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
                      <textarea value={groupForm.description} onChange={(e) => setGroupForm({ ...groupForm, description: e.target.value })}
                        placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡Ø§..." rows={3}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all resize-none" />
                    </div> </div> </div>
                <div className="bg-slate-50 rounded-xl p-5 border border-slate-200">
                  <h3 className="font-bold text-slate-800 mb-4 flex items-center justify-between">
                    <span className="flex items-center gap-2">
                      <Users className="w-5 h-5 text-blue-500" />
                      Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ({groupForm.memberIds?.length || 0})
                    </span>
                  </h3>

                  <div className="mb-4">
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</label>
                    <div className="flex gap-2">
                      <select id="addMemberSelect" className="flex-1 px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500">
                        <option value="">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¥Ø¶Ø§ÙØªÙ‡...</option>
                        {users.filter(u => !groupForm.memberIds?.includes(u.id) && u.status === 'Active').map(u => (
                          <option key={u.id} value={u.id}>{u.name} - {u.jobTitle}</option>
                        ))}
                      </select>
                      <button onClick={() => {
                        const select = document.getElementById('addMemberSelect');
                        const userId = parseInt(select.value);
                        if (userId && !groupForm.memberIds?.includes(userId)) {
                          setGroupForm({ ...groupForm, memberIds: [...(groupForm.memberIds || []), userId] });
                          select.value = '';
                        }
                      }} className="px-5 py-3 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600 transition-all">
                        <Plus className="w-5 h-5" />
                      </button> </div> </div>
                  <div className="max-h-[200px] overflow-y-auto space-y-2">
                    {groupForm.memberIds?.length > 0 ? groupForm.memberIds.map(memberId => {
                      const member = users.find(u => u.id === memberId);
                      if (!member) return null;
                      return (
                        <div key={memberId} className="flex items-center justify-between p-3 bg-white rounded-xl border border-slate-200 hover:border-blue-300 transition-all">
                          <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                              {member.name.charAt(0)}
                            </div>
                            <div>
                              <p className="font-bold text-slate-800">{member.name}</p>
                              <p className="text-xs text-slate-500">{member.jobTitle} â€¢ {member.department}</p>
                            </div> </div>
                          <div className="flex items-center gap-2">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${member.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}`}>
                              {member.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                            </span>
                            <button onClick={() => {
                              setGroupForm({ ...groupForm, memberIds: groupForm.memberIds.filter(id => id !== memberId) });
                            }} className="p-1.5 hover:bg-red-100 rounded-lg transition-all" title="Ø¥Ø²Ø§Ù„Ø©">
                              <X className="w-4 h-4 text-red-500" />
                            </button> </div> </div>);
                    }) : (
                      <div className="text-center py-8 text-slate-400">
                        <Users className="w-12 h-12 mx-auto mb-2 opacity-30" />
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø¹Ø¯</p>
                        <p className="text-sm">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡</p>
                      </div>
                    )}
                  </div> </div> </div>
              <div className="bg-slate-100 px-6 py-4 flex items-center justify-between border-t border-slate-200">
                <div className="text-sm text-slate-500">
                  {selectedGroup && <span>Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: {selectedGroup.createdAt}</span>}
                </div>
                <div className="flex items-center gap-3">
                  <button onClick={() => setShowGroupModal(false)} className="px-6 py-2.5 text-slate-600 font-bold hover:bg-slate-200 rounded-xl transition-all">
                    Ø¥Ù„ØºØ§Ø¡
                  </button>
                  {selectedGroup && (
                    <button onClick={() => {
                      if (window.confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© "${selectedGroup.name}"ØŸ`)) {
                        setUserGroups(prev => prev.filter(g => g.id !== selectedGroup.id));
                        setShowGroupModal(false);
                        showNotification('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      }
                    }} className="px-6 py-2.5 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition-all flex items-center gap-2">
                      <Trash2 className="w-4 h-4" />Ø­Ø°Ù
                    </button>
                  )}
                  <button onClick={() => {
                    if (!groupForm.code || !groupForm.name) {
                      showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                      return;
                    }
                    if (selectedGroup) {
                      // Update
                      setUserGroups(prev => prev.map(g => g.id === selectedGroup.id ? { ...groupForm, id: selectedGroup.id } : g));
                      showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                      // Create
                      const newGroup = {
                        ...groupForm,
                        id: Math.max(...userGroups.map(g => g.id), 0) + 1,
                        createdAt: new Date().toISOString().split('T')[0],
                        createdBy: 3
                      };
                      setUserGroups(prev => [...prev, newGroup]);
                      showNotification('success', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    }
                    setShowGroupModal(false);
                  }} className="px-8 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-xl hover:shadow-lg transition-all flex items-center gap-2">
                    {selectedGroup ? <><Save className="w-4 h-4" />Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</> : <><Plus className="w-4 h-4" />Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</>}
                  </button> </div> </div> </div> </div>
        )}

        {activeTab === 'roles' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h2>
                <p className="text-slate-500">Roles & Permissions Library - Full CRUD Operations</p>
              </div>
              <div className="flex items-center gap-3">
                <button onClick={() => {
                  setSelectedRole(null);
                  setRoleForm({ code: '', name: '', nameEn: '', description: '', level: 3, templatePermissions: {}, selectedTemplate: null });
                  setRoleWizardStep(0);
                  setShowRoleModal(true);
                }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                  <Plus className="w-5 h-5" />
                  Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯
                </button> </div> </div>
            <div className="grid grid-cols-4 gap-4">
              {roles.map(role => {
                const permCount = Object.values(rolePermissions[role.code] || {}).reduce((sum, module) =>
                  sum + Object.values(module).filter(v => v).length, 0);
                const assignCount = roleAssignments.filter(ra => ra.roleId === role.id && ra.status === 'Active').length;

                return (
                  <div key={role.id} className={`bg-white rounded-2xl border-2 p-5 transition-all hover:shadow-lg ${selectedRole?.id === role.id ? 'border-purple-500 ring-4 ring-purple-100' :
                    role.level === 0 ? 'border-red-200 hover:border-red-400' :
                      role.level === 1 ? 'border-amber-200 hover:border-amber-400' : 'border-slate-200 hover:border-purple-300'
                    }`}>
                    <div className="flex items-center justify-between mb-4">
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${role.level === 0 ? 'bg-red-100' : role.level === 1 ? 'bg-amber-100' : 'bg-purple-100'
                        }`}>
                        <Shield className={`w-6 h-6 ${role.level === 0 ? 'text-red-600' : role.level === 1 ? 'text-amber-600' : 'text-purple-600'
                          }`} />
                      </div>
                      <span className={`px-3 py-1.5 rounded-xl text-sm font-black ${role.level === 0 ? 'bg-red-500 text-white' :
                        role.level === 1 ? 'bg-amber-500 text-white' :
                          role.level === 2 ? 'bg-blue-500 text-white' :
                            role.level === 3 ? 'bg-slate-500 text-white' : 'bg-slate-300 text-slate-700'
                        }`}>L{role.level}</span>
                    </div>

                    <h3 className="font-black text-slate-800 text-lg">{role.name}</h3>
                    <p className="text-sm text-slate-500">{role.nameEn}</p>
                    <p className="text-xs text-slate-400 mt-1 font-mono">{role.code}</p>

                    <div className="flex items-center gap-4 mt-4 pt-4 border-t border-slate-100">
                      <div className="flex items-center gap-1 text-xs text-slate-500">
                        <CheckSquare className="w-4 h-4 text-emerald-500" />
                        <span className="font-bold">{permCount}</span> ØµÙ„Ø§Ø­ÙŠØ©
                      </div>
                      <div className="flex items-center gap-1 text-xs text-slate-500">
                        <Users className="w-4 h-4 text-blue-500" />
                        <span className="font-bold">{assignCount}</span> Ù…Ø³ØªØ®Ø¯Ù…
                      </div> </div>
                    <div className="grid grid-cols-3 gap-2 mt-4">
                      <button onClick={() => setSelectedRole(selectedRole?.id === role.id ? null : role)}
                        className={`py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 ${selectedRole?.id === role.id
                          ? 'bg-blue-500 text-white'
                          : 'bg-blue-50 text-blue-600 hover:bg-blue-100'
                          }`}>
                        <Eye className="w-4 h-4" />
                        Ø¹Ø±Ø¶
                      </button>

                      <button onClick={() => {
                        setSelectedRole(role);
                        setRoleForm({
                          code: role.code, name: role.name, nameEn: role.nameEn, description: role.description || '', level: role.level,
                          templatePermissions: rolePermissions[role.code] || {},
                          selectedTemplate: null
                        });
                        setRoleWizardStep(0);
                        setShowRoleModal(true);
                      }} className="py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 bg-amber-50 text-amber-600 hover:bg-amber-100">
                        <Edit className="w-4 h-4" />
                        ØªØ¹Ø¯ÙŠÙ„
                      </button>

                      <button onClick={() => {
                        if (role.code === 'ADMIN' || role.code === 'CCO') {
                          showNotification('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± - Ø¯ÙˆØ± Ù…Ø­Ù…ÙŠ', 'error');
                          return;
                        }
                        if (assignCount > 0) {
                          showNotification(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ± - ÙŠÙˆØ¬Ø¯ ${assignCount} ØªØ¹ÙŠÙŠÙ† Ù†Ø´Ø·`, 'error');
                          return;
                        }
                        if (window.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ± "${role.name}"ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                          setRoles(prev => prev.filter(r => r.id !== role.id));
                          logAction('DELETE_ROLE', 'IAM', 'ROLE', role.id, { name: role.name });
                          showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
                        }
                      }} className={`py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 ${role.code === 'ADMIN' || role.code === 'CCO' || assignCount > 0
                        ? 'bg-slate-100 text-slate-400 cursor-not-allowed'
                        : 'bg-red-50 text-red-600 hover:bg-red-100'
                        }`}
                        disabled={role.code === 'ADMIN' || role.code === 'CCO'}>
                        <Trash2 className="w-4 h-4" />
                        Ø­Ø°Ù
                      </button> </div> </div>);
              })}
            </div>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-4 flex items-center justify-between">
                <h2 className="text-lg font-black text-white flex items-center gap-2">
                  <Table className="w-5 h-5 text-purple-400" />
                  Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
                </h2>
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-2 bg-white/10 rounded-xl p-1">
                    <span className="text-xs text-white/60 px-2">Ù‚ÙˆØ§Ù„Ø¨ Ø³Ø±ÙŠØ¹Ø©:</span>
                    {selectedRole && (
                      <>
                        <button onClick={() => {
                          const newPerms = {};
                          MODULES.forEach(m => { newPerms[m] = { VIEW: true }; });
                          setRolePermissions(prev => ({ ...prev, [selectedRole.code]: newPerms }));
                          logAction('UPDATE_PERMISSIONS', 'IAM', 'ROLE', selectedRole.id, { bundle: 'viewOnly' });
                          showNotification('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·');
                        }} className="px-3 py-1 bg-slate-600 text-white rounded-lg text-xs hover:bg-slate-500">
                          Ø¹Ø±Ø¶ ÙÙ‚Ø·
                        </button>
                        <button onClick={() => {
                          const newPerms = {};
                          MODULES.forEach(m => { newPerms[m] = { VIEW: true, CREATE: true, EDIT: true }; });
                          setRolePermissions(prev => ({ ...prev, [selectedRole.code]: newPerms }));
                          logAction('UPDATE_PERMISSIONS', 'IAM', 'ROLE', selectedRole.id, { bundle: 'basic' });
                          showNotification('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ');
                        }} className="px-3 py-1 bg-blue-600 text-white rounded-lg text-xs hover:bg-blue-500">
                          Ø£Ø³Ø§Ø³ÙŠ
                        </button>
                        <button onClick={() => {
                          const newPerms = {};
                          MODULES.forEach(m => {
                            newPerms[m] = {};
                            ACTIONS.forEach(a => { newPerms[m][a] = true; });
                          });
                          setRolePermissions(prev => ({ ...prev, [selectedRole.code]: newPerms }));
                          logAction('UPDATE_PERMISSIONS', 'IAM', 'ROLE', selectedRole.id, { bundle: 'full' });
                          showNotification('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
                        }} className="px-3 py-1 bg-emerald-600 text-white rounded-lg text-xs hover:bg-emerald-500">
                          ÙƒØ§Ù…Ù„
                        </button>
                        <button onClick={() => {
                          setRolePermissions(prev => ({ ...prev, [selectedRole.code]: {} }));
                          logAction('UPDATE_PERMISSIONS', 'IAM', 'ROLE', selectedRole.id, { bundle: 'clear' });
                          showNotification('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
                        }} className="px-3 py-1 bg-red-600 text-white rounded-lg text-xs hover:bg-red-500">
                          Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                        </button>
                      </>
                    )}
                  </div> </div> </div>
              {selectedRole && (
                <div className="bg-purple-50 border-b-2 border-purple-200 px-6 py-3 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <Shield className="w-5 h-5 text-purple-600" />
                    <span className="font-bold text-purple-800">ØªØ­Ø±ÙŠØ± ØµÙ„Ø§Ø­ÙŠØ§Øª: {selectedRole.name}</span>
                    <span className="text-sm text-purple-600">({selectedRole.code})</span>
                  </div>
                  <div className="flex items-center gap-4 text-sm">
                    <span className="text-purple-600">
                      Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª: <strong>{Object.values(rolePermissions[selectedRole.code] || {}).reduce((sum, module) =>
                        sum + Object.values(module).filter(v => v).length, 0)}</strong>
                    </span>
                    <button onClick={() => {
                      logAction('SAVE_PERMISSIONS', 'IAM', 'ROLE', selectedRole.id, { permissions: rolePermissions[selectedRole.code] });
                      showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    }} className="px-4 py-1 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700">
                      <Save className="w-4 h-4 inline ml-1" />
                      Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                    </button> </div> </div>
              )}

              <div className="overflow-x-auto max-h-[500px] overflow-y-auto">
                <table className="w-full">
                  <thead className="bg-slate-50 sticky top-0 z-10">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600 sticky right-0 bg-slate-50 min-w-[150px] z-20 shadow-sm">
                        Ø§Ù„ÙˆØ­Ø¯Ø© / Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
                      </th>
                      {roles.map(role => (
                        <th key={role.id} className={`px-2 py-3 text-center text-xs font-bold min-w-[90px] cursor-pointer transition-all ${selectedRole?.id === role.id ? 'bg-purple-100 text-purple-800' : 'text-slate-600 hover:bg-slate-100'
                          }`} onClick={() => setSelectedRole(selectedRole?.id === role.id ? null : role)}>
                          <div className="flex flex-col items-center gap-1">
                            <span className={`px-1.5 py-0.5 rounded text-[10px] font-black ${role.level === 0 ? 'bg-red-500 text-white' :
                              role.level === 1 ? 'bg-amber-500 text-white' : 'bg-slate-200'
                              }`}>L{role.level}</span>
                            <span>{role.name.split(' ')[0]}</span>
                          </div>
                        </th>
                      ))}
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {MODULES.map(module => (
                      <React.Fragment key={module}>
                        <tr className="bg-slate-100 sticky top-[52px] z-[5]">
                          <td colSpan={roles.length + 1} className="px-4 py-2 font-bold text-slate-700 text-sm">
                            {MODULE_LABELS[module]}
                          </td> </tr>
                        {ACTIONS.map(action => (
                          <tr key={`${module}-${action}`} className="hover:bg-purple-50/50 transition-colors">
                            <td className="px-4 py-2 text-sm text-slate-600 pr-8 sticky right-0 bg-white z-[1] shadow-sm">
                              {ACTION_LABELS[action]}
                            </td>
                            {roles.map(role => (
                              <td key={role.id} className={`px-2 py-2 text-center ${selectedRole?.id === role.id ? 'bg-purple-50' : ''
                                }`}>
                                <button
                                  onClick={() => {
                                    togglePermission(role.code, module, action);
                                    logAction('TOGGLE_PERMISSION', 'IAM', 'PERMISSION', `${role.code}-${module}-${action}`, {
                                      role: role.name,
                                      module,
                                      action,
                                      newValue: !rolePermissions[role.code]?.[module]?.[action]
                                    });
                                  }}
                                  className={`w-8 h-8 rounded-lg flex items-center justify-center transition-all transform hover:scale-110 ${rolePermissions[role.code]?.[module]?.[action]
                                    ? 'bg-emerald-500 text-white shadow-md hover:bg-emerald-600'
                                    : 'bg-slate-200 text-slate-400 hover:bg-slate-300'
                                    } ${selectedRole?.id === role.id ? 'ring-2 ring-purple-300' : ''}`}>
                                  {rolePermissions[role.code]?.[module]?.[action] ? (
                                    <Check className="w-5 h-5" />
                                  ) : (
                                    <X className="w-4 h-4" />
                                  )}
                                </button> </td>
                            ))}
                          </tr>
                        ))}
                      </React.Fragment>
                    ))}
                  </tbody> </table> </div>
              <div className="bg-slate-50 border-t-2 border-slate-200 px-6 py-3 flex items-center justify-between">
                <div className="flex items-center gap-6 text-xs text-slate-500">
                  <span className="flex items-center gap-2">
                    <span className="w-6 h-6 bg-emerald-500 rounded-lg flex items-center justify-center">
                      <Check className="w-4 h-4 text-white" />
                    </span>
                    Ù…Ø³Ù…ÙˆØ­
                  </span>
                  <span className="flex items-center gap-2">
                    <span className="w-6 h-6 bg-slate-200 rounded-lg flex items-center justify-center">
                      <X className="w-3 h-3 text-slate-400" />
                    </span>
                    ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­
                  </span> </div>
                <p className="text-xs text-slate-500">
                  ğŸ’¡ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¯ÙˆØ± Ù„ØªØ­Ø±ÙŠØ±Ù‡ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                </p> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            BANK-GRADE ROLE WIZARD - World-Class Permission Builder
            Features: 3-Step Flow, Interactive Matrix, Quick Bundles, SoD Preview
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showRoleModal && (
          <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl overflow-hidden max-h-[95vh] flex flex-col">

              <div className="bg-gradient-to-l from-purple-600 via-indigo-600 to-blue-700 px-8 py-6 text-white shrink-0">
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                      <Shield className="w-7 h-7" />
                    </div>
                    <div>
                      <h2 className="text-2xl font-black">{selectedRole ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ± ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡' : 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯'}</h2>
                      <p className="text-purple-200">{selectedRole ? 'Edit Role & Permissions' : 'Bank-Grade Role Builder Wizard'}</p>
                    </div> </div>
                  <button onClick={() => { setShowRoleModal(false); setSelectedRole(null); setRoleWizardStep(0); }}
                    className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                    <X className="w-6 h-6" />
                  </button> </div>
                <div className="flex items-center gap-4">
                  {[
                    { step: 0, label: 'Ù‡ÙˆÙŠØ© Ø§Ù„Ø¯ÙˆØ±', labelEn: 'Role Identity', icon: User },
                    { step: 1, label: 'Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', labelEn: 'Permission Matrix', icon: Table },
                    { step: 2, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø¥Ù†Ø´Ø§Ø¡', labelEn: 'Review & Create', icon: CheckCircle2 }
                  ].map((s, idx) => (
                    <React.Fragment key={s.step}>
                      <button onClick={() => { if (roleWizardStep > s.step) setRoleWizardStep(s.step); }}
                        className={`flex items-center gap-3 px-5 py-3 rounded-xl font-bold transition-all ${roleWizardStep === s.step ? 'bg-white text-purple-700 shadow-lg scale-105' :
                          roleWizardStep > s.step ? 'bg-emerald-400/30 text-white' : 'bg-white/10 text-white/70'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${roleWizardStep === s.step ? 'bg-purple-100' : roleWizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {roleWizardStep > s.step ? <Check className="w-5 h-5 text-white" /> : <s.icon className="w-5 h-5" />}
                        </div>
                        <div className="text-right">
                          <p className="text-sm font-bold">{s.label}</p>
                          <p className="text-xs opacity-70">{s.labelEn}</p>
                        </div> </button>
                      {idx < 2 && <ChevronLeft className="w-5 h-5 text-white/40" />}
                    </React.Fragment>
                  ))}
                </div> </div>
              <div className="flex-1 overflow-y-auto p-8">

                {roleWizardStep === 0 && (
                  <div className="max-w-2xl mx-auto space-y-6">
                    <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl p-5 border border-purple-200">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-xl bg-purple-500 flex items-center justify-center">
                          <Shield className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className="font-bold text-purple-900">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù‡ÙˆÙŠØ© Ø§Ù„Ø¯ÙˆØ± ÙˆØªØµÙ†ÙŠÙÙ‡</h3>
                          <p className="text-sm text-purple-600">Role Identity & Classification</p>
                        </div> </div> </div>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆØ± (Code) *
                        </label>
                        <input type="text" value={roleForm.code}
                          onChange={(e) => setRoleForm({ ...roleForm, code: e.target.value.toUpperCase().replace(/[^A-Z0-9_]/g, '') })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl font-mono text-lg focus:border-purple-500"
                          placeholder="COMPLIANCE_OFFICER" disabled={!!selectedRole} dir="ltr" />
                        <p className="text-xs text-slate-500 mt-1">A-Z, 0-9, _ ÙÙ‚Ø· - ÙØ±ÙŠØ¯ ÙˆØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØºÙŠÙŠØ±</p>
                      </div>
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© *
                        </label>
                        <div className="grid grid-cols-5 gap-2">
                          {[
                            { level: 0, label: 'L0', desc: 'Admin', color: 'red' },
                            { level: 1, label: 'L1', desc: 'Executive', color: 'amber' },
                            { level: 2, label: 'L2', desc: 'Manager', color: 'blue' },
                            { level: 3, label: 'L3', desc: 'Officer', color: 'slate' },
                            { level: 4, label: 'L4', desc: 'Viewer', color: 'slate' }
                          ].map(l => (
                            <button key={l.level}
                              onClick={() => setRoleForm({ ...roleForm, level: l.level })}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${roleForm.level === l.level
                                ? `border-${l.color}-500 bg-${l.color}-50`
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <p className={`font-black text-lg ${roleForm.level === l.level ? `text-${l.color}-600` : 'text-slate-600'}`}>{l.label}</p>
                              <p className="text-xs text-slate-500">{l.desc}</p>
                            </button>
                          ))}
                        </div> </div> </div>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ *
                        </label>
                        <input type="text" value={roleForm.name}
                          onChange={(e) => setRoleForm({ ...roleForm, name: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                          placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„" dir="rtl" />
                      </div>
                      <div>
                        <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</label>
                        <input type="text" value={roleForm.nameEn}
                          onChange={(e) => setRoleForm({ ...roleForm, nameEn: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                          placeholder="e.g. Compliance Officer" dir="ltr" />
                      </div> </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">ÙˆØµÙ Ø§Ù„Ø¯ÙˆØ± ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ§ØªÙ‡</label>
                      <textarea value={roleForm.description}
                        onChange={(e) => setRoleForm({ ...roleForm, description: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-28 resize-none focus:border-purple-500"
                        placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± ÙˆØ­Ø¯ÙˆØ¯ Ø¹Ù…Ù„Ù‡..." />
                    </div>

                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-3 block">Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                      <div className="grid grid-cols-4 gap-3">
                        {[
                          { id: 'viewer', label: 'Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·', icon: Eye, color: 'slate', perms: ['VIEW'] },
                          { id: 'basic', label: 'Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø³Ø§Ø³ÙŠ', icon: User, color: 'blue', perms: ['VIEW', 'CREATE', 'EDIT'] },
                          { id: 'manager', label: 'Ù…Ø¯ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„', icon: Briefcase, color: 'purple', perms: ['VIEW', 'CREATE', 'EDIT', 'SUBMIT', 'APPROVE'] },
                          { id: 'admin', label: 'Ù…Ø¯ÙŠØ± ÙƒØ§Ù…Ù„', icon: Shield, color: 'red', perms: ['VIEW', 'CREATE', 'EDIT', 'SUBMIT', 'APPROVE', 'ACTIVATE', 'RETIRE', 'EXPORT', 'ADMIN'] }
                        ].map(template => (
                          <button key={template.id}
                            onClick={() => {
                              const newPerms = {};
                              MODULES.forEach(m => {
                                newPerms[m] = {};
                                template.perms.forEach(p => { newPerms[m][p] = true; });
                              });
                              setRoleForm({ ...roleForm, templatePermissions: newPerms, selectedTemplate: template.id });
                            }}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${roleForm.selectedTemplate === template.id
                              ? `border-${template.color}-500 bg-${template.color}-50`
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <template.icon className={`w-8 h-8 mx-auto mb-2 ${roleForm.selectedTemplate === template.id ? `text-${template.color}-600` : 'text-slate-400'
                              }`} />
                            <p className="font-bold text-slate-800 text-sm">{template.label}</p>
                            <p className="text-xs text-slate-500 mt-1">{template.perms.length} ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
                          </button>
                        ))}
                      </div> </div> </div>
                )}

                {roleWizardStep === 1 && (
                  <div className="space-y-6">
                    <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-5 border border-blue-200">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center">
                            <Table className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <h3 className="font-bold text-blue-900">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¨Ù†Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
                            <p className="text-sm text-blue-600">Interactive Permission Matrix Builder</p>
                          </div> </div>
                        <div className="flex items-center gap-2">
                          <button onClick={() => {
                            const newPerms = {};
                            MODULES.forEach(m => { newPerms[m] = { VIEW: true }; });
                            setRoleForm({ ...roleForm, templatePermissions: newPerms });
                          }} className="px-4 py-2 bg-slate-600 text-white rounded-lg text-sm font-bold hover:bg-slate-500">
                            Ø¹Ø±Ø¶ ÙÙ‚Ø·
                          </button>
                          <button onClick={() => {
                            const newPerms = {};
                            MODULES.forEach(m => { newPerms[m] = { VIEW: true, CREATE: true, EDIT: true }; });
                            setRoleForm({ ...roleForm, templatePermissions: newPerms });
                          }} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-500">
                            Ø£Ø³Ø§Ø³ÙŠ
                          </button>
                          <button onClick={() => {
                            const newPerms = {};
                            MODULES.forEach(m => {
                              newPerms[m] = {};
                              ACTIONS.forEach(a => { newPerms[m][a] = true; });
                            });
                            setRoleForm({ ...roleForm, templatePermissions: newPerms });
                          }} className="px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-bold hover:bg-emerald-500">
                            ÙƒØ§Ù…Ù„
                          </button>
                          <button onClick={() => setRoleForm({ ...roleForm, templatePermissions: {} })}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-500">
                            Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                          </button> </div> </div> </div>
                    <div className="bg-slate-800 rounded-xl p-4 flex items-center justify-between">
                      <div className="flex items-center gap-6">
                        <div className="flex items-center gap-2">
                          <Shield className="w-5 h-5 text-purple-400" />
                          <span className="text-white font-bold">{roleForm.name || 'Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯'}</span>
                          <span className="text-slate-400">({roleForm.code || 'CODE'})</span>
                        </div>
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${roleForm.level === 0 ? 'bg-red-500 text-white' :
                          roleForm.level === 1 ? 'bg-amber-500 text-white' :
                            roleForm.level === 2 ? 'bg-blue-500 text-white' : 'bg-slate-500 text-white'
                          }`}>L{roleForm.level}</span>
                      </div>
                      <div className="flex items-center gap-4 text-sm">
                        <span className="text-emerald-400">
                          <CheckSquare className="w-4 h-4 inline ml-1" />
                          {Object.values(roleForm.templatePermissions || {}).reduce((sum, module) =>
                            sum + Object.values(module).filter(v => v).length, 0)} ØµÙ„Ø§Ø­ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø©
                        </span>
                        <span className="text-slate-400">Ù…Ù† {MODULES.length * ACTIONS.length} Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                      </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="overflow-x-auto max-h-[400px] overflow-y-auto">
                        <table className="w-full">
                          <thead className="bg-slate-100 sticky top-0 z-10">
                            <tr>
                              <th className="px-4 py-3 text-right text-sm font-bold text-slate-700 sticky right-0 bg-slate-100 min-w-[180px] z-20 border-l-2 border-slate-200">
                                Ø§Ù„ÙˆØ­Ø¯Ø© / Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
                              </th>
                              {ACTIONS.map(action => (
                                <th key={action} className="px-3 py-3 text-center text-xs font-bold text-slate-600 min-w-[80px]">
                                  <button onClick={() => {
                                    const newPerms = { ...(roleForm.templatePermissions || {}) };
                                    const allEnabled = MODULES.every(m => newPerms[m]?.[action]);
                                    MODULES.forEach(m => {
                                      if (!newPerms[m]) newPerms[m] = {};
                                      newPerms[m][action] = !allEnabled;
                                    });
                                    setRoleForm({ ...roleForm, templatePermissions: newPerms });
                                  }} className="hover:bg-slate-200 rounded-lg px-2 py-1 transition-all">
                                    {ACTION_LABELS[action]}
                                  </button>
                                </th>
                              ))}
                              <th className="px-3 py-3 text-center text-xs font-bold text-slate-500 min-w-[60px]">Ø§Ù„ÙƒÙ„</th>
                            </tr> </thead>
                          <tbody className="divide-y divide-slate-100">
                            {MODULES.map(module => {
                              const modulePerms = roleForm.templatePermissions?.[module] || {};
                              const enabledCount = Object.values(modulePerms).filter(v => v).length;
                              const allEnabled = enabledCount === ACTIONS.length;

                              return (
                                <tr key={module} className="hover:bg-purple-50/50 transition-colors">
                                  <td className="px-4 py-3 sticky right-0 bg-white z-[1] border-l-2 border-slate-100">
                                    <div className="flex items-center justify-between">
                                      <span className="font-bold text-slate-800">{MODULE_LABELS[module]}</span>
                                      <span className="text-xs text-slate-400">{enabledCount}/{ACTIONS.length}</span>
                                    </div> </td>
                                  {ACTIONS.map(action => (
                                    <td key={action} className="px-3 py-3 text-center">
                                      <button onClick={() => {
                                        const newPerms = { ...(roleForm.templatePermissions || {}) };
                                        if (!newPerms[module]) newPerms[module] = {};
                                        newPerms[module][action] = !newPerms[module][action];
                                        setRoleForm({ ...roleForm, templatePermissions: newPerms });
                                      }} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all transform hover:scale-110 ${modulePerms[action]
                                        ? 'bg-emerald-500 text-white shadow-md hover:bg-emerald-600'
                                        : 'bg-slate-200 text-slate-400 hover:bg-slate-300'
                                        }`}>
                                        {modulePerms[action] ? (
                                          <Check className="w-5 h-5" />
                                        ) : (
                                          <X className="w-4 h-4" />
                                        )}
                                      </button> </td>
                                  ))}
                                  <td className="px-3 py-3 text-center">
                                    <button onClick={() => {
                                      const newPerms = { ...(roleForm.templatePermissions || {}) };
                                      if (!newPerms[module]) newPerms[module] = {};
                                      ACTIONS.forEach(a => { newPerms[module][a] = !allEnabled; });
                                      setRoleForm({ ...roleForm, templatePermissions: newPerms });
                                    }} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${allEnabled
                                      ? 'bg-purple-500 text-white hover:bg-purple-600'
                                      : 'bg-slate-100 text-slate-400 hover:bg-slate-200'
                                      }`}>
                                      {allEnabled ? <CheckSquare className="w-5 h-5" /> : <Square className="w-5 h-5" />}
                                    </button> </td> </tr>);
                            })}
                          </tbody> </table> </div>
                      <div className="bg-slate-50 border-t-2 border-slate-200 px-6 py-3 flex items-center justify-between">
                        <div className="flex items-center gap-6 text-xs text-slate-500">
                          <span className="flex items-center gap-2">
                            <span className="w-6 h-6 bg-emerald-500 rounded-lg flex items-center justify-center">
                              <Check className="w-4 h-4 text-white" />
                            </span>
                            Ù…Ø³Ù…ÙˆØ­
                          </span>
                          <span className="flex items-center gap-2">
                            <span className="w-6 h-6 bg-slate-200 rounded-lg flex items-center justify-center">
                              <X className="w-3 h-3 text-slate-400" />
                            </span>
                            ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­
                          </span>
                          <span className="flex items-center gap-2">
                            <span className="w-6 h-6 bg-purple-500 rounded-lg flex items-center justify-center">
                              <CheckSquare className="w-4 h-4 text-white" />
                            </span>
                            ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                          </span> </div>
                        <p className="text-xs text-slate-500">
                          ğŸ’¡ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ù„ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡
                        </p> </div> </div> </div>
                )}

                {roleWizardStep === 2 && (
                  <div className="max-w-3xl mx-auto space-y-6">
                    <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-5 border border-emerald-200">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center">
                          <CheckCircle2 className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className="font-bold text-emerald-900">Ø§Ù„Ø®Ø·ÙˆØ© 3: Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±</h3>
                          <p className="text-sm text-emerald-600">Review & Confirm Role Creation</p>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4">
                        <div className="flex items-center gap-4">
                          <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center">
                            <Shield className="w-8 h-8 text-white" />
                          </div>
                          <div className="flex-1">
                            <h3 className="text-2xl font-black text-white">{roleForm.name || 'Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±'}</h3>
                            <p className="text-purple-200">{roleForm.nameEn || 'Role Name'}</p>
                          </div>
                          <div className="text-right">
                            <span className={`px-4 py-2 rounded-xl text-lg font-black ${roleForm.level === 0 ? 'bg-red-500 text-white' :
                              roleForm.level === 1 ? 'bg-amber-500 text-white' :
                                roleForm.level === 2 ? 'bg-blue-500 text-white' : 'bg-slate-500 text-white'
                              }`}>L{roleForm.level}</span>
                            <p className="text-purple-200 text-sm mt-1">{roleForm.code}</p>
                          </div> </div> </div>
                      <div className="p-6 space-y-6">
                        {roleForm.description && (
                          <div>
                            <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</h4>
                            <p className="text-slate-600 bg-slate-50 rounded-xl p-4">{roleForm.description}</p>
                          </div>
                        )}

                        <div>
                          <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                            <CheckSquare className="w-5 h-5 text-emerald-500" />
                            Ù…Ù„Ø®Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ({Object.values(roleForm.templatePermissions || {}).reduce((sum, module) =>
                              sum + Object.values(module).filter(v => v).length, 0)} ØµÙ„Ø§Ø­ÙŠØ©)
                          </h4>
                          <div className="grid grid-cols-2 gap-4">
                            {MODULES.map(module => {
                              const modulePerms = roleForm.templatePermissions?.[module] || {};
                              const enabledActions = Object.entries(modulePerms).filter(([_, v]) => v).map(([k]) => k);

                              if (enabledActions.length === 0) return null;

                              return (
                                <div key={module} className="bg-slate-50 rounded-xl p-4">
                                  <h5 className="font-bold text-slate-800 mb-2">{MODULE_LABELS[module]}</h5>
                                  <div className="flex flex-wrap gap-1">
                                    {enabledActions.map(action => (
                                      <span key={action} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">
                                        {ACTION_LABELS[action]}
                                      </span>
                                    ))}
                                  </div> </div>);
                            })}
                          </div> </div>
                        {(() => {
                          const perms = roleForm.templatePermissions || {};
                          const conflicts = [];
                          if (perms.EVIDENCE?.CREATE && perms.EVIDENCE?.APPROVE) {
                            conflicts.push({ severity: 'Critical', message: 'ØªØ¹Ø§Ø±Ø¶: Ø±ÙØ¹ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø©' });
                          }
                          if (perms.BREACHES?.CREATE && perms.BREACHES?.APPROVE) {
                            conflicts.push({ severity: 'Critical', message: 'ØªØ¹Ø§Ø±Ø¶: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª' });
                          }
                          if (perms.INSPECTIONS?.CREATE && perms.INSPECTIONS?.EXPORT) {
                            conflicts.push({ severity: 'Critical', message: 'ØªØ¹Ø§Ø±Ø¶: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØµØ¯ÙŠØ± Ø­Ø²Ù… Ø§Ù„ØªÙØªÙŠØ´' });
                          }

                          if (conflicts.length > 0) {
                            return (
                              <div className="bg-red-50 rounded-xl p-4 border-2 border-red-200">
                                <div className="flex items-center gap-2 mb-3">
                                  <AlertTriangle className="w-5 h-5 text-red-500" />
                                  <h4 className="font-bold text-red-700">ØªØ­Ø°ÙŠØ±Ø§Øª ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (SoD)</h4>
                                </div>
                                <div className="space-y-2">
                                  {conflicts.map((c, idx) => (
                                    <div key={idx} className="flex items-center gap-2 text-red-600">
                                      <XCircle className="w-4 h-4" />
                                      <span className="text-sm font-bold">{c.message}</span>
                                    </div>
                                  ))}
                                </div>
                                <p className="text-xs text-red-500 mt-3">
                                  âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚Ø¯ ØªØ®Ù„Ù‚ ØªØ¹Ø§Ø±Ø¶Ø§Øª - Ø±Ø§Ø¬Ø¹ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                                </p> </div>);
                          }
                          return (
                            <div className="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200">
                              <div className="flex items-center gap-2">
                                <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                                <span className="font-bold text-emerald-700">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶Ø§Øª ÙÙŠ ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… âœ“</span>
                              </div> </div>);
                        })()}
                      </div> </div> </div>
                )}
              </div>

              <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between shrink-0">
                <div className="flex items-center gap-3">
                  {roleWizardStep > 0 && (
                    <button onClick={() => setRoleWizardStep(roleWizardStep - 1)}
                      className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                      <ChevronRight className="w-5 h-5" />
                      Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                  )}
                  <button onClick={() => { setShowRoleModal(false); setSelectedRole(null); setRoleWizardStep(0); }}
                    className="px-6 py-3 text-slate-500 font-bold hover:text-slate-700">
                    Ø¥Ù„ØºØ§Ø¡
                  </button> </div>
                <div className="flex items-center gap-2">
                  {[0, 1, 2].map(step => (
                    <div key={step} className={`w-2.5 h-2.5 rounded-full transition-all ${roleWizardStep === step ? 'bg-purple-500 w-6' : roleWizardStep > step ? 'bg-emerald-500' : 'bg-slate-300'
                      }`} />
                  ))}
                </div>

                <div className="flex items-center gap-3">
                  {roleWizardStep < 2 ? (
                    <button onClick={() => {
                      if (roleWizardStep === 0 && (!roleForm.code || !roleForm.name)) {
                        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² ÙˆØ§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±', 'error');
                        return;
                      }
                      setRoleWizardStep(roleWizardStep + 1);
                    }}
                      className="flex items-center gap-2 px-8 py-3 bg-purple-500 text-white rounded-xl font-bold hover:bg-purple-600">
                      Ø§Ù„ØªØ§Ù„ÙŠ
                      <ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <button onClick={() => {
                      if (selectedRole) {
                        // Update existing role
                        setRoles(prev => prev.map(r => r.id === selectedRole.id ? { ...r, ...roleForm } : r));
                        if (roleForm.templatePermissions) {
                          setRolePermissions(prev => ({ ...prev, [roleForm.code]: roleForm.templatePermissions }));
                        }
                        logAction('UPDATE_ROLE', 'IAM', 'ROLE', selectedRole.id, { name: roleForm.name, permissions: roleForm.templatePermissions });
                        showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                      } else {
                        // Create new role
                        const newRole = {
                          id: Date.now(), code: roleForm.code, name: roleForm.name, nameEn: roleForm.nameEn, description: roleForm.description,
                          level: roleForm.level,
                          createdAt: new Date().toISOString()
                        };
                        setRoles(prev => [...prev, newRole]);
                        setRolePermissions(prev => ({ ...prev, [newRole.code]: roleForm.templatePermissions || {} }));
                        logAction('CREATE_ROLE', 'IAM', 'ROLE', newRole.id, { name: newRole.name, permissions: roleForm.templatePermissions });
                        showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ± ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                      }
                      setShowRoleModal(false);
                      setSelectedRole(null);
                      setRoleWizardStep(0);
                      setRoleForm({ code: '', name: '', nameEn: '', description: '', level: 3, templatePermissions: {} });
                    }} className="flex items-center gap-2 px-8 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                      <CheckCircle2 className="w-5 h-5" />
                      {selectedRole ? 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±'}
                    </button>
                  )}
                </div> </div> </div> </div>
        )}

        {activeTab === 'assignments' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚</h2>
                <p className="text-slate-500">Scoped Role Assignments - Full CRUD Operations</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-3 bg-slate-100 rounded-xl px-4 py-2">
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-emerald-600">{roleAssignments.filter(ra => ra.status === 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ù†Ø´Ø·</p>
                  </div>
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-red-600">{roleAssignments.filter(ra => ra.status !== 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ù…Ø¹Ø·Ù„</p>
                  </div>
                  <div className="text-center px-3">
                    <p className="text-2xl font-black text-slate-700">{roleAssignments.length}</p>
                    <p className="text-xs text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                  </div> </div>
                <button onClick={() => {
                  setEditingAssignment(null);
                  setAssignmentForm({ userId: '', roleId: '', scopeType: 'ENTITY', scopeId: '', validFrom: new Date().toISOString().split('T')[0], validTo: '', status: 'Active' });
                  setShowAssignmentModal(true);
                }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                  <Plus className="w-5 h-5" />
                  ØªØ¹ÙŠÙŠÙ† Ø¬Ø¯ÙŠØ¯
                </button> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
              <div className="flex items-center gap-4 flex-wrap">
                <div className="flex items-center gap-2">
                  <Filter className="w-5 h-5 text-slate-400" />
                  <span className="font-bold text-slate-600">ÙÙ„ØªØ±Ø©:</span>
                </div>
                <select value={assignmentFilterUser || 'all'}
                  onChange={(e) => setAssignmentFilterUser(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                  {users.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                </select>
                <select value={assignmentFilterRole || 'all'}
                  onChange={(e) => setAssignmentFilterRole(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</option>
                  {roles.map(r => <option key={r.id} value={r.id}>{r.name}</option>)}
                </select>
                <select value={assignmentFilterScope || 'all'}
                  onChange={(e) => setAssignmentFilterScope(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª</option>
                  <option value="TENANT">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                  <option value="ENTITY">Ø§Ù„ÙƒÙŠØ§Ù†</option>
                  <option value="BU">ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
                  <option value="SITE">Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
                </select>
                <select value={assignmentFilterStatus || 'all'}
                  onChange={(e) => setAssignmentFilterStatus(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="Active">Ù†Ø´Ø·</option>
                  <option value="Inactive">Ù…Ø¹Ø·Ù„</option>
                </select>
                {(assignmentFilterUser || assignmentFilterRole || assignmentFilterScope || assignmentFilterStatus) && (
                  <button onClick={() => {
                    setAssignmentFilterUser(null);
                    setAssignmentFilterRole(null);
                    setAssignmentFilterScope(null);
                    setAssignmentFilterStatus(null);
                  }} className="px-4 py-2 bg-red-100 text-red-600 rounded-xl text-sm font-bold hover:bg-red-200">
                    Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
                  </button>
                )}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-4">
                <h3 className="text-lg font-black text-white flex items-center gap-2">
                  <Users className="w-5 h-5 text-purple-400" />
                  Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†Ø§Øª ({roleAssignments.filter(ra => {
                    if (assignmentFilterUser && ra.userId !== parseInt(assignmentFilterUser)) return false;
                    if (assignmentFilterRole && ra.roleId !== parseInt(assignmentFilterRole)) return false;
                    if (assignmentFilterScope && ra.scopeType !== assignmentFilterScope) return false;
                    if (assignmentFilterStatus && ra.status !== assignmentFilterStatus) return false;
                    return true;
                  }).length})
                </h3>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¯ÙˆØ±</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù†Ø·Ø§Ù‚</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ù…Ù†</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¥Ù„Ù‰</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {roleAssignments.filter(ra => {
                      if (assignmentFilterUser && ra.userId !== parseInt(assignmentFilterUser)) return false;
                      if (assignmentFilterRole && ra.roleId !== parseInt(assignmentFilterRole)) return false;
                      if (assignmentFilterScope && ra.scopeType !== assignmentFilterScope) return false;
                      if (assignmentFilterStatus && ra.status !== assignmentFilterStatus) return false;
                      return true;
                    }).map(ra => {
                      const user = users.find(u => u.id === ra.userId);
                      const role = roles.find(r => r.id === ra.roleId);
                      const scopeName = ra.scopeType === 'TENANT' ? IAM_API.tenant.name :
                        ra.scopeType === 'ENTITY' ? getEntityName(ra.scopeId) :
                          ra.scopeType === 'BU' ? getBUName(ra.scopeId) :
                            getSiteName(ra.scopeId);
                      return (
                        <tr key={ra.id} className={`hover:bg-slate-50 transition-colors ${ra.status !== 'Active' ? 'bg-red-50/30' : ''}`}>
                          <td className="px-4 py-3">
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold">
                                {user?.name?.charAt(0)}
                              </div>
                              <div>
                                <p className="font-bold text-slate-800">{user?.name}</p>
                                <p className="text-xs text-slate-500">{user?.jobTitle}</p>
                              </div> </div> </td>
                          <td className="px-4 py-3">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${role?.level === 0 ? 'bg-red-100 text-red-700' :
                              role?.level === 1 ? 'bg-amber-100 text-amber-700' :
                                'bg-purple-100 text-purple-700'
                              }`}>
                              {role?.name}
                            </span> </td>
                          <td className="px-4 py-3 text-center">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${ra.scopeType === 'TENANT' ? 'bg-red-100 text-red-700' :
                              ra.scopeType === 'ENTITY' ? 'bg-blue-100 text-blue-700' :
                                ra.scopeType === 'BU' ? 'bg-cyan-100 text-cyan-700' :
                                  'bg-amber-100 text-amber-700'
                              }`}>
                              {ra.scopeType === 'TENANT' ? 'ğŸŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' :
                                ra.scopeType === 'ENTITY' ? 'ğŸ›ï¸ ÙƒÙŠØ§Ù†' :
                                  ra.scopeType === 'BU' ? 'ğŸ“ ÙˆØ­Ø¯Ø©' : 'ğŸ“ Ù…ÙˆÙ‚Ø¹'}
                            </span> </td>
                          <td className="px-4 py-3 text-slate-600 font-medium">{scopeName}</td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-sm text-slate-600 font-mono bg-slate-100 px-2 py-1 rounded">{ra.validFrom}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-sm text-slate-600 font-mono bg-slate-100 px-2 py-1 rounded">{ra.validTo || 'âˆ'}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${ra.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                              }`}>
                              {ra.status === 'Active' ? 'â— Ù†Ø´Ø·' : 'â—‹ Ù…Ø¹Ø·Ù„'}
                            </span> </td>
                          <td className="px-4 py-3">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => {
                                setEditingAssignment(ra);
                                setAssignmentForm({
                                  userId: ra.userId.toString(), roleId: ra.roleId.toString(), scopeType: ra.scopeType, scopeId: ra.scopeId,
                                  validFrom: ra.validFrom, validTo: ra.validTo || '',
                                  status: ra.status
                                });
                                setShowAssignmentModal(true);
                              }} className="p-2 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100 transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                                <Edit className="w-4 h-4" />
                              </button>

                              <button onClick={() => {
                                const newStatus = ra.status === 'Active' ? 'Inactive' : 'Active';
                                setRoleAssignments(prev => prev.map(r => r.id === ra.id ? { ...r, status: newStatus } : r));
                                logAction(newStatus === 'Active' ? 'ACTIVATE_ASSIGNMENT' : 'DEACTIVATE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', ra.id, {
                                  user: user?.name, role: role?.name, newStatus
                                });
                                showNotification(newStatus === 'Active' ? 'âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' : 'âš ï¸ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†');
                              }} className={`p-2 rounded-lg transition-all ${ra.status === 'Active'
                                ? 'bg-red-50 text-red-600 hover:bg-red-100'
                                : 'bg-emerald-50 text-emerald-600 hover:bg-emerald-100'
                                }`} title={ra.status === 'Active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}>
                                {ra.status === 'Active' ? <XCircle className="w-4 h-4" /> : <CheckCircle2 className="w-4 h-4" />}
                              </button>

                              <button onClick={() => {
                                if (window.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ØªØ¹ÙŠÙŠÙ† "${role?.name}" Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user?.name}"ØŸ`)) {
                                  setRoleAssignments(prev => prev.filter(r => r.id !== ra.id));
                                  logAction('DELETE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', ra.id, {
                                    user: user?.name, role: role?.name
                                  });
                                  showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                                }
                              }} className="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all" title="Ø­Ø°Ù">
                                <Trash2 className="w-4 h-4" />
                              </button> </div> </td> </tr>);
                    })}
                  </tbody> </table> </div>
              {roleAssignments.filter(ra => {
                if (assignmentFilterUser && ra.userId !== parseInt(assignmentFilterUser)) return false;
                if (assignmentFilterRole && ra.roleId !== parseInt(assignmentFilterRole)) return false;
                if (assignmentFilterScope && ra.scopeType !== assignmentFilterScope) return false;
                if (assignmentFilterStatus && ra.status !== assignmentFilterStatus) return false;
                return true;
              }).length === 0 && (
                  <div className="text-center py-12">
                    <Users className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                    <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹ÙŠÙŠÙ†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„ØªØ±</p>
                  </div>
                )}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            BANK-GRADE ROLE ASSIGNMENT WIZARD - World-Class Enterprise IAM
            Features: 3-Step Flow, SoD Validator, Multi-Scope, Delegation, Preview
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showAssignmentModal && (
          <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden max-h-[95vh] flex flex-col">

              <div className={`px-8 py-6 text-white shrink-0 ${editingAssignment
                ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500'
                : 'bg-gradient-to-l from-emerald-600 via-teal-600 to-cyan-700'
                }`}>
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                      {editingAssignment ? <Edit className="w-7 h-7" /> : <UserPlus className="w-7 h-7" />}
                    </div>
                    <div>
                      <h2 className="text-2xl font-black">{editingAssignment ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†' : 'Ù…Ø¹Ø§Ù„Ø¬ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±'}</h2>
                      <p className={editingAssignment ? 'text-amber-100' : 'text-emerald-200'}>
                        {editingAssignment ? 'Edit Role Assignment Wizard' : 'Bank-Grade Role Assignment Wizard'}
                      </p> </div> </div>
                  <button onClick={() => { setShowAssignmentModal(false); setEditingAssignment(null); setAssignmentWizardStep(0); }}
                    className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                    <X className="w-6 h-6" />
                  </button> </div>
                <div className="flex items-center gap-4">
                  {[
                    { step: 0, label: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¯ÙˆØ±', labelEn: 'User & Role', icon: Users },
                    { step: 1, label: 'Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ÙƒÙŠØ§Ù†Ø§Øª', labelEn: 'Scope', icon: Building2 },
                    { step: 2, label: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', labelEn: 'Settings & Review', icon: CheckCircle2 }
                  ].map((s, idx) => (
                    <React.Fragment key={s.step}>
                      <button onClick={() => { if (assignmentWizardStep > s.step) setAssignmentWizardStep(s.step); }}
                        className={`flex items-center gap-3 px-5 py-3 rounded-xl font-bold transition-all ${assignmentWizardStep === s.step
                          ? `bg-white ${editingAssignment ? 'text-amber-700' : 'text-emerald-700'} shadow-lg scale-105`
                          : assignmentWizardStep > s.step ? 'bg-white/30 text-white' : 'bg-white/10 text-white/70'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${assignmentWizardStep === s.step
                          ? (editingAssignment ? 'bg-amber-100' : 'bg-emerald-100')
                          : assignmentWizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {assignmentWizardStep > s.step ? <Check className="w-5 h-5 text-white" /> : <s.icon className="w-5 h-5" />}
                        </div>
                        <div className="text-right">
                          <p className="text-sm font-bold">{s.label}</p>
                          <p className="text-xs opacity-70">{s.labelEn}</p>
                        </div> </button>
                      {idx < 2 && <ChevronLeft className="w-5 h-5 text-white/40" />}
                    </React.Fragment>
                  ))}
                </div> </div>
              <div className="flex-1 overflow-y-auto p-8">

                {assignmentWizardStep === 0 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${editingAssignment ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${editingAssignment ? 'bg-amber-500' : 'bg-emerald-500'}`}>
                          <Users className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${editingAssignment ? 'text-amber-900' : 'text-emerald-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¯ÙˆØ±</h3>
                          <p className={`text-sm ${editingAssignment ? 'text-amber-600' : 'text-emerald-600'}`}>Select User and Role to Assign</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *
                      </label>
                      <div className="grid grid-cols-3 gap-3 max-h-[200px] overflow-y-auto p-1">
                        {users.filter(u => u.status === 'Active').map(u => (
                          <button key={u.id}
                            onClick={() => setAssignmentForm({ ...assignmentForm, userId: u.id.toString() })}
                            disabled={!!editingAssignment}
                            className={`p-4 rounded-xl border-2 text-right transition-all ${assignmentForm.userId === u.id.toString()
                              ? 'border-emerald-500 bg-emerald-50 ring-4 ring-emerald-100'
                              : 'border-slate-200 hover:border-slate-300'
                              } ${editingAssignment ? 'opacity-60 cursor-not-allowed' : ''}`}>
                            <div className="flex items-center gap-3">
                              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold text-lg">
                                {u.name.charAt(0)}
                              </div>
                              <div className="flex-1 min-w-0">
                                <p className="font-bold text-slate-800 truncate">{u.name}</p>
                                <p className="text-xs text-slate-500 truncate">{u.jobTitle}</p>
                                <p className="text-xs text-slate-400 truncate">{u.email}</p>
                              </div>
                              {assignmentForm.userId === u.id.toString() && (
                                <CheckCircle2 className="w-6 h-6 text-emerald-500 flex-shrink-0" />
                              )}
                            </div> </button>
                        ))}
                      </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± *
                      </label>
                      <div className="grid grid-cols-4 gap-3">
                        {roles.map(r => {
                          const permCount = Object.values(rolePermissions[r.code] || {}).reduce((sum, module) =>
                            sum + Object.values(module).filter(v => v).length, 0);
                          return (
                            <button key={r.id}
                              onClick={() => setAssignmentForm({ ...assignmentForm, roleId: r.id.toString() })}
                              className={`p-4 rounded-xl border-2 text-center transition-all ${assignmentForm.roleId === r.id.toString()
                                ? 'border-emerald-500 bg-emerald-50 ring-4 ring-emerald-100'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className={`w-12 h-12 rounded-xl mx-auto mb-2 flex items-center justify-center ${r.level === 0 ? 'bg-red-100' : r.level === 1 ? 'bg-amber-100' : 'bg-purple-100'
                                }`}>
                                <Shield className={`w-6 h-6 ${r.level === 0 ? 'text-red-600' : r.level === 1 ? 'text-amber-600' : 'text-purple-600'
                                  }`} />
                              </div>
                              <p className="font-bold text-slate-800 text-sm">{r.name}</p>
                              <p className="text-xs text-slate-400">{r.nameEn}</p>
                              <div className="flex items-center justify-center gap-2 mt-2">
                                <span className={`px-2 py-0.5 rounded text-xs font-bold ${r.level === 0 ? 'bg-red-500 text-white' :
                                  r.level === 1 ? 'bg-amber-500 text-white' : 'bg-slate-500 text-white'
                                  }`}>L{r.level}</span>
                                <span className="text-xs text-slate-500">{permCount} ØµÙ„Ø§Ø­ÙŠØ©</span>
                              </div>
                              {assignmentForm.roleId === r.id.toString() && (
                                <CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto mt-2" />
                              )}
                            </button>);
                        })}
                      </div> </div>
                    {assignmentForm.userId && assignmentForm.roleId && (() => {
                      const existingRoles = roleAssignments.filter(ra => ra.userId === parseInt(assignmentForm.userId) && ra.status === 'Active');
                      const selectedRole = roles.find(r => r.id === parseInt(assignmentForm.roleId));
                      const conflicts = [];
                      existingRoles.forEach(ra => {
                        const existingRole = roles.find(r => r.id === ra.roleId);
                        if (existingRole?.level <= 1 && selectedRole?.level <= 1) {
                          conflicts.push(`ØªØ¹Ø§Ø±Ø¶ Ù…Ø­ØªÙ…Ù„: ${existingRole?.name} + ${selectedRole?.name}`);
                        }
                      });
                      if (conflicts.length > 0) {
                        return (
                          <div className="bg-amber-50 rounded-xl border-2 border-amber-200 p-4">
                            <div className="flex items-start gap-3">
                              <AlertTriangle className="w-6 h-6 text-amber-500 flex-shrink-0" />
                              <div>
                                <p className="font-bold text-amber-800">ØªØ­Ø°ÙŠØ± SoD</p>
                                <ul className="text-sm text-amber-700 mt-1">
                                  {conflicts.map((c, i) => <li key={i}>â€¢ {c}</li>)}
                                </ul>
                              </div> </div> </div>);
                      }
                      return null;
                    })()}
                  </div>
                )}

                {assignmentWizardStep === 1 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${editingAssignment ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${editingAssignment ? 'bg-amber-500' : 'bg-blue-500'}`}>
                          <Building2 className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${editingAssignment ? 'text-amber-900' : 'text-blue-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
                          <p className={`text-sm ${editingAssignment ? 'text-amber-600' : 'text-blue-600'}`}>Define Permission Scope</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ *
                      </label>
                      <div className="grid grid-cols-4 gap-4">
                        {[
                          { id: 'TENANT', label: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø©', labelEn: 'Entire Tenant', icon: Globe, color: 'red', desc: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª' },
                          { id: 'ENTITY', label: 'ÙƒÙŠØ§Ù† Ù‚Ø§Ù†ÙˆÙ†ÙŠ', labelEn: 'Legal Entity', icon: Building2, color: 'blue', desc: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ ÙƒÙŠØ§Ù† Ù…Ø­Ø¯Ø¯' },
                          { id: 'BU', label: 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„', labelEn: 'Business Unit', icon: Briefcase, color: 'cyan', desc: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„' },
                          { id: 'SITE', label: 'Ù…ÙˆÙ‚Ø¹ / ÙØ±Ø¹', labelEn: 'Site / Branch', icon: MapPin, color: 'amber', desc: 'ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯' }
                        ].map(scope => (
                          <button key={scope.id}
                            onClick={() => setAssignmentForm({ ...assignmentForm, scopeType: scope.id, scopeId: scope.id === 'TENANT' ? 'TENANT-001' : '', selectedScopes: [] })}
                            className={`p-5 rounded-2xl border-2 text-center transition-all ${assignmentForm.scopeType === scope.id
                              ? `border-${scope.color}-500 bg-${scope.color}-50 ring-4 ring-${scope.color}-100`
                              : 'border-slate-200 hover:border-slate-300 hover:shadow-md'
                              }`}>
                            <div className={`w-14 h-14 rounded-xl mx-auto mb-3 flex items-center justify-center ${assignmentForm.scopeType === scope.id ? `bg-${scope.color}-500` : 'bg-slate-100'
                              }`}>
                              <scope.icon className={`w-7 h-7 ${assignmentForm.scopeType === scope.id ? 'text-white' : 'text-slate-500'}`} />
                            </div>
                            <p className="font-bold text-slate-800">{scope.label}</p>
                            <p className="text-xs text-slate-500 mt-1">{scope.labelEn}</p>
                            <p className="text-xs text-slate-400 mt-2">{scope.desc}</p>
                            {assignmentForm.scopeType === scope.id && (
                              <CheckCircle2 className={`w-6 h-6 text-${scope.color}-500 mx-auto mt-3`} />
                            )}
                          </button>
                        ))}
                      </div> </div>
                    {assignmentForm.scopeType !== 'TENANT' && (
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø§Ø®ØªØ± {assignmentForm.scopeType === 'ENTITY' ? 'Ø§Ù„ÙƒÙŠØ§Ù†' : assignmentForm.scopeType === 'BU' ? 'ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„' : 'Ø§Ù„Ù…ÙˆÙ‚Ø¹'} *
                        </label>
                        <div className="grid grid-cols-3 gap-3 max-h-[200px] overflow-y-auto p-1">
                          {assignmentForm.scopeType === 'ENTITY' && legalEntities.map(e => (
                            <button key={e.id}
                              onClick={() => setAssignmentForm({ ...assignmentForm, scopeId: e.id })}
                              className={`p-4 rounded-xl border-2 text-right transition-all ${assignmentForm.scopeId === e.id
                                ? 'border-blue-500 bg-blue-50 ring-4 ring-blue-100'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                                  <Building2 className="w-5 h-5 text-blue-600" />
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800">{e.name}</p>
                                  <p className="text-xs text-slate-500">{e.type}</p>
                                </div>
                                {assignmentForm.scopeId === e.id && <CheckCircle2 className="w-5 h-5 text-blue-500" />}
                              </div> </button>
                          ))}
                          {assignmentForm.scopeType === 'BU' && businessUnits.map(bu => (
                            <button key={bu.id}
                              onClick={() => setAssignmentForm({ ...assignmentForm, scopeId: bu.id })}
                              className={`p-4 rounded-xl border-2 text-right transition-all ${assignmentForm.scopeId === bu.id
                                ? 'border-cyan-500 bg-cyan-50 ring-4 ring-cyan-100'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-lg bg-cyan-100 flex items-center justify-center">
                                  <Briefcase className="w-5 h-5 text-cyan-600" />
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800">{bu.name}</p>
                                  <p className="text-xs text-slate-500">{getEntityName(bu.entityId)}</p>
                                </div>
                                {assignmentForm.scopeId === bu.id && <CheckCircle2 className="w-5 h-5 text-cyan-500" />}
                              </div> </button>
                          ))}
                          {assignmentForm.scopeType === 'SITE' && sites.map(s => (
                            <button key={s.id}
                              onClick={() => setAssignmentForm({ ...assignmentForm, scopeId: s.id })}
                              className={`p-4 rounded-xl border-2 text-right transition-all ${assignmentForm.scopeId === s.id
                                ? 'border-amber-500 bg-amber-50 ring-4 ring-amber-100'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center">
                                  <MapPin className="w-5 h-5 text-amber-600" />
                                </div>
                                <div className="flex-1">
                                  <p className="font-bold text-slate-800">{s.name}</p>
                                  <p className="text-xs text-slate-500">{s.city}</p>
                                </div>
                                {assignmentForm.scopeId === s.id && <CheckCircle2 className="w-5 h-5 text-amber-500" />}
                              </div> </button>
                          ))}
                        </div> </div>
                    )}

                    {assignmentForm.scopeType && (
                      <div className="bg-slate-800 rounded-2xl p-5 text-white">
                        <h4 className="font-bold mb-3 flex items-center gap-2">
                          <Eye className="w-5 h-5 text-purple-400" />
                          Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†Ø·Ø§Ù‚
                        </h4>
                        <div className="grid grid-cols-3 gap-4">
                          <div className="bg-white/10 rounded-xl p-3">
                            <p className="text-xs text-slate-400 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚</p>
                            <p className="font-bold">{
                              assignmentForm.scopeType === 'TENANT' ? 'ğŸŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø©' :
                                assignmentForm.scopeType === 'ENTITY' ? 'ğŸ›ï¸ ÙƒÙŠØ§Ù† Ù‚Ø§Ù†ÙˆÙ†ÙŠ' :
                                  assignmentForm.scopeType === 'BU' ? 'ğŸ“ ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„' : 'ğŸ“ Ù…ÙˆÙ‚Ø¹/ÙØ±Ø¹'
                            }</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-3">
                            <p className="text-xs text-slate-400 mb-1">Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
                            <p className="font-bold">{
                              assignmentForm.scopeType === 'TENANT' ? IAM_API.tenant.name :
                                assignmentForm.scopeType === 'ENTITY' ? getEntityName(assignmentForm.scopeId) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' :
                                  assignmentForm.scopeType === 'BU' ? getBUName(assignmentForm.scopeId) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' :
                                    getSiteName(assignmentForm.scopeId) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
                            }</p>
                          </div>
                          <div className="bg-white/10 rounded-xl p-3">
                            <p className="text-xs text-slate-400 mb-1">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆØµÙˆÙ„</p>
                            <p className="font-bold">{
                              assignmentForm.scopeType === 'TENANT' ? 'ÙƒØ§Ù…Ù„ - Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª' :
                                assignmentForm.scopeType === 'ENTITY' ? 'ÙƒÙŠØ§Ù† ÙˆØ§Ø­Ø¯ + ÙØ±ÙˆØ¹Ù‡' :
                                  assignmentForm.scopeType === 'BU' ? 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ø­Ø¯Ø©' : 'Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·'
                            }</p>
                          </div> </div> </div>
                    )}
                  </div>
                )}

                {assignmentWizardStep === 2 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${editingAssignment ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${editingAssignment ? 'bg-amber-500' : 'bg-purple-500'}`}>
                          <Settings className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${editingAssignment ? 'text-amber-900' : 'text-purple-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
                          <p className={`text-sm ${editingAssignment ? 'text-amber-600' : 'text-purple-600'}`}>Advanced Settings & Final Review</p>
                        </div> </div> </div>
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-4">
                        <h4 className="font-bold text-slate-800 flex items-center gap-2">
                          <Calendar className="w-5 h-5 text-purple-500" />
                          ÙØªØ±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                        </h4>

                        <div>
                          <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                            <span className="w-2 h-2 rounded-full bg-red-500"></span>
                            ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© *
                          </label>
                          <input type="date" value={assignmentForm.validFrom}
                            onChange={(e) => setAssignmentForm({ ...assignmentForm, validFrom: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 transition-all" />
                        </div>

                        <div>
                          <label className="text-sm font-bold text-slate-700 mb-2 block">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                          <input type="date" value={assignmentForm.validTo}
                            onChange={(e) => setAssignmentForm({ ...assignmentForm, validTo: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 transition-all" />
                          <p className="text-xs text-slate-400 mt-1">Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ø§Ø¦Ù…</p>
                        </div>

                        {editingAssignment && (
                          <div>
                            <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <div className="grid grid-cols-2 gap-3">
                              <button onClick={() => setAssignmentForm({ ...assignmentForm, status: 'Active' })}
                                className={`p-3 rounded-xl border-2 flex items-center justify-center gap-2 ${assignmentForm.status === 'Active' ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200'
                                  }`}>
                                <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                                <span className="font-bold">Ù†Ø´Ø·</span>
                              </button>
                              <button onClick={() => setAssignmentForm({ ...assignmentForm, status: 'Inactive' })}
                                className={`p-3 rounded-xl border-2 flex items-center justify-center gap-2 ${assignmentForm.status === 'Inactive' ? 'border-red-500 bg-red-50' : 'border-slate-200'
                                  }`}>
                                <XCircle className="w-5 h-5 text-red-500" />
                                <span className="font-bold">Ù…Ø¹Ø·Ù„</span>
                              </button> </div> </div>
                        )}

                        <div>
                          <label className="text-sm font-bold text-slate-700 mb-2 block">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                          <textarea value={assignmentForm.notes || ''}
                            onChange={(e) => setAssignmentForm({ ...assignmentForm, notes: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none h-24"
                            placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø£Ùˆ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..." />
                        </div> </div>
                      <div className="bg-slate-800 rounded-2xl p-5 text-white">
                        <h4 className="font-bold mb-4 flex items-center gap-2 text-lg">
                          <FileText className="w-5 h-5 text-purple-400" />
                          Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                        </h4>

                        <div className="space-y-4">
                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center text-white font-bold">
                                {users.find(u => u.id === parseInt(assignmentForm.userId))?.name?.charAt(0)}
                              </div>
                              <div>
                                <p className="font-bold">{users.find(u => u.id === parseInt(assignmentForm.userId))?.name}</p>
                                <p className="text-xs text-slate-400">{users.find(u => u.id === parseInt(assignmentForm.userId))?.email}</p>
                              </div> </div> </div>
                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„Ø¯ÙˆØ±</p>
                            <div className="flex items-center gap-3">
                              <Shield className="w-6 h-6 text-emerald-400" />
                              <div>
                                <p className="font-bold">{roles.find(r => r.id === parseInt(assignmentForm.roleId))?.name}</p>
                                <p className="text-xs text-slate-400">Level {roles.find(r => r.id === parseInt(assignmentForm.roleId))?.level}</p>
                              </div> </div> </div>
                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„Ù†Ø·Ø§Ù‚</p>
                            <p className="font-bold">{
                              assignmentForm.scopeType === 'TENANT' ? 'ğŸŒ ' + IAM_API.tenant.name :
                                assignmentForm.scopeType === 'ENTITY' ? 'ğŸ›ï¸ ' + getEntityName(assignmentForm.scopeId) :
                                  assignmentForm.scopeType === 'BU' ? 'ğŸ“ ' + getBUName(assignmentForm.scopeId) :
                                    'ğŸ“ ' + getSiteName(assignmentForm.scopeId)
                            }</p>
                          </div>

                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„ÙØªØ±Ø©</p>
                            <p className="font-bold">
                              {assignmentForm.validFrom || 'â€”'} â†’ {assignmentForm.validTo || 'âˆ Ø¯Ø§Ø¦Ù…'}
                            </p> </div> </div>
                        <div className="mt-6 pt-4 border-t border-white/20">
                          <div className="flex items-center gap-3 text-emerald-400">
                            <CheckCircle2 className="w-6 h-6" />
                            <p className="font-bold">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ¹ÙŠÙŠÙ†</p>
                          </div> </div> </div> </div> </div>
                )}
              </div>

              <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between shrink-0">
                <button onClick={() => {
                  if (assignmentWizardStep > 0) {
                    setAssignmentWizardStep(assignmentWizardStep - 1);
                  } else {
                    setShowAssignmentModal(false);
                    setEditingAssignment(null);
                  }
                }} className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                  {assignmentWizardStep > 0 ? (
                    <>
                      <ChevronRight className="w-5 h-5" />
                      Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </>
                  ) : 'Ø¥Ù„ØºØ§Ø¡'}
                </button>

                <div className="flex items-center gap-2">
                  {[0, 1, 2].map(step => (
                    <div key={step} className={`w-3 h-3 rounded-full transition-all ${step === assignmentWizardStep ? 'bg-emerald-500 scale-125' :
                      step < assignmentWizardStep ? 'bg-emerald-300' : 'bg-slate-300'
                      }`} />
                  ))}
                </div>

                <div className="flex items-center gap-3">
                  {assignmentWizardStep < 2 ? (
                    <button onClick={() => {
                      // Validation
                      if (assignmentWizardStep === 0) {
                        if (!assignmentForm.userId || !assignmentForm.roleId) {
                          showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¯ÙˆØ±', 'error');
                          return;
                        }
                      } else if (assignmentWizardStep === 1) {
                        if (assignmentForm.scopeType !== 'TENANT' && !assignmentForm.scopeId) {
                          showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø·Ø§Ù‚', 'error');
                          return;
                        }
                      }
                      setAssignmentWizardStep(assignmentWizardStep + 1);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${editingAssignment ? 'bg-amber-500 hover:bg-amber-600' : 'bg-emerald-500 hover:bg-emerald-600'
                      }`}>
                      Ø§Ù„ØªØ§Ù„ÙŠ
                      <ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <button onClick={() => {
                      if (!assignmentForm.validFrom) {
                        showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'error');
                        return;
                      }

                      if (editingAssignment) {
                        // Update
                        setRoleAssignments(prev => prev.map(ra => ra.id === editingAssignment.id ? {
                          ...ra,
                          roleId: parseInt(assignmentForm.roleId), scopeType: assignmentForm.scopeType,
                          scopeId: assignmentForm.scopeType === 'TENANT' ? 'TENANT-001' : assignmentForm.scopeId,
                          validFrom: assignmentForm.validFrom, validTo: assignmentForm.validTo || null, status: assignmentForm.status,
                          notes: assignmentForm.notes
                        } : ra));
                        logAction('UPDATE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', editingAssignment.id, assignmentForm);
                        showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                      } else {
                        // Create
                        const newAssignment = {
                          id: Date.now(), userId: parseInt(assignmentForm.userId), roleId: parseInt(assignmentForm.roleId),
                          scopeType: assignmentForm.scopeType,
                          scopeId: assignmentForm.scopeType === 'TENANT' ? 'TENANT-001' : assignmentForm.scopeId,
                          validFrom: assignmentForm.validFrom, validTo: assignmentForm.validTo || null, status: 'Active',
                          notes: assignmentForm.notes,
                          createdAt: new Date().toISOString()
                        };
                        setRoleAssignments(prev => [newAssignment, ...prev]);
                        logAction('CREATE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', newAssignment.id, assignmentForm);
                        showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                      }
                      setShowAssignmentModal(false);
                      setEditingAssignment(null);
                      setAssignmentWizardStep(0);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${editingAssignment ? 'bg-amber-500 hover:bg-amber-600' : 'bg-emerald-500 hover:bg-emerald-600'
                      }`}>
                      <CheckCircle2 className="w-5 h-5" />
                      {editingAssignment ? 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' : 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†'}
                    </button>
                  )}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB 0.6: PERMISSION REQUESTS - Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'requests' && (
          <div className="space-y-6">
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div>
                <h2 className="text-xl lg:text-2xl font-black text-slate-800 flex items-center gap-3">
                  <div className="w-10 h-10 lg:w-12 lg:h-12 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center flex-shrink-0">
                    <Send className="w-5 h-5 lg:w-6 lg:h-6 text-white" />
                  </div>
                  Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                </h2>
                <p className="text-slate-500 mt-1 text-sm lg:text-base">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ØªÙ…Ø¯ÙŠØ¯Ø§Øª</p>
              </div>
              <button onClick={() => {
                setRequestForm({ requesterId: '', requestType: 'NewRole', roleId: '', scopeType: 'ENTITY', scopeId: '', reason: '', validFrom: '', validTo: '', status: 'Pending' });
                setSelectedRequest(null);
                setRequestWizardStep(0);
                setShowRequestModal(true);
              }}
                className="flex items-center justify-center gap-2 px-4 lg:px-6 py-2.5 lg:py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold hover:shadow-lg transition-all whitespace-nowrap flex-shrink-0">
                <Plus className="w-5 h-5" />
                <span>Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
              </button> </div>
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
              <div className="bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl lg:rounded-2xl p-4 lg:p-5 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-amber-100 text-xs lg:text-sm">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                    <p className="text-2xl lg:text-4xl font-black mt-1">{permissionRequests.filter(r => r.status === 'Pending').length}</p>
                  </div>
                  <Clock className="w-8 h-8 lg:w-12 lg:h-12 text-white/30" />
                </div> </div>
              <div className="bg-white rounded-xl lg:rounded-2xl p-4 lg:p-5 border-2 border-emerald-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§</p>
                    <p className="text-2xl lg:text-4xl font-black text-emerald-600 mt-1">{permissionRequests.filter(r => r.status === 'Approved').length}</p>
                  </div>
                  <CheckCircle2 className="w-8 h-8 lg:w-12 lg:h-12 text-emerald-200" />
                </div> </div>
              <div className="bg-white rounded-xl lg:rounded-2xl p-4 lg:p-5 border-2 border-red-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ù…Ø±ÙÙˆØ¶Ø©</p>
                    <p className="text-2xl lg:text-4xl font-black text-red-600 mt-1">{permissionRequests.filter(r => r.status === 'Rejected').length}</p>
                  </div>
                  <XCircle className="w-8 h-8 lg:w-12 lg:h-12 text-red-200" />
                </div> </div>
              <div className="bg-white rounded-xl lg:rounded-2xl p-4 lg:p-5 border-2 border-slate-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-slate-500 text-xs lg:text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                    <p className="text-4xl font-black text-slate-700 mt-1">{permissionRequests.length}</p>
                  </div>
                  <FileText className="w-12 h-12 text-slate-200" />
                </div> </div> </div>
            <div className="bg-white rounded-xl lg:rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-50 to-slate-100 px-4 lg:px-6 py-3 lg:py-4 border-b-2 border-slate-200 flex items-center justify-between">
                <h3 className="font-bold text-slate-800 flex items-center gap-2 text-sm lg:text-base">
                  <FileText className="w-4 h-4 lg:w-5 lg:h-5 text-amber-500" />
                  Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                </h3>
                <span className="text-xs lg:text-sm text-slate-500">{permissionRequests.length} Ø·Ù„Ø¨</span>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full min-w-[900px]">
                  <thead className="bg-slate-50 border-b-2 border-slate-200">
                    <tr>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„Ù†Ø·Ø§Ù‚</th>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„Ø³Ø¨Ø¨</th>
                      <th className="px-3 lg:px-4 py-3 text-right text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„ÙØªØ±Ø©</th>
                      <th className="px-3 lg:px-4 py-3 text-center text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="px-3 lg:px-4 py-3 text-center text-xs lg:text-sm font-bold text-slate-600 whitespace-nowrap">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {permissionRequests.map(req => {
                      const requester = users.find(u => u.id === req.requesterId);
                      const role = roles.find(r => r.id === req.roleId);
                      const approver = users.find(u => u.id === req.approverId);
                      return (
                        <tr key={req.id} className="border-b border-slate-100 hover:bg-amber-50/30 transition-all">
                          <td className="px-4 py-4">
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold shadow-md">
                                {requester?.name?.charAt(0)}
                              </div>
                              <div>
                                <p className="font-bold text-slate-800">{requester?.name}</p>
                                <p className="text-xs text-slate-500">{requester?.jobTitle}</p>
                              </div> </div> </td>
                          <td className="px-4 py-4">
                            <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${req.requestType === 'NewRole' ? 'bg-purple-100 text-purple-700 border border-purple-200' :
                              req.requestType === 'Extension' ? 'bg-blue-100 text-blue-700 border border-blue-200' :
                                'bg-amber-100 text-amber-700 border border-amber-200'
                              }`}>
                              {req.requestType === 'NewRole' ? 'Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯' : req.requestType === 'Extension' ? 'ØªÙ…Ø¯ÙŠØ¯' : 'ØªØ¹Ø¯ÙŠÙ„'}
                            </span> </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center gap-2">
                              <Shield className="w-4 h-4 text-slate-400" />
                              <span className="font-bold text-slate-700">{role?.name}</span>
                            </div> </td>
                          <td className="px-4 py-4">
                            <span className="text-sm text-slate-600 bg-slate-100 px-2 py-1 rounded">
                              {req.scopeType === 'TENANT' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' : req.scopeType === 'ENTITY' ? legalEntities.find(e => e.id === req.scopeId)?.name || req.scopeId : req.scopeId}
                            </span> </td>
                          <td className="px-4 py-4">
                            <p className="text-sm text-slate-600 max-w-[180px] truncate" title={req.reason}>{req.reason}</p>
                          </td>
                          <td className="px-4 py-4">
                            <div className="text-xs text-slate-500">
                              <p>{req.validFrom || 'â€”'}</p>
                              {req.validTo && <p className="text-slate-400">â†’ {req.validTo}</p>}
                              {!req.validTo && req.validFrom && <p className="text-emerald-600 font-bold">Ø¯Ø§Ø¦Ù…</p>}
                            </div> </td>
                          <td className="px-4 py-4 text-center">
                            <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${req.status === 'Pending' ? 'bg-amber-100 text-amber-700 border border-amber-200' :
                              req.status === 'Approved' ? 'bg-emerald-100 text-emerald-700 border border-emerald-200' :
                                'bg-red-100 text-red-700 border border-red-200'
                              }`}>
                              {req.status === 'Pending' ? 'Ù…Ø¹Ù„Ù‚' : req.status === 'Approved' ? 'Ù…ÙˆØ§ÙÙ‚' : 'Ù…Ø±ÙÙˆØ¶'}
                            </span>
                            {req.status !== 'Pending' && approver && (
                              <p className="text-xs text-slate-400 mt-1">Ø¨ÙˆØ§Ø³Ø·Ø©: {approver.name}</p>
                            )}
                          </td>
                          <td className="px-4 py-4">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => {
                                setSelectedRequest(req);
                                setRequestForm({ ...req });
                                setRequestWizardStep(0);
                                setShowRequestModal(true);
                              }} className="p-2 hover:bg-blue-100 rounded-lg transition-all" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <Eye className="w-4 h-4 text-blue-500" />
                              </button>

                              {req.status === 'Pending' && (
                                <>
                                  <button onClick={() => {
                                    setPermissionRequests(prev => prev.map(r => r.id === req.id ? { ...r, status: 'Approved', approverId: 3, approvedAt: new Date().toISOString() } : r));
                                    showNotification('success', 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                                  }} className="p-2 bg-emerald-100 hover:bg-emerald-200 rounded-lg transition-all" title="Ù…ÙˆØ§ÙÙ‚Ø©">
                                    <Check className="w-4 h-4 text-emerald-600" />
                                  </button>
                                  <button onClick={() => {
                                    const reason = window.prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:');
                                    if (reason !== null) {
                                      setPermissionRequests(prev => prev.map(r => r.id === req.id ? { ...r, status: 'Rejected', approverId: 3, approvedAt: new Date().toISOString(), rejectionReason: reason } : r));
                                      showNotification('info', 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
                                    }
                                  }} className="p-2 bg-red-100 hover:bg-red-200 rounded-lg transition-all" title="Ø±ÙØ¶">
                                    <X className="w-4 h-4 text-red-600" />
                                  </button>
                                </>
                              )}

                              <button onClick={() => {
                                if (window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                                  setPermissionRequests(prev => prev.filter(r => r.id !== req.id));
                                  showNotification('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
                                }
                              }} className="p-2 hover:bg-red-100 rounded-lg transition-all" title="Ø­Ø°Ù">
                                <Trash2 className="w-4 h-4 text-red-500" />
                              </button> </div> </td> </tr>);
                    })}
                    {permissionRequests.length === 0 && (
                      <tr>
                        <td colSpan={8} className="px-4 py-12 text-center">
                          <Send className="w-16 h-16 mx-auto mb-4 text-slate-200" />
                          <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
                          <p className="text-sm text-slate-400">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨</p>
                        </td> </tr>
                    )}
                  </tbody> </table> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            REQUEST MODAL - Ø¥Ø¶Ø§ÙØ©/Ø¹Ø±Ø¶/ØªØ¹Ø¯ÙŠÙ„ Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ©
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showRequestModal && (
          <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => { setShowRequestModal(false); setRequestWizardStep(0); }}>
            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden" onClick={e => e.stopPropagation()}>
              <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-bold text-white flex items-center gap-3">
                    <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                      {selectedRequest ? <Edit className="w-5 h-5" /> : <Send className="w-5 h-5" />}
                    </div>
                    {selectedRequest ? 'Ø¹Ø±Ø¶ / ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨' : 'Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©'}
                  </h2>
                  <button onClick={() => { setShowRequestModal(false); setRequestWizardStep(0); }} className="text-white/80 hover:text-white p-1">
                    <X className="w-6 h-6" />
                  </button> </div>
                <div className="flex items-center justify-between">
                  {[
                    { step: 0, label: 'Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨', icon: User },
                    { step: 1, label: 'Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„Ù†Ø·Ø§Ù‚', icon: Shield },
                    { step: 2, label: 'Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©', icon: Calendar },
                    { step: 3, label: 'Ø§Ù„Ù…Ø¨Ø±Ø± ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: FileText },
                  ].map((s, idx) => (
                    <div key={s.step} className="flex items-center">
                      <button type="button" onClick={() => setRequestWizardStep(s.step)}
                        className={`flex items-center gap-2 px-3 py-2 rounded-xl transition-all cursor-pointer ${requestWizardStep === s.step ? 'bg-white text-amber-600' :
                          requestWizardStep > s.step ? 'bg-white/30 text-white' : 'bg-white/10 text-white/60'
                          }`}>
                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${requestWizardStep === s.step ? 'bg-amber-500 text-white' :
                          requestWizardStep > s.step ? 'bg-emerald-500 text-white' : 'bg-white/20'
                          }`}>
                          {requestWizardStep > s.step ? <Check className="w-4 h-4" /> : s.step + 1}
                        </div>
                        <span className="font-bold text-sm hidden md:block">{s.label}</span>
                      </button>
                      {idx < 3 && <div className={`w-8 h-0.5 mx-1 ${requestWizardStep > s.step ? 'bg-emerald-400' : 'bg-white/20'}`} />}
                    </div>
                  ))}
                </div> </div>
              <div className="p-6 overflow-y-auto flex-1">
                {requestWizardStep === 0 && (
                  <div className="space-y-6">
                    <div className="text-center mb-6">
                      <div className="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <User className="w-10 h-10 text-amber-600" />
                      </div>
                      <h3 className="text-xl font-bold text-slate-800">ØªØ­Ø¯ÙŠØ¯ Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</h3>
                      <p className="text-slate-500">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ÙŠØ·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</p>
                    </div>

                    <div className="bg-slate-50 rounded-xl p-6 border border-slate-200 space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ *</label>
                        <select value={requestForm.requesterId} onChange={(e) => setRequestForm({ ...requestForm, requesterId: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...</option>
                          {users.filter(u => u.status === 'Active').map(u => (
                            <option key={u.id} value={u.id}>{u.name} - {u.jobTitle}</option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ *</label>
                        <div className="grid grid-cols-3 gap-3">
                          {[
                            { value: 'NewRole', label: 'Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯', desc: 'Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©', icon: Plus, color: 'purple' },
                            { value: 'Extension', label: 'ØªÙ…Ø¯ÙŠØ¯', desc: 'ØªÙ…Ø¯ÙŠØ¯ ØµÙ„Ø§Ø­ÙŠØ© Ù‚Ø§Ø¦Ù…Ø©', icon: Clock, color: 'blue' },
                            { value: 'Modification', label: 'ØªØ¹Ø¯ÙŠÙ„', desc: 'ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ© Ù‚Ø§Ø¦Ù…Ø©', icon: Edit, color: 'amber' },
                          ].map(type => (
                            <button key={type.value} type="button" onClick={() => setRequestForm({ ...requestForm, requestType: type.value })}
                              className={`p-4 rounded-xl border-2 text-right transition-all ${requestForm.requestType === type.value
                                ? `border-${type.color}-500 bg-${type.color}-50`
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <type.icon className={`w-6 h-6 mb-2 ${requestForm.requestType === type.value ? `text-${type.color}-600` : 'text-slate-400'}`} />
                              <p className="font-bold text-slate-800">{type.label}</p>
                              <p className="text-xs text-slate-500">{type.desc}</p>
                            </button>
                          ))}
                        </div> </div>
                      {requestForm.requesterId && (
                        <div className="bg-white rounded-lg p-4 border border-slate-200">
                          <p className="text-xs text-slate-500 mb-2">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯:</p>
                          <div className="flex items-center gap-3">
                            <div className="w-12 h-12 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold">
                              {users.find(u => u.id === requestForm.requesterId)?.name?.charAt(0)}
                            </div>
                            <div>
                              <p className="font-bold text-slate-800">{users.find(u => u.id === requestForm.requesterId)?.name}</p>
                              <p className="text-sm text-slate-500">{users.find(u => u.id === requestForm.requesterId)?.jobTitle} â€¢ {users.find(u => u.id === requestForm.requesterId)?.department}</p>
                            </div> </div> </div>
                      )}
                    </div> </div>
                )}

                {requestWizardStep === 1 && (
                  <div className="space-y-6">
                    <div className="text-center mb-6">
                      <div className="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <Shield className="w-10 h-10 text-purple-600" />
                      </div>
                      <h3 className="text-xl font-bold text-slate-800">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„Ù†Ø·Ø§Ù‚</h3>
                      <p className="text-slate-500">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙˆÙ†Ø·Ø§Ù‚ ØªØ·Ø¨ÙŠÙ‚Ù‡</p>
                    </div>

                    <div className="bg-slate-50 rounded-xl p-6 border border-slate-200 space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ *</label>
                        <select value={requestForm.roleId} onChange={(e) => setRequestForm({ ...requestForm, roleId: parseInt(e.target.value) })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±...</option>
                          {roles.map(r => (
                            <option key={r.id} value={r.id}>{r.name} ({r.nameEn})</option>
                          ))}
                        </select>
                      </div>

                      {requestForm.roleId && (
                        <div className="bg-purple-50 rounded-lg p-4 border border-purple-200">
                          <div className="flex items-center gap-3">
                            <Shield className="w-8 h-8 text-purple-600" />
                            <div>
                              <p className="font-bold text-slate-800">{roles.find(r => r.id === requestForm.roleId)?.name}</p>
                              <p className="text-sm text-slate-600">{roles.find(r => r.id === requestForm.roleId)?.description}</p>
                            </div> </div> </div>
                      )}

                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ *</label>
                        <div className="grid grid-cols-4 gap-2">
                          {[
                            { value: 'TENANT', label: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', icon: Building2 },
                            { value: 'ENTITY', label: 'ÙƒÙŠØ§Ù†', icon: Briefcase },
                            { value: 'BU', label: 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„', icon: FolderOpen },
                            { value: 'SITE', label: 'Ù…ÙˆÙ‚Ø¹', icon: MapPin },
                          ].map(scope => (
                            <button key={scope.value} type="button" onClick={() => setRequestForm({ ...requestForm, scopeType: scope.value, scopeId: scope.value === 'TENANT' ? 'TENANT-001' : '' })}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${requestForm.scopeType === scope.value ? 'border-purple-500 bg-purple-50' : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <scope.icon className={`w-5 h-5 mx-auto mb-1 ${requestForm.scopeType === scope.value ? 'text-purple-600' : 'text-slate-400'}`} />
                              <p className="text-sm font-bold">{scope.label}</p>
                            </button>
                          ))}
                        </div> </div>
                      {requestForm.scopeType !== 'TENANT' && (
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯ *</label>
                          <select value={requestForm.scopeId} onChange={(e) => setRequestForm({ ...requestForm, scopeId: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø·Ø§Ù‚...</option>
                            {requestForm.scopeType === 'ENTITY' && legalEntities.map(e => <option key={e.id} value={e.id}>{e.name}</option>)}
                            {requestForm.scopeType === 'BU' && businessUnits.map(b => <option key={b.id} value={b.id}>{b.name}</option>)}
                            {requestForm.scopeType === 'SITE' && sites.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                          </select>
                        </div>
                      )}
                    </div> </div>
                )}

                {requestWizardStep === 2 && (
                  <div className="space-y-6">
                    <div className="text-center mb-6">
                      <div className="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <Calendar className="w-10 h-10 text-blue-600" />
                      </div>
                      <h3 className="text-xl font-bold text-slate-800">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h3>
                      <p className="text-slate-500">Ø­Ø¯Ø¯ Ù…Ø¯Ø© Ø³Ø±ÙŠØ§Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                    </div>

                    <div className="bg-slate-50 rounded-xl p-6 border border-slate-200 space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© *</label>
                          <input type="date" value={requestForm.validFrom} onChange={(e) => setRequestForm({ ...requestForm, validFrom: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                          <input type="date" value={requestForm.validTo} onChange={(e) => setRequestForm({ ...requestForm, validTo: e.target.value })}
                            className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" />
                        </div> </div>
                      <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
                        <div className="flex items-center gap-2 text-blue-800">
                          <Info className="w-5 h-5" />
                          <p className="text-sm">Ø§ØªØ±Ùƒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¯Ø§Ø¦Ù…Ø©</p>
                        </div> </div>
                      <div>
                        <p className="text-sm font-bold text-slate-700 mb-2">Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø¯Ø©:</p>
                        <div className="flex flex-wrap gap-2">
                          {[
                            { label: 'Ø´Ù‡Ø±', days: 30 },
                            { label: '3 Ø£Ø´Ù‡Ø±', days: 90 },
                            { label: '6 Ø£Ø´Ù‡Ø±', days: 180 },
                            { label: 'Ø³Ù†Ø©', days: 365 },
                            { label: 'Ø¯Ø§Ø¦Ù…', days: 0 },
                          ].map(period => (
                            <button key={period.label} type="button" onClick={() => {
                              const start = new Date();
                              const end = period.days > 0 ? new Date(start.getTime() + period.days * 24 * 60 * 60 * 1000) : null;
                              setRequestForm({
                                ...requestForm,
                                validFrom: start.toISOString().split('T')[0],
                                validTo: end ? end.toISOString().split('T')[0] : ''
                              });
                            }} className="px-4 py-2 bg-white border-2 border-slate-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all text-sm font-bold">
                              {period.label}
                            </button>
                          ))}
                        </div> </div> </div> </div>
                )}

                {requestWizardStep === 3 && (
                  <div className="space-y-6">
                    <div className="text-center mb-6">
                      <div className="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <FileText className="w-10 h-10 text-emerald-600" />
                      </div>
                      <h3 className="text-xl font-bold text-slate-800">Ø§Ù„Ù…Ø¨Ø±Ø± ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                      <p className="text-slate-500">Ø£Ø¶Ù Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ±Ø§Ø¬Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</p>
                    </div>

                    <div className="bg-slate-50 rounded-xl p-6 border border-slate-200 space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨ / Ø§Ù„Ù…Ø¨Ø±Ø± *</label>
                        <textarea value={requestForm.reason} onChange={(e) => setRequestForm({ ...requestForm, reason: e.target.value })}
                          placeholder="Ø§Ø´Ø±Ø­ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ø³Ø¨Ø¨ Ø·Ù„Ø¨ Ù‡Ø°Ù‡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙˆØ§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„ÙŠÙ‡Ø§..."
                          rows={4}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all resize-none" />
                      </div> </div>
                    <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-6 border-2 border-amber-200">
                      <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <CheckCircle2 className="w-5 h-5 text-amber-600" />
                        Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
                      </h4>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</p>
                          <p className="font-bold text-slate-800">{users.find(u => u.id === requestForm.requesterId)?.name || 'â€”'}</p>
                        </div>
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</p>
                          <p className="font-bold text-slate-800">{requestForm.requestType === 'NewRole' ? 'Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯' : requestForm.requestType === 'Extension' ? 'ØªÙ…Ø¯ÙŠØ¯' : 'ØªØ¹Ø¯ÙŠÙ„'}</p>
                        </div>
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
                          <p className="font-bold text-slate-800">{roles.find(r => r.id === requestForm.roleId)?.name || 'â€”'}</p>
                        </div>
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">Ø§Ù„Ù†Ø·Ø§Ù‚</p>
                          <p className="font-bold text-slate-800">{requestForm.scopeType === 'TENANT' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„' : legalEntities.find(e => e.id === requestForm.scopeId)?.name || requestForm.scopeId || 'â€”'}</p>
                        </div>
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</p>
                          <p className="font-bold text-slate-800">{requestForm.validFrom || 'â€”'}</p>
                        </div>
                        <div className="bg-white/60 p-3 rounded-lg">
                          <p className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                          <p className="font-bold text-slate-800">{requestForm.validTo || 'Ø¯Ø§Ø¦Ù…'}</p>
                        </div> </div> </div>
                    {selectedRequest && (
                      <div className={`rounded-xl p-5 border ${selectedRequest.status === 'Pending' ? 'bg-amber-50 border-amber-200' :
                        selectedRequest.status === 'Approved' ? 'bg-emerald-50 border-emerald-200' : 'bg-red-50 border-red-200'
                        }`}>
                        <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                          {selectedRequest.status === 'Pending' ? <Clock className="w-5 h-5 text-amber-500" /> :
                            selectedRequest.status === 'Approved' ? <CheckCircle2 className="w-5 h-5 text-emerald-500" /> :
                              <XCircle className="w-5 h-5 text-red-500" />}
                          Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                        </h4>
                        <div className="grid grid-cols-2 gap-4 text-sm">
                          <div><p className="text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø©</p><p className="font-bold">{selectedRequest.status === 'Pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : selectedRequest.status === 'Approved' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©' : 'Ù…Ø±ÙÙˆØ¶'}</p></div>
                          <div><p className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</p><p className="font-bold">{selectedRequest.createdAt}</p></div>
                          {selectedRequest.approverId && (<><div><p className="text-slate-500">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</p><p className="font-bold">{users.find(u => u.id === selectedRequest.approverId)?.name}</p></div><div><p className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø±</p><p className="font-bold">{selectedRequest.approvedAt?.split('T')[0]}</p></div></>)}
                          {selectedRequest.rejectionReason && (<div className="col-span-2"><p className="text-slate-500">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</p><p className="font-bold text-red-700">{selectedRequest.rejectionReason}</p></div>)}
                        </div> </div>
                    )}
                  </div>
                )}
              </div>

              <div className="bg-slate-100 px-6 py-4 flex items-center justify-between border-t border-slate-200">
                <div className="flex gap-2">
                  {selectedRequest?.status === 'Pending' && requestWizardStep === 3 && (
                    <>
                      <button onClick={() => {
                        setPermissionRequests(prev => prev.map(r => r.id === selectedRequest.id ? { ...r, status: 'Approved', approverId: 3, approvedAt: new Date().toISOString() } : r));
                        setShowRequestModal(false);
                        setRequestWizardStep(0);
                        showNotification('success', 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨');
                      }} className="px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600 flex items-center gap-2">
                        <Check className="w-4 h-4" />Ù…ÙˆØ§ÙÙ‚Ø©
                      </button>
                      <button onClick={() => {
                        const reason = window.prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:');
                        if (reason !== null) {
                          setPermissionRequests(prev => prev.map(r => r.id === selectedRequest.id ? { ...r, status: 'Rejected', approverId: 3, approvedAt: new Date().toISOString(), rejectionReason: reason } : r));
                          setShowRequestModal(false);
                          setRequestWizardStep(0);
                          showNotification('info', 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
                        }
                      }} className="px-4 py-2 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 flex items-center gap-2">
                        <X className="w-4 h-4" />Ø±ÙØ¶
                      </button>
                    </>
                  )}
                  {requestWizardStep > 0 && (
                    <button onClick={() => setRequestWizardStep(prev => prev - 1)} className="px-5 py-2.5 text-slate-600 font-bold hover:bg-slate-200 rounded-xl transition-all flex items-center gap-2">
                      <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                  )}
                </div>
                <div className="flex items-center gap-3">
                  <button onClick={() => { setShowRequestModal(false); setRequestWizardStep(0); }} className="px-6 py-2.5 text-slate-600 font-bold hover:bg-slate-200 rounded-xl transition-all">
                    Ø¥ØºÙ„Ø§Ù‚
                  </button>
                  {requestWizardStep < 3 ? (
                    <button onClick={() => {
                      // Validate current step
                      if (requestWizardStep === 0 && !requestForm.requesterId) {
                        showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨');
                        return;
                      }
                      if (requestWizardStep === 1 && (!requestForm.roleId || (requestForm.scopeType !== 'TENANT' && !requestForm.scopeId))) {
                        showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„Ù†Ø·Ø§Ù‚');
                        return;
                      }
                      if (requestWizardStep === 2 && !requestForm.validFrom) {
                        showNotification('error', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©');
                        return;
                      }
                      setRequestWizardStep(prev => prev + 1);
                    }} className="px-6 py-2.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold rounded-xl hover:shadow-lg transition-all flex items-center gap-2">
                      Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <>
                      {selectedRequest ? (
                        <button onClick={() => {
                          if (!requestForm.reason) {
                            showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨');
                            return;
                          }
                          setPermissionRequests(prev => prev.map(r => r.id === selectedRequest.id ? { ...requestForm, id: selectedRequest.id, createdAt: selectedRequest.createdAt, approverId: selectedRequest.approverId, approvedAt: selectedRequest.approvedAt, status: selectedRequest.status } : r));
                          setShowRequestModal(false);
                          setRequestWizardStep(0);
                          showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                        }} className="px-8 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold rounded-xl hover:shadow-lg transition-all flex items-center gap-2">
                          <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
                      ) : (
                        <button onClick={() => {
                          if (!requestForm.reason) {
                            showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨');
                            return;
                          }
                          const newRequest = {
                            ...requestForm,
                            id: Math.max(...permissionRequests.map(r => r.id), 0) + 1,
                            createdAt: new Date().toISOString().split('T')[0], approverId: null, approvedAt: null,
                            status: 'Pending'
                          };
                          setPermissionRequests(prev => [...prev, newRequest]);
                          setShowRequestModal(false);
                          setRequestWizardStep(0);
                          showNotification('success', 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                        }} className="px-8 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-bold rounded-xl hover:shadow-lg transition-all flex items-center gap-2">
                          <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                      )}
                    </>
                  )}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB 0.7: DELEGATIONS - Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'delegations' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª</h2>
                <p className="text-slate-500">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
              </div> </div>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {delegations.map(del => {
                const fromUser = users.find(u => u.id === del.fromUserId);
                const toUser = users.find(u => u.id === del.toUserId);
                return (
                  <div key={del.id} className={`bg-white rounded-2xl border-2 p-5 ${del.status === 'Active' ? 'border-emerald-300 bg-emerald-50/30' :
                    del.status === 'Scheduled' ? 'border-amber-300 bg-amber-50/30' : 'border-slate-200'
                    }`}>
                    <div className="flex items-center justify-between mb-4">
                      <span className={`px-3 py-1 rounded-lg text-xs font-bold ${del.status === 'Active' ? 'bg-emerald-500 text-white' :
                        del.status === 'Scheduled' ? 'bg-amber-500 text-white' : 'bg-slate-500 text-white'
                        }`}>
                        {del.status === 'Active' ? 'Ù†Ø´Ø·' : del.status === 'Scheduled' ? 'Ù…Ø¬Ø¯ÙˆÙ„' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                      </span>
                      <span className="text-xs text-slate-500">{del.startDate} â†’ {del.endDate}</span>
                    </div>
                    <div className="flex items-center gap-4 my-4">
                      <div className="flex items-center gap-2">
                        <div className="w-12 h-12 rounded-full bg-gradient-to-br from-slate-400 to-slate-600 flex items-center justify-center font-bold text-white">
                          {fromUser?.name?.charAt(0)}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{fromUser?.name}</p>
                          <p className="text-xs text-slate-500">{fromUser?.jobTitle}</p>
                        </div> </div>
                      <ChevronLeft className="w-6 h-6 text-slate-400" />
                      <div className="flex items-center gap-2">
                        <div className="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center font-bold text-white">
                          {toUser?.name?.charAt(0)}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{toUser?.name}</p>
                          <p className="text-xs text-slate-500">{toUser?.jobTitle}</p>
                        </div> </div> </div>
                    <div className="bg-white rounded-lg p-3 border border-slate-200">
                      <p className="text-sm text-slate-600"><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> {del.reason}</p>
                      <p className="text-sm text-slate-600"><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> {del.type === 'Full' ? 'ØªÙÙˆÙŠØ¶ ÙƒØ§Ù…Ù„' : 'ØªÙÙˆÙŠØ¶ Ø¬Ø²Ø¦ÙŠ'}</p>
                    </div>
                    {del.modules && del.modules.length > 0 && (
                      <div className="flex flex-wrap gap-1 mt-3">
                        {del.modules.map(mod => (
                          <span key={mod} className="px-2 py-1 bg-slate-100 rounded text-xs text-slate-600 font-bold">{mod}</span>
                        ))}
                      </div>
                    )}
                  </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            SOD RULES ENGINE - Full CRUD Operations
            Features: Create, Read, Update, Delete, Enable/Disable, Simulation
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'sod' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800 flex items-center gap-3">
                  <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-amber-500 to-red-500 flex items-center justify-center">
                    <GitBranch className="w-6 h-6 text-white" />
                  </div>
                  Ù…Ø­Ø±Ùƒ Ù‚ÙˆØ§Ø¹Ø¯ ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
                </h2>
                <p className="text-slate-500 mt-1">Segregation of Duties Rules Engine - Full CRUD</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-3 bg-slate-100 rounded-xl px-4 py-2">
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-red-600">{sodRules.filter(r => r.severity === 'Critical' && r.status === 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ø­Ø±Ø¬Ø©</p>
                  </div>
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-amber-600">{sodRules.filter(r => r.severity === 'High' && r.status === 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ø¹Ø§Ù„ÙŠØ©</p>
                  </div>
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-emerald-600">{sodRules.filter(r => r.status === 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ù†Ø´Ø·Ø©</p>
                  </div>
                  <div className="text-center px-3">
                    <p className="text-2xl font-black text-slate-400">{sodRules.filter(r => r.status !== 'Active').length}</p>
                    <p className="text-xs text-slate-500">Ù…Ø¹Ø·Ù„Ø©</p>
                  </div> </div>
                <button onClick={() => {
                  setSodEditMode(false);
                  setEditingSodRule(null);
                  setSodForm({
                    code: `SOD-${Date.now().toString().slice(-6)}`, name: '', nameEn: '', description: '', module: 'OBLIGATIONS',
                    blockedAction: 'APPROVE', condition: 'CREATOR', severity: 'Critical',
                    status: 'Active'
                  });
                  setShowSodModal(true);
                }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500 to-red-500 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                  <Plus className="w-5 h-5" />
                  Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button> </div> </div>
            <div className="bg-gradient-to-r from-amber-50 to-red-50 rounded-2xl border-2 border-amber-200 p-5">
              <div className="flex items-start gap-4">
                <div className="w-12 h-12 rounded-xl bg-amber-500 flex items-center justify-center flex-shrink-0">
                  <AlertTriangle className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h3 className="font-bold text-amber-900 text-lg">Ù…Ø§ Ù‡Ùˆ ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (SoD)ØŸ</h3>
                  <p className="text-amber-700 mt-1">
                    Ù‚ÙˆØ§Ø¹Ø¯ SoD ØªÙ…Ù†Ø¹ ØªØ¶Ø§Ø±Ø¨ Ø§Ù„Ù…ØµØ§Ù„Ø­ ÙˆØªØ¶Ù…Ù† Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„Ø© ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©.
                    Ù…Ø«Ù„Ø§Ù‹: Ù…Ù† ÙŠÙÙ†Ø´Ø¦ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ØŒ ÙˆÙ…Ù† ÙŠØ±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡.
                  </p>
                  <div className="flex items-center gap-4 mt-3">
                    <span className="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold">Critical = ÙŠØ¬Ø¨ Ø§Ù„ÙØµÙ„</span>
                    <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-sm font-bold">High = ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„ÙØµÙ„</span>
                    <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">Medium = Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</span>
                  </div> </div> </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
              <div className="flex items-center gap-4 flex-wrap">
                <div className="flex items-center gap-2">
                  <Filter className="w-5 h-5 text-slate-400" />
                  <span className="font-bold text-slate-600">ÙÙ„ØªØ±Ø©:</span>
                </div>
                <select value={sodFilterModule || 'all'}
                  onChange={(e) => setSodFilterModule(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>
                  {MODULES.map(m => <option key={m} value={m}>{MODULE_LABELS[m]}</option>)}
                </select>
                <select value={sodFilterSeverity || 'all'}
                  onChange={(e) => setSodFilterSeverity(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‡Ù…ÙŠØ§Øª</option>
                  <option value="Critical">Ø­Ø±Ø¬Ø© (Critical)</option>
                  <option value="High">Ø¹Ø§Ù„ÙŠØ© (High)</option>
                  <option value="Medium">Ù…ØªÙˆØ³Ø·Ø© (Medium)</option>
                </select>
                <select value={sodFilterStatus || 'all'}
                  onChange={(e) => setSodFilterStatus(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                  <option value="Active">Ù†Ø´Ø·Ø©</option>
                  <option value="Inactive">Ù…Ø¹Ø·Ù„Ø©</option>
                </select>
                {(sodFilterModule || sodFilterSeverity || sodFilterStatus) && (
                  <button onClick={() => {
                    setSodFilterModule(null);
                    setSodFilterSeverity(null);
                    setSodFilterStatus(null);
                  }} className="px-4 py-2 bg-red-100 text-red-600 rounded-xl text-sm font-bold hover:bg-red-200">
                    Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
                  </button>
                )}
              </div> </div>
            <div className="grid grid-cols-2 gap-4">
              {sodRules.filter(rule => {
                if (sodFilterModule && rule.module !== sodFilterModule) return false;
                if (sodFilterSeverity && rule.severity !== sodFilterSeverity) return false;
                if (sodFilterStatus && rule.status !== sodFilterStatus) return false;
                return true;
              }).map(rule => (
                <div key={rule.id} className={`bg-white rounded-2xl border-2 p-5 transition-all hover:shadow-lg ${rule.status !== 'Active' ? 'opacity-60 bg-slate-50' :
                  rule.severity === 'Critical' ? 'border-red-200 hover:border-red-400' :
                    rule.severity === 'High' ? 'border-amber-200 hover:border-amber-400' : 'border-blue-200 hover:border-blue-400'
                  }`}>
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${rule.severity === 'Critical' ? 'bg-red-100' :
                        rule.severity === 'High' ? 'bg-amber-100' : 'bg-blue-100'
                        }`}>
                        <GitBranch className={`w-6 h-6 ${rule.severity === 'Critical' ? 'text-red-600' :
                          rule.severity === 'High' ? 'text-amber-600' : 'text-blue-600'
                          }`} />
                      </div>
                      <div>
                        <span className="font-mono text-sm text-slate-500 bg-slate-100 px-2 py-0.5 rounded">{rule.code}</span>
                        <div className="flex items-center gap-2 mt-1">
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${rule.severity === 'Critical' ? 'bg-red-500 text-white' :
                            rule.severity === 'High' ? 'bg-amber-500 text-white' : 'bg-blue-500 text-white'
                            }`}>{rule.severity}</span>
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${rule.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-200 text-slate-600'
                            }`}>{rule.status === 'Active' ? 'â— Ù†Ø´Ø·' : 'â—‹ Ù…Ø¹Ø·Ù„'}</span>
                        </div> </div> </div>
                    <button onClick={() => {
                      toggleSodRule(rule.id);
                      logAction('TOGGLE_SOD_RULE', 'IAM', 'SOD_RULE', rule.id, { newStatus: rule.status === 'Active' ? 'Inactive' : 'Active' });
                    }}
                      className={`w-14 h-7 rounded-full transition-all relative ${rule.status === 'Active' ? 'bg-emerald-500' : 'bg-slate-300'
                        }`}>
                      <div className={`w-6 h-6 rounded-full bg-white shadow absolute top-0.5 transition-all ${rule.status === 'Active' ? 'right-0.5' : 'left-0.5'
                        }`}></div>
                    </button> </div>
                  <h3 className="font-bold text-slate-800 text-lg mb-1">{rule.name}</h3>
                  <p className="text-sm text-slate-500 mb-2">{rule.nameEn}</p>
                  <p className="text-sm text-slate-600 mb-4">{rule.description}</p>

                  <div className="flex items-center gap-2 flex-wrap mb-4">
                    <span className="text-xs bg-slate-100 text-slate-700 px-3 py-1.5 rounded-lg font-bold">
                      ğŸ“‹ {MODULE_LABELS[rule.module] || rule.module}
                    </span>
                    <span className="text-xs bg-red-50 text-red-700 px-3 py-1.5 rounded-lg font-bold">
                      â›” Ø­Ø¸Ø±: {ACTION_LABELS[rule.blockedAction] || rule.blockedAction}
                    </span>
                    <span className="text-xs bg-blue-50 text-blue-700 px-3 py-1.5 rounded-lg font-bold">
                      ğŸ”‘ Ø´Ø±Ø·: {rule.condition}
                    </span> </div>
                  <div className="grid grid-cols-3 gap-2 pt-4 border-t border-slate-100">
                    <button onClick={() => {
                      setSelectedSodRule(rule);
                      setShowSodDetailsModal(true);
                    }} className="py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 bg-blue-50 text-blue-600 hover:bg-blue-100">
                      <Eye className="w-4 h-4" />
                      Ø¹Ø±Ø¶
                    </button>

                    <button onClick={() => {
                      setSodEditMode(true);
                      setEditingSodRule(rule);
                      setSodForm({
                        code: rule.code, name: rule.name, nameEn: rule.nameEn, description: rule.description, module: rule.module,
                        blockedAction: rule.blockedAction, condition: rule.condition, severity: rule.severity,
                        status: rule.status
                      });
                      setShowSodModal(true);
                    }} className="py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 bg-amber-50 text-amber-600 hover:bg-amber-100">
                      <Edit className="w-4 h-4" />
                      ØªØ¹Ø¯ÙŠÙ„
                    </button>

                    <button onClick={() => {
                      if (window.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© "${rule.name}"ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                        setSodRules(prev => prev.filter(r => r.id !== rule.id));
                        logAction('DELETE_SOD_RULE', 'IAM', 'SOD_RULE', rule.id, { code: rule.code, name: rule.name });
                        showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      }
                    }} className="py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-1 bg-red-50 text-red-600 hover:bg-red-100">
                      <Trash2 className="w-4 h-4" />
                      Ø­Ø°Ù
                    </button> </div> </div>
              ))}
            </div>

            {sodRules.filter(rule => {
              if (sodFilterModule && rule.module !== sodFilterModule) return false;
              if (sodFilterSeverity && rule.severity !== sodFilterSeverity) return false;
              if (sodFilterStatus && rule.status !== sodFilterStatus) return false;
              return true;
            }).length === 0 && (
                <div className="text-center py-12 bg-white rounded-2xl border-2 border-slate-200">
                  <GitBranch className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                  <p className="text-slate-500 font-bold text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„ØªØ±</p>
                </div>
              )}

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-4">
                <h3 className="font-bold text-white text-lg flex items-center gap-2">
                  <Play className="w-5 h-5" />
                  Ù…Ø­Ø§ÙƒØ§Ø© ÙØ­Øµ SoD - Simulation Tester
                </h3>
                <p className="text-purple-200 text-sm mt-1">Ø§Ø®ØªØ¨Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ù‚Ø¨Ù„ ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
              </div>
              <div className="p-6">
                <div className="grid grid-cols-5 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <select value={sodSimUser || ''} onChange={(e) => setSodSimUser(e.target.value)}
                      className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm">
                      <option value="">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…</option>
                      {users.filter(u => u.status === 'Active').map(u => (
                        <option key={u.id} value={u.id}>{u.name}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select value={sodSimModule} onChange={(e) => setSodSimModule(e.target.value)}
                      className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm">
                      {MODULES.map(m => <option key={m} value={m}>{MODULE_LABELS[m]}</option>)}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</label>
                    <select value={sodSimAction} onChange={(e) => setSodSimAction(e.target.value)}
                      className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm">
                      {ACTIONS.map(a => <option key={a} value={a}>{ACTION_LABELS[a]}</option>)}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³Ø¬Ù„</label>
                    <select value={sodSimOwnerId || ''} onChange={(e) => setSodSimOwnerId(e.target.value)}
                      className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm">
                      <option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>
                      {users.filter(u => u.status === 'Active').map(u => (
                        <option key={u.id} value={u.id}>{u.name}</option>
                      ))}
                    </select>
                  </div>
                  <div className="flex items-end">
                    <button onClick={runSodSimulation}
                      className="w-full px-4 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl font-bold hover:shadow-lg">
                      <Play className="w-4 h-4 inline-block ml-2" />
                      ØªØ´ØºÙŠÙ„
                    </button> </div> </div>
                {sodSimResult && (
                  <div className={`p-4 rounded-xl ${sodSimResult.allowed ? 'bg-emerald-50 border-2 border-emerald-200' : 'bg-red-50 border-2 border-red-200'}`}>
                    <div className="flex items-center gap-3">
                      {sodSimResult.allowed ? (
                        <div className="w-12 h-12 rounded-xl bg-emerald-500 flex items-center justify-center">
                          <CheckCircle2 className="w-6 h-6 text-white" />
                        </div>
                      ) : (
                        <div className="w-12 h-12 rounded-xl bg-red-500 flex items-center justify-center">
                          <XCircle className="w-6 h-6 text-white" />
                        </div>
                      )}
                      <div>
                        <span className={`font-bold text-lg ${sodSimResult.allowed ? 'text-emerald-700' : 'text-red-700'}`}>
                          {sodSimResult.allowed ? 'âœ“ Ù…Ø³Ù…ÙˆØ­ - Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù‚ÙˆØ§Ø¹Ø¯' : 'âœ— Ù…Ø­Ø¸ÙˆØ± - ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ©'}
                        </span>
                        {sodSimResult.reason && (
                          <p className="text-sm text-red-600 mt-1">{sodSimResult.reason}</p>
                        )}
                        {sodSimResult.permissionBlocked && <p className="text-sm text-red-600 mt-1">âš ï¸ ØµÙ„Ø§Ø­ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©</p>}
                        {sodSimResult.sodBlocked && <p className="text-sm text-red-600 mt-1">âš ï¸ Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© SoD</p>}
                        {sodSimResult.doaBlocked && <p className="text-sm text-red-600 mt-1">âš ï¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ØºÙŠØ± ÙƒØ§ÙÙ</p>}
                      </div> </div> </div>
                )}
              </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            BANK-GRADE SOD RULE WIZARD - 3-Step Flow
            Features: Multi-Step, Validation, Live Preview, Professional Design
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showSodModal && (
          <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden max-h-[95vh] flex flex-col">

              <div className={`px-8 py-6 text-white shrink-0 ${sodEditMode
                ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500'
                : 'bg-gradient-to-l from-red-600 via-pink-600 to-purple-700'
                }`}>
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                      {sodEditMode ? <Edit className="w-7 h-7" /> : <GitBranch className="w-7 h-7" />}
                    </div>
                    <div>
                      <h2 className="text-2xl font-black">{sodEditMode ? 'ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© SoD' : 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© SoD'}</h2>
                      <p className={sodEditMode ? 'text-amber-100' : 'text-pink-200'}>
                        {sodEditMode ? 'Edit Segregation of Duties Rule' : 'Bank-Grade SoD Rule Creation Wizard'}
                      </p> </div> </div>
                  <button onClick={() => { setShowSodModal(false); setEditingSodRule(null); setSodWizardStep(0); }}
                    className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                    <X className="w-6 h-6" />
                  </button> </div>
                <div className="flex items-center gap-4">
                  {[
                    { step: 0, label: 'Ù‡ÙˆÙŠØ© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©', labelEn: 'Rule Identity', icon: FileText },
                    { step: 1, label: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØµÙ„', labelEn: 'Separation Config', icon: Settings },
                    { step: 2, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', labelEn: 'Review & Confirm', icon: CheckCircle2 }
                  ].map((s, idx) => (
                    <React.Fragment key={s.step}>
                      <button onClick={() => { if (sodWizardStep > s.step) setSodWizardStep(s.step); }}
                        className={`flex items-center gap-3 px-5 py-3 rounded-xl font-bold transition-all ${sodWizardStep === s.step
                          ? `bg-white ${sodEditMode ? 'text-amber-700' : 'text-red-700'} shadow-lg scale-105`
                          : sodWizardStep > s.step ? 'bg-white/30 text-white' : 'bg-white/10 text-white/70'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${sodWizardStep === s.step
                          ? (sodEditMode ? 'bg-amber-100' : 'bg-red-100')
                          : sodWizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {sodWizardStep > s.step ? <Check className="w-5 h-5 text-white" /> : <s.icon className="w-5 h-5" />}
                        </div>
                        <div className="text-right">
                          <p className="text-sm font-bold">{s.label}</p>
                          <p className="text-xs opacity-70">{s.labelEn}</p>
                        </div> </button>
                      {idx < 2 && <ChevronLeft className="w-5 h-5 text-white/40" />}
                    </React.Fragment>
                  ))}
                </div> </div>
              <div className="flex-1 overflow-y-auto p-8">

                {sodWizardStep === 0 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${sodEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-red-50 to-pink-50 border-red-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${sodEditMode ? 'bg-amber-500' : 'bg-red-500'}`}>
                          <FileText className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${sodEditMode ? 'text-amber-900' : 'text-red-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ¹Ø±ÙŠÙ Ù‡ÙˆÙŠØ© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</h3>
                          <p className={`text-sm ${sodEditMode ? 'text-amber-600' : 'text-red-600'}`}>Define Rule Identity & Classification</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© *
                      </label>
                      <input type="text" value={sodForm.code}
                        onChange={(e) => setSodForm({ ...sodForm, code: e.target.value.toUpperCase().replace(/[^A-Z0-9-]/g, '') })}
                        disabled={sodEditMode}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl font-mono text-lg disabled:bg-slate-100 focus:border-red-500"
                        placeholder="SOD-MOD-001" />
                      <p className="text-xs text-slate-400 mt-1">Ù…Ø«Ø§Ù„: SOD-OBL-001 (Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø© ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ´Ø±Ø·Ø§Øª ÙÙ‚Ø·)</p>
                    </div>

                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (Ø¹Ø±Ø¨ÙŠ) *
                        </label>
                        <input type="text" value={sodForm.name}
                          onChange={(e) => setSodForm({ ...sodForm, name: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-500"
                          placeholder="ÙØµÙ„ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯..." dir="rtl" />
                      </div>
                      <div>
                        <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                        <input type="text" value={sodForm.nameEn}
                          onChange={(e) => setSodForm({ ...sodForm, nameEn: e.target.value })}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-500"
                          placeholder="Create/Approve Separation..." dir="ltr" />
                      </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© *
                      </label>
                      <div className="grid grid-cols-3 gap-4">
                        {[
                          { id: 'Critical', label: 'Ø­Ø±Ø¬Ø©', labelEn: 'Critical', icon: AlertTriangle, color: 'red', desc: 'ÙŠØ¬Ø¨ Ø§Ù„ÙØµÙ„ - Ø¥Ù„Ø²Ø§Ù…ÙŠ' },
                          { id: 'High', label: 'Ø¹Ø§Ù„ÙŠØ©', labelEn: 'High', icon: AlertCircle, color: 'amber', desc: 'ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„ÙØµÙ„ Ø¨Ø´Ø¯Ø©' },
                          { id: 'Medium', label: 'Ù…ØªÙˆØ³Ø·Ø©', labelEn: 'Medium', icon: Info, color: 'blue', desc: 'Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚' }
                        ].map(sev => (
                          <button key={sev.id}
                            onClick={() => setSodForm({ ...sodForm, severity: sev.id })}
                            className={`p-5 rounded-2xl border-2 text-center transition-all ${sodForm.severity === sev.id
                              ? `border-${sev.color}-500 bg-${sev.color}-50 ring-4 ring-${sev.color}-100`
                              : 'border-slate-200 hover:border-slate-300 hover:shadow-md'
                              }`}>
                            <div className={`w-14 h-14 rounded-xl mx-auto mb-3 flex items-center justify-center ${sodForm.severity === sev.id ? `bg-${sev.color}-500` : 'bg-slate-100'
                              }`}>
                              <sev.icon className={`w-7 h-7 ${sodForm.severity === sev.id ? 'text-white' : 'text-slate-500'}`} />
                            </div>
                            <p className="font-bold text-slate-800">{sev.label}</p>
                            <p className="text-xs text-slate-500 mt-1">{sev.labelEn}</p>
                            <p className="text-xs text-slate-400 mt-2">{sev.desc}</p>
                            {sodForm.severity === sev.id && (
                              <CheckCircle2 className={`w-6 h-6 text-${sev.color}-500 mx-auto mt-3`} />
                            )}
                          </button>
                        ))}
                      </div> </div> </div>
                )}

                {sodWizardStep === 1 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${sodEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${sodEditMode ? 'bg-amber-500' : 'bg-blue-500'}`}>
                          <Settings className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${sodEditMode ? 'text-amber-900' : 'text-blue-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØµÙ„</h3>
                          <p className={`text-sm ${sodEditMode ? 'text-amber-600' : 'text-blue-600'}`}>Configure Separation Logic</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© *
                      </label>
                      <div className="grid grid-cols-4 gap-3">
                        {MODULES.map(m => (
                          <button key={m}
                            onClick={() => setSodForm({ ...sodForm, module: m })}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${sodForm.module === m
                              ? 'border-purple-500 bg-purple-50 ring-4 ring-purple-100'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <p className="font-bold text-slate-800 text-sm">{MODULE_LABELS[m]}</p>
                            <p className="text-xs text-slate-400 mt-1">{m}</p>
                            {sodForm.module === m && <CheckCircle2 className="w-5 h-5 text-purple-500 mx-auto mt-2" />}
                          </button>
                        ))}
                      </div> </div>
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¸ÙˆØ± *
                        </label>
                        <div className="grid grid-cols-3 gap-2">
                          {ACTIONS.map(a => (
                            <button key={a}
                              onClick={() => setSodForm({ ...sodForm, blockedAction: a })}
                              className={`p-3 rounded-xl border-2 text-center transition-all ${sodForm.blockedAction === a
                                ? 'border-red-500 bg-red-50'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <p className="font-bold text-sm">{ACTION_LABELS[a]}</p>
                              {sodForm.blockedAction === a && <CheckCircle2 className="w-4 h-4 text-red-500 mx-auto mt-1" />}
                            </button>
                          ))}
                        </div> </div>
                      <div>
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                          <span className="w-2 h-2 rounded-full bg-red-500"></span>
                          Ø´Ø±Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…Ù† Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡) *
                        </label>
                        <div className="grid grid-cols-2 gap-2">
                          {[
                            { id: 'CREATOR', label: 'Ø§Ù„Ù…ÙÙ†Ø´Ø¦', desc: 'Ù…Ù† Ø£Ù†Ø´Ø£ Ø§Ù„Ø³Ø¬Ù„' },
                            { id: 'OWNER', label: 'Ø§Ù„Ù…Ø§Ù„Ùƒ', desc: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø³Ø¬Ù„' },
                            { id: 'UPLOADER', label: 'Ø§Ù„Ø±Ø§ÙØ¹', desc: 'Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù' },
                            { id: 'PREPARER', label: 'Ø§Ù„Ù…ÙØ¹Ø¯', desc: 'Ù…Ù† Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø²Ù…Ø©' },
                            { id: 'EXECUTOR', label: 'Ø§Ù„Ù…ÙÙ†ÙØ°', desc: 'Ù…Ù† Ù†ÙØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' },
                            { id: 'REVIEWER', label: 'Ø§Ù„Ù…ÙØ±Ø§Ø¬Ø¹', desc: 'Ù…Ù† Ø±Ø§Ø¬Ø¹ Ø³Ø§Ø¨Ù‚Ø§Ù‹' }
                          ].map(c => (
                            <button key={c.id}
                              onClick={() => setSodForm({ ...sodForm, condition: c.id })}
                              className={`p-3 rounded-xl border-2 text-right transition-all ${sodForm.condition === c.id
                                ? 'border-blue-500 bg-blue-50'
                                : 'border-slate-200 hover:border-slate-300'
                                }`}>
                              <p className="font-bold text-sm">{c.label}</p>
                              <p className="text-xs text-slate-400">{c.desc}</p>
                              {sodForm.condition === c.id && <CheckCircle2 className="w-4 h-4 text-blue-500 mt-1" />}
                            </button>
                          ))}
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        ÙˆØµÙ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© *
                      </label>
                      <textarea value={sodForm.description}
                        onChange={(e) => setSodForm({ ...sodForm, description: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl resize-none h-28 focus:border-blue-500"
                        placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø© ÙŠÙˆØ¶Ø­: Ù…Ø§Ø°Ø§ ØªÙ…Ù†Ø¹ØŸ Ù„Ù…Ø§Ø°Ø§ØŸ ÙˆÙ…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹..." />
                    </div>

                    <div className="bg-slate-800 rounded-2xl p-5 text-white">
                      <h4 className="font-bold mb-3 flex items-center gap-2">
                        <Eye className="w-5 h-5 text-purple-400" />
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                      </h4>
                      <div className="bg-white/10 rounded-xl p-4">
                        <p className="text-lg">
                          <span className="text-red-400 font-bold">{sodForm.condition}</span>
                          <span className="text-slate-300 mx-2">Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡</span>
                          <span className="text-amber-400 font-bold">{ACTION_LABELS[sodForm.blockedAction]}</span>
                          <span className="text-slate-300 mx-2">ÙÙŠ ÙˆØ­Ø¯Ø©</span>
                          <span className="text-blue-400 font-bold">{MODULE_LABELS[sodForm.module]}</span>
                        </p>
                        <p className="text-sm text-slate-400 mt-2">{sodForm.description || 'Ø£Ø¶Ù ÙˆØµÙØ§Ù‹ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø©...'}</p>
                      </div> </div> </div>
                )}

                {sodWizardStep === 2 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${sodEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${sodEditMode ? 'bg-amber-500' : 'bg-emerald-500'}`}>
                          <CheckCircle2 className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${sodEditMode ? 'text-amber-900' : 'text-emerald-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯</h3>
                          <p className={`text-sm ${sodEditMode ? 'text-amber-600' : 'text-emerald-600'}`}>Final Review & Confirmation</p>
                        </div> </div> </div>
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-4">
                        <div className={`rounded-2xl border-2 overflow-hidden ${sodForm.severity === 'Critical' ? 'border-red-200' :
                          sodForm.severity === 'High' ? 'border-amber-200' : 'border-blue-200'
                          }`}>
                          <div className={`px-5 py-4 ${sodForm.severity === 'Critical' ? 'bg-red-500' :
                            sodForm.severity === 'High' ? 'bg-amber-500' : 'bg-blue-500'
                            } text-white`}>
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-3">
                                <GitBranch className="w-6 h-6" />
                                <span className="font-mono font-bold">{sodForm.code}</span>
                              </div>
                              <span className="px-3 py-1 bg-white/20 rounded-lg text-sm font-bold">{sodForm.severity}</span>
                            </div> </div>
                          <div className="p-5 bg-white">
                            <h3 className="font-bold text-lg text-slate-800">{sodForm.name || 'â€”'}</h3>
                            <p className="text-sm text-slate-500">{sodForm.nameEn || 'â€”'}</p>
                            <p className="text-sm text-slate-600 mt-3">{sodForm.description || 'â€”'}</p>
                          </div> </div>
                        <div className="bg-slate-50 rounded-2xl p-5 space-y-3">
                          <div className="flex items-center justify-between py-2 border-b border-slate-200">
                            <span className="text-slate-500">Ø§Ù„ÙˆØ­Ø¯Ø©</span>
                            <span className="font-bold text-slate-800 bg-purple-100 px-3 py-1 rounded-lg">{MODULE_LABELS[sodForm.module]}</span>
                          </div>
                          <div className="flex items-center justify-between py-2 border-b border-slate-200">
                            <span className="text-slate-500">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±</span>
                            <span className="font-bold text-red-700 bg-red-100 px-3 py-1 rounded-lg">{ACTION_LABELS[sodForm.blockedAction]}</span>
                          </div>
                          <div className="flex items-center justify-between py-2">
                            <span className="text-slate-500">Ø´Ø±Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
                            <span className="font-bold text-blue-700 bg-blue-100 px-3 py-1 rounded-lg">{sodForm.condition}</span>
                          </div> </div>
                        <div>
                          <label className="text-sm font-bold text-slate-700 mb-3 block">Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</label>
                          <div className="grid grid-cols-2 gap-3">
                            <button onClick={() => setSodForm({ ...sodForm, status: 'Active' })}
                              className={`p-4 rounded-xl border-2 flex items-center justify-center gap-3 ${sodForm.status === 'Active' ? 'border-emerald-500 bg-emerald-50 ring-4 ring-emerald-100' : 'border-slate-200'
                                }`}>
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${sodForm.status === 'Active' ? 'bg-emerald-500' : 'bg-slate-200'
                                }`}>
                                <CheckCircle2 className={`w-5 h-5 ${sodForm.status === 'Active' ? 'text-white' : 'text-slate-500'}`} />
                              </div>
                              <div className="text-right">
                                <p className="font-bold">Ù†Ø´Ø·</p>
                                <p className="text-xs text-slate-500">Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ ÙÙˆØ±Ø§Ù‹</p>
                              </div> </button>
                            <button onClick={() => setSodForm({ ...sodForm, status: 'Inactive' })}
                              className={`p-4 rounded-xl border-2 flex items-center justify-center gap-3 ${sodForm.status === 'Inactive' ? 'border-red-500 bg-red-50 ring-4 ring-red-100' : 'border-slate-200'
                                }`}>
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${sodForm.status === 'Inactive' ? 'bg-red-500' : 'bg-slate-200'
                                }`}>
                                <XCircle className={`w-5 h-5 ${sodForm.status === 'Inactive' ? 'text-white' : 'text-slate-500'}`} />
                              </div>
                              <div className="text-right">
                                <p className="font-bold">Ù…Ø¹Ø·Ù„</p>
                                <p className="text-xs text-slate-500">Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·</p>
                              </div> </button> </div> </div> </div>
                      <div className="bg-slate-800 rounded-2xl p-5 text-white">
                        <h4 className="font-bold mb-4 text-lg flex items-center gap-2">
                          <Play className="w-5 h-5 text-purple-400" />
                          ÙƒÙŠÙ Ø³ØªØ¹Ù…Ù„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                        </h4>

                        <div className="space-y-4">
                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ</p>
                            <p className="text-base">
                              Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ­Ø§ÙˆÙ„ <span className="text-red-400 font-bold">{sodForm.condition}</span> ØªÙ†ÙÙŠØ° <span className="text-amber-400 font-bold">{ACTION_LABELS[sodForm.blockedAction]}</span>...
                            </p> </div>
                          <div className="bg-red-500/20 border border-red-500/30 rounded-xl p-4">
                            <p className="text-xs text-red-400 mb-2">Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>
                            <div className="flex items-center gap-3">
                              <XCircle className="w-8 h-8 text-red-400" />
                              <div>
                                <p className="font-bold text-red-300">Ø³ÙŠØªÙ… Ø§Ù„Ø±ÙØ¶</p>
                                <p className="text-sm text-red-400/80">Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© {sodForm.code}</p>
                              </div> </div> </div>
                          <div className="bg-emerald-500/20 border border-emerald-500/30 rounded-xl p-4">
                            <p className="text-xs text-emerald-400 mb-2">Ø§Ù„Ø¨Ø¯ÙŠÙ„</p>
                            <div className="flex items-center gap-3">
                              <CheckCircle2 className="w-8 h-8 text-emerald-400" />
                              <div>
                                <p className="font-bold text-emerald-300">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø´Ø®Øµ Ø¢Ø®Ø±</p>
                                <p className="text-sm text-emerald-400/80">Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„Ø©</p>
                              </div> </div> </div>
                          <div className="bg-white/10 rounded-xl p-4">
                            <p className="text-xs text-slate-400 mb-2">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ† (ØªÙ‚Ø¯ÙŠØ±)</p>
                            <p className="text-2xl font-black text-purple-400">
                              {users.filter(u => u.status === 'Active').length}
                            </p>
                            <p className="text-sm text-slate-400">Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø· Ø³ÙŠØ®Ø¶Ø¹ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</p>
                          </div> </div>
                        <div className="mt-6 pt-4 border-t border-white/20">
                          <div className={`flex items-center gap-3 ${sodForm.status === 'Active' ? 'text-emerald-400' : 'text-amber-400'}`}>
                            {sodForm.status === 'Active' ? <CheckCircle2 className="w-6 h-6" /> : <AlertCircle className="w-6 h-6" />}
                            <p className="font-bold">{sodForm.status === 'Active' ? 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙØ¹ÙŠÙ„' : 'Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø¹Ø·Ù„Ø§Ù‹'}</p>
                          </div> </div> </div> </div> </div>
                )}
              </div>

              <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between shrink-0">
                <button onClick={() => {
                  if (sodWizardStep > 0) {
                    setSodWizardStep(sodWizardStep - 1);
                  } else {
                    setShowSodModal(false);
                    setEditingSodRule(null);
                  }
                }} className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                  {sodWizardStep > 0 ? (
                    <>
                      <ChevronRight className="w-5 h-5" />
                      Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </>
                  ) : 'Ø¥Ù„ØºØ§Ø¡'}
                </button>

                <div className="flex items-center gap-2">
                  {[0, 1, 2].map(step => (
                    <div key={step} className={`w-3 h-3 rounded-full transition-all ${step === sodWizardStep ? (sodEditMode ? 'bg-amber-500' : 'bg-red-500') + ' scale-125' :
                      step < sodWizardStep ? 'bg-emerald-400' : 'bg-slate-300'
                      }`} />
                  ))}
                </div>

                <div className="flex items-center gap-3">
                  {sodWizardStep < 2 ? (
                    <button onClick={() => {
                      // Validation
                      if (sodWizardStep === 0) {
                        if (!sodForm.code || !sodForm.name || !sodForm.severity) {
                          showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø£Ù‡Ù…ÙŠØ©', 'error');
                          return;
                        }
                      } else if (sodWizardStep === 1) {
                        if (!sodForm.description) {
                          showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø©', 'error');
                          return;
                        }
                      }
                      setSodWizardStep(sodWizardStep + 1);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${sodEditMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-red-500 hover:bg-red-600'
                      }`}>
                      Ø§Ù„ØªØ§Ù„ÙŠ
                      <ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <button onClick={() => {
                      if (sodEditMode && editingSodRule) {
                        // Update
                        setSodRules(prev => prev.map(r => r.id === editingSodRule.id ? {
                          ...r,
                          ...sodForm
                        } : r));
                        logAction('UPDATE_SOD_RULE', 'IAM', 'SOD_RULE', editingSodRule.id, sodForm);
                        showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      } else {
                        // Create
                        const newRule = {
                          id: Date.now(),
                          ...sodForm
                        };
                        setSodRules(prev => [newRule, ...prev]);
                        logAction('CREATE_SOD_RULE', 'IAM', 'SOD_RULE', newRule.id, sodForm);
                        showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      }
                      setShowSodModal(false);
                      setEditingSodRule(null);
                      setSodWizardStep(0);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${sodEditMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-emerald-500 hover:bg-emerald-600'
                      }`}>
                      <CheckCircle2 className="w-5 h-5" />
                      {sodEditMode ? 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' : 'ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡'}
                    </button>
                  )}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            SOD RULE DETAILS MODAL - Comprehensive Professional View
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {showSodDetailsModal && selectedSodRule && (
          <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden max-h-[95vh] flex flex-col">

              <div className={`px-8 py-6 text-white shrink-0 ${selectedSodRule.severity === 'Critical' ? 'bg-gradient-to-l from-red-600 via-red-500 to-pink-600' :
                selectedSodRule.severity === 'High' ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500' :
                  'bg-gradient-to-l from-blue-500 via-indigo-500 to-purple-600'
                }`}>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                      <GitBranch className="w-8 h-8" />
                    </div>
                    <div>
                      <div className="flex items-center gap-3 mb-1">
                        <span className="font-mono bg-white/20 px-3 py-1 rounded-lg text-sm">{selectedSodRule.code}</span>
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedSodRule.status === 'Active' ? 'bg-emerald-500' : 'bg-slate-500'
                          }`}>{selectedSodRule.status === 'Active' ? 'â— Ù†Ø´Ø·' : 'â—‹ Ù…Ø¹Ø·Ù„'}</span>
                      </div>
                      <h2 className="text-2xl font-black">{selectedSodRule.name}</h2>
                      <p className="text-white/80 mt-1">{selectedSodRule.nameEn}</p>
                    </div> </div>
                  <button onClick={() => { setShowSodDetailsModal(false); setSelectedSodRule(null); }}
                    className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="flex-1 overflow-y-auto p-8">
                <div className="grid grid-cols-2 gap-6">

                  <div className="space-y-6">

                    <div className={`rounded-2xl border-2 overflow-hidden ${selectedSodRule.severity === 'Critical' ? 'border-red-200' :
                      selectedSodRule.severity === 'High' ? 'border-amber-200' : 'border-blue-200'
                      }`}>
                      <div className={`px-5 py-3 ${selectedSodRule.severity === 'Critical' ? 'bg-red-50' :
                        selectedSodRule.severity === 'High' ? 'bg-amber-50' : 'bg-blue-50'
                        }`}>
                        <p className="text-xs text-slate-500 font-bold">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</p>
                      </div>
                      <div className="p-5 bg-white">
                        <div className="flex items-center gap-4">
                          <div className={`w-14 h-14 rounded-xl flex items-center justify-center ${selectedSodRule.severity === 'Critical' ? 'bg-red-500' :
                            selectedSodRule.severity === 'High' ? 'bg-amber-500' : 'bg-blue-500'
                            }`}>
                            <AlertTriangle className="w-7 h-7 text-white" />
                          </div>
                          <div>
                            <p className={`text-2xl font-black ${selectedSodRule.severity === 'Critical' ? 'text-red-600' :
                              selectedSodRule.severity === 'High' ? 'text-amber-600' : 'text-blue-600'
                              }`}>{selectedSodRule.severity}</p>
                            <p className="text-sm text-slate-500">
                              {selectedSodRule.severity === 'Critical' ? 'ÙŠØ¬Ø¨ Ø§Ù„ÙØµÙ„ - Ø¥Ù„Ø²Ø§Ù…ÙŠ' :
                                selectedSodRule.severity === 'High' ? 'ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„ÙØµÙ„ Ø¨Ø´Ø¯Ø©' : 'Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚'}
                            </p> </div> </div> </div> </div>
                    <div className="bg-slate-50 rounded-2xl p-5">
                      <p className="text-xs text-slate-500 font-bold mb-3 flex items-center gap-2">
                        <FileText className="w-4 h-4" />
                        Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                      </p>
                      <p className="text-slate-700 leading-relaxed">{selectedSodRule.description}</p>
                    </div>

                    <div className="space-y-3">
                      <p className="text-xs text-slate-500 font-bold flex items-center gap-2">
                        <Settings className="w-4 h-4" />
                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                      </p>

                      <div className="bg-purple-50 rounded-xl p-4 border-2 border-purple-100">
                        <p className="text-xs text-purple-600 mb-1">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</p>
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center">
                            <Layers className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <p className="font-bold text-purple-800">{MODULE_LABELS[selectedSodRule.module]}</p>
                            <p className="text-xs text-purple-500">{selectedSodRule.module}</p>
                          </div> </div> </div>
                      <div className="bg-red-50 rounded-xl p-4 border-2 border-red-100">
                        <p className="text-xs text-red-600 mb-1">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±</p>
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-lg bg-red-500 flex items-center justify-center">
                            <XCircle className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <p className="font-bold text-red-800">{ACTION_LABELS[selectedSodRule.blockedAction]}</p>
                            <p className="text-xs text-red-500">{selectedSodRule.blockedAction}</p>
                          </div> </div> </div>
                      <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-100">
                        <p className="text-xs text-blue-600 mb-1">Ø´Ø±Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…Ù† Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡)</p>
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center">
                            <User className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <p className="font-bold text-blue-800">{selectedSodRule.condition}</p>
                            <p className="text-xs text-blue-500">
                              {selectedSodRule.condition === 'CREATOR' ? 'Ù…Ù† Ø£Ù†Ø´Ø£ Ø§Ù„Ø³Ø¬Ù„' :
                                selectedSodRule.condition === 'OWNER' ? 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø³Ø¬Ù„' :
                                  selectedSodRule.condition === 'UPLOADER' ? 'Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù' :
                                    selectedSodRule.condition === 'PREPARER' ? 'Ù…Ù† Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø²Ù…Ø©' :
                                      selectedSodRule.condition === 'EXECUTOR' ? 'Ù…Ù† Ù†ÙØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡' : 'Ù…Ù† Ø±Ø§Ø¬Ø¹ Ø³Ø§Ø¨Ù‚Ø§Ù‹'}
                            </p> </div> </div> </div> </div> </div>
                  <div className="space-y-6">

                    <div className="bg-slate-800 rounded-2xl p-5 text-white">
                      <h4 className="font-bold mb-4 text-lg flex items-center gap-2">
                        <Play className="w-5 h-5 text-purple-400" />
                        ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                      </h4>

                      <div className="space-y-4">
                        <div className="bg-white/10 rounded-xl p-4">
                          <p className="text-xs text-slate-400 mb-2">ğŸ“Œ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ</p>
                          <p className="text-base">
                            Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ­Ø§ÙˆÙ„ <span className="text-red-400 font-bold">{selectedSodRule.condition}</span> ØªÙ†ÙÙŠØ° <span className="text-amber-400 font-bold">{ACTION_LABELS[selectedSodRule.blockedAction]}</span> ÙÙŠ <span className="text-blue-400 font-bold">{MODULE_LABELS[selectedSodRule.module]}</span>...
                          </p> </div>
                        <div className="bg-red-500/20 border border-red-500/30 rounded-xl p-4">
                          <div className="flex items-center gap-3">
                            <div className="w-12 h-12 rounded-xl bg-red-500 flex items-center justify-center">
                              <XCircle className="w-6 h-6 text-white" />
                            </div>
                            <div>
                              <p className="font-bold text-red-300 text-lg">â›” Ø³ÙŠØªÙ… Ø§Ù„Ø±ÙØ¶</p>
                              <p className="text-sm text-red-400/80">Ù…Ø®Ø§Ù„ÙØ© Ù‚Ø§Ø¹Ø¯Ø© {selectedSodRule.code}</p>
                            </div> </div> </div>
                        <div className="bg-emerald-500/20 border border-emerald-500/30 rounded-xl p-4">
                          <div className="flex items-center gap-3">
                            <div className="w-12 h-12 rounded-xl bg-emerald-500 flex items-center justify-center">
                              <CheckCircle2 className="w-6 h-6 text-white" />
                            </div>
                            <div>
                              <p className="font-bold text-emerald-300 text-lg">âœ“ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­</p>
                              <p className="text-sm text-emerald-400/80">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø´Ø®Øµ Ø¢Ø®Ø± Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</p>
                            </div> </div> </div> </div> </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-slate-50 rounded-xl p-4 text-center">
                        <p className="text-3xl font-black text-purple-600">
                          {users.filter(u => u.status === 'Active').length}
                        </p>
                        <p className="text-xs text-slate-500 mt-1">Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ£Ø«Ø±</p>
                      </div>
                      <div className="bg-slate-50 rounded-xl p-4 text-center">
                        <p className="text-3xl font-black text-red-600">
                          {auditLogs.filter(l => l.action?.includes('SOD') || l.details?.sodBlocked).length || 0}
                        </p>
                        <p className="text-xs text-slate-500 mt-1">Ø­Ø§Ù„Ø© Ø±ÙØ¶</p>
                      </div> </div>
                    <div className={`rounded-xl p-4 ${selectedSodRule.status === 'Active'
                      ? 'bg-emerald-50 border-2 border-emerald-200'
                      : 'bg-slate-100 border-2 border-slate-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        {selectedSodRule.status === 'Active' ? (
                          <CheckCircle2 className="w-8 h-8 text-emerald-500" />
                        ) : (
                          <XCircle className="w-8 h-8 text-slate-400" />
                        )}
                        <div>
                          <p className={`font-bold ${selectedSodRule.status === 'Active' ? 'text-emerald-700' : 'text-slate-600'}`}>
                            {selectedSodRule.status === 'Active' ? 'Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù†Ø´Ø·Ø© ÙˆÙ…ÙØ¹Ù‘Ù„Ø©' : 'Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¹Ø·Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹'}
                          </p>
                          <p className={`text-sm ${selectedSodRule.status === 'Active' ? 'text-emerald-600' : 'text-slate-500'}`}>
                            {selectedSodRule.status === 'Active'
                              ? 'ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª'
                              : 'Ù„Ù† ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø­ØªÙ‰ Ø§Ù„ØªÙØ¹ÙŠÙ„'}
                          </p> </div> </div> </div> </div> </div>
              </div>
              <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between shrink-0">
                <div className="flex items-center gap-3">
                  <button onClick={() => {
                    setShowSodDetailsModal(false);
                    setSodEditMode(true);
                    setEditingSodRule(selectedSodRule);
                    setSodForm({
                      code: selectedSodRule.code, name: selectedSodRule.name, nameEn: selectedSodRule.nameEn,
                      description: selectedSodRule.description, module: selectedSodRule.module, blockedAction: selectedSodRule.blockedAction,
                      condition: selectedSodRule.condition, severity: selectedSodRule.severity,
                      status: selectedSodRule.status
                    });
                    setSodWizardStep(0);
                    setShowSodModal(true);
                  }} className="flex items-center gap-2 px-5 py-3 bg-amber-100 text-amber-700 rounded-xl font-bold hover:bg-amber-200 transition-all">
                    <Edit className="w-5 h-5" />
                    ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                  </button>

                  <button onClick={() => {
                    toggleSodRule(selectedSodRule.id);
                    setSelectedSodRule({ ...selectedSodRule, status: selectedSodRule.status === 'Active' ? 'Inactive' : 'Active' });
                  }} className={`flex items-center gap-2 px-5 py-3 rounded-xl font-bold transition-all ${selectedSodRule.status === 'Active'
                    ? 'bg-red-100 text-red-700 hover:bg-red-200'
                    : 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200'
                    }`}>
                    {selectedSodRule.status === 'Active' ? <XCircle className="w-5 h-5" /> : <CheckCircle2 className="w-5 h-5" />}
                    {selectedSodRule.status === 'Active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}
                  </button> </div>
                <button onClick={() => { setShowSodDetailsModal(false); setSelectedSodRule(null); }}
                  className="px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300 transition-all">
                  Ø¥ØºÙ„Ø§Ù‚
                </button> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            DOA MATRIX - Delegation of Authority - Full CRUD Operations
            Features: Create, Read, Update, Delete, Filters, Pending Approvals
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'doa' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800 flex items-center gap-3">
                  <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center">
                    <Scale className="w-6 h-6 text-white" />
                  </div>
                  Ù…ØµÙÙˆÙØ© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                </h2>
                <p className="text-slate-500 mt-1">Delegation of Authority Matrix - Full CRUD</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-3 bg-slate-100 rounded-xl px-4 py-2">
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-red-600">{doaMatrix.filter(d => d.severity === 'Critical').length}</p>
                    <p className="text-xs text-slate-500">Ø­Ø±Ø¬Ø©</p>
                  </div>
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-amber-600">{doaMatrix.filter(d => d.severity === 'High').length}</p>
                    <p className="text-xs text-slate-500">Ø¹Ø§Ù„ÙŠØ©</p>
                  </div>
                  <div className="text-center px-3 border-l border-slate-300">
                    <p className="text-2xl font-black text-blue-600">{doaMatrix.filter(d => d.severity === 'Medium').length}</p>
                    <p className="text-xs text-slate-500">Ù…ØªÙˆØ³Ø·Ø©</p>
                  </div>
                  <div className="text-center px-3">
                    <p className="text-2xl font-black text-purple-600">{doaMatrix.filter(d => d.requiresDualApproval).length}</p>
                    <p className="text-xs text-slate-500">Ù…Ø²Ø¯ÙˆØ¬</p>
                  </div> </div>
                <button onClick={() => {
                  setDoaEditMode(false);
                  setEditingDoaRule(null);
                  setDoaForm({
                    module: 'OBLIGATIONS', action: 'APPROVE', severity: 'Medium', minRoleLevel: 2, approverRoles: [],
                    requiresDualApproval: false
                  });
                  setDoaWizardStep(0);
                  setShowDoaModal(true);
                }} className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
                  <Plus className="w-5 h-5" />
                  Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button> </div> </div>
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 p-5">
              <div className="flex items-start gap-4">
                <div className="w-12 h-12 rounded-xl bg-blue-500 flex items-center justify-center flex-shrink-0">
                  <Scale className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h3 className="font-bold text-blue-900 text-lg">Ù…Ø§ Ù‡ÙŠ Ù…ØµÙÙˆÙØ© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ (DOA)ØŸ</h3>
                  <p className="text-blue-700 mt-1">
                    ØªØ­Ø¯Ø¯ Ù…ØµÙÙˆÙØ© DOA Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø¹ØªÙ…Ø§Ø¯ ÙƒÙ„ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰.
                    Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© ØªØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹ Ù…Ù† Ù…Ø³ØªÙˆÙŠØ§Øª Ø¹Ù„ÙŠØ§.
                  </p>
                  <div className="flex items-center gap-4 mt-3">
                    <span className="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold">Critical = L1 + Ù…Ø²Ø¯ÙˆØ¬</span>
                    <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-sm font-bold">High = L2</span>
                    <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">Medium = L3</span>
                  </div> </div> </div> </div>
            {(() => {
              const myPending = ApprovalService.getMyPendingApprovals(currentUser.id);
              return myPending.length > 0 && (
                <div className="bg-white rounded-2xl border-2 border-amber-200 overflow-hidden">
                  <div className="bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4">
                    <h2 className="text-lg font-black text-white flex items-center gap-2">
                      <Clock className="w-5 h-5" />
                      Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ({myPending.length})
                    </h2>
                  </div>
                  <div className="divide-y divide-slate-100">
                    {myPending.map(req => (
                      <div key={req.id} className="p-4 hover:bg-slate-50 transition-colors">
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-2">
                              <span className={`px-2 py-1 rounded text-xs font-bold ${req.severity === 'Critical' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'
                                }`}>{req.severity}</span>
                              <span className="text-xs text-slate-500">{req.module} â€¢ {req.action}</span>
                            </div>
                            <p className="font-bold text-slate-800">{req.recordTitle}</p>
                            <p className="text-sm text-slate-500">Ø·Ù„Ø¨ Ù…Ù†: {req.requesterName} â€¢ {new Date(req.requestedAt).toLocaleString('ar-SA')}</p>
                            {req.notes && <p className="text-sm text-slate-600 mt-2 bg-slate-50 p-2 rounded">{req.notes}</p>}
                            <div className="flex items-center gap-2 mt-2">
                              <span className="text-xs text-slate-400">
                                Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª: {req.approvals.length} / {req.requiresDualApproval ? 2 : 1}
                              </span>
                              {req.approvals.map(a => (
                                <span key={a.approverId} className="px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs rounded">
                                  âœ“ {a.approverName}
                                </span>
                              ))}
                            </div> </div>
                          <div className="flex items-center gap-2 mr-4">
                            <button
                              onClick={() => {
                                const result = ApprovalService.approve(req.id, currentUser.id, '');
                                if (result.success) {
                                  showNotification(result.isComplete ? 'âœ… ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ' : 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø¹ØªÙ…Ø§Ø¯Ùƒ');
                                } else {
                                  showNotification(`â›” ${result.error}`, 'error');
                                }
                              }}
                              className="px-4 py-2 bg-emerald-500 text-white rounded-lg font-bold text-sm hover:bg-emerald-600"
                            >
                              Ø§Ø¹ØªÙ…Ø§Ø¯
                            </button>
                            <button
                              onClick={() => {
                                const reason = prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:');
                                if (reason) {
                                  const result = ApprovalService.reject(req.id, currentUser.id, reason);
                                  if (result.success) {
                                    showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
                                  } else {
                                    showNotification(`â›” ${result.error}`, 'error');
                                  }
                                }
                              }}
                              className="px-4 py-2 border-2 border-red-300 text-red-600 rounded-lg font-bold text-sm hover:bg-red-50"
                            >
                              Ø±ÙØ¶
                            </button> </div> </div> </div>
                    ))}
                  </div> </div>);
            })()}

            <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
              <div className="flex items-center gap-4 flex-wrap">
                <div className="flex items-center gap-2">
                  <Filter className="w-5 h-5 text-slate-400" />
                  <span className="font-bold text-slate-600">ÙÙ„ØªØ±Ø©:</span>
                </div>
                <select value={doaFilterModule || 'all'}
                  onChange={(e) => setDoaFilterModule(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>
                  {MODULES.map(m => <option key={m} value={m}>{MODULE_LABELS[m]}</option>)}
                </select>
                <select value={doaFilterSeverity || 'all'}
                  onChange={(e) => setDoaFilterSeverity(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‡Ù…ÙŠØ§Øª</option>
                  <option value="Critical">Ø­Ø±Ø¬Ø©</option>
                  <option value="High">Ø¹Ø§Ù„ÙŠØ©</option>
                  <option value="Medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                </select>
                <select value={doaFilterDual || 'all'}
                  onChange={(e) => setDoaFilterDual(e.target.value === 'all' ? null : e.target.value)}
                  className="px-4 py-2 border-2 border-slate-200 rounded-xl text-sm">
                  <option value="all">Ø§Ù„ÙƒÙ„</option>
                  <option value="dual">Ù…Ø²Ø¯ÙˆØ¬ ÙÙ‚Ø·</option>
                  <option value="single">ÙØ±Ø¯ÙŠ ÙÙ‚Ø·</option>
                </select>
                {(doaFilterModule || doaFilterSeverity || doaFilterDual) && (
                  <button onClick={() => {
                    setDoaFilterModule(null);
                    setDoaFilterSeverity(null);
                    setDoaFilterDual(null);
                  }} className="px-4 py-2 bg-red-100 text-red-600 rounded-xl text-sm font-bold hover:bg-red-200">
                    Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
                  </button>
                )}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-4">
                <h2 className="text-lg font-black text-white flex items-center gap-2">
                  <Table className="w-5 h-5 text-blue-400" />
                  Ù…ØµÙÙˆÙØ© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ({doaMatrix.filter(rule => {
                    if (doaFilterModule && rule.module !== doaFilterModule) return false;
                    if (doaFilterSeverity && rule.severity !== doaFilterSeverity) return false;
                    if (doaFilterDual === 'dual' && !rule.requiresDualApproval) return false;
                    if (doaFilterDual === 'single' && rule.requiresDualApproval) return false;
                    return true;
                  }).length})
                </h2>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ù…Ø²Ø¯ÙˆØ¬</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {doaMatrix.filter(rule => {
                      if (doaFilterModule && rule.module !== doaFilterModule) return false;
                      if (doaFilterSeverity && rule.severity !== doaFilterSeverity) return false;
                      if (doaFilterDual === 'dual' && !rule.requiresDualApproval) return false;
                      if (doaFilterDual === 'single' && rule.requiresDualApproval) return false;
                      return true;
                    }).map(rule => (
                      <tr key={rule.id} className="hover:bg-slate-50 transition-colors">
                        <td className="px-4 py-3">
                          <span className="font-bold text-slate-700 bg-slate-100 px-3 py-1 rounded-lg">{MODULE_LABELS[rule.module]}</span>
                        </td>
                        <td className="px-4 py-3 text-slate-600 font-medium">{ACTION_LABELS[rule.action]}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-3 py-1.5 rounded-lg text-xs font-bold ${rule.severity === 'Critical' ? 'bg-red-100 text-red-700' :
                            rule.severity === 'High' ? 'bg-amber-100 text-amber-700' :
                              'bg-blue-100 text-blue-700'
                            }`}>{rule.severity}</span>
                        </td>
                        <td className="px-4 py-3 text-center">
                          <span className="bg-purple-100 text-purple-700 px-3 py-1.5 rounded-lg text-sm font-bold">L{rule.minRoleLevel}</span>
                        </td>
                        <td className="px-4 py-3 text-sm text-slate-600">
                          {rule.approverRoles.map(r => roles.find(role => role.code === r)?.name).join(' / ')}
                        </td>
                        <td className="px-4 py-3 text-center">
                          {rule.requiresDualApproval ? (
                            <span className="inline-flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">
                              <CheckCircle2 className="w-4 h-4" />
                              Ù…Ø²Ø¯ÙˆØ¬
                            </span>
                          ) : (
                            <span className="text-slate-300">â€”</span>
                          )}
                        </td>
                        <td className="px-4 py-3">
                          <div className="flex items-center justify-center gap-1">
                            <button onClick={() => {
                              setDoaEditMode(true);
                              setEditingDoaRule(rule);
                              setDoaForm({
                                module: rule.module, action: rule.action, severity: rule.severity, minRoleLevel: rule.minRoleLevel,
                                approverRoles: rule.approverRoles,
                                requiresDualApproval: rule.requiresDualApproval
                              });
                              setDoaWizardStep(0);
                              setShowDoaModal(true);
                            }} className="p-2 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100 transition-all" title="ØªØ¹Ø¯ÙŠÙ„">
                              <Edit className="w-4 h-4" />
                            </button>
                            <button onClick={() => {
                              if (window.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‚Ø§Ø¹Ø¯Ø© "${MODULE_LABELS[rule.module]} - ${ACTION_LABELS[rule.action]}"ØŸ`)) {
                                setDoaMatrix(prev => prev.filter(r => r.id !== rule.id));
                                logAction('DELETE_DOA_RULE', 'IAM', 'DOA_MATRIX', rule.id, rule);
                                showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                              }
                            }} className="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all" title="Ø­Ø°Ù">
                              <Trash2 className="w-4 h-4" />
                            </button> </div> </td> </tr>
                    ))}
                  </tbody> </table> </div>
              {doaMatrix.filter(rule => {
                if (doaFilterModule && rule.module !== doaFilterModule) return false;
                if (doaFilterSeverity && rule.severity !== doaFilterSeverity) return false;
                if (doaFilterDual === 'dual' && !rule.requiresDualApproval) return false;
                if (doaFilterDual === 'single' && rule.requiresDualApproval) return false;
                return true;
              }).length === 0 && (
                  <div className="text-center py-12">
                    <Scale className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                    <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„ØªØ±</p>
                  </div>
                )}
            </div>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-4">
                <h2 className="text-lg font-black text-white flex items-center gap-2">
                  <History className="w-5 h-5 text-cyan-400" />
                  Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                </h2>
              </div>
              {IAM_API.approvalRequests.length === 0 ? (
                <div className="p-8 text-center text-slate-400">
                  <FileCheck className="w-12 h-12 mx-auto mb-3 opacity-30" />
                  <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                </div>
              ) : (
                <div className="divide-y divide-slate-100 max-h-96 overflow-y-auto">
                  {IAM_API.approvalRequests.map(req => (
                    <div key={req.id} className="p-4 hover:bg-slate-50">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className={`px-2 py-1 rounded text-xs font-bold ${req.status === 'Approved' ? 'bg-emerald-100 text-emerald-700' :
                              req.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                'bg-amber-100 text-amber-700'
                              }`}>{req.status === 'Approved' ? 'Ù…ÙØ¹ØªÙ…Ø¯' : req.status === 'Rejected' ? 'Ù…Ø±ÙÙˆØ¶' : 'Ù…Ø¹Ù„Ù‚'}</span>
                            <span className="text-xs text-slate-500">{req.module} â€¢ {req.action}</span>
                          </div>
                          <p className="font-bold text-slate-700">{req.recordTitle}</p>
                          <p className="text-xs text-slate-500">Ù…Ù†: {req.requesterName} â€¢ {new Date(req.requestedAt).toLocaleString('ar-SA')}</p>
                        </div>
                        <div className="text-left">
                          {req.approvals.length > 0 && (
                            <div className="text-xs text-emerald-600">
                              Ø§Ø¹ØªÙ…Ø¯Ù‡Ø§: {req.approvals.map(a => a.approverName).join(', ')}
                            </div>
                          )}
                          {req.rejections.length > 0 && (
                            <div className="text-xs text-red-600">
                              Ø±ÙØ¶Ù‡Ø§: {req.rejections.map(r => r.rejecterName).join(', ')}
                            </div>
                          )}
                        </div> </div> </div>
                  ))}
                </div>
              )}
            </div> </div>
        )}

        {showDoaModal && (
          <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden max-h-[95vh] flex flex-col">

              <div className={`px-8 py-6 text-white shrink-0 ${doaEditMode
                ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500'
                : 'bg-gradient-to-l from-blue-600 via-indigo-600 to-purple-700'
                }`}>
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                      {doaEditMode ? <Edit className="w-7 h-7" /> : <Scale className="w-7 h-7" />}
                    </div>
                    <div>
                      <h2 className="text-2xl font-black">{doaEditMode ? 'ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© DOA' : 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© DOA'}</h2>
                      <p className={doaEditMode ? 'text-amber-100' : 'text-blue-200'}>
                        {doaEditMode ? 'Edit Delegation of Authority Rule' : 'DOA Rule Creation Wizard'}
                      </p> </div> </div>
                  <button onClick={() => { setShowDoaModal(false); setEditingDoaRule(null); setDoaWizardStep(0); }}
                    className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                    <X className="w-6 h-6" />
                  </button> </div>
                <div className="flex items-center gap-4">
                  {[
                    { step: 0, label: 'Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡', labelEn: 'Module & Action', icon: Layers },
                    { step: 1, label: 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†', labelEn: 'Level & Approvers', icon: Users },
                    { step: 2, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', labelEn: 'Review & Confirm', icon: CheckCircle2 }
                  ].map((s, idx) => (
                    <React.Fragment key={s.step}>
                      <button onClick={() => { if (doaWizardStep > s.step) setDoaWizardStep(s.step); }}
                        className={`flex items-center gap-3 px-5 py-3 rounded-xl font-bold transition-all ${doaWizardStep === s.step
                          ? `bg-white ${doaEditMode ? 'text-amber-700' : 'text-blue-700'} shadow-lg scale-105`
                          : doaWizardStep > s.step ? 'bg-white/30 text-white' : 'bg-white/10 text-white/70'
                          }`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${doaWizardStep === s.step
                          ? (doaEditMode ? 'bg-amber-100' : 'bg-blue-100')
                          : doaWizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                          }`}>
                          {doaWizardStep > s.step ? <Check className="w-5 h-5 text-white" /> : <s.icon className="w-5 h-5" />}
                        </div>
                        <div className="text-right">
                          <p className="text-sm font-bold">{s.label}</p>
                          <p className="text-xs opacity-70">{s.labelEn}</p>
                        </div> </button>
                      {idx < 2 && <ChevronLeft className="w-5 h-5 text-white/40" />}
                    </React.Fragment>
                  ))}
                </div> </div>
              <div className="flex-1 overflow-y-auto p-8">

                {doaWizardStep === 0 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${doaEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${doaEditMode ? 'bg-amber-500' : 'bg-blue-500'}`}>
                          <Layers className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${doaEditMode ? 'text-amber-900' : 'text-blue-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h3>
                          <p className={`text-sm ${doaEditMode ? 'text-amber-600' : 'text-blue-600'}`}>Select Module and Action</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„ÙˆØ­Ø¯Ø© *
                      </label>
                      <div className="grid grid-cols-4 gap-3">
                        {MODULES.map(m => (
                          <button key={m}
                            onClick={() => setDoaForm({ ...doaForm, module: m })}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${doaForm.module === m
                              ? 'border-blue-500 bg-blue-50 ring-4 ring-blue-100'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <p className="font-bold text-slate-800 text-sm">{MODULE_LABELS[m]}</p>
                            {doaForm.module === m && <CheckCircle2 className="w-5 h-5 text-blue-500 mx-auto mt-2" />}
                          </button>
                        ))}
                      </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ *
                      </label>
                      <div className="grid grid-cols-4 gap-3">
                        {ACTIONS.map(a => (
                          <button key={a}
                            onClick={() => setDoaForm({ ...doaForm, action: a })}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${doaForm.action === a
                              ? 'border-purple-500 bg-purple-50 ring-4 ring-purple-100'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <p className="font-bold text-slate-800 text-sm">{ACTION_LABELS[a]}</p>
                            {doaForm.action === a && <CheckCircle2 className="w-5 h-5 text-purple-500 mx-auto mt-2" />}
                          </button>
                        ))}
                      </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© *
                      </label>
                      <div className="grid grid-cols-3 gap-4">
                        {[
                          { id: 'Critical', label: 'Ø­Ø±Ø¬Ø©', desc: 'ÙŠØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø²Ø¯ÙˆØ¬', color: 'red' },
                          { id: 'High', label: 'Ø¹Ø§Ù„ÙŠØ©', desc: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø³ØªÙˆÙ‰ L2', color: 'amber' },
                          { id: 'Medium', label: 'Ù…ØªÙˆØ³Ø·Ø©', desc: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø³ØªÙˆÙ‰ L3', color: 'blue' }
                        ].map(sev => (
                          <button key={sev.id}
                            onClick={() => setDoaForm({ ...doaForm, severity: sev.id, requiresDualApproval: sev.id === 'Critical', minRoleLevel: sev.id === 'Critical' ? 1 : sev.id === 'High' ? 2 : 3 })}
                            className={`p-5 rounded-2xl border-2 text-center transition-all ${doaForm.severity === sev.id
                              ? `border-${sev.color}-500 bg-${sev.color}-50 ring-4 ring-${sev.color}-100`
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <p className={`font-bold text-lg ${doaForm.severity === sev.id ? `text-${sev.color}-700` : 'text-slate-700'}`}>{sev.label}</p>
                            <p className="text-xs text-slate-500 mt-1">{sev.desc}</p>
                            {doaForm.severity === sev.id && <CheckCircle2 className={`w-6 h-6 text-${sev.color}-500 mx-auto mt-3`} />}
                          </button>
                        ))}
                      </div> </div> </div>
                )}

                {doaWizardStep === 1 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${doaEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${doaEditMode ? 'bg-amber-500' : 'bg-purple-500'}`}>
                          <Users className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${doaEditMode ? 'text-amber-900' : 'text-purple-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†</h3>
                          <p className={`text-sm ${doaEditMode ? 'text-amber-600' : 'text-purple-600'}`}>Define Approval Level and Approvers</p>
                        </div> </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯ÙˆØ± *
                      </label>
                      <div className="grid grid-cols-5 gap-3">
                        {[0, 1, 2, 3, 4].map(level => (
                          <button key={level}
                            onClick={() => setDoaForm({ ...doaForm, minRoleLevel: level })}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${doaForm.minRoleLevel === level
                              ? 'border-purple-500 bg-purple-50 ring-4 ring-purple-100'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <p className={`text-2xl font-black ${doaForm.minRoleLevel === level ? 'text-purple-700' : 'text-slate-700'}`}>L{level}</p>
                            <p className="text-xs text-slate-500 mt-1">{level === 0 ? 'Ø£Ø¹Ù„Ù‰' : level === 4 ? 'Ø£Ø¯Ù†Ù‰' : ''}</p>
                          </button>
                        ))}
                      </div> </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© *
                      </label>
                      <div className="grid grid-cols-4 gap-3">
                        {roles.filter(r => r.level <= doaForm.minRoleLevel).map(role => (
                          <button key={role.code}
                            onClick={() => {
                              const newRoles = doaForm.approverRoles.includes(role.code)
                                ? doaForm.approverRoles.filter(r => r !== role.code)
                                : [...doaForm.approverRoles, role.code];
                              setDoaForm({ ...doaForm, approverRoles: newRoles });
                            }}
                            className={`p-4 rounded-xl border-2 text-center transition-all ${doaForm.approverRoles.includes(role.code)
                              ? 'border-emerald-500 bg-emerald-50 ring-4 ring-emerald-100'
                              : 'border-slate-200 hover:border-slate-300'
                              }`}>
                            <Shield className={`w-6 h-6 mx-auto mb-2 ${doaForm.approverRoles.includes(role.code) ? 'text-emerald-600' : 'text-slate-400'}`} />
                            <p className="font-bold text-slate-800 text-sm">{role.name}</p>
                            <span className={`text-xs px-2 py-0.5 rounded ${role.level <= 1 ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-600'}`}>L{role.level}</span>
                            {doaForm.approverRoles.includes(role.code) && <CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto mt-2" />}
                          </button>
                        ))}
                      </div> </div>
                    <div className="bg-slate-50 rounded-2xl p-5">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-bold text-slate-800">Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø²Ø¯ÙˆØ¬ (Dual Approval)</p>
                          <p className="text-sm text-slate-500">ÙŠØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ø§Ø«Ù†ÙŠÙ†</p>
                        </div>
                        <button onClick={() => setDoaForm({ ...doaForm, requiresDualApproval: !doaForm.requiresDualApproval })}
                          className={`w-16 h-8 rounded-full transition-all relative ${doaForm.requiresDualApproval ? 'bg-emerald-500' : 'bg-slate-300'
                            }`}>
                          <div className={`w-7 h-7 rounded-full bg-white shadow absolute top-0.5 transition-all ${doaForm.requiresDualApproval ? 'right-0.5' : 'left-0.5'
                            }`}></div>
                        </button> </div> </div> </div>
                )}

                {doaWizardStep === 2 && (
                  <div className="space-y-6">
                    <div className={`rounded-2xl p-5 border ${doaEditMode ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200' : 'bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${doaEditMode ? 'bg-amber-500' : 'bg-emerald-500'}`}>
                          <CheckCircle2 className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <h3 className={`font-bold ${doaEditMode ? 'text-amber-900' : 'text-emerald-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                          <p className={`text-sm ${doaEditMode ? 'text-amber-600' : 'text-emerald-600'}`}>Final Review & Confirmation</p>
                        </div> </div> </div>
                    <div className="bg-slate-800 rounded-2xl p-6 text-white">
                      <h4 className="font-bold mb-4 text-lg">Ù…Ù„Ø®Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</h4>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white/10 rounded-xl p-4">
                          <p className="text-xs text-slate-400 mb-1">Ø§Ù„ÙˆØ­Ø¯Ø©</p>
                          <p className="font-bold text-blue-400">{MODULE_LABELS[doaForm.module]}</p>
                        </div>
                        <div className="bg-white/10 rounded-xl p-4">
                          <p className="text-xs text-slate-400 mb-1">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</p>
                          <p className="font-bold text-purple-400">{ACTION_LABELS[doaForm.action]}</p>
                        </div>
                        <div className="bg-white/10 rounded-xl p-4">
                          <p className="text-xs text-slate-400 mb-1">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</p>
                          <p className={`font-bold ${doaForm.severity === 'Critical' ? 'text-red-400' : doaForm.severity === 'High' ? 'text-amber-400' : 'text-blue-400'}`}>{doaForm.severity}</p>
                        </div>
                        <div className="bg-white/10 rounded-xl p-4">
                          <p className="text-xs text-slate-400 mb-1">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ù†Ù‰</p>
                          <p className="font-bold text-emerald-400">L{doaForm.minRoleLevel}</p>
                        </div>
                        <div className="bg-white/10 rounded-xl p-4 col-span-2">
                          <p className="text-xs text-slate-400 mb-1">Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†</p>
                          <p className="font-bold">{doaForm.approverRoles.map(r => roles.find(role => role.code === r)?.name).join(' / ') || 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯'}</p>
                        </div> </div>
                      <div className={`mt-4 p-3 rounded-xl ${doaForm.requiresDualApproval ? 'bg-amber-500/20' : 'bg-white/10'}`}>
                        <p className={`font-bold ${doaForm.requiresDualApproval ? 'text-amber-400' : 'text-slate-400'}`}>
                          {doaForm.requiresDualApproval ? 'âš¡ ÙŠØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø²Ø¯ÙˆØ¬' : 'Ø§Ø¹ØªÙ…Ø§Ø¯ ÙØ±Ø¯ÙŠ'}
                        </p> </div> </div> </div>
                )}
              </div>

              <div className="border-t-2 border-slate-200 px-8 py-5 bg-slate-50 flex items-center justify-between shrink-0">
                <button onClick={() => {
                  if (doaWizardStep > 0) {
                    setDoaWizardStep(doaWizardStep - 1);
                  } else {
                    setShowDoaModal(false);
                    setEditingDoaRule(null);
                  }
                }} className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                  {doaWizardStep > 0 ? <><ChevronRight className="w-5 h-5" /> Ø§Ù„Ø³Ø§Ø¨Ù‚</> : 'Ø¥Ù„ØºØ§Ø¡'}
                </button>

                <div className="flex items-center gap-2">
                  {[0, 1, 2].map(step => (
                    <div key={step} className={`w-3 h-3 rounded-full transition-all ${step === doaWizardStep ? (doaEditMode ? 'bg-amber-500' : 'bg-blue-500') + ' scale-125' :
                      step < doaWizardStep ? 'bg-emerald-400' : 'bg-slate-300'
                      }`} />
                  ))}
                </div>

                <div className="flex items-center gap-3">
                  {doaWizardStep < 2 ? (
                    <button onClick={() => {
                      if (doaWizardStep === 1 && doaForm.approverRoles.length === 0) {
                        showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆØ± Ù…Ø¹ØªÙ…Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                        return;
                      }
                      setDoaWizardStep(doaWizardStep + 1);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${doaEditMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-blue-500 hover:bg-blue-600'
                      }`}>
                      Ø§Ù„ØªØ§Ù„ÙŠ <ChevronLeft className="w-5 h-5" />
                    </button>
                  ) : (
                    <button onClick={() => {
                      if (doaEditMode && editingDoaRule) {
                        setDoaMatrix(prev => prev.map(r => r.id === editingDoaRule.id ? { ...r, ...doaForm } : r));
                        logAction('UPDATE_DOA_RULE', 'IAM', 'DOA_MATRIX', editingDoaRule.id, doaForm);
                        showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      } else {
                        const newRule = { id: Date.now(), ...doaForm };
                        setDoaMatrix(prev => [newRule, ...prev]);
                        logAction('CREATE_DOA_RULE', 'IAM', 'DOA_MATRIX', newRule.id, doaForm);
                        showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                      }
                      setShowDoaModal(false);
                      setEditingDoaRule(null);
                      setDoaWizardStep(0);
                    }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${doaEditMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-emerald-500 hover:bg-emerald-600'
                      }`}>
                      <CheckCircle2 className="w-5 h-5" />
                      {doaEditMode ? 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' : 'ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡'}
                    </button>
                  )}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB 0.10: SESSIONS - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'sessions' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h2>
                <p className="text-slate-500">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ÙˆØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
              </div>
              <button onClick={() => { setActiveSessions([]); showNotification('warning', 'ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª'); }}
                className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                <LogOut className="w-4 h-4" />Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒÙ„
              </button> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center">
                    <Activity className="w-5 h-5 text-emerald-600" />
                  </div>
                  <div>
                    <p className="text-2xl font-black text-emerald-700">{activeSessions.length}</p>
                    <p className="text-xs text-slate-600">Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</p>
                  </div> </div> </div>
              <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                    <Users className="w-5 h-5 text-blue-600" />
                  </div>
                  <div>
                    <p className="text-2xl font-black text-blue-700">{new Set(activeSessions.map(s => s.userId)).size}</p>
                    <p className="text-xs text-slate-600">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ØªØµÙ„ÙŠÙ†</p>
                  </div> </div> </div>
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center">
                    <History className="w-5 h-5 text-amber-600" />
                  </div>
                  <div>
                    <p className="text-2xl font-black text-amber-700">{loginHistory.length}</p>
                    <p className="text-xs text-slate-600">Ø³Ø¬Ù„Ø§Øª Ø¯Ø®ÙˆÙ„</p>
                  </div> </div> </div>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center">
                    <AlertTriangle className="w-5 h-5 text-red-600" />
                  </div>
                  <div>
                    <p className="text-2xl font-black text-red-700">{failedLogins.length}</p>
                    <p className="text-xs text-slate-600">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©</p>
                  </div> </div> </div> </div>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-emerald-600 px-5 py-3">
                  <h3 className="font-bold text-white flex items-center gap-2">
                    <Activity className="w-5 h-5" />Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
                  </h3>
                </div>
                <div className="max-h-[350px] overflow-y-auto">
                  {activeSessions.map(session => {
                    const user = users.find(u => u.id === session.userId);
                    return (
                      <div key={session.id} className="p-4 border-b border-slate-100 hover:bg-slate-50">
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center font-bold text-white">
                              {user?.name?.charAt(0)}
                            </div>
                            <div>
                              <p className="font-bold text-slate-800">{user?.name}</p>
                              <p className="text-xs text-slate-500">{user?.email}</p>
                            </div> </div>
                          <button onClick={() => {
                            setActiveSessions(prev => prev.filter(s => s.id !== session.id));
                            showNotification('info', 'ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©');
                          }} className="p-2 bg-red-100 hover:bg-red-200 rounded-lg transition-all" title="Ø¥Ù†Ù‡Ø§Ø¡">
                            <LogOut className="w-4 h-4 text-red-600" />
                          </button> </div>
                        <div className="grid grid-cols-2 gap-2 text-xs mt-3">
                          <div className="flex items-center gap-2 text-slate-600">
                            <Globe className="w-3 h-3 text-slate-400" />{session.ipAddress}
                          </div>
                          <div className="flex items-center gap-2 text-slate-600">
                            <Clock className="w-3 h-3 text-slate-400" />{session.device}
                          </div> </div> </div>);
                  })}
                </div> </div>
              <div className="bg-white rounded-2xl border-2 border-red-200 overflow-hidden">
                <div className="bg-red-600 px-5 py-3">
                  <h3 className="font-bold text-white flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5" />Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©
                  </h3>
                </div>
                <div className="max-h-[350px] overflow-y-auto">
                  {failedLogins.map(fail => (
                    <div key={fail.id} className="p-3 border-b border-slate-100 hover:bg-red-50/50">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-mono text-sm text-slate-800">{fail.email}</p>
                          <p className="text-xs text-slate-500">{fail.ipAddress} â€¢ {fail.location}</p>
                        </div>
                        <div className="text-left">
                          <span className={`px-2 py-1 rounded text-xs font-bold ${fail.blocked ? 'bg-red-500 text-white' : 'bg-amber-100 text-amber-700'}`}>
                            {fail.blocked ? 'Ù…Ø­Ø¸ÙˆØ±' : 'ØªØ­Ø°ÙŠØ±'}
                          </span>
                          <p className="text-xs text-slate-400 mt-1">{fail.reason}</p>
                        </div> </div> </div>
                  ))}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB 0.11: SECURITY - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'security' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-black text-slate-800">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h2>
                <p className="text-slate-500">Ø³ÙŠØ§Ø³Ø§Øª ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙˆÙ‚ÙˆØ§Ø¹Ø¯ IP</p>
              </div> </div>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-5 py-4">
                  <h3 className="font-bold text-white flex items-center gap-2">
                    <Lock className="w-5 h-5" />Ø³ÙŠØ§Ø³Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
                  </h3>
                </div>
                <div className="p-5 space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·ÙˆÙ„</p>
                      <p className="text-2xl font-black text-slate-800">{passwordPolicy.minLength || 12} Ø­Ø±Ù</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">ØµÙ„Ø§Ø­ÙŠØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
                      <p className="text-2xl font-black text-slate-800">{passwordPolicy.maxAge || 90} ÙŠÙˆÙ…</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø¸Ø±</p>
                      <p className="text-2xl font-black text-slate-800">{passwordPolicy.lockoutThreshold || 5}</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">Ù…Ù‡Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</p>
                      <p className="text-2xl font-black text-slate-800">{passwordPolicy.sessionTimeout || 480} Ø¯</p>
                    </div> </div>
                  <div className="space-y-2">
                    <p className="text-sm font-bold text-slate-700">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:</p>
                    {[
                      { key: 'requireUppercase', label: 'Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø© (A-Z)' },
                      { key: 'requireLowercase', label: 'Ø£Ø­Ø±Ù ØµØºÙŠØ±Ø© (a-z)' },
                      { key: 'requireNumbers', label: 'Ø£Ø±Ù‚Ø§Ù… (0-9)' },
                      { key: 'requireSpecialChars', label: 'Ø±Ù…ÙˆØ² Ø®Ø§ØµØ© (!@#$%)' },
                      { key: 'mfaRequired', label: 'Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (MFA)' },
                    ].map(req => (
                      <div key={req.key} className="flex items-center justify-between py-2 border-b border-slate-100">
                        <span className="text-sm text-slate-600">{req.label}</span>
                        {passwordPolicy[req.key] ? (
                          <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                        ) : (
                          <XCircle className="w-5 h-5 text-slate-300" />
                        )}
                      </div>
                    ))}
                  </div> </div> </div>
              <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-gradient-to-r from-slate-700 to-slate-800 px-5 py-4">
                  <h3 className="font-bold text-white flex items-center gap-2">
                    <Globe className="w-5 h-5" />Ù‚ÙˆØ§Ø¹Ø¯ Ø¹Ù†Ø§ÙˆÙŠÙ† IP
                  </h3>
                </div>
                <div className="max-h-[400px] overflow-y-auto">
                  {ipRules.map(rule => (
                    <div key={rule.id} className={`p-4 border-b border-slate-100 flex items-center justify-between ${rule.type === 'Blacklist' ? 'bg-red-50/50' : ''
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${rule.type === 'Whitelist' ? 'bg-emerald-100' : 'bg-red-100'
                          }`}>
                          {rule.type === 'Whitelist' ? (
                            <CheckCircle2 className="w-5 h-5 text-emerald-600" />
                          ) : (
                            <XCircle className="w-5 h-5 text-red-600" />
                          )}
                        </div>
                        <div>
                          <p className="font-mono font-bold text-slate-800">{rule.ipAddress}</p>
                          <p className="text-xs text-slate-500">{rule.description}</p>
                        </div> </div>
                      <span className={`px-2 py-1 rounded text-xs font-bold ${rule.type === 'Whitelist' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                        }`}>
                        {rule.type === 'Whitelist' ? 'Ù…Ø³Ù…ÙˆØ­' : 'Ù…Ø­Ø¸ÙˆØ±'}
                      </span> </div>
                  ))}
                </div> </div> </div> </div>
        )}

        {activeTab === 'audit' && (
          <div className="space-y-6">
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="bg-slate-800 px-6 py-4 flex items-center justify-between">
                <h2 className="text-lg font-black text-white flex items-center gap-2">
                  <History className="w-5 h-5 text-cyan-400" />
                  Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
                </h2>
                <span className="text-sm text-slate-400">{auditLogs.length} Ø³Ø¬Ù„</span>
              </div>
              {auditLogs.length === 0 ? (
                <div className="p-12 text-center text-slate-400">
                  <History className="w-16 h-16 mx-auto mb-4 opacity-30" />
                  <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
                  <p className="text-sm">Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù‡Ù†Ø§</p>
                </div>
              ) : (
                <div className="divide-y divide-slate-100 max-h-[600px] overflow-y-auto">
                  {auditLogs.slice(0, 50).map(log => (
                    <div key={log.id} className="px-6 py-4 hover:bg-slate-50">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                            <User className="w-4 h-4 text-purple-600" />
                          </div>
                          <div>
                            <p className="font-bold text-slate-800">{log.userName}</p>
                            <p className="text-xs text-slate-500">{log.module} â€¢ {log.entityType} â€¢ {log.entityId}</p>
                          </div> </div>
                        <div className="text-left">
                          <span className="text-xs text-slate-400">{new Date(log.timestamp).toLocaleString('ar-SA')}</span>
                          <p className="text-xs text-slate-400">{log.ip}</p>
                        </div> </div>
                      <div className="mr-11 flex items-center gap-2">
                        <span className={`px-2 py-1 rounded text-xs font-bold ${log.action.includes('CREATE') || log.action.includes('ACTIVATE') ? 'bg-emerald-100 text-emerald-700' :
                          log.action.includes('DEACTIVATE') || log.action.includes('DELETE') ? 'bg-red-100 text-red-700' :
                            'bg-blue-100 text-blue-700'
                          }`}>{log.action}</span>
                        {log.beforeSnapshot && log.afterSnapshot && (
                          <span className="text-xs text-slate-400">
                            {JSON.stringify(log.beforeSnapshot)} â†’ {JSON.stringify(log.afterSnapshot)}
                          </span>
                        )}
                      </div> </div>
                  ))}
                </div>
              )}
            </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          USER DETAILS MODAL - Full CRUD with Horizontal Layout
          Features: View, Edit, Delete, Role Assignment, Security Settings
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showUserDrawer && selectedUser && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setShowUserDrawer(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden max-h-[90vh] flex flex-col" onClick={e => e.stopPropagation()}>

            <div className="bg-gradient-to-l from-purple-600 via-indigo-600 to-blue-700 px-8 py-6 text-white shrink-0">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-5">
                  <div className="w-20 h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-4xl font-black">
                    {selectedUser.name.charAt(0)}
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">{selectedUser.name}</h2>
                    <p className="text-purple-200">{selectedUser.email}</p>
                    <div className="flex items-center gap-3 mt-2">
                      <span className="px-3 py-1 bg-white/20 rounded-lg text-sm">{selectedUser.jobTitle}</span>
                      <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedUser.status === 'Active' ? 'bg-emerald-400/30' : 'bg-red-400/30'
                        }`}>{selectedUser.status === 'Active' ? 'â— Ù†Ø´Ø·' : 'â—‹ Ù…Ø¹Ø·Ù„'}</span>
                    </div> </div> </div>
                <div className="flex items-center gap-3">
                  <button onClick={() => {
                    // Fill wizard with user data for editing
                    setWizardData({
                      fullNameAr: selectedUser.name || '', fullNameEn: selectedUser.nameEn || '', email: selectedUser.email || '',
                      employeeId: selectedUser.employeeId || '', nationalId: selectedUser.nationalId || '',
                      department: selectedUser.department || '', jobTitle: selectedUser.jobTitle || '',
                      managerId: selectedUser.managerId?.toString() || '', phone: selectedUser.phone || '',
                      status: selectedUser.status || 'Active',
                      scopeType: selectedUser.entityScope === 'TENANT-001' ? 'TENANT' :
                        selectedUser.siteScope ? 'SITE' :
                          selectedUser.buScope ? 'BU' : 'ENTITY',
                      selectedEntities: selectedUser.entityScope && selectedUser.entityScope !== 'TENANT-001' ? [selectedUser.entityScope] : [],
                      selectedBUs: selectedUser.buScope ? [selectedUser.buScope] : [],
                      selectedSites: selectedUser.siteScope ? [selectedUser.siteScope] : [],
                      selectedRoles: getUserRolesWithScope(selectedUser.id).map(ra => ra.roleId),
                      sessionPolicy: selectedUser.sessionPolicy || 'Standard', doaLevel: selectedUser.doaLevel || 'Medium',
                      requireMFA: selectedUser.mfaEnabled ?? true, accessExpiry: '',
                      notes: ''
                    });
                    setUserEditMode(true);
                    setEditingUserId(selectedUser.id);
                    setShowUserDrawer(false);
                    setShowCreateUserModal(true);
                    setWizardStep(0);
                  }} className="flex items-center gap-2 px-4 py-2 bg-white/20 rounded-xl hover:bg-white/30 transition-all">
                    <Edit className="w-5 h-5" />
                    <span className="font-bold">ØªØ¹Ø¯ÙŠÙ„</span>
                  </button>
                  <button onClick={() => {
                    if (window.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${selectedUser.name}"ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                      setUsers(prev => prev.filter(u => u.id !== selectedUser.id));
                      setRoleAssignments(prev => prev.filter(ra => ra.userId !== selectedUser.id));
                      logAction('DELETE_USER', 'IAM', 'USER', selectedUser.id, { name: selectedUser.name, email: selectedUser.email });
                      showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                      setShowUserDrawer(false);
                      setSelectedUser(null);
                    }
                  }} className="flex items-center gap-2 px-4 py-2 bg-red-500/30 rounded-xl hover:bg-red-500/50 transition-all">
                    <Trash2 className="w-5 h-5" />
                    <span className="font-bold">Ø­Ø°Ù</span>
                  </button>
                  <button onClick={() => setShowUserDrawer(false)} className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20">
                    <X className="w-6 h-6" />
                  </button> </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              <div className="grid grid-cols-3 gap-6">

                <div className="space-y-4">
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg">
                      <User className="w-5 h-5 text-purple-500" />
                      Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    </h3>
                    <div className="space-y-3">
                      <div className="flex justify-between py-2 border-b border-slate-100">
                        <span className="text-slate-500 text-sm">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</span>
                        <span className="font-bold text-slate-800">{selectedUser.name}</span>
                      </div>
                      <div className="flex justify-between py-2 border-b border-slate-100">
                        <span className="text-slate-500 text-sm">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                        <span className="font-bold text-slate-800 text-sm" dir="ltr">{selectedUser.email}</span>
                      </div>
                      <div className="flex justify-between py-2 border-b border-slate-100">
                        <span className="text-slate-500 text-sm">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</span>
                        <span className="font-bold text-slate-800">{selectedUser.jobTitle || 'â€”'}</span>
                      </div>
                      <div className="flex justify-between py-2 border-b border-slate-100">
                        <span className="text-slate-500 text-sm">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</span>
                        <span className="font-bold text-slate-800 font-mono">{selectedUser.employeeId || 'â€”'}</span>
                      </div>
                      <div className="flex justify-between py-2">
                        <span className="text-slate-500 text-sm">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</span>
                        <span className="font-bold text-slate-800" dir="ltr">{selectedUser.phone || 'â€”'}</span>
                      </div> </div> </div>
                  <div className="bg-purple-50 rounded-2xl border-2 border-purple-200 p-5">
                    <h3 className="font-bold text-purple-800 mb-4 flex items-center gap-2 text-lg">
                      <Building2 className="w-5 h-5 text-purple-500" />
                      Ù†Ø·Ø§Ù‚ Ø§Ù„ÙƒÙŠØ§Ù†
                    </h3>
                    <div className="space-y-3">
                      <div className="bg-white rounded-xl p-3">
                        <p className="text-xs text-slate-500 mb-1">Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
                        <p className="font-bold text-purple-700">{getUserScopeLabel(selectedUser)}</p>
                      </div>
                      {selectedUser.buScope && (
                        <div className="bg-white rounded-xl p-3">
                          <p className="text-xs text-slate-500 mb-1">ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</p>
                          <p className="font-bold text-blue-700">{getBUName(selectedUser.buScope)}</p>
                        </div>
                      )}
                      {selectedUser.siteScope && (
                        <div className="bg-white rounded-xl p-3">
                          <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„ÙØ±Ø¹</p>
                          <p className="font-bold text-amber-700">{getSiteName(selectedUser.siteScope)}</p>
                        </div>
                      )}
                    </div> </div> </div>
                <div className="space-y-4">
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg">
                      <Users className="w-5 h-5 text-blue-500" />
                      Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                    </h3>
                    {selectedUser.managerId ? (
                      <div className="flex items-center gap-4 bg-blue-50 rounded-xl p-4">
                        <div className="w-14 h-14 rounded-xl bg-blue-500 flex items-center justify-center text-white text-xl font-bold">
                          {users.find(u => u.id === selectedUser.managerId)?.name.charAt(0)}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800 text-lg">{users.find(u => u.id === selectedUser.managerId)?.name}</p>
                          <p className="text-slate-500">{users.find(u => u.id === selectedUser.managerId)?.jobTitle}</p>
                          <p className="text-xs text-blue-600 mt-1">{users.find(u => u.id === selectedUser.managerId)?.email}</p>
                        </div> </div>
                    ) : (
                      <div className="bg-slate-50 rounded-xl p-4 text-center">
                        <p className="text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¯ÙŠØ± Ù…Ø¨Ø§Ø´Ø±</p>
                        <p className="text-xs text-slate-400 mt-1">(Ù…Ø³ØªÙˆÙ‰ ØªÙ†ÙÙŠØ°ÙŠ Ø£Ø¹Ù„Ù‰)</p>
                      </div>
                    )}
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="font-bold text-slate-800 flex items-center gap-2 text-lg">
                        <Shield className="w-5 h-5 text-emerald-500" />
                        Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ÙØ³Ù†Ø¯Ø©
                      </h3>
                      <button onClick={() => {
                        setShowAssignmentModal(true);
                      }} className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold hover:bg-emerald-200">
                        + Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±
                      </button> </div>
                    <div className="space-y-2 max-h-[200px] overflow-y-auto">
                      {getUserRolesWithScope(selectedUser.id).length > 0 ? getUserRolesWithScope(selectedUser.id).map(ra => (
                        <div key={ra.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl group">
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${ra.role?.level === 0 ? 'bg-red-100' : ra.role?.level === 1 ? 'bg-amber-100' : 'bg-purple-100'
                            }`}>
                            <Shield className={`w-5 h-5 ${ra.role?.level === 0 ? 'text-red-600' : ra.role?.level === 1 ? 'text-amber-600' : 'text-purple-600'
                              }`} />
                          </div>
                          <div className="flex-1">
                            <p className="font-bold text-slate-800">{ra.role?.name}</p>
                            <p className="text-xs text-slate-500">
                              {ra.scopeType === 'TENANT' ? 'ğŸŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' :
                                ra.scopeType === 'ENTITY' ? `ğŸ›ï¸ ${getEntityName(ra.scopeId)}` :
                                  ra.scopeType === 'BU' ? `ğŸ“ ${getBUName(ra.scopeId)}` :
                                    `ğŸ“ ${getSiteName(ra.scopeId)}`}
                            </p> </div>
                          <button onClick={() => {
                            setRoleAssignments(prev => prev.filter(r => r.id !== ra.id));
                            logAction('REMOVE_ROLE_ASSIGNMENT', 'IAM', 'ROLE_ASSIGNMENT', ra.id, { userId: selectedUser.id, roleId: ra.roleId });
                            showNotification('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±');
                          }} className="p-2 opacity-0 group-hover:opacity-100 hover:bg-red-100 rounded-lg transition-all">
                            <Trash2 className="w-4 h-4 text-red-500" />
                          </button> </div>
                      )) : (
                        <div className="text-center py-6 text-slate-400">
                          <Shield className="w-10 h-10 mx-auto mb-2 opacity-30" />
                          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆØ§Ø± Ù…ÙØ³Ù†Ø¯Ø©</p>
                        </div>
                      )}
                    </div> </div> </div>
                <div className="space-y-4">
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg">
                      <Lock className="w-5 h-5 text-amber-500" />
                      Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ­Ù‚Ù‚
                    </h3>
                    <div className="space-y-3">
                      <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div className="flex items-center gap-2">
                          <Lock className="w-5 h-5 text-slate-400" />
                          <span className="text-slate-600">Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (MFA)</span>
                        </div>
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedUser.mfaEnabled ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                          }`}>
                          {selectedUser.mfaEnabled ? 'âœ“ Ù…ÙØ¹Ù‘Ù„' : 'âœ— Ù…Ø¹Ø·Ù„'}
                        </span> </div>
                      <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div className="flex items-center gap-2">
                          <Clock className="w-5 h-5 text-slate-400" />
                          <span className="text-slate-600">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„</span>
                        </div>
                        <span className="font-bold text-slate-700 text-sm">
                          {new Date(selectedUser.lastLogin).toLocaleDateString('ar-SA')}
                        </span> </div>
                      <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div className="flex items-center gap-2">
                          <Calendar className="w-5 h-5 text-slate-400" />
                          <span className="text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</span>
                        </div>
                        <span className="font-bold text-slate-700 text-sm">{selectedUser.createdAt}</span>
                      </div> </div> </div>
                  <div className="bg-slate-800 rounded-2xl p-5">
                    <h3 className="font-bold text-white mb-4 flex items-center gap-2 text-lg">
                      <Settings className="w-5 h-5 text-purple-400" />
                      Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
                    </h3>
                    <div className="space-y-2">
                      {selectedUser.status === 'Active' ? (
                        <button onClick={() => {
                          deactivateUser(selectedUser.id);
                          setSelectedUser({ ...selectedUser, status: 'Inactive' });
                        }} className="w-full flex items-center gap-3 px-4 py-3 bg-red-500/20 text-red-400 rounded-xl hover:bg-red-500/30 transition-all">
                          <UserX className="w-5 h-5" />
                          <span className="font-bold">ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                        </button>
                      ) : (
                        <button onClick={() => {
                          activateUser(selectedUser.id);
                          setSelectedUser({ ...selectedUser, status: 'Active' });
                        }} className="w-full flex items-center gap-3 px-4 py-3 bg-emerald-500/20 text-emerald-400 rounded-xl hover:bg-emerald-500/30 transition-all">
                          <UserCheck className="w-5 h-5" />
                          <span className="font-bold">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                        </button>
                      )}
                      <button onClick={() => {
                        resetMFA(selectedUser.id);
                      }} className="w-full flex items-center gap-3 px-4 py-3 bg-amber-500/20 text-amber-400 rounded-xl hover:bg-amber-500/30 transition-all">
                        <RotateCcw className="w-5 h-5" />
                        <span className="font-bold">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† MFA</span>
                      </button>
                      <button onClick={() => {
                        logAction('RESET_PASSWORD', 'IAM', 'USER', selectedUser.id, { email: selectedUser.email });
                        showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                      }} className="w-full flex items-center gap-3 px-4 py-3 bg-blue-500/20 text-blue-400 rounded-xl hover:bg-blue-500/30 transition-all">
                        <Lock className="w-5 h-5" />
                        <span className="font-bold">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
                      </button>
                      <button onClick={() => {
                        logAction('FORCE_LOGOUT', 'IAM', 'USER', selectedUser.id, { reason: 'Manual force logout' });
                        showNotification('âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©');
                      }} className="w-full flex items-center gap-3 px-4 py-3 bg-purple-500/20 text-purple-400 rounded-xl hover:bg-purple-500/30 transition-all">
                        <LogOut className="w-5 h-5" />
                        <span className="font-bold">Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</span>
                      </button> </div> </div> </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-2 text-sm text-slate-500">
                <Clock className="w-4 h-4" />
                Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {new Date().toLocaleString('ar-SA')}
              </div>
              <button onClick={() => setShowUserDrawer(false)}
                className="px-6 py-2 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300">
                Ø¥ØºÙ„Ø§Ù‚
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          BANK-GRADE USER CREATION WIZARD - World-Class Enterprise IAM
          Features: 3-Step Flow, SoD Live Validator, Permission Preview, Saudi-Ready
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showCreateUserModal && (
        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl overflow-hidden max-h-[93vh] flex flex-col">

            <div className={`px-8 py-5 text-white shrink-0 ${userEditMode
              ? 'bg-gradient-to-l from-amber-500 via-orange-500 to-red-500'
              : 'bg-gradient-to-l from-purple-600 via-indigo-600 to-blue-700'
              }`}>
              <div className="flex items-center justify-between mb-5">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                    {userEditMode ? <Edit className="w-7 h-7" /> : <Users className="w-7 h-7" />}
                  </div>
                  <div>
                    <h2 className="text-2xl font-black">{userEditMode ? 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…'}</h2>
                    <p className={userEditMode ? 'text-amber-100' : 'text-purple-200'}>
                      {userEditMode ? 'Edit User Information Wizard' : 'Bank-Grade Identity Onboarding Wizard'}
                    </p> </div> </div>
                <button onClick={() => { setShowCreateUserModal(false); setWizardStep(0); setUserEditMode(false); setEditingUserId(null); }}
                  className="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 transition-all">
                  <X className="w-6 h-6" />
                </button> </div>
              <div className="flex items-center gap-2">
                {[
                  { step: 0, label: 'Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ØªÙˆØ¸ÙŠÙ', labelEn: 'Identity', icon: User },
                  { step: 1, label: 'Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ÙƒÙŠØ§Ù†Ø§Øª', labelEn: 'Scope', icon: Building2 },
                  { step: 2, label: 'Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ…', labelEn: 'Access', icon: Shield },
                  { step: 3, label: 'Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„', labelEn: 'Security', icon: Lock },
                  { step: 4, label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯', labelEn: 'Review', icon: CheckCircle2 },
                ].map((s, idx) => (
                  <React.Fragment key={s.step}>
                    <button onClick={() => { if (wizardStep > s.step || validateWizardStep(wizardStep)) setWizardStep(s.step); }}
                      className={`flex items-center gap-2 px-3 py-2.5 rounded-xl font-bold transition-all flex-1 ${wizardStep === s.step
                        ? `bg-white ${userEditMode ? 'text-amber-700' : 'text-purple-700'} shadow-lg scale-[1.02]`
                        : wizardStep > s.step ? 'bg-emerald-400/30 text-white' : 'bg-white/10 text-white/70'
                        }`}>
                      <div className={`w-7 h-7 rounded-lg flex items-center justify-center flex-shrink-0 ${wizardStep === s.step
                        ? (userEditMode ? 'bg-amber-100' : 'bg-purple-100')
                        : wizardStep > s.step ? 'bg-emerald-500' : 'bg-white/20'
                        }`}>
                        {wizardStep > s.step ? <Check className="w-4 h-4 text-white" /> : <s.icon className="w-4 h-4" />}
                      </div>
                      <div className="text-right min-w-0">
                        <p className="text-xs font-bold truncate">{s.label}</p>
                        <p className="text-[10px] opacity-70">{s.labelEn}</p>
                      </div> </button>
                    {idx < 4 && <ChevronLeft className="w-4 h-4 text-white/30 flex-shrink-0" />}
                  </React.Fragment>
                ))}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-8">

              {wizardStep === 0 && (
                <div className="space-y-5">
                  <div className={`rounded-2xl p-4 border ${userEditMode
                    ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200'
                    : 'bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-200'
                    }`}>
                    <div className="flex items-center gap-3">
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${userEditMode ? 'bg-amber-500' : 'bg-purple-500'}`}>
                        <User className="w-5 h-5 text-white" />
                      </div>
                      <div>
                        <h3 className={`font-bold ${userEditMode ? 'text-amber-900' : 'text-purple-900'}`}>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ØªÙˆØ¸ÙŠÙ</h3>
                        <p className={`text-sm ${userEditMode ? 'text-amber-600' : 'text-purple-600'}`}>Identity & Employment Information</p>
                      </div> </div> </div>
                  <div>
                    <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3">
                      <span className="w-2 h-2 rounded-full bg-red-500"></span>
                      Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ *
                    </label>
                    <div className="grid grid-cols-5 gap-3">
                      {EMPLOYMENT_TYPES.map(type => (
                        <button key={type.code}
                          onClick={() => setWizardData({ ...wizardData, employmentType: type.code })}
                          className={`p-3 rounded-xl border-2 text-center transition-all ${wizardData.employmentType === type.code
                            ? `border-${type.color}-500 bg-${type.color}-50 shadow-md`
                            : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <span className="text-2xl block mb-1">{type.icon}</span>
                          <p className="font-bold text-slate-800 text-xs">{type.label}</p>
                          <p className="text-[10px] text-slate-500">{type.labelEn}</p>
                        </button>
                      ))}
                    </div> </div>
                  <div className="grid grid-cols-2 gap-5">
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ø¹Ø±Ø¨ÙŠ) *
                      </label>
                      <input type="text" value={wizardData.fullNameAr}
                        onChange={(e) => setWizardData({ ...wizardData, fullNameAr: e.target.value })}
                        className={`w-full px-4 py-3 border-2 rounded-xl transition-all ${wizardErrors.fullNameAr ? 'border-red-400 bg-red-50' : 'border-slate-200 focus:border-purple-500'
                          }`}
                        placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ..." dir="rtl" />
                      {wizardErrors.fullNameAr && <p className="text-red-500 text-xs mt-1">{wizardErrors.fullNameAr}</p>}
                    </div>
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                      <input type="text" value={wizardData.fullNameEn}
                        onChange={(e) => setWizardData({ ...wizardData, fullNameEn: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                        placeholder="Full Name in English..." dir="ltr" />
                    </div> </div>
                  <div className="grid grid-cols-3 gap-5">
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label>
                      <select value={wizardData.nationality}
                        onChange={(e) => {
                          const nat = e.target.value;
                          const defaultId = nat === 'SA' ? 'SA_ID' : nat === 'EG' ? 'EG_ID' : ['AE', 'BH', 'KW', 'OM', 'QA'].includes(nat) ? 'GCC_ID' : 'PASSPORT';
                          setWizardData({ ...wizardData, nationality: nat, idType: defaultId });
                        }}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500">
                        {NATIONALITIES.map(n => (
                          <option key={n.code} value={n.code}>{n.flag} {n.label} - {n.labelEn}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                      <select value={wizardData.idType}
                        onChange={(e) => setWizardData({ ...wizardData, idType: e.target.value, nationalId: '' })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500">
                        {ID_TYPES.filter(t => t.countries.includes('ALL') || t.countries.includes(wizardData.nationality)).map(t => (
                          <option key={t.code} value={t.code}>{t.label}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">
                        {ID_TYPES.find(t => t.code === wizardData.idType)?.label || 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©'}
                      </label>
                      <input type="text" value={wizardData.nationalId}
                        onChange={(e) => setWizardData({ ...wizardData, nationalId: e.target.value })}
                        className={`w-full px-4 py-3 border-2 rounded-xl transition-all ${wizardErrors.nationalId ? 'border-red-400 bg-red-50' : 'border-slate-200 focus:border-purple-500'
                          }`}
                        placeholder={ID_TYPES.find(t => t.code === wizardData.idType)?.placeholder} dir="ltr" />
                      {wizardErrors.nationalId && <p className="text-red-500 text-xs mt-1">{wizardErrors.nationalId}</p>}
                    </div> </div>
                  <div className="grid grid-cols-3 gap-5">
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *
                      </label>
                      <div className="relative">
                        <input type="email" value={wizardData.email}
                          onChange={(e) => setWizardData({ ...wizardData, email: e.target.value })}
                          className={`w-full px-4 py-3 border-2 rounded-xl transition-all ${wizardErrors.email ? 'border-red-400 bg-red-50' : 'border-slate-200 focus:border-purple-500'}`}
                          placeholder="user@company.sa" dir="ltr" />
                        {wizardData.email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(wizardData.email) && (
                          <CheckCircle2 className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-emerald-500" />
                        )}
                      </div>
                      {wizardErrors.email && <p className="text-red-500 text-xs mt-1">{wizardErrors.email}</p>}
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ù‡Ø§ØªÙ</label>
                      <input type="tel" value={wizardData.phone}
                        onChange={(e) => setWizardData({ ...wizardData, phone: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                        placeholder="+966 5XX XXX XXXX" dir="ltr" />
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                      <input type="text" value={wizardData.employeeId}
                        onChange={(e) => setWizardData({ ...wizardData, employeeId: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                        placeholder="EMP-XXXX" dir="ltr" />
                    </div> </div>
                  <div className="grid grid-cols-3 gap-5">
                    <div>
                      <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-2">
                        <span className="w-2 h-2 rounded-full bg-red-500"></span>
                        Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© *
                      </label>
                      <select value={wizardData.department}
                        onChange={(e) => setWizardData({ ...wizardData, department: e.target.value })}
                        className={`w-full px-4 py-3 border-2 rounded-xl ${wizardErrors.department ? 'border-red-400 bg-red-50' : 'border-slate-200 focus:border-purple-500'}`}>
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
                        {DEPARTMENTS.map(d => <option key={d.id} value={d.id}>{d.name} ({d.nameEn})</option>)}
                      </select>
                      {wizardErrors.department && <p className="text-red-500 text-xs mt-1">{wizardErrors.department}</p>}
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                      <input type="text" value={wizardData.jobTitle}
                        onChange={(e) => setWizardData({ ...wizardData, jobTitle: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                        placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ..." />
                    </div>
                    <div>
                      <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label>
                      <div className="relative">
                        <input type="text" value={managerSearch}
                          onChange={(e) => { setManagerSearch(e.target.value); setShowManagerDropdown(true); }}
                          onFocus={() => setShowManagerDropdown(true)}
                          className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500"
                          placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯ÙŠØ±..." />
                        {showManagerDropdown && managerSearch && (
                          <div className="absolute top-full right-0 left-0 bg-white border-2 border-slate-200 rounded-xl mt-1 shadow-xl z-10 max-h-40 overflow-auto">
                            {users.filter(u => u.name.includes(managerSearch) || (u.email && u.email.includes(managerSearch))).map(u => (
                              <button key={u.id} onClick={() => { setWizardData({ ...wizardData, managerId: u.id }); setManagerSearch(u.name); setShowManagerDropdown(false); }}
                                className="w-full text-right px-4 py-2 hover:bg-purple-50 flex items-center gap-2 text-sm">
                                <div className="w-7 h-7 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600 font-bold text-xs">{u.name[0]}</div>
                                <div><p className="font-bold text-slate-800">{u.name}</p><p className="text-[10px] text-slate-500">{u.jobTitle}</p></div>
                              </button>
                            ))}
                          </div>
                        )}
                      </div> </div> </div>
                  {wizardData.employmentType === 'Vendor' && (
                    <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4">
                      <div className="flex items-start gap-3">
                        <AlertTriangle className="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" />
                        <div className="flex-1">
                          <p className="font-bold text-amber-800 text-sm">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ±Ø¯ / Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«</p>
                          <p className="text-amber-700 text-xs mt-1">ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª SAMA Ùˆ NCAØŒ ÙŠØ¬Ø¨ ØªÙˆÙ‚ÙŠØ¹ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¹Ø¯Ù… Ø§Ù„Ø¥ÙØµØ§Ø­ (NDA) ÙˆØ§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø£Ù…Ù†ÙŠ Ù‚Ø¨Ù„ Ù…Ù†Ø­ Ø§Ù„ÙˆØµÙˆÙ„.</p>
                          <div className="flex gap-4 mt-3">
                            <button onClick={() => setWizardData({ ...wizardData, ndaSigned: !wizardData.ndaSigned })}
                              className={`flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-sm font-bold transition-all ${wizardData.ndaSigned ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-300 text-slate-600'
                                }`}>
                              {wizardData.ndaSigned ? <CheckCircle2 className="w-4 h-4" /> : <Square className="w-4 h-4" />}
                              NDA Ù…ÙˆÙ‚Ø¹Ø©
                            </button>
                            <button onClick={() => setWizardData({ ...wizardData, securityTrainingCompleted: !wizardData.securityTrainingCompleted })}
                              className={`flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-sm font-bold transition-all ${wizardData.securityTrainingCompleted ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-300 text-slate-600'
                                }`}>
                              {wizardData.securityTrainingCompleted ? <CheckCircle2 className="w-4 h-4" /> : <Square className="w-4 h-4" />}
                              ØªØ¯Ø±ÙŠØ¨ Ø£Ù…Ù†ÙŠ
                            </button> </div> </div> </div> </div>
                  )}
                </div>
              )}

              {wizardStep === 1 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-4 border border-blue-200">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center"><Building2 className="w-5 h-5 text-white" /></div>
                      <div><h3 className="font-bold text-blue-900">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„ÙƒÙŠØ§Ù†Ø§Øª</h3><p className="text-sm text-blue-600">Entity Scope & Access Boundaries</p></div>
                    </div> </div>
                  <div>
                    <label className="text-sm font-bold text-slate-700 mb-3 block">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø·Ø§Ù‚</label>
                    <div className="grid grid-cols-4 gap-4">
                      {[{ type: 'GROUP', label: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', sub: 'ÙƒÙ„ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª', icon: Globe }, { type: 'ENTITY', label: 'ÙƒÙŠØ§Ù† Ù‚Ø§Ù†ÙˆÙ†ÙŠ', sub: 'Ø´Ø±ÙƒØ© Ù…Ø­Ø¯Ø¯Ø©', icon: Building2 }, { type: 'BU', label: 'ÙˆØ­Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„', sub: 'Ù‚Ø³Ù… Ø¯Ø§Ø®Ù„ÙŠ', icon: Briefcase }, { type: 'SITE', label: 'Ù…ÙˆÙ‚Ø¹/ÙØ±Ø¹', sub: 'Ù…ÙƒØ§Ù† Ù…Ø­Ø¯Ø¯', icon: MapPin }].map(scope => (
                        <button key={scope.type} onClick={() => setWizardData({ ...wizardData, scopeType: scope.type === 'GROUP' ? 'TENANT' : scope.type, selectedEntities: [], selectedBUs: [], selectedSites: [] })}
                          className={`p-4 rounded-xl border-2 text-center transition-all ${(wizardData.scopeType === scope.type || (scope.type === 'GROUP' && wizardData.scopeType === 'TENANT')) ? 'border-blue-500 bg-blue-50 shadow-lg' : 'border-slate-200 hover:border-slate-300'}`}>
                          <scope.icon className={`w-7 h-7 mx-auto mb-2 ${(wizardData.scopeType === scope.type || (scope.type === 'GROUP' && wizardData.scopeType === 'TENANT')) ? 'text-blue-600' : 'text-slate-400'}`} />
                          <p className="font-bold text-slate-800 text-sm">{scope.label}</p>
                          <p className="text-[10px] text-slate-500">{scope.sub}</p>
                        </button>
                      ))}
                    </div> </div>
                  {wizardData.scopeType === 'ENTITY' && (<div>
                    <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3"><span className="w-2 h-2 rounded-full bg-red-500"></span>Ø§Ø®ØªØ± Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© *</label>
                    <div className="grid grid-cols-2 gap-4">
                      {legalEntities.map(entity => (<button key={entity.id} onClick={() => { const sel = wizardData.selectedEntities.includes(entity.id) ? wizardData.selectedEntities.filter(e => e !== entity.id) : [...wizardData.selectedEntities, entity.id]; setWizardData({ ...wizardData, selectedEntities: sel }); }}
                        className={`p-4 rounded-xl border-2 text-right transition-all ${wizardData.selectedEntities.includes(entity.id) ? 'border-blue-500 bg-blue-50 shadow-lg' : 'border-slate-200 hover:border-blue-300'}`}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-3">
                            <div className={`w-11 h-11 rounded-xl flex items-center justify-center ${entity.type === 'Bank' ? 'bg-emerald-100' : entity.type === 'Investment' ? 'bg-blue-100' : entity.type === 'Insurance' ? 'bg-amber-100' : 'bg-purple-100'}`}><Building2 className="w-5 h-5" /></div>
                            <div><p className="font-bold text-slate-800">{entity.name}</p><p className="text-xs text-slate-500">{entity.nameEn}</p><p className="text-[10px] text-slate-400 mt-0.5">{entity.regulator}</p></div>
                          </div>
                          {wizardData.selectedEntities.includes(entity.id) && <div className="w-8 h-8 rounded-lg bg-blue-500 flex items-center justify-center"><Check className="w-5 h-5 text-white" /></div>}
                        </div>
                      </button>))}
                    </div>
                    {wizardErrors.scope && <p className="text-red-500 text-sm mt-2">{wizardErrors.scope}</p>}
                  </div>)}
                  {wizardData.scopeType === 'BU' && (<div>
                    <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3"><span className="w-2 h-2 rounded-full bg-red-500"></span>Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ *</label>
                    <div className="grid grid-cols-3 gap-3">{businessUnits.map(bu => (<button key={bu.id} onClick={() => { const sel = wizardData.selectedBUs.includes(bu.id) ? wizardData.selectedBUs.filter(b => b !== bu.id) : [...wizardData.selectedBUs, bu.id]; setWizardData({ ...wizardData, selectedBUs: sel }); }}
                      className={`p-3 rounded-xl border-2 text-right transition-all ${wizardData.selectedBUs.includes(bu.id) ? 'border-teal-500 bg-teal-50' : 'border-slate-200 hover:border-teal-300'}`}>
                      <div className="flex items-center gap-2"><div className={`w-8 h-8 rounded-lg flex items-center justify-center ${wizardData.selectedBUs.includes(bu.id) ? 'bg-teal-500' : 'bg-slate-200'}`}>{wizardData.selectedBUs.includes(bu.id) ? <Check className="w-4 h-4 text-white" /> : <Briefcase className="w-4 h-4 text-slate-500" />}</div><div><p className="font-bold text-slate-800 text-sm">{bu.name}</p><p className="text-xs text-slate-500">{bu.nameEn}</p></div></div>
                    </button>))}</div>
                    {wizardErrors.scope && <p className="text-red-500 text-sm mt-2">{wizardErrors.scope}</p>}
                  </div>)}
                  {wizardData.scopeType === 'SITE' && (<div>
                    <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3"><span className="w-2 h-2 rounded-full bg-red-500"></span>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ *</label>
                    <div className="grid grid-cols-2 gap-3">{sites.map(site => (<button key={site.id} onClick={() => { const sel = wizardData.selectedSites.includes(site.id) ? wizardData.selectedSites.filter(s => s !== site.id) : [...wizardData.selectedSites, site.id]; setWizardData({ ...wizardData, selectedSites: sel }); }}
                      className={`p-3 rounded-xl border-2 text-right transition-all ${wizardData.selectedSites.includes(site.id) ? 'border-amber-500 bg-amber-50' : 'border-slate-200 hover:border-amber-300'}`}>
                      <div className="flex items-center gap-2"><div className={`w-8 h-8 rounded-lg flex items-center justify-center ${wizardData.selectedSites.includes(site.id) ? 'bg-amber-500' : 'bg-slate-200'}`}>{wizardData.selectedSites.includes(site.id) ? <Check className="w-4 h-4 text-white" /> : <MapPin className="w-4 h-4 text-slate-500" />}</div><div><p className="font-bold text-slate-800 text-sm">{site.name}</p><p className="text-xs text-slate-500">{site.city}</p></div></div>
                    </button>))}</div>
                    {wizardErrors.scope && <p className="text-red-500 text-sm mt-2">{wizardErrors.scope}</p>}
                  </div>)}
                  <div>
                    <label className="text-sm font-bold text-slate-700 mb-3 block">Ù…Ø³ØªÙˆÙ‰ ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­</label>
                    <div className="grid grid-cols-5 gap-3">
                      {DATA_CLASSIFICATIONS.map(dc => (<button key={dc.code} onClick={() => setWizardData({ ...wizardData, dataClassificationAccess: dc.code })} className={`p-3 rounded-xl border-2 text-center transition-all ${wizardData.dataClassificationAccess === dc.code ? 'border-blue-500 bg-blue-50 shadow-md' : 'border-slate-200 hover:border-slate-300'}`}><span className="text-xl block mb-1">{dc.icon}</span><p className="font-bold text-slate-800 text-xs">{dc.label}</p><p className="text-[10px] text-slate-500">{dc.labelEn}</p></button>))}
                    </div> </div>
                  <div>
                    <label className="text-sm font-bold text-slate-700 mb-3 block">Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠ</label>
                    <div className="grid grid-cols-4 gap-3">
                      {REGULATORY_SCOPES.map(reg => (<button key={reg.code} onClick={() => { const sel = wizardData.regulatoryScope.includes(reg.code) ? wizardData.regulatoryScope.filter(r => r !== reg.code) : [...wizardData.regulatoryScope, reg.code]; setWizardData({ ...wizardData, regulatoryScope: sel }); }}
                        className={`p-2 rounded-lg border-2 text-right transition-all flex items-center gap-2 ${wizardData.regulatoryScope.includes(reg.code) ? 'border-indigo-500 bg-indigo-50' : 'border-slate-200 hover:border-slate-300'}`}>
                        <span className="text-lg">{reg.flag}</span><div className="min-w-0 flex-1"><p className="font-bold text-slate-800 text-xs truncate">{reg.code}</p><p className="text-[10px] text-slate-500 truncate">{reg.label}</p></div>
                        {wizardData.regulatoryScope.includes(reg.code) && <Check className="w-4 h-4 text-emerald-600 flex-shrink-0" />}
                      </button>))}
                    </div> </div>
                  <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2"><Eye className="w-4 h-4" />Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†Ø·Ø§Ù‚</h4>
                    <div className="flex flex-wrap gap-2">
                      {wizardData.scopeType === 'TENANT' && <span className="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold text-sm">ğŸ¢ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</span>}
                      {wizardData.selectedEntities.map(id => <span key={id} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg font-bold text-sm">ğŸ›ï¸ {legalEntities.find(e => e.id === id)?.name}</span>)}
                      {wizardData.selectedBUs.map(id => <span key={id} className="px-3 py-1.5 bg-teal-100 text-teal-700 rounded-lg font-bold text-sm">ğŸ“ {businessUnits.find(b => b.id === id)?.name}</span>)}
                      {wizardData.selectedSites.map(id => <span key={id} className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg font-bold text-sm">ğŸ“ {sites.find(s => s.id === id)?.name}</span>)}
                      {wizardData.scopeType !== 'TENANT' && wizardData.selectedEntities.length === 0 && wizardData.selectedBUs.length === 0 && wizardData.selectedSites.length === 0 && <span className="text-slate-500 text-sm">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù†Ø·Ø§Ù‚</span>}
                    </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-4 border border-emerald-200">
                    <div className="flex items-center gap-3"><div className="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center"><Shield className="w-5 h-5 text-white" /></div><div><h3 className="font-bold text-emerald-900">Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ…</h3><p className="text-sm text-emerald-600">Access Controls & Role Assignment</p></div></div>
                  </div>
                  <div className="grid grid-cols-12 gap-5">
                    <div className="col-span-8 space-y-4">
                      <div className="bg-white rounded-xl border-2 border-slate-200 p-4">
                        <label className="flex items-center gap-2 text-sm font-bold text-slate-700 mb-3"><span className="w-2 h-2 rounded-full bg-red-500"></span>Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± *</label>
                        <div className="grid grid-cols-3 gap-3">{roles.map(role => (<button key={role.id} onClick={() => { const sel = wizardData.selectedRoles.includes(role.id) ? wizardData.selectedRoles.filter(r => r !== role.id) : [...wizardData.selectedRoles, role.id]; setWizardData({ ...wizardData, selectedRoles: sel }); }}
                          className={`p-3 rounded-xl border-2 text-right transition-all ${wizardData.selectedRoles.includes(role.id) ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 hover:border-emerald-300'}`}>
                          <div className="flex items-center gap-2"><div className={`w-8 h-8 rounded-lg flex items-center justify-center ${wizardData.selectedRoles.includes(role.id) ? 'bg-emerald-500' : role.level === 0 ? 'bg-red-100' : role.level === 1 ? 'bg-amber-100' : 'bg-slate-100'}`}>{wizardData.selectedRoles.includes(role.id) ? <Check className="w-4 h-4 text-white" /> : <Shield className={`w-4 h-4 ${role.level === 0 ? 'text-red-600' : role.level === 1 ? 'text-amber-600' : 'text-slate-600'}`} />}</div>
                            <div className="flex-1 min-w-0"><div className="flex items-center justify-between gap-1"><p className="font-bold text-slate-800 text-sm truncate">{role.name}</p><span className={`px-1.5 py-0.5 rounded text-[10px] font-bold ${role.level === 0 ? 'bg-red-100 text-red-700' : role.level === 1 ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-600'}`}>L{role.level}</span></div><p className="text-[10px] text-slate-500 truncate">{role.nameEn}</p></div></div>
                        </button>))}</div>
                        {wizardErrors.roles && <p className="text-red-500 text-sm mt-2">{wizardErrors.roles}</p>}
                      </div>
                      {checkWizardSoD().length > 0 && (<div className="bg-red-50 rounded-xl p-3 border-2 border-red-200"><div className="flex items-center gap-2 mb-2"><AlertTriangle className="w-4 h-4 text-red-500" /><h4 className="font-bold text-red-700 text-sm">âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª ÙØµÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (SoD)</h4></div>
                        <div className="grid grid-cols-2 gap-2">{checkWizardSoD().map((c, i) => (<div key={i} className={`p-2 rounded-lg ${c.severity === 'Critical' ? 'bg-red-100' : 'bg-amber-100'}`}><div className="flex items-center justify-between mb-1"><span className={`px-1.5 py-0.5 rounded text-[10px] font-bold ${c.severity === 'Critical' ? 'bg-red-500 text-white' : 'bg-amber-500 text-white'}`}>{c.severity}</span><span className="text-[10px] text-slate-500">{c.rule}</span></div><p className="font-bold text-slate-800 text-xs">{c.message}</p><p className="text-[10px] text-slate-600">ğŸ’¡ {c.fix}</p></div>))}</div>
                      </div>)}
                    </div>
                    <div className="col-span-4">
                      <div className="bg-slate-800 rounded-2xl p-4 text-white sticky top-4"><h4 className="font-bold text-sm mb-3 flex items-center gap-2"><Eye className="w-4 h-4 text-purple-400" />Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h4>
                        {wizardData.selectedRoles.length === 0 ? (<div className="text-center py-6 text-slate-400"><Shield className="w-8 h-8 mx-auto mb-2 opacity-50" /><p className="text-xs">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p></div>) : (<div className="space-y-2 max-h-80 overflow-y-auto">{Object.entries(getWizardPermissionPreview()).map(([mod, acts]) => (<div key={mod} className="bg-slate-700 rounded-lg p-2"><p className="font-bold text-purple-300 text-xs mb-1">{mod === 'OBLIGATIONS' ? 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª' : mod === 'EVIDENCE' ? 'Ø§Ù„Ø£Ø¯Ù„Ø©' : mod === 'TESTING' ? 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª' : mod === 'BREACHES' ? 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª' : mod === 'INSPECTIONS' ? 'Ø§Ù„ØªÙØªÙŠØ´' : mod === 'COMMUNICATIONS' ? 'Ø§Ù„ØªÙˆØ§ØµÙ„' : mod === 'IAM' ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©' : mod}</p><div className="flex flex-wrap gap-1">{Object.entries(acts).filter(([_, v]) => v).map(([a]) => (<span key={a} className="px-1.5 py-0.5 bg-slate-600 rounded text-[10px]">{a === 'VIEW' ? 'Ø¹Ø±Ø¶' : a === 'CREATE' ? 'Ø¥Ù†Ø´Ø§Ø¡' : a === 'EDIT' ? 'ØªØ¹Ø¯ÙŠÙ„' : a === 'APPROVE' ? 'Ø§Ø¹ØªÙ…Ø§Ø¯' : a === 'EXPORT' ? 'ØªØµØ¯ÙŠØ±' : a}</span>))}</div></div>))}</div>)}
                      </div> </div> </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-4 border border-red-200">
                    <div className="flex items-center gap-3"><div className="w-10 h-10 rounded-xl bg-red-500 flex items-center justify-center"><Lock className="w-5 h-5 text-white" /></div><div><h3 className="font-bold text-red-900">Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„</h3><p className="text-sm text-red-600">Security Controls & Compliance</p></div></div>
                  </div>
                  <div className="grid grid-cols-2 gap-5">
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-4 space-y-4">
                      <h4 className="font-bold text-slate-800 flex items-center gap-2 text-sm"><Shield className="w-4 h-4 text-purple-500" />Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚</h4>
                      <div className="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-200">
                        <div className="flex items-center gap-3"><Lock className={`w-5 h-5 ${wizardData.requireMFA ? 'text-emerald-600' : 'text-slate-400'}`} /><div><p className="font-bold text-slate-800 text-sm">Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ (MFA)</p><p className="text-[10px] text-slate-500">Ù…Ø·Ù„ÙˆØ¨ Ø¨Ù…ÙˆØ¬Ø¨ NCA-ECC Ùˆ SAMA-CSF</p></div></div>
                        <button onClick={() => setWizardData({ ...wizardData, requireMFA: !wizardData.requireMFA })} className={`w-12 h-6 rounded-full transition-all flex-shrink-0 ${wizardData.requireMFA ? 'bg-emerald-500' : 'bg-slate-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${wizardData.requireMFA ? 'mr-0.5' : 'mr-6'}`} /></button>
                      </div>
                      {wizardData.requireMFA && <div><label className="text-xs font-bold text-slate-600 mb-2 block">Ø·Ø±ÙŠÙ‚Ø© MFA</label><div className="grid grid-cols-2 gap-2">{[{ c: 'APP', l: 'ØªØ·Ø¨ÙŠÙ‚ Ù…ØµØ§Ø¯Ù‚Ø©', i: 'ğŸ“±' }, { c: 'SMS', l: 'Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©', i: 'ğŸ’¬' }, { c: 'EMAIL', l: 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', i: 'ğŸ“§' }, { c: 'HARDWARE', l: 'Ù…ÙØªØ§Ø­ Ø£Ù…Ø§Ù†', i: 'ğŸ”‘' }].map(m => (<button key={m.c} onClick={() => setWizardData({ ...wizardData, mfaMethod: m.c })} className={`p-2 rounded-lg border-2 text-center text-sm font-bold transition-all ${wizardData.mfaMethod === m.c ? 'border-purple-500 bg-purple-50' : 'border-slate-200'}`}>{m.i} {m.l}</button>))}</div></div>}
                      {wizardErrors.mfa && <p className="text-red-500 text-xs">{wizardErrors.mfa}</p>}
                      <div><label className="text-xs font-bold text-slate-600 mb-2 block">Ø³ÙŠØ§Ø³Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><select value={wizardData.passwordPolicy} onChange={e => setWizardData({ ...wizardData, passwordPolicy: e.target.value })} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg text-sm"><option value="Standard">Ù‚ÙŠØ§Ø³ÙŠØ© (8+ Ø£Ø­Ø±Ù)</option><option value="Enhanced">Ù…Ø¹Ø²Ø²Ø© (12+ Ø£Ø­Ø±Ù)</option><option value="Critical">Ø­Ø±Ø¬Ø© (16+ Ø£Ø­Ø±Ù)</option></select></div>
                    </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-4 space-y-4">
                      <h4 className="font-bold text-slate-800 flex items-center gap-2 text-sm"><Clock className="w-4 h-4 text-blue-500" />Ø§Ù„Ø¬Ù„Ø³Ø© ÙˆØ³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„</h4>
                      <div><label className="text-xs font-bold text-slate-600 mb-2 block">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</label><select value={wizardData.sessionPolicy} onChange={e => setWizardData({ ...wizardData, sessionPolicy: e.target.value })} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg text-sm"><option value="Relaxed">Ù…Ø±Ù†Ø© (8 Ø³Ø§Ø¹Ø§Øª)</option><option value="Standard">Ù‚ÙŠØ§Ø³ÙŠØ© (4 Ø³Ø§Ø¹Ø§Øª)</option><option value="Strict">ØµØ§Ø±Ù…Ø© (Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©)</option></select></div>
                      <div><label className="text-xs font-bold text-slate-600 mb-2 block">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ DOA</label><select value={wizardData.doaLevel} onChange={e => setWizardData({ ...wizardData, doaLevel: e.target.value })} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg text-sm"><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Critical">Ø­Ø±Ø¬</option></select></div>
                      <div><label className="text-xs font-bold text-slate-600 mb-2 block">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label><input type="date" value={wizardData.accessExpiry} onChange={e => setWizardData({ ...wizardData, accessExpiry: e.target.value })} className="w-full px-3 py-2.5 border-2 border-slate-200 rounded-lg text-sm" />{wizardErrors.expiry && <p className="text-red-500 text-xs mt-1">{wizardErrors.expiry}</p>}</div>
                      <div className="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-200"><div><p className="font-bold text-slate-800 text-sm">VPN Ù…Ø·Ù„ÙˆØ¨</p><p className="text-[10px] text-slate-500">Ø´Ø¨ÙƒØ© Ø¢Ù…Ù†Ø© ÙÙ‚Ø·</p></div><button onClick={() => setWizardData({ ...wizardData, vpnRequired: !wizardData.vpnRequired })} className={`w-12 h-6 rounded-full transition-all flex-shrink-0 ${wizardData.vpnRequired ? 'bg-emerald-500' : 'bg-slate-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-all ${wizardData.vpnRequired ? 'mr-0.5' : 'mr-6'}`} /></button></div>
                    </div> </div>
                  <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-200">
                    <h4 className="font-bold text-indigo-900 flex items-center gap-2 text-sm mb-3"><FileCheck className="w-4 h-4" />Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h4>
                    <div className="grid grid-cols-2 gap-3">
                      {[{ k: 'complianceAcknowledgment', l: 'Ø¥Ù‚Ø±Ø§Ø± Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', d: 'SAMA Compliance Framework', i: 'ğŸ“œ' }, { k: 'ndaSigned', l: 'Ø§ØªÙØ§Ù‚ÙŠØ© Ø¹Ø¯Ù… Ø§Ù„Ø¥ÙØµØ§Ø­', d: 'NDA', i: 'ğŸ”’' }, { k: 'securityTrainingCompleted', l: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ', d: 'NCA-ECC', i: 'ğŸ“' }, { k: 'dataProtectionTraining', l: 'ØªØ¯Ø±ÙŠØ¨ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', d: 'PDPL / SDAIA', i: 'ğŸ›¡ï¸' }].map(ack => (<button key={ack.k} onClick={() => setWizardData({ ...wizardData, [ack.k]: !wizardData[ack.k] })}
                        className={`p-3 rounded-lg border-2 text-right transition-all flex items-center gap-3 ${wizardData[ack.k] ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 hover:border-slate-300'}`}>
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${wizardData[ack.k] ? 'bg-emerald-500' : 'bg-slate-200'}`}>{wizardData[ack.k] ? <Check className="w-4 h-4 text-white" /> : <span className="text-sm">{ack.i}</span>}</div>
                        <div><p className="font-bold text-slate-800 text-sm">{ack.l}</p><p className="text-[10px] text-slate-500">{ack.d}</p></div>
                      </button>))}
                    </div> </div>
                  <div><label className="text-xs font-bold text-slate-600 mb-1 block">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label><textarea value={wizardData.notes} onChange={e => setWizardData({ ...wizardData, notes: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-sm h-16 resize-none" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ©..." /></div>
                </div>
              )}

              {wizardStep === 4 && (
                <div className="space-y-5">
                  <div className="bg-gradient-to-r from-violet-50 to-purple-50 rounded-2xl p-4 border border-violet-200">
                    <div className="flex items-center gap-3"><div className="w-10 h-10 rounded-xl bg-violet-500 flex items-center justify-center"><CheckCircle2 className="w-5 h-5 text-white" /></div><div><h3 className="font-bold text-violet-900">Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯</h3><p className="text-sm text-violet-600">Review & Confirm User Configuration</p></div></div>
                  </div>
                  <div className="grid grid-cols-2 gap-5">
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-5">
                      <div className="flex items-center gap-2 mb-4"><User className="w-4 h-4 text-purple-500" /><h4 className="font-bold text-slate-800 text-sm">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©</h4><button onClick={() => setWizardStep(0)} className="mr-auto text-purple-500 text-xs font-bold hover:underline">ØªØ¹Ø¯ÙŠÙ„</button></div>
                      <div className="space-y-2">
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ø§Ø³Ù…:</span><span className="font-bold text-slate-800">{wizardData.fullNameAr || 'â€”'}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ø¨Ø±ÙŠØ¯:</span><span className="font-bold text-slate-800" dir="ltr">{wizardData.email || 'â€”'}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©:</span><span className="font-bold text-slate-800">{NATIONALITIES.find(n => n.code === wizardData.nationality)?.flag} {NATIONALITIES.find(n => n.code === wizardData.nationality)?.label}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„ØªÙˆØ¸ÙŠÙ:</span><span className="font-bold text-slate-800">{EMPLOYMENT_TYPES.find(t => t.code === wizardData.employmentType)?.label}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ù‚Ø³Ù…:</span><span className="font-bold text-slate-800">{DEPARTMENTS.find(d => d.id === wizardData.department)?.name || 'â€”'}</span></div>
                      </div> </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-5">
                      <div className="flex items-center gap-2 mb-4"><Building2 className="w-4 h-4 text-blue-500" /><h4 className="font-bold text-slate-800 text-sm">Ø§Ù„Ù†Ø·Ø§Ù‚</h4><button onClick={() => setWizardStep(1)} className="mr-auto text-blue-500 text-xs font-bold hover:underline">ØªØ¹Ø¯ÙŠÙ„</button></div>
                      <div className="space-y-2">
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span><span className="font-bold text-slate-800">{wizardData.scopeType === 'TENANT' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' : wizardData.scopeType === 'ENTITY' ? 'ÙƒÙŠØ§Ù†' : 'ÙˆØ­Ø¯Ø©/Ù…ÙˆÙ‚Ø¹'}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„ØªØµÙ†ÙŠÙ:</span><span className="font-bold text-slate-800">{DATA_CLASSIFICATIONS.find(d => d.code === wizardData.dataClassificationAccess)?.icon} {DATA_CLASSIFICATIONS.find(d => d.code === wizardData.dataClassificationAccess)?.label}</span></div>
                        {wizardData.regulatoryScope.length > 0 && <div className="text-sm"><span className="text-slate-500">Ø±Ù‚Ø§Ø¨ÙŠ:</span><span className="font-bold text-slate-800 mr-2">{wizardData.regulatoryScope.join(', ')}</span></div>}
                      </div> </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-5">
                      <div className="flex items-center gap-2 mb-4"><Shield className="w-4 h-4 text-emerald-500" /><h4 className="font-bold text-slate-800 text-sm">Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</h4><button onClick={() => setWizardStep(2)} className="mr-auto text-emerald-500 text-xs font-bold hover:underline">ØªØ¹Ø¯ÙŠÙ„</button></div>
                      <div className="flex flex-wrap gap-2">{wizardData.selectedRoles.map(rid => { const r = roles.find(x => x.id === rid); return r ? <span key={rid} className={`px-3 py-1.5 rounded-lg text-xs font-bold ${r.level === 0 ? 'bg-red-100 text-red-700' : r.level === 1 ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'}`}>{r.name} (L{r.level})</span> : null; })}</div>
                      {checkWizardSoD().length > 0 && <div className="p-2 bg-red-50 rounded-lg border border-red-200 mt-2"><p className="text-red-700 font-bold text-xs">âš ï¸ {checkWizardSoD().length} ØªØ¹Ø§Ø±Ø¶ SoD</p></div>}
                    </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-5">
                      <div className="flex items-center gap-2 mb-4"><Lock className="w-4 h-4 text-red-500" /><h4 className="font-bold text-slate-800 text-sm">Ø§Ù„Ø£Ù…Ø§Ù†</h4><button onClick={() => setWizardStep(3)} className="mr-auto text-red-500 text-xs font-bold hover:underline">ØªØ¹Ø¯ÙŠÙ„</button></div>
                      <div className="space-y-2">
                        <div className="flex justify-between text-sm"><span className="text-slate-500">MFA:</span><span className={`font-bold ${wizardData.requireMFA ? 'text-emerald-600' : 'text-red-600'}`}>{wizardData.requireMFA ? 'âœ“ Ù…ÙØ¹Ù„' : 'âœ— Ù…Ø¹Ø·Ù„'}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">Ø§Ù„Ø¬Ù„Ø³Ø©:</span><span className="font-bold text-slate-800">{wizardData.sessionPolicy === 'Relaxed' ? 'Ù…Ø±Ù†Ø©' : wizardData.sessionPolicy === 'Standard' ? 'Ù‚ÙŠØ§Ø³ÙŠØ©' : 'ØµØ§Ø±Ù…Ø©'}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-slate-500">VPN:</span><span className={`font-bold ${wizardData.vpnRequired ? 'text-emerald-600' : 'text-slate-500'}`}>{wizardData.vpnRequired ? 'âœ“' : 'â€”'}</span></div>
                        <div className="mt-2 pt-2 border-t border-slate-100 grid grid-cols-2 gap-1">
                          <span className={`text-xs ${wizardData.complianceAcknowledgment ? 'text-emerald-600' : 'text-slate-400'}`}>{wizardData.complianceAcknowledgment ? 'âœ“' : 'â—‹'} Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span>
                          <span className={`text-xs ${wizardData.ndaSigned ? 'text-emerald-600' : 'text-slate-400'}`}>{wizardData.ndaSigned ? 'âœ“' : 'â—‹'} NDA</span>
                          <span className={`text-xs ${wizardData.securityTrainingCompleted ? 'text-emerald-600' : 'text-slate-400'}`}>{wizardData.securityTrainingCompleted ? 'âœ“' : 'â—‹'} ØªØ¯Ø±ÙŠØ¨ Ø£Ù…Ù†ÙŠ</span>
                          <span className={`text-xs ${wizardData.dataProtectionTraining ? 'text-emerald-600' : 'text-slate-400'}`}>{wizardData.dataProtectionTraining ? 'âœ“' : 'â—‹'} Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª</span>
                        </div> </div> </div> </div>
                  {(() => { const rl = (wizardData.selectedRoles.some(id => roles.find(r => r.id === id)?.level <= 1) ? 2 : 0) + (['Restricted', 'TopSecret'].includes(wizardData.dataClassificationAccess) ? 2 : 0) + (wizardData.employmentType === 'Vendor' ? 1 : 0) + (!wizardData.requireMFA ? 2 : 0) + (checkWizardSoD().length > 0 ? 2 : 0); const lb = rl >= 4 ? 'Ø¹Ø§Ù„ÙŠ' : rl >= 2 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'; const cl = rl >= 4 ? 'red' : rl >= 2 ? 'amber' : 'emerald'; return (<div className={`bg-${cl}-50 rounded-xl p-5 border-2 border-${cl}-200`}><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className={`w-12 h-12 rounded-xl bg-${cl}-500 flex items-center justify-center`}><Activity className="w-6 h-6 text-white" /></div><div><h4 className={`font-bold text-${cl}-900`}>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h4><p className={`text-sm text-${cl}-600`}>Automated Risk Assessment</p></div></div><span className={`px-6 py-2 rounded-xl text-lg font-black bg-${cl}-500 text-white`}>{lb}</span></div></div>); })()}
                </div>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-8 py-4 bg-slate-50 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-3">
                {wizardStep > 0 && <button onClick={() => setWizardStep(wizardStep - 1)} className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100"><ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚</button>}
                <button onClick={() => { setShowCreateUserModal(false); setWizardStep(0); }} className="px-6 py-3 text-slate-500 font-bold hover:text-slate-700">Ø¥Ù„ØºØ§Ø¡</button>
              </div>
              <div className="flex items-center gap-1.5">{[0, 1, 2, 3, 4].map(s => <div key={s} className={`h-2 rounded-full transition-all ${wizardStep === s ? 'bg-purple-500 w-6' : wizardStep > s ? 'bg-emerald-500 w-2.5' : 'bg-slate-300 w-2.5'}`} />)}</div>
              <div className="flex items-center gap-3">
                {wizardStep < 4 ? (<button onClick={() => { if (validateWizardStep(wizardStep)) setWizardStep(wizardStep + 1); }} className={`flex items-center gap-2 px-8 py-3 text-white rounded-xl font-bold ${userEditMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-purple-500 hover:bg-purple-600'}`}>Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" /></button>) : userEditMode ? (<button onClick={() => handleWizardSubmit(false)} disabled={wizardLoading || checkWizardSoD().some(c => c.severity === 'Critical')} className="flex items-center gap-2 px-8 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 disabled:opacity-50">{wizardLoading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...' : <><Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</>}</button>) : (<>
                  <button onClick={() => handleWizardSubmit(true)} disabled={wizardLoading || checkWizardSoD().some(c => c.severity === 'Critical')} className="flex items-center gap-2 px-6 py-3 border-2 border-purple-500 text-purple-700 rounded-xl font-bold hover:bg-purple-50 disabled:opacity-50"><Mail className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ©</button>
                  <button onClick={() => handleWizardSubmit(false)} disabled={wizardLoading || checkWizardSoD().some(c => c.severity === 'Critical')} className="flex items-center gap-2 px-8 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600 disabled:opacity-50">{wizardLoading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...' : <><CheckCircle2 className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„</>}</button>
                </>)}
              </div> </div> </div> </div>
      )}

      {showImportModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setShowImportModal(false)}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-xl" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-emerald-600 to-teal-600 px-6 py-4 flex items-center justify-between rounded-t-2xl">
              <h2 className="text-xl font-bold text-white flex items-center gap-2"><FileUp className="w-6 h-6" />Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
              <button onClick={() => setShowImportModal(false)} className="text-white/80 hover:text-white"><X className="w-6 h-6" /></button>
            </div>
            <div className="p-6 space-y-4">
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <p className="font-bold text-emerald-800 mb-1">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù (CSV):</p>
                <p className="text-sm text-emerald-700 font-mono">Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ø¨Ø±ÙŠØ¯,Ø§Ù„Ø¬ÙˆØ§Ù„,Ø§Ù„ÙˆØ¸ÙŠÙØ©,Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
              </div>
              <div className="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center hover:border-emerald-400 hover:bg-emerald-50/50 transition-all cursor-pointer">
                <FileUp className="w-12 h-12 mx-auto mb-3 text-slate-400" />
                <p className="font-bold text-slate-700">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</p>
                <p className="text-sm text-slate-500">CSV, Excel</p>
              </div> </div>
            <div className="bg-slate-50 px-6 py-4 flex justify-end gap-3 rounded-b-2xl">
              <button onClick={() => setShowImportModal(false)} className="px-6 py-2 text-slate-600 font-bold hover:bg-slate-200 rounded-xl">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={() => { setShowImportModal(false); showNotification('success', 'ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'); }} className="px-6 py-2 bg-emerald-500 text-white font-bold rounded-xl hover:bg-emerald-600">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </div> </div> </div>
      )}

      {showCompareModal && (
        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setShowCompareModal(false)}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[85vh] flex flex-col" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4 flex items-center justify-between rounded-t-2xl">
              <h2 className="text-xl font-bold text-white flex items-center gap-2"><Scale className="w-6 h-6" />Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h2>
              <button onClick={() => setShowCompareModal(false)} className="text-white/80 hover:text-white"><X className="w-6 h-6" /></button>
            </div>
            <div className="p-6 space-y-4 overflow-y-auto flex-1">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ÙˆÙ„</label>
                  <select value={compareUser1?.id || ''} onChange={(e) => setCompareUser1(users.find(u => u.id === parseInt(e.target.value)))} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…...</option>
                    {users.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="text-sm font-bold text-slate-700 mb-2 block">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                  <select value={compareUser2?.id || ''} onChange={(e) => setCompareUser2(users.find(u => u.id === parseInt(e.target.value)))} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…...</option>
                    {users.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}
                  </select>
                </div> </div>
              {compareUser1 && compareUser2 && (
                <div className="bg-white rounded-xl border-2 border-slate-200 overflow-hidden">
                  <table className="w-full">
                    <thead className="bg-slate-50">
                      <tr>
                        <th className="px-4 py-2 text-right text-sm font-bold">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                        <th className="px-4 py-2 text-center text-sm font-bold text-blue-600">{compareUser1.name}</th>
                        <th className="px-4 py-2 text-center text-sm font-bold text-purple-600">{compareUser2.name}</th>
                      </tr> </thead>
                    <tbody>
                      {['OBLIGATIONS', 'EVIDENCE', 'TESTING', 'BREACHES', 'IAM'].map(mod => (
                        <tr key={mod} className="border-b border-slate-100">
                          <td className="px-4 py-2 font-bold text-slate-700">{mod}</td>
                          <td className="px-4 py-2 text-center"><CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto" /></td>
                          <td className="px-4 py-2 text-center"><CheckCircle2 className="w-5 h-5 text-emerald-500 mx-auto" /></td>
                        </tr>
                      ))}
                    </tbody> </table> </div>
              )}
            </div>
            <div className="bg-slate-50 px-6 py-4 flex justify-end rounded-b-2xl">
              <button onClick={() => setShowCompareModal(false)} className="px-6 py-2 bg-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-300">Ø¥ØºÙ„Ø§Ù‚</button>
            </div> </div> </div>
      )}
    </div>);
};

// EXPORT Permission Helpers for use in other modules
const usePermission = () => {
  // Use AuthContext if available
  const auth = useAuth();
  return {
    can: auth.can, checkSoD: auth.checkSoD, guardAction: auth.guardAction, user: auth.currentUser,
    entityContext: auth.entityContext,
  };
};

const PermissionGuard = ({ permission, children, fallback = null }) => {
  const { can } = useAuth();
  return can(permission) ? children : fallback;
};

const SoDGuard = ({ module, action, recordMetadata, children, fallback = null }) => {
  const { checkSoD } = useAuth();
  const result = checkSoD(module, action, recordMetadata);
  return result?.blocked ? fallback : children;
};

// MODULE: INTERACTIVE REPORTS MANAGEMENT SYSTEM
// Full CRUD for regulatory reports - Create, Edit, Delete, Schedule, Export
// Saudi Regulatory Compliance: SAMA, NCA, CMA, NDMO, CITC, ZATCA

const ReportsManagement = () => {
  // STATES - ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
  const [activeTab, setActiveTab] = useState('all');
  const [searchQuery, setSearchQuery] = useState('');
  const [filterAuthority, setFilterAuthority] = useState('all');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterType, setFilterType] = useState('all');
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [showScheduleModal, setShowScheduleModal] = useState(false);
  const [selectedReport, setSelectedReport] = useState(null);
  const [notification, setNotification] = useState(null);

  // Form Data
  const [formData, setFormData] = useState({
    title: '', type: 'compliance', authority: 'SAMA', frequency: 'Quarterly',
    description: '', dueDate: '', assignee: '', priority: 'Medium',
    template: '', includeEvidence: true, requiresApproval: true
  });

  // SAUDI REGULATORY AUTHORITIES
  const AUTHORITIES = [
    { id: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', icon: 'ğŸ¦', color: 'emerald', reports: ['compliance', 'cyber', 'aml', 'risk'] },
    { id: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: 'ğŸ›¡ï¸', color: 'blue', reports: ['cyber', 'incident', 'assessment'] },
    { id: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', icon: 'ğŸ“ˆ', color: 'amber', reports: ['disclosure', 'governance', 'aml'] },
    { id: 'NDMO', name: 'Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ©', icon: 'ğŸ“Š', color: 'purple', reports: ['data', 'privacy', 'classification'] },
    { id: 'CITC', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', icon: 'ğŸ“¡', color: 'cyan', reports: ['telecom', 'security', 'compliance'] },
    { id: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ', icon: 'ğŸ›ï¸', color: 'teal', reports: ['tax', 'vat', 'customs'] },
  ];

  const REPORT_TYPES = [
    { id: 'compliance', label: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„', icon: FileCheck },
    { id: 'cyber', label: 'ØªÙ‚Ø±ÙŠØ± Ø£Ù…Ù† Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: Shield },
    { id: 'incident', label: 'ØªÙ‚Ø±ÙŠØ± Ø­ÙˆØ§Ø¯Ø«', icon: AlertTriangle },
    { id: 'risk', label: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø®Ø§Ø·Ø±', icon: TrendingUp },
    { id: 'audit', label: 'ØªÙ‚Ø±ÙŠØ± ØªØ¯Ù‚ÙŠÙ‚', icon: ClipboardCheck },
    { id: 'disclosure', label: 'ØªÙ‚Ø±ÙŠØ± Ø¥ÙØµØ§Ø­', icon: FileText },
    { id: 'board', label: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', icon: Building2 },
  ];

  const FREQUENCIES = [
    { id: 'Monthly', label: 'Ø´Ù‡Ø±ÙŠ' },
    { id: 'Quarterly', label: 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ' },
    { id: 'SemiAnnual', label: 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ' },
    { id: 'Annual', label: 'Ø³Ù†ÙˆÙŠ' },
    { id: 'AdHoc', label: 'Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨' },
  ];

  const STATUS_CONFIG = {
    Draft: { label: 'Ù…Ø³ÙˆØ¯Ø©', bg: 'bg-slate-100', text: 'text-slate-700', icon: Edit },
    InProgress: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯', bg: 'bg-blue-100', text: 'text-blue-700', icon: Clock },
    UnderReview: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', bg: 'bg-amber-100', text: 'text-amber-700', icon: Eye },
    PendingApproval: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', bg: 'bg-purple-100', text: 'text-purple-700', icon: UserCheck },
    Approved: { label: 'Ù…Ø¹ØªÙ…Ø¯', bg: 'bg-emerald-100', text: 'text-emerald-700', icon: CheckCircle2 },
    Submitted: { label: 'Ù…ÙØ±Ø³Ù„', bg: 'bg-teal-100', text: 'text-teal-700', icon: Send },
    Overdue: { label: 'Ù…ØªØ£Ø®Ø±', bg: 'bg-red-100', text: 'text-red-700', icon: AlertCircle },
  };

  // SAMPLE DATA - ØªØªØ­Ø¯Ø« Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
  const [reports, setReports] = useState([
    { id: 1, refCode: 'RPT-SAMA-2025-001', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Q1', type: 'compliance', authority: 'SAMA', frequency: 'Quarterly', status: 'InProgress', dueDate: '2025-03-31', progress: 45, assignee: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', createdAt: '2025-01-15', updatedAt: '2025-02-05', priority: 'High', sections: 8, completedSections: 4, attachments: 3, comments: 5 },
    { id: 2, refCode: 'RPT-NCA-2025-001', title: 'ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', type: 'cyber', authority: 'NCA', frequency: 'Monthly', status: 'Draft', dueDate: '2025-02-28', progress: 20, assignee: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', createdAt: '2025-02-01', updatedAt: '2025-02-06', priority: 'Critical', sections: 6, completedSections: 1, attachments: 0, comments: 2 },
    { id: 3, refCode: 'RPT-CMA-2025-001', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ', type: 'disclosure', authority: 'CMA', frequency: 'Annual', status: 'UnderReview', dueDate: '2025-04-15', progress: 80, assignee: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', createdAt: '2025-01-01', updatedAt: '2025-02-04', priority: 'High', sections: 12, completedSections: 10, attachments: 8, comments: 12 },
    { id: 4, refCode: 'RPT-SAMA-2025-002', title: 'ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­Ø© ØºØ³Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„', type: 'compliance', authority: 'SAMA', frequency: 'Quarterly', status: 'PendingApproval', dueDate: '2025-03-15', progress: 100, assignee: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', createdAt: '2025-01-10', updatedAt: '2025-02-06', priority: 'Critical', sections: 10, completedSections: 10, attachments: 15, comments: 8 },
    { id: 5, refCode: 'RPT-NDMO-2025-001', title: 'ØªÙ‚Ø±ÙŠØ± ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', type: 'compliance', authority: 'NDMO', frequency: 'SemiAnnual', status: 'Approved', dueDate: '2025-06-30', progress: 100, assignee: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', createdAt: '2024-12-15', updatedAt: '2025-02-01', priority: 'Medium', sections: 5, completedSections: 5, attachments: 6, comments: 3 },
    { id: 6, refCode: 'RPT-NCA-2025-002', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©', type: 'incident', authority: 'NCA', frequency: 'Monthly', status: 'Submitted', dueDate: '2025-01-31', progress: 100, assignee: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', createdAt: '2025-01-05', updatedAt: '2025-01-30', priority: 'High', sections: 4, completedSections: 4, attachments: 10, comments: 6 },
  ]);

  // Scheduled Reports
  const [scheduledReports, setScheduledReports] = useState([
    { id: 1, reportId: 1, frequency: 'Quarterly', nextRun: '2025-04-01', lastRun: '2025-01-01', active: true },
    { id: 2, reportId: 2, frequency: 'Monthly', nextRun: '2025-03-01', lastRun: '2025-02-01', active: true },
  ]);

  // HANDLERS - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©

  // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
  const handleCreateReport = () => {
    if (!formData.title || !formData.dueDate) {
      showNotif('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚');
      return;
    }
    const authority = AUTHORITIES.find(a => a.id === formData.authority);
    const newReport = {
      id: Date.now(),
      refCode: `RPT-${formData.authority}-${new Date().getFullYear()}-${String(reports.length + 1).padStart(3, '0')}`,
      ...formData,
      status: 'Draft', progress: 0, createdAt: new Date().toISOString().split('T')[0],
      updatedAt: new Date().toISOString().split('T')[0], sections: 5, completedSections: 0, attachments: 0, comments: 0,
    };
    setReports(prev => [newReport, ...prev]);
    showNotif('success', `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${newReport.refCode}`);
    setShowCreateModal(false);
    resetForm();
  };

  // ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚Ø±ÙŠØ±
  const handleEditReport = () => {
    if (!formData.title || !formData.dueDate) {
      showNotif('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚');
      return;
    }
    setReports(prev => prev.map(r => r.id === selectedReport.id ? {
      ...r,
      ...formData,
      updatedAt: new Date().toISOString().split('T')[0]
    } : r));
    showNotif('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
    setShowEditModal(false);
    setSelectedReport(null);
    resetForm();
  };

  // Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ±
  const handleDeleteReport = () => {
    setReports(prev => prev.filter(r => r.id !== selectedReport.id));
    showNotif('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
    setShowDeleteModal(false);
    setSelectedReport(null);
  };

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
  const handleUpdateStatus = (reportId, newStatus) => {
    setReports(prev => prev.map(r => r.id === reportId ? {
      ...r,
      status: newStatus,
      progress: newStatus === 'Approved' || newStatus === 'Submitted' ? 100 : r.progress,
      updatedAt: new Date().toISOString().split('T')[0]
    } : r));
    showNotif('success', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰: ${STATUS_CONFIG[newStatus]?.label}`);
  };

  // Ø¬Ø¯ÙˆÙ„Ø© ØªÙ‚Ø±ÙŠØ±
  const handleScheduleReport = (reportId, frequency) => {
    const existing = scheduledReports.find(s => s.reportId === reportId);
    if (existing) {
      setScheduledReports(prev => prev.map(s => s.reportId === reportId ? { ...s, frequency, active: true } : s));
    } else {
      setScheduledReports(prev => [...prev, {
        id: Date.now(),
        reportId,
        frequency,
        nextRun: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
        lastRun: null,
        active: true
      }]);
    }
    showNotif('success', 'ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
    setShowScheduleModal(false);
  };

  // ÙØªØ­ ØªØ¹Ø¯ÙŠÙ„
  const openEditModal = (report) => {
    setSelectedReport(report);
    setFormData({
      title: report.title, type: report.type, authority: report.authority, frequency: report.frequency,
      description: report.description || '', dueDate: report.dueDate, assignee: report.assignee, priority: report.priority,
      template: '', includeEvidence: true,
      requiresApproval: true
    });
    setShowEditModal(true);
  };

  // Reset Form
  const resetForm = () => {
    setFormData({
      title: '', type: 'compliance', authority: 'SAMA', frequency: 'Quarterly',
      description: '', dueDate: '', assignee: '', priority: 'Medium',
      template: '', includeEvidence: true, requiresApproval: true
    });
  };

  // Show Notification
  const showNotif = (type, message) => {
    setNotification({ type, message });
    setTimeout(() => setNotification(null), 3000);
  };

  // Export Report
  const handleExportPDF = (report) => {
    showNotif('success', `Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± ${report.refCode} ÙƒÙ€ PDF...`);
    // Simulate export
    setTimeout(() => showNotif('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'), 1500);
  };

  const handleExportExcel = (report) => {
    showNotif('success', `Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± ${report.refCode} ÙƒÙ€ Excel...`);
    setTimeout(() => showNotif('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'), 1500);
  };

  // FILTERING & STATS
  const filteredReports = useMemo(() => {
    return reports.filter(r => {
      if (searchQuery && !r.title.includes(searchQuery) && !r.refCode.includes(searchQuery)) return false;
      if (filterAuthority !== 'all' && r.authority !== filterAuthority) return false;
      if (filterStatus !== 'all' && r.status !== filterStatus) return false;
      if (filterType !== 'all' && r.type !== filterType) return false;
      if (activeTab === 'draft' && r.status !== 'Draft') return false;
      if (activeTab === 'pending' && !['InProgress', 'UnderReview', 'PendingApproval'].includes(r.status)) return false;
      if (activeTab === 'completed' && !['Approved', 'Submitted'].includes(r.status)) return false;
      if (activeTab === 'overdue' && r.status !== 'Overdue') return false;
      return true;
    });
  }, [reports, searchQuery, filterAuthority, filterStatus, filterType, activeTab]);

  const stats = useMemo(() => ({
    total: reports.length,
    draft: reports.filter(r => r.status === 'Draft').length,
    pending: reports.filter(r => ['InProgress', 'UnderReview', 'PendingApproval'].includes(r.status)).length,
    completed: reports.filter(r => ['Approved', 'Submitted'].includes(r.status)).length,
    overdue: reports.filter(r => r.status === 'Overdue').length,
    scheduled: scheduledReports.filter(s => s.active).length,
  }), [reports, scheduledReports]);

  // RENDER
  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg flex items-center gap-2 ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertCircle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-black text-slate-800 flex items-center gap-3">
            <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
              <FileText className="w-6 h-6 text-white" />
            </div>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
          </h1>
          <p className="text-slate-500 mt-1">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
        </div>
        <button onClick={() => setShowCreateModal(true)}
          className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all">
          <Plus className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
        </button> </div>
      <div className="grid grid-cols-6 gap-4">
        {[
          { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', value: stats.total, color: 'slate', icon: FileText },
          { label: 'Ù…Ø³ÙˆØ¯Ø§Øª', value: stats.draft, color: 'slate', icon: Edit },
          { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„', value: stats.pending, color: 'amber', icon: Clock },
          { label: 'Ù…ÙƒØªÙ…Ù„Ø©', value: stats.completed, color: 'emerald', icon: CheckCircle2 },
          { label: 'Ù…ØªØ£Ø®Ø±Ø©', value: stats.overdue, color: 'red', icon: AlertCircle },
          { label: 'Ù…Ø¬Ø¯ÙˆÙ„Ø©', value: stats.scheduled, color: 'purple', icon: Calendar },
        ].map((stat, idx) => (
          <div key={idx} className={`bg-${stat.color}-50 rounded-2xl p-4 border-2 border-${stat.color}-200`}>
            <div className="flex items-center justify-between">
              <stat.icon className={`w-8 h-8 text-${stat.color}-500`} />
              <span className={`text-3xl font-black text-${stat.color}-700`}>{stat.value}</span>
            </div>
            <p className={`text-sm font-bold text-${stat.color}-600 mt-2`}>{stat.label}</p>
          </div>
        ))}
      </div>

      <div className="flex items-center gap-2 bg-slate-100 p-1.5 rounded-xl">
        {[
          { id: 'all', label: 'Ø§Ù„ÙƒÙ„', count: stats.total },
          { id: 'draft', label: 'Ù…Ø³ÙˆØ¯Ø§Øª', count: stats.draft },
          { id: 'pending', label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„', count: stats.pending },
          { id: 'completed', label: 'Ù…ÙƒØªÙ…Ù„Ø©', count: stats.completed },
          { id: 'overdue', label: 'Ù…ØªØ£Ø®Ø±Ø©', count: stats.overdue },
        ].map(tab => (
          <button key={tab.id} onClick={() => setActiveTab(tab.id)}
            className={`px-4 py-2 rounded-lg font-bold transition-all ${activeTab === tab.id ? 'bg-white shadow text-indigo-700' : 'text-slate-500 hover:bg-slate-200'}`}>
            {tab.label} <span className="text-xs opacity-70">({tab.count})</span>
          </button>
        ))}
      </div>

      <div className="flex items-center gap-3 flex-wrap">
        <div className="relative flex-1 min-w-[200px]">
          <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
          <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø±Ù…Ø²..." value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pr-10 pl-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
        </div>
        <select value={filterAuthority} onChange={(e) => setFilterAuthority(e.target.value)}
          className="px-4 py-2.5 border-2 border-slate-200 rounded-xl font-bold">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª</option>
          {AUTHORITIES.map(a => <option key={a.id} value={a.id}>{a.icon} {a.id}</option>)}
        </select>
        <select value={filterType} onChange={(e) => setFilterType(e.target.value)}
          className="px-4 py-2.5 border-2 border-slate-200 rounded-xl font-bold">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
          {REPORT_TYPES.map(t => <option key={t.id} value={t.id}>{t.label}</option>)}
        </select>
        <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-2.5 border-2 border-slate-200 rounded-xl font-bold">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          {Object.entries(STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}
        </select>
      </div>

      <div className="space-y-4">
        {filteredReports.length === 0 ? (
          <div className="text-center py-16 bg-slate-50 rounded-2xl">
            <FileText className="w-16 h-16 mx-auto text-slate-300 mb-4" />
            <p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>
            <button onClick={() => setShowCreateModal(true)} className="mt-4 px-6 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold">
              Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
            </button> </div>
        ) : (
          filteredReports.map(report => {
            const authority = AUTHORITIES.find(a => a.id === report.authority);
            const reportType = REPORT_TYPES.find(t => t.id === report.type);
            const statusConf = STATUS_CONFIG[report.status];
            const isOverdue = new Date(report.dueDate) < new Date() && !['Approved', 'Submitted'].includes(report.status);

            return (
              <div key={report.id} className={`bg-white rounded-2xl border-2 ${isOverdue ? 'border-red-300' : 'border-slate-200'} hover:shadow-lg transition-all`}>
                <div className="p-5">
                  <div className="flex items-start gap-4">
                    <div className={`w-14 h-14 rounded-2xl bg-${authority?.color || 'slate'}-100 flex items-center justify-center flex-shrink-0`}>
                      <span className="text-2xl">{authority?.icon}</span>
                    </div>

                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 flex-wrap mb-1">
                        <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{report.refCode}</span>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold bg-${authority?.color}-100 text-${authority?.color}-700`}>{authority?.id}</span>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${statusConf?.bg} ${statusConf?.text}`}>{statusConf?.label}</span>
                        {isOverdue && <span className="px-2 py-0.5 rounded text-xs font-bold bg-red-100 text-red-700">Ù…ØªØ£Ø®Ø±</span>}
                      </div>
                      <h3 className="font-bold text-slate-800 text-lg truncate">{report.title}</h3>
                      <div className="flex items-center gap-4 mt-2 text-sm text-slate-500">
                        <span className="flex items-center gap-1"><Calendar className="w-4 h-4" />{report.dueDate}</span>
                        <span className="flex items-center gap-1"><User className="w-4 h-4" />{report.assignee}</span>
                        <span className="flex items-center gap-1"><FileText className="w-4 h-4" />{report.completedSections}/{report.sections} Ø£Ù‚Ø³Ø§Ù…</span>
                        <span className="flex items-center gap-1"><Paperclip className="w-4 h-4" />{report.attachments} Ù…Ø±ÙÙ‚</span>
                      </div>

                      <div className="mt-3">
                        <div className="flex items-center justify-between text-sm mb-1">
                          <span className="text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                          <span className="font-bold text-slate-700">{report.progress}%</span>
                        </div>
                        <div className="h-2 bg-slate-100 rounded-full">
                          <div className={`h-full rounded-full ${report.progress === 100 ? 'bg-emerald-500' : 'bg-indigo-500'}`}
                            style={{ width: `${report.progress}%` }} />
                        </div> </div> </div>
                    <div className="flex items-center gap-2">
                      <button onClick={() => { setSelectedReport(report); setShowDetailModal(true); }}
                        className="p-2 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200" title="Ø¹Ø±Ø¶">
                        <Eye className="w-5 h-5" />
                      </button>
                      <button onClick={() => openEditModal(report)}
                        className="p-2 bg-amber-100 text-amber-600 rounded-xl hover:bg-amber-200" title="ØªØ¹Ø¯ÙŠÙ„">
                        <Edit className="w-5 h-5" />
                      </button>
                      <button onClick={() => handleExportPDF(report)}
                        className="p-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200" title="PDF">
                        <Download className="w-5 h-5" />
                      </button>
                      <button onClick={() => { setSelectedReport(report); setShowScheduleModal(true); }}
                        className="p-2 bg-purple-100 text-purple-600 rounded-xl hover:bg-purple-200" title="Ø¬Ø¯ÙˆÙ„Ø©">
                        <Calendar className="w-5 h-5" />
                      </button>
                      <button onClick={() => { setSelectedReport(report); setShowDeleteModal(true); }}
                        className="p-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200" title="Ø­Ø°Ù">
                        <Trash2 className="w-5 h-5" />
                      </button> </div> </div> </div>
                <div className="border-t border-slate-200 px-5 py-3 bg-slate-50 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-slate-500">ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                    {Object.entries(STATUS_CONFIG).slice(0, 4).map(([key, conf]) => (
                      <button key={key} onClick={() => handleUpdateStatus(report.id, key)}
                        className={`px-3 py-1 rounded-lg text-xs font-bold ${report.status === key ? `${conf.bg} ${conf.text}` : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}>
                        {conf.label}
                      </button>
                    ))}
                  </div>
                  <div className="text-sm text-slate-400">
                    Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {report.updatedAt}
                  </div> </div> </div>);
          })
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          CREATE REPORT MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showCreateModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Plus className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯</h2>
                    <p className="text-indigo-100">ØªÙ‚Ø±ÙŠØ± ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
                  </div> </div>
                <button onClick={() => { setShowCreateModal(false); resetForm(); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5 max-h-[60vh] overflow-y-auto">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© *</label>
                <div className="grid grid-cols-3 gap-2">
                  {AUTHORITIES.map(auth => (
                    <button key={auth.id} onClick={() => setFormData({ ...formData, authority: auth.id })}
                      className={`p-3 rounded-xl border-2 flex items-center gap-2 transition-all ${formData.authority === auth.id ? `border-${auth.color}-500 bg-${auth.color}-50` : 'border-slate-200 hover:border-slate-300'}`}>
                      <span className="text-2xl">{auth.icon}</span>
                      <span className={`font-bold text-sm ${formData.authority === auth.id ? `text-${auth.color}-700` : 'text-slate-600'}`}>{auth.id}</span>
                    </button>
                  ))}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± *</label>
                <div className="grid grid-cols-4 gap-2">
                  {REPORT_TYPES.map(type => (
                    <button key={type.id} onClick={() => setFormData({ ...formData, type: type.id })}
                      className={`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${formData.type === type.id ? 'border-indigo-500 bg-indigo-50' : 'border-slate-200 hover:border-slate-300'}`}>
                      <type.icon className={`w-5 h-5 ${formData.type === type.id ? 'text-indigo-600' : 'text-slate-500'}`} />
                      <span className="text-xs font-bold">{type.label}</span>
                    </button>
                  ))}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± *</label>
                <input type="text" value={formData.title}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none"
                  placeholder="Ù…Ø«Ø§Ù„: ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Q1 2025" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">ÙˆØµÙ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                <textarea value={formData.description} rows={3}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none resize-none"
                  placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡" />
              </div>

              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                  <input type="date" value={formData.dueDate}
                    onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
                  <select value={formData.frequency}
                    onChange={(e) => setFormData({ ...formData, frequency: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    {FREQUENCIES.map(f => <option key={f.id} value={f.id}>{f.label}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                  <select value={formData.priority}
                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</label>
                <input type="text" value={formData.assignee}
                  onChange={(e) => setFormData({ ...formData, assignee: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none"
                  placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" />
              </div>

              <div className="flex items-center gap-6">
                <label className="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" checked={formData.includeEvidence}
                    onChange={(e) => setFormData({ ...formData, includeEvidence: e.target.checked })}
                    className="w-5 h-5 rounded border-slate-300" />
                  <span className="text-sm font-bold text-slate-700">ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª</span>
                </label>
                <label className="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" checked={formData.requiresApproval}
                    onChange={(e) => setFormData({ ...formData, requiresApproval: e.target.checked })}
                    className="w-5 h-5 rounded border-slate-300" />
                  <span className="text-sm font-bold text-slate-700">ÙŠØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span>
                </label>
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowCreateModal(false); resetForm(); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleCreateReport}
                className="px-6 py-3 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600 flex items-center gap-2">
                <Plus className="w-5 h-5" />Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EDIT REPORT MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showEditModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <Edit className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                    <p className="text-amber-100">{selectedReport.refCode}</p>
                  </div> </div>
                <button onClick={() => { setShowEditModal(false); setSelectedReport(null); resetForm(); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5 max-h-[60vh] overflow-y-auto">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± *</label>
                <input type="text" value={formData.title}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ *</label>
                  <input type="date" value={formData.dueDate}
                    onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                  <select value={formData.priority}
                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                <input type="text" value={formData.assignee}
                  onChange={(e) => setFormData({ ...formData, assignee: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none" />
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowEditModal(false); setSelectedReport(null); resetForm(); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleEditReport}
                className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 flex items-center gap-2">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          DELETE CONFIRMATION MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showDeleteModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                  <Trash2 className="w-7 h-7" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                  <p className="text-red-100">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-red-50 rounded-xl p-4 border border-red-200 mb-4">
                <p className="font-bold text-red-800">{selectedReport.refCode}</p>
                <p className="text-red-700 mt-1">{selectedReport.title}</p>
              </div>
              <p className="text-slate-600">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ</p>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowDeleteModal(false); setSelectedReport(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDeleteReport}
                className="px-6 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 flex items-center gap-2">
                <Trash2 className="w-5 h-5" />Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          SCHEDULE MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showScheduleModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-l from-purple-500 to-violet-600 px-6 py-5 text-white">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                  <Calendar className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                  <p className="text-purple-100">{selectedReport.refCode}</p>
                </div> </div> </div>
            <div className="p-6">
              <p className="text-slate-600 mb-4">Ø§Ø®ØªØ± ØªÙƒØ±Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:</p>
              <div className="space-y-2">
                {FREQUENCIES.map(freq => (
                  <button key={freq.id} onClick={() => handleScheduleReport(selectedReport.id, freq.id)}
                    className="w-full p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:bg-purple-50 text-right font-bold text-slate-700 transition-all">
                    {freq.label}
                  </button>
                ))}
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => { setShowScheduleModal(false); setSelectedReport(null); }}
                className="w-full px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
            </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          DETAIL MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showDetailModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <div className={`bg-gradient-to-l from-${AUTHORITIES.find(a => a.id === selectedReport.authority)?.color || 'slate'}-500 to-${AUTHORITIES.find(a => a.id === selectedReport.authority)?.color || 'slate'}-600 px-6 py-5 text-white`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center text-2xl">
                    {AUTHORITIES.find(a => a.id === selectedReport.authority)?.icon}
                  </div>
                  <div>
                    <p className="text-sm opacity-80">{selectedReport.refCode}</p>
                    <h2 className="text-xl font-bold">{selectedReport.title}</h2>
                  </div> </div>
                <button onClick={() => { setShowDetailModal(false); setSelectedReport(null); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 max-h-[60vh] overflow-y-auto space-y-6">
              <div className="grid grid-cols-4 gap-4">
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-sm text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø©</p>
                  <p className={`font-bold ${STATUS_CONFIG[selectedReport.status]?.text}`}>{STATUS_CONFIG[selectedReport.status]?.label}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-sm text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
                  <p className="font-bold text-indigo-700">{selectedReport.progress}%</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-sm text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</p>
                  <p className="font-bold text-slate-800">{selectedReport.dueDate}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4 text-center">
                  <p className="text-sm text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                  <p className="font-bold text-slate-800">{selectedReport.assignee}</p>
                </div> </div>
              <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                <h4 className="font-bold text-indigo-800 mb-3">Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h4>
                <div className="flex items-center gap-4">
                  <div className="flex-1 h-3 bg-indigo-100 rounded-full">
                    <div className="h-full bg-indigo-500 rounded-full" style={{ width: `${(selectedReport.completedSections / selectedReport.sections) * 100}%` }} />
                  </div>
                  <span className="font-bold text-indigo-700">{selectedReport.completedSections}/{selectedReport.sections}</span>
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</p>
                  <p className="font-bold text-slate-800">{selectedReport.createdAt}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</p>
                  <p className="font-bold text-slate-800">{selectedReport.updatedAt}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</p>
                  <p className="font-bold text-slate-800">{selectedReport.attachments} Ù…Ù„Ù</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</p>
                  <p className="font-bold text-slate-800">{selectedReport.comments} ØªØ¹Ù„ÙŠÙ‚</p>
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => { setShowDetailModal(false); setSelectedReport(null); }}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex items-center gap-2">
                <button onClick={() => handleExportPDF(selectedReport)}
                  className="px-4 py-3 bg-red-100 text-red-700 rounded-xl font-bold flex items-center gap-2">
                  <Download className="w-4 h-4" />PDF
                </button>
                <button onClick={() => { setShowDetailModal(false); openEditModal(selectedReport); }}
                  className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold flex items-center gap-2">
                  <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                </button> </div> </div> </div> </div>
      )}
    </div>);
};

// SHOMOOS INTERACTIVE CRUD COMPONENT
// Full CRUD for Shomoos (MOI) compliance management

const ShomoosCRUD = ({ selectedPeriod }) => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [notification, setNotification] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterFacility, setFilterFacility] = useState('all');
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [deleteTarget, setDeleteTarget] = useState(null);
  const [showSubmissionWizard, setShowSubmissionWizard] = useState(false);
  const [wizardStep, setWizardStep] = useState(1);
  const [showGuestModal, setShowGuestModal] = useState(false);
  const [showFacilityModal, setShowFacilityModal] = useState(false);
  const [showViolationModal, setShowViolationModal] = useState(false);
  const [showInspectionModal, setShowInspectionModal] = useState(false);
  const [showDetailPanel, setShowDetailPanel] = useState(false);
  const [detailItem, setDetailItem] = useState(null);

  // DATA
  const [submissions, setSubmissions] = useState([
    { id: 1, date: '2025-02-07', facilityId: 1, guestCount: 45, saudiCount: 18, foreignCount: 27, maleCount: 30, femaleCount: 15, childCount: 0, submittedAt: '08:30', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250207-001', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 2, date: '2025-02-06', facilityId: 1, guestCount: 52, saudiCount: 22, foreignCount: 30, maleCount: 35, femaleCount: 17, childCount: 0, submittedAt: '08:15', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250206-001', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 3, date: '2025-02-05', facilityId: 1, guestCount: 38, saudiCount: 15, foreignCount: 23, maleCount: 25, femaleCount: 13, childCount: 0, submittedAt: '09:05', status: 'Late', submittedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', type: 'manual', transmissionId: 'TXN-20250205-001', responseCode: 200, retries: 1, verifiedByNIC: true, notes: 'Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ - Ø¹Ø·Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…' },
    { id: 4, date: '2025-02-04', facilityId: 1, guestCount: 61, saudiCount: 25, foreignCount: 36, maleCount: 40, femaleCount: 18, childCount: 3, submittedAt: '10:45', status: 'Late', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250204-001', responseCode: 200, retries: 3, verifiedByNIC: true, notes: 'Ù…Ø´ÙƒÙ„Ø© Ø´Ø¨ÙƒØ©' },
    { id: 5, date: '2025-02-03', facilityId: 1, guestCount: 33, saudiCount: 12, foreignCount: 21, maleCount: 22, femaleCount: 11, childCount: 0, submittedAt: '08:20', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250203-001', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 6, date: '2025-02-07', facilityId: 2, guestCount: 28, saudiCount: 10, foreignCount: 18, maleCount: 20, femaleCount: 8, childCount: 0, submittedAt: '08:50', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250207-002', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 7, date: '2025-02-06', facilityId: 2, guestCount: 31, saudiCount: 14, foreignCount: 17, maleCount: 21, femaleCount: 10, childCount: 0, submittedAt: '09:35', status: 'Late', submittedBy: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', type: 'manual', transmissionId: 'TXN-20250206-002', responseCode: 408, retries: 2, verifiedByNIC: false, notes: 'Timeout' },
    { id: 8, date: '2025-02-07', facilityId: 3, guestCount: 22, saudiCount: 8, foreignCount: 14, maleCount: 16, femaleCount: 6, childCount: 0, submittedAt: '08:10', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250207-003', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 9, date: '2025-02-02', facilityId: 1, guestCount: 55, saudiCount: 20, foreignCount: 35, maleCount: 38, femaleCount: 17, childCount: 0, submittedAt: '07:55', status: 'Submitted', submittedBy: 'Ù†Ø¸Ø§Ù… Ø¢Ù„ÙŠ', type: 'auto', transmissionId: 'TXN-20250202-001', responseCode: 200, retries: 0, verifiedByNIC: true, notes: '' },
    { id: 10, date: '2025-02-01', facilityId: 1, guestCount: 48, saudiCount: 19, foreignCount: 29, maleCount: 33, femaleCount: 15, childCount: 0, submittedAt: '11:20', status: 'Failed', submittedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ', type: 'correction', transmissionId: 'TXN-20250201-001', responseCode: 500, retries: 5, verifiedByNIC: false, notes: 'ÙØ´Ù„ Ø¨Ø¹Ø¯ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª' },
  ]);

  const [facilities, setFacilities] = useState([
    { id: 1, name: 'ÙÙ†Ø¯Ù‚ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶', nameEn: 'Al-Basiri Hotel Riyadh', license: 'SHM-2024-00123', crNumber: '1010123456', registrationDate: '2024-01-15', status: 'Active', category: 'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ…', rooms: 250, beds: 380, lastAudit: '2024-12-01', complianceScore: 92, connectionStatus: 'Connected', lastPing: '2025-02-07 08:30', apiVersion: 'v2.1', contactPerson: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', contactPhone: '0551234567', contactEmail: 'ahmed@basiri.com', city: 'Ø§Ù„Ø±ÙŠØ§Ø¶', district: 'Ø§Ù„Ø¹Ù„ÙŠØ§', address: 'Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯', scannerCount: 3, activeScanner: 3 },
    { id: 2, name: 'Ø´Ù‚Ù‚ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ù…ÙØ±ÙˆØ´Ø© - Ø¬Ø¯Ø©', nameEn: 'Al-Basiri Apartments Jeddah', license: 'SHM-2024-00456', crNumber: '4030567890', registrationDate: '2024-03-20', status: 'Active', category: 'Ø´Ù‚Ù‚ Ù…ÙØ±ÙˆØ´Ø©', rooms: 80, beds: 120, lastAudit: '2024-11-15', complianceScore: 78, connectionStatus: 'Connected', lastPing: '2025-02-07 08:50', apiVersion: 'v2.0', contactPerson: 'Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ', contactPhone: '0559876543', contactEmail: 'sara@basiri.com', city: 'Ø¬Ø¯Ø©', district: 'Ø§Ù„Ø±ÙˆØ¶Ø©', address: 'Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ù„ÙŠØ©', scannerCount: 2, activeScanner: 1 },
    { id: 3, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ - Ø§Ù„Ø®Ø¨Ø±', nameEn: 'Al-Basiri Resort Khobar', license: 'SHM-2024-00789', crNumber: '2050987654', registrationDate: '2024-06-10', status: 'UnderReview', category: 'Ù…Ù†ØªØ¬Ø¹', rooms: 120, beds: 200, lastAudit: '2024-10-20', complianceScore: 55, connectionStatus: 'Disconnected', lastPing: '2025-02-05 14:22', apiVersion: 'v1.8', contactPerson: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', contactPhone: '0553456789', contactEmail: 'khaled@basiri.com', city: 'Ø§Ù„Ø®Ø¨Ø±', district: 'Ø§Ù„Ø­Ø²Ø§Ù… Ø§Ù„Ø°Ù‡Ø¨ÙŠ', address: 'ÙƒÙˆØ±Ù†ÙŠØ´ Ø§Ù„Ø®Ø¨Ø±', scannerCount: 2, activeScanner: 0 },
  ]);

  const [guests, setGuests] = useState([
    { id: 1, name: 'John Smith', idType: 'Passport', idNumber: 'US****1234', nationality: 'Ø£Ù…Ø±ÙŠÙƒÙŠ', nationalityCode: 'US', gender: 'male', room: '501', floor: '5', checkIn: '2025-02-06 14:00', checkOut: '2025-02-09 12:00', status: 'Active', facilityId: 1, verificationStatus: 'Verified', scannedAt: '2025-02-06 14:05', purpose: 'Ø³ÙŠØ§Ø­Ø©', companions: 0, vehiclePlate: '' },
    { id: 2, name: 'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø±ÙŠ', idType: 'Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ©', idNumber: '1098****5678', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', nationalityCode: 'SA', gender: 'male', room: '302', floor: '3', checkIn: '2025-02-07 15:30', checkOut: '2025-02-08 12:00', status: 'Active', facilityId: 1, verificationStatus: 'Verified', scannedAt: '2025-02-07 15:35', purpose: 'Ø¹Ù…Ù„', companions: 0, vehiclePlate: 'Ø£ Ø¨ Ø¬ 1234' },
    { id: 3, name: 'Ali Reza Mohammadi', idType: 'Ø¥Ù‚Ø§Ù…Ø©', idNumber: '2345****6789', nationality: 'Ø¥ÙŠØ±Ø§Ù†ÙŠ', nationalityCode: 'IR', gender: 'male', room: '205', floor: '2', checkIn: '2025-02-05 16:00', checkOut: '2025-02-07 12:00', status: 'CheckedOut', facilityId: 1, verificationStatus: 'Verified', scannedAt: '2025-02-05 16:10', purpose: 'Ø²ÙŠØ§Ø±Ø©', companions: 1, vehiclePlate: '' },
    { id: 4, name: 'Emma Wilson', idType: 'Passport', idNumber: 'UK****5678', nationality: 'Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ', nationalityCode: 'GB', gender: 'female', room: '401', floor: '4', checkIn: '2025-02-07 18:00', checkOut: '2025-02-12 12:00', status: 'Active', facilityId: 2, verificationStatus: 'Pending', scannedAt: null, purpose: 'Ø³ÙŠØ§Ø­Ø©', companions: 2, vehiclePlate: '' },
    { id: 5, name: 'ÙÙ‡Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ', idType: 'Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ©', idNumber: '1087****4321', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', nationalityCode: 'SA', gender: 'male', room: '103', floor: '1', checkIn: '2025-02-04 10:00', checkOut: '2025-02-06 12:00', status: 'CheckedOut', facilityId: 2, verificationStatus: 'Verified', scannedAt: '2025-02-04 10:08', purpose: 'Ø¹Ù…Ù„', companions: 0, vehiclePlate: 'Ø± Ø³ Ø· 5678' },
    { id: 6, name: 'Ù†ÙˆØ±Ø© Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', idType: 'Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ©', idNumber: '1100****9876', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', nationalityCode: 'SA', gender: 'female', room: '205', floor: '2', checkIn: '2025-02-07 20:00', checkOut: '2025-02-10 12:00', status: 'Active', facilityId: 1, verificationStatus: 'Pending', scannedAt: null, purpose: 'Ø³ÙŠØ§Ø­Ø©', companions: 3, vehiclePlate: '' },
  ]);

  const [violations, setViolations] = useState([
    { id: 1, code: 'VIO-SHM-001', date: '2025-01-15', type: 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', description: 'ØªØ£Ø®Ø± ÙÙŠ Ø±ÙØ¹ Ø¨ÙŠØ§Ù†Ø§Øª 3 Ù†Ø²Ù„Ø§Ø¡ Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ø§Ø¹Ø©', facility: 'ÙÙ†Ø¯Ù‚ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶', facilityId: 1, status: 'Resolved', severity: 'Medium', fine: 5000, paidAmount: 5000, resolvedDate: '2025-01-20', resolution: 'ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø®Ù„Ù„ ØªÙ‚Ù†ÙŠ + ØªØ±ÙƒÙŠØ¨ UPS', corrective: 'Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ', appealStatus: null, inspector: 'Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', referenceNumber: 'MOI-REF-2025-0115' },
    { id: 2, code: 'VIO-SHM-002', date: '2025-01-28', type: 'Ù†Ø²ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„', description: 'Ù†Ø²ÙŠÙ„ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø£Ø«Ù†Ø§Ø¡ Ø¬ÙˆÙ„Ø© ØªÙØªÙŠØ´ÙŠØ©', facility: 'Ø´Ù‚Ù‚ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ù…ÙØ±ÙˆØ´Ø© - Ø¬Ø¯Ø©', facilityId: 2, status: 'Open', severity: 'High', fine: 10000, paidAmount: 0, resolvedDate: null, resolution: '', corrective: '', appealStatus: 'UnderReview', inspector: 'Ù…. Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ', referenceNumber: 'MOI-REF-2025-0128' },
    { id: 3, code: 'VIO-SHM-003', date: '2025-02-01', type: 'Ø¹Ø·Ù„ ÙÙŠ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³Ø­', description: 'Ø¬Ù‡Ø§Ø² Ù…Ø³Ø­ Ù…Ø¹Ø·Ù„ 24+ Ø³Ø§Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙˆØ²Ø§Ø±Ø©', facility: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ - Ø§Ù„Ø®Ø¨Ø±', facilityId: 3, status: 'Open', severity: 'Critical', fine: 25000, paidAmount: 0, resolvedDate: null, resolution: '', corrective: '', appealStatus: null, inspector: 'Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', referenceNumber: 'MOI-REF-2025-0201' },
  ]);

  const [inspections, setInspections] = useState([
    { id: 1, date: '2024-12-01', facilityId: 1, inspector: 'Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', type: 'Ø¯ÙˆØ±ÙŠØ©', result: 'Pass', score: 92, categories: { 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡': 95, 'Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ø­': 90, 'Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ': 93, 'Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª': 88, 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†': 95 }, findings: [{ text: 'ØªØ£Ø®Ø± Ø·ÙÙŠÙ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ', severity: 'Low' }], nextInspection: '2025-03-01', notes: 'Ø§Ù„ØªØ²Ø§Ù… Ø¬ÙŠØ¯' },
    { id: 2, date: '2024-11-15', facilityId: 2, inspector: 'Ù…. Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ', type: 'Ø¯ÙˆØ±ÙŠØ©', result: 'ConditionalPass', score: 78, categories: { 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡': 80, 'Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ø­': 65, 'Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ': 82, 'Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª': 75, 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†': 88 }, findings: [{ text: 'Ø¬Ù‡Ø§Ø² Ù…Ø³Ø­ Ù…Ø¹Ø·Ù„', severity: 'High' }, { text: 'Ø³Ø¬Ù„Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©', severity: 'Medium' }], nextInspection: '2025-02-15', notes: 'Ø¥ØµÙ„Ø§Ø­ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³Ø­ Ø®Ù„Ø§Ù„ 15 ÙŠÙˆÙ…' },
    { id: 3, date: '2024-10-20', facilityId: 3, inspector: 'Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', type: 'Ù…ÙØ§Ø¬Ø¦Ø©', result: 'Fail', score: 55, categories: { 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡': 50, 'Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ø­': 40, 'Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ': 55, 'Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª': 60, 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†': 70 }, findings: [{ text: '5 Ù†Ø²Ù„Ø§Ø¡ ØºÙŠØ± Ù…Ø³Ø¬Ù„ÙŠÙ†', severity: 'Critical' }, { text: 'Ø¬Ù‡Ø§Ø²ÙŠÙ† Ù…Ø¹Ø·Ù„ÙŠÙ†', severity: 'Critical' }, { text: 'Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø±Ø¨Ø· 8+ Ø³Ø§Ø¹Ø§Øª', severity: 'Critical' }], nextInspection: '2025-01-20', notes: 'Ø±ÙØ¹ ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§' },
  ]);

  const [transmissionLog] = useState([
    { id: 1, ts: '2025-02-07 08:30:00', fId: 1, type: 'DAILY', status: 'SUCCESS', ms: 245, code: 200 },
    { id: 2, ts: '2025-02-07 08:50:00', fId: 2, type: 'DAILY', status: 'SUCCESS', ms: 312, code: 200 },
    { id: 3, ts: '2025-02-07 08:10:00', fId: 3, type: 'DAILY', status: 'SUCCESS', ms: 198, code: 200 },
    { id: 4, ts: '2025-02-06 09:35:00', fId: 2, type: 'DAILY', status: 'TIMEOUT', ms: 30000, code: 408 },
    { id: 5, ts: '2025-02-06 09:36:00', fId: 2, type: 'RETRY', status: 'TIMEOUT', ms: 30000, code: 408 },
    { id: 6, ts: '2025-02-06 09:37:00', fId: 2, type: 'RETRY_MANUAL', status: 'SUCCESS', ms: 856, code: 200 },
    { id: 7, ts: '2025-02-01 11:20:00', fId: 1, type: 'CORRECTION', status: 'FAILED', ms: 5000, code: 500 },
  ]);

  // FORMS
  const emptySubForm = { facilityId: '', date: new Date().toISOString().split('T')[0], guestCount: '', saudiCount: '', foreignCount: '', maleCount: '', femaleCount: '', childCount: '0', type: 'auto', notes: '' };
  const emptyGuestForm = { name: '', idType: 'Passport', idNumber: '', nationality: '', nationalityCode: '', gender: 'male', room: '', floor: '', checkIn: '', checkOut: '', facilityId: '', purpose: 'Ø³ÙŠØ§Ø­Ø©', companions: '0', vehiclePlate: '' };
  const emptyFacForm = { name: '', nameEn: '', category: '', rooms: '', beds: '', city: '', district: '', address: '', contactPerson: '', contactPhone: '', contactEmail: '', crNumber: '' };
  const emptyVioForm = { type: '', description: '', facilityId: '', severity: 'Medium', fine: '', inspector: '' };
  const emptyInspForm = { date: new Date().toISOString().split('T')[0], facilityId: '', inspector: '', type: 'Ø¯ÙˆØ±ÙŠØ©', notes: '', nextInspection: '', categories: { 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡': 80, 'Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ø­': 80, 'Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ': 80, 'Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª': 80, 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†': 80 } };
  const [subForm, setSubForm] = useState(emptySubForm);
  const [guestForm, setGuestForm] = useState(emptyGuestForm);
  const [facForm, setFacForm] = useState(emptyFacForm);
  const [vioForm, setVioForm] = useState(emptyVioForm);
  const [inspForm, setInspForm] = useState(emptyInspForm);

  // COMPUTED STATS
  const stats = useMemo(() => {
    const totalSubs = submissions.length, onTime = submissions.filter(s => s.status === 'Submitted').length;
    const late = submissions.filter(s => s.status === 'Late').length, failed = submissions.filter(s => s.status === 'Failed').length;
    const totalGuests = submissions.reduce((a, s) => a + s.guestCount, 0);
    const activeGuests = guests.filter(g => g.status === 'Active').length;
    const pendingVerify = guests.filter(g => g.verificationStatus === 'Pending').length;
    const connectedFac = facilities.filter(f => f.connectionStatus === 'Connected').length;
    const disconnectedFac = facilities.filter(f => f.connectionStatus === 'Disconnected').length;
    const openVio = violations.filter(v => v.status === 'Open').length;
    const critVio = violations.filter(v => v.severity === 'Critical' && v.status === 'Open').length;
    const unpaidFines = violations.filter(v => v.status === 'Open').reduce((a, v) => a + (v.fine || 0), 0);
    const totalFines = violations.reduce((a, v) => a + (v.fine || 0), 0);
    const complianceRate = totalSubs ? Math.round((onTime / totalSubs) * 100) : 0;
    const avgScore = facilities.length ? Math.round(facilities.reduce((a, f) => a + (f.complianceScore || 0), 0) / facilities.length) : 0;
    const todaySubs = submissions.filter(s => s.date === '2025-02-07');
    const todayGuests = todaySubs.reduce((a, s) => a + s.guestCount, 0);
    return { totalSubs, onTime, late, failed, totalGuests, activeGuests, pendingVerify, connectedFac, disconnectedFac, openVio, critVio, unpaidFines, totalFines, complianceRate, avgScore, todayCount: todaySubs.length, todayGuests };
  }, [submissions, facilities, violations, guests]);

  const last7Days = useMemo(() => {
    const days = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date('2025-02-07'); d.setDate(d.getDate() - i);
      const ds = d.toISOString().split('T')[0];
      const daySubmissions = submissions.filter(s => s.date === ds);
      days.push({ date: ds, day: d.toLocaleDateString('ar-SA', { weekday: 'short' }), count: daySubmissions.reduce((a, s) => a + s.guestCount, 0), late: daySubmissions.filter(s => s.status === 'Late').length });
    }
    return days;
  }, [submissions]);

  // HELPERS
  const notify = (msg, type = 'success') => { setNotification({ message: msg, type }); setTimeout(() => setNotification(null), 4000); };
  const getFac = (id) => facilities.find(f => f.id === id);
  const getFacName = (id) => getFac(id)?.name || 'â€”';
  const sColor = (s) => ({ Submitted: 'bg-emerald-100 text-emerald-700', Active: 'bg-emerald-100 text-emerald-700', Resolved: 'bg-emerald-100 text-emerald-700', Pass: 'bg-emerald-100 text-emerald-700', Connected: 'bg-emerald-100 text-emerald-700', Verified: 'bg-emerald-100 text-emerald-700', Late: 'bg-amber-100 text-amber-700', UnderReview: 'bg-amber-100 text-amber-700', ConditionalPass: 'bg-amber-100 text-amber-700', Pending: 'bg-amber-100 text-amber-700', PendingApproval: 'bg-amber-100 text-amber-700', Failed: 'bg-red-100 text-red-700', Open: 'bg-red-100 text-red-700', Fail: 'bg-red-100 text-red-700', Disconnected: 'bg-red-100 text-red-700', CheckedOut: 'bg-slate-100 text-slate-600' }[s] || 'bg-slate-100 text-slate-600');
  const sLabel = (s) => ({ Submitted: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', Late: 'Ù…ØªØ£Ø®Ø±', Failed: 'ÙØ´Ù„', Active: 'ÙØ¹Ù‘Ø§Ù„', Resolved: 'ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', Open: 'Ù…ÙØªÙˆØ­Ø©', Pass: 'Ù†Ø§Ø¬Ø­', ConditionalPass: 'Ù†Ø§Ø¬Ø­ Ù…Ø´Ø±ÙˆØ·', Fail: 'ØºÙŠØ± Ù†Ø§Ø¬Ø­', Connected: 'Ù…ØªØµÙ„', Disconnected: 'ØºÙŠØ± Ù…ØªØµÙ„', Verified: 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚', Pending: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚', CheckedOut: 'ØºØ§Ø¯Ø±', PendingApproval: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', UnderReview: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' }[s] || s);
  const sevColor = (s) => ({ Critical: 'bg-red-600 text-white', High: 'bg-orange-100 text-orange-700', Medium: 'bg-amber-100 text-amber-700', Low: 'bg-blue-100 text-blue-700' }[s] || 'bg-slate-100');
  const sevLabel = (s) => ({ Critical: 'Ø­Ø±Ø¬', High: 'Ø¹Ø§Ù„ÙŠ', Medium: 'Ù…ØªÙˆØ³Ø·', Low: 'Ù…Ù†Ø®ÙØ¶' }[s] || s);
  const Bar = ({ val, max, color = 'bg-emerald-500', thin }) => (<div className="w-full bg-slate-100 rounded-full overflow-hidden" style={{ height: thin ? 6 : 20 }}><div className={`${color} rounded-full transition-all duration-500 h-full`} style={{ width: `${Math.min(100, (val / (max || 1)) * 100)}%` }} /></div>);

  // CRUD: Submissions
  const handleCreateSub = () => {
    if (!subForm.facilityId || !subForm.date || !subForm.guestCount) { notify('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡: Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡', 'error'); return; }
    const total = parseInt(subForm.guestCount), saudi = parseInt(subForm.saudiCount) || 0, foreign = parseInt(subForm.foreignCount) || 0;
    if (saudi + foreign > 0 && saudi + foreign !== total) { notify('Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ† + Ø§Ù„Ø£Ø¬Ø§Ù†Ø¨ â‰  Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'error'); return; }
    const now = new Date(), isLate = now.getHours() >= 9;
    const sub = {
      id: Date.now(), date: subForm.date, facilityId: parseInt(subForm.facilityId), guestCount: total,
      saudiCount: saudi || Math.round(total * 0.4), foreignCount: foreign || total - Math.round(total * 0.4),
      maleCount: parseInt(subForm.maleCount) || Math.round(total * 0.65), femaleCount: parseInt(subForm.femaleCount) || total - Math.round(total * 0.65), childCount: parseInt(subForm.childCount) || 0,
      submittedAt: `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`,
      status: isLate ? 'Late' : 'Submitted', submittedBy: 'Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ', type: subForm.type,
      transmissionId: `TXN-${subForm.date.replace(/-/g, '')}-${String(Date.now()).slice(-3)}`,
      responseCode: 200, retries: 0, verifiedByNIC: true, notes: subForm.notes
    };
    setSubmissions(p => [sub, ...p]);
    notify(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ${total} Ù†Ø²ÙŠÙ„${isLate ? ' âš ï¸ (Ù…ØªØ£Ø®Ø±)' : ''}`);
    setShowSubmissionWizard(false); setWizardStep(1); setSubForm(emptySubForm);
  };

  // CRUD: Guests
  const handleCreateGuest = () => {
    if (!guestForm.name || !guestForm.idNumber || !guestForm.facilityId || !guestForm.room) { notify('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŒ Ø§Ù„ØºØ±ÙØ©', 'error'); return; }
    const g = { id: Date.now(), ...guestForm, facilityId: parseInt(guestForm.facilityId), companions: parseInt(guestForm.companions) || 0, status: 'Active', verificationStatus: 'Pending', scannedAt: null, checkIn: guestForm.checkIn || new Date().toISOString().slice(0, 16).replace('T', ' ') };
    setGuests(p => [g, ...p]); notify('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²ÙŠÙ„ - ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø©');
    setShowGuestModal(false); setGuestForm(emptyGuestForm);
  };
  const verifyGuest = (id) => { setGuests(p => p.map(g => g.id === id ? { ...g, verificationStatus: 'Verified', scannedAt: new Date().toISOString().slice(0, 16).replace('T', ' ') } : g)); notify('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©'); };
  const checkoutGuest = (id) => { setGuests(p => p.map(g => g.id === id ? { ...g, status: 'CheckedOut', checkOut: new Date().toISOString().slice(0, 16).replace('T', ' ') } : g)); notify('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©'); };

  // CRUD: Facilities
  const handleCreateFac = () => {
    if (!facForm.name || !facForm.category || !facForm.city) { notify('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ÙØ¦Ø©ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'error'); return; }
    const f = { id: Date.now(), ...facForm, license: `SHM-${new Date().getFullYear()}-${String(Date.now()).slice(-5)}`, registrationDate: new Date().toISOString().split('T')[0], status: 'PendingApproval', rooms: parseInt(facForm.rooms) || 0, beds: parseInt(facForm.beds) || 0, complianceScore: 0, connectionStatus: 'Disconnected', lastPing: null, apiVersion: 'v2.1', scannerCount: 0, activeScanner: 0 };
    setFacilities(p => [...p, f]); notify('âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
    setShowFacilityModal(false); setFacForm(emptyFacForm);
  };
  const toggleConnection = (id) => { setFacilities(p => p.map(f => f.id === id ? { ...f, connectionStatus: f.connectionStatus === 'Connected' ? 'Disconnected' : 'Connected', lastPing: new Date().toISOString().slice(0, 16).replace('T', ' ') } : f)); notify('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØµØ§Ù„'); };

  // CRUD: Violations
  const handleCreateVio = () => {
    if (!vioForm.type || !vioForm.facilityId) { notify('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡: Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'error'); return; }
    const fac = getFac(parseInt(vioForm.facilityId));
    const v = { id: Date.now(), code: `VIO-SHM-${String(violations.length + 1).padStart(3, '0')}`, date: new Date().toISOString().split('T')[0], ...vioForm, facilityId: parseInt(vioForm.facilityId), facility: fac?.name || '', fine: parseInt(vioForm.fine) || 0, paidAmount: 0, status: 'Open', resolvedDate: null, resolution: '', corrective: '', appealStatus: null, referenceNumber: `MOI-REF-${new Date().getFullYear()}-${String(Date.now()).slice(-4)}` };
    setViolations(p => [v, ...p]); notify('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©');
    setShowViolationModal(false); setVioForm(emptyVioForm);
  };
  const resolveVio = (id) => { const r = prompt('ÙˆØµÙ Ø§Ù„Ø­Ù„:'); if (!r) return; const c = prompt('Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ:'); setViolations(p => p.map(v => v.id === id ? { ...v, status: 'Resolved', resolvedDate: new Date().toISOString().split('T')[0], resolution: r, corrective: c || '', paidAmount: v.fine } : v)); notify('âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©'); };
  const appealVio = (id) => { const r = prompt('Ø³Ø¨Ø¨ Ø§Ù„ØªØ¸Ù„Ù…:'); if (!r) return; setViolations(p => p.map(v => v.id === id ? { ...v, appealStatus: 'Submitted' } : v)); notify('ğŸ“¤ ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªØ¸Ù„Ù…'); };

  // CRUD: Inspections
  const handleCreateInsp = () => {
    if (!inspForm.facilityId || !inspForm.inspector) { notify('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡: Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŒ Ø§Ù„Ù…ÙØªØ´', 'error'); return; }
    const scores = Object.values(inspForm.categories), avg = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
    const result = avg >= 85 ? 'Pass' : avg >= 60 ? 'ConditionalPass' : 'Fail';
    const ins = { id: Date.now(), ...inspForm, facilityId: parseInt(inspForm.facilityId), score: avg, result, categories: { ...inspForm.categories }, findings: [] };
    setInspections(p => [ins, ...p]);
    setFacilities(p => p.map(f => f.id === parseInt(inspForm.facilityId) ? { ...f, complianceScore: avg, lastAudit: inspForm.date } : f));
    notify(`âœ… Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙØªÙŠØ´: ${sLabel(result)} (${avg}%)`);
    setShowInspectionModal(false); setInspForm(emptyInspForm);
  };

  // DELETE
  const confirmDel = (item, type) => { setDeleteTarget({ item, type }); setShowDeleteConfirm(true); };
  const execDelete = () => {
    const { item, type } = deleteTarget;
    if (type === 'sub') setSubmissions(p => p.filter(s => s.id !== item.id));
    if (type === 'guest') setGuests(p => p.filter(g => g.id !== item.id));
    if (type === 'fac') setFacilities(p => p.filter(f => f.id !== item.id));
    if (type === 'vio') setViolations(p => p.filter(v => v.id !== item.id));
    if (type === 'insp') setInspections(p => p.filter(i => i.id !== item.id));
    notify('ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù'); setShowDeleteConfirm(false); setDeleteTarget(null);
  };
  const retrySub = (id) => { setSubmissions(p => p.map(s => s.id === id ? { ...s, status: 'Submitted', responseCode: 200, retries: s.retries + 1, verifiedByNIC: true } : s)); notify('âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'); };

  // FILTERING
  const filteredSubs = useMemo(() => {
    let d = [...submissions];
    if (searchQuery) d = d.filter(s => s.date.includes(searchQuery) || s.submittedBy.includes(searchQuery) || (s.transmissionId || '').includes(searchQuery));
    if (filterStatus !== 'all') d = d.filter(s => s.status === filterStatus);
    if (filterFacility !== 'all') d = d.filter(s => s.facilityId === parseInt(filterFacility));
    return d.sort((a, b) => b.date.localeCompare(a.date) || b.submittedAt.localeCompare(a.submittedAt));
  }, [submissions, searchQuery, filterStatus, filterFacility]);
  const filteredGuests = useMemo(() => {
    let d = [...guests];
    if (searchQuery) d = d.filter(g => g.name.includes(searchQuery) || g.idNumber.includes(searchQuery) || g.room.includes(searchQuery));
    if (filterStatus !== 'all') d = d.filter(g => g.status === filterStatus || g.verificationStatus === filterStatus);
    if (filterFacility !== 'all') d = d.filter(g => g.facilityId === parseInt(filterFacility));
    return d;
  }, [guests, searchQuery, filterStatus, filterFacility]);

  const tabs = [
    { id: 'dashboard', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard },
    { id: 'submissions', label: 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª', icon: FileText, badge: stats.failed > 0 ? stats.failed : null },
    { id: 'guests', label: 'Ø§Ù„Ù†Ø²Ù„Ø§Ø¡', icon: Users, badge: stats.pendingVerify > 0 ? stats.pendingVerify : null },
    { id: 'facilities', label: 'Ø§Ù„Ù…Ù†Ø´Ø¢Øª', icon: Building2, badge: stats.disconnectedFac > 0 ? stats.disconnectedFac : null },
    { id: 'violations', label: 'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª', icon: AlertTriangle, badge: stats.openVio > 0 ? stats.openVio : null },
    { id: 'inspections', label: 'Ø§Ù„ØªÙØªÙŠØ´Ø§Øª', icon: ClipboardCheck },
    { id: 'transmission', label: 'Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', icon: Activity },
  ];

  // â•â•â• RENDER â•â•â•
  return (
    <div className="space-y-5">
      {notification && (
        <div className={`fixed top-20 left-1/2 -translate-x-1/2 z-[80] px-6 py-3 rounded-2xl shadow-2xl text-white font-bold flex items-center gap-3 ${notification.type === 'success' ? 'bg-gradient-to-r from-emerald-500 to-teal-600' : 'bg-gradient-to-r from-red-500 to-rose-600'}`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertCircle className="w-5 h-5" />}
          {notification.message}
          <button onClick={() => setNotification(null)} className="ml-2 opacity-70 hover:opacity-100"><X className="w-4 h-4" /></button>
        </div>
      )}

      {/* HEADER + KPIs */}
      <div className="bg-gradient-to-r from-orange-500 via-red-500 to-rose-600 rounded-2xl overflow-hidden shadow-xl">
        <div className="p-6">
          <div className="flex items-center justify-between mb-5">
            <div className="flex items-center gap-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center text-3xl shadow-lg">ğŸ›¡ï¸</div>
              <div><h2 className="text-2xl font-black text-white">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù…ØªØ«Ø§Ù„ Ø´Ù…ÙˆØ³</h2><p className="text-orange-200 text-sm">MOI Shomoos Compliance Management â€¢ {selectedPeriod}</p></div>
            </div>
            <div className="flex items-center gap-2">
              <button onClick={() => { setWizardStep(1); setSubForm(emptySubForm); setShowSubmissionWizard(true); }} className="flex items-center gap-2 px-5 py-2.5 bg-white text-red-600 rounded-xl font-bold hover:shadow-lg text-sm"><Send className="w-4 h-4" /> Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙŠÙˆÙ…ÙŠØ©</button>
              <button onClick={() => { setGuestForm(emptyGuestForm); setShowGuestModal(true); }} className="flex items-center gap-2 px-4 py-2.5 bg-white/20 hover:bg-white/30 rounded-xl font-bold text-white text-sm"><UserPlus className="w-4 h-4" /> Ù†Ø²ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
              <button onClick={() => { ExportUtils.toCSV(submissions.map(s => ({ Ø§Ù„ØªØ§Ø±ÙŠØ®: s.date, Ø§Ù„Ù…Ù†Ø´Ø£Ø©: getFacName(s.facilityId), Ø§Ù„Ù†Ø²Ù„Ø§Ø¡: s.guestCount, Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ†: s.saudiCount, Ø£Ø¬Ø§Ù†Ø¨: s.foreignCount, Ø§Ù„ÙˆÙ‚Øª: s.submittedAt, Ø§Ù„Ø­Ø§Ù„Ø©: sLabel(s.status), Ø¨ÙˆØ§Ø³Ø·Ø©: s.submittedBy })), `shomoos-${selectedPeriod}.csv`); notify('ğŸ“¥ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±'); }} className="p-2.5 bg-white/20 hover:bg-white/30 rounded-xl text-white" title="ØªØµØ¯ÙŠØ± CSV"><Download className="w-5 h-5" /></button>
            </div>
          </div>
          <div className="grid grid-cols-3 md:grid-cols-6 gap-3">
            {[
              { icon: 'ğŸ“Š', l: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', v: `${stats.complianceRate}%`, sub: `${stats.onTime}/${stats.totalSubs}`, alert: stats.complianceRate < 80 },
              { icon: 'ğŸ‘¥', l: 'Ù†Ø²Ù„Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…', v: stats.todayGuests, sub: `${stats.todayCount} ØªØ³Ø¬ÙŠÙ„Ø§Øª` },
              { icon: 'ğŸ¨', l: 'Ù†Ø²Ù„Ø§Ø¡ Ø­Ø§Ù„ÙŠÙˆÙ†', v: stats.activeGuests, sub: stats.pendingVerify > 0 ? `âš ï¸ ${stats.pendingVerify} Ø¨Ø§Ù†ØªØ¸Ø§Ø±` : 'âœ… Ø§Ù„ÙƒÙ„ Ù…ØªØ­Ù‚Ù‚', alert: stats.pendingVerify > 0 },
              { icon: 'ğŸ”—', l: 'Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ‚Ù†ÙŠ', v: `${stats.connectedFac}/${facilities.length}`, sub: stats.disconnectedFac > 0 ? `âŒ ${stats.disconnectedFac} ØºÙŠØ± Ù…ØªØµÙ„` : 'âœ… Ø§Ù„ÙƒÙ„ Ù…ØªØµÙ„', alert: stats.disconnectedFac > 0 },
              { icon: 'âš ï¸', l: 'Ù…Ø®Ø§Ù„ÙØ§Øª Ù…ÙØªÙˆØ­Ø©', v: stats.openVio, sub: stats.critVio > 0 ? `ğŸ”´ ${stats.critVio} Ø­Ø±Ø¬Ø©` : 'Ù„Ø§ Ø­Ø±Ø¬Ø©', alert: stats.critVio > 0 },
              { icon: 'ğŸ’°', l: 'ØºØ±Ø§Ù…Ø§Øª Ù…Ø¹Ù„Ù‚Ø©', v: `${(stats.unpaidFines / 1000).toFixed(0)}K`, sub: `${(stats.totalFines / 1000).toFixed(0)}K Ø¥Ø¬Ù…Ø§Ù„ÙŠ`, alert: stats.unpaidFines > 0 },
            ].map((kpi, i) => (
              <div key={i} className={`rounded-xl p-3 ${kpi.alert ? 'bg-white/25 ring-2 ring-yellow-300/60' : 'bg-white/10'}`}>
                <div className="flex items-center gap-1 mb-1"><span className="text-sm">{kpi.icon}</span><span className="text-orange-200 text-[10px]">{kpi.l}</span></div>
                <p className="text-2xl font-black text-white">{kpi.v}</p>
                <p className={`text-[10px] ${kpi.alert ? 'text-yellow-200 font-bold' : 'text-orange-300'}`}>{kpi.sub}</p>
              </div>
            ))}
          </div>
        </div>
        <div className="bg-black/10 px-6 py-3">
          <div className="flex items-center gap-3">
            <span className="text-orange-200 text-xs font-bold">Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…:</span>
            <div className="flex items-end gap-1 h-8 flex-1">
              {last7Days.map((d, i) => (
                <div key={i} className="flex-1 flex flex-col items-center gap-0.5" title={`${d.date}: ${d.count} Ù†Ø²ÙŠÙ„`}>
                  <div className="w-full bg-white/30 rounded-t" style={{ height: `${Math.max(4, (d.count / Math.max(...last7Days.map(x => x.count || 1))) * 28)}px` }} />
                  <span className="text-[8px] text-orange-200">{d.day}</span>
                </div>
              ))}
            </div>
            <span className="text-orange-200 text-xs">Ø§Ù„Ø£Ø¹Ù„Ù‰: {Math.max(...last7Days.map(d => d.count))}</span>
          </div>
        </div>
      </div>

      {/* TABS */}
      <div className="flex items-center gap-1.5 bg-slate-100 p-1.5 rounded-xl overflow-x-auto">
        {tabs.map(t => (
          <button key={t.id} onClick={() => { setActiveTab(t.id); setSearchQuery(''); setFilterStatus('all'); setFilterFacility('all'); }}
            className={`relative flex items-center gap-1.5 px-3 py-2.5 rounded-lg font-bold text-sm whitespace-nowrap ${activeTab === t.id ? 'bg-white shadow-md text-red-700' : 'text-slate-500 hover:text-slate-700 hover:bg-white/50'}`}>
            <t.icon className="w-4 h-4" /> {t.label}
            {t.badge && <span className="absolute -top-1 -left-1 w-5 h-5 bg-red-500 text-white text-[10px] font-black rounded-full flex items-center justify-center">{t.badge}</span>}
          </button>
        ))}
      </div>

      {/* SEARCH BAR */}
      {activeTab !== 'dashboard' && activeTab !== 'transmission' && (
        <div className="flex items-center gap-3 flex-wrap">
          <div className="relative flex-1 min-w-[220px]">
            <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
            <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)}
              className="w-full pr-10 pl-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm focus:border-red-400 focus:outline-none" />
          </div>
          <select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} className="px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm font-bold">
            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            {activeTab === 'submissions' && <><option value="Submitted">âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</option><option value="Late">â° Ù…ØªØ£Ø®Ø±</option><option value="Failed">âŒ ÙØ´Ù„</option></>}
            {activeTab === 'guests' && <><option value="Active">ğŸŸ¢ Ø­Ø§Ù„ÙŠ</option><option value="CheckedOut">âšª ØºØ§Ø¯Ø±</option><option value="Pending">ğŸŸ¡ Ø¨Ø§Ù†ØªØ¸Ø§Ø±</option></>}
            {activeTab === 'violations' && <><option value="Open">ğŸ”´ Ù…ÙØªÙˆØ­Ø©</option><option value="Resolved">âœ… ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option></>}
          </select>
          <select value={filterFacility} onChange={e => setFilterFacility(e.target.value)} className="px-3 py-2.5 border-2 border-slate-200 rounded-xl text-sm font-bold">
            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª</option>
            {facilities.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
          </select>
          {activeTab === 'submissions' && <button onClick={() => { setWizardStep(1); setSubForm(emptySubForm); setShowSubmissionWizard(true); }} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-bold text-sm"><Plus className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>}
          {activeTab === 'guests' && <button onClick={() => setShowGuestModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold text-sm"><UserPlus className="w-4 h-4" /> Ù†Ø²ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>}
          {activeTab === 'facilities' && <button onClick={() => setShowFacilityModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold text-sm"><Building2 className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ù…Ù†Ø´Ø£Ø©</button>}
          {activeTab === 'violations' && <button onClick={() => setShowViolationModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold text-sm"><AlertTriangle className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ©</button>}
          {activeTab === 'inspections' && <button onClick={() => setShowInspectionModal(true)} className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold text-sm"><ClipboardCheck className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ ØªÙØªÙŠØ´</button>}
        </div>
      )}

      {/* DASHBOARD TAB */}
      {activeTab === 'dashboard' && (
        <div className="space-y-5">
          {(stats.pendingVerify > 0 || stats.critVio > 0 || stats.failed > 0 || stats.disconnectedFac > 0) && (
            <div className="space-y-2">
              {stats.pendingVerify > 0 && <div className="flex items-center gap-3 bg-amber-50 border-2 border-amber-200 rounded-xl px-4 py-3"><AlertCircle className="w-5 h-5 text-amber-600 flex-shrink-0" /><span className="text-sm font-bold text-amber-800">â° {stats.pendingVerify} Ù†Ø²ÙŠÙ„ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚ - Ø§Ù„Ø­Ø¯ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©</span><button onClick={() => setActiveTab('guests')} className="mr-auto px-3 py-1 bg-amber-200 text-amber-800 rounded-lg text-xs font-bold">Ø¹Ø±Ø¶</button></div>}
              {stats.critVio > 0 && <div className="flex items-center gap-3 bg-red-50 border-2 border-red-200 rounded-xl px-4 py-3"><AlertTriangle className="w-5 h-5 text-red-600 flex-shrink-0" /><span className="text-sm font-bold text-red-800">ğŸ”´ {stats.critVio} Ù…Ø®Ø§Ù„ÙØ© Ø­Ø±Ø¬Ø© ØªØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ</span><button onClick={() => setActiveTab('violations')} className="mr-auto px-3 py-1 bg-red-200 text-red-800 rounded-lg text-xs font-bold">Ø¹Ø±Ø¶</button></div>}
              {stats.failed > 0 && <div className="flex items-center gap-3 bg-red-50 border-2 border-red-200 rounded-xl px-4 py-3"><XCircle className="w-5 h-5 text-red-600 flex-shrink-0" /><span className="text-sm font-bold text-red-800">âŒ {stats.failed} Ø¥Ø±Ø³Ø§Ù„ ÙØ§Ø´Ù„ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø©</span><button onClick={() => setActiveTab('submissions')} className="mr-auto px-3 py-1 bg-red-200 text-red-800 rounded-lg text-xs font-bold">Ø¹Ø±Ø¶</button></div>}
              {stats.disconnectedFac > 0 && <div className="flex items-center gap-3 bg-orange-50 border-2 border-orange-200 rounded-xl px-4 py-3"><Activity className="w-5 h-5 text-orange-600 flex-shrink-0" /><span className="text-sm font-bold text-orange-800">ğŸ”Œ {stats.disconnectedFac} Ù…Ù†Ø´Ø£Ø© ØºÙŠØ± Ù…ØªØµÙ„Ø©</span><button onClick={() => setActiveTab('facilities')} className="mr-auto px-3 py-1 bg-orange-200 text-orange-800 rounded-lg text-xs font-bold">Ø¹Ø±Ø¶</button></div>}
            </div>
          )}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
            {facilities.map(f => {
              const fs = submissions.filter(s => s.facilityId === f.id), fg = guests.filter(g => g.facilityId === f.id && g.status === 'Active'), fv = violations.filter(v => v.facilityId === f.id && v.status === 'Open'); return (
                <div key={f.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-lg transition-all">
                  <div className={`h-1.5 ${f.complianceScore >= 85 ? 'bg-emerald-500' : f.complianceScore >= 60 ? 'bg-amber-500' : 'bg-red-500'}`} />
                  <div className="p-4">
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center gap-2"><div className={`w-3 h-3 rounded-full ${f.connectionStatus === 'Connected' ? 'bg-emerald-500 animate-pulse' : 'bg-red-500'}`} /><span className="font-bold text-slate-800 text-sm">{f.name}</span></div>
                      <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(f.connectionStatus)}`}>{sLabel(f.connectionStatus)}</span>
                    </div>
                    <div className="mb-3"><div className="flex justify-between text-xs mb-1"><span className="text-slate-500">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span><span className={`font-black ${f.complianceScore >= 85 ? 'text-emerald-600' : f.complianceScore >= 60 ? 'text-amber-600' : 'text-red-600'}`}>{f.complianceScore}%</span></div><Bar val={f.complianceScore} max={100} color={f.complianceScore >= 85 ? 'bg-emerald-500' : f.complianceScore >= 60 ? 'bg-amber-500' : 'bg-red-500'} thin /></div>
                    <div className="grid grid-cols-4 gap-2 text-center">
                      {[{ v: fs.length, l: 'ØªØ³Ø¬ÙŠÙ„Ø§Øª', c: 'text-blue-600' }, { v: fg.length, l: 'Ù†Ø²Ù„Ø§Ø¡', c: 'text-emerald-600' }, { v: f.rooms, l: 'ØºØ±ÙØ©', c: 'text-slate-600' }, { v: fv.length, l: 'Ù…Ø®Ø§Ù„ÙØ§Øª', c: fv.length > 0 ? 'text-red-600' : 'text-slate-600' }].map((s, i) => (
                        <div key={i} className="bg-slate-50 rounded-lg py-1.5"><p className={`text-sm font-black ${s.c}`}>{s.v}</p><p className="text-[9px] text-slate-500">{s.l}</p></div>
                      ))}
                    </div>
                    <div className="flex gap-2 mt-3 text-[10px] text-slate-500"><span>ğŸ“ {f.city}</span><span>ğŸ”§ {f.activeScanner}/{f.scannerCount}</span><span>ğŸ“¡ {f.apiVersion}</span></div>
                  </div>
                </div>
              );
            })}
          </div>
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
              <h3 className="font-bold text-slate-800 mb-3 flex items-center gap-2"><FileText className="w-4 h-4 text-orange-500" /> Ø¢Ø®Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h3>
              {submissions.slice(0, 5).map(s => (
                <div key={s.id} className="flex items-center justify-between py-2 border-b border-slate-100 last:border-0">
                  <div className="flex items-center gap-2"><span className={`w-2 h-2 rounded-full ${s.status === 'Submitted' ? 'bg-emerald-500' : s.status === 'Late' ? 'bg-amber-500' : 'bg-red-500'}`} /><span className="text-sm font-bold text-slate-700">{s.date}</span><span className="text-xs text-slate-400">{getFacName(s.facilityId)}</span></div>
                  <div className="flex items-center gap-2"><span className="text-sm font-bold">{s.guestCount}</span><span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(s.status)}`}>{sLabel(s.status)}</span></div>
                </div>
              ))}
            </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-4">
              <h3 className="font-bold text-slate-800 mb-3 flex items-center gap-2"><Users className="w-4 h-4 text-blue-500" /> Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h3>
              {guests.filter(g => g.status === 'Active').slice(0, 5).map(g => (
                <div key={g.id} className="flex items-center justify-between py-2 border-b border-slate-100 last:border-0">
                  <div className="flex items-center gap-2"><div className={`w-7 h-7 rounded-full flex items-center justify-center text-white text-[10px] font-bold ${g.nationalityCode === 'SA' ? 'bg-emerald-500' : 'bg-blue-500'}`}>{g.name.charAt(0)}</div><div><span className="text-sm font-bold text-slate-700">{g.name}</span><span className="text-xs text-slate-400 block">ØºØ±ÙØ© {g.room}</span></div></div>
                  <div className="flex items-center gap-1"><span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(g.verificationStatus)}`}>{sLabel(g.verificationStatus)}</span>
                    {g.verificationStatus === 'Pending' && <button onClick={() => verifyGuest(g.id)} className="p-1 bg-emerald-100 text-emerald-600 rounded hover:bg-emerald-200"><CheckCircle2 className="w-3.5 h-3.5" /></button>}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* SUBMISSIONS TAB */}
      {activeTab === 'submissions' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <div className="overflow-x-auto"><table className="w-full text-sm">
            <thead className="bg-slate-50 border-b-2 border-slate-200"><tr>
              {['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'Ø§Ù„Ù†Ø²Ù„Ø§Ø¡', 'Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ†/Ø£Ø¬Ø§Ù†Ø¨', 'Ø°ÙƒÙˆØ±/Ø¥Ù†Ø§Ø«', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„Ù†ÙˆØ¹', 'Ø¨ÙˆØ§Ø³Ø·Ø©', 'NIC', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª'].map((h, i) => <th key={i} className={`py-3 px-3 font-bold text-slate-600 ${i === 10 ? 'text-center' : 'text-right'}`}>{h}</th>)}
            </tr></thead>
            <tbody>{filteredSubs.length === 0 ? <tr><td colSpan={11} className="py-16 text-center"><Inbox className="w-12 h-12 text-slate-300 mx-auto mb-2" /><p className="text-slate-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª</p></td></tr> : filteredSubs.map(s => (
              <tr key={s.id} className={`border-t border-slate-100 hover:bg-orange-50/30 ${s.status === 'Failed' ? 'bg-red-50/30' : ''}`}>
                <td className="py-2.5 px-3 font-bold text-slate-800">{s.date}</td>
                <td className="py-2.5 px-3 text-xs text-slate-600 max-w-[120px] truncate">{getFacName(s.facilityId)}</td>
                <td className="py-2.5 px-3"><span className="text-lg font-black text-slate-800">{s.guestCount}</span></td>
                <td className="py-2.5 px-3 text-xs"><span className="text-emerald-600 font-bold">{s.saudiCount}</span><span className="text-slate-300 mx-1">/</span><span className="text-blue-600 font-bold">{s.foreignCount}</span></td>
                <td className="py-2.5 px-3 text-xs">{s.maleCount}â™‚ / {s.femaleCount}â™€{s.childCount > 0 && <span className="text-amber-600 ml-0.5">+{s.childCount}ğŸ‘¶</span>}</td>
                <td className="py-2.5 px-3 font-mono text-xs">{s.submittedAt}</td>
                <td className="py-2.5 px-3"><span className={`px-2 py-0.5 rounded-full text-[10px] font-bold ${sColor(s.status)}`}>{sLabel(s.status)}</span></td>
                <td className="py-2.5 px-3"><span className={`px-1.5 py-0.5 rounded text-[10px] font-bold ${s.type === 'auto' ? 'bg-blue-50 text-blue-600' : s.type === 'manual' ? 'bg-amber-50 text-amber-600' : 'bg-purple-50 text-purple-600'}`}>{s.type === 'auto' ? 'Ø¢Ù„ÙŠ' : s.type === 'manual' ? 'ÙŠØ¯ÙˆÙŠ' : 'ØªØµØ­ÙŠØ­'}</span></td>
                <td className="py-2.5 px-3 text-xs text-slate-500">{s.submittedBy}</td>
                <td className="py-2.5 px-3">{s.verifiedByNIC ? <CheckCircle2 className="w-4 h-4 text-emerald-500" /> : <XCircle className="w-4 h-4 text-red-400" />}</td>
                <td className="py-2.5 px-3"><div className="flex items-center justify-center gap-1">
                  <button onClick={() => { setDetailItem(s); setShowDetailPanel(true) }} className="p-1 bg-slate-100 text-slate-500 rounded hover:bg-slate-200" title="ØªÙØ§ØµÙŠÙ„"><Eye className="w-3.5 h-3.5" /></button>
                  {s.status === 'Failed' && <button onClick={() => retrySub(s.id)} className="p-1 bg-orange-100 text-orange-600 rounded hover:bg-orange-200" title="Ø¥Ø¹Ø§Ø¯Ø©"><RefreshCw className="w-3.5 h-3.5" /></button>}
                  <button onClick={() => confirmDel(s, 'sub')} className="p-1 bg-red-100 text-red-500 rounded hover:bg-red-200"><Trash2 className="w-3.5 h-3.5" /></button>
                </div></td>
              </tr>))}</tbody>
          </table></div>
          <div className="px-4 py-2.5 bg-slate-50 border-t border-slate-200 flex justify-between text-xs text-slate-500">
            <span>{filteredSubs.length} ØªØ³Ø¬ÙŠÙ„</span>
            <div className="flex gap-4"><span>âœ… {filteredSubs.filter(s => s.status === 'Submitted').length}</span><span>â° {filteredSubs.filter(s => s.status === 'Late').length}</span><span>âŒ {filteredSubs.filter(s => s.status === 'Failed').length}</span><span>Ø§Ù„Ù†Ø²Ù„Ø§Ø¡: {filteredSubs.reduce((a, r) => a + r.guestCount, 0)}</span></div>
          </div>
        </div>
      )}

      {/* GUESTS TAB */}
      {activeTab === 'guests' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden"><div className="overflow-x-auto"><table className="w-full text-sm">
          <thead className="bg-slate-50 border-b-2 border-slate-200"><tr>
            {['Ø§Ù„Ù†Ø²ÙŠÙ„', 'Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø§Ù„Ø¬Ù†Ø³ÙŠØ©', 'Ø§Ù„ØºØ±ÙØ©', 'Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Ø§Ù„ØºØ±Ø¶', 'Ø§Ù„ØªØ­Ù‚Ù‚', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª'].map((h, i) => <th key={i} className={`py-3 px-3 font-bold text-slate-600 ${i === 9 ? 'text-center' : 'text-right'}`}>{h}</th>)}
          </tr></thead>
          <tbody>{filteredGuests.length === 0 ? <tr><td colSpan={10} className="py-16 text-center"><Users className="w-12 h-12 text-slate-300 mx-auto mb-2" /><p className="text-slate-500 font-bold">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø²Ù„Ø§Ø¡</p></td></tr> : filteredGuests.map(g => (
            <tr key={g.id} className={`border-t border-slate-100 hover:bg-blue-50/30 ${g.verificationStatus === 'Pending' ? 'bg-amber-50/20' : ''}`}>
              <td className="py-2.5 px-3"><div className="flex items-center gap-2"><div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold ${g.nationalityCode === 'SA' ? 'bg-emerald-500' : 'bg-blue-500'}`}>{g.name.charAt(0)}</div><div><span className="font-bold text-slate-800 text-xs">{g.name}</span><span className="text-[10px] text-slate-400 block">{g.gender === 'male' ? 'â™‚' : 'â™€'}{g.companions > 0 ? ` +${g.companions}` : ''}</span></div></div></td>
              <td className="py-2.5 px-3"><span className="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded">{g.idNumber}</span><div className="text-[10px] text-slate-400">{g.idType}</div></td>
              <td className="py-2.5 px-3 text-xs">{g.nationality}</td>
              <td className="py-2.5 px-3 font-bold">{g.room}<span className="text-[10px] text-slate-400 block">Ø·{g.floor}</span></td>
              <td className="py-2.5 px-3 text-xs text-slate-500">{getFacName(g.facilityId)}</td>
              <td className="py-2.5 px-3 text-xs">{g.checkIn?.split(' ')[0]}</td>
              <td className="py-2.5 px-3 text-xs">{g.purpose}</td>
              <td className="py-2.5 px-3"><span className={`px-2 py-0.5 rounded-full text-[10px] font-bold ${sColor(g.verificationStatus)}`}>{sLabel(g.verificationStatus)}</span></td>
              <td className="py-2.5 px-3"><span className={`px-2 py-0.5 rounded-full text-[10px] font-bold ${sColor(g.status)}`}>{sLabel(g.status)}</span></td>
              <td className="py-2.5 px-3"><div className="flex items-center justify-center gap-1">
                {g.verificationStatus === 'Pending' && <button onClick={() => verifyGuest(g.id)} className="p-1 bg-emerald-100 text-emerald-600 rounded hover:bg-emerald-200" title="ØªØ­Ù‚Ù‚"><UserCheck className="w-3.5 h-3.5" /></button>}
                {g.status === 'Active' && <button onClick={() => checkoutGuest(g.id)} className="p-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200" title="Ù…ØºØ§Ø¯Ø±Ø©"><LogOut className="w-3.5 h-3.5" /></button>}
                <button onClick={() => confirmDel(g, 'guest')} className="p-1 bg-red-100 text-red-500 rounded hover:bg-red-200"><Trash2 className="w-3.5 h-3.5" /></button>
              </div></td>
            </tr>))}</tbody>
        </table></div></div>
      )}

      {/* FACILITIES TAB */}
      {activeTab === 'facilities' && (
        <div className="grid grid-cols-1 gap-4">{facilities.map(f => (
          <div key={f.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-lg">
            <div className={`h-1.5 ${f.complianceScore >= 85 ? 'bg-emerald-500' : f.complianceScore >= 60 ? 'bg-amber-500' : 'bg-red-500'}`} />
            <div className="p-5">
              <div className="flex items-start justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-lg ${f.connectionStatus === 'Connected' ? 'bg-emerald-100' : 'bg-red-100'}`}>ğŸ¨</div>
                  <div>
                    <h3 className="font-bold text-slate-800">{f.name}</h3><p className="text-xs text-slate-400">{f.nameEn}</p>
                    <div className="flex items-center gap-2 mt-1">
                      <span className="font-mono text-[10px] bg-slate-100 px-1.5 py-0.5 rounded">{f.license}</span>
                      <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(f.status)}`}>{sLabel(f.status)}</span>
                      <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(f.connectionStatus)}`}>{sLabel(f.connectionStatus)}</span>
                    </div>
                  </div>
                </div>
                <div className="flex gap-1">
                  <button onClick={() => toggleConnection(f.id)} className={`p-2 rounded-xl ${f.connectionStatus === 'Connected' ? 'bg-red-100 text-red-600' : 'bg-emerald-100 text-emerald-600'}`} title={f.connectionStatus === 'Connected' ? 'Ù‚Ø·Ø¹' : 'Ø§ØªØµØ§Ù„'}><Activity className="w-4 h-4" /></button>
                  <button onClick={() => confirmDel(f, 'fac')} className="p-2 bg-red-100 text-red-600 rounded-xl"><Trash2 className="w-4 h-4" /></button>
                </div>
              </div>
              <div className="grid grid-cols-6 gap-3 mb-3">
                {[{ v: `${f.complianceScore}%`, l: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', c: f.complianceScore >= 85 ? 'text-emerald-600' : f.complianceScore >= 60 ? 'text-amber-600' : 'text-red-600' }, { v: f.rooms, l: 'ØºØ±ÙØ©', c: 'text-slate-700' }, { v: f.beds || 0, l: 'Ø³Ø±ÙŠØ±', c: 'text-slate-700' }, { v: `${f.activeScanner}/${f.scannerCount}`, l: 'Ø£Ø¬Ù‡Ø²Ø© Ù…Ø³Ø­', c: f.activeScanner < f.scannerCount ? 'text-amber-600' : 'text-emerald-600' }, { v: submissions.filter(s => s.facilityId === f.id).length, l: 'ØªØ³Ø¬ÙŠÙ„Ø§Øª', c: 'text-blue-600' }, { v: violations.filter(v => v.facilityId === f.id && v.status === 'Open').length, l: 'Ù…Ø®Ø§Ù„ÙØ§Øª', c: 'text-red-600' }].map((s, i) => (
                  <div key={i} className="text-center bg-slate-50 rounded-xl p-2"><p className={`text-lg font-black ${s.c}`}>{s.v}</p><p className="text-[10px] text-slate-500">{s.l}</p></div>
                ))}
              </div>
              <div className="flex flex-wrap gap-3 text-[10px] text-slate-500 border-t border-slate-100 pt-3">
                <span>ğŸ“ {f.city} - {f.district}</span><span>ğŸ·ï¸ {f.category}</span><span>ğŸ‘¤ {f.contactPerson} ({f.contactPhone})</span><span>ğŸ“§ {f.contactEmail}</span><span>ğŸ†” {f.crNumber}</span><span>ğŸ“¡ {f.apiVersion}</span>{f.lastPing && <span>ğŸ• {f.lastPing}</span>}{f.lastAudit && <span>ğŸ” {f.lastAudit}</span>}
              </div>
            </div>
          </div>
        ))}</div>
      )}

      {/* VIOLATIONS TAB */}
      {activeTab === 'violations' && (
        <div className="space-y-4">{violations.length === 0 ? <div className="bg-white rounded-2xl border-2 border-slate-200 text-center py-16"><CheckCircle2 className="w-16 h-16 text-emerald-400 mx-auto mb-3" /><p className="text-lg font-bold text-emerald-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª ğŸ‰</p></div> : violations.map(v => (
          <div key={v.id} className={`bg-white rounded-2xl border-2 overflow-hidden ${v.status === 'Open' ? v.severity === 'Critical' ? 'border-red-300 shadow-red-100 shadow-lg' : 'border-orange-200' : 'border-slate-200'}`}>
            <div className={`h-1.5 ${v.severity === 'Critical' ? 'bg-red-600' : v.severity === 'High' ? 'bg-orange-500' : 'bg-amber-500'}`} />
            <div className="p-5">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-2 flex-wrap mb-2">
                    <span className="font-mono text-xs bg-slate-100 px-2 py-0.5 rounded">{v.code}</span>
                    <span className="font-mono text-[10px] bg-slate-50 px-1.5 py-0.5 rounded text-slate-400">{v.referenceNumber}</span>
                    <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sevColor(v.severity)}`}>{sevLabel(v.severity)}</span>
                    <span className={`px-2 py-0.5 rounded-full text-[10px] font-bold ${sColor(v.status)}`}>{sLabel(v.status)}</span>
                    {v.appealStatus && <span className="px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 text-purple-700">ØªØ¸Ù„Ù…: {v.appealStatus === 'Submitted' ? 'Ù…Ù‚Ø¯Ù…' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}</span>}
                  </div>
                  <h3 className="font-bold text-slate-800 text-lg mb-1">{v.type}</h3>
                  <p className="text-sm text-slate-500">{v.description}</p>
                  <div className="flex gap-4 mt-2 text-xs text-slate-500"><span>ğŸ¢ {v.facility}</span><span>ğŸ“… {v.date}</span><span>ğŸ‘® {v.inspector}</span></div>
                </div>
                <div className="text-left mr-6 flex-shrink-0"><p className="text-3xl font-black text-red-600">{v.fine?.toLocaleString()}</p><p className="text-[10px] text-slate-500">Ø±ÙŠØ§Ù„</p>{v.paidAmount > 0 && <p className="text-xs text-emerald-600 font-bold mt-1">ğŸ’° Ù…Ø¯ÙÙˆØ¹</p>}</div>
              </div>
              {v.status === 'Open' && (<div className="flex gap-2 mt-4 pt-3 border-t border-slate-100">
                <button onClick={() => resolveVio(v.id)} className="flex items-center gap-1.5 px-4 py-2 bg-emerald-100 text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-200"><CheckCircle2 className="w-4 h-4" />Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
                {!v.appealStatus && <button onClick={() => appealVio(v.id)} className="flex items-center gap-1.5 px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-bold text-sm hover:bg-purple-200"><Scale className="w-4 h-4" />ØªØ¸Ù„Ù…</button>}
                <button onClick={() => confirmDel(v, 'vio')} className="flex items-center gap-1.5 px-4 py-2 bg-red-100 text-red-700 rounded-xl font-bold text-sm mr-auto"><Trash2 className="w-4 h-4" /></button>
              </div>)}
              {v.status === 'Resolved' && v.resolution && (<div className="mt-3 pt-3 border-t border-slate-100 space-y-1">
                <p className="text-sm"><span className="font-bold text-emerald-700">âœ… Ø§Ù„Ø­Ù„:</span> {v.resolution}</p>
                {v.corrective && <p className="text-sm"><span className="font-bold text-blue-700">ğŸ›¡ï¸ Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠ:</span> {v.corrective}</p>}
                <p className="text-xs text-slate-400">Ø¥ØºÙ„Ø§Ù‚: {v.resolvedDate}</p>
              </div>)}
            </div>
          </div>
        ))}</div>
      )}

      {/* INSPECTIONS TAB */}
      {activeTab === 'inspections' && (
        <div className="space-y-4">{inspections.map(ins => {
          const fac = getFac(ins.facilityId); return (
            <div key={ins.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-lg">
              <div className={`h-1.5 ${ins.result === 'Pass' ? 'bg-emerald-500' : ins.result === 'ConditionalPass' ? 'bg-amber-500' : 'bg-red-500'}`} />
              <div className="p-5">
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-4">
                    <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${ins.result === 'Pass' ? 'bg-emerald-100' : ins.result === 'ConditionalPass' ? 'bg-amber-100' : 'bg-red-100'}`}>
                      <div className="text-center"><p className={`text-xl font-black ${ins.result === 'Pass' ? 'text-emerald-700' : ins.result === 'ConditionalPass' ? 'text-amber-700' : 'text-red-700'}`}>{ins.score}%</p><p className="text-[8px] font-bold text-slate-500">{sLabel(ins.result)}</p></div>
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800">{fac?.name || 'â€”'}</h3>
                      <div className="flex items-center gap-3 mt-1 text-xs text-slate-500">
                        <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sColor(ins.result)}`}>{sLabel(ins.result)}</span>
                        <span className="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100">{ins.type}</span>
                        <span>ğŸ“… {ins.date}</span><span>ğŸ‘® {ins.inspector}</span>
                      </div>
                    </div>
                  </div>
                  <button onClick={() => confirmDel(ins, 'insp')} className="p-2 bg-red-100 text-red-600 rounded-xl"><Trash2 className="w-4 h-4" /></button>
                </div>
                {ins.categories && <div className="grid grid-cols-5 gap-3 mb-3">{Object.entries(ins.categories).map(([cat, score]) => (
                  <div key={cat} className="text-center"><Bar val={score} max={100} color={score >= 85 ? 'bg-emerald-500' : score >= 60 ? 'bg-amber-500' : 'bg-red-500'} thin /><p className={`text-sm font-bold mt-1 ${score >= 85 ? 'text-emerald-600' : score >= 60 ? 'text-amber-600' : 'text-red-600'}`}>{score}%</p><p className="text-[9px] text-slate-500">{cat}</p></div>
                ))}</div>}
                {ins.findings?.length > 0 && <div className="mt-3 pt-3 border-t border-slate-100"><p className="text-xs font-bold text-slate-600 mb-2">ğŸ“‹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</p>{ins.findings.map((f, i) => (<div key={i} className="flex items-center gap-2 text-xs mb-1"><span className={`px-1.5 py-0.5 rounded text-[9px] font-bold ${sevColor(f.severity)}`}>{sevLabel(f.severity)}</span><span className="text-slate-600">{f.text}</span></div>))}</div>}
                {ins.notes && <p className="text-xs text-slate-500 mt-2 pt-2 border-t border-slate-100">ğŸ’¬ {ins.notes}</p>}
                {ins.nextInspection && <p className="text-xs text-blue-600 font-bold mt-1">â­ï¸ Ø§Ù„Ù‚Ø§Ø¯Ù…: {ins.nextInspection}</p>}
              </div>
            </div>
          );
        })}</div>
      )}

      {/* TRANSMISSION LOG TAB */}
      {activeTab === 'transmission' && (
        <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
          <div className="bg-slate-900 text-emerald-400 font-mono text-xs p-4 max-h-[500px] overflow-y-auto" style={{ direction: 'ltr' }}>
            <p className="text-slate-500 mb-2">// Shomoos NIC Gateway - Transmission Log</p>
            {transmissionLog.map(l => (
              <div key={l.id} className={`mb-2 ${l.status === 'SUCCESS' ? 'text-emerald-400' : l.status === 'TIMEOUT' ? 'text-amber-400' : 'text-red-400'}`}>
                <span className="text-slate-500">[{l.ts}]</span>{' '}
                <span>{l.status}</span>{' '}
                <span className="text-cyan-400">Fac:{l.fId}</span>{' '}
                <span className="text-slate-400">{l.type}</span>{' '}
                <span className="text-purple-400">HTTP:{l.code}</span>{' '}
                <span className="text-slate-500">{l.ms}ms</span>
              </div>
            ))}
            <p className="text-slate-600 mt-4">{'>'} Total: {transmissionLog.length} | OK: {transmissionLog.filter(l => l.status === 'SUCCESS').length} | Fail: {transmissionLog.filter(l => l.status === 'FAILED').length}</p>
            <p className="text-emerald-600 animate-pulse mt-2">{'>'} System operational...</p>
          </div>
        </div>
      )}

      {/* DELETE CONFIRM */}
      {showDeleteConfirm && (
        <div className="fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-6 py-4 text-white"><h3 className="text-lg font-bold flex items-center gap-2"><AlertTriangle className="w-5 h-5" /> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3></div>
            <div className="p-6"><p className="text-slate-600">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.</p></div>
            <div className="px-6 py-4 bg-slate-50 flex gap-3 justify-end">
              <button onClick={() => { setShowDeleteConfirm(false); setDeleteTarget(null) }} className="px-5 py-2.5 rounded-xl border-2 border-slate-200 text-slate-600 font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={execDelete} className="px-5 py-2.5 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</button>
            </div>
          </div>
        </div>
      )}

      {/* SUBMISSION WIZARD */}
      {showSubmissionWizard && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && setShowSubmissionWizard(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[92vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-orange-500 via-red-500 to-rose-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center text-xl">ğŸ›¡ï¸</div><div><h2 className="text-xl font-black">Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2><p className="text-orange-200 text-sm">Daily Guest Submission to MOI Shomoos</p></div></div>
                <button onClick={() => setShowSubmissionWizard(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button>
              </div>
              <div className="flex items-center gap-2">
                {[{ n: 1, l: 'Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®' }, { n: 2, l: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²Ù„Ø§Ø¡' }, { n: 3, l: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„' }].map((step, i) => (
                  <div key={i} className="flex items-center gap-2 flex-1">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${wizardStep >= step.n ? 'bg-white text-red-600' : 'bg-white/20 text-white/60'}`}>{step.n}</div>
                    <span className={`text-xs font-bold ${wizardStep >= step.n ? 'text-white' : 'text-white/40'}`}>{step.l}</span>
                    {i < 2 && <div className={`flex-1 h-0.5 ${wizardStep > step.n ? 'bg-white' : 'bg-white/20'}`} />}
                  </div>
                ))}
              </div>
            </div>
            <div className="flex-1 overflow-y-auto p-6">
              {wizardStep === 1 && (<div className="space-y-5">
                <div className="bg-orange-50 rounded-xl p-4 border border-orange-200"><p className="text-sm font-bold text-orange-800">â° ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø¨Ù„ 09:00 Ù„ØªØ¬Ù†Ø¨ Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„ØªØ£Ø®ÙŠØ±</p></div>
                <div><label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø´Ø£Ø© <span className="text-red-500">*</span></label>
                  <div className="space-y-3">{facilities.filter(f => f.status === 'Active').map(f => (
                    <button key={f.id} onClick={() => setSubForm({ ...subForm, facilityId: String(f.id) })}
                      className={`flex items-center gap-4 p-4 rounded-xl border-2 w-full text-right ${subForm.facilityId === String(f.id) ? 'border-red-500 bg-red-50 shadow-md' : 'border-slate-200 hover:border-red-300'}`}>
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-lg ${f.connectionStatus === 'Connected' ? 'bg-emerald-100' : 'bg-red-100'}`}>ğŸ¨</div>
                      <div className="flex-1"><p className="font-bold text-slate-800">{f.name}</p><div className="flex gap-3 text-xs text-slate-500 mt-0.5"><span>{f.category}</span><span>ğŸ“ {f.city}</span><span>{f.rooms} ØºØ±ÙØ©</span><span className={`px-1.5 py-0.5 rounded text-[10px] font-bold ${sColor(f.connectionStatus)}`}>{sLabel(f.connectionStatus)}</span></div></div>
                      <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${subForm.facilityId === String(f.id) ? 'border-red-500 bg-red-500' : 'border-slate-300'}`}>{subForm.facilityId === String(f.id) && <Check className="w-4 h-4 text-white" />}</div>
                    </button>
                  ))}</div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ® <span className="text-red-500">*</span></label><input type="date" value={subForm.date} onChange={e => setSubForm({ ...subForm, date: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none" /></div>
                  <div><label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</label><div className="flex gap-2">{[{ v: 'auto', l: 'ğŸ¤– Ø¢Ù„ÙŠ' }, { v: 'manual', l: 'âœï¸ ÙŠØ¯ÙˆÙŠ' }, { v: 'correction', l: 'ğŸ”„ ØªØµØ­ÙŠØ­' }].map(t => (<button key={t.v} onClick={() => setSubForm({ ...subForm, type: t.v })} className={`flex-1 py-2.5 rounded-xl text-xs font-bold border-2 ${subForm.type === t.v ? 'border-red-500 bg-red-50 text-red-700' : 'border-slate-200 text-slate-500'}`}>{t.l}</button>))}</div></div>
                </div>
              </div>)}
              {wizardStep === 2 && (<div className="space-y-5">
                <div className="bg-blue-50 rounded-xl p-4 border border-blue-200"><p className="text-sm font-bold text-blue-800">ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ - {getFacName(parseInt(subForm.facilityId))} â€¢ {subForm.date}</p></div>
                <div><label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ <span className="text-red-500">*</span></label><input type="number" value={subForm.guestCount} onChange={e => setSubForm({ ...subForm, guestCount: e.target.value })} className="w-full px-4 py-4 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none text-2xl font-black text-center" placeholder="0" /></div>
                <div className="bg-slate-50 rounded-xl p-4"><p className="text-xs font-bold text-slate-600 mb-3">Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</p><div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-xs font-bold text-emerald-700 mb-1.5">ğŸ‡¸ğŸ‡¦ Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ†</label><input type="number" value={subForm.saudiCount} onChange={e => setSubForm({ ...subForm, saudiCount: e.target.value })} className="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-emerald-500 focus:outline-none text-lg font-bold text-center bg-emerald-50/50" placeholder="0" /></div>
                  <div><label className="block text-xs font-bold text-blue-700 mb-1.5">ğŸŒ Ø£Ø¬Ø§Ù†Ø¨</label><input type="number" value={subForm.foreignCount} onChange={e => setSubForm({ ...subForm, foreignCount: e.target.value })} className="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg font-bold text-center bg-blue-50/50" placeholder="0" /></div>
                </div></div>
                <div className="bg-slate-50 rounded-xl p-4"><p className="text-xs font-bold text-slate-600 mb-3">Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³</p><div className="grid grid-cols-3 gap-4">
                  <div><label className="block text-xs font-bold text-slate-700 mb-1.5">â™‚ Ø°ÙƒÙˆØ±</label><input type="number" value={subForm.maleCount} onChange={e => setSubForm({ ...subForm, maleCount: e.target.value })} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-slate-400 focus:outline-none text-lg font-bold text-center" placeholder="0" /></div>
                  <div><label className="block text-xs font-bold text-pink-700 mb-1.5">â™€ Ø¥Ù†Ø§Ø«</label><input type="number" value={subForm.femaleCount} onChange={e => setSubForm({ ...subForm, femaleCount: e.target.value })} className="w-full px-4 py-3 border-2 border-pink-200 rounded-xl focus:border-pink-500 focus:outline-none text-lg font-bold text-center bg-pink-50/50" placeholder="0" /></div>
                  <div><label className="block text-xs font-bold text-amber-700 mb-1.5">ğŸ‘¶ Ø£Ø·ÙØ§Ù„</label><input type="number" value={subForm.childCount} onChange={e => setSubForm({ ...subForm, childCount: e.target.value })} className="w-full px-4 py-3 border-2 border-amber-200 rounded-xl focus:border-amber-500 focus:outline-none text-lg font-bold text-center bg-amber-50/50" placeholder="0" /></div>
                </div></div>
                <div><label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea value={subForm.notes} onChange={e => setSubForm({ ...subForm, notes: e.target.value })} rows={2} className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none resize-none text-sm" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." /></div>
              </div>)}
              {wizardStep === 3 && (<div className="space-y-5">
                <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200"><p className="text-sm font-bold text-emerald-800">âœ… Ø±Ø§Ø¬Ø¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù†Ø¸Ø§Ù… NIC</p></div>
                <div className="bg-white rounded-xl border-2 border-slate-200 p-4 grid grid-cols-2 gap-3">
                  {[{ l: 'Ø§Ù„Ù…Ù†Ø´Ø£Ø©', v: getFacName(parseInt(subForm.facilityId)), i: 'ğŸ¨' }, { l: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', v: subForm.date, i: 'ğŸ“…' }, { l: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', v: subForm.guestCount || '0', i: 'ğŸ‘¥' }, { l: 'Ø§Ù„Ù†ÙˆØ¹', v: subForm.type === 'auto' ? 'Ø¢Ù„ÙŠ' : 'ÙŠØ¯ÙˆÙŠ', i: 'ğŸ“¤' }, { l: 'Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ†', v: subForm.saudiCount || 'â€”', i: 'ğŸ‡¸ğŸ‡¦' }, { l: 'Ø£Ø¬Ø§Ù†Ø¨', v: subForm.foreignCount || 'â€”', i: 'ğŸŒ' }].map((x, i) => (
                    <div key={i} className="flex items-center gap-3 bg-slate-50 rounded-xl p-3"><span className="text-lg">{x.i}</span><div><p className="text-[10px] text-slate-500">{x.l}</p><p className="font-bold text-slate-800">{x.v}</p></div></div>
                  ))}
                </div>
                <div className="bg-slate-900 rounded-xl p-4 font-mono text-xs" style={{ direction: 'ltr' }}>
                  <p className="text-slate-500">// API Preview</p><p className="text-cyan-400">POST /api/v2/shomoos/submit</p>
                  <p className="text-emerald-400">{'{'}</p><p className="text-amber-400 ml-4">"facility": "{subForm.facilityId}", "date": "{subForm.date}",</p><p className="text-amber-400 ml-4">"guests": {subForm.guestCount || 0}, "saudi": {subForm.saudiCount || 0}, "foreign": {subForm.foreignCount || 0}</p><p className="text-emerald-400">{'}'}</p>
                </div>
              </div>)}
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <div>{wizardStep > 1 && <button onClick={() => setWizardStep(wizardStep - 1)} className="flex items-center gap-1 px-5 py-2.5 border-2 border-slate-300 rounded-xl font-bold text-sm"><ChevronRight className="w-4 h-4" /> Ø§Ù„Ø³Ø§Ø¨Ù‚</button>}</div>
              <div className="flex gap-2">
                <button onClick={() => setShowSubmissionWizard(false)} className="px-5 py-2.5 text-slate-500 font-bold text-sm">Ø¥Ù„ØºØ§Ø¡</button>
                {wizardStep < 3 ? <button onClick={() => { if (wizardStep === 1 && !subForm.facilityId) { notify('Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø´Ø£Ø©', 'error'); return } if (wizardStep === 2 && !subForm.guestCount) { notify('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡', 'error'); return } setWizardStep(wizardStep + 1) }} className="flex items-center gap-1 px-6 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-bold text-sm">Ø§Ù„ØªØ§Ù„ÙŠ <ChevronLeft className="w-4 h-4" /></button>
                  : <button onClick={handleCreateSub} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold text-sm"><Send className="w-4 h-4" /> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø´Ù…ÙˆØ³</button>}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* GUEST MODAL */}
      {showGuestModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && setShowGuestModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[92vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-blue-500 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><UserPlus className="w-6 h-6" /></div><div><h2 className="text-xl font-black">ØªØ³Ø¬ÙŠÙ„ Ù†Ø²ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2><p className="text-blue-200 text-sm">Guest Check-in Registration</p></div></div><button onClick={() => setShowGuestModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button></div>
            </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className="bg-amber-50 rounded-xl p-3 border border-amber-200"><p className="text-xs font-bold text-amber-800">âš¡ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø©</p></div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø§Ø³Ù… <span className="text-red-500">*</span></label><input type="text" value={guestForm.name} onChange={e => setGuestForm({ ...guestForm, name: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none text-sm" placeholder="Full Name" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ù†Ø´Ø£Ø© <span className="text-red-500">*</span></label><select value={guestForm.facilityId} onChange={e => setGuestForm({ ...guestForm, facilityId: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none text-sm"><option value="">Ø§Ø®ØªØ±</option>{facilities.filter(f => f.status === 'Active').map(f => <option key={f.id} value={f.id}>{f.name}</option>)}</select></div>
              </div>
              <div className="grid grid-cols-3 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙˆÙŠØ©</label><select value={guestForm.idType} onChange={e => setGuestForm({ ...guestForm, idType: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ©">Ù‡ÙˆÙŠØ© ÙˆØ·Ù†ÙŠØ©</option><option value="Ø¥Ù‚Ø§Ù…Ø©">Ø¥Ù‚Ø§Ù…Ø©</option><option value="Passport">Ø¬ÙˆØ§Ø² Ø³ÙØ±</option></select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© <span className="text-red-500">*</span></label><input type="text" value={guestForm.idNumber} onChange={e => setGuestForm({ ...guestForm, idNumber: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm font-mono" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label><input type="text" value={guestForm.nationality} onChange={e => setGuestForm({ ...guestForm, nationality: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ù„Ø¬Ù†Ø³ÙŠØ©" /></div>
              </div>
              <div className="grid grid-cols-4 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØºØ±ÙØ© <span className="text-red-500">*</span></label><input type="text" value={guestForm.room} onChange={e => setGuestForm({ ...guestForm, room: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm font-bold text-center" placeholder="501" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø·Ø§Ø¨Ù‚</label><input type="text" value={guestForm.floor} onChange={e => setGuestForm({ ...guestForm, floor: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm text-center" placeholder="5" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¬Ù†Ø³</label><select value={guestForm.gender} onChange={e => setGuestForm({ ...guestForm, gender: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="male">â™‚ Ø°ÙƒØ±</option><option value="female">â™€ Ø£Ù†Ø«Ù‰</option></select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ø±Ø§ÙÙ‚ÙŠÙ†</label><input type="number" value={guestForm.companions} onChange={e => setGuestForm({ ...guestForm, companions: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm text-center" placeholder="0" /></div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¯Ø®ÙˆÙ„</label><input type="datetime-local" value={guestForm.checkIn} onChange={e => setGuestForm({ ...guestForm, checkIn: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©</label><input type="datetime-local" value={guestForm.checkOut} onChange={e => setGuestForm({ ...guestForm, checkOut: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØºØ±Ø¶</label><select value={guestForm.purpose} onChange={e => setGuestForm({ ...guestForm, purpose: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="Ø³ÙŠØ§Ø­Ø©">ğŸ–ï¸ Ø³ÙŠØ§Ø­Ø©</option><option value="Ø¹Ù…Ù„">ğŸ’¼ Ø¹Ù…Ù„</option><option value="Ø²ÙŠØ§Ø±Ø©">ğŸ‘¥ Ø²ÙŠØ§Ø±Ø©</option><option value="Ø¹Ù„Ø§Ø¬">ğŸ¥ Ø¹Ù„Ø§Ø¬</option><option value="Ø­Ø¬">ğŸ•‹ Ø­Ø¬</option><option value="Ø¹Ù…Ø±Ø©">ğŸ•Œ Ø¹Ù…Ø±Ø©</option><option value="Ø£Ø®Ø±Ù‰">ğŸ“‹ Ø£Ø®Ø±Ù‰</option></select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label><input type="text" value={guestForm.vehiclePlate} onChange={e => setGuestForm({ ...guestForm, vehiclePlate: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" /></div>
              </div>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowGuestModal(false)} className="px-5 py-2.5 border-2 border-slate-300 rounded-xl font-bold text-sm">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleCreateGuest} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold text-sm"><UserPlus className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø²ÙŠÙ„</button>
            </div>
          </div>
        </div>
      )}

      {/* FACILITY MODAL */}
      {showFacilityModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && setShowFacilityModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[92vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-emerald-500 to-teal-600 px-6 py-5 text-white"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Building2 className="w-6 h-6" /></div><div><h2 className="text-xl font-black">ØªØ³Ø¬ÙŠÙ„ Ù…Ù†Ø´Ø£Ø© ÙÙŠ Ø´Ù…ÙˆØ³</h2><p className="text-emerald-200 text-sm">Facility Registration</p></div></div><button onClick={() => setShowFacilityModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button></div></div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ) <span className="text-red-500">*</span></label><input type="text" value={facForm.name} onChange={e => setFacForm({ ...facForm, name: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="ÙÙ†Ø¯Ù‚ Ø§Ù„Ø¨ØµÙŠØ±ÙŠ" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label><input type="text" value={facForm.nameEn} onChange={e => setFacForm({ ...facForm, nameEn: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Al-Basiri Hotel" /></div>
              </div>
              <div className="grid grid-cols-3 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ÙØ¦Ø© <span className="text-red-500">*</span></label><select value={facForm.category} onChange={e => setFacForm({ ...facForm, category: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="">Ø§Ø®ØªØ±</option><option>ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ…</option><option>ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ…</option><option>ÙÙ†Ø¯Ù‚ 3 Ù†Ø¬ÙˆÙ…</option><option>Ø´Ù‚Ù‚ Ù…ÙØ±ÙˆØ´Ø©</option><option>Ù…Ù†ØªØ¬Ø¹</option><option>Ø§Ø³ØªØ±Ø§Ø­Ø©</option></select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØºØ±Ù</label><input type="number" value={facForm.rooms} onChange={e => setFacForm({ ...facForm, rooms: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="0" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label><input type="text" value={facForm.crNumber} onChange={e => setFacForm({ ...facForm, crNumber: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm font-mono" placeholder="1010XXXXXX" /></div>
              </div>
              <div className="grid grid-cols-3 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© <span className="text-red-500">*</span></label><select value={facForm.city} onChange={e => setFacForm({ ...facForm, city: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="">Ø§Ø®ØªØ±</option>{['Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ø§Ù„Ø®Ø¨Ø±', 'Ù…ÙƒØ©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ø£Ø¨Ù‡Ø§', 'ØªØ¨ÙˆÙƒ'].map(c => <option key={c}>{c}</option>)}</select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø­ÙŠ</label><input type="text" value={facForm.district} onChange={e => setFacForm({ ...facForm, district: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ù„Ø­ÙŠ" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" value={facForm.address} onChange={e => setFacForm({ ...facForm, address: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹" /></div>
              </div>
              <div className="grid grid-cols-3 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label><input type="text" value={facForm.contactPerson} onChange={e => setFacForm({ ...facForm, contactPerson: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" value={facForm.contactPhone} onChange={e => setFacForm({ ...facForm, contactPhone: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="05XXXXXXXX" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input type="email" value={facForm.contactEmail} onChange={e => setFacForm({ ...facForm, contactEmail: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
              </div>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowFacilityModal(false)} className="px-5 py-2.5 border-2 border-slate-300 rounded-xl font-bold text-sm">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleCreateFac} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold text-sm"><Building2 className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø£Ø©</button>
            </div>
          </div>
        </div>
      )}

      {/* VIOLATION MODAL */}
      {showViolationModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && setShowViolationModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-xl max-h-[92vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-red-500 to-rose-600 px-6 py-5 text-white"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><AlertTriangle className="w-6 h-6" /></div><div><h2 className="text-xl font-black">ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ© Ø´Ù…ÙˆØ³</h2><p className="text-red-200 text-sm">Record Violation</p></div></div><button onClick={() => setShowViolationModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button></div></div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù†ÙˆØ¹ <span className="text-red-500">*</span></label><select value={vioForm.type} onChange={e => setVioForm({ ...vioForm, type: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="">Ø§Ø®ØªØ±</option><option>ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</option><option>Ù†Ø²ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„</option><option>Ø¹Ø·Ù„ ÙÙŠ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³Ø­</option><option>Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©</option><option>Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø¹ Ø§Ù„Ù…ÙØªØ´</option><option>Ø¥ÙŠÙˆØ§Ø¡ Ù…Ø®Ø§Ù„Ù</option><option>Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø±Ø¨Ø·</option></select></div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ù†Ø´Ø£Ø© <span className="text-red-500">*</span></label><select value={vioForm.facilityId} onChange={e => setVioForm({ ...vioForm, facilityId: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="">Ø§Ø®ØªØ±</option>{facilities.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}</select></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</label><select value={vioForm.severity} onChange={e => setVioForm({ ...vioForm, severity: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="Critical">ğŸ”´ Ø­Ø±Ø¬</option><option value="High">ğŸŸ  Ø¹Ø§Ù„ÙŠ</option><option value="Medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø·</option><option value="Low">ğŸ”µ Ù…Ù†Ø®ÙØ¶</option></select></div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØºØ±Ø§Ù…Ø© (Ø±ÙŠØ§Ù„)</label><input type="number" value={vioForm.fine} onChange={e => setVioForm({ ...vioForm, fine: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…ÙØªØ´</label><input type="text" value={vioForm.inspector} onChange={e => setVioForm({ ...vioForm, inspector: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
              </div>
              <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ÙˆØµÙ</label><textarea value={vioForm.description} onChange={e => setVioForm({ ...vioForm, description: e.target.value })} rows={3} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm resize-none" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ..." /></div>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowViolationModal(false)} className="px-5 py-2.5 border-2 border-slate-300 rounded-xl font-bold text-sm">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleCreateVio} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold text-sm"><AlertTriangle className="w-4 h-4" /> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</button>
            </div>
          </div>
        </div>
      )}

      {/* INSPECTION MODAL */}
      {showInspectionModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={e => e.target === e.currentTarget && setShowInspectionModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[92vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-l from-purple-500 to-indigo-600 px-6 py-5 text-white"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><ClipboardCheck className="w-6 h-6" /></div><div><h2 className="text-xl font-black">ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© ØªÙØªÙŠØ´</h2><p className="text-purple-200 text-sm">Record Inspection</p></div></div><button onClick={() => setShowInspectionModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button></div></div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" value={inspForm.date} onChange={e => setInspForm({ ...inspForm, date: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…Ù†Ø´Ø£Ø© <span className="text-red-500">*</span></label><select value={inspForm.facilityId} onChange={e => setInspForm({ ...inspForm, facilityId: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option value="">Ø§Ø®ØªØ±</option>{facilities.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}</select></div>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù…ÙØªØ´ <span className="text-red-500">*</span></label><input type="text" value={inspForm.inspector} onChange={e => setInspForm({ ...inspForm, inspector: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´" /></div>
                <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„Ù†ÙˆØ¹</label><select value={inspForm.type} onChange={e => setInspForm({ ...inspForm, type: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm"><option>Ø¯ÙˆØ±ÙŠØ©</option><option>Ù…ÙØ§Ø¬Ø¦Ø©</option><option>Ù…ØªØ§Ø¨Ø¹Ø©</option></select></div>
              </div>
              <div className="bg-slate-50 rounded-xl p-4">
                <p className="text-xs font-bold text-slate-600 mb-3">ğŸ“Š Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ø­Ø±Ùƒ Ø§Ù„Ù…Ø¤Ø´Ø±)</p>
                {Object.entries(inspForm.categories).map(([cat, score]) => (
                  <div key={cat} className="flex items-center gap-3 mb-3">
                    <span className="text-xs font-bold text-slate-700 w-28">{cat}</span>
                    <input type="range" min="0" max="100" value={score} onChange={e => setInspForm({ ...inspForm, categories: { ...inspForm.categories, [cat]: parseInt(e.target.value) } })} className="flex-1 h-2 rounded-lg appearance-none cursor-pointer" style={{ background: `linear-gradient(to left, ${score >= 85 ? '#10b981' : score >= 60 ? '#f59e0b' : '#ef4444'} ${score}%, #e2e8f0 ${score}%)` }} />
                    <span className={`text-sm font-black w-12 text-right ${score >= 85 ? 'text-emerald-600' : score >= 60 ? 'text-amber-600' : 'text-red-600'}`}>{score}%</span>
                  </div>
                ))}
                {(() => {
                  const avg = Math.round(Object.values(inspForm.categories).reduce((a, b) => a + b, 0) / 5); return (
                    <div className={`mt-3 pt-3 border-t border-slate-200 rounded-xl p-3 ${avg >= 85 ? 'bg-emerald-50' : 'bg-red-50'}`}>
                      <p className={`font-bold text-center ${avg >= 85 ? 'text-emerald-800' : avg >= 60 ? 'text-amber-800' : 'text-red-800'}`}>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: {avg >= 85 ? 'âœ… Ù†Ø§Ø¬Ø­' : avg >= 60 ? 'âš ï¸ Ù†Ø§Ø¬Ø­ Ù…Ø´Ø±ÙˆØ·' : 'âŒ ØºÙŠØ± Ù†Ø§Ø¬Ø­'} ({avg}%)</p>
                    </div>
                  );
                })()}
              </div>
              <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ù‚Ø§Ø¯Ù…</label><input type="date" value={inspForm.nextInspection} onChange={e => setInspForm({ ...inspForm, nextInspection: e.target.value })} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm" /></div>
              <div><label className="block text-xs font-bold text-slate-700 mb-1.5">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea value={inspForm.notes} onChange={e => setInspForm({ ...inspForm, notes: e.target.value })} rows={2} className="w-full px-4 py-2.5 border-2 border-slate-200 rounded-xl text-sm resize-none" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." /></div>
            </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowInspectionModal(false)} className="px-5 py-2.5 border-2 border-slate-300 rounded-xl font-bold text-sm">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleCreateInsp} className="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold text-sm"><ClipboardCheck className="w-4 h-4" /> Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙØªÙŠØ´</button>
            </div>
          </div>
        </div>
      )}

      {/* DETAIL PANEL */}
      {showDetailPanel && detailItem && (
        <div className="fixed inset-0 bg-black/70 z-50 flex justify-start" onClick={e => e.target === e.currentTarget && setShowDetailPanel(false)}>
          <div className="bg-white w-full max-w-lg h-full overflow-y-auto shadow-2xl">
            <div className="bg-gradient-to-l from-orange-500 to-red-500 px-6 py-5 text-white sticky top-0 z-10"><div className="flex items-center justify-between"><h2 className="text-lg font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h2><button onClick={() => setShowDetailPanel(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl"><X className="w-5 h-5" /></button></div></div>
            <div className="p-6 grid grid-cols-2 gap-3">
              {[{ l: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', v: detailItem.date }, { l: 'Ø§Ù„Ù…Ù†Ø´Ø£Ø©', v: getFacName(detailItem.facilityId) }, { l: 'Ø§Ù„Ù†Ø²Ù„Ø§Ø¡', v: detailItem.guestCount }, { l: 'Ø³Ø¹ÙˆØ¯ÙŠÙŠÙ†', v: detailItem.saudiCount }, { l: 'Ø£Ø¬Ø§Ù†Ø¨', v: detailItem.foreignCount }, { l: 'Ø°ÙƒÙˆØ±', v: detailItem.maleCount }, { l: 'Ø¥Ù†Ø§Ø«', v: detailItem.femaleCount }, { l: 'Ø£Ø·ÙØ§Ù„', v: detailItem.childCount }, { l: 'Ø§Ù„ÙˆÙ‚Øª', v: detailItem.submittedAt }, { l: 'Ø§Ù„Ø­Ø§Ù„Ø©', v: sLabel(detailItem.status) }, { l: 'Ø§Ù„Ù†ÙˆØ¹', v: detailItem.type }, { l: 'Ø¨ÙˆØ§Ø³Ø·Ø©', v: detailItem.submittedBy }, { l: 'Ù…Ø¹Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', v: detailItem.transmissionId }, { l: 'HTTP', v: detailItem.responseCode }, { l: 'Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª', v: detailItem.retries }, { l: 'NIC', v: detailItem.verifiedByNIC ? 'âœ…' : 'âŒ' }].map((f, i) => (
                <div key={i} className="bg-slate-50 rounded-xl p-3"><p className="text-xs text-slate-500">{f.l}</p><p className="font-bold text-slate-800">{f.v}</p></div>
              ))}
            </div>
            {detailItem.notes && <div className="mx-6 mb-6 bg-amber-50 rounded-xl p-4 border border-amber-200"><p className="text-xs font-bold text-amber-700">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: {detailItem.notes}</p></div>}
          </div>
        </div>
      )}

    </div>
  );
};


// MODULE 4.13: LIVE REGULATORY REPORTING SYSTEM
// Real operational reports - NOT dashboards - Data-driven from platform records

const InstitutionalCompliance = () => {
  const [activeReport, setActiveReport] = useState('board');
  const [selectedPeriod, setSelectedPeriod] = useState('Q4-2024');
  const [selectedEntity, setSelectedEntity] = useState('all');
  const [showDrawer, setShowDrawer] = useState(false);
  const [drawerData, setDrawerData] = useState(null);
  const [expandedSection, setExpandedSection] = useState(null);

  // Enhanced Modal Wizard State
  const [modalStep, setModalStep] = useState(1);
  const [voteSelection, setVoteSelection] = useState(null);
  const [voteComments, setVoteComments] = useState('');
  const [signOffData, setSignOffData] = useState({ name: '', role: '', date: '', pin: '' });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Delete confirmation state (was missing)
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const [userToDelete, setUserToDelete] = useState(null);
  const cancelDeleteUser = () => { setShowDeleteConfirm(false); setUserToDelete(null); };

  // DATA ALIASES - Reference existing platform data
  const OBLIGATIONS = INITIAL_OBLIGATIONS;
  const legalEntities = IAM_API.legalEntities;

  // Evidence Records (sample data for reports)
  const EVIDENCE_RECORDS = [
    { id: 1, code: 'EVD-001', title: 'Ø³ÙŠØ§Ø³Ø© Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', evidenceType: 'Policy', status: 'Accepted', ownerName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', linkedObligations: ['OBL-001'] },
    { id: 2, code: 'EVD-002', title: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', evidenceType: 'Procedure', status: 'Accepted', ownerName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', linkedObligations: ['OBL-002'] },
    { id: 3, code: 'EVD-003', title: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', evidenceType: 'Certificate', status: 'Pending', ownerName: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', linkedObligations: ['OBL-003'] },
    { id: 4, code: 'EVD-004', title: 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±', evidenceType: 'Report', status: 'Expired', ownerName: 'Ø®Ø§Ù„Ø¯ Ù…Ø­Ù…Ø¯', linkedObligations: ['OBL-004'] },
    { id: 5, code: 'EVD-005', title: 'Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø£Ù…Ù†ÙŠ', evidenceType: 'Log', status: 'Accepted', ownerName: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', linkedObligations: ['OBL-005'] },
    { id: 6, code: 'EVD-006', title: 'ØªÙ‚Ø±ÙŠØ± ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª', evidenceType: 'Report', status: 'Rejected', ownerName: 'Ø¹Ù…Ø± Ø­Ø³Ù†', linkedObligations: ['OBL-006'] },
    { id: 7, code: 'EVD-007', title: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªØµÙ†ÙŠÙ', evidenceType: 'Policy', status: 'Accepted', ownerName: 'Ù†ÙˆØ±Ø© Ø³Ø¹Ø¯', linkedObligations: ['OBL-007'] },
    { id: 8, code: 'EVD-008', title: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', evidenceType: 'Procedure', status: 'Pending', ownerName: 'ÙŠÙˆØ³Ù Ø£Ø­Ù…Ø¯', linkedObligations: ['OBL-008'] },
  ];

  // Violations/Breaches (sample data for reports)
  const VIOLATIONS = [
    { id: 1, code: 'VIO-001', title: 'ØªØ£Ø®Ø± ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù†', severity: 'High', status: 'Open', authority: 'SAMA', detectedDate: '2024-01-15', description: 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©' },
    { id: 2, code: 'VIO-002', title: 'Ù†Ù‚Øµ ÙÙŠ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', severity: 'Medium', status: 'Open', authority: 'NCA', detectedDate: '2024-02-10', description: '15% Ù…Ù† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„Ù… ÙŠÙƒÙ…Ù„ÙˆØ§ Ø§Ù„ØªØ¯Ø±ÙŠØ¨' },
    { id: 3, code: 'VIO-003', title: 'Ø«ØºØ±Ø© Ø£Ù…Ù†ÙŠØ© ØºÙŠØ± Ù…Ø¹Ø§Ù„Ø¬Ø©', severity: 'Critical', status: 'Open', authority: 'SAMA', detectedDate: '2024-02-20', description: 'Ø«ØºØ±Ø© Ø­Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù… ØªØ¹Ø§Ù„Ø¬ Ø®Ù„Ø§Ù„ SLA' },
    { id: 4, code: 'VIO-004', title: 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„Ø¥ÙØµØ§Ø­', severity: 'High', status: 'Closed', authority: 'CMA', detectedDate: '2024-01-05', description: 'ØªØ£Ø®Ø± ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥ÙØµØ§Ø­ Ø§Ù„Ø±Ø¨Ø¹ÙŠ' },
    { id: 5, code: 'VIO-005', title: 'Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', severity: 'Medium', status: 'Open', authority: 'SDAIA', detectedDate: '2024-02-25', description: 'Ø³Ø¬Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„' },
  ];

  // LIVE DATA CALCULATIONS - Reading from actual platform records

  const today = new Date();
  const in30Days = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);

  // Overdue obligations
  const overdueObligations = OBLIGATIONS.filter(o => {
    const due = new Date(o.effectiveFrom || '2024-12-31');
    return due < today && o.status !== 'Active';
  });

  // Upcoming deadlines (30 days)
  const upcomingDeadlines = OBLIGATIONS.filter(o => {
    const due = new Date(o.effectiveFrom || '2024-12-31');
    return due >= today && due <= in30Days;
  });

  // Evidence gaps
  const evidenceGaps = EVIDENCE_RECORDS.filter(e =>
    e.status === 'Pending' || e.status === 'Expired' || e.status === 'Rejected'
  );
  const acceptedEvidence = EVIDENCE_RECORDS.filter(e => e.status === 'Accepted');

  // Breaches
  const criticalBreaches = VIOLATIONS.filter(v =>
    v.status === 'Open' && (v.severity === 'Critical' || v.severity === 'High')
  );
  const openBreaches = VIOLATIONS.filter(v => v.status === 'Open');

  // Controls
  const controlsNotTested = CONTROLS.filter(c => c.effectiveness === 'Not Tested' || !c.lastTestDate);
  const controlsFailed = CONTROLS.filter(c => c.effectiveness === 'Ineffective');
  const controlsPassed = CONTROLS.filter(c => c.effectiveness === 'Effective');

  const getAuthorityCompliance = (authorityCode) => {
    const authorityFrameworks = FRAMEWORKS.filter(f => {
      const auth = AUTHORITIES.find(a => a.id === f.authorityId);
      return auth?.code === authorityCode;
    });
    const frameworkIds = authorityFrameworks.map(f => f.id);
    const authorityObligations = OBLIGATIONS.filter(o => frameworkIds.includes(o.frameworkId));
    const compliant = authorityObligations.filter(o => o.status === 'Active').length;
    const total = authorityObligations.length;
    return { compliant, total, percentage: total > 0 ? Math.round((compliant / total) * 100) : 0, obligations: authorityObligations };
  };

  const samaData = getAuthorityCompliance('SAMA');
  const ncaData = getAuthorityCompliance('NCA');
  const cmaData = getAuthorityCompliance('CMA');
  const overallCompliance = OBLIGATIONS.length > 0
    ? Math.round((OBLIGATIONS.filter(o => o.status === 'Active').length / OBLIGATIONS.length) * 100) : 0;

  const getFrameworkName = (fId) => FRAMEWORKS.find(f => f.id === fId)?.code || '-';
  const getAuthorityName = (obl) => {
    const fw = FRAMEWORKS.find(f => f.id === obl.frameworkId);
    return fw ? AUTHORITIES.find(a => a.id === fw.authorityId)?.code : '-';
  };
  const openDrawer = (item, type) => {
    setDrawerData({ item, type });
    setShowDrawer(true);
    setModalStep(1);
    setVoteSelection(null);
    setVoteComments('');
    setSignOffData({ name: '', role: '', date: '', pin: '' });
    setIsSubmitting(false);
    setShowSuccess(false);
  };

  const handleSubmitDecision = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setIsSubmitting(false);
      setShowSuccess(true);
      setTimeout(() => {
        setShowDrawer(false);
        setShowSuccess(false);
      }, 2000);
    }, 1500);
  };

  // Status badge
  const StatusBadge = ({ status }) => {
    const cfg = {
      'Compliant': 'bg-emerald-100 text-emerald-700', 'Partial': 'bg-amber-100 text-amber-700',
      'Non-Compliant': 'bg-red-100 text-red-700', 'Open': 'bg-red-100 text-red-700',
      'Closed': 'bg-emerald-100 text-emerald-700', 'Pending': 'bg-amber-100 text-amber-700',
      'Accepted': 'bg-emerald-100 text-emerald-700', 'Rejected': 'bg-red-100 text-red-700',
      'Expired': 'bg-slate-100 text-slate-700', 'Passed': 'bg-emerald-100 text-emerald-700',
      'Failed': 'bg-red-100 text-red-700', 'Not Tested': 'bg-slate-100 text-slate-700',
    };
    const labels = { 'Compliant': 'Ù…Ù„ØªØ²Ù…', 'Partial': 'Ø¬Ø²Ø¦ÙŠ', 'Non-Compliant': 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…', 'Open': 'Ù…ÙØªÙˆØ­', 'Closed': 'Ù…ØºÙ„Ù‚', 'Pending': 'Ù…Ø¹Ù„Ù‚', 'Accepted': 'Ù…Ù‚Ø¨ÙˆÙ„', 'Rejected': 'Ù…Ø±ÙÙˆØ¶', 'Expired': 'Ù…Ù†ØªÙ‡ÙŠ', 'Passed': 'Ù†Ø§Ø¬Ø­', 'Failed': 'ÙØ§Ø´Ù„', 'Not Tested': 'ØºÙŠØ± Ù…Ø®ØªØ¨Ø±' };
    return <span className={`px-2 py-1 rounded-lg text-xs font-bold ${cfg[status] || 'bg-slate-100 text-slate-700'}`}>{labels[status] || status}</span>;
  };

  const SeverityBadge = ({ severity }) => {
    const cfg = { 'Critical': 'bg-red-500 text-white', 'High': 'bg-orange-500 text-white', 'Medium': 'bg-amber-500 text-white', 'Low': 'bg-blue-500 text-white' };
    return <span className={`px-2 py-1 rounded text-xs font-bold ${cfg[severity] || 'bg-slate-500 text-white'}`}>{severity}</span>;
  };

  const reports = [
    { id: 'board', label: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', icon: Briefcase },
    { id: 'sama', label: 'SAMA Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', icon: Shield },
    { id: 'cma', label: 'CMA Ø§Ù„Ø¥ÙØµØ§Ø­', icon: FileText },
    { id: 'nca', label: 'NCA ECC', icon: Lock },
    { id: 'shomoos', label: 'Ø´Ù…ÙˆØ³', icon: Globe },
    { id: 'commerce', label: 'Ø§Ù„ØªØ¬Ø§Ø±Ø© ÙˆØ§Ù„Ù…Ø¤Ø³Ø³ÙŠ', icon: Building2 },
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-black text-slate-800 flex items-center gap-3">
            <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
              <BarChart3 className="w-6 h-6 text-white" />
            </div>
            Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ø­ÙŠØ©
          </h1>
          <p className="text-slate-500 mt-1">Live Regulatory Reporting â€¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©</p>
        </div>
        <div className="flex items-center gap-3">
          <select value={selectedPeriod} onChange={(e) => setSelectedPeriod(e.target.value)} className="px-4 py-2 border-2 border-slate-200 rounded-xl font-bold">
            <option value="Q4-2024">Q4 2024</option>
            <option value="Q3-2024">Q3 2024</option>
            <option value="Q2-2024">Q2 2024</option>
          </select>
          <select value={selectedEntity} onChange={(e) => setSelectedEntity(e.target.value)} className="px-4 py-2 border-2 border-slate-200 rounded-xl font-bold">
            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª</option>
            {legalEntities.map(e => <option key={e.id} value={e.id}>{e.name}</option>)}
          </select>
        </div> </div>
      <div className="flex items-center gap-2 bg-slate-100 p-1.5 rounded-xl overflow-x-auto">
        {reports.map(r => (
          <button key={r.id} onClick={() => setActiveReport(r.id)}
            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-bold whitespace-nowrap ${activeReport === r.id ? 'bg-white shadow text-slate-800' : 'text-slate-500'}`}>
            <r.icon className="w-5 h-5" />{r.label}
          </button>
        ))}
      </div>

      {activeReport === 'board' && (
        <div className="space-y-6">
          <div className="bg-white rounded-2xl border-2 border-slate-300 overflow-hidden shadow-lg">
            <div className="bg-gradient-to-r from-slate-800 to-slate-900 px-8 py-6 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-6">
                  <div className="w-20 h-20 rounded-2xl bg-white/10 flex items-center justify-center border-2 border-white/20">
                    <Building2 className="w-10 h-10" />
                  </div>
                  <div>
                    <p className="text-slate-400 text-sm">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ØµÙŠØ±ÙŠ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</p>
                    <h1 className="text-2xl font-black">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
                    <p className="text-slate-300">Board Regulatory Compliance Report</p>
                  </div> </div>
                <div className="text-left">
                  <div className="flex items-center gap-2 bg-amber-500 px-4 py-2 rounded-xl mb-2">
                    <FileCheck className="w-5 h-5" />
                    <span className="font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                  </div>
                  <p className="text-slate-400 text-sm">Draft v2.1</p>
                </div> </div> </div>
            <div className="px-8 py-4 bg-slate-50 border-t border-slate-200">
              <div className="grid grid-cols-5 gap-6 text-sm">
                <div>
                  <p className="text-slate-500">Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±ÙŠØ©</p>
                  <p className="font-bold text-slate-800">{selectedPeriod}</p>
                </div>
                <div>
                  <p className="text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</p>
                  <p className="font-bold text-slate-800">{new Date().toLocaleDateString('ar-SA')}</p>
                </div>
                <div>
                  <p className="text-slate-500">Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…ØºØ·Ø§Ø©</p>
                  <p className="font-bold text-slate-800">SAMA â€¢ NCA â€¢ CMA â€¢ ZATCA</p>
                </div>
                <div>
                  <p className="text-slate-500">Ù…ÙØ¹Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</p>
                  <p className="font-bold text-slate-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</p>
                </div>
                <div>
                  <p className="text-slate-500">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                  <p className="font-bold text-slate-800">Ø§Ù„Ø±Ø¦ÙŠØ³ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                </div> </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-purple-200 overflow-hidden">
            <div className="px-6 py-4 bg-purple-50 border-b border-purple-100 flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-purple-600 flex items-center justify-center">
                <FileText className="w-5 h-5 text-white" />
              </div>
              <div>
                <h2 className="font-black text-purple-900">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</h2>
                <p className="text-purple-600 text-sm">Executive Summary â€¢ ÙŠÙÙ‚Ø±Ø£ ÙÙŠ 60 Ø«Ø§Ù†ÙŠØ©</p>
              </div> </div>
            <div className="p-6 space-y-4">
              <div className="prose prose-slate max-w-none">
                <p className="text-lg leading-relaxed text-slate-700">
                  Ø¨Ù„ØºØª <span className="font-bold text-purple-700">Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙƒÙ„ÙŠØ© {overallCompliance}%</span> Ù„Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
                  {overallCompliance >= 80 ? (
                    <span className="text-emerald-600"> (Ø¶Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„)</span>
                  ) : (
                    <span className="text-red-600"> (Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù 80%)</span>
                  )}
                  . ØªÙ…Øª ØªØºØ·ÙŠØ© <span className="font-bold">{OBLIGATIONS.filter(o => o.status === 'Active').length}</span> Ø§Ù„ØªØ²Ø§Ù…Ø§Ù‹ Ù…Ù† Ø£ØµÙ„ <span className="font-bold">{OBLIGATIONS.length}</span> Ø§Ù„ØªØ²Ø§Ù…Ø§Ù‹ ØªÙ†Ø¸ÙŠÙ…ÙŠØ§Ù‹.
                </p>

                {criticalBreaches.length > 0 && (
                  <div className="bg-red-50 border-r-4 border-red-500 p-4 rounded-lg my-4">
                    <p className="text-red-800 font-bold flex items-center gap-2">
                      <AlertTriangle className="w-5 h-5" />
                      ØªÙ†Ø¨ÙŠÙ‡: ÙŠÙˆØ¬Ø¯ {criticalBreaches.length} Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø±Ø¬Ø©/Ø¹Ø§Ù„ÙŠØ© Ù…ÙØªÙˆØ­Ø©
                    </p>
                    <p className="text-red-700 mt-1">
                      Ø£Ø¨Ø±Ø²Ù‡Ø§: <span className="font-bold">{criticalBreaches[0]?.title}</span>
                      {criticalBreaches[0]?.authority && <span> (Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ {criticalBreaches[0].authority})</span>}
                    </p> </div>
                )}

                {evidenceGaps.length > 0 && (
                  <div className="bg-amber-50 border-r-4 border-amber-500 p-4 rounded-lg my-4">
                    <p className="text-amber-800 font-bold flex items-center gap-2">
                      <FileQuestion className="w-5 h-5" />
                      ÙØ¬ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù„Ø©: {evidenceGaps.length} Ø¯Ù„ÙŠÙ„ ÙŠØªØ·Ù„Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø©
                    </p>
                    <p className="text-amber-700 mt-1">
                      Ù…Ù†Ù‡Ø§ {evidenceGaps.filter(e => e.status === 'Expired').length} Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŒ
                      {evidenceGaps.filter(e => e.status === 'Pending').length} Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ
                      {evidenceGaps.filter(e => e.status === 'Rejected').length} Ù…Ø±ÙÙˆØ¶
                    </p> </div>
                )}

                <p className="text-slate-600 mt-4">
                  <strong>Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©:</strong> SAMA ({samaData.percentage}%) â€¢ NCA ({ncaData.percentage}%) â€¢ CMA ({cmaData.percentage}%)
                </p> </div>
              <div className="grid grid-cols-4 gap-4 mt-6 pt-6 border-t border-slate-200">
                <div className="text-center p-4 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl">
                  <p className="text-3xl font-black text-purple-700">{overallCompliance}%</p>
                  <p className="text-sm text-slate-600">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙƒÙ„ÙŠ</p>
                  <p className="text-xs text-emerald-600 mt-1">+4% Ø¹Ù† Q3</p>
                </div>
                <div className="text-center p-4 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl">
                  <p className="text-3xl font-black text-red-600">{criticalBreaches.length}</p>
                  <p className="text-sm text-slate-600">Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø±Ø¬Ø©</p>
                  <p className="text-xs text-red-600 mt-1">{criticalBreaches.filter(b => b.severity === 'Critical').length} Critical</p>
                </div>
                <div className="text-center p-4 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl">
                  <p className="text-3xl font-black text-amber-600">{overdueObligations.length}</p>
                  <p className="text-sm text-slate-600">Ù…ØªØ£Ø®Ø±Ø©</p>
                  <p className="text-xs text-amber-600 mt-1">ØªØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ</p>
                </div>
                <div className="text-center p-4 bg-gradient-to-br from-slate-50 to-gray-100 rounded-xl">
                  <p className="text-3xl font-black text-slate-700">{evidenceGaps.length}</p>
                  <p className="text-sm text-slate-600">ÙØ¬ÙˆØ§Øª Ø£Ø¯Ù„Ø©</p>
                  <p className="text-xs text-slate-500 mt-1">{evidenceGaps.filter(e => e.status === 'Expired').length} Ù…Ù†ØªÙ‡ÙŠ</p>
                </div> </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-indigo-300 overflow-hidden shadow-lg">
            <div className="px-6 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-between">
              <div className="flex items-center gap-3 text-white">
                <div className="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center">
                  <CheckSquare className="w-5 h-5" />
                </div>
                <div>
                  <h2 className="font-black">Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                  <p className="text-indigo-200 text-sm">Board Decisions Required â€¢ {3} Ø¨Ù†ÙˆØ¯ ØªØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                </div> </div>
              <span className="px-4 py-2 bg-white/20 rounded-xl text-white font-bold">Ø¹Ø§Ø¬Ù„</span>
            </div>
            <div className="divide-y divide-slate-100">
              <div className="p-6 hover:bg-indigo-50 transition-colors">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-4">
                    <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center flex-shrink-0 mt-1">
                      <span className="font-black text-red-600">1</span>
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800 text-lg">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Critical Ù„Ù…Ø¯Ø© 90 ÙŠÙˆÙ…</h3>
                      <p className="text-slate-600 mt-1">Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯ Ù…ÙˆØ¹Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ø­Ø±Ø¬Ø© CVE-2024-XXXX ÙÙŠ Ù†Ø¸Ø§Ù… Core Banking</p>
                      <div className="flex flex-wrap gap-2 mt-3">
                        <span className="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-xs font-bold">Critical</span>
                        <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-bold">SAMA</span>
                        <span className="px-3 py-1 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">NCA ECC</span>
                      </div>
                      <div className="grid grid-cols-3 gap-4 mt-4 text-sm">
                        <div><p className="text-slate-500">Ø§Ù„Ù…Ø§Ù„Ùƒ</p><p className="font-bold">CISO</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p><p className="font-bold text-red-600">2024-03-15</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ù…Ø®Ø§Ø·Ø±</p><p className="font-bold text-amber-600">Ø¹Ù‚ÙˆØ¨Ø© Ø±Ù‚Ø§Ø¨ÙŠØ© Ù…Ø­ØªÙ…Ù„Ø©</p></div>
                      </div> </div> </div>
                  <button onClick={() => openDrawer({ type: 'decision', id: 1, title: 'Ø§Ø³ØªØ«Ù†Ø§Ø¡ Critical' }, 'decision')}
                    className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold text-sm hover:bg-indigo-200 flex items-center gap-2">
                    <Eye className="w-4 h-4" />
                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                  </button> </div> </div>
              <div className="p-6 hover:bg-indigo-50 transition-colors">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-4">
                    <div className="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0 mt-1">
                      <span className="font-black text-amber-600">2</span>
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800 text-lg">Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù…Ø´Ø±ÙˆØ¹ SOC 2 Type II</h3>
                      <p className="text-slate-600 mt-1">Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙŠØ²Ø§Ù†ÙŠØ© 1.2 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„ Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© SOC 2 Ø®Ù„Ø§Ù„ 2024</p>
                      <div className="flex flex-wrap gap-2 mt-3">
                        <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">High</span>
                        <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">Global Standard</span>
                      </div>
                      <div className="grid grid-cols-3 gap-4 mt-4 text-sm">
                        <div><p className="text-slate-500">Ø§Ù„Ù…Ø§Ù„Ùƒ</p><p className="font-bold">CFO / CISO</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p><p className="font-bold text-amber-600">2024-04-01</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ø£Ø«Ø±</p><p className="font-bold text-emerald-600">ØªÙ†Ø§ÙØ³ÙŠØ© + Ø«Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p></div>
                      </div> </div> </div>
                  <button onClick={() => openDrawer({ type: 'decision', id: 2, title: 'Ù…ÙŠØ²Ø§Ù†ÙŠØ© SOC 2' }, 'decision')}
                    className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold text-sm hover:bg-indigo-200 flex items-center gap-2">
                    <Eye className="w-4 h-4" />
                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                  </button> </div> </div>
              <div className="p-6 hover:bg-indigo-50 transition-colors">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-4">
                    <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center flex-shrink-0 mt-1">
                      <span className="font-black text-blue-600">3</span>
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800 text-lg">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©</h3>
                      <p className="text-slate-600 mt-1">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ø³ÙŠØ§Ø³Ø© PDPL Ù„Ù…ÙˆØ§Ø¡Ù…Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                      <div className="flex flex-wrap gap-2 mt-3">
                        <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">Medium</span>
                        <span className="px-3 py-1 bg-pink-100 text-pink-700 rounded-lg text-xs font-bold">SDAIA / PDPL</span>
                      </div>
                      <div className="grid grid-cols-3 gap-4 mt-4 text-sm">
                        <div><p className="text-slate-500">Ø§Ù„Ù…Ø§Ù„Ùƒ</p><p className="font-bold">DPO</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p><p className="font-bold">2024-09-14</p></div>
                        <div><p className="text-slate-500">Ø§Ù„Ø£Ø«Ø±</p><p className="font-bold text-slate-600">Ø§Ù…ØªØ«Ø§Ù„ ØªÙ†Ø¸ÙŠÙ…ÙŠ</p></div>
                      </div> </div> </div>
                  <button onClick={() => openDrawer({ type: 'decision', id: 3, title: 'Ø³ÙŠØ§Ø³Ø© PDPL' }, 'decision')}
                    className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold text-sm hover:bg-indigo-200 flex items-center gap-2">
                    <Eye className="w-4 h-4" />
                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                  </button> </div> </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <Shield className="w-5 h-5 text-emerald-500" />
                Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
              </h3>
              <div className="flex items-center gap-4 text-xs">
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-emerald-500"></span> 80%+</span>
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-amber-500"></span> 60-79%</span>
                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-red-500"></span> &lt;60%</span>
              </div> </div>
            <div className="p-6">
              <div className="grid grid-cols-4 gap-4">
                {[
                  { code: 'SAMA', name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', data: samaData, color: 'emerald', icon: 'ğŸ¦' },
                  { code: 'NCA', name: 'Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', data: ncaData, color: 'slate', icon: 'ğŸ”’' },
                  { code: 'CMA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©', data: cmaData, color: 'purple', icon: 'ğŸ“Š' },
                  { code: 'ZATCA', name: 'Ù‡ÙŠØ¦Ø© Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø©', data: { percentage: 95, compliant: 19, total: 20 }, color: 'amber', icon: 'ğŸ“‹' },
                ].map(auth => (
                  <div key={auth.code}
                    className={`rounded-xl p-5 text-center cursor-pointer transition-all hover:scale-105 ${auth.data.percentage >= 80 ? 'bg-emerald-50 border-2 border-emerald-200' :
                      auth.data.percentage >= 60 ? 'bg-amber-50 border-2 border-amber-200' : 'bg-red-50 border-2 border-red-200'
                      }`}
                    onClick={() => setActiveReport(auth.code.toLowerCase())}>
                    <div className="text-3xl mb-2">{auth.icon}</div>
                    <p className="font-black text-slate-800">{auth.code}</p>
                    <p className="text-xs text-slate-500 mb-3">{auth.name}</p>
                    <p className={`text-3xl font-black ${auth.data.percentage >= 80 ? 'text-emerald-600' : auth.data.percentage >= 60 ? 'text-amber-600' : 'text-red-600'
                      }`}>{auth.data.percentage}%</p>
                    <p className="text-sm text-slate-500 mt-1">{auth.data.compliant}/{auth.data.total} Ø§Ù„ØªØ²Ø§Ù…</p>
                    <p className={`text-xs mt-2 ${auth.data.percentage >= 80 ? 'text-emerald-600' : 'text-amber-600'}`}>
                      {auth.data.percentage >= 80 ? 'âœ“ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙØªÙŠØ´' : 'âš  ÙŠØªØ·Ù„Ø¨ Ù…ØªØ§Ø¨Ø¹Ø©'}
                    </p> </div>
                ))}
              </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-red-200 overflow-hidden">
            <div className="px-6 py-4 bg-red-50 border-b border-red-100 flex items-center justify-between">
              <h3 className="font-bold text-red-800 flex items-center gap-2">
                <AlertTriangle className="w-5 h-5" />
                Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© ÙˆØ§Ù„Ø¹Ø§Ù„ÙŠØ© - Board Attention Required
              </h3>
              <span className="px-3 py-1 bg-red-600 text-white rounded-lg text-sm font-bold">{criticalBreaches.length} Ù…Ø®Ø§Ù„ÙØ§Øª</span>
            </div>
            {criticalBreaches.length === 0 ? (
              <div className="p-8 text-center">
                <CheckCircle2 className="w-16 h-16 mx-auto mb-3 text-emerald-400" />
                <p className="font-bold text-emerald-600 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ø­Ø±Ø¬Ø© Ù…ÙØªÙˆØ­Ø©</p>
                <p className="text-slate-500">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§</p>
              </div>
            ) : (
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¹Ù…Ø± (ÙŠÙˆÙ…)</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
                    <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
                  </tr> </thead>
                <tbody>
                  {criticalBreaches.map(b => {
                    const age = Math.floor((new Date() - new Date(b.detectedDate)) / (1000 * 60 * 60 * 24));
                    return (
                      <tr key={b.id} className="border-t border-slate-100 hover:bg-red-50">
                        <td className="py-3 px-4 font-mono text-sm font-bold">{b.code}</td>
                        <td className="py-3 px-4 font-bold text-slate-800">{b.title}</td>
                        <td className="py-3 px-4"><SeverityBadge severity={b.severity} /></td>
                        <td className="py-3 px-4"><span className="px-2 py-1 bg-slate-100 rounded font-bold text-xs">{b.authority}</span></td>
                        <td className="py-3 px-4 text-sm text-slate-600">Ø¥Ø¬Ø±Ø§Ø¦ÙŠ</td>
                        <td className="py-3 px-4">
                          <span className={`font-bold ${age > 30 ? 'text-red-600' : age > 14 ? 'text-amber-600' : 'text-slate-600'}`}>{age}</span>
                        </td>
                        <td className="py-3 px-4 text-sm">CISO</td>
                        <td className="py-3 px-4 text-center">
                          <button onClick={() => openDrawer(b, 'breach')} className="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-bold hover:bg-red-200 flex items-center gap-1 mx-auto">
                            <Eye className="w-4 h-4" />
                            Ø¹Ø±Ø¶
                          </button> </td> </tr>);
                  })}
                </tbody> </table>
            )}
          </div>

          <div className="bg-white rounded-2xl border-2 border-amber-200 overflow-hidden">
            <div className="px-6 py-4 bg-amber-50 border-b border-amber-100 flex items-center justify-between">
              <h3 className="font-bold text-amber-800 flex items-center gap-2">
                <Clock className="w-5 h-5" />
                Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
              </h3>
              <span className="px-3 py-1 bg-amber-600 text-white rounded-lg text-sm font-bold">{overdueObligations.length} Ù…ØªØ£Ø®Ø±</span>
            </div>
            {overdueObligations.length === 0 ? (
              <div className="p-8 text-center">
                <CheckCircle2 className="w-16 h-16 mx-auto mb-3 text-emerald-400" />
                <p className="font-bold text-emerald-600 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…ØªØ£Ø®Ø±Ø©</p>
              </div>
            ) : (
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¥Ø·Ø§Ø±</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
                    <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
                  </tr> </thead>
                <tbody>
                  {overdueObligations.slice(0, 10).map(o => (
                    <tr key={o.id} className="border-t border-slate-100 hover:bg-amber-50">
                      <td className="py-3 px-4 font-mono text-sm font-bold">{o.code}</td>
                      <td className="py-3 px-4 text-sm max-w-xs">{(o.title || o.statement || '-').substring(0, 60)}...</td>
                      <td className="py-3 px-4"><span className="px-2 py-1 bg-slate-100 rounded text-xs font-bold">{getFrameworkName(o.frameworkId)}</span></td>
                      <td className="py-3 px-4">{getAuthorityName(o)}</td>
                      <td className="py-3 px-4 text-sm text-red-600 font-bold">{o.effectiveFrom || '-'}</td>
                      <td className="py-3 px-4 text-sm">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</td>
                      <td className="py-3 px-4 text-center">
                        <button onClick={() => openDrawer(o, 'obligation')} className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg text-sm font-bold hover:bg-amber-200 flex items-center gap-1 mx-auto">
                          <Eye className="w-4 h-4" />
                          Ø¹Ø±Ø¶
                        </button> </td> </tr>
                  ))}
                </tbody> </table>
            )}
          </div>

          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 bg-slate-50 border-b border-slate-100 flex items-center justify-between">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <FileQuestion className="w-5 h-5 text-slate-500" />
                ÙØ¬ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù„Ø© (Ù†Ø§Ù‚ØµØ© / Ù…Ù†ØªÙ‡ÙŠØ© / Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)
              </h3>
              <div className="flex gap-2">
                <span className="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold">{evidenceGaps.filter(e => e.status === 'Expired').length} Ù…Ù†ØªÙ‡ÙŠ</span>
                <span className="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs font-bold">{evidenceGaps.filter(e => e.status === 'Pending').length} Ù…Ø¹Ù„Ù‚</span>
                <span className="px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs font-bold">{evidenceGaps.filter(e => e.status === 'Rejected').length} Ù…Ø±ÙÙˆØ¶</span>
              </div> </div>
            {evidenceGaps.length === 0 ? (
              <div className="p-8 text-center">
                <CheckCircle2 className="w-16 h-16 mx-auto mb-3 text-emerald-400" />
                <p className="font-bold text-emerald-600 text-lg">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯Ù„Ø© Ù…ÙƒØªÙ…Ù„Ø© ÙˆÙ…Ù‚Ø¨ÙˆÙ„Ø©</p>
              </div>
            ) : (
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¯Ù„ÙŠÙ„</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù†ÙˆØ¹</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ù„Ù„Ø§Ù„ØªØ²Ø§Ù…</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</th>
                    <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
                  </tr> </thead>
                <tbody>
                  {evidenceGaps.map(e => (
                    <tr key={e.id} className="border-t border-slate-100 hover:bg-slate-50">
                      <td className="py-3 px-4 font-mono text-sm font-bold">{e.code}</td>
                      <td className="py-3 px-4 font-bold text-slate-800">{e.title}</td>
                      <td className="py-3 px-4 text-sm">{e.evidenceType}</td>
                      <td className="py-3 px-4 text-sm font-mono">{e.linkedObligations?.[0] || '-'}</td>
                      <td className="py-3 px-4"><StatusBadge status={e.status} /></td>
                      <td className="py-3 px-4 text-sm">{e.ownerName}</td>
                      <td className="py-3 px-4 text-center">
                        <button onClick={() => openDrawer(e, 'evidence')} className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200 flex items-center gap-1 mx-auto">
                          <Eye className="w-4 h-4" />
                          Ø¹Ø±Ø¶
                        </button> </td> </tr>
                  ))}
                </tbody> </table>
            )}
          </div>

          <div className="bg-white rounded-2xl border-2 border-blue-200 overflow-hidden">
            <div className="px-6 py-4 bg-blue-50 border-b border-blue-100 flex items-center justify-between">
              <h3 className="font-bold text-blue-800 flex items-center gap-2">
                <Calendar className="w-5 h-5" />
                Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (30/60/90 ÙŠÙˆÙ…)
              </h3>
              <span className="px-3 py-1 bg-blue-600 text-white rounded-lg text-sm font-bold">{upcomingDeadlines.length} Ù…ÙˆØ¹Ø¯</span>
            </div>
            {upcomingDeadlines.length === 0 ? (
              <div className="p-8 text-center">
                <Calendar className="w-16 h-16 mx-auto mb-3 text-slate-300" />
                <p className="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù‚Ø§Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
              </div>
            ) : (
              <div className="divide-y divide-slate-100">
                {upcomingDeadlines.slice(0, 6).map(o => (
                  <div key={o.id} className="p-4 hover:bg-blue-50 flex items-center justify-between cursor-pointer" onClick={() => openDrawer(o, 'obligation')}>
                    <div className="flex items-center gap-4">
                      <div className="w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center">
                        <Calendar className="w-6 h-6 text-blue-600" />
                      </div>
                      <div>
                        <p className="font-bold text-slate-800">{(o.title || o.statement || '').substring(0, 50)}...</p>
                        <p className="text-sm text-slate-500">{getFrameworkName(o.frameworkId)} â€¢ {o.code}</p>
                      </div> </div>
                    <div className="text-left flex items-center gap-4">
                      <div>
                        <p className="font-bold text-blue-600">{o.effectiveFrom || '-'}</p>
                        <StatusBadge status={o.status} />
                      </div>
                      <Eye className="w-5 h-5 text-slate-400" />
                    </div> </div>
                ))}
              </div>
            )}
          </div>

          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100">
              <h3 className="font-bold text-slate-800 flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-emerald-500" />
                Ù…Ù‚Ø§Ø±Ù†Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ© - Q4 vs Q3
              </h3>
            </div>
            <div className="p-6">
              <div className="grid grid-cols-4 gap-6">
                <div className="text-center p-4 border-2 border-slate-100 rounded-xl">
                  <p className="text-sm text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
                  <p className="text-2xl font-black text-emerald-600">{overallCompliance}%</p>
                  <p className="text-sm text-emerald-600 mt-1">â†‘ +4% Ø¹Ù† Q3</p>
                </div>
                <div className="text-center p-4 border-2 border-slate-100 rounded-xl">
                  <p className="text-sm text-slate-500">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</p>
                  <p className="text-2xl font-black text-amber-600">{openBreaches.length}</p>
                  <p className="text-sm text-red-600 mt-1">â†‘ +1 Ø¹Ù† Q3</p>
                </div>
                <div className="text-center p-4 border-2 border-slate-100 rounded-xl">
                  <p className="text-sm text-slate-500">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</p>
                  <p className="text-2xl font-black text-emerald-600">{acceptedEvidence.length}</p>
                  <p className="text-sm text-emerald-600 mt-1">â†‘ +12 Ø¹Ù† Q3</p>
                </div>
                <div className="text-center p-4 border-2 border-slate-100 rounded-xl">
                  <p className="text-sm text-slate-500">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙØ¹Ø§Ù„Ø©</p>
                  <p className="text-2xl font-black text-emerald-600">{controlsPassed.length}</p>
                  <p className="text-sm text-emerald-600 mt-1">â†‘ +3 Ø¹Ù† Q3</p>
                </div> </div>
              <div className="mt-6 p-4 bg-slate-50 rounded-xl">
                <p className="font-bold text-slate-800 mb-2">Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØºÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</p>
                <ul className="space-y-1 text-sm text-slate-600">
                  <li>â€¢ ØªØ­Ø³Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø¨Ø³Ø¨Ø¨ Ø¥ØºÙ„Ø§Ù‚ 3 Ù…Ø®Ø§Ù„ÙØ§Øª ÙÙŠ Ù†ÙˆÙÙ…Ø¨Ø±</li>
                  <li>â€¢ Ø²ÙŠØ§Ø¯Ø© ÙØ¬ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù„Ø© Ø¨Ø³Ø¨Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø´Ù‡Ø§Ø¯Ø§Øª Penetration Test</li>
                  <li>â€¢ Ø§Ø±ØªÙØ§Ø¹ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙØ¹Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Q4</li>
                </ul>
              </div> </div> </div> </div>
      )}

      {activeReport === 'sama' && (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white">
            <div className="flex items-center gap-4 mb-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center font-black text-xl">SAMA</div>
              <div>
                <h2 className="text-xl font-black">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ© - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h2>
                <p className="text-emerald-200">Cybersecurity Oversight Report â€¢ {selectedPeriod}</p>
              </div> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-emerald-200 text-sm">ØªØºØ·ÙŠØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·</p>
                <p className="text-3xl font-black">{samaData.percentage}%</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-emerald-200 text-sm">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</p>
                <p className="text-3xl font-black">{samaData.compliant}/{samaData.total}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-emerald-200 text-sm">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù†Ø§Ù‚ØµØ©</p>
                <p className="text-3xl font-black">{evidenceGaps.length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-emerald-200 text-sm">Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…ÙØ¨Ù„ØºØ©</p>
                <p className="text-3xl font-black">{VIOLATIONS.filter(v => v.authority === 'SAMA').length}</p>
              </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100"><h3 className="font-bold text-slate-800">Ø§Ù„ØªØ²Ø§Ù…Ø§Øª SAMA</h3></div>
            <table className="w-full">
              <thead className="bg-slate-50"><tr>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¥Ø·Ø§Ø±</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
              </tr></thead>
              <tbody>
                {samaData.obligations.slice(0, 15).map(o => (
                  <tr key={o.id} className="border-t border-slate-100 hover:bg-emerald-50">
                    <td className="py-3 px-4 font-mono text-sm">{o.code}</td>
                    <td className="py-3 px-4 text-sm max-w-md truncate">{(o.title || o.statement || '-')}</td>
                    <td className="py-3 px-4">{getFrameworkName(o.frameworkId)}</td>
                    <td className="py-3 px-4"><SeverityBadge severity={o.criticality} /></td>
                    <td className="py-3 px-4"><StatusBadge status={o.status} /></td>
                    <td className="py-3 px-4 text-center"><button onClick={() => openDrawer(o, 'obligation')} className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-bold">Ø¹Ø±Ø¶</button></td>
                  </tr>
                ))}
              </tbody> </table> </div> </div>
      )}

      {activeReport === 'cma' && (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-6 text-white">
            <div className="flex items-center gap-4 mb-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center font-black text-xl">CMA</div>
              <div>
                <h2 className="text-xl font-black">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙØµØ§Ø­ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</h2>
                <p className="text-purple-200">Disclosure & Governance Report â€¢ {selectedPeriod}</p>
              </div> </div>
            <div className="grid grid-cols-3 gap-4">
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-purple-200 text-sm">Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¥ÙØµØ§Ø­</p>
                <p className="text-3xl font-black">{cmaData.percentage}%</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-purple-200 text-sm">Ø§Ù„Ø¥ÙØµØ§Ø­Ø§Øª</p>
                <p className="text-3xl font-black">{cmaData.compliant}/{cmaData.total}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-purple-200 text-sm">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</p>
                <p className="text-3xl font-black">{openBreaches.filter(b => b.authority === 'CMA').length}</p>
              </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100"><h3 className="font-bold text-slate-800">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙØµØ§Ø­ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</h3></div>
            <table className="w-full">
              <thead className="bg-slate-50"><tr>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù…ØªØ·Ù„Ø¨</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¥Ø·Ø§Ø±</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
              </tr></thead>
              <tbody>
                {cmaData.obligations.map(o => (
                  <tr key={o.id} className="border-t border-slate-100 hover:bg-purple-50">
                    <td className="py-3 px-4 font-mono text-sm">{o.code}</td>
                    <td className="py-3 px-4 text-sm">{(o.title || o.statement || '').substring(0, 60)}...</td>
                    <td className="py-3 px-4">{getFrameworkName(o.frameworkId)}</td>
                    <td className="py-3 px-4"><StatusBadge status={o.status} /></td>
                    <td className="py-3 px-4 text-center"><button onClick={() => openDrawer(o, 'obligation')} className="px-3 py-1 bg-purple-100 text-purple-700 rounded-lg text-sm font-bold">Ø¹Ø±Ø¶</button></td>
                  </tr>
                ))}
              </tbody> </table> </div> </div>
      )}

      {activeReport === 'nca' && (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-slate-700 to-slate-900 rounded-2xl p-6 text-white">
            <div className="flex items-center gap-4 mb-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center font-black text-xl">NCA</div>
              <div>
                <h2 className="text-xl font-black">ØªÙ‚Ø±ÙŠØ± Ø§Ù…ØªØ«Ø§Ù„ Ø¶ÙˆØ§Ø¨Ø· ECC</h2>
                <p className="text-slate-300">Control-by-Control Compliance â€¢ {selectedPeriod}</p>
              </div> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-slate-300 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºØ·ÙŠØ©</p>
                <p className="text-3xl font-black">{ncaData.percentage}%</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-slate-300 text-sm">Ø¶ÙˆØ§Ø¨Ø· Ù†Ø§Ø¬Ø­Ø©</p>
                <p className="text-3xl font-black text-emerald-400">{controlsPassed.length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-slate-300 text-sm">Ø¶ÙˆØ§Ø¨Ø· ÙØ§Ø´Ù„Ø©</p>
                <p className="text-3xl font-black text-red-400">{controlsFailed.length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-slate-300 text-sm">ØºÙŠØ± Ù…Ø®ØªØ¨Ø±Ø©</p>
                <p className="text-3xl font-black text-amber-400">{controlsNotTested.length}</p>
              </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100"><h3 className="font-bold text-slate-800">Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· - Control Matrix</h3></div>
            <table className="w-full">
              <thead className="bg-slate-50"><tr>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¶Ø§Ø¨Ø·</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ù†ÙˆØ¹</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</th>
                <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
              </tr></thead>
              <tbody>
                {CONTROLS.slice(0, 15).map(c => (
                  <tr key={c.id} className="border-t border-slate-100 hover:bg-slate-50">
                    <td className="py-3 px-4 font-mono text-sm">{c.code}</td>
                    <td className="py-3 px-4 text-sm">{c.name}</td>
                    <td className="py-3 px-4 text-sm">{c.type}</td>
                    <td className="py-3 px-4"><StatusBadge status={c.effectiveness} /></td>
                    <td className="py-3 px-4"><StatusBadge status={c.effectiveness} /></td>
                    <td className="py-3 px-4 text-center"><button onClick={() => openDrawer(c, 'control')} className="px-3 py-1 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold">Ø¹Ø±Ø¶</button></td>
                  </tr>
                ))}
              </tbody> </table> </div> </div>
      )}

      {activeReport === 'shomoos' && (
        <ShomoosCRUD selectedPeriod={selectedPeriod} />
      )}

      {activeReport === 'commerce' && (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl p-6 text-white">
            <div className="flex items-center gap-4 mb-4">
              <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center"><Building2 className="w-8 h-8" /></div>
              <div>
                <h2 className="text-xl font-black">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                <p className="text-blue-200">Corporate Compliance Report â€¢ {selectedPeriod}</p>
              </div> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-blue-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</p>
                <p className="text-3xl font-black">{OBLIGATIONS.length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-blue-200 text-sm">Ø§Ù„Ù…Ù„ØªØ²Ù… Ø¨Ù‡Ø§</p>
                <p className="text-3xl font-black">{OBLIGATIONS.filter(o => o.status === 'Active').length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-blue-200 text-sm">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</p>
                <p className="text-3xl font-black">{acceptedEvidence.length}</p>
              </div>
              <div className="bg-white/10 rounded-xl p-4">
                <p className="text-blue-200 text-sm">Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</p>
                <p className="text-3xl font-black">{openBreaches.length}</p>
              </div> </div> </div>
          <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-slate-100"><h3 className="font-bold text-slate-800">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© ({openBreaches.length})</h3></div>
            <table className="w-full">
              <thead className="bg-slate-50"><tr>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„ÙƒÙˆØ¯</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                <th className="text-right py-3 px-4 font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th className="text-center py-3 px-4 font-bold text-slate-600">ØªÙØ§ØµÙŠÙ„</th>
              </tr></thead>
              <tbody>
                {openBreaches.map(b => (
                  <tr key={b.id} className="border-t border-slate-100 hover:bg-blue-50">
                    <td className="py-3 px-4 font-mono text-sm">{b.code}</td>
                    <td className="py-3 px-4 font-bold text-slate-800">{b.title}</td>
                    <td className="py-3 px-4">{b.authority}</td>
                    <td className="py-3 px-4"><SeverityBadge severity={b.severity} /></td>
                    <td className="py-3 px-4"><StatusBadge status={b.status} /></td>
                    <td className="py-3 px-4 text-center"><button onClick={() => openDrawer(b, 'breach')} className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">Ø¹Ø±Ø¶</button></td>
                  </tr>
                ))}
              </tbody> </table> </div> </div>
      )}

      {showDrawer && drawerData && (
        <div className="fixed inset-0 bg-gradient-to-br from-slate-900/80 via-purple-900/50 to-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn" onClick={() => setShowDrawer(false)}>
          <div className={`w-full bg-white rounded-3xl shadow-2xl flex flex-col max-h-[92vh] overflow-hidden transform transition-all ${drawerData.type === 'evidence' ? 'max-w-6xl' : 'max-w-5xl'
            }`} onClick={e => e.stopPropagation()}>

            <div className={`relative overflow-hidden ${drawerData.type === 'decision' ? 'bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700' :
              drawerData.type === 'breach' ? 'bg-gradient-to-r from-red-600 via-rose-600 to-red-700' :
                drawerData.type === 'obligation' ? 'bg-gradient-to-r from-amber-500 via-orange-500 to-amber-600' :
                  drawerData.type === 'evidence' ? 'bg-gradient-to-r from-teal-500 via-emerald-500 to-teal-600' :
                    drawerData.type === 'control' ? 'bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-600' :
                      'bg-gradient-to-r from-slate-600 via-slate-700 to-slate-800'
              }`}>
              <div className="absolute inset-0 opacity-10">
                <div className="absolute top-0 left-0 w-40 h-40 bg-white rounded-full -translate-x-20 -translate-y-20" />
                <div className="absolute bottom-0 right-0 w-60 h-60 bg-white rounded-full translate-x-20 translate-y-20" />
              </div>

              <div className="relative px-8 py-6 flex items-start justify-between">
                <div className="flex items-center gap-5">
                  <div className={`w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg ${drawerData.type === 'decision' ? 'bg-white/20 backdrop-blur' :
                    drawerData.type === 'breach' ? 'bg-white/20 backdrop-blur' :
                      'bg-white/20 backdrop-blur'
                    }`}>
                    {drawerData.type === 'decision' && <Award className="w-8 h-8 text-white" />}
                    {drawerData.type === 'breach' && <AlertTriangle className="w-8 h-8 text-white" />}
                    {drawerData.type === 'obligation' && <FileText className="w-8 h-8 text-white" />}
                    {drawerData.type === 'evidence' && <FileCheck className="w-8 h-8 text-white" />}
                    {drawerData.type === 'control' && <Shield className="w-8 h-8 text-white" />}
                  </div>
                  <div className="text-white">
                    <p className="text-white/70 text-sm font-medium mb-1">
                      {drawerData.type === 'decision' ? 'Ù‚Ø±Ø§Ø± ÙŠØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' :
                        drawerData.type === 'breach' ? 'Ù…Ø®Ø§Ù„ÙØ© ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ØªØªØ·Ù„Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø©' :
                          drawerData.type === 'obligation' ? 'Ø§Ù„ØªØ²Ø§Ù… ØªÙ†Ø¸ÙŠÙ…ÙŠ' :
                            drawerData.type === 'evidence' ? 'Ø¯Ù„ÙŠÙ„ Ø§Ù…ØªØ«Ø§Ù„' : 'ØªÙØ§ØµÙŠÙ„'}
                    </p>
                    <h2 className="text-2xl font-black">{drawerData.item?.title || drawerData.item?.code || '-'}</h2>
                    {drawerData.item?.code && drawerData.item?.title && (
                      <p className="text-white/60 text-sm mt-1 font-mono">{drawerData.item.code}</p>
                    )}
                  </div> </div>
                <button onClick={() => setShowDrawer(false)} className="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-all hover:rotate-90 duration-300">
                  <X className="w-6 h-6 text-white" />
                </button> </div>
              {(drawerData.type === 'decision' || drawerData.type === 'breach' || drawerData.type === 'obligation') && (
                <div className="relative px-8 pb-6">
                  <div className="bg-white/10 backdrop-blur rounded-2xl p-4">
                    <div className="flex items-center justify-between">
                      {(drawerData.type === 'decision' ? [
                        { step: 1, label: 'Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', icon: FileText, desc: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©' },
                        { step: 2, label: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', icon: AlertTriangle, desc: 'Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©' },
                        { step: 3, label: 'Ø§Ù„ØªÙˆØµÙŠØ©', icon: Lightbulb, desc: 'Ø±Ø£ÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' },
                        { step: 4, label: 'Ø§Ù„ØªØµÙˆÙŠØª', icon: CheckSquare, desc: 'Ù‚Ø±Ø§Ø±Ùƒ' },
                        { step: 5, label: 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', icon: Award, desc: 'Ø§Ù„ØªÙˆÙ‚ÙŠØ¹' },
                      ] : drawerData.type === 'breach' ? [
                        { step: 1, label: 'Ø§Ù„ØªÙØ§ØµÙŠÙ„', icon: FileText, desc: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©' },
                        { step: 2, label: 'Ø®Ø·Ø© CAPA', icon: Settings, desc: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ' },
                        { step: 3, label: 'Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FileCheck, desc: 'Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©' },
                        { step: 4, label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: CheckSquare, desc: 'Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©' },
                      ] : [
                        { step: 1, label: 'Ø§Ù„ØªÙØ§ØµÙŠÙ„', icon: FileText, desc: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…' },
                        { step: 2, label: 'Ø§Ù„Ø£Ø¯Ù„Ø©', icon: FileCheck, desc: 'Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' },
                        { step: 3, label: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: Shield, desc: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©' },
                        { step: 4, label: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', icon: ClipboardCheck, desc: 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ' },
                      ]).map((item, idx, arr) => (
                        <React.Fragment key={item.step}>
                          <button
                            onClick={() => setModalStep(item.step)}
                            className={`flex flex-col items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${modalStep === item.step
                              ? 'bg-white text-purple-700 shadow-lg scale-105'
                              : modalStep > item.step
                                ? 'text-white/90 hover:bg-white/10'
                                : 'text-white/50 hover:text-white/70'
                              }`}
                          >
                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${modalStep === item.step
                              ? 'bg-purple-100'
                              : modalStep > item.step
                                ? 'bg-emerald-500/30'
                                : 'bg-white/10'
                              }`}>
                              {modalStep > item.step ? (
                                <CheckCircle2 className="w-6 h-6 text-emerald-400" />
                              ) : (
                                <item.icon className={`w-6 h-6 ${modalStep === item.step ? 'text-purple-600' : ''}`} />
                              )}
                            </div>
                            <div className="text-center">
                              <p className={`text-sm font-bold ${modalStep === item.step ? 'text-purple-700' : ''}`}>{item.label}</p>
                              <p className={`text-xs ${modalStep === item.step ? 'text-purple-500' : 'opacity-70'}`}>{item.desc}</p>
                            </div> </button>
                          {idx < arr.length - 1 && (
                            <div className={`flex-1 h-1 mx-2 rounded-full transition-all duration-500 ${modalStep > item.step ? 'bg-emerald-400' : 'bg-white/20'
                              }`} />
                          )}
                        </React.Fragment>
                      ))}
                    </div> </div> </div>
              )}
            </div>

            <div className="flex-1 overflow-y-auto">
              <div className="p-8">

                {drawerData.type === 'decision' && (
                  <div className="space-y-6">

                    {modalStep === 1 && (
                      <div className="space-y-6 animate-fadeIn">
                        <div className="bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-2xl p-8">
                          <div className="flex items-start gap-6">
                            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg">
                              <FileText className="w-8 h-8 text-white" />
                            </div>
                            <div className="flex-1">
                              <h3 className="font-black text-indigo-900 text-2xl mb-3">
                                {drawerData.item?.id === 1 ? 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Critical Ù„Ù…Ø¯Ø© 90 ÙŠÙˆÙ…' :
                                  drawerData.item?.id === 2 ? 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù…Ø´Ø±ÙˆØ¹ SOC 2 Type II' :
                                    'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©'}
                              </h3>
                              <p className="text-indigo-700 text-lg leading-relaxed">
                                {drawerData.item?.id === 1 && 'Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯ Ù…ÙˆØ¹Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø«ØºØ±Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ø­Ø±Ø¬Ø© CVE-2024-XXXX ÙÙŠ Ù†Ø¸Ø§Ù… Core Banking Ù„Ù…Ø¯Ø© 90 ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ø³Ø¨Ø¨ ØªØ¹Ù‚ÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±Ù‚ÙŠØ© ÙˆØ¶Ø±ÙˆØ±Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©. ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø«ØºØ±Ø© ÙÙŠ ØªØ§Ø±ÙŠØ® 2024-01-15 ÙˆØªØªØ·Ù„Ø¨ Ù…ÙˆØ§Ø±Ø¯ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¢Ù…Ù†Ø©.'}
                                {drawerData.item?.id === 2 && 'Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…ÙŠØ²Ø§Ù†ÙŠØ© 1.2 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„ Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© SOC 2 Type II Ø®Ù„Ø§Ù„ Ø¹Ø§Ù… 2024. ÙŠØ´Ù…Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙØ¬ÙˆØ§ØªØŒ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·ØŒ Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©ØŒ Ø£Ø¯ÙˆØ§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…ØªÙ‚Ø¯Ù…Ø©ØŒ ÙˆØªØ¯Ø±ÙŠØ¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ.'}
                                {drawerData.item?.id === 3 && 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù…ÙˆØ§Ø¡Ù…Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© (PDPL) Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ØµØ§Ø¯Ø± Ù…Ù† Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (SDAIA).'}
                              </p> </div> </div> </div>
                        <div className="grid grid-cols-4 gap-4">
                          <div className="bg-white rounded-2xl p-5 border-2 border-slate-100 hover:border-purple-200 hover:shadow-lg transition-all cursor-default group">
                            <div className="flex items-center gap-3 mb-3">
                              <div className="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <User className="w-5 h-5 text-purple-600" />
                              </div>
                              <p className="text-slate-500 text-sm">Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                            </div>
                            <p className="font-black text-slate-800 text-lg">
                              {drawerData.item?.id === 1 ? 'CISO' : drawerData.item?.id === 2 ? 'CFO / CISO' : 'DPO'}
                            </p>
                            <p className="text-slate-500 text-sm">
                              {drawerData.item?.id === 1 ? 'Ù…Ø¯ÙŠØ± Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' : drawerData.item?.id === 2 ? 'Ø§Ù„Ù…Ø§Ù„ÙŠØ© / Ø§Ù„Ø£Ù…Ù†' : 'Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'}
                            </p> </div>
                          <div className="bg-white rounded-2xl p-5 border-2 border-slate-100 hover:border-red-200 hover:shadow-lg transition-all cursor-default group">
                            <div className="flex items-center gap-3 mb-3">
                              <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <Calendar className="w-5 h-5 text-red-600" />
                              </div>
                              <p className="text-slate-500 text-sm">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                            </div>
                            <p className="font-black text-red-600 text-lg">
                              {drawerData.item?.id === 1 ? '2024-03-15' : drawerData.item?.id === 2 ? '2024-04-01' : '2024-09-14'}
                            </p>
                            <p className="text-red-500 text-sm">
                              {drawerData.item?.id === 1 ? 'Ù…ØªØ¨Ù‚ÙŠ 45 ÙŠÙˆÙ…' : drawerData.item?.id === 2 ? 'Ù…ØªØ¨Ù‚ÙŠ 60 ÙŠÙˆÙ…' : 'Ù…ØªØ¨Ù‚ÙŠ 90 ÙŠÙˆÙ…'}
                            </p> </div>
                          <div className="bg-white rounded-2xl p-5 border-2 border-slate-100 hover:border-emerald-200 hover:shadow-lg transition-all cursor-default group">
                            <div className="flex items-center gap-3 mb-3">
                              <div className="w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <Building2 className="w-5 h-5 text-emerald-600" />
                              </div>
                              <p className="text-slate-500 text-sm">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©</p>
                            </div>
                            <p className="font-black text-slate-800 text-lg">
                              {drawerData.item?.id === 1 ? 'SAMA + NCA' : drawerData.item?.id === 2 ? 'Global Standard' : 'SDAIA'}
                            </p>
                            <p className="text-slate-500 text-sm">
                              {drawerData.item?.id === 1 ? 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ + Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ' : drawerData.item?.id === 2 ? 'Ù…Ø¹ÙŠØ§Ø± Ø¯ÙˆÙ„ÙŠ' : 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'}
                            </p> </div>
                          <div className="bg-white rounded-2xl p-5 border-2 border-slate-100 hover:border-amber-200 hover:shadow-lg transition-all cursor-default group">
                            <div className="flex items-center gap-3 mb-3">
                              <div className="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <AlertTriangle className="w-5 h-5 text-amber-600" />
                              </div>
                              <p className="text-slate-500 text-sm">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</p>
                            </div>
                            <span className={`inline-block px-4 py-2 rounded-xl font-black text-lg ${drawerData.item?.id === 1 ? 'bg-red-100 text-red-700' :
                              drawerData.item?.id === 2 ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                              }`}>
                              {drawerData.item?.id === 1 ? 'Critical' : drawerData.item?.id === 2 ? 'High' : 'Medium'}
                            </span> </div> </div>
                        <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                          <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <BarChart3 className="w-5 h-5 text-slate-500" />
                            Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©
                          </h4>
                          <div className="grid grid-cols-3 gap-4">
                            <div className="text-center p-4 bg-white rounded-xl">
                              <p className="text-3xl font-black text-purple-600">{drawerData.item?.id === 1 ? '45' : drawerData.item?.id === 2 ? '180' : '90'}</p>
                              <p className="text-slate-500 text-sm">ÙŠÙˆÙ… Ù„Ù„ØªÙ†ÙÙŠØ°</p>
                            </div>
                            <div className="text-center p-4 bg-white rounded-xl">
                              <p className="text-3xl font-black text-emerald-600">{drawerData.item?.id === 1 ? '3' : drawerData.item?.id === 2 ? '5' : '2'}</p>
                              <p className="text-slate-500 text-sm">Ø£Ø·Ø±Ø§Ù Ù…Ø¹Ù†ÙŠØ©</p>
                            </div>
                            <div className="text-center p-4 bg-white rounded-xl">
                              <p className="text-3xl font-black text-amber-600">{drawerData.item?.id === 1 ? '1' : drawerData.item?.id === 2 ? '4' : '1'}</p>
                              <p className="text-slate-500 text-sm">Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø±ØªØ¨Ø·Ø©</p>
                            </div> </div> </div> </div>
                    )}

                    {modalStep === 2 && (
                      <div className="space-y-6 animate-fadeIn">
                        <div className="bg-gradient-to-br from-red-50 to-rose-50 border-2 border-red-200 rounded-2xl p-6">
                          <div className="flex items-center gap-4 mb-4">
                            <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center shadow-lg">
                              <AlertTriangle className="w-7 h-7 text-white" />
                            </div>
                            <div>
                              <h3 className="font-black text-red-800 text-xl">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø¢Ø«Ø§Ø±</h3>
                              <p className="text-red-600">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªØ±ØªØ¨Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±</p>
                            </div> </div> </div>
                        <div className="space-y-4">
                          {(drawerData.item?.id === 1 ? [
                            { title: 'Ø¹Ù‚ÙˆØ¨Ø© Ø±Ù‚Ø§Ø¨ÙŠØ© Ù…Ù† SAMA', desc: 'Ù‚Ø¯ ØªØµÙ„ Ø§Ù„ØºØ±Ø§Ù…Ø© Ø¥Ù„Ù‰ 500,000 Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ Ù…Ø¹ Ø§Ø­ØªÙ…Ø§Ù„ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¶Ù…Ù† Ø§Ù„ÙØ¦Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', impact: 'Ù…Ø§Ù„ÙŠ', severity: 'critical', amount: '500,000 Ø±ÙŠØ§Ù„' },
                            { title: 'ØªØµÙ†ÙŠÙ Ø³Ù„Ø¨ÙŠ Ù…Ù† NCA', desc: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙƒÙ€ "Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø±" ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù…Ù…Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù…Ø¹Ø©', impact: 'Ø³Ù…Ø¹Ø©', severity: 'high', amount: 'ØªØµÙ†ÙŠÙ Ø³Ù„Ø¨ÙŠ' },
                            { title: 'Ø®Ø·Ø± Ø£Ù…Ù†ÙŠ Ù…Ø¨Ø§Ø´Ø±', desc: 'Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø«ØºØ±Ø© Ù…Ù† Ù…Ù‡Ø§Ø¬Ù…ÙŠÙ† Ø®Ø§Ø±Ø¬ÙŠÙŠÙ† Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©', impact: 'Ø£Ù…Ù†ÙŠ', severity: 'critical', amount: 'Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ø­ØªÙ…Ù„' },
                          ] : drawerData.item?.id === 2 ? [
                            { title: 'ÙÙ‚Ø¯Ø§Ù† ÙØ±Øµ ØªØ¬Ø§Ø±ÙŠØ©', desc: 'Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ù…Ø¹ Ø¹Ù…Ù„Ø§Ø¡ Ø¯ÙˆÙ„ÙŠÙŠÙ† ÙŠØ´ØªØ±Ø·ÙˆÙ† Ø´Ù‡Ø§Ø¯Ø© SOC 2', impact: 'ØªØ¬Ø§Ø±ÙŠ', severity: 'high', amount: '2-5 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„' },
                            { title: 'ØªØ±Ø§Ø¬Ø¹ Ø«Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†', desc: 'Ø¶Ø¹Ù Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠ Ø£Ù…Ø§Ù… Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù†Ø§ÙØ³Ø© Ø§Ù„Ø­Ø§ØµÙ„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©', impact: 'Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ', severity: 'medium', amount: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' },
                            { title: 'Ø¹Ø¯Ù… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©', desc: 'ØªØ£Ø®Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙˆØ³Ø¹ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© 2025', impact: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ', severity: 'medium', amount: 'ØªØ£Ø®ÙŠØ± Ø³Ù†Ø©' },
                          ] : [
                            { title: 'Ù…Ø®Ø§Ù„ÙØ© Ù†Ø¸Ø§Ù… PDPL', desc: 'Ù…Ø®Ø§Ù„ÙØ© ØµØ±ÙŠØ­Ø© Ù„Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù‚Ø¯ ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª', impact: 'Ù‚Ø§Ù†ÙˆÙ†ÙŠ', severity: 'critical', amount: 'Ù…Ø®Ø§Ù„ÙØ© Ù†Ø¸Ø§Ù…ÙŠØ©' },
                            { title: 'ØºØ±Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ© Ø¶Ø®Ù…Ø©', desc: 'ØºØ±Ø§Ù…Ø§Øª Ù‚Ø¯ ØªØµÙ„ Ø¥Ù„Ù‰ 5 Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„ Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', impact: 'Ù…Ø§Ù„ÙŠ', severity: 'critical', amount: '5,000,000 Ø±ÙŠØ§Ù„' },
                            { title: 'Ø¶Ø±Ø± Ø¨Ø§Ù„Ø³Ù…Ø¹Ø©', desc: 'ØªØ£Ø«ÙŠØ± Ø³Ù„Ø¨ÙŠ ÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ Ø³Ù…Ø¹Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ«Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ù…', impact: 'Ø³Ù…Ø¹Ø©', severity: 'high', amount: 'Ø¶Ø±Ø± ÙƒØ¨ÙŠØ±' },
                          ]).map((risk, idx) => (
                            <div key={idx} className={`p-5 rounded-2xl border-2 transition-all hover:shadow-lg ${risk.severity === 'critical' ? 'bg-red-50 border-red-200 hover:border-red-400' :
                              risk.severity === 'high' ? 'bg-amber-50 border-amber-200 hover:border-amber-400' :
                                'bg-blue-50 border-blue-200 hover:border-blue-400'
                              }`}>
                              <div className="flex items-start justify-between">
                                <div className="flex items-start gap-4">
                                  <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-black text-white ${risk.severity === 'critical' ? 'bg-red-500' : risk.severity === 'high' ? 'bg-amber-500' : 'bg-blue-500'
                                    }`}>{idx + 1}</div>
                                  <div>
                                    <h4 className="font-bold text-slate-800 text-lg">{risk.title}</h4>
                                    <p className="text-slate-600 mt-1">{risk.desc}</p>
                                  </div> </div>
                                <div className="text-left">
                                  <span className={`px-3 py-1 rounded-lg text-sm font-bold ${risk.severity === 'critical' ? 'bg-red-100 text-red-700' :
                                    risk.severity === 'high' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                                    }`}>{risk.impact}</span>
                                  <p className={`mt-2 font-black text-lg ${risk.severity === 'critical' ? 'text-red-600' : risk.severity === 'high' ? 'text-amber-600' : 'text-blue-600'
                                    }`}>{risk.amount}</p>
                                </div> </div> </div>
                          ))}
                        </div>

                        <div className="bg-gradient-to-r from-red-600 to-rose-600 rounded-2xl p-6 text-white">
                          <div className="flex items-center justify-between">
                            <div>
                              <p className="text-red-200 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ØªÙ…Ù„</p>
                              <p className="text-4xl font-black">
                                {drawerData.item?.id === 1 ? '500,000+' : drawerData.item?.id === 2 ? '2-5 Ù…Ù„ÙŠÙˆÙ†' : '5,000,000'}
                                <span className="text-xl font-normal mr-2">Ø±ÙŠØ§Ù„</span>
                              </p> </div>
                            <div className="text-left">
                              <p className="text-red-200 mb-1">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙƒÙ„ÙŠ</p>
                              <span className="px-4 py-2 bg-white/20 rounded-xl font-black text-xl">
                                {drawerData.item?.id === 1 ? 'Ø­Ø±Ø¬ Ø¬Ø¯Ø§Ù‹' : drawerData.item?.id === 2 ? 'Ø¹Ø§Ù„ÙŠ' : 'Ø­Ø±Ø¬'}
                              </span> </div> </div> </div> </div>
                    )}

                    {modalStep === 3 && (
                      <div className="space-y-6 animate-fadeIn">
                        <div className="bg-gradient-to-br from-emerald-50 to-teal-50 border-2 border-emerald-200 rounded-2xl p-8">
                          <div className="flex items-start gap-6">
                            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg flex-shrink-0">
                              <Lightbulb className="w-8 h-8 text-white" />
                            </div>
                            <div>
                              <h3 className="font-black text-emerald-800 text-xl mb-3">ØªÙˆØµÙŠØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</h3>
                              <p className="text-emerald-700 text-lg leading-relaxed">
                                {drawerData.item?.id === 1 && 'ØªÙˆØµÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø¶ÙˆØ§Ø¨Ø· ØªØ¹ÙˆÙŠØ¶ÙŠØ© ØµØ§Ø±Ù…Ø© ØªØ´Ù…Ù„: Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ù†Ø¸Ø§Ù…ØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„ØªÙ‚Ø¯Ù…ØŒ ÙˆØ®Ø·Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ù…Ø­Ø¯Ø«Ø©.'}
                                {drawerData.item?.id === 2 && 'ØªÙˆØµÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù†Ø¸Ø±Ø§Ù‹ Ù„Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ ÙˆØ£Ù‡Ù…ÙŠØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙÙŠ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠ ÙˆØ¬Ø°Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙˆÙ„ÙŠÙŠÙ†.'}
                                {drawerData.item?.id === 3 && 'ØªÙˆØµÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØªØ¬Ù†Ø¨ Ø£ÙŠ Ù…Ø®Ø§Ù„ÙØ§Øª ØªÙ†Ø¸ÙŠÙ…ÙŠØ©.'}
                              </p> </div> </div> </div>
                        <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6">
                          <h4 className="font-bold text-blue-800 text-lg mb-4 flex items-center gap-2">
                            <Shield className="w-5 h-5" />
                            Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ¹ÙˆÙŠØ¶ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                          </h4>
                          <div className="grid grid-cols-2 gap-4">
                            {[
                              { icon: Clock, text: 'ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§' },
                              { icon: Bell, text: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØµØ¹ÙŠØ¯ ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø£ÙŠ ØªØ£Ø®ÙŠØ±' },
                              { icon: Users, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ù‡Ø±ÙŠØ© Ù…Ù† Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±' },
                              { icon: Shield, text: 'Ø¶ÙˆØ§Ø¨Ø· Ø£Ù…Ù†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø¤Ù‚ØªØ©' },
                            ].map((item, idx) => (
                              <div key={idx} className="flex items-center gap-3 p-4 bg-white rounded-xl border border-blue-100">
                                <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                                  <item.icon className="w-5 h-5 text-blue-600" />
                                </div>
                                <span className="text-slate-700 font-medium">{item.text}</span>
                              </div>
                            ))}
                          </div> </div>
                        <div className="bg-slate-50 rounded-2xl p-6 border border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Paperclip className="w-5 h-5 text-slate-500" />
                            Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø¯Ø§Ø¹Ù…Ø©
                          </h4>
                          <div className="space-y-3">
                            {[
                              { name: 'ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ.pdf', size: '2.3 MB', type: 'PDF' },
                              { name: 'Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ.xlsx', size: '856 KB', type: 'Excel' },
                              { name: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.docx', size: '1.1 MB', type: 'Word' },
                            ].map((file, idx) => (
                              <div key={idx} className="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-200 hover:border-purple-300 hover:shadow transition-all cursor-pointer group">
                                <div className="flex items-center gap-4">
                                  <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${file.type === 'PDF' ? 'bg-red-100' : file.type === 'Excel' ? 'bg-emerald-100' : 'bg-blue-100'
                                    }`}>
                                    <FileText className={`w-6 h-6 ${file.type === 'PDF' ? 'text-red-600' : file.type === 'Excel' ? 'text-emerald-600' : 'text-blue-600'
                                      }`} />
                                  </div>
                                  <div>
                                    <p className="font-bold text-slate-800">{file.name}</p>
                                    <p className="text-slate-500 text-sm">{file.size}</p>
                                  </div> </div>
                                <button className="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg font-bold text-sm group-hover:bg-purple-100 group-hover:text-purple-700 transition-all">
                                  <Download className="w-4 h-4" />
                                </button> </div>
                            ))}
                          </div> </div> </div>
                    )}

                    {modalStep === 4 && (
                      <div className="space-y-6 animate-fadeIn">
                        <div className="bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-200 rounded-2xl p-8">
                          <div className="text-center mb-8">
                            <div className="w-20 h-20 rounded-3xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mx-auto mb-4 shadow-lg">
                              <CheckSquare className="w-10 h-10 text-white" />
                            </div>
                            <h3 className="font-black text-purple-800 text-2xl mb-2">ØªØµÙˆÙŠØª Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
                            <p className="text-purple-600">Ø§Ø®ØªØ± Ù‚Ø±Ø§Ø±Ùƒ Ø¨Ø´Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ø¯</p>
                          </div>

                          <div className="grid grid-cols-3 gap-6 mb-8">
                            <button onClick={() => setVoteSelection('approved')}
                              className={`p-8 rounded-2xl border-3 transition-all duration-300 ${voteSelection === 'approved'
                                ? 'bg-emerald-100 border-emerald-500 shadow-lg scale-105'
                                : 'bg-white border-slate-200 hover:border-emerald-300 hover:shadow'
                                }`}>
                              <div className={`w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center transition-all ${voteSelection === 'approved' ? 'bg-emerald-500' : 'bg-slate-100'
                                }`}>
                                <CheckCircle2 className={`w-10 h-10 ${voteSelection === 'approved' ? 'text-white' : 'text-slate-400'}`} />
                              </div>
                              <p className={`font-black text-xl ${voteSelection === 'approved' ? 'text-emerald-700' : 'text-slate-600'}`}>Ø§Ø¹ØªÙ…Ø§Ø¯</p>
                              <p className={`text-sm mt-1 ${voteSelection === 'approved' ? 'text-emerald-600' : 'text-slate-400'}`}>Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Ø§Ø±</p>
                            </button>

                            <button onClick={() => setVoteSelection('deferred')}
                              className={`p-8 rounded-2xl border-3 transition-all duration-300 ${voteSelection === 'deferred'
                                ? 'bg-amber-100 border-amber-500 shadow-lg scale-105'
                                : 'bg-white border-slate-200 hover:border-amber-300 hover:shadow'
                                }`}>
                              <div className={`w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center transition-all ${voteSelection === 'deferred' ? 'bg-amber-500' : 'bg-slate-100'
                                }`}>
                                <Clock className={`w-10 h-10 ${voteSelection === 'deferred' ? 'text-white' : 'text-slate-400'}`} />
                              </div>
                              <p className={`font-black text-xl ${voteSelection === 'deferred' ? 'text-amber-700' : 'text-slate-600'}`}>ØªØ£Ø¬ÙŠÙ„</p>
                              <p className={`text-sm mt-1 ${voteSelection === 'deferred' ? 'text-amber-600' : 'text-slate-400'}`}>Ù„Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>
                            </button>

                            <button onClick={() => setVoteSelection('rejected')}
                              className={`p-8 rounded-2xl border-3 transition-all duration-300 ${voteSelection === 'rejected'
                                ? 'bg-red-100 border-red-500 shadow-lg scale-105'
                                : 'bg-white border-slate-200 hover:border-red-300 hover:shadow'
                                }`}>
                              <div className={`w-20 h-20 rounded-2xl mx-auto mb-4 flex items-center justify-center transition-all ${voteSelection === 'rejected' ? 'bg-red-500' : 'bg-slate-100'
                                }`}>
                                <X className={`w-10 h-10 ${voteSelection === 'rejected' ? 'text-white' : 'text-slate-400'}`} />
                              </div>
                              <p className={`font-black text-xl ${voteSelection === 'rejected' ? 'text-red-700' : 'text-slate-600'}`}>Ø±ÙØ¶</p>
                              <p className={`text-sm mt-1 ${voteSelection === 'rejected' ? 'text-red-600' : 'text-slate-400'}`}>Ø¹Ø¯Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
                            </button> </div>
                          <div>
                            <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea
                              value={voteComments}
                              onChange={(e) => setVoteComments(e.target.value)}
                              placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø´Ø±ÙˆØ· Ø£Ùˆ ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ù„Ù„Ù‚Ø±Ø§Ø±..."
                              className="w-full h-32 px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-purple-400 resize-none text-lg transition-all"
                            />
                          </div> </div> </div>
                    )}

                    {modalStep === 5 && (
                      <div className="space-y-6 animate-fadeIn">
                        {showSuccess ? (
                          <div className="text-center py-16">
                            <div className="w-24 h-24 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-6 animate-bounce">
                              <CheckCircle2 className="w-14 h-14 text-emerald-600" />
                            </div>
                            <h3 className="font-black text-emerald-800 text-3xl mb-2">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!</h3>
                            <p className="text-emerald-600 text-lg">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø±Ùƒ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯Ù‡</p>
                          </div>
                        ) : (
                          <>
                            <div className={`p-6 rounded-2xl border-2 ${voteSelection === 'approved' ? 'bg-emerald-50 border-emerald-300' :
                              voteSelection === 'rejected' ? 'bg-red-50 border-red-300' :
                                voteSelection === 'deferred' ? 'bg-amber-50 border-amber-300' : 'bg-slate-50 border-slate-300'
                              }`}>
                              <div className="flex items-center justify-between">
                                <div>
                                  <p className="text-slate-600 mb-1">Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
                                  <p className={`text-3xl font-black ${voteSelection === 'approved' ? 'text-emerald-700' :
                                    voteSelection === 'rejected' ? 'text-red-700' :
                                      voteSelection === 'deferred' ? 'text-amber-700' : 'text-slate-500'
                                    }`}>
                                    {voteSelection === 'approved' ? 'âœ“ Ù…Ø¹ØªÙ…Ø¯' :
                                      voteSelection === 'rejected' ? 'âœ— Ù…Ø±ÙÙˆØ¶' :
                                        voteSelection === 'deferred' ? 'â¸ Ù…Ø¤Ø¬Ù„' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯'}
                                  </p> </div>
                                {voteSelection && (
                                  <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${voteSelection === 'approved' ? 'bg-emerald-500' :
                                    voteSelection === 'rejected' ? 'bg-red-500' : 'bg-amber-500'
                                    }`}>
                                    {voteSelection === 'approved' ? <CheckCircle2 className="w-8 h-8 text-white" /> :
                                      voteSelection === 'rejected' ? <X className="w-8 h-8 text-white" /> :
                                        <Clock className="w-8 h-8 text-white" />}
                                  </div>
                                )}
                              </div>
                              {voteComments && (
                                <div className="mt-4 pt-4 border-t border-slate-200">
                                  <p className="text-slate-500 text-sm">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</p>
                                  <p className="text-slate-700">{voteComments}</p>
                                </div>
                              )}
                            </div>

                            <div className="bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-200 rounded-2xl p-8">
                              <div className="text-center mb-6">
                                <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mx-auto mb-4 shadow-lg">
                                  <Award className="w-8 h-8 text-white" />
                                </div>
                                <h3 className="font-black text-purple-800 text-xl">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                              </div>

                              <div className="grid grid-cols-2 gap-6 mb-6">
                                <div>
                                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                                  <input
                                    type="text"
                                    value={signOffData.name}
                                    onChange={(e) => setSignOffData({ ...signOffData, name: e.target.value })}
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"
                                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-purple-400 transition-all text-lg"
                                  />
                                </div>
                                <div>
                                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ù†ØµØ¨ *</label>
                                  <input
                                    type="text"
                                    value={signOffData.role}
                                    onChange={(e) => setSignOffData({ ...signOffData, role: e.target.value })}
                                    placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¶Ùˆ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"
                                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-purple-400 transition-all text-lg"
                                  />
                                </div>
                                <div>
                                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ® *</label>
                                  <input
                                    type="date"
                                    value={signOffData.date}
                                    onChange={(e) => setSignOffData({ ...signOffData, date: e.target.value })}
                                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-purple-400 transition-all text-lg"
                                  />
                                </div>
                                <div>
                                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ / Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                  <input
                                    type="password"
                                    value={signOffData.pin}
                                    onChange={(e) => setSignOffData({ ...signOffData, pin: e.target.value })}
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ"
                                    className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-purple-400 transition-all text-lg"
                                  />
                                </div> </div>
                              <button
                                onClick={handleSubmitDecision}
                                disabled={!voteSelection || !signOffData.name || !signOffData.role || !signOffData.date || !signOffData.pin || isSubmitting}
                                className={`w-full py-5 rounded-2xl font-black text-xl flex items-center justify-center gap-3 transition-all ${!voteSelection || !signOffData.name || !signOffData.role || !signOffData.date || !signOffData.pin
                                  ? 'bg-slate-200 text-slate-400 cursor-not-allowed'
                                  : isSubmitting
                                    ? 'bg-purple-400 text-white'
                                    : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-lg hover:scale-[1.02]'
                                  }`}
                              >
                                {isSubmitting ? (
                                  <>
                                    <div className="w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin" />
                                    Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...
                                  </>
                                ) : (
                                  <>
                                    <Award className="w-7 h-7" />
                                    ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±
                                  </>
                                )}
                              </button> </div>
                          </>
                        )}
                      </div>
                    )}
                  </div>
                )}

                {drawerData.type === 'breach' && drawerData.item && (
                  <div className="space-y-6">
                    {modalStep === 1 && (
                      <>
                        <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-6">
                          <h3 className="font-black text-red-900 text-xl mb-2">{drawerData.item.title}</h3>
                          <p className="text-red-700">{drawerData.item.description || 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©'}</p>
                        </div>
                        <div className="grid grid-cols-3 gap-4">
                          {[
                            { label: 'Ø§Ù„ÙƒÙˆØ¯', value: drawerData.item.code, icon: Hash },
                            { label: 'Ø§Ù„Ø®Ø·ÙˆØ±Ø©', value: drawerData.item.severity, icon: AlertTriangle, isBadge: true },
                            { label: 'Ø§Ù„Ø¬Ù‡Ø©', value: drawerData.item.authority, icon: Building2 },
                            { label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù', value: drawerData.item.detectedDate, icon: Calendar },
                            { label: 'Ø§Ù„Ø­Ø§Ù„Ø©', value: drawerData.item.status, icon: Activity, isStatus: true },
                            { label: 'Ø§Ù„Ø¹Ù…Ø±', value: `${Math.floor((new Date() - new Date(drawerData.item.detectedDate)) / (1000 * 60 * 60 * 24))} ÙŠÙˆÙ…`, icon: Clock, isRed: true },
                          ].map((item, idx) => (
                            <div key={idx} className="bg-white rounded-xl p-4 border-2 border-slate-100 hover:border-red-200 transition-all">
                              <div className="flex items-center gap-2 mb-2">
                                <item.icon className="w-4 h-4 text-slate-400" />
                                <p className="text-slate-500 text-sm">{item.label}</p>
                              </div>
                              {item.isBadge ? <SeverityBadge severity={item.value} /> :
                                item.isStatus ? <StatusBadge status={item.value} /> :
                                  <p className={`font-bold ${item.isRed ? 'text-red-600' : 'text-slate-800'}`}>{item.value}</p>}
                            </div>
                          ))}
                        </div>
                      </>
                    )}
                    {modalStep === 2 && (
                      <div className="bg-amber-50 border-2 border-amber-200 rounded-2xl p-6">
                        <h3 className="font-black text-amber-800 text-lg mb-4">Ø®Ø·Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ (CAPA)</h3>
                        <div className="space-y-3">
                          {['ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ', 'ÙˆØ¶Ø¹ Ø®Ø·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©'].map((step, idx) => (
                            <div key={idx} className={`flex items-center gap-3 p-4 rounded-xl ${idx < 2 ? 'bg-emerald-50 border border-emerald-200' : idx === 2 ? 'bg-amber-100 border border-amber-300' : 'bg-slate-100 border border-slate-200'}`}>
                              {idx < 2 ? <CheckCircle2 className="w-5 h-5 text-emerald-600" /> : idx === 2 ? <Clock className="w-5 h-5 text-amber-600" /> : <div className="w-5 h-5 rounded-full border-2 border-slate-300" />}
                              <span className={idx < 2 ? 'text-emerald-700' : idx === 2 ? 'text-amber-700' : 'text-slate-500'}>{step}</span>
                              <span className={`mr-auto font-bold text-sm ${idx < 2 ? 'text-emerald-600' : idx === 2 ? 'text-amber-600' : 'text-slate-400'}`}>{idx < 2 ? 'Ù…ÙƒØªÙ…Ù„' : idx === 2 ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…Ø¹Ù„Ù‚'}</span>
                            </div>
                          ))}
                        </div> </div>
                    )}
                    {modalStep === 3 && (
                      <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6">
                        <h3 className="font-bold text-blue-800 mb-4">Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</h3>
                        <div className="space-y-3">
                          {['ØªÙ‚Ø±ÙŠØ± Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©.pdf', 'Ø®Ø·Ø© CAPA Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.docx', 'Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©.pdf'].map((file, idx) => (
                            <div key={idx} className="flex items-center justify-between p-4 bg-white rounded-xl border">
                              <div className="flex items-center gap-3"><FileText className="w-6 h-6 text-blue-500" /><span className="font-medium">{file}</span></div>
                              <button className="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-bold text-sm">ØªØ­Ù…ÙŠÙ„</button>
                            </div>
                          ))}
                        </div> </div>
                    )}
                    {modalStep === 4 && (
                      <div className="grid grid-cols-2 gap-4">
                        {[
                          { label: 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', icon: CheckCircle2, color: 'emerald' },
                          { label: 'Ø·Ù„Ø¨ ØªÙ…Ø¯ÙŠØ¯', icon: Clock, color: 'amber' },
                          { label: 'Ø¥Ø¶Ø§ÙØ© Ø¯Ù„ÙŠÙ„', icon: Plus, color: 'blue' },
                          { label: 'ØªØµØ¹ÙŠØ¯', icon: ArrowUp, color: 'purple' },
                        ].map((action, idx) => (
                          <button key={idx} className={`p-6 bg-${action.color}-50 text-${action.color}-700 rounded-2xl font-bold flex items-center justify-center gap-3 border-2 border-${action.color}-200 hover:bg-${action.color}-100 transition-all`}>
                            <action.icon className="w-6 h-6" />{action.label}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {drawerData.type === 'obligation' && drawerData.item && (
                  <div className="space-y-6">
                    {modalStep === 1 && (
                      <>
                        <div className="bg-amber-50 border-2 border-amber-200 rounded-2xl p-6">
                          <h3 className="font-black text-amber-900 text-xl mb-2">{drawerData.item.title || drawerData.item.statement}</h3>
                          <p className="text-amber-700">{drawerData.item.statement || ''}</p>
                        </div>
                        <div className="grid grid-cols-3 gap-4">
                          {[
                            { label: 'Ø§Ù„ÙƒÙˆØ¯', value: drawerData.item.code },
                            { label: 'Ø§Ù„Ø­Ø§Ù„Ø©', value: drawerData.item.status, isStatus: true },
                            { label: 'Ø§Ù„Ø¥Ø·Ø§Ø±', value: getFrameworkName(drawerData.item.frameworkId) },
                            { label: 'Ø§Ù„Ø£Ù‡Ù…ÙŠØ©', value: drawerData.item.criticality, isSeverity: true },
                            { label: 'Ø§Ù„Ø³Ø±ÙŠØ§Ù†', value: drawerData.item.effectiveFrom },
                            { label: 'Ø§Ù„ØªÙƒØ±Ø§Ø±', value: drawerData.item.frequency || 'Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«' },
                          ].map((item, idx) => (
                            <div key={idx} className="bg-white rounded-xl p-4 border-2 border-slate-100">
                              <p className="text-slate-500 text-sm mb-1">{item.label}</p>
                              {item.isStatus ? <StatusBadge status={item.value} /> :
                                item.isSeverity ? <SeverityBadge severity={item.value} /> :
                                  <p className="font-bold text-slate-800">{item.value}</p>}
                            </div>
                          ))}
                        </div>
                      </>
                    )}
                    {modalStep === 2 && (
                      <div className="bg-emerald-50 border-2 border-emerald-200 rounded-2xl p-6">
                        <h3 className="font-bold text-emerald-800 mb-4">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø©</h3>
                        <div className="space-y-3">
                          {EVIDENCE_RECORDS.slice(0, 4).map(ev => (
                            <div key={ev.id} className="flex items-center justify-between p-4 bg-white rounded-xl border">
                              <div><p className="font-bold">{ev.title}</p><p className="text-sm text-slate-500">{ev.code}</p></div>
                              <StatusBadge status={ev.status} />
                            </div>
                          ))}
                        </div> </div>
                    )}
                    {modalStep === 3 && (
                      <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6">
                        <h3 className="font-bold text-blue-800 mb-4">Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</h3>
                        <div className="space-y-3">
                          {CONTROLS.slice(0, 4).map(ctrl => (
                            <div key={ctrl.id} className="flex items-center justify-between p-4 bg-white rounded-xl border">
                              <div><p className="font-bold">{ctrl.title}</p><p className="text-sm text-slate-500">{ctrl.code}</p></div>
                              <StatusBadge status={ctrl.effectiveness} />
                            </div>
                          ))}
                        </div> </div>
                    )}
                    {modalStep === 4 && (
                      <div className="bg-purple-50 border-2 border-purple-200 rounded-2xl p-6">
                        <h3 className="font-bold text-purple-800 mb-4">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</h3>
                        <div className="space-y-3">
                          {[{ name: 'Ø§Ø®ØªØ¨Ø§Ø± Q4', date: '2024-12-15', result: 'Ù†Ø§Ø¬Ø­' }, { name: 'Ø§Ø®ØªØ¨Ø§Ø± Q3', date: '2024-09-15', result: 'Ù†Ø§Ø¬Ø­' }].map((test, idx) => (
                            <div key={idx} className="flex items-center justify-between p-4 bg-white rounded-xl border">
                              <div><p className="font-bold">{test.name}</p><p className="text-sm text-slate-500">{test.date}</p></div>
                              <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg font-bold">{test.result}</span>
                            </div>
                          ))}
                        </div> </div>
                    )}
                  </div>
                )}

                {drawerData.type === 'evidence' && drawerData.item && (
                  <div className="space-y-5">
                    <div className="bg-gradient-to-r from-teal-500 to-emerald-600 rounded-2xl p-5 text-white">
                      <div className="flex items-center gap-5">
                        <div className="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center flex-shrink-0">
                          {drawerData.item.evidenceType === 'Certificate' ? <Award className="w-8 h-8" /> :
                            drawerData.item.evidenceType === 'Report' ? <BarChart3 className="w-8 h-8" /> :
                              drawerData.item.evidenceType === 'Policy' ? <FileText className="w-8 h-8" /> :
                                <FileCheck className="w-8 h-8" />}
                        </div>
                        <div className="flex-1">
                          <h3 className="font-black text-2xl">{drawerData.item.title}</h3>
                          <p className="text-white/70 font-mono">{drawerData.item.code}</p>
                        </div>
                        <div className="text-left">
                          <StatusBadge status={drawerData.item.status} />
                          <p className="text-white/70 text-sm mt-1">Ù†ÙˆØ¹: {drawerData.item.evidenceType}</p>
                        </div> </div> </div>
                    <div className="flex gap-5">
                      <div className="flex-1 space-y-5">
                        <div className="grid grid-cols-2 gap-3">
                          <div className="bg-white rounded-xl p-4 border-2 border-slate-100 hover:border-teal-200 transition-all">
                            <div className="flex items-center gap-2 mb-2">
                              <Tag className="w-4 h-4 text-teal-600" />
                              <p className="text-slate-500 text-xs">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                            </div>
                            <p className="font-bold text-slate-800">{drawerData.item.evidenceType}</p>
                          </div>
                          <div className="bg-white rounded-xl p-4 border-2 border-slate-100 hover:border-purple-200 transition-all">
                            <div className="flex items-center gap-2 mb-2">
                              <User className="w-4 h-4 text-purple-600" />
                              <p className="text-slate-500 text-xs">Ø§Ù„Ù…Ø§Ù„Ùƒ</p>
                            </div>
                            <p className="font-bold text-slate-800">{drawerData.item.ownerName}</p>
                          </div>
                          <div className="bg-white rounded-xl p-4 border-2 border-slate-100 hover:border-amber-200 transition-all">
                            <div className="flex items-center gap-2 mb-2">
                              <Calendar className="w-4 h-4 text-amber-600" />
                              <p className="text-slate-500 text-xs">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</p>
                            </div>
                            <p className={`font-bold ${drawerData.item.status === 'Expired' ? 'text-red-600' : 'text-emerald-600'}`}>
                              {drawerData.item.status === 'Expired' ? 'Ù…Ù†ØªÙ‡ÙŠ' : 'Ø³Ø§Ø±ÙŠ'}
                            </p> </div>
                          <div className="bg-white rounded-xl p-4 border-2 border-slate-100 hover:border-blue-200 transition-all">
                            <div className="flex items-center gap-2 mb-2">
                              <Building2 className="w-4 h-4 text-blue-600" />
                              <p className="text-slate-500 text-xs">Ø§Ù„Ø¬Ù‡Ø©</p>
                            </div>
                            <p className="font-bold text-slate-800">SAMA</p>
                          </div> </div>
                        <div className="bg-amber-50 border border-amber-200 rounded-xl p-4">
                          <h4 className="font-bold text-amber-800 mb-3 flex items-center gap-2 text-sm">
                            <FileText className="w-4 h-4" />
                            Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                          </h4>
                          <div className="flex flex-wrap gap-2">
                            {(drawerData.item.linkedObligations || ['OBL-001']).map((oblCode, idx) => (
                              <span key={idx} className="px-3 py-1.5 bg-white rounded-lg border border-amber-200 font-mono text-amber-700 font-bold text-sm">
                                {oblCode}
                              </span>
                            ))}
                          </div> </div>
                        <div className="bg-purple-50 border border-purple-200 rounded-xl p-4">
                          <h4 className="font-bold text-purple-800 mb-3 flex items-center gap-2 text-sm">
                            <Globe className="w-4 h-4" />
                            Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
                          </h4>
                          <div className="flex flex-wrap gap-2">
                            <span className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg font-bold text-xs">ğŸ¦ SAMA</span>
                            <span className="px-3 py-1.5 bg-slate-700 text-white rounded-lg font-bold text-xs">ğŸ”’ NCA</span>
                            <span className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg font-bold text-xs">ğŸ“Š CMA</span>
                            <span className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded-lg font-bold text-xs">ğŸ‡ªğŸ‡¬ CBE</span>
                          </div> </div> </div>
                      <div className="w-80 space-y-5 flex-shrink-0">
                        <div className="bg-slate-50 border-2 border-slate-200 rounded-xl p-5">
                          <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-sm">
                            <Eye className="w-4 h-4" />
                            Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù
                          </h4>
                          <div className="bg-white rounded-xl border-2 border-dashed border-slate-300 p-6 text-center">
                            <div className="w-16 h-16 rounded-xl bg-slate-100 flex items-center justify-center mx-auto mb-3">
                              <FileText className="w-8 h-8 text-slate-400" />
                            </div>
                            <p className="font-bold text-slate-700 text-sm mb-1">{drawerData.item.title}.pdf</p>
                            <p className="text-slate-500 text-xs mb-3">PDF â€¢ 2.4 MB</p>
                            <div className="flex gap-2">
                              <button className="flex-1 px-3 py-2 bg-blue-500 text-white rounded-lg font-bold text-xs flex items-center justify-center gap-1 hover:bg-blue-600">
                                <Eye className="w-3.5 h-3.5" />ÙØªØ­
                              </button>
                              <button className="flex-1 px-3 py-2 bg-slate-200 text-slate-700 rounded-lg font-bold text-xs flex items-center justify-center gap-1 hover:bg-slate-300">
                                <Download className="w-3.5 h-3.5" />ØªØ­Ù…ÙŠÙ„
                              </button> </div> </div> </div>
                        <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                          <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2 text-sm">
                            <History className="w-4 h-4" />
                            Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
                          </h4>
                          <div className="space-y-2">
                            <div className="flex items-center gap-3 p-2 bg-white rounded-lg border text-xs">
                              <Upload className="w-4 h-4 text-blue-500" />
                              <div className="flex-1">
                                <p className="font-bold text-slate-700">Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„</p>
                                <p className="text-slate-400">{drawerData.item.ownerName}</p>
                              </div>
                              <span className="text-slate-400">01-10</span>
                            </div>
                            <div className="flex items-center gap-3 p-2 bg-white rounded-lg border text-xs">
                              <Clock className="w-4 h-4 text-amber-500" />
                              <div className="flex-1">
                                <p className="font-bold text-slate-700">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                                <p className="text-slate-400">{drawerData.item.ownerName}</p>
                              </div>
                              <span className="text-slate-400">01-10</span>
                            </div>
                            <div className="flex items-center gap-3 p-2 bg-white rounded-lg border text-xs">
                              <CheckCircle2 className="w-4 h-4 text-emerald-500" />
                              <div className="flex-1">
                                <p className="font-bold text-slate-700">ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                                <p className="text-slate-400">Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ</p>
                              </div>
                              <span className="text-slate-400">01-12</span>
                            </div> </div> </div> </div> </div>
                    <div className="bg-gradient-to-r from-slate-50 to-slate-100 rounded-2xl p-4 border border-slate-200">
                      <div className="flex items-center gap-4">
                        <button className="flex-1 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:shadow-lg hover:scale-[1.02] transition-all">
                          <CheckCircle2 className="w-6 h-6" />
                          <span className="text-lg">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¯Ù„ÙŠÙ„</span>
                        </button>
                        <button className="flex-1 py-4 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:shadow-lg hover:scale-[1.02] transition-all">
                          <XCircle className="w-6 h-6" />
                          <span className="text-lg">Ø±ÙØ¶ Ø§Ù„Ø¯Ù„ÙŠÙ„</span>
                        </button>
                        <button className="flex-1 py-4 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:shadow-lg hover:scale-[1.02] transition-all">
                          <RefreshCw className="w-6 h-6" />
                          <span className="text-lg">Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ«</span>
                        </button>
                        <button className="flex-1 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold flex items-center justify-center gap-3 hover:shadow-lg hover:scale-[1.02] transition-all">
                          <Send className="w-6 h-6" />
                          <span className="text-lg">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù‡Ø©</span>
                        </button> </div> </div> </div>
                )}

                {drawerData.type === 'control' && drawerData.item && (
                  <div className="space-y-6">
                    <div className="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6">
                      <div className="flex items-start gap-5">
                        <div className="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg">
                          <Shield className="w-10 h-10 text-white" />
                        </div>
                        <div className="flex-1">
                          <h3 className="font-black text-blue-900 text-2xl mb-1">{drawerData.item.title || drawerData.item.name}</h3>
                          <p className="text-blue-600 font-mono">{drawerData.item.code}</p>
                          <p className="text-slate-600 mt-2">{drawerData.item.titleEn}</p>
                        </div>
                        <StatusBadge status={drawerData.item.effectiveness} />
                      </div> </div>
                    <div className="grid grid-cols-4 gap-4">
                      <div className="bg-white rounded-xl p-4 border-2 border-slate-100">
                        <p className="text-slate-500 text-sm mb-1">Ø§Ù„Ù†ÙˆØ¹</p>
                        <p className="font-bold text-slate-800">{drawerData.item.type || 'Preventive'}</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border-2 border-slate-100">
                        <p className="text-slate-500 text-sm mb-1">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</p>
                        <StatusBadge status={drawerData.item.effectiveness} />
                      </div>
                      <div className="bg-white rounded-xl p-4 border-2 border-slate-100">
                        <p className="text-slate-500 text-sm mb-1">Ø¢Ø®Ø± Ø§Ø®ØªØ¨Ø§Ø±</p>
                        <p className="font-bold text-slate-800">{drawerData.item.lastTestDate || '2024-01-15'}</p>
                      </div>
                      <div className="bg-white rounded-xl p-4 border-2 border-slate-100">
                        <p className="text-slate-500 text-sm mb-1">Ø§Ù„ØªÙƒØ±Ø§Ø±</p>
                        <p className="font-bold text-slate-800">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</p>
                      </div> </div>
                    <div className="grid grid-cols-3 gap-4">
                      <button className="p-4 bg-blue-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-600">
                        <ClipboardCheck className="w-5 h-5" />Ø§Ø®ØªØ¨Ø§Ø±
                      </button>
                      <button className="p-4 bg-purple-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-purple-600">
                        <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                      </button>
                      <button className="p-4 bg-slate-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-600">
                        <History className="w-5 h-5" />Ø§Ù„Ø³Ø¬Ù„
                      </button> </div> </div>
                )}
              </div> </div>
            {(drawerData.type === 'decision' || drawerData.type === 'breach' || drawerData.type === 'obligation') && !showSuccess && (
              <div className="border-t-2 border-slate-100 px-8 py-5 flex items-center justify-between bg-slate-50 flex-shrink-0">
                <button
                  onClick={() => setModalStep(Math.max(1, modalStep - 1))}
                  disabled={modalStep === 1}
                  className={`flex items-center gap-2 px-8 py-4 rounded-xl font-bold text-lg transition-all ${modalStep === 1
                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed'
                    : 'bg-white text-slate-700 hover:bg-slate-100 border-2 border-slate-200 hover:border-slate-300'
                    }`}
                >
                  <ChevronRight className="w-6 h-6" />
                  Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>

                <div className="flex items-center gap-3">
                  {Array.from({ length: drawerData.type === 'decision' ? 5 : 4 }).map((_, i) => (
                    <button
                      key={i}
                      onClick={() => setModalStep(i + 1)}
                      className={`w-4 h-4 rounded-full transition-all duration-300 ${i + 1 === modalStep
                        ? 'bg-purple-600 scale-125 shadow-lg'
                        : i + 1 < modalStep
                          ? 'bg-emerald-500'
                          : 'bg-slate-300 hover:bg-slate-400'
                        }`}
                    />
                  ))}
                </div>

                <button
                  onClick={() => setModalStep(Math.min(drawerData.type === 'decision' ? 5 : 4, modalStep + 1))}
                  disabled={modalStep === (drawerData.type === 'decision' ? 5 : 4)}
                  className={`flex items-center gap-2 px-8 py-4 rounded-xl font-bold text-lg transition-all ${modalStep === (drawerData.type === 'decision' ? 5 : 4)
                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed'
                    : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-lg hover:scale-105'
                    }`}
                >
                  Ø§Ù„ØªØ§Ù„ÙŠ
                  <ChevronLeft className="w-6 h-6" />
                </button> </div>
            )}
          </div> </div>
      )}

      {showDeleteConfirm && userToDelete && (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]" onClick={cancelDeleteUser}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden transform animate-in zoom-in-95 duration-200" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-6 py-5">
              <div className="flex items-center gap-4">
                <div className="w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center">
                  <Trash2 className="w-7 h-7 text-white" />
                </div>
                <div>
                  <h3 className="text-xl font-black text-white">ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                  <p className="text-red-100 text-sm">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
                </div> </div> </div>
            <div className="p-6">
              <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-4 mb-4">
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white font-bold text-lg">
                    {userToDelete.name?.charAt(0) || '?'}
                  </div>
                  <div>
                    <p className="font-bold text-slate-800 text-lg">{userToDelete.name}</p>
                    <p className="text-slate-500 text-sm">{userToDelete.email}</p>
                  </div> </div>
                <div className="flex items-center gap-2 text-sm">
                  <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded">{userToDelete.jobTitle || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                  <span className={`px-2 py-1 rounded ${userToDelete.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>
                    {userToDelete.status === 'Active' ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                  </span> </div> </div>
              <div className="flex items-start gap-3 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                <AlertTriangle className="w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="font-bold text-amber-800">ØªØ­Ø°ÙŠØ±!</p>
                  <p className="text-amber-700 text-sm mt-1">
                    Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡ ÙˆØªØ¹ÙŠÙŠÙ†Ø§ØªÙ‡. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ
                  </p> </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-end gap-3">
              <button
                onClick={cancelDeleteUser}
                className="px-6 py-2.5 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100 transition-all"
              >
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button
                onClick={confirmDeleteUser}
                className="px-6 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold hover:shadow-lg hover:scale-105 transition-all flex items-center gap-2"
              >
                <Trash2 className="w-5 h-5" />
                Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
              </button> </div> </div> </div>
      )}
    </div>);
};

// Module 4.14: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
// Incident Management - Security Incident Response System
// NCA/SAMA Compliant - 72 Hour Reporting Rule

const IncidentManagement = () => {
  // State Management
  const [activeTab, setActiveTab] = useState('dashboard');
  const [viewMode, setViewMode] = useState('cards');
  const [searchQuery, setSearchQuery] = useState('');
  const [filterSeverity, setFilterSeverity] = useState('');
  const [filterStatus, setFilterStatus] = useState('');
  const [filterType, setFilterType] = useState('');

  const [showAddModal, setShowAddModal] = useState(false);
  const [showViewModal, setShowViewModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [showReportModal, setShowReportModal] = useState(false);
  const [selectedIncident, setSelectedIncident] = useState(null);
  const [wizardStep, setWizardStep] = useState(1);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [viewTab, setViewTab] = useState('details');

  // Template Management States
  const [showTemplateModal, setShowTemplateModal] = useState(false);
  const [showEditTemplateModal, setShowEditTemplateModal] = useState(false);
  const [showDeleteTemplateModal, setShowDeleteTemplateModal] = useState(false);
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [templateFormData, setTemplateFormData] = useState({
    name: '', type: '', defaultSeverity: 'Medium', defaultAuthority: 'NCA',
    containmentChecklist: [], eradicationChecklist: [], recoveryChecklist: [],
    requiredEvidence: []
  });
  const [newChecklistItem, setNewChecklistItem] = useState({ containment: '', eradication: '', recovery: '', evidence: '' });

  // Regulatory Reporting States
  const [showNCAReportModal, setShowNCAReportModal] = useState(false);
  const [showSAMAReportModal, setShowSAMAReportModal] = useState(false);
  const [ncaReportForm, setNcaReportForm] = useState({
    reportType: 'initial', financialImpact: '', operationalImpact: '',
    containmentMeasures: '', additionalInfo: ''
  });
  const [samaReportForm, setSamaReportForm] = useState({
    // Step 1: Basic Info
    reportType: 'initial', incidentCategory: '', incidentSubCategory: '', discoveryMethod: '', attackVector: '',
    // Step 2: Customer Impact
    affectedCustomersIndividual: 0, affectedCustomersCorporate: 0, affectedCustomersVIP: 0, customerDataExposed: [],
    servicesAffected: [], channelsAffected: [],
    // Step 3: Financial & Operational
    directFinancialLoss: 0, potentialFinancialLoss: 0, fraudAmount: 0, operationalDowntime: 0, transactionsAffected: 0,
    reputationalImpact: 'Low',
    // Step 4: Response & Recovery
    containmentActions: [], eradicationActions: [], recoveryPlan: '', estimatedRecoveryTime: '', lessonsLearned: '',
    preventiveMeasures: '',
    // Step 5: Contacts & Attachments
    primaryContact: '', primaryContactPhone: '', primaryContactEmail: '', escalationContact: '', ceoNotified: false,
    boardNotified: false,
    attachments: []
  });
  const [samaReportStep, setSamaReportStep] = useState(1);

  // Lessons Learned States
  const [showLessonModal, setShowLessonModal] = useState(false);
  const [showEditLessonModal, setShowEditLessonModal] = useState(false);
  const [showDeleteLessonModal, setShowDeleteLessonModal] = useState(false);
  const [selectedLesson, setSelectedLesson] = useState(null);
  const [lessonFormData, setLessonFormData] = useState({
    incidentId: '', lesson: '', recommendation: '', category: 'process',
    assignedTo: '', dueDate: '', priority: 'Medium'
  });

  // Action Checklist States
  const [currentActionPhase, setCurrentActionPhase] = useState('containment');

  const [showLinkModal, setShowLinkModal] = useState(false);
  const [linkType, setLinkType] = useState('asset');
  const [linkSearchQuery, setLinkSearchQuery] = useState('');

  const [notification, setNotification] = useState(null);
  const showNotificationMsg = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const [incidentTemplates, setIncidentTemplates] = useState([
    {
      id: 1, type: 'malware', name: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø§Ù„Ø®Ø¨ÙŠØ«Ø©', defaultSeverity: 'High', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'Ø¹Ø²Ù„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø¹Ù† Ø§Ù„Ø´Ø¨ÙƒØ©', required: true },
        { id: 2, text: 'Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true },
        { id: 3, text: 'ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙŠ SOC', required: true },
        { id: 4, text: 'Ø¥Ø¨Ù„Ø§Øº ÙØ±ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', required: true },
      ],
      eradicationChecklist: [
        { id: 1, text: 'ÙØ­Øµ Ø´Ø§Ù…Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©', required: true },
        { id: 2, text: 'Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø¨ÙŠØ«Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ©', required: true },
        { id: 3, text: 'ØªÙ†Ø¸ÙŠÙ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', required: false },
        { id: 4, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙØ­Øµ Ø«Ø§Ù†Ù', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù†Ø¸ÙŠÙØ©', required: true },
        { id: 2, text: 'ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø©', required: true },
        { id: 3, text: 'ØªØºÙŠÙŠØ± Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true },
        { id: 4, text: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…ÙƒØ«ÙØ© Ù„Ù…Ø¯Ø© 48 Ø³Ø§Ø¹Ø©', required: true },
      ],
      requiredEvidence: ['Ù„Ù‚Ø·Ø§Øª Ø´Ø§Ø´Ø© Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'ØªÙ‚Ø±ÙŠØ± Ù…ÙƒØ§ÙØ­ Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª', 'ØµÙˆØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©'],
      usageCount: 5, lastUsed: '2025-02-01', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },
    {
      id: 2, type: 'phishing', name: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„ØªØµÙŠØ¯ Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„ÙŠ', defaultSeverity: 'Medium', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚/Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡ ÙÙŠ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', required: true },
        { id: 2, text: 'Ø¥ÙŠÙ‚Ø§Ù ØªÙˆØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±', required: true },
        { id: 3, text: 'Ø¥Ø¨Ù„Ø§Øº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†', required: true },
        { id: 4, text: 'ØªÙØ¹ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', required: false },
      ],
      eradicationChecklist: [
        { id: 1, text: 'Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯', required: true },
        { id: 2, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†', required: true },
        { id: 3, text: 'ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', required: true },
        { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª', required: true },
        { id: 2, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†', required: true },
        { id: 3, text: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¯Ø±ÙŠØ¨ ØªÙˆØ¹ÙˆÙŠ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†', required: false },
        { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø£Ù…Ø§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', required: false },
      ],
      requiredEvidence: ['Ù†Ø³Ø®Ø© Ù…Ù† Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØµÙŠØ¯', 'Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†'],
      usageCount: 8, lastUsed: '2025-02-03', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },
    {
      id: 3, type: 'data_breach', name: 'Ù‚Ø§Ù„Ø¨ ØªØ³Ø±ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', defaultSeverity: 'Critical', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© ÙÙˆØ±Ø§Ù‹', required: true },
        { id: 2, text: 'Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©', required: true },
        { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ù…Ù†Ø¹ ØªØ³Ø±Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (DLP)', required: true },
        { id: 4, text: 'Ø­Ø¸Ø± Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª', required: true },
        { id: 5, text: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙÙˆØ±Ø§Ù‹', required: true },
      ],
      eradicationChecklist: [
        { id: 1, text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø©', required: true },
        { id: 2, text: 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù/Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø±Ø¨Ø©', required: true },
        { id: 3, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠØ¯ Ø¬Ù…ÙŠØ¹ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„', required: true },
        { id: 4, text: 'ØªØ¹Ø²ÙŠØ² Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡/Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†', required: true },
        { id: 2, text: 'ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†', required: false },
        { id: 3, text: 'Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø´Ø§Ù…Ù„Ø©', required: true },
        { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', required: true },
        { id: 5, text: 'ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', required: false },
      ],
      requiredEvidence: ['ØªÙ‚Ø±ÙŠØ± DLP', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„', 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø©', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ'],
      usageCount: 2, lastUsed: '2025-01-15', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },
    {
      id: 4, type: 'ransomware', name: 'Ù‚Ø§Ù„Ø¨ Ù‡Ø¬ÙˆÙ… Ø§Ù„ÙØ¯ÙŠØ©', defaultSeverity: 'Critical', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'Ø¹Ø²Ù„ ÙÙˆØ±ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©', required: true },
        { id: 2, text: 'Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', required: true },
        { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©', required: true },
        { id: 4, text: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ', required: true },
        { id: 5, text: 'Ø¹Ø¯Ù… Ø¯ÙØ¹ Ø§Ù„ÙØ¯ÙŠØ© - Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙÙ‚Ø·', required: true },
      ],
      eradicationChecklist: [
        { id: 1, text: 'ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ ÙˆØ³Ù„Ø§Ù„Ø© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙØ¯ÙŠØ©', required: true },
        { id: 2, text: 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙØ§ØªÙŠØ­ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø©', required: true },
        { id: 3, text: 'Ù…Ø³Ø­ ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©', required: true },
        { id: 4, text: 'ÙØ­Øµ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø³Ù„Ø§Ù…ØªÙ‡Ø§', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ù…Ù† Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù†Ø¸ÙŠÙØ©', required: true },
        { id: 2, text: 'Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªÙŠ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§', required: true },
        { id: 3, text: 'ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©', required: true },
        { id: 4, text: 'ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© ÙˆÙ…ÙƒØ«ÙØ©', required: true },
      ],
      requiredEvidence: ['Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ÙØ¯ÙŠØ©', 'Ø¹ÙŠÙ†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´ÙØ±Ø©', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ'],
      usageCount: 1, lastUsed: '2025-01-20', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },
    {
      id: 5, type: 'unauthorized_access', name: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­',
      defaultSeverity: 'High', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ±Ù‚ ÙÙˆØ±Ø§Ù‹', required: true },
        { id: 2, text: 'Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„Ø­Ø³Ø§Ø¨', required: true },
        { id: 3, text: 'Ø­Ø¸Ø± Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', required: true },
        { id: 4, text: 'ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true },
        { id: 5, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (MFA)', required: true },
      ],
      eradicationChecklist: [
        { id: 1, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ', required: true },
        { id: 2, text: 'ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true },
        { id: 3, text: 'Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£Ø¨ÙˆØ§Ø¨ Ø®Ù„ÙÙŠØ© Ø£Ùˆ Ø¨Ø±Ø§Ù…Ø¬ Ù…Ø´Ø¨ÙˆÙ‡Ø©', required: true },
        { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true },
        { id: 2, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠØ¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„', required: true },
        { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ© Ù„Ù…Ø¯Ø© 72 Ø³Ø§Ø¹Ø©', required: true },
        { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„ØªØ­ÙƒÙ…', required: true },
      ],
      requiredEvidence: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©', 'Ù„Ù‚Ø·Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚ÙŠÙ‚'],
      usageCount: 3, lastUsed: '2025-02-04', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },
    {
      id: 6, type: 'system_failure', name: 'Ù‚Ø§Ù„Ø¨ ÙØ´Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…', defaultSeverity: 'Medium', defaultAuthority: 'NCA',
      containmentChecklist: [
        { id: 1, text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø± ÙˆÙ†Ø·Ø§Ù‚ Ø§Ù„ØªØ£Ø«ÙŠØ±', required: true },
        { id: 2, text: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†', required: true },
        { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø¯ÙŠÙ„/Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', required: false },
        { id: 4, text: 'ØªÙˆØ«ÙŠÙ‚ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª', required: true },
      ],
      eradicationChecklist: [
        { id: 1, text: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ù„ÙØ´Ù„', required: true },
        { id: 2, text: 'Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø·Ù„ Ø£Ùˆ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„ØªØ§Ù„Ù', required: true },
        { id: 3, text: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙÙŠ Ø¨ÙŠØ¦Ø© Ù…Ø¹Ø²ÙˆÙ„Ø©', required: true },
        { id: 4, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', required: true },
      ],
      recoveryChecklist: [
        { id: 1, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†', required: true },
        { id: 2, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù', required: true },
        { id: 3, text: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©', required: true },
        { id: 4, text: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­', required: true },
      ],
      requiredEvidence: ['Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­', 'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡'],
      usageCount: 2, lastUsed: '2025-02-04', createdBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…'
    },]);
  // PRE-INITIALIZED: Action Checklists for Active Incidents
  const [incidentActions, setIncidentActions] = useState({
    // INC-2025-001: Unauthorized Access - 50% containment complete
    'INC-2025-001_containment': [
      { id: 1, text: 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ±Ù‚ ÙÙˆØ±Ø§Ù‹', required: true, completed: true, completedDate: '2025-02-04T09:30:00', completedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯' },
      { id: 2, text: 'Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„Ø­Ø³Ø§Ø¨', required: true, completed: true, completedDate: '2025-02-04T09:35:00', completedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯' },
      { id: 3, text: 'Ø­Ø¸Ø± Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', required: true, completed: true, completedDate: '2025-02-04T10:00:00', completedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ' },
      { id: 4, text: 'ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 5, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (MFA)', required: true, completed: false, completedDate: null, completedBy: null },
    ],
    'INC-2025-001_eradication': [
      { id: 1, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 2, text: 'ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 3, text: 'Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£Ø¨ÙˆØ§Ø¨ Ø®Ù„ÙÙŠØ© Ø£Ùˆ Ø¨Ø±Ø§Ù…Ø¬ Ù…Ø´Ø¨ÙˆÙ‡Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', required: true, completed: false, completedDate: null, completedBy: null },
    ],
    'INC-2025-001_recovery': [
      { id: 1, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 2, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠØ¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ© Ù„Ù…Ø¯Ø© 72 Ø³Ø§Ø¹Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„ØªØ­ÙƒÙ…', required: true, completed: false, completedDate: null, completedBy: null },
    ],
    // INC-2025-002: Phishing - 75% containment complete
    'INC-2025-002_containment': [
      { id: 1, text: 'Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚/Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡ ÙÙŠ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', required: true, completed: true, completedDate: '2025-02-03T15:00:00', completedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ' },
      { id: 2, text: 'Ø¥ÙŠÙ‚Ø§Ù ØªÙˆØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±', required: true, completed: true, completedDate: '2025-02-03T15:15:00', completedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ' },
      { id: 3, text: 'Ø¥Ø¨Ù„Ø§Øº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†', required: true, completed: true, completedDate: '2025-02-03T16:00:00', completedBy: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯' },
      { id: 4, text: 'ØªÙØ¹ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', required: false, completed: false, completedDate: null, completedBy: null },
    ],
    'INC-2025-002_eradication': [
      { id: 1, text: 'Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯', required: true, completed: true, completedDate: '2025-02-03T17:00:00', completedBy: 'IT Team' },
      { id: 2, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†', required: true, completed: true, completedDate: '2025-02-03T18:00:00', completedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ' },
      { id: 3, text: 'ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯', required: true, completed: false, completedDate: null, completedBy: null },
    ],
    'INC-2025-002_recovery': [
      { id: 1, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 2, text: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 3, text: 'Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¯Ø±ÙŠØ¨ ØªÙˆØ¹ÙˆÙŠ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†', required: false, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø£Ù…Ø§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', required: false, completed: false, completedDate: null, completedBy: null },
    ],
    // INC-2025-005: System Failure - 100% containment, 50% eradication
    'INC-2025-005_containment': [
      { id: 1, text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø± ÙˆÙ†Ø·Ø§Ù‚ Ø§Ù„ØªØ£Ø«ÙŠØ±', required: true, completed: true, completedDate: '2025-02-04T06:30:00', completedBy: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ' },
      { id: 2, text: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†', required: true, completed: true, completedDate: '2025-02-04T06:45:00', completedBy: 'IT Team' },
      { id: 3, text: 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø¯ÙŠÙ„/Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', required: false, completed: true, completedDate: '2025-02-04T07:00:00', completedBy: 'IT Team' },
      { id: 4, text: 'ØªÙˆØ«ÙŠÙ‚ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª', required: true, completed: true, completedDate: '2025-02-04T07:15:00', completedBy: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ' },
    ],
    'INC-2025-005_eradication': [
      { id: 1, text: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ù„ÙØ´Ù„', required: true, completed: true, completedDate: '2025-02-04T08:00:00', completedBy: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ' },
      { id: 2, text: 'Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø·Ù„ Ø£Ùˆ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„ØªØ§Ù„Ù', required: true, completed: true, completedDate: '2025-02-04T09:00:00', completedBy: 'IT Team' },
      { id: 3, text: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙÙŠ Ø¨ÙŠØ¦Ø© Ù…Ø¹Ø²ÙˆÙ„Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', required: true, completed: false, completedDate: null, completedBy: null },
    ],
    'INC-2025-005_recovery': [
      { id: 1, text: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 2, text: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 3, text: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©', required: true, completed: false, completedDate: null, completedBy: null },
      { id: 4, text: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­', required: true, completed: false, completedDate: null, completedBy: null },
    ],
  });

  const [regulatoryReports, setRegulatoryReports] = useState([
    // NCA Reports (3)
    {
      id: 1, incidentId: 'INC-2025-001', authority: 'NCA', reportType: 'initial',
      submittedDate: '2025-02-04T12:00:00', status: 'Submitted',
      referenceNumber: 'NCA-2025-0256', responseDate: null, response: null,
      submittedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯',
      // Step 1: Classification
      incidentCategory: 'unauthorized_access', incidentSubCategory: 'brute_force', discoveryMethod: 'siem',
      attackVector: 'network',
      // Step 2: Customer/User Impact
      affectedCustomersIndividual: 100, affectedCustomersCorporate: 40, affectedCustomersVIP: 10,
      customerDataExposed: ['credentials', 'financial', 'accounts'],
      servicesAffected: ['online_banking', 'mobile_banking', 'wire_transfer'],
      channelsAffected: ['web', 'mobile_app'],
      affectedSystems: ['Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'Ø®Ø§Ø¯Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©'],
      affectedUsers: 150,
      // Step 3: Financial Impact
      directFinancialLoss: 0, potentialFinancialLoss: 500000, fraudAmount: 0, transactionsAffected: 45,
      operationalDowntime: 4, reputationalImpact: 'Medium',
      // Step 4: Response & Recovery
      containmentMeasures: 'ØªÙ… Ø­Ø¸Ø± Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡ ÙˆØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ±Ù‚ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ©',
      containmentActions: ['Ø­Ø¸Ø± IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ±Ù‚', 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ©', 'Ø¥Ø¨Ù„Ø§Øº ÙØ±ÙŠÙ‚ SOC'],
      eradicationActions: ['Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„', 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', 'ÙØ­Øµ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©'],
      recoveryPlan: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ØªØ£Ø«Ø±Ø© ÙˆØªÙØ¹ÙŠÙ„ MFA Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª',
      estimatedRecoveryTime: '24-48 Ø³Ø§Ø¹Ø©',
      lessonsLearned: 'Ø¶Ø±ÙˆØ±Ø© ØªÙØ¹ÙŠÙ„ MFA Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©',
      preventiveMeasures: 'ØªØ¹Ø²ÙŠØ² Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹ÙˆØ§Ù…Ù„',
      // Step 5: Contact & Notifications
      primaryContact: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', primaryContactPhone: '0512345678', primaryContactEmail: 'ahmed@company.sa',
      escalationContact: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ù„Ù„ØªÙ‚Ù†ÙŠØ©', ceoNotified: true, boardNotified: false,
      attachments: ['incident_log.pdf', 'network_analysis.xlsx']
    },
    {
      id: 2, incidentId: 'INC-2025-002', authority: 'NCA', reportType: 'initial',
      submittedDate: '2025-02-03T16:00:00', status: 'Acknowledged',
      referenceNumber: 'NCA-2025-0234', responseDate: '2025-02-04T10:00:00',
      response: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ù„Ø§Øº. ÙŠØ±Ø¬Ù‰ ØªÙ‚Ø¯ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù….',
      submittedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ',
      // Step 1
      incidentCategory: 'phishing', incidentSubCategory: 'spear_phishing', discoveryMethod: 'user_report',
      attackVector: 'email',
      // Step 2
      affectedCustomersIndividual: 30, affectedCustomersCorporate: 10, affectedCustomersVIP: 5,
      customerDataExposed: ['credentials', 'contact'], servicesAffected: ['online_banking'], channelsAffected: ['email'],
      affectedSystems: ['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Active Directory'], affectedUsers: 45,
      // Step 3
      directFinancialLoss: 0, potentialFinancialLoss: 100000, fraudAmount: 0, transactionsAffected: 0,
      operationalDowntime: 2, reputationalImpact: 'Low',
      // Step 4
      containmentMeasures: 'Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡ ÙˆØ­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯',
      containmentActions: ['Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', 'Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯', 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'ØªÙØ¹ÙŠÙ„ ÙÙ„Ø§ØªØ± Ø¥Ø¶Ø§ÙÙŠØ©'],
      eradicationActions: ['Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¶Ø±Ø±Ø©'],
      recoveryPlan: 'ØªØ¯Ø±ÙŠØ¨ ØªÙˆØ¹ÙˆÙŠ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØªØ­Ø¯ÙŠØ« ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø±ÙŠØ¯', estimatedRecoveryTime: '8 Ø³Ø§Ø¹Ø§Øª',
      lessonsLearned: 'Ø£Ù‡Ù…ÙŠØ© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯',
      preventiveMeasures: 'Ø­Ù…Ù„Ø§Øª ØªÙˆØ¹ÙŠØ© Ø´Ù‡Ø±ÙŠØ© ÙˆØ§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØµÙŠØ¯ ÙˆÙ‡Ù…ÙŠØ©',
      // Step 5
      primaryContact: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', primaryContactPhone: '0523456789', primaryContactEmail: 'khaled@company.sa',
      escalationContact: 'Ù…Ø¯ÙŠØ± Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', ceoNotified: false, boardNotified: false,
      attachments: ['phishing_email_sample.eml', 'affected_users.xlsx']
    },
    {
      id: 3, incidentId: 'INC-2025-003', authority: 'NCA', reportType: 'final',
      submittedDate: '2025-02-01T14:00:00', status: 'Closed',
      referenceNumber: 'NCA-2025-0198', responseDate: '2025-02-03T11:00:00',
      response: 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ù„Ø§Øº. Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù„ØªØ²Ø§Ù…ÙƒÙ… Ø¨Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.',
      submittedBy: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
      // Step 1
      incidentCategory: 'data_breach', incidentSubCategory: 'insider_data_theft', discoveryMethod: 'audit',
      attackVector: 'insider',
      // Step 2
      affectedCustomersIndividual: 250, affectedCustomersCorporate: 60, affectedCustomersVIP: 10,
      customerDataExposed: ['pii', 'contact', 'financial', 'accounts'],
      servicesAffected: ['online_banking', 'call_center'], channelsAffected: ['database', 'file_server'],
      affectedSystems: ['Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'],
      affectedUsers: 320,
      // Step 3
      directFinancialLoss: 50000, potentialFinancialLoss: 200000, fraudAmount: 0, transactionsAffected: 0,
      operationalDowntime: 8, reputationalImpact: 'High',
      // Step 4
      containmentMeasures: 'ØªØ¹Ø·ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ØºØ§Ø¯Ø± ÙˆØ¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡',
      containmentActions: ['ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙˆØ±Ø§Ù‹', 'Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', 'Ø­Ø¸Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´Ø¨ÙƒØ©', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª DLP'],
      eradicationActions: ['Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„', 'ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬', 'ÙØ­Øµ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©'],
      recoveryPlan: 'Ø£ØªÙ…ØªØ© Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†',
      estimatedRecoveryTime: '72 Ø³Ø§Ø¹Ø©',
      lessonsLearned: 'Ø¶Ø±ÙˆØ±Ø© Ø£ØªÙ…ØªØ© Ø¥Ù†Ù‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ØºØ§Ø¯Ø±ÙŠÙ† ÙÙˆØ±Ø§Ù‹',
      preventiveMeasures: 'Ø±Ø¨Ø· Ù†Ø¸Ø§Ù… HR Ø¨Ù†Ø¸Ø§Ù… IAM Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹',
      // Step 5
      primaryContact: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', primaryContactPhone: '0534567890', primaryContactEmail: 'sara@company.sa',
      escalationContact: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ', ceoNotified: true, boardNotified: true,
      attachments: ['forensic_report.pdf', 'data_inventory.xlsx', 'customer_notification.docx']
    },
    // SAMA Reports (3)
    {
      id: 4, incidentId: 'INC-2025-001', authority: 'SAMA', reportType: 'initial',
      submittedDate: '2025-02-04T14:00:00', status: 'Submitted',
      referenceNumber: 'SAMA-2025-0089', responseDate: null, response: null,
      submittedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ',
      // Step 1
      incidentCategory: 'unauthorized_access', incidentSubCategory: 'credential_stuffing', discoveryMethod: 'siem',
      attackVector: 'network',
      // Step 2
      affectedCustomersIndividual: 120, affectedCustomersCorporate: 25, affectedCustomersVIP: 5,
      customerDataExposed: ['accounts', 'transactions', 'credentials'],
      servicesAffected: ['online_banking', 'mobile_banking', 'wire_transfer'],
      channelsAffected: ['web', 'mobile_app', 'api'],
      affectedSystems: ['Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', 'Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'API Gateway'],
      affectedUsers: 150,
      // Step 3
      directFinancialLoss: 0, potentialFinancialLoss: 750000, fraudAmount: 0, transactionsAffected: 45,
      operationalDowntime: 4, reputationalImpact: 'Medium',
      // Step 4
      containmentMeasures: 'Ø¹Ø²Ù„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ© ÙˆØ¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©',
      containmentActions: ['Ø¹Ø²Ù„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ©', 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©', 'ØªÙØ¹ÙŠÙ„ WAF rules'],
      eradicationActions: ['Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„', 'ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©', 'Patch Ø§Ù„Ø«ØºØ±Ø§Øª'],
      recoveryPlan: 'Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ Ù…Ø¹ Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù…Ø¯Ø© 72 Ø³Ø§Ø¹Ø©',
      estimatedRecoveryTime: '24-48 Ø³Ø§Ø¹Ø©', lessonsLearned: 'Ø£Ù‡Ù…ÙŠØ© ØªÙØ¹ÙŠÙ„ Rate Limiting ÙˆBot Detection',
      preventiveMeasures: 'ØªØ¹Ø²ÙŠØ² Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØªÙØ¹ÙŠÙ„ MFA Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª',
      // Step 5
      primaryContact: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', primaryContactPhone: '0545678901', primaryContactEmail: 'mohammed@company.sa',
      escalationContact: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ù„Ù„ØªÙ‚Ù†ÙŠØ©', ceoNotified: true, boardNotified: false,
      attachments: ['sama_form_A.pdf', 'incident_timeline.xlsx']
    },
    {
      id: 5, incidentId: 'INC-2025-003', authority: 'SAMA', reportType: 'update',
      submittedDate: '2025-02-02T09:00:00', status: 'Acknowledged',
      referenceNumber: 'SAMA-2025-0076', responseDate: '2025-02-02T15:00:00',
      response: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«. ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚.',
      submittedBy: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ',
      // Step 1
      incidentCategory: 'data_breach', incidentSubCategory: 'insider_data_exfiltration', discoveryMethod: 'audit',
      attackVector: 'insider',
      // Step 2
      affectedCustomersIndividual: 280, affectedCustomersCorporate: 35, affectedCustomersVIP: 5,
      customerDataExposed: ['pii', 'accounts', 'contact', 'transactions'],
      servicesAffected: ['online_banking', 'call_center', 'branches'],
      channelsAffected: ['database', 'file_share', 'email'], affectedSystems: ['CRM', 'Core Banking', 'Data Warehouse'],
      affectedUsers: 320,
      // Step 3
      directFinancialLoss: 50000, potentialFinancialLoss: 300000, fraudAmount: 0, transactionsAffected: 0,
      operationalDowntime: 6, reputationalImpact: 'High',
      // Step 4
      containmentMeasures: 'Ø¥ÙŠÙ‚Ø§Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø©',
      containmentActions: ['Ø¥ÙŠÙ‚Ø§Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„', 'ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±Ø¨Ø©', 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©'],
      eradicationActions: ['ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ù…Ø±Ø§Ø¬Ø¹Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', 'ØªÙØ¹ÙŠÙ„ DLP'],
      recoveryPlan: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ† ÙˆØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù‡ÙˆÙŠØ©',
      estimatedRecoveryTime: '72 Ø³Ø§Ø¹Ø©',
      lessonsLearned: 'Ø¶Ø±ÙˆØ±Ø© ÙˆØ¬ÙˆØ¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØµØ§Ø±Ù…Ø© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
      preventiveMeasures: 'ØªØ­Ø³ÙŠÙ† Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØªØ´Ø¯ÙŠØ¯ Ø¶ÙˆØ§Ø¨Ø· DLP',
      // Step 5
      primaryContact: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ', primaryContactPhone: '0556789012', primaryContactEmail: 'fatima@company.sa',
      escalationContact: 'Ù…Ø¯ÙŠØ± Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', ceoNotified: true, boardNotified: true,
      attachments: ['sama_update_form.pdf', 'customer_impact_analysis.xlsx', 'recovery_plan.docx']
    },
    {
      id: 6, incidentId: 'INC-2025-004', authority: 'SAMA', reportType: 'final',
      submittedDate: '2025-01-30T11:00:00', status: 'Closed',
      referenceNumber: 'SAMA-2025-0058', responseDate: '2025-02-01T14:00:00',
      response: 'ØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©. Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø© Ù…Ù†Ø§Ø³Ø¨Ø©.',
      submittedBy: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ',
      // Step 1
      incidentCategory: 'malware', incidentSubCategory: 'trojan', discoveryMethod: 'antivirus', attackVector: 'email',
      // Step 2
      affectedCustomersIndividual: 0, affectedCustomersCorporate: 0, affectedCustomersVIP: 0, customerDataExposed: [],
      servicesAffected: [], channelsAffected: ['endpoint'], affectedSystems: ['Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†'], affectedUsers: 5,
      // Step 3
      directFinancialLoss: 5000, potentialFinancialLoss: 50000, fraudAmount: 0, transactionsAffected: 0,
      operationalDowntime: 2, reputationalImpact: 'Low',
      // Step 4
      containmentMeasures: 'Ø¹Ø²Ù„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø© ÙˆÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø¨ÙƒØ©',
      containmentActions: ['Ø¹Ø²Ù„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©', 'ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø¨ÙƒØ©', 'ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Traffic'],
      eradicationActions: ['Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ø®Ø¨ÙŠØ«Ø©', 'ÙØ­Øµ ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…', 'ØªØ­Ø¯ÙŠØ« Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø­Ù…Ø§ÙŠØ©'],
      recoveryPlan: 'Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø­Ù…Ø§ÙŠØ©',
      estimatedRecoveryTime: '8 Ø³Ø§Ø¹Ø§Øª',
      lessonsLearned: 'Ø£Ù‡Ù…ÙŠØ© ØªÙ‚ÙŠÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚Ø©',
      preventiveMeasures: 'ØªØ·Ø¨ÙŠÙ‚ Application Whitelisting ÙˆØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
      // Step 5
      primaryContact: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ', primaryContactPhone: '0567890123', primaryContactEmail: 'abdullah@company.sa',
      escalationContact: 'Ù…Ø¯ÙŠØ± ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', ceoNotified: false, boardNotified: false,
      attachments: ['sama_final_report.pdf', 'malware_analysis.pdf']
    },]);
  // Regulatory Report Modal States
  const [showViewReportModal, setShowViewReportModal] = useState(false);
  const [showEditReportModal, setShowEditReportModal] = useState(false);
  const [showDeleteReportModal, setShowDeleteReportModal] = useState(false);
  const [selectedReport, setSelectedReport] = useState(null);
  const [reportFormData, setReportFormData] = useState({});

  const handleViewReport = (report) => {
    setSelectedReport(report);
    setShowViewReportModal(true);
  };

  const handleEditReportOpen = (report) => {
    setSelectedReport(report);
    setReportFormData({ ...report });
    setShowEditReportModal(true);
  };

  const handleEditReport = () => {
    setRegulatoryReports(regulatoryReports.map(r =>
      r.id === selectedReport.id ? { ...r, ...reportFormData, lastModified: new Date().toISOString() } : r
    ));
    showNotificationMsg('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
    setShowEditReportModal(false);
    setSelectedReport(null);
  };

  const handleDeleteReportConfirm = (report) => {
    setSelectedReport(report);
    setShowDeleteReportModal(true);
  };

  const handleDeleteReport = () => {
    setRegulatoryReports(regulatoryReports.filter(r => r.id !== selectedReport.id));
    showNotificationMsg('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
    setShowDeleteReportModal(false);
    setSelectedReport(null);
  };

  const getReportStatusColor = (status) => {
    switch (status) {
      case 'Submitted': return 'bg-blue-100 text-blue-700 border-blue-200';
      case 'Acknowledged': return 'bg-emerald-100 text-emerald-700 border-emerald-200';
      case 'Closed': return 'bg-slate-100 text-slate-700 border-slate-200';
      case 'Rejected': return 'bg-red-100 text-red-700 border-red-200';
      default: return 'bg-slate-100 text-slate-700 border-slate-200';
    }
  };

  const getReportStatusLabel = (status) => {
    switch (status) {
      case 'Submitted': return 'Ù…ÙØ±Ø³Ù„';
      case 'Acknowledged': return 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
      case 'Closed': return 'Ù…ÙØºÙ„Ù‚';
      case 'Rejected': return 'Ù…Ø±ÙÙˆØ¶';
      default: return status;
    }
  };

  const [lessonsLearned, setLessonsLearned] = useState([
    {
      id: 1, incidentId: 'INC-2025-004',
      lesson: 'Ø¶Ø±ÙˆØ±Ø© ØªÙ‚ÙŠÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù† Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚Ø© Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
      recommendation: 'ØªØ·Ø¨ÙŠÙ‚ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª (Application Whitelisting)',
      category: 'technical', priority: 'High', status: 'Implemented',
      implementedDate: '2025-02-01', assignedTo: 'ÙØ±ÙŠÙ‚ Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
      dueDate: '2025-02-15', progress: 100, createdBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', createdDate: '2025-01-28'
    },
    {
      id: 2, incidentId: 'INC-2025-003',
      lesson: 'Ø£Ù‡Ù…ÙŠØ© ØªØ¹Ø·ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ØºØ§Ø¯Ø±ÙŠÙ† ÙÙˆØ± Ø¥Ù†Ù‡Ø§Ø¡ Ø®Ø¯Ù…Ø§ØªÙ‡Ù…',
      recommendation: 'Ø£ØªÙ…ØªØ© Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',
      category: 'process', priority: 'Critical', status: 'InProgress',
      implementedDate: null, assignedTo: 'ÙØ±ÙŠÙ‚ IAM',
      dueDate: '2025-02-28', progress: 60, createdBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', createdDate: '2025-02-01'
    },
    {
      id: 3, incidentId: 'INC-2025-002',
      lesson: 'Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ØªØ¯Ø±ÙŠØ¨ Ø¯ÙˆØ±ÙŠ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµÙŠØ¯',
      recommendation: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø­Ù…Ù„Ø§Øª ØªÙˆØ¹ÙŠØ© Ø´Ù‡Ø±ÙŠØ© ÙˆØ§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØµÙŠØ¯ ÙˆÙ‡Ù…ÙŠØ©',
      category: 'awareness', priority: 'Medium', status: 'Pending',
      implementedDate: null, assignedTo: 'ÙØ±ÙŠÙ‚ Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
      dueDate: '2025-03-15', progress: 0, createdBy: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', createdDate: '2025-02-03'
    },]);
  const [linkedAssets, setLinkedAssets] = useState([
    { incidentId: 'INC-2025-001', assetId: 'AST-001', assetName: 'Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', assetType: 'Server', criticality: 'Critical' },
    { incidentId: 'INC-2025-001', assetId: 'AST-002', assetName: 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', assetType: 'Database', criticality: 'Critical' },
    { incidentId: 'INC-2025-002', assetId: 'AST-003', assetName: 'Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', assetType: 'Server', criticality: 'High' },
  ]);

  const [linkedObligations, setLinkedObligations] = useState([
    { incidentId: 'INC-2025-001', obligationId: 'OBL-NCA-001', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©', authority: 'NCA', deadline: 72 },
    { incidentId: 'INC-2025-003', obligationId: 'OBL-SAMA-001', title: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­ÙˆØ§Ø¯Ø« Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', authority: 'SAMA', deadline: 24 },
  ]);

  const [linkedViolations, setLinkedViolations] = useState([
    { incidentId: 'INC-2025-003', violationId: 'VIO-001', title: 'ØªØ£Ø®Ø± ÙÙŠ ØªØ¹Ø·ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…ÙˆØ¸Ù Ù…ØºØ§Ø¯Ø±', status: 'Open', severity: 'High' },
  ]);

  // Available assets for linking
  const availableAssets = [
    { id: 'AST-001', name: 'Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', type: 'Server', criticality: 'Critical' },
    { id: 'AST-002', name: 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', type: 'Database', criticality: 'Critical' },
    { id: 'AST-003', name: 'Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', type: 'Server', criticality: 'High' },
    { id: 'AST-004', name: 'Ù†Ø¸Ø§Ù… ERP', type: 'Application', criticality: 'Critical' },
    { id: 'AST-005', name: 'Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', type: 'Network', criticality: 'Medium' },
    { id: 'AST-006', name: 'Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ù„ÙØ§Øª', type: 'Server', criticality: 'Medium' },
    { id: 'AST-007', name: 'Ù†Ø¸Ø§Ù… HR', type: 'Application', criticality: 'High' },
    { id: 'AST-008', name: 'Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', type: 'Application', criticality: 'High' },
  ];

  const resetTemplateForm = () => {
    setTemplateFormData({
      name: '', type: '', defaultSeverity: 'Medium', defaultAuthority: 'NCA',
      containmentChecklist: [], eradicationChecklist: [], recoveryChecklist: [],
      requiredEvidence: []
    });
    setNewChecklistItem({ containment: '', eradication: '', recovery: '', evidence: '' });
  };

  const handleAddTemplate = () => {
    if (!templateFormData.name || !templateFormData.type) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', 'error');
      return;
    }
    const newTemplate = {
      id: Math.max(...incidentTemplates.map(t => t.id), 0) + 1,
      ...templateFormData,
      usageCount: 0, lastUsed: null, createdBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ'
    };
    setIncidentTemplates([...incidentTemplates, newTemplate]);
    showNotificationMsg('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    setShowTemplateModal(false);
    resetTemplateForm();
  };

  const handleEditTemplate = () => {
    if (!templateFormData.name || !templateFormData.type) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', 'error');
      return;
    }
    setIncidentTemplates(incidentTemplates.map(t =>
      t.id === selectedTemplate.id ? { ...t, ...templateFormData } : t
    ));
    showNotificationMsg('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    setShowEditTemplateModal(false);
    resetTemplateForm();
  };

  const handleDeleteTemplate = () => {
    setIncidentTemplates(incidentTemplates.filter(t => t.id !== selectedTemplate.id));
    showNotificationMsg('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨');
    setShowDeleteTemplateModal(false);
    setSelectedTemplate(null);
  };

  const addChecklistItem = (phase) => {
    const text = newChecklistItem[phase];
    if (!text.trim()) return;
    const key = `${phase}Checklist`;
    const newItem = { id: Date.now(), text: text.trim(), required: false };
    setTemplateFormData({
      ...templateFormData,
      [key]: [...templateFormData[key], newItem]
    });
    setNewChecklistItem({ ...newChecklistItem, [phase]: '' });
  };

  const removeChecklistItem = (phase, itemId) => {
    const key = `${phase}Checklist`;
    setTemplateFormData({
      ...templateFormData,
      [key]: templateFormData[key].filter(item => item.id !== itemId)
    });
  };

  const applyTemplate = (template, incidentId) => {
    // Initialize action checklists for the incident
    const actions = {
      [`${incidentId}_containment`]: template.containmentChecklist.map(item => ({ ...item, completed: false, completedDate: null, completedBy: null })),
      [`${incidentId}_eradication`]: template.eradicationChecklist.map(item => ({ ...item, completed: false, completedDate: null, completedBy: null })),
      [`${incidentId}_recovery`]: template.recoveryChecklist.map(item => ({ ...item, completed: false, completedDate: null, completedBy: null })),
    };
    setIncidentActions({ ...incidentActions, ...actions });

    // Update template usage
    setIncidentTemplates(incidentTemplates.map(t =>
      t.id === template.id ? { ...t, usageCount: t.usageCount + 1, lastUsed: new Date().toISOString().split('T')[0] } : t
    ));

    showNotificationMsg(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨ "${template.name}" Ø¨Ù†Ø¬Ø§Ø­`);
  };

  const toggleActionItem = (incidentId, phase, itemId) => {
    const key = `${incidentId}_${phase}`;
    const currentActions = incidentActions[key] || [];
    const updatedActions = currentActions.map(item => {
      if (item.id === itemId) {
        return {
          ...item,
          completed: !item.completed,
          completedDate: !item.completed ? new Date().toISOString() : null,
          completedBy: !item.completed ? 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ' : null
        };
      }
      return item;
    });
    setIncidentActions({ ...incidentActions, [key]: updatedActions });

    const requiredItems = updatedActions.filter(a => a.required);
    const completedRequired = requiredItems.filter(a => a.completed);
    if (requiredItems.length > 0 && completedRequired.length === requiredItems.length) {
      showNotificationMsg(`ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ù…Ø±Ø­Ù„Ø© ${phase === 'containment' ? 'Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡' : phase === 'eradication' ? 'Ø§Ù„Ø¥Ø²Ø§Ù„Ø©' : 'Ø§Ù„ØªØ¹Ø§ÙÙŠ'}! ğŸ‰`);
    }
  };

  const getPhaseProgress = (incidentId, phase) => {
    const key = `${incidentId}_${phase}`;
    const actions = incidentActions[key] || [];
    if (actions.length === 0) return { completed: 0, total: 0, percentage: 0 };
    const completed = actions.filter(a => a.completed).length;
    return { completed, total: actions.length, percentage: Math.round((completed / actions.length) * 100) };
  };

  const submitNCAReport = () => {
    if (!ncaReportForm.financialImpact || !ncaReportForm.operationalImpact) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
      return;
    }

    const newReport = {
      id: Math.max(...regulatoryReports.map(r => r.id), 0) + 1,
      incidentId: selectedIncident.id, authority: 'NCA', reportType: ncaReportForm.reportType,
      submittedDate: new Date().toISOString(), status: 'Submitted',
      referenceNumber: `NCA-2025-${String(regulatoryReports.length + 1).padStart(4, '0')}`,
      responseDate: null, response: null, submittedBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ', financialImpact: ncaReportForm.financialImpact,
      operationalImpact: ncaReportForm.operationalImpact, containmentMeasures: ncaReportForm.containmentMeasures,
      additionalInfo: ncaReportForm.additionalInfo
    };

    setRegulatoryReports([...regulatoryReports, newReport]);
    setIncidents(incidents.map(inc =>
      inc.id === selectedIncident.id ? { ...inc, ncaReported: true, ncaReportRef: newReport.referenceNumber } : inc
    ));

    showNotificationMsg(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ NCA Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${newReport.referenceNumber}`);
    setShowNCAReportModal(false);
    setNcaReportForm({ reportType: 'initial', financialImpact: '', operationalImpact: '', containmentMeasures: '', additionalInfo: '' });
  };

  const submitSAMAReport = () => {
    if (!samaReportForm.recoveryPlan) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø®Ø·Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ', 'error');
      return;
    }

    const newReport = {
      id: Math.max(...regulatoryReports.map(r => r.id), 0) + 1,
      incidentId: selectedIncident.id, authority: 'SAMA', reportType: samaReportForm.reportType,
      submittedDate: new Date().toISOString(), status: 'Submitted',
      referenceNumber: `SAMA-2025-${String(regulatoryReports.length + 1).padStart(4, '0')}`,
      responseDate: null, response: null, submittedBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ',
      affectedCustomers: samaReportForm.affectedCustomers, financialImpact: samaReportForm.financialImpact,
      servicesAffected: samaReportForm.servicesAffected,
      recoveryPlan: samaReportForm.recoveryPlan
    };

    setRegulatoryReports([...regulatoryReports, newReport]);
    setIncidents(incidents.map(inc =>
      inc.id === selectedIncident.id ? { ...inc, samaReported: true, samaReportRef: newReport.referenceNumber } : inc
    ));

    showNotificationMsg(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ SAMA Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${newReport.referenceNumber}`);
    setShowSAMAReportModal(false);
    setSamaReportForm({ reportType: 'initial', affectedCustomers: 0, financialImpact: 0, servicesAffected: [], recoveryPlan: '', additionalInfo: '' });
  };

  const resetLessonForm = () => {
    setLessonFormData({
      incidentId: '', lesson: '', recommendation: '', category: 'process',
      assignedTo: '', dueDate: '', priority: 'Medium'
    });
  };

  const handleAddLesson = () => {
    if (!lessonFormData.incidentId || !lessonFormData.lesson || !lessonFormData.recommendation) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
      return;
    }

    const newLesson = {
      id: Math.max(...lessonsLearned.map(l => l.id), 0) + 1,
      ...lessonFormData,
      status: 'Pending', progress: 0, implementedDate: null, createdBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ',
      createdDate: new Date().toISOString().split('T')[0]
    };

    setLessonsLearned([...lessonsLearned, newLesson]);
    showNotificationMsg('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
    setShowLessonModal(false);
    resetLessonForm();
  };

  const handleEditLesson = () => {
    if (!lessonFormData.lesson || !lessonFormData.recommendation) {
      showNotificationMsg('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
      return;
    }

    setLessonsLearned(lessonsLearned.map(l =>
      l.id === selectedLesson.id ? { ...l, ...lessonFormData } : l
    ));
    showNotificationMsg('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
    setShowEditLessonModal(false);
    resetLessonForm();
  };

  const handleDeleteLesson = () => {
    setLessonsLearned(lessonsLearned.filter(l => l.id !== selectedLesson.id));
    showNotificationMsg('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯');
    setShowDeleteLessonModal(false);
    setSelectedLesson(null);
  };

  const updateLessonStatus = (lessonId, newStatus, progress) => {
    setLessonsLearned(lessonsLearned.map(l => {
      if (l.id === lessonId) {
        return {
          ...l,
          status: newStatus, progress: progress,
          implementedDate: newStatus === 'Implemented' ? new Date().toISOString().split('T')[0] : l.implementedDate
        };
      }
      return l;
    }));
    showNotificationMsg(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø³ Ø¥Ù„Ù‰ ${newStatus === 'Implemented' ? 'Ù…ÙØ·Ø¨Ù‚' : newStatus === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…Ø¹Ù„Ù‚'}`);
  };

  const linkAsset = (incidentId, asset) => {
    if (linkedAssets.some(la => la.incidentId === incidentId && la.assetId === asset.id)) {
      showNotificationMsg('Ù‡Ø°Ø§ Ø§Ù„Ø£ØµÙ„ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', 'error');
      return;
    }
    const newLink = {
      incidentId,
      assetId: asset.id, assetName: asset.name, assetType: asset.type,
      criticality: asset.criticality
    };
    setLinkedAssets([...linkedAssets, newLink]);
    showNotificationMsg(`ØªÙ… Ø±Ø¨Ø· "${asset.name}" Ø¨Ø§Ù„Ø­Ø§Ø¯Ø«Ø©`);
  };

  const unlinkAsset = (incidentId, assetId) => {
    setLinkedAssets(linkedAssets.filter(la => !(la.incidentId === incidentId && la.assetId === assetId)));
    showNotificationMsg('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø£ØµÙ„');
  };

  // Incident Types
  const INCIDENT_TYPES = [
    { id: 'malware', name: 'Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø®Ø¨ÙŠØ«Ø©', nameEn: 'Malware', icon: 'ğŸ¦ ', color: 'red' },
    { id: 'phishing', name: 'ØªØµÙŠØ¯ Ø§Ø­ØªÙŠØ§Ù„ÙŠ', nameEn: 'Phishing', icon: 'ğŸ£', color: 'orange' },
    { id: 'data_breach', name: 'ØªØ³Ø±ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª', nameEn: 'Data Breach', icon: 'ğŸ’¾', color: 'red' },
    { id: 'unauthorized_access', name: 'ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­', nameEn: 'Unauthorized Access', icon: 'ğŸš«', color: 'amber' },
    { id: 'ddos', name: 'Ù‡Ø¬ÙˆÙ… Ø­Ø¬Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©', nameEn: 'DDoS Attack', icon: 'ğŸŒŠ', color: 'purple' },
    { id: 'ransomware', name: 'ÙØ¯ÙŠØ©', nameEn: 'Ransomware', icon: 'ğŸ”’', color: 'red' },
    { id: 'insider_threat', name: 'ØªÙ‡Ø¯ÙŠØ¯ Ø¯Ø§Ø®Ù„ÙŠ', nameEn: 'Insider Threat', icon: 'ğŸ‘¤', color: 'amber' },
    { id: 'system_failure', name: 'ÙØ´Ù„ Ù†Ø¸Ø§Ù…', nameEn: 'System Failure', icon: 'âš™ï¸', color: 'blue' },
    { id: 'policy_violation', name: 'Ù…Ø®Ø§Ù„ÙØ© Ø³ÙŠØ§Ø³Ø©', nameEn: 'Policy Violation', icon: 'ğŸ“‹', color: 'slate' },
    { id: 'other', name: 'Ø£Ø®Ø±Ù‰', nameEn: 'Other', icon: 'â“', color: 'gray' },
  ];

  // Severity Levels
  const SEVERITY_LEVELS = {
    'Critical': { label: 'Ø­Ø±Ø¬', color: 'red', priority: 1, sla: 4, icon: 'ğŸ”´' },
    'High': { label: 'Ø¹Ø§Ù„ÙŠ', color: 'orange', priority: 2, sla: 8, icon: 'ğŸŸ ' },
    'Medium': { label: 'Ù…ØªÙˆØ³Ø·', color: 'amber', priority: 3, sla: 24, icon: 'ğŸŸ¡' },
    'Low': { label: 'Ù…Ù†Ø®ÙØ¶', color: 'blue', priority: 4, sla: 72, icon: 'ğŸ”µ' },
  };

  // Incident Statuses
  const INCIDENT_STATUSES = {
    'New': { label: 'Ø¬Ø¯ÙŠØ¯', color: 'purple', icon: 'ğŸ†•' },
    'Triaging': { label: 'Ù‚ÙŠØ¯ Ø§Ù„ÙØ±Ø²', color: 'blue', icon: 'ğŸ”' },
    'Investigating': { label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚', color: 'amber', icon: 'ğŸ”¬' },
    'Containing': { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡', color: 'orange', icon: 'ğŸ›¡ï¸' },
    'Eradicating': { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø²Ø§Ù„Ø©', color: 'red', icon: 'ğŸ§¹' },
    'Recovering': { label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹Ø§ÙÙŠ', color: 'teal', icon: 'ğŸ”„' },
    'Closed': { label: 'Ù…ØºÙ„Ù‚', color: 'emerald', icon: 'âœ…' },
    'Reported': { label: 'ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº', color: 'indigo', icon: 'ğŸ“¤' },
  };

  // Sample Incidents Data
  const [incidents, setIncidents] = useState([
    {
      id: 'INC-2025-001', title: 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', type: 'unauthorized_access', severity: 'Critical',
      status: 'Investigating', detectedDate: '2025-02-04T08:30:00', reportedDate: '2025-02-04T09:00:00',
      reportedBy: 'ÙØ±ÙŠÙ‚ SOC', assignedTo: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯',
      affectedSystems: ['Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'],
      affectedUsers: 150,
      description: 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªÙƒØ±Ø±Ø© Ù„Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ù† Ø¹Ù†ÙˆØ§Ù† IP Ø®Ø§Ø±Ø¬ÙŠ.',
      rootCause: '',
      containmentActions: ['ØªÙ… Ø­Ø¸Ø± Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ«ÙØ©'],
      authority: 'NCA', ncaReported: false, ncaReportDeadline: '2025-02-07T08:30:00',
      impact: { financial: 0, operational: 'Medium', reputational: 'Low', regulatory: 'High' },
      timeline: [
        { date: '2025-02-04T08:30:00', action: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ù†Ø¸Ø§Ù… SIEM' },
        { date: '2025-02-04T09:00:00', action: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', user: 'ÙØ±ÙŠÙ‚ SOC' },
        { date: '2025-02-04T09:15:00', action: 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚', user: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯' },
        { date: '2025-02-04T10:00:00', action: 'Ø­Ø¸Ø± IP Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', user: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ' },
      ]
    },
    {
      id: 'INC-2025-002', title: 'Ø­Ù…Ù„Ø© ØªØµÙŠØ¯ ØªØ³ØªÙ‡Ø¯Ù Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', type: 'phishing', severity: 'High', status: 'Containing',
      detectedDate: '2025-02-03T14:00:00', reportedDate: '2025-02-03T14:30:00', reportedBy: 'Ù…ÙˆØ¸Ù - Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
      assignedTo: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', affectedSystems: ['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'], affectedUsers: 45,
      description: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø³Ø§Ø¦Ù„ ØªØµÙŠØ¯ Ø§Ø­ØªÙŠØ§Ù„ÙŠØ© ØªÙ†ØªØ­Ù„ ØµÙØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØªØ·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„.',
      rootCause: 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø·Ø§Ù‚ Ù…Ø´Ø§Ø¨Ù‡ Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´Ø±ÙƒØ©',
      containmentActions: ['Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', 'Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†'],
      authority: 'SAMA', ncaReported: true, ncaReportDeadline: '2025-02-06T14:00:00',
      impact: { financial: 0, operational: 'Low', reputational: 'Medium', regulatory: 'Medium' },
      timeline: [
        { date: '2025-02-03T14:00:00', action: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯' },
        { date: '2025-02-03T14:30:00', action: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', user: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯' },
        { date: '2025-02-03T15:00:00', action: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ' },
        { date: '2025-02-03T15:30:00', action: 'Ø­Ø¸Ø± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡', user: 'ÙØ±ÙŠÙ‚ IT' },
        { date: '2025-02-03T16:00:00', action: 'Ø¥Ø¨Ù„Ø§Øº NCA', user: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ' },
      ]
    },
    {
      id: 'INC-2025-003', title: 'ØªØ³Ø±ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„', type: 'data_breach', severity: 'Critical', status: 'Reported',
      detectedDate: '2025-02-01T10:00:00', reportedDate: '2025-02-01T10:30:00', reportedBy: 'ÙØ±ÙŠÙ‚ DLP',
      assignedTo: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', affectedSystems: ['Ù†Ø¸Ø§Ù… CRM', 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'], affectedUsers: 2500,
      description: 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù†Ù‚Ù„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù…Ù„ÙØ§Øª ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø© Ø³Ø­Ø§Ø¨ÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©.',
      rootCause: 'Ù…ÙˆØ¸Ù Ø³Ø§Ø¨Ù‚ Ù„Ù… ÙŠØªÙ… ØªØ¹Ø·ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡',
      containmentActions: ['ØªØ¹Ø·ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø¥Ù„ØºØ§Ø¡ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„ÙØ§Øª', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª'],
      authority: 'NCA', ncaReported: true, ncaReportDeadline: '2025-02-04T10:00:00',
      impact: { financial: 50000, operational: 'High', reputational: 'High', regulatory: 'Critical' },
      timeline: [
        { date: '2025-02-01T10:00:00', action: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ù†Ø¸Ø§Ù… DLP' },
        { date: '2025-02-01T10:30:00', action: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', user: 'ÙØ±ÙŠÙ‚ DLP' },
        { date: '2025-02-01T11:00:00', action: 'ØªØµØ¹ÙŠØ¯ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©', user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ' },
        { date: '2025-02-01T12:00:00', action: 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨', user: 'IT Admin' },
        { date: '2025-02-01T14:00:00', action: 'Ø¥Ø¨Ù„Ø§Øº NCA', user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ' },
        { date: '2025-02-02T09:00:00', action: 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ', user: 'ÙØ±ÙŠÙ‚ Ø®Ø§Ø±Ø¬ÙŠ' },
        { date: '2025-02-03T16:00:00', action: 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ' },
      ]
    },
    {
      id: 'INC-2025-004', title: 'Ø§ÙƒØªØ´Ø§Ù Ø¨Ø±Ù…Ø¬ÙŠØ© Ø®Ø¨ÙŠØ«Ø© Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', type: 'malware', severity: 'Medium',
      status: 'Closed', detectedDate: '2025-01-28T09:00:00', reportedDate: '2025-01-28T09:30:00',
      reportedBy: 'Ù†Ø¸Ø§Ù… Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª', assignedTo: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ', affectedSystems: ['Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø¹Ù…Ù„'], affectedUsers: 12,
      description: 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¨Ø±Ù…Ø¬ÙŠØ© Ø®Ø¨ÙŠØ«Ø© Ù…Ù† Ù†ÙˆØ¹ Trojan Ø¹Ù„Ù‰ 12 Ø¬Ù‡Ø§Ø² Ù…Ù† Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.',
      rootCause: 'ØªØ­Ù…ÙŠÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ù† Ù…ØµØ¯Ø± ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚',
      containmentActions: ['Ø¹Ø²Ù„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©', 'ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø¨ÙƒØ©', 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ù†Ø¸Ù…Ø©'],
      authority: 'NCA', ncaReported: true, ncaReportDeadline: '2025-01-31T09:00:00',
      impact: { financial: 5000, operational: 'Low', reputational: 'Low', regulatory: 'Low' },
      timeline: [
        { date: '2025-01-28T09:00:00', action: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Antivirus' },
        { date: '2025-01-28T09:30:00', action: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', user: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ' },
        { date: '2025-01-28T10:00:00', action: 'Ø¹Ø²Ù„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©', user: 'IT Team' },
        { date: '2025-01-28T14:00:00', action: 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©', user: 'IT Team' },
        { date: '2025-01-29T10:00:00', action: 'Ø§Ù„ØªØ¹Ø§ÙÙŠ Ø§Ù„ÙƒØ§Ù…Ù„', user: 'IT Team' },
        { date: '2025-01-30T09:00:00', action: 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ' },
      ]
    },
    {
      id: 'INC-2025-005', title: 'ÙØ´Ù„ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', type: 'system_failure', severity: 'High',
      status: 'Recovering', detectedDate: '2025-02-04T06:00:00', reportedDate: '2025-02-04T06:30:00',
      reportedBy: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', assignedTo: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ', affectedSystems: ['Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', 'Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†'],
      affectedUsers: 0,
      description: 'ÙØ´Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù„ÙŠÙ„ÙŠØ© Ù…Ù…Ø§ Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.',
      rootCause: 'Ø§Ù…ØªÙ„Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†',
      containmentActions: ['ØªÙˆØ³ÙŠØ¹ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†', 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ'],
      authority: 'SAMA', ncaReported: false, ncaReportDeadline: '2025-02-07T06:00:00',
      impact: { financial: 0, operational: 'High', reputational: 'Low', regulatory: 'Medium' },
      timeline: [
        { date: '2025-02-04T06:00:00', action: 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙØ´Ù„', user: 'Monitoring' },
        { date: '2025-02-04T06:30:00', action: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', user: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ' },
        { date: '2025-02-04T07:00:00', action: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨', user: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ' },
        { date: '2025-02-04T08:00:00', action: 'ØªÙˆØ³ÙŠØ¹ Ø§Ù„ØªØ®Ø²ÙŠÙ†', user: 'IT Team' },
      ]
    },]);
  // Analytics Calculations (Real-time from data)
  const analytics = useMemo(() => {
    const closedIncidents = incidents.filter(i => ['Closed', 'Reported'].includes(i.status));

    // MTTD - Mean Time to Detect
    const mttdValues = incidents.filter(i => i.detectedDate && i.reportedDate).map(i => {
      const detected = new Date(i.detectedDate);
      const reported = new Date(i.reportedDate);
      return (reported - detected) / (1000 * 60 * 60);
    });
    const mttd = mttdValues.length > 0 ? (mttdValues.reduce((a, b) => a + b, 0) / mttdValues.length).toFixed(1) : 0;

    // MTTR - Mean Time to Respond
    const mttrValues = closedIncidents.filter(i => i.timeline && i.timeline.length > 0).map(i => {
      const detected = new Date(i.detectedDate);
      const closed = new Date(i.timeline[i.timeline.length - 1].date);
      return (closed - detected) / (1000 * 60 * 60);
    });
    const mttr = mttrValues.length > 0 ? (mttrValues.reduce((a, b) => a + b, 0) / mttrValues.length).toFixed(1) : 0;

    // Trends
    const monthlyTrends = [];
    for (let i = 5; i >= 0; i--) {
      const date = new Date();
      date.setMonth(date.getMonth() - i);
      const monthName = date.toLocaleDateString('ar-SA', { month: 'short' });
      const monthIncidents = incidents.filter(inc => {
        const incDate = new Date(inc.detectedDate);
        return incDate.getMonth() === date.getMonth() && incDate.getFullYear() === date.getFullYear();
      });
      monthlyTrends.push({
        month: monthName, total: monthIncidents.length,
        critical: monthIncidents.filter(i => i.severity === 'Critical').length,
        high: monthIncidents.filter(i => i.severity === 'High').length,
      });
    }
    // By Type
    const byType = INCIDENT_TYPES.map(t => ({
      ...t,
      count: incidents.filter(i => i.type === t.id).length
    })).filter(t => t.count > 0);

    return { mttd, mttr, monthlyTrends, byType };
  }, [incidents]);

  // Form Data
  const [formData, setFormData] = useState({
    title: '', type: '', severity: 'Medium', description: '', detectedDate: new Date().toISOString().slice(0, 16),
    reportedBy: '', assignedTo: '', affectedSystems: [], affectedUsers: 0, authority: 'NCA', containmentActions: [],
  });

  // Reset Form
  const resetForm = () => {
    setFormData({
      title: '', type: '', severity: 'Medium', description: '', detectedDate: new Date().toISOString().slice(0, 16),
      reportedBy: '', assignedTo: '', affectedSystems: [], affectedUsers: 0, authority: 'NCA', containmentActions: [],
    });
    setWizardStep(1);
  };

  // Statistics
  const stats = useMemo(() => {
    const now = new Date();
    const activeIncidents = incidents.filter(i => !['Closed', 'Reported'].includes(i.status));
    const criticalActive = activeIncidents.filter(i => i.severity === 'Critical');
    const pendingReport = incidents.filter(i => !i.ncaReported && new Date(i.ncaReportDeadline) > now);
    const overdueReport = incidents.filter(i => !i.ncaReported && new Date(i.ncaReportDeadline) < now);
    const last30Days = incidents.filter(i => (now - new Date(i.detectedDate)) / (1000 * 60 * 60 * 24) <= 30);

    return {
      total: incidents.length, active: activeIncidents.length, critical: criticalActive.length,
      pendingReport: pendingReport.length, overdueReport: overdueReport.length, last30Days: last30Days.length,
      avgResolutionTime: '18 Ø³Ø§Ø¹Ø©',
      byType: INCIDENT_TYPES.map(t => ({ ...t, count: incidents.filter(i => i.type === t.id).length })).filter(t => t.count > 0),
      bySeverity: Object.keys(SEVERITY_LEVELS).map(s => ({ severity: s, ...SEVERITY_LEVELS[s], count: incidents.filter(i => i.severity === s).length })),
    };
  }, [incidents]);

  const filteredIncidents = useMemo(() => {
    return incidents.filter(inc => {
      if (searchQuery && !inc.title.includes(searchQuery) && !inc.id.includes(searchQuery)) return false;
      if (filterSeverity && inc.severity !== filterSeverity) return false;
      if (filterStatus && inc.status !== filterStatus) return false;
      if (filterType && inc.type !== filterType) return false;
      return true;
    });
  }, [incidents, searchQuery, filterSeverity, filterStatus, filterType]);

  // Handlers
  const openAddModal = () => { resetForm(); setShowAddModal(true); };
  const openViewModal = (incident) => { setSelectedIncident(incident); setViewTab('details'); setShowViewModal(true); };
  const openEditModal = (incident) => {
    setSelectedIncident(incident);
    setFormData({
      title: incident.title, type: incident.type, severity: incident.severity, description: incident.description,
      detectedDate: incident.detectedDate, reportedBy: incident.reportedBy, assignedTo: incident.assignedTo,
      affectedSystems: incident.affectedSystems, affectedUsers: incident.affectedUsers, authority: incident.authority,
      containmentActions: incident.containmentActions,
    });
    setWizardStep(1);
    setShowEditModal(true);
  };
  const openDeleteModal = (incident) => { setSelectedIncident(incident); setShowDeleteModal(true); };
  const openReportModal = (incident) => { setSelectedIncident(incident); setShowReportModal(true); };

  const handleAddIncident = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      const newId = `INC-2025-${String(incidents.length + 1).padStart(3, '0')}`;
      const detectedDate = new Date(formData.detectedDate);
      const deadline = new Date(detectedDate);
      deadline.setHours(deadline.getHours() + 72);

      const newIncident = {
        id: newId,
        ...formData,
        status: 'New', reportedDate: new Date().toISOString(), ncaReported: false, ncaReportDeadline: deadline.toISOString(),
        rootCause: '',
        impact: { financial: 0, operational: 'Medium', reputational: 'Low', regulatory: 'Medium' },
        timeline: [
          { date: new Date().toISOString(), action: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ø§Ù„Ù†Ø¸Ø§Ù…' }
        ]
      };
      setIncidents([newIncident, ...incidents]);
      setIsSubmitting(false);
      setShowAddModal(false);
      resetForm();
    }, 1000);
  };

  const handleEditIncident = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setIncidents(incidents.map(i => i.id === selectedIncident.id ? {
        ...i,
        ...formData,
        timeline: [...i.timeline, { date: new Date().toISOString(), action: 'ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', user: 'Ø§Ù„Ù†Ø¸Ø§Ù…' }]
      } : i));
      setIsSubmitting(false);
      setShowEditModal(false);
      setSelectedIncident(null);
    }, 1000);
  };

  const handleDeleteIncident = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setIncidents(incidents.filter(i => i.id !== selectedIncident.id));
      setIsSubmitting(false);
      setShowDeleteModal(false);
      setSelectedIncident(null);
    }, 800);
  };

  const handleReportToNCA = () => {
    setIsSubmitting(true);
    setTimeout(() => {
      setIncidents(incidents.map(i => i.id === selectedIncident.id ? {
        ...i,
        ncaReported: true, status: 'Reported',
        timeline: [...i.timeline, { date: new Date().toISOString(), action: 'Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© (NCA)', user: 'Ø§Ù„Ù†Ø¸Ø§Ù…' }]
      } : i));
      setIsSubmitting(false);
      setShowReportModal(false);
      setSelectedIncident(null);
    }, 1500);
  };

  const updateIncidentStatus = (incidentId, newStatus) => {
    setIncidents(incidents.map(i => i.id === incidentId ? {
      ...i,
      status: newStatus,
      timeline: [...i.timeline, { date: new Date().toISOString(), action: `ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${INCIDENT_STATUSES[newStatus].label}`, user: 'Ø§Ù„Ù†Ø¸Ø§Ù…' }]
    } : i));
  };

  // Get time remaining for NCA report
  const getReportTimeRemaining = (deadline) => {
    const now = new Date();
    const deadlineDate = new Date(deadline);
    const diff = deadlineDate - now;
    if (diff < 0) return { text: 'Ù…ØªØ£Ø®Ø±', color: 'red', urgent: true };
    const hours = Math.floor(diff / (1000 * 60 * 60));
    if (hours < 24) return { text: `${hours} Ø³Ø§Ø¹Ø©`, color: 'red', urgent: true };
    if (hours < 48) return { text: `${Math.floor(hours / 24)} ÙŠÙˆÙ…`, color: 'amber', urgent: true };
    return { text: `${Math.floor(hours / 24)} ÙŠÙˆÙ…`, color: 'emerald', urgent: false };
  };

  const tabs = [
    { id: 'dashboard', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', icon: LayoutDashboard },
    { id: 'incidents', label: 'Ø³Ø¬Ù„ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«', icon: Zap, count: stats.active },
    { id: 'templates', label: 'Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', icon: FileText, count: incidentTemplates.length },
    { id: 'actions', label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: CheckSquare },
    { id: 'regulatory', label: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', icon: Send, count: stats.pendingReport },
    { id: 'analytics', label: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª', icon: BarChart3 },
    { id: 'lessons', label: 'Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©', icon: Lightbulb, count: lessonsLearned.filter(l => l.status === 'Pending').length },
    { id: 'links', label: 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø·', icon: Link2 },
  ];

  return (
    <div className="space-y-6">
      <div className="relative overflow-hidden bg-gradient-to-br from-red-600 via-rose-600 to-orange-600 rounded-3xl p-8 text-white">
        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtOS45NDEgMC0xOCA4LjA1OS0xOCAxOHM4LjA1OSAxOCAxOCAxOGM5Ljk0MSAwIDE4LTguMDU5IDE4LTE4cy04LjA1OS0xOC0xOC0xOHptMCAzMmMtNy43MzIgMC0xNC02LjI2OC0xNC0xNHM2LjI2OC0xNCAxNC0xNHMxNCA2LjI2OCAxNCAxNC02LjI2OCAxNC0xNCAxNHoiIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iLjA1Ii8+PC9nPjwvc3ZnPg==')] opacity-30"></div>
        <div className="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>

        <div className="relative flex items-start justify-between">
          <div>
            <div className="flex items-center gap-3 mb-2">
              <div className="w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center">
                <Zap className="w-8 h-8" />
              </div>
              <div>
                <h1 className="text-3xl font-black">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©</h1>
                <p className="text-red-100">Security Incident Response System - NCA Compliant</p>
              </div> </div>
            <p className="text-red-100 mt-2 max-w-xl">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù‡Ø§ ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</p>
          </div>

          <button onClick={openAddModal} className="flex items-center gap-2 px-6 py-3 bg-white text-red-600 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">
            <Plus className="w-5 h-5" />Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
          </button> </div>
        <div className="relative grid grid-cols-6 gap-4 mt-8">
          <div className="bg-white/10 backdrop-blur rounded-2xl p-4 text-center">
            <p className="text-4xl font-black">{stats.total}</p>
            <p className="text-red-100 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«</p>
          </div>
          <div className="bg-white/10 backdrop-blur rounded-2xl p-4 text-center">
            <p className="text-4xl font-black text-yellow-300">{stats.active}</p>
            <p className="text-red-100 text-sm">Ø­ÙˆØ§Ø¯Ø« Ù†Ø´Ø·Ø©</p>
          </div>
          <div className="bg-white/10 backdrop-blur rounded-2xl p-4 text-center border-2 border-white/30">
            <p className="text-4xl font-black text-white">{stats.critical}</p>
            <p className="text-red-100 text-sm">Ø­Ø±Ø¬Ø© Ù†Ø´Ø·Ø©</p>
          </div>
          <div className="bg-white/10 backdrop-blur rounded-2xl p-4 text-center">
            <p className="text-4xl font-black text-amber-300">{stats.pendingReport}</p>
            <p className="text-red-100 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</p>
          </div>
          <div className={`rounded-2xl p-4 text-center ${stats.overdueReport > 0 ? 'bg-red-500/50 border-2 border-white animate-pulse' : 'bg-white/10 backdrop-blur'}`}>
            <p className="text-4xl font-black">{stats.overdueReport}</p>
            <p className="text-red-100 text-sm">Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</p>
          </div>
          <div className="bg-white/10 backdrop-blur rounded-2xl p-4 text-center">
            <p className="text-4xl font-black">{stats.avgResolutionTime}</p>
            <p className="text-red-100 text-sm">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø­Ù„</p>
          </div> </div> </div>
      <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex-1 flex items-center justify-center gap-2 py-4 font-bold transition-all ${activeTab === tab.id
                ? 'bg-red-50 text-red-600 border-b-2 border-red-500'
                : 'text-slate-500 hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count !== undefined && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-red-500 text-white' : 'bg-slate-200 text-slate-600'
                  }`}>{tab.count}</span>
              )}
            </button>
          ))}
        </div>

        {activeTab === 'dashboard' && (
          <div className="p-6 space-y-6">
            {stats.overdueReport > 0 && (
              <div className="bg-red-50 border-2 border-red-300 rounded-2xl p-4 flex items-center gap-4 animate-pulse">
                <div className="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center">
                  <AlertTriangle className="w-6 h-6 text-white" />
                </div>
                <div className="flex-1">
                  <h3 className="font-bold text-red-800">ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¬Ù„: Ø­ÙˆØ§Ø¯Ø« Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¨Ù„Ø§Øº!</h3>
                  <p className="text-red-600">ÙŠÙˆØ¬Ø¯ {stats.overdueReport} Ø­Ø§Ø¯Ø«Ø© ØªØ¬Ø§ÙˆØ²Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ù€ 72 Ø³Ø§Ø¹Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ NCA</p>
                </div>
                <button className="px-4 py-2 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">
                  Ø¹Ø±Ø¶ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
                </button> </div>
            )}

            <div className="grid grid-cols-4 gap-4">
              <div className="bg-slate-50 rounded-2xl p-5">
                <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                  <AlertCircle className="w-5 h-5 text-slate-500" />Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·ÙˆØ±Ø©
                </h4>
                <div className="space-y-3">
                  {stats.bySeverity.map(s => (
                    <div key={s.severity} className="flex items-center gap-3">
                      <span className="text-2xl">{s.icon}</span>
                      <div className="flex-1">
                        <div className="flex justify-between text-sm mb-1">
                          <span className="font-bold text-slate-700">{s.label}</span>
                          <span className="font-bold">{s.count}</span>
                        </div>
                        <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                          <div className={`h-full bg-${s.color}-500 rounded-full`} style={{ width: `${(s.count / stats.total) * 100}%` }} />
                        </div> </div> </div>
                  ))}
                </div> </div>
              <div className="bg-slate-50 rounded-2xl p-5">
                <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                  <Layers className="w-5 h-5 text-slate-500" />Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                </h4>
                <div className="space-y-2">
                  {stats.byType.slice(0, 5).map(t => (
                    <div key={t.id} className="flex items-center justify-between p-2 bg-white rounded-lg">
                      <span className="flex items-center gap-2">
                        <span className="text-xl">{t.icon}</span>
                        <span className="text-sm font-bold text-slate-700">{t.name}</span>
                      </span>
                      <span className={`px-2 py-1 bg-${t.color}-100 text-${t.color}-700 rounded-lg text-sm font-bold`}>{t.count}</span>
                    </div>
                  ))}
                </div> </div>
              <div className="col-span-2 bg-slate-50 rounded-2xl p-5">
                <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                  <Clock className="w-5 h-5 text-slate-500" />Ø£Ø­Ø¯Ø« Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
                </h4>
                <div className="space-y-2">
                  {incidents.slice(0, 4).map(inc => {
                    const typeConfig = INCIDENT_TYPES.find(t => t.id === inc.type);
                    const severityConfig = SEVERITY_LEVELS[inc.severity];
                    return (
                      <div key={inc.id} className="flex items-center gap-3 p-3 bg-white rounded-xl hover:shadow-md transition-all cursor-pointer" onClick={() => openViewModal(inc)}>
                        <span className="text-2xl">{typeConfig?.icon}</span>
                        <div className="flex-1">
                          <p className="font-bold text-slate-800 text-sm">{inc.title}</p>
                          <p className="text-slate-500 text-xs">{inc.id} â€¢ {new Date(inc.detectedDate).toLocaleDateString('ar-SA')}</p>
                        </div>
                        <span className="text-lg">{severityConfig?.icon}</span>
                        <span className={`px-2 py-1 text-xs font-bold rounded-lg bg-${INCIDENT_STATUSES[inc.status].color}-100 text-${INCIDENT_STATUSES[inc.status].color}-700`}>
                          {INCIDENT_STATUSES[inc.status].label}
                        </span> </div>);
                  })}
                </div> </div> </div>
            <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 border-2 border-indigo-200">
              <div className="flex items-center justify-between mb-4">
                <h4 className="font-bold text-indigo-800 flex items-center gap-2">
                  <Shield className="w-5 h-5" />Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ© (NCA - 72 Ø³Ø§Ø¹Ø©)
                </h4>
                <span className="px-3 py-1 bg-indigo-500 text-white rounded-lg text-sm font-bold">
                  {incidents.filter(i => i.ncaReported).length} / {incidents.length} ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº
                </span> </div>
              <div className="grid grid-cols-3 gap-4">
                {incidents.filter(i => !i.ncaReported).slice(0, 3).map(inc => {
                  const timeRemaining = getReportTimeRemaining(inc.ncaReportDeadline);
                  return (
                    <div key={inc.id} className={`p-4 bg-white rounded-xl border-2 ${timeRemaining.urgent ? `border-${timeRemaining.color}-400` : 'border-slate-200'}`}>
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-mono text-sm font-bold text-slate-600">{inc.id}</span>
                        <span className={`px-2 py-1 text-xs font-bold rounded-lg bg-${timeRemaining.color}-100 text-${timeRemaining.color}-700`}>
                          {timeRemaining.text}
                        </span> </div>
                      <p className="font-bold text-slate-800 text-sm mb-2 line-clamp-1">{inc.title}</p>
                      <button onClick={() => openReportModal(inc)} className="w-full py-2 bg-indigo-500 text-white rounded-lg text-sm font-bold hover:bg-indigo-600">
                        Ø¥Ø¨Ù„Ø§Øº NCA Ø§Ù„Ø¢Ù†
                      </button> </div>);
                })}
              </div> </div> </div>
        )}

        {activeTab === 'incidents' && (
          <div className="p-6 space-y-4">
            <div className="flex items-center gap-4 flex-wrap">
              <div className="flex-1 relative">
                <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input type="text" placeholder="Ø¨Ø­Ø«..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)}
                  className="w-full pr-10 pl-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400" />
              </div>
              <select value={filterSeverity} onChange={e => setFilterSeverity(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl outline-none">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ±Ø§Øª</option>
                {Object.entries(SEVERITY_LEVELS).map(([key, val]) => <option key={key} value={key}>{val.icon} {val.label}</option>)}
              </select>
              <select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl outline-none">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                {Object.entries(INCIDENT_STATUSES).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
              </select>
              <select value={filterType} onChange={e => setFilterType(e.target.value)} className="px-4 py-3 border-2 border-slate-200 rounded-xl outline-none">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                {INCIDENT_TYPES.map(t => <option key={t.id} value={t.id}>{t.icon} {t.name}</option>)}
              </select>
              <div className="flex gap-1 bg-slate-100 p-1 rounded-xl">
                <button onClick={() => setViewMode('cards')} className={`p-2 rounded-lg ${viewMode === 'cards' ? 'bg-white shadow' : ''}`}>
                  <LayoutGrid className="w-5 h-5" />
                </button>
                <button onClick={() => setViewMode('table')} className={`p-2 rounded-lg ${viewMode === 'table' ? 'bg-white shadow' : ''}`}>
                  <Table className="w-5 h-5" />
                </button> </div> </div>
            {viewMode === 'cards' && (
              <div className="grid grid-cols-2 gap-4">
                {filteredIncidents.map(inc => {
                  const typeConfig = INCIDENT_TYPES.find(t => t.id === inc.type);
                  const severityConfig = SEVERITY_LEVELS[inc.severity];
                  const statusConfig = INCIDENT_STATUSES[inc.status];
                  const timeRemaining = !inc.ncaReported ? getReportTimeRemaining(inc.ncaReportDeadline) : null;

                  return (
                    <div key={inc.id} className={`bg-white rounded-2xl border-2 overflow-hidden hover:shadow-xl transition-all ${inc.severity === 'Critical' && !['Closed', 'Reported'].includes(inc.status) ? 'border-red-400' : 'border-slate-200 hover:border-red-300'
                      }`}>
                      <div className={`h-2 bg-${severityConfig.color}-500`} />
                      <div className="p-5">
                        <div className="flex items-start justify-between mb-4">
                          <div className="flex items-center gap-3">
                            <div className={`w-14 h-14 rounded-xl bg-${typeConfig?.color || 'slate'}-100 flex items-center justify-center text-3xl`}>
                              {typeConfig?.icon}
                            </div>
                            <div>
                              <span className="font-mono text-sm text-slate-500">{inc.id}</span>
                              <h4 className="font-bold text-slate-800">{inc.title}</h4>
                            </div> </div>
                          <div className="flex flex-col items-end gap-2">
                            <span className="text-2xl">{severityConfig.icon}</span>
                            <span className={`px-3 py-1 rounded-xl text-xs font-bold bg-${statusConfig.color}-100 text-${statusConfig.color}-700`}>
                              {statusConfig.icon} {statusConfig.label}
                            </span> </div> </div>
                        <p className="text-slate-600 text-sm mb-4 line-clamp-2">{inc.description}</p>

                        <div className="grid grid-cols-3 gap-3 mb-4">
                          <div className="text-center p-2 bg-slate-50 rounded-lg">
                            <p className="text-xs text-slate-500">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                            <p className="font-bold text-slate-800">{inc.affectedSystems.length}</p>
                          </div>
                          <div className="text-center p-2 bg-slate-50 rounded-lg">
                            <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</p>
                            <p className="font-bold text-slate-800">{inc.affectedUsers}</p>
                          </div>
                          <div className="text-center p-2 bg-slate-50 rounded-lg">
                            <p className="text-xs text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                            <p className="font-bold text-slate-800 text-xs">{inc.assignedTo?.split(' ')[0]}</p>
                          </div> </div>
                        {!inc.ncaReported && timeRemaining && (
                          <div className={`p-3 rounded-xl mb-4 flex items-center justify-between ${timeRemaining.urgent ? `bg-${timeRemaining.color}-50 border border-${timeRemaining.color}-200` : 'bg-slate-50'
                            }`}>
                            <span className="text-sm font-bold text-slate-700">â° Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ NCA</span>
                            <span className={`px-3 py-1 rounded-lg text-sm font-bold bg-${timeRemaining.color}-500 text-white`}>
                              {timeRemaining.text}
                            </span> </div>
                        )}
                        {inc.ncaReported && (
                          <div className="p-3 rounded-xl mb-4 bg-emerald-50 border border-emerald-200 flex items-center gap-2">
                            <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                            <span className="text-sm font-bold text-emerald-700">ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ NCA</span>
                          </div>
                        )}

                        <div className="flex items-center gap-2">
                          <button onClick={() => openViewModal(inc)} className="flex-1 py-2.5 bg-blue-50 text-blue-600 rounded-xl font-bold text-sm flex items-center justify-center gap-1 hover:bg-blue-100">
                            <Eye className="w-4 h-4" />Ø¹Ø±Ø¶
                          </button>
                          <button onClick={() => openEditModal(inc)} className="flex-1 py-2.5 bg-amber-50 text-amber-600 rounded-xl font-bold text-sm flex items-center justify-center gap-1 hover:bg-amber-100">
                            <Edit className="w-4 h-4" />ØªØ¹Ø¯ÙŠÙ„
                          </button>
                          {!inc.ncaReported && (
                            <button onClick={() => openReportModal(inc)} className="flex-1 py-2.5 bg-indigo-50 text-indigo-600 rounded-xl font-bold text-sm flex items-center justify-center gap-1 hover:bg-indigo-100">
                              <Send className="w-4 h-4" />Ø¥Ø¨Ù„Ø§Øº
                            </button>
                          )}
                          <button onClick={() => openDeleteModal(inc)} className="py-2.5 px-3 bg-red-50 text-red-600 rounded-xl hover:bg-red-100">
                            <Trash2 className="w-4 h-4" />
                          </button> </div> </div> </div>);
                })}
              </div>
            )}

            {viewMode === 'table' && (
              <div className="overflow-hidden rounded-xl border-2 border-slate-200">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gradient-to-r from-slate-50 to-slate-100">
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„ÙƒÙˆØ¯</th>
                      <th className="text-right px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">NCA</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                      <th className="text-center px-4 py-4 font-bold text-slate-700">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody>
                    {filteredIncidents.map((inc, idx) => {
                      const typeConfig = INCIDENT_TYPES.find(t => t.id === inc.type);
                      const severityConfig = SEVERITY_LEVELS[inc.severity];
                      const statusConfig = INCIDENT_STATUSES[inc.status];
                      return (
                        <tr key={inc.id} className={`border-b border-slate-100 hover:bg-red-50/50 transition-all ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`}>
                          <td className="px-4 py-3 font-mono text-sm font-bold text-slate-600">{inc.id}</td>
                          <td className="px-4 py-3">
                            <p className="font-bold text-slate-800">{inc.title}</p>
                            <p className="text-xs text-slate-500">{inc.assignedTo}</p>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-2xl">{typeConfig?.icon}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-2xl">{severityConfig.icon}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className={`px-3 py-1.5 rounded-xl text-xs font-bold bg-${statusConfig.color}-100 text-${statusConfig.color}-700`}>
                              {statusConfig.label}
                            </span> </td>
                          <td className="px-4 py-3 text-center">
                            {inc.ncaReported ? (
                              <CheckCircle2 className="w-6 h-6 text-emerald-500 mx-auto" />
                            ) : (
                              <Clock className="w-6 h-6 text-amber-500 mx-auto" />
                            )}
                          </td>
                          <td className="px-4 py-3 text-center text-sm text-slate-600">
                            {new Date(inc.detectedDate).toLocaleDateString('ar-SA')}
                          </td>
                          <td className="px-4 py-3">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => openViewModal(inc)} className="p-2 hover:bg-blue-100 rounded-lg"><Eye className="w-4 h-4 text-blue-500" /></button>
                              <button onClick={() => openEditModal(inc)} className="p-2 hover:bg-amber-100 rounded-lg"><Edit className="w-4 h-4 text-amber-500" /></button>
                              <button onClick={() => openDeleteModal(inc)} className="p-2 hover:bg-red-100 rounded-lg"><Trash2 className="w-4 h-4 text-red-500" /></button>
                            </div> </td> </tr>);
                    })}
                  </tbody> </table> </div>
            )}
          </div>
        )}

        {activeTab === 'templates' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <FileText className="w-5 h-5 text-indigo-500" />Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
              </h3>
              <button onClick={() => { resetTemplateForm(); setShowTemplateModal(true); }}
                className="flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
              </button> </div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {incidentTemplates.map(template => {
                const typeConfig = INCIDENT_TYPES.find(t => t.id === template.type);
                return (
                  <div key={template.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-lg transition-all">
                    <div className={`px-5 py-4 bg-gradient-to-r ${template.type === 'malware' ? 'from-red-500 to-rose-600' :
                      template.type === 'phishing' ? 'from-orange-500 to-amber-600' :
                        template.type === 'data_breach' ? 'from-purple-500 to-indigo-600' :
                          template.type === 'ransomware' ? 'from-red-600 to-red-700' :
                            'from-blue-500 to-cyan-600'
                      } text-white`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <span className="text-3xl">{typeConfig?.icon || 'ğŸ“‹'}</span>
                          <div>
                            <h4 className="font-bold">{template.name}</h4>
                            <p className="text-sm text-white/80">{typeConfig?.nameEn || template.type}</p>
                          </div> </div>
                        <div className="flex gap-1">
                          <button onClick={() => { setSelectedTemplate(template); setTemplateFormData(template); setShowEditTemplateModal(true); }}
                            className="p-2 hover:bg-white/20 rounded-lg"><Edit className="w-4 h-4" /></button>
                          <button onClick={() => { setSelectedTemplate(template); setShowDeleteTemplateModal(true); }}
                            className="p-2 hover:bg-white/20 rounded-lg"><Trash2 className="w-4 h-4" /></button>
                        </div> </div> </div>
                    <div className="p-5">
                      <div className="grid grid-cols-3 gap-2 mb-4">
                        <div className="bg-orange-50 rounded-xl p-3 text-center">
                          <p className="text-2xl font-bold text-orange-600">{template.containmentChecklist?.length || 0}</p>
                          <p className="text-xs text-orange-700">Ø§Ø­ØªÙˆØ§Ø¡</p>
                        </div>
                        <div className="bg-red-50 rounded-xl p-3 text-center">
                          <p className="text-2xl font-bold text-red-600">{template.eradicationChecklist?.length || 0}</p>
                          <p className="text-xs text-red-700">Ø¥Ø²Ø§Ù„Ø©</p>
                        </div>
                        <div className="bg-emerald-50 rounded-xl p-3 text-center">
                          <p className="text-2xl font-bold text-emerald-600">{template.recoveryChecklist?.length || 0}</p>
                          <p className="text-xs text-emerald-700">ØªØ¹Ø§ÙÙŠ</p>
                        </div> </div>
                      <div className="flex items-center justify-between text-sm text-slate-500 mb-4">
                        <span>Ø§Ø³ØªØ®Ø¯Ù… {template.usageCount || 0} Ù…Ø±Ø©</span>
                        {template.lastUsed && <span>Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…: {template.lastUsed}</span>}
                      </div>
                      <div className="flex gap-2">
                        <select onChange={(e) => e.target.value && applyTemplate(template, e.target.value)}
                          className="flex-1 px-3 py-2 border-2 border-slate-200 rounded-xl text-sm">
                          <option value="">ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø­Ø§Ø¯Ø«Ø©...</option>
                          {incidents.filter(i => !['Closed', 'Reported'].includes(i.status)).map(inc => (
                            <option key={inc.id} value={inc.id}>{inc.id} - {inc.title.substring(0, 30)}</option>
                          ))}
                        </select>
                        <button onClick={() => setSelectedTemplate(template)}
                          className="p-2 border-2 border-slate-200 rounded-xl hover:bg-slate-50">
                          <Eye className="w-4 h-4 text-slate-400" />
                        </button> </div> </div> </div>);
              })}
            </div> </div>
        )}

        {activeTab === 'actions' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <CheckSquare className="w-5 h-5 text-emerald-500" />Ù‚ÙˆØ§Ø¦Ù… ÙØ­Øµ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
              </h3>
              <div className="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden">
                {['containment', 'eradication', 'recovery'].map(phase => (
                  <button key={phase} onClick={() => setCurrentActionPhase(phase)}
                    className={`px-4 py-2 font-bold text-sm transition-all ${currentActionPhase === phase ?
                      (phase === 'containment' ? 'bg-orange-500 text-white' :
                        phase === 'eradication' ? 'bg-red-500 text-white' :
                          'bg-emerald-500 text-white')
                      : 'text-slate-600 hover:bg-slate-50'}`}>
                    {phase === 'containment' ? 'ğŸ›¡ï¸ Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡' : phase === 'eradication' ? 'ğŸ§¹ Ø§Ù„Ø¥Ø²Ø§Ù„Ø©' : 'ğŸ”„ Ø§Ù„ØªØ¹Ø§ÙÙŠ'}
                  </button>
                ))}
              </div> </div>
            {incidents.filter(i => !['Closed', 'Reported'].includes(i.status)).length === 0 ? (
              <div className="bg-emerald-50 rounded-2xl p-8 text-center">
                <CheckCircle2 className="w-16 h-16 text-emerald-300 mx-auto mb-4" />
                <h4 className="text-lg font-bold text-emerald-800 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙˆØ§Ø¯Ø« Ù†Ø´Ø·Ø©</h4>
                <p className="text-emerald-600">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ù…ØºÙ„Ù‚Ø© Ø£Ùˆ ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù†Ù‡Ø§</p>
              </div>
            ) : (
              <div className="space-y-4">
                {incidents.filter(i => !['Closed', 'Reported'].includes(i.status)).map(incident => {
                  const template = incidentTemplates.find(t => t.type === incident.type);
                  const phaseKey = `${incident.id}_${currentActionPhase}`;
                  const actions = incidentActions[phaseKey] || [];
                  const progress = getPhaseProgress(incident.id, currentActionPhase);

                  return (
                    <div key={incident.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                      <div className="px-5 py-4 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <span className="text-2xl">{INCIDENT_TYPES.find(t => t.id === incident.type)?.icon}</span>
                          <div>
                            <p className="font-mono text-sm text-slate-500">{incident.id}</p>
                            <h4 className="font-bold text-slate-800">{incident.title}</h4>
                          </div> </div>
                        <div className="flex items-center gap-4">
                          <div className="text-left">
                            <p className="text-sm text-slate-500">Ø§Ù„ØªÙ‚Ø¯Ù…</p>
                            <p className="font-bold text-lg">{progress.percentage}%</p>
                          </div>
                          <div className={`w-16 h-16 rounded-full border-4 flex items-center justify-center font-bold ${progress.percentage === 100 ? 'border-emerald-500 text-emerald-600' :
                            progress.percentage > 50 ? 'border-amber-500 text-amber-600' :
                              'border-slate-300 text-slate-500'
                            }`}>
                            {progress.completed}/{progress.total}
                          </div> </div> </div>
                      <div className="p-5">
                        {actions.length === 0 ? (
                          <div className="text-center py-6">
                            <p className="text-slate-500 mb-3">Ù„Ù… ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¹Ø¯</p>
                            {template && (
                              <button onClick={() => applyTemplate(template, incident.id)}
                                className="px-4 py-2 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                                ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨ {template.name}
                              </button>
                            )}
                          </div>
                        ) : (
                          <div className="space-y-2">
                            {actions.map(action => (
                              <button key={action.id} onClick={() => toggleActionItem(incident.id, currentActionPhase, action.id)}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl text-right transition-all ${action.completed ? 'bg-emerald-50 border-2 border-emerald-200' : 'bg-slate-50 border-2 border-slate-200 hover:border-slate-300'
                                  }`}>
                                <div className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center ${action.completed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-300'
                                  }`}>
                                  {action.completed && <Check className="w-4 h-4 text-white" />}
                                </div>
                                <div className="flex-1">
                                  <span className={`font-bold ${action.completed ? 'text-emerald-700 line-through' : 'text-slate-700'}`}>
                                    {action.text}
                                  </span>
                                  {action.required && <span className="text-red-500 mr-1">*</span>}
                                  {action.completed && action.completedDate && (
                                    <p className="text-xs text-emerald-600 mt-1">
                                      âœ“ ØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø© {action.completedBy} - {new Date(action.completedDate).toLocaleString('ar-SA')}
                                    </p>
                                  )}
                                </div> </button>
                            ))}
                          </div>
                        )}
                      </div> </div>);
                })}
              </div>
            )}
          </div>
        )}

        {activeTab === 'regulatory' && (
          <div className="p-6 space-y-6">
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
                <Clock className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{incidents.filter(i => !i.ncaReported).length}</p>
                <p className="text-amber-100">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
                <CheckCircle2 className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{regulatoryReports.filter(r => r.status === 'Submitted').length}</p>
                <p className="text-emerald-100">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</p>
              </div>
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-5 text-white">
                <MessageSquare className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{regulatoryReports.filter(r => r.status === 'Acknowledged').length}</p>
                <p className="text-blue-100">ØªÙ… Ø§Ù„Ø±Ø¯</p>
              </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-5 text-white">
                <AlertCircle className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{stats.overdueReport}</p>
                <p className="text-red-100">Ù…ØªØ£Ø®Ø±</p>
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-amber-50 border-b border-amber-200">
                <h4 className="font-bold text-amber-800 flex items-center gap-2">
                  <Clock className="w-5 h-5" />Ø­ÙˆØ§Ø¯Ø« Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
                </h4>
              </div>
              <div className="divide-y divide-slate-100">
                {incidents.filter(i => !i.ncaReported).map(inc => {
                  const hoursRemaining = Math.round((new Date(inc.ncaReportDeadline) - new Date()) / (1000 * 60 * 60));
                  const isUrgent = hoursRemaining < 24;
                  const isOverdue = hoursRemaining < 0;

                  return (
                    <div key={inc.id} className={`p-5 ${isOverdue ? 'bg-red-50' : isUrgent ? 'bg-amber-50' : ''}`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <span className="text-2xl">{INCIDENT_TYPES.find(t => t.id === inc.type)?.icon}</span>
                          <div>
                            <div className="flex items-center gap-2">
                              <p className="font-mono text-sm text-slate-500">{inc.id}</p>
                              {isOverdue && <span className="px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold">Ù…ØªØ£Ø®Ø±!</span>}
                              {!isOverdue && isUrgent && <span className="px-2 py-0.5 bg-amber-500 text-white text-xs rounded-full font-bold">Ø¹Ø§Ø¬Ù„</span>}
                            </div>
                            <h5 className="font-bold text-slate-800">{inc.title}</h5>
                            <p className="text-sm text-slate-500">
                              {isOverdue ? `Ù…ØªØ£Ø®Ø± Ø¨Ù€ ${Math.abs(hoursRemaining)} Ø³Ø§Ø¹Ø©` : `Ù…ØªØ¨Ù‚ÙŠ ${hoursRemaining} Ø³Ø§Ø¹Ø©`}
                            </p> </div> </div>
                        <div className="flex gap-2">
                          <button onClick={() => { setSelectedIncident(inc); setShowNCAReportModal(true); }}
                            className="px-4 py-2 bg-purple-500 text-white rounded-xl font-bold text-sm hover:bg-purple-600 flex items-center gap-2">
                            <Send className="w-4 h-4" />Ø¥Ø¨Ù„Ø§Øº NCA
                          </button>
                          <button onClick={() => { setSelectedIncident(inc); setShowSAMAReportModal(true); }}
                            className="px-4 py-2 bg-emerald-500 text-white rounded-xl font-bold text-sm hover:bg-emerald-600 flex items-center gap-2">
                            <Send className="w-4 h-4" />Ø¥Ø¨Ù„Ø§Øº SAMA
                          </button> </div> </div> </div>);
                })}
                {incidents.filter(i => !i.ncaReported).length === 0 && (
                  <div className="p-8 text-center">
                    <CheckCircle2 className="w-12 h-12 text-emerald-300 mx-auto mb-2" />
                    <p className="text-slate-500">ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« âœ“</p>
                  </div>
                )}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-indigo-50 border-b border-indigo-200">
                <h4 className="font-bold text-indigo-800 flex items-center gap-2">
                  <FileText className="w-5 h-5" />Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø³Ù„Ø© ({regulatoryReports.length})
                </h4>
              </div>

              <div className="p-4 bg-slate-50 border-b border-slate-200 flex items-center gap-4">
                <div className="flex items-center gap-2">
                  <span className="text-sm font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©:</span>
                  <button onClick={() => setFilterType('')} className={`px-3 py-1 rounded-lg text-sm font-bold ${!filterType ? 'bg-indigo-500 text-white' : 'bg-white text-slate-600 border'}`}>Ø§Ù„ÙƒÙ„</button>
                  <button onClick={() => setFilterType('NCA')} className={`px-3 py-1 rounded-lg text-sm font-bold ${filterType === 'NCA' ? 'bg-purple-500 text-white' : 'bg-white text-slate-600 border'}`}>NCA</button>
                  <button onClick={() => setFilterType('SAMA')} className={`px-3 py-1 rounded-lg text-sm font-bold ${filterType === 'SAMA' ? 'bg-emerald-500 text-white' : 'bg-white text-slate-600 border'}`}>SAMA</button>
                </div> </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¬Ù‡Ø©</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø±Ø¯</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr> </thead>
                  <tbody className="divide-y divide-slate-100">
                    {regulatoryReports.filter(r => !filterType || r.authority === filterType).map(report => (
                      <tr key={report.id} className="hover:bg-slate-50 transition-colors">
                        <td className="px-4 py-3">
                          <span className="font-mono text-sm text-indigo-600 font-bold">{report.referenceNumber}</span>
                        </td>
                        <td className="px-4 py-3 font-mono text-sm">{report.incidentId}</td>
                        <td className="px-4 py-3">
                          <span className={`px-3 py-1.5 rounded-xl text-xs font-bold ${report.authority === 'NCA' ? 'bg-purple-100 text-purple-700' : 'bg-emerald-100 text-emerald-700'
                            }`}>{report.authority}</span>
                        </td>
                        <td className="px-4 py-3">
                          <span className={`text-sm font-bold ${report.reportType === 'initial' ? 'text-blue-600' :
                            report.reportType === 'update' ? 'text-amber-600' : 'text-emerald-600'
                            }`}>
                            {report.reportType === 'initial' ? 'Ø£ÙˆÙ„ÙŠ' : report.reportType === 'update' ? 'ØªØ­Ø¯ÙŠØ«' : 'Ù†Ù‡Ø§Ø¦ÙŠ'}
                          </span> </td>
                        <td className="px-4 py-3 text-sm">{new Date(report.submittedDate).toLocaleDateString('ar-SA')}</td>
                        <td className="px-4 py-3">
                          <span className={`px-3 py-1.5 rounded-xl text-xs font-bold border ${getReportStatusColor(report.status)}`}>
                            {getReportStatusLabel(report.status)}
                          </span> </td>
                        <td className="px-4 py-3 text-sm max-w-[200px]">
                          {report.response ? (
                            <span className="text-slate-600 truncate block" title={report.response}>{report.response.substring(0, 40)}...</span>
                          ) : (
                            <span className="text-slate-400">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</span>
                          )}
                        </td>
                        <td className="px-4 py-3">
                          <div className="flex items-center justify-center gap-1">
                            <button onClick={() => handleViewReport(report)} title="Ø§Ø³ØªØ¹Ø±Ø§Ø¶"
                              className="p-2 hover:bg-blue-50 rounded-lg text-blue-500 transition-colors">
                              <Eye className="w-4 h-4" />
                            </button>
                            <button onClick={() => handleEditReportOpen(report)} title="ØªØ¹Ø¯ÙŠÙ„"
                              className="p-2 hover:bg-amber-50 rounded-lg text-amber-500 transition-colors">
                              <Edit className="w-4 h-4" />
                            </button>
                            <button onClick={() => handleDeleteReportConfirm(report)} title="Ø­Ø°Ù"
                              className="p-2 hover:bg-red-50 rounded-lg text-red-500 transition-colors">
                              <Trash2 className="w-4 h-4" />
                            </button> </div> </td> </tr>
                    ))}
                  </tbody> </table> </div>
              <div className="p-4 bg-slate-50 border-t border-slate-200 grid grid-cols-4 gap-4">
                <div className="text-center">
                  <p className="text-2xl font-bold text-purple-600">{regulatoryReports.filter(r => r.authority === 'NCA').length}</p>
                  <p className="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± NCA</p>
                </div>
                <div className="text-center">
                  <p className="text-2xl font-bold text-emerald-600">{regulatoryReports.filter(r => r.authority === 'SAMA').length}</p>
                  <p className="text-xs text-slate-500">ØªÙ‚Ø§Ø±ÙŠØ± SAMA</p>
                </div>
                <div className="text-center">
                  <p className="text-2xl font-bold text-blue-600">{regulatoryReports.filter(r => r.status === 'Submitted').length}</p>
                  <p className="text-xs text-slate-500">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</p>
                </div>
                <div className="text-center">
                  <p className="text-2xl font-bold text-slate-600">{regulatoryReports.filter(r => r.status === 'Closed').length}</p>
                  <p className="text-xs text-slate-500">Ù…ÙØºÙ„Ù‚</p>
                </div> </div> </div> </div>
        )}

        {activeTab === 'analytics' && (
          <div className="p-6 space-y-6">
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-5 text-white">
                <Clock className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{analytics.mttd}h</p>
                <p className="font-bold">MTTD</p>
                <p className="text-blue-100 text-sm">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
                <Zap className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{analytics.mttr}h</p>
                <p className="font-bold">MTTR</p>
                <p className="text-emerald-100 text-sm">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-5 text-white">
                <TrendingUp className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{incidents.filter(i => ['Closed', 'Reported'].includes(i.status)).length}</p>
                <p className="font-bold">ØªÙ… Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</p>
                <p className="text-purple-100 text-sm">Ø­ÙˆØ§Ø¯Ø« Ù…ØºÙ„Ù‚Ø©</p>
              </div>
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
                <AlertTriangle className="w-8 h-8 text-white/80 mb-2" />
                <p className="text-3xl font-black">{incidents.filter(i => i.severity === 'Critical' && !['Closed', 'Reported'].includes(i.status)).length}</p>
                <p className="font-bold">Ø­Ø±Ø¬ Ù†Ø´Ø·</p>
                <p className="text-amber-100 text-sm">ÙŠØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù… ÙÙˆØ±ÙŠ</p>
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
              <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                <BarChart3 className="w-5 h-5 text-indigo-500" />Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« (Ø¢Ø®Ø± 6 Ø£Ø´Ù‡Ø±)
              </h4>
              <div className="flex items-end justify-between gap-4 h-48">
                {analytics.monthlyTrends.map((month, idx) => {
                  const maxTotal = Math.max(...analytics.monthlyTrends.map(m => m.total), 1);
                  const heightPercent = (month.total / maxTotal) * 100;
                  return (
                    <div key={idx} className="flex-1 flex flex-col items-center">
                      <div className="w-full flex flex-col items-center gap-1" style={{ height: '160px', justifyContent: 'flex-end' }}>
                        {month.total > 0 && (
                          <div className="w-full rounded-t-lg overflow-hidden" style={{ height: `${heightPercent}%`, minHeight: '20px' }}>
                            <div className="h-full flex flex-col">
                              {month.critical > 0 && <div className="bg-red-500" style={{ height: `${(month.critical / month.total) * 100}%` }} />}
                              {month.high > 0 && <div className="bg-orange-500" style={{ height: `${(month.high / month.total) * 100}%` }} />}
                              <div className="bg-blue-300 flex-1" />
                            </div> </div>
                        )}
                      </div>
                      <p className="text-xs text-slate-500 mt-2">{month.month}</p>
                      <p className="text-sm font-bold text-slate-700">{month.total}</p>
                    </div>);
                })}
              </div>
              <div className="flex items-center justify-center gap-6 mt-4">
                <span className="flex items-center gap-2 text-sm"><span className="w-3 h-3 bg-red-500 rounded" />Ø­Ø±Ø¬</span>
                <span className="flex items-center gap-2 text-sm"><span className="w-3 h-3 bg-orange-500 rounded" />Ø¹Ø§Ù„ÙŠ</span>
                <span className="flex items-center gap-2 text-sm"><span className="w-3 h-3 bg-blue-300 rounded" />Ø£Ø®Ø±Ù‰</span>
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
              <h4 className="font-bold text-slate-800 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h4>
              <div className="space-y-3">
                {analytics.byType.map(type => (
                  <div key={type.id} className="flex items-center gap-4">
                    <span className="text-2xl w-10">{type.icon}</span>
                    <div className="flex-1">
                      <div className="flex items-center justify-between mb-1">
                        <span className="font-bold text-slate-700">{type.name}</span>
                        <span className="text-sm text-slate-500">{type.count} Ø­Ø§Ø¯Ø«Ø© ({incidents.length > 0 ? Math.round((type.count / incidents.length) * 100) : 0}%)</span>
                      </div>
                      <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div className={`h-full bg-${type.color}-500 rounded-full transition-all`}
                          style={{ width: `${incidents.length > 0 ? (type.count / incidents.length) * 100 : 0}%` }} />
                      </div> </div> </div>
                ))}
              </div> </div> </div>
        )}

        {activeTab === 'lessons' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <Lightbulb className="w-5 h-5 text-amber-500" />Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© ÙˆØ®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†
              </h3>
              <button onClick={() => { resetLessonForm(); setShowLessonModal(true); }}
                className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600">
                <Plus className="w-4 h-4" />Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ù…Ø³ØªÙØ§Ø¯
              </button> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <p className="text-2xl font-bold text-emerald-600">{lessonsLearned.filter(l => l.status === 'Implemented').length}</p>
                <p className="text-sm text-emerald-700">Ù…ÙØ·Ø¨Ù‚</p>
              </div>
              <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                <p className="text-2xl font-bold text-blue-600">{lessonsLearned.filter(l => l.status === 'InProgress').length}</p>
                <p className="text-sm text-blue-700">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <p className="text-2xl font-bold text-amber-600">{lessonsLearned.filter(l => l.status === 'Pending').length}</p>
                <p className="text-sm text-amber-700">Ù…Ø¹Ù„Ù‚</p>
              </div>
              <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                <p className="text-2xl font-bold text-purple-600">{lessonsLearned.length}</p>
                <p className="text-sm text-purple-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
              </div> </div>
            <div className="space-y-4">
              {lessonsLearned.map(lesson => (
                <div key={lesson.id} className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
                  <div className={`px-5 py-3 border-b flex items-center justify-between ${lesson.status === 'Implemented' ? 'bg-emerald-50 border-emerald-200' :
                    lesson.status === 'InProgress' ? 'bg-blue-50 border-blue-200' :
                      'bg-amber-50 border-amber-200'
                    }`}>
                    <div className="flex items-center gap-3">
                      <span className="font-mono text-sm">{lesson.incidentId}</span>
                      <span className={`px-2 py-1 rounded-lg text-xs font-bold ${lesson.priority === 'Critical' ? 'bg-red-100 text-red-700' :
                        lesson.priority === 'High' ? 'bg-orange-100 text-orange-700' :
                          lesson.priority === 'Medium' ? 'bg-amber-100 text-amber-700' :
                            'bg-blue-100 text-blue-700'
                        }`}>{lesson.priority === 'Critical' ? 'Ø­Ø±Ø¬' : lesson.priority === 'High' ? 'Ø¹Ø§Ù„ÙŠ' : lesson.priority === 'Medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}</span>
                      <span className={`px-2 py-1 rounded-lg text-xs font-bold ${lesson.status === 'Implemented' ? 'bg-emerald-100 text-emerald-700' :
                        lesson.status === 'InProgress' ? 'bg-blue-100 text-blue-700' :
                          'bg-amber-100 text-amber-700'
                        }`}>{lesson.status === 'Implemented' ? 'Ù…ÙØ·Ø¨Ù‚ âœ“' : lesson.status === 'InProgress' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' : 'Ù…Ø¹Ù„Ù‚'}</span>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={() => { setSelectedLesson(lesson); setLessonFormData(lesson); setShowEditLessonModal(true); }}
                        className="p-2 hover:bg-white/50 rounded-lg"><Edit className="w-4 h-4 text-slate-500" /></button>
                      <button onClick={() => { setSelectedLesson(lesson); setShowDeleteLessonModal(true); }}
                        className="p-2 hover:bg-white/50 rounded-lg"><Trash2 className="w-4 h-4 text-red-500" /></button>
                    </div> </div>
                  <div className="p-5">
                    <div className="grid grid-cols-2 gap-6">
                      <div>
                        <p className="text-xs text-slate-500 mb-1">Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯</p>
                        <p className="font-bold text-slate-800">{lesson.lesson}</p>
                      </div>
                      <div>
                        <p className="text-xs text-slate-500 mb-1">Ø§Ù„ØªÙˆØµÙŠØ©</p>
                        <p className="text-slate-700">{lesson.recommendation}</p>
                      </div> </div>
                    <div className="mt-4 flex items-center justify-between">
                      <div className="flex items-center gap-4 text-sm text-slate-500">
                        <span>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {lesson.assignedTo}</span>
                        <span>Ø§Ù„Ù…ÙˆØ¹Ø¯: {lesson.dueDate}</span>
                      </div>
                      {lesson.status !== 'Implemented' && (
                        <div className="flex items-center gap-2">
                          <div className="w-32 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div className="h-full bg-blue-500 rounded-full" style={{ width: `${lesson.progress}%` }} />
                          </div>
                          <span className="text-sm font-bold">{lesson.progress}%</span>
                          {lesson.status === 'Pending' && (
                            <button onClick={() => updateLessonStatus(lesson.id, 'InProgress', 10)}
                              className="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm font-bold">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</button>
                          )}
                          {lesson.status === 'InProgress' && (
                            <button onClick={() => updateLessonStatus(lesson.id, 'Implemented', 100)}
                              className="px-3 py-1 bg-emerald-500 text-white rounded-lg text-sm font-bold">Ø¥ÙƒÙ…Ø§Ù„</button>
                          )}
                        </div>
                      )}
                    </div> </div> </div>
              ))}
            </div> </div>
        )}

        {activeTab === 'links' && (
          <div className="p-6 space-y-6">
            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
              <Link2 className="w-5 h-5 text-indigo-500" />Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
            </h3>

            <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
              <div className="px-6 py-4 bg-blue-50 border-b border-blue-200 flex items-center justify-between">
                <h4 className="font-bold text-blue-800 flex items-center gap-2">
                  <Database className="w-5 h-5" />Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ({linkedAssets.length})
                </h4>
              </div>
              <div className="divide-y divide-slate-100">
                {linkedAssets.map((link, idx) => (
                  <div key={idx} className="p-4 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Database className="w-5 h-5 text-blue-500" />
                      <div>
                        <p className="font-bold text-slate-800">{link.assetName}</p>
                        <p className="text-sm text-slate-500">{link.assetType} â€¢ {link.incidentId}</p>
                      </div> </div>
                    <div className="flex items-center gap-2">
                      <span className={`px-2 py-1 rounded-lg text-xs font-bold ${link.criticality === 'Critical' ? 'bg-red-100 text-red-700' :
                        link.criticality === 'High' ? 'bg-orange-100 text-orange-700' :
                          'bg-blue-100 text-blue-700'
                        }`}>{link.criticality}</span>
                      <button onClick={() => unlinkAsset(link.incidentId, link.assetId)}
                        className="p-1 hover:bg-red-50 rounded"><Trash2 className="w-4 h-4 text-red-500" /></button>
                    </div> </div>
                ))}
                {linkedAssets.length === 0 && (
                  <div className="p-8 text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆÙ„ Ù…Ø±ØªØ¨Ø·Ø©</div>
                )}
              </div> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
              <h4 className="font-bold text-slate-800 mb-4">Ø±Ø¨Ø· Ø£ØµÙ„ Ø¨Ø­Ø§Ø¯Ø«Ø©</h4>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</label>
                  <select id="linkIncidentSelect" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</option>
                    {incidents.map(inc => (
                      <option key={inc.id} value={inc.id}>{inc.id} - {inc.title}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ØµÙ„</label>
                  <select id="linkAssetSelect" className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£ØµÙ„</option>
                    {availableAssets.map(asset => (
                      <option key={asset.id} value={asset.id}>{asset.name} ({asset.type})</option>
                    ))}
                  </select>
                </div> </div>
              <button onClick={() => {
                const incidentId = document.getElementById('linkIncidentSelect').value;
                const assetId = document.getElementById('linkAssetSelect').value;
                const asset = availableAssets.find(a => a.id === assetId);
                if (incidentId && asset) {
                  linkAsset(incidentId, asset);
                } else {
                  showNotificationMsg('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø£ØµÙ„', 'error');
                }
              }} className="mt-4 px-6 py-3 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600">
                Ø±Ø¨Ø· Ø§Ù„Ø£ØµÙ„
              </button> </div> </div>
        )}

        {activeTab === 'pending' && (
          <div className="p-6 space-y-4">
            <div className="bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 flex items-center gap-4">
              <Clock className="w-10 h-10 text-amber-500" />
              <div>
                <h3 className="font-bold text-amber-800">Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h3>
                <p className="text-amber-600">ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø© ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª NCA</p>
              </div> </div>
            <div className="space-y-3">
              {incidents.filter(i => !i.ncaReported).map(inc => {
                const timeRemaining = getReportTimeRemaining(inc.ncaReportDeadline);
                const typeConfig = INCIDENT_TYPES.find(t => t.id === inc.type);
                const severityConfig = SEVERITY_LEVELS[inc.severity];
                return (
                  <div key={inc.id} className={`bg-white rounded-2xl border-2 p-5 ${timeRemaining.urgent ? `border-${timeRemaining.color}-400` : 'border-slate-200'}`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <span className="text-3xl">{typeConfig?.icon}</span>
                        <div>
                          <div className="flex items-center gap-2">
                            <span className="font-mono text-sm text-slate-500">{inc.id}</span>
                            <span className="text-xl">{severityConfig.icon}</span>
                          </div>
                          <h4 className="font-bold text-slate-800">{inc.title}</h4>
                          <p className="text-sm text-slate-500">Ø§Ù„Ø¬Ù‡Ø©: {inc.authority} â€¢ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {inc.assignedTo}</p>
                        </div> </div>
                      <div className="flex items-center gap-4">
                        <div className={`text-center p-4 rounded-xl bg-${timeRemaining.color}-50 border-2 border-${timeRemaining.color}-200`}>
                          <p className="text-xs text-slate-500">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>
                          <p className={`text-2xl font-black text-${timeRemaining.color}-600`}>{timeRemaining.text}</p>
                        </div>
                        <button onClick={() => openReportModal(inc)} className={`px-6 py-3 rounded-xl font-bold text-white ${timeRemaining.color === 'red' ? 'bg-red-500 hover:bg-red-600 animate-pulse' : 'bg-indigo-500 hover:bg-indigo-600'
                          }`}>
                          <Send className="w-5 h-5 inline ml-2" />Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¢Ù†
                        </button> </div> </div> </div>);
              })}
              {incidents.filter(i => !i.ncaReported).length === 0 && (
                <div className="text-center py-12">
                  <CheckCircle2 className="w-16 h-16 text-emerald-300 mx-auto mb-4" />
                  <h3 className="text-xl font-bold text-slate-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙˆØ§Ø¯Ø« Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</h3>
                  <p className="text-slate-500">ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</p>
                </div>
              )}
            </div> </div>
        )}

        {activeTab === 'timeline' && (
          <div className="p-6">
            <div className="space-y-4">
              {incidents.flatMap(inc => inc.timeline.map(t => ({ ...t, incidentId: inc.id, incidentTitle: inc.title })))
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 20)
                .map((event, idx) => (
                  <div key={idx} className="flex items-start gap-4">
                    <div className="flex flex-col items-center">
                      <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center">
                        <Activity className="w-5 h-5 text-red-600" />
                      </div>
                      {idx < 19 && <div className="w-0.5 h-12 bg-slate-200 mt-2" />}
                    </div>
                    <div className="flex-1 bg-white rounded-xl p-4 border border-slate-200">
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-mono text-sm text-red-600">{event.incidentId}</span>
                        <span className="text-sm text-slate-500">{new Date(event.date).toLocaleString('ar-SA')}</span>
                      </div>
                      <p className="font-bold text-slate-800">{event.action}</p>
                      <p className="text-sm text-slate-500">Ø¨ÙˆØ§Ø³Ø·Ø©: {event.user} â€¢ {event.incidentTitle}</p>
                    </div> </div>
                ))}
            </div> </div>
        )}

        {activeTab === 'reports' && (
          <div className="p-6 space-y-6">
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5 text-slate-500" />ØªÙ‚Ø±ÙŠØ± Ù…Ù„Ø®Øµ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
                </h4>
                <div className="space-y-3">
                  <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                    <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« (Ø¢Ø®Ø± 30 ÙŠÙˆÙ…)</span>
                    <span className="font-bold">{stats.last30Days}</span>
                  </div>
                  <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                    <span>Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø­Ø±Ø¬Ø©</span>
                    <span className="font-bold text-red-600">{stats.bySeverity.find(s => s.severity === 'Critical')?.count || 0}</span>
                  </div>
                  <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                    <span>Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
                    <span className="font-bold">{stats.avgResolutionTime}</span>
                  </div>
                  <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                    <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙÙŠ Ø§Ù„ÙˆÙ‚Øª</span>
                    <span className="font-bold text-emerald-600">85%</span>
                  </div> </div>
                <button className="w-full mt-4 py-3 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 flex items-center justify-center gap-2">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button> </div>
              <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border-2 border-indigo-200 p-6">
                <h4 className="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                  <Shield className="w-5 h-5" />ØªÙ‚Ø±ÙŠØ± NCA Ø§Ù„Ø´Ù‡Ø±ÙŠ
                </h4>
                <div className="space-y-3">
                  <div className="flex justify-between p-3 bg-white rounded-lg">
                    <span>Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡Ø§</span>
                    <span className="font-bold text-indigo-600">{incidents.filter(i => i.ncaReported).length}</span>
                  </div>
                  <div className="flex justify-between p-3 bg-white rounded-lg">
                    <span>Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº</span>
                    <span className="font-bold">24 Ø³Ø§Ø¹Ø©</span>
                  </div>
                  <div className="flex justify-between p-3 bg-white rounded-lg">
                    <span>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù€ 72 Ø³Ø§Ø¹Ø©</span>
                    <span className="font-bold text-emerald-600">100%</span>
                  </div> </div>
                <button className="w-full mt-4 py-3 bg-indigo-500 text-white rounded-xl font-bold hover:bg-indigo-600 flex items-center justify-center gap-2">
                  <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ NCA
                </button> </div> </div> </div>
        )}
      </div>

      {(showAddModal || showEditModal) && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => { setShowAddModal(false); setShowEditModal(false); }}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
            <div className={`relative overflow-hidden ${showEditModal ? 'bg-gradient-to-r from-amber-500 to-orange-600' : 'bg-gradient-to-r from-red-500 to-rose-600'}`}>
              <div className="absolute inset-0 opacity-20">
                <div className="absolute top-0 left-0 w-40 h-40 bg-white rounded-full -translate-x-1/2 -translate-y-1/2" />
              </div>

              <div className="relative px-8 py-6 flex items-center justify-between">
                <div className="flex items-center gap-5">
                  <div className="w-16 h-16 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center">
                    {showEditModal ? <Edit className="w-8 h-8 text-white" /> : <Zap className="w-8 h-8 text-white" />}
                  </div>
                  <div className="text-white">
                    <h2 className="text-2xl font-black">{showEditModal ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©' : 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­Ø§Ø¯Ø«Ø© Ø£Ù…Ù†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©'}</h2>
                    <p className="opacity-80">Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ù…Ù‡Ù„Ø© Ø§Ù„Ù€ 72 Ø³Ø§Ø¹Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ NCA ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                  </div> </div>
                <button onClick={() => { setShowAddModal(false); setShowEditModal(false); resetForm(); }} className="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center text-white">
                  <X className="w-6 h-6" />
                </button> </div>
              <div className="relative px-8 pb-6">
                <div className="flex items-center justify-between">
                  {[
                    { num: 1, title: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', icon: FileText },
                    { num: 2, title: 'Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ø®Ø·ÙˆØ±Ø©', icon: AlertTriangle },
                    { num: 3, title: 'Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©', icon: Layers },
                    { num: 4, title: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø­ÙØ¸', icon: CheckCircle2 },
                  ].map((step, idx) => (
                    <div key={step.num} className="flex items-center flex-1">
                      <button onClick={() => setWizardStep(step.num)} className={`flex flex-col items-center transition-all ${wizardStep >= step.num ? 'opacity-100' : 'opacity-50'}`}>
                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center mb-2 ${wizardStep === step.num ? 'bg-white text-red-600 shadow-lg' : wizardStep > step.num ? 'bg-white/30 text-white' : 'bg-white/10 text-white/60'}`}>
                          {wizardStep > step.num ? <CheckCircle2 className="w-6 h-6" /> : <step.icon className="w-6 h-6" />}
                        </div>
                        <span className={`text-sm font-bold ${wizardStep === step.num ? 'text-white' : 'text-white/70'}`}>{step.title}</span>
                      </button>
                      {idx < 3 && <div className={`flex-1 h-1 mx-3 rounded-full ${wizardStep > step.num ? 'bg-white/50' : 'bg-white/20'}`} />}
                    </div>
                  ))}
                </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-8">
              {wizardStep === 1 && (
                <div className="space-y-6">
                  <div className="bg-red-50 rounded-2xl p-6 border-2 border-red-200">
                    <h3 className="text-xl font-black text-red-800 mb-2 flex items-center gap-3">
                      <FileText className="w-6 h-6" />Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø­Ø§Ø¯Ø«Ø©
                    </h3>
                    <p className="text-red-600">Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©</p>
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-3">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ø¯Ø«Ø© *</label>
                    <input type="text" value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })}
                      placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø­Ø§Ø¯Ø«Ø©..." className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl text-lg outline-none focus:border-red-400" />
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-3">ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ *</label>
                    <textarea value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })}
                      rows={4} placeholder="Ø§Ø´Ø±Ø­ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„: Ù…Ø§Ø°Ø§ Ø­Ø¯Ø«ØŸ ÙƒÙŠÙ ØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡Ø§ØŸ Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø­ØªÙ…Ù„ØŸ"
                      className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400 resize-none" />
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3">ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø§ÙƒØªØ´Ø§Ù *</label>
                      <input type="datetime-local" value={formData.detectedDate} onChange={e => setFormData({ ...formData, detectedDate: e.target.value })}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400" />
                    </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3">Ù…Ù† Ø§ÙƒØªØ´Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø© *</label>
                      <input type="text" value={formData.reportedBy} onChange={e => setFormData({ ...formData, reportedBy: e.target.value })}
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…..." className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400" />
                    </div> </div> </div>
              )}

              {wizardStep === 2 && (
                <div className="space-y-6">
                  <div className="bg-amber-50 rounded-2xl p-6 border-2 border-amber-200">
                    <h3 className="text-xl font-black text-amber-800 mb-2 flex items-center gap-3">
                      <AlertTriangle className="w-6 h-6" />ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©
                    </h3>
                    <p className="text-amber-600">Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</p>
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© *</label>
                    <div className="grid grid-cols-5 gap-3">
                      {INCIDENT_TYPES.map(type => (
                        <button key={type.id} onClick={() => setFormData({ ...formData, type: type.id })}
                          className={`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${formData.type === type.id ? `bg-${type.color}-50 border-${type.color}-400 shadow-lg` : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <span className="text-3xl">{type.icon}</span>
                          <span className="text-sm font-bold text-slate-700">{type.name}</span>
                        </button>
                      ))}
                    </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø© *</label>
                    <div className="grid grid-cols-4 gap-4">
                      {Object.entries(SEVERITY_LEVELS).map(([key, config]) => (
                        <button key={key} onClick={() => setFormData({ ...formData, severity: key })}
                          className={`p-5 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${formData.severity === key ? `bg-${config.color}-50 border-${config.color}-400 shadow-lg scale-105` : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          <span className="text-4xl">{config.icon}</span>
                          <span className="text-lg font-bold text-slate-800">{config.label}</span>
                          <span className="text-xs text-slate-500">SLA: {config.sla} Ø³Ø§Ø¹Ø©</span>
                        </button>
                      ))}
                    </div> </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø­Ø§Ø¯Ø«Ø© *</label>
                      <select value={formData.assignedTo} onChange={e => setFormData({ ...formData, assignedTo: e.target.value })}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„...</option>
                        <option value="Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯</option>
                        <option value="Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ">Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ</option>
                        <option value="Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ">Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ</option>
                        <option value="Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ">Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ</option>
                        <option value="Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ">Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±ÙŠ</option>
                      </select>
                    </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                      <select value={formData.authority} onChange={e => setFormData({ ...formData, authority: e.target.value })}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400">
                        <option value="NCA">NCA - Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</option>
                        <option value="SAMA">SAMA - Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
                        <option value="SDAIA">SDAIA - Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                      </select>
                    </div> </div> </div>
              )}

              {wizardStep === 3 && (
                <div className="space-y-6">
                  <div className="bg-blue-50 rounded-2xl p-6 border-2 border-blue-200">
                    <h3 className="text-xl font-black text-blue-800 mb-2 flex items-center gap-3">
                      <Layers className="w-6 h-6" />Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
                    </h3>
                    <p className="text-blue-600">Ø­Ø¯Ø¯ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ† Ø¨Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</p>
                  </div>

                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-4">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                    <div className="grid grid-cols-3 gap-3">
                      {['Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'Ù†Ø¸Ø§Ù… CRM', 'Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø¹Ù…Ù„', 'Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†', 'Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ù†Ø¸Ø§Ù… ERP', 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'].map(sys => (
                        <button key={sys} onClick={() => setFormData({ ...formData, affectedSystems: formData.affectedSystems.includes(sys) ? formData.affectedSystems.filter(s => s !== sys) : [...formData.affectedSystems, sys] })}
                          className={`p-3 rounded-xl border-2 font-bold text-sm transition-all ${formData.affectedSystems.includes(sys) ? 'bg-blue-50 border-blue-400 text-blue-700' : 'border-slate-200 text-slate-600 hover:border-slate-300'
                            }`}>
                          {formData.affectedSystems.includes(sys) && <CheckCircle2 className="w-4 h-4 inline ml-1" />}
                          {sys}
                        </button>
                      ))}
                    </div> </div>
                  <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <label className="block text-sm font-bold text-slate-700 mb-3">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†</label>
                    <input type="number" value={formData.affectedUsers} onChange={e => setFormData({ ...formData, affectedUsers: parseInt(e.target.value) || 0 })}
                      min="0" className="w-full px-5 py-4 border-2 border-slate-200 rounded-xl outline-none focus:border-blue-400" />
                  </div> </div>
              )}

              {wizardStep === 4 && (
                <div className="space-y-6">
                  <div className="bg-emerald-50 rounded-2xl p-6 border-2 border-emerald-200">
                    <h3 className="text-xl font-black text-emerald-800 mb-2 flex items-center gap-3">
                      <CheckCircle2 className="w-6 h-6" />Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </h3>
                    <p className="text-emerald-600">Ø±Ø§Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸</p>
                  </div>

                  <div className="grid grid-cols-2 gap-6">
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</h4>
                      <div className="space-y-3">
                        <div className="flex justify-between py-2 border-b border-slate-100">
                          <span className="text-slate-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span>
                          <span className="font-bold text-slate-800">{formData.title || '-'}</span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-slate-100">
                          <span className="text-slate-500">Ø§Ù„Ù†ÙˆØ¹</span>
                          <span className="font-bold">{INCIDENT_TYPES.find(t => t.id === formData.type)?.icon} {INCIDENT_TYPES.find(t => t.id === formData.type)?.name || '-'}</span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-slate-100">
                          <span className="text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</span>
                          <span className="font-bold">{SEVERITY_LEVELS[formData.severity]?.icon} {SEVERITY_LEVELS[formData.severity]?.label}</span>
                        </div>
                        <div className="flex justify-between py-2">
                          <span className="text-slate-500">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
                          <span className="font-bold">{formData.assignedTo || '-'}</span>
                        </div> </div> </div>
                    <div className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                      <h4 className="font-bold text-slate-800 mb-4">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</h4>
                      <div className="flex flex-wrap gap-2 mb-4">
                        {formData.affectedSystems.map(sys => (
                          <span key={sys} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">{sys}</span>
                        ))}
                        {formData.affectedSystems.length === 0 && <span className="text-slate-400">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£Ù†Ø¸Ù…Ø©</span>}
                      </div>
                      <div className="p-4 bg-slate-50 rounded-xl">
                        <span className="text-slate-500">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ†: </span>
                        <span className="font-bold text-slate-800">{formData.affectedUsers}</span>
                      </div> </div> </div>
                  <div className="bg-indigo-50 rounded-2xl p-6 border-2 border-indigo-200">
                    <div className="flex items-center gap-4">
                      <Shield className="w-12 h-12 text-indigo-500" />
                      <div>
                        <h4 className="font-bold text-indigo-800">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ NCA</h4>
                        <p className="text-indigo-600">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ù‡Ù„Ø© 72 Ø³Ø§Ø¹Ø© Ù„Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</p>
                      </div> </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-100 px-8 py-5 flex items-center justify-between bg-slate-50">
              <button onClick={() => setWizardStep(Math.max(1, wizardStep - 1))} disabled={wizardStep === 1}
                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold ${wizardStep === 1 ? 'bg-slate-200 text-slate-400' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'}`}>
                <ChevronRight className="w-5 h-5" />Ø§Ù„Ø³Ø§Ø¨Ù‚
              </button>

              <div className="flex items-center gap-2">
                {[1, 2, 3, 4].map(step => (
                  <button key={step} onClick={() => setWizardStep(step)}
                    className={`w-3 h-3 rounded-full ${wizardStep === step ? 'bg-red-500 scale-125' : wizardStep > step ? 'bg-emerald-400' : 'bg-slate-300'}`} />
                ))}
              </div>

              {wizardStep < 4 ? (
                <button onClick={() => setWizardStep(wizardStep + 1)}
                  className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold hover:shadow-lg">
                  Ø§Ù„ØªØ§Ù„ÙŠ<ChevronLeft className="w-5 h-5" />
                </button>
              ) : (
                <button onClick={showEditModal ? handleEditIncident : handleAddIncident} disabled={isSubmitting || !formData.title || !formData.type}
                  className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold ${isSubmitting || !formData.title || !formData.type ? 'bg-slate-300 text-slate-500' : 'bg-gradient-to-r from-emerald-500 to-teal-600 text-white hover:shadow-lg'
                    }`}>
                  {isSubmitting ? <><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</> : <><Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</>}
                </button>
              )}
            </div> </div> </div>
      )}

      {showViewModal && selectedIncident && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowViewModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
            <div className={`relative overflow-hidden bg-gradient-to-r from-${SEVERITY_LEVELS[selectedIncident.severity].color}-500 to-${SEVERITY_LEVELS[selectedIncident.severity].color}-600`}>
              <div className="relative px-8 py-6 flex items-center justify-between">
                <div className="flex items-center gap-5">
                  <div className="w-16 h-16 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center text-4xl">
                    {INCIDENT_TYPES.find(t => t.id === selectedIncident.type)?.icon}
                  </div>
                  <div className="text-white">
                    <div className="flex items-center gap-3 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-1 rounded">{selectedIncident.id}</span>
                      <span className="text-2xl">{SEVERITY_LEVELS[selectedIncident.severity].icon}</span>
                    </div>
                    <h2 className="text-2xl font-black">{selectedIncident.title}</h2>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <span className={`px-4 py-2 rounded-xl font-bold bg-white/20`}>
                    {INCIDENT_STATUSES[selectedIncident.status].icon} {INCIDENT_STATUSES[selectedIncident.status].label}
                  </span>
                  <button onClick={() => setShowViewModal(false)} className="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center text-white">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="relative px-8 pb-4">
                <div className="flex gap-2">
                  {[
                    { id: 'details', label: 'Ø§Ù„ØªÙØ§ØµÙŠÙ„', icon: FileText },
                    { id: 'timeline', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ', icon: Clock },
                    { id: 'actions', label: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: Activity },
                  ].map(tab => (
                    <button key={tab.id} onClick={() => setViewTab(tab.id)}
                      className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 ${viewTab === tab.id ? 'bg-white text-slate-800' : 'bg-white/10 text-white hover:bg-white/20'}`}>
                      <tab.icon className="w-5 h-5" />{tab.label}
                    </button>
                  ))}
                </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-8">
              {viewTab === 'details' && (
                <div className="space-y-6">
                  <div className="bg-slate-50 rounded-2xl p-6">
                    <h4 className="font-bold text-slate-800 mb-3">Ø§Ù„ÙˆØµÙ</h4>
                    <p className="text-slate-600">{selectedIncident.description}</p>
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</p>
                      <p className="font-bold text-slate-800">{new Date(selectedIncident.detectedDate).toLocaleString('ar-SA')}</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">Ù…Ù† Ø§ÙƒØªØ´ÙÙ‡Ø§</p>
                      <p className="font-bold text-slate-800">{selectedIncident.reportedBy}</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>
                      <p className="font-bold text-slate-800">{selectedIncident.assignedTo}</p>
                    </div> </div>
                  <div className="bg-blue-50 rounded-2xl p-6 border border-blue-200">
                    <h4 className="font-bold text-blue-800 mb-3">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø© ({selectedIncident.affectedSystems.length})</h4>
                    <div className="flex flex-wrap gap-2">
                      {selectedIncident.affectedSystems.map(sys => (
                        <span key={sys} className="px-4 py-2 bg-white text-blue-700 rounded-xl font-bold border border-blue-200">{sys}</span>
                      ))}
                    </div>
                    <p className="mt-4 text-blue-600">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ†: <span className="font-bold">{selectedIncident.affectedUsers}</span></p>
                  </div>

                  <div className={`rounded-2xl p-6 border-2 ${selectedIncident.ncaReported ? 'bg-emerald-50 border-emerald-200' : 'bg-amber-50 border-amber-200'}`}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <Shield className={`w-12 h-12 ${selectedIncident.ncaReported ? 'text-emerald-500' : 'text-amber-500'}`} />
                        <div>
                          <h4 className={`font-bold ${selectedIncident.ncaReported ? 'text-emerald-800' : 'text-amber-800'}`}>
                            Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ù€ {selectedIncident.authority}
                          </h4>
                          <p className={selectedIncident.ncaReported ? 'text-emerald-600' : 'text-amber-600'}>
                            {selectedIncident.ncaReported ? 'ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­' : `Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${new Date(selectedIncident.ncaReportDeadline).toLocaleString('ar-SA')}`}
                          </p> </div> </div>
                      {!selectedIncident.ncaReported && (
                        <button onClick={() => { setShowViewModal(false); openReportModal(selectedIncident); }}
                          className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600">
                          <Send className="w-5 h-5 inline ml-2" />Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¢Ù†
                        </button>
                      )}
                    </div> </div> </div>
              )}

              {viewTab === 'timeline' && (
                <div className="space-y-4">
                  {selectedIncident.timeline.map((event, idx) => (
                    <div key={idx} className="flex items-start gap-4">
                      <div className="flex flex-col items-center">
                        <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center">
                          <Activity className="w-5 h-5 text-red-600" />
                        </div>
                        {idx < selectedIncident.timeline.length - 1 && <div className="w-0.5 h-12 bg-slate-200 mt-2" />}
                      </div>
                      <div className="flex-1 bg-slate-50 rounded-xl p-4">
                        <div className="flex items-center justify-between mb-2">
                          <span className="font-bold text-slate-800">{event.action}</span>
                          <span className="text-sm text-slate-500">{new Date(event.date).toLocaleString('ar-SA')}</span>
                        </div>
                        <p className="text-sm text-slate-500">Ø¨ÙˆØ§Ø³Ø·Ø©: {event.user}</p>
                      </div> </div>
                  ))}
                </div>
              )}

              {viewTab === 'actions' && (
                <div className="space-y-6">
                  <div className="bg-amber-50 rounded-2xl p-6 border border-amber-200">
                    <h4 className="font-bold text-amber-800 mb-3">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù…ØªØ®Ø°Ø©</h4>
                    <div className="space-y-2">
                      {selectedIncident.containmentActions?.map((action, idx) => (
                        <div key={idx} className="flex items-center gap-3 p-3 bg-white rounded-xl">
                          <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                          <span className="text-slate-700">{action}</span>
                        </div>
                      ))}
                    </div> </div>
                  {selectedIncident.rootCause && (
                    <div className="bg-red-50 rounded-2xl p-6 border border-red-200">
                      <h4 className="font-bold text-red-800 mb-3">Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ</h4>
                      <p className="text-slate-700">{selectedIncident.rootCause}</p>
                    </div>
                  )}

                  <div className="bg-slate-50 rounded-2xl p-6">
                    <h4 className="font-bold text-slate-800 mb-4">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</h4>
                    <div className="flex flex-wrap gap-2">
                      {Object.entries(INCIDENT_STATUSES).map(([key, config]) => (
                        <button key={key} onClick={() => updateIncidentStatus(selectedIncident.id, key)}
                          className={`px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 ${selectedIncident.status === key ? `bg-${config.color}-500 text-white` : `bg-white text-slate-600 border border-slate-200 hover:border-${config.color}-300`
                            }`}>
                          {config.icon} {config.label}
                        </button>
                      ))}
                    </div> </div> </div>
              )}
            </div>

            <div className="border-t-2 border-slate-100 px-8 py-5 flex items-center justify-between bg-slate-50">
              <button onClick={() => setShowViewModal(false)} className="px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300">Ø¥ØºÙ„Ø§Ù‚</button>
              <div className="flex gap-3">
                <button onClick={() => { setShowViewModal(false); openEditModal(selectedIncident); }}
                  className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold flex items-center gap-2 hover:bg-amber-600">
                  <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button className="px-6 py-3 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-bold flex items-center gap-2 hover:shadow-lg">
                  <Download className="w-5 h-5" />ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button> </div> </div> </div> </div>
      )}

      {showDeleteModal && selectedIncident && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowDeleteModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-red-500 to-rose-600 px-8 py-8 text-white text-center">
              <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-10 h-10" />
              </div>
              <h2 className="text-2xl font-black">ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</h2>
            </div>
            <div className="p-8 text-center">
              <p className="text-slate-600 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</p>
              <p className="text-xl font-black text-slate-800 mb-2">{selectedIncident.id}</p>
              <p className="text-slate-500">{selectedIncident.title}</p>
              <div className="mt-6 p-4 bg-red-50 rounded-xl border border-red-200">
                <p className="text-red-600 font-bold">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
              </div> </div>
            <div className="px-8 py-5 bg-slate-50 flex justify-center gap-4 border-t">
              <button onClick={() => setShowDeleteModal(false)} className="px-8 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleDeleteIncident} disabled={isSubmitting}
                className={`px-8 py-3 rounded-xl font-bold flex items-center gap-2 ${isSubmitting ? 'bg-slate-300 text-slate-500' : 'bg-red-500 text-white hover:bg-red-600'}`}>
                {isSubmitting ? <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" /> : <Trash2 className="w-5 h-5" />}
                {isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...' : 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù'}
              </button> </div> </div> </div>
      )}

      {showReportModal && selectedIncident && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowReportModal(false)}>
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden" onClick={e => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-indigo-500 to-purple-600 px-8 py-8 text-white text-center">
              <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <Shield className="w-10 h-10" />
              </div>
              <h2 className="text-2xl font-black">Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</h2>
              <p className="text-indigo-200 mt-2">{selectedIncident.authority}</p>
            </div>
            <div className="p-8">
              <div className="bg-indigo-50 rounded-xl p-4 mb-6">
                <p className="font-mono text-sm text-indigo-600">{selectedIncident.id}</p>
                <p className="font-bold text-slate-800">{selectedIncident.title}</p>
              </div>
              <div className="space-y-3 mb-6">
                <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                  <span className="text-slate-500">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</span>
                  <span className="font-bold">{INCIDENT_TYPES.find(t => t.id === selectedIncident.type)?.icon} {INCIDENT_TYPES.find(t => t.id === selectedIncident.type)?.name}</span>
                </div>
                <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                  <span className="text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</span>
                  <span className="font-bold">{SEVERITY_LEVELS[selectedIncident.severity]?.icon} {SEVERITY_LEVELS[selectedIncident.severity]?.label}</span>
                </div>
                <div className="flex justify-between p-3 bg-slate-50 rounded-lg">
                  <span className="text-slate-500">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</span>
                  <span className="font-bold">{selectedIncident.affectedSystems.length}</span>
                </div> </div>
              <div className="p-4 bg-amber-50 rounded-xl border border-amber-200 text-center">
                <p className="text-amber-700 font-bold">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø¥Ù„Ù‰ {selectedIncident.authority}</p>
                <p className="text-amber-600 text-sm">ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©</p>
              </div> </div>
            <div className="px-8 py-5 bg-slate-50 flex justify-center gap-4 border-t">
              <button onClick={() => setShowReportModal(false)} className="px-8 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleReportToNCA} disabled={isSubmitting}
                className={`px-8 py-3 rounded-xl font-bold flex items-center gap-2 ${isSubmitting ? 'bg-slate-300 text-slate-500' : 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white hover:shadow-lg'}`}>
                {isSubmitting ? <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" /> : <Send className="w-5 h-5" />}
                {isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'}
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          MODALS: Full CRUD Operations
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}

      {showTemplateModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <FileText className="w-6 h-6" />
                </div>
                <div>
                  <h2 className="text-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯</h2>
                  <p className="text-indigo-200 text-sm">Ø£Ù†Ø´Ø¦ Ù‚Ø§Ù„Ø¨Ø§Ù‹ Ù…Ø®ØµØµØ§Ù‹ Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«</p>
                </div> </div>
              <button onClick={() => setShowTemplateModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                <X className="w-6 h-6" />
              </button> </div>
            <div className="p-6 overflow-y-auto flex-1 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ *</label>
                  <input type="text" value={templateFormData.name} onChange={(e) => setTemplateFormData({ ...templateFormData, name: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø§Ù„Ø¨ Ù‡Ø¬Ù…Ø§Øª Ø§Ù„ÙØ¯ÙŠØ©" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© *</label>
                  <select value={templateFormData.type} onChange={(e) => setTemplateFormData({ ...templateFormData, type: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                    {INCIDENT_TYPES.map(t => <option key={t.id} value={t.id}>{t.icon} {t.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø´Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
                  <select value={templateFormData.defaultSeverity} onChange={(e) => setTemplateFormData({ ...templateFormData, defaultSeverity: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    {Object.entries(SEVERITY_LEVELS).map(([key, val]) => <option key={key} value={key}>{val.icon} {val.label}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                  <select value={templateFormData.defaultAuthority} onChange={(e) => setTemplateFormData({ ...templateFormData, defaultAuthority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="NCA">Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ (NCA)</option>
                    <option value="SAMA">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (SAMA)</option>
                    <option value="Both">ÙƒÙ„Ø§Ù‡Ù…Ø§</option>
                  </select>
                </div> </div>
              <div className="bg-orange-50 rounded-xl p-4 border border-orange-200">
                <h4 className="font-bold text-orange-800 mb-3 flex items-center gap-2">ğŸ›¡ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡</h4>
                <div className="space-y-2 mb-3">
                  {templateFormData.containmentChecklist.map(item => (
                    <div key={item.id} className="flex items-center gap-2 bg-white rounded-lg p-2">
                      <span className="flex-1 text-sm">{item.text}</span>
                      <button onClick={() => removeChecklistItem('containment', item.id)} className="text-red-500 hover:text-red-700"><X className="w-4 h-4" /></button>
                    </div>
                  ))}
                </div>
                <div className="flex gap-2">
                  <input type="text" value={newChecklistItem.containment} onChange={(e) => setNewChecklistItem({ ...newChecklistItem, containment: e.target.value })}
                    className="flex-1 px-3 py-2 border-2 border-orange-200 rounded-lg text-sm" placeholder="Ø£Ø¶Ù Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø­ØªÙˆØ§Ø¡..."
                    onKeyPress={(e) => e.key === 'Enter' && addChecklistItem('containment')} />
                  <button onClick={() => addChecklistItem('containment')} className="px-3 py-2 bg-orange-500 text-white rounded-lg"><Plus className="w-4 h-4" /></button>
                </div> </div>
              <div className="bg-red-50 rounded-xl p-4 border border-red-200">
                <h4 className="font-bold text-red-800 mb-3 flex items-center gap-2">ğŸ§¹ Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø©</h4>
                <div className="space-y-2 mb-3">
                  {templateFormData.eradicationChecklist.map(item => (
                    <div key={item.id} className="flex items-center gap-2 bg-white rounded-lg p-2">
                      <span className="flex-1 text-sm">{item.text}</span>
                      <button onClick={() => removeChecklistItem('eradication', item.id)} className="text-red-500 hover:text-red-700"><X className="w-4 h-4" /></button>
                    </div>
                  ))}
                </div>
                <div className="flex gap-2">
                  <input type="text" value={newChecklistItem.eradication} onChange={(e) => setNewChecklistItem({ ...newChecklistItem, eradication: e.target.value })}
                    className="flex-1 px-3 py-2 border-2 border-red-200 rounded-lg text-sm" placeholder="Ø£Ø¶Ù Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ø²Ø§Ù„Ø©..."
                    onKeyPress={(e) => e.key === 'Enter' && addChecklistItem('eradication')} />
                  <button onClick={() => addChecklistItem('eradication')} className="px-3 py-2 bg-red-500 text-white rounded-lg"><Plus className="w-4 h-4" /></button>
                </div> </div>
              <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <h4 className="font-bold text-emerald-800 mb-3 flex items-center gap-2">ğŸ”„ Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ¹Ø§ÙÙŠ</h4>
                <div className="space-y-2 mb-3">
                  {templateFormData.recoveryChecklist.map(item => (
                    <div key={item.id} className="flex items-center gap-2 bg-white rounded-lg p-2">
                      <span className="flex-1 text-sm">{item.text}</span>
                      <button onClick={() => removeChecklistItem('recovery', item.id)} className="text-red-500 hover:text-red-700"><X className="w-4 h-4" /></button>
                    </div>
                  ))}
                </div>
                <div className="flex gap-2">
                  <input type="text" value={newChecklistItem.recovery} onChange={(e) => setNewChecklistItem({ ...newChecklistItem, recovery: e.target.value })}
                    className="flex-1 px-3 py-2 border-2 border-emerald-200 rounded-lg text-sm" placeholder="Ø£Ø¶Ù Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¹Ø§ÙÙŠ..."
                    onKeyPress={(e) => e.key === 'Enter' && addChecklistItem('recovery')} />
                  <button onClick={() => addChecklistItem('recovery')} className="px-3 py-2 bg-emerald-500 text-white rounded-lg"><Plus className="w-4 h-4" /></button>
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowTemplateModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleAddTemplate} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨
              </button> </div> </div> </div>
      )}

      {showEditTemplateModal && selectedTemplate && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-5 text-white flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Edit className="w-6 h-6" /></div>
                <div>
                  <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨</h2>
                  <p className="text-amber-200 text-sm">{selectedTemplate.name}</p>
                </div> </div>
              <button onClick={() => setShowEditTemplateModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                <X className="w-6 h-6" />
              </button> </div>
            <div className="p-6 overflow-y-auto flex-1">
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨</label>
                  <input type="text" value={templateFormData.name} onChange={(e) => setTemplateFormData({ ...templateFormData, name: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø´Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
                  <select value={templateFormData.defaultSeverity} onChange={(e) => setTemplateFormData({ ...templateFormData, defaultSeverity: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    {Object.entries(SEVERITY_LEVELS).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                  </select>
                </div> </div>
              <p className="text-sm text-slate-500 mb-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª: Ø§Ø­ØªÙˆØ§Ø¡ ({templateFormData.containmentChecklist?.length || 0}) | Ø¥Ø²Ø§Ù„Ø© ({templateFormData.eradicationChecklist?.length || 0}) | ØªØ¹Ø§ÙÙŠ ({templateFormData.recoveryChecklist?.length || 0})</p>
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowEditTemplateModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleEditTemplate} className="flex items-center gap-2 px-8 py-3 bg-amber-500 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button> </div> </div> </div>
      )}

      {showDeleteTemplateModal && selectedTemplate && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div className="text-center">
              <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-8 h-8 text-red-500" />
              </div>
              <h3 className="text-xl font-bold text-slate-800 mb-2">Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨</h3>
              <p className="text-slate-600 mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‚Ø§Ù„Ø¨ "{selectedTemplate.name}"ØŸ</p>
              <div className="flex gap-3">
                <button onClick={() => setShowDeleteTemplateModal(false)} className="flex-1 px-4 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                <button onClick={handleDeleteTemplate} className="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-bold">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
              </div> </div> </div> </div>
      )}

      {showNCAReportModal && selectedIncident && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center font-bold text-xl">NCA</div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ø¯Ø«Ø© - Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</h2>
                    <p className="text-purple-200 text-sm">{selectedIncident.id} - {selectedIncident.title}</p>
                  </div> </div>
                <button onClick={() => setShowNCAReportModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div className="bg-purple-50 rounded-xl p-4 border border-purple-200">
                <p className="text-sm text-purple-800">ğŸ“‹ ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ© Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø© ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª NCA</p>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</label>
                  <input type="text" value={selectedIncident.id} readOnly className="w-full px-4 py-3 bg-slate-100 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± *</label>
                  <select value={ncaReportForm.reportType} onChange={(e) => setNcaReportForm({ ...ncaReportForm, reportType: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="initial">ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„ÙŠ (Initial)</option>
                    <option value="final">ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ (Final)</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ *</label>
                <input type="text" value={ncaReportForm.financialImpact} onChange={(e) => setNcaReportForm({ ...ncaReportForm, financialImpact: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ£Ø«ÙŠØ± Ù…Ø§Ù„ÙŠ / 50,000 Ø±ÙŠØ§Ù„" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ *</label>
                <textarea value={ncaReportForm.operationalImpact} onChange={(e) => setNcaReportForm({ ...ncaReportForm, operationalImpact: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="ÙˆØµÙ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª..." />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù…ØªØ®Ø°Ø©</label>
                <textarea value={ncaReportForm.containmentMeasures} onChange={(e) => setNcaReportForm({ ...ncaReportForm, containmentMeasures: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§ØªØ®Ø§Ø°Ù‡Ø§ Ù„Ù„Ø§Ø­ØªÙˆØ§Ø¡..." />
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowNCAReportModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={submitNCAReport} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-bold">
                <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button> </div> </div> </div>
      )}

      {showSAMAReportModal && selectedIncident && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center">
                    <span className="font-black text-2xl">Ø³Ø§Ù…Ø§</span>
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©</h2>
                    <p className="text-emerald-200">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ - SAMA Cybersecurity Incident Report</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <span className="px-3 py-1 bg-white/20 rounded-lg text-sm font-bold">{selectedIncident.id}</span>
                  <button onClick={() => { setShowSAMAReportModal(false); setSamaReportStep(1); }} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-6 h-6" />
                  </button> </div> </div>
              <div className="flex items-center justify-between mt-6 px-4">
                {[
                  { num: 1, title: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø©', icon: 'ğŸ“‹' },
                  { num: 2, title: 'ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', icon: 'ğŸ‘¥' },
                  { num: 3, title: 'Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ', icon: 'ğŸ’°' },
                  { num: 4, title: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ', icon: 'ğŸ”„' },
                  { num: 5, title: 'Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª', icon: 'ğŸ“' },
                ].map((step, idx) => (
                  <div key={step.num} className="flex items-center">
                    <div className={`flex flex-col items-center ${samaReportStep >= step.num ? 'text-white' : 'text-white/50'}`}>
                      <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold ${samaReportStep > step.num ? 'bg-white text-emerald-600' :
                        samaReportStep === step.num ? 'bg-white/30 border-2 border-white' :
                          'bg-white/10'
                        }`}>
                        {samaReportStep > step.num ? 'âœ“' : step.icon}
                      </div>
                      <span className="text-xs mt-1 font-bold">{step.title}</span>
                    </div>
                    {idx < 4 && <div className={`w-16 h-1 mx-2 rounded ${samaReportStep > step.num ? 'bg-white' : 'bg-white/20'}`} />}
                  </div>
                ))}
              </div> </div>
            <div className="flex-1 overflow-y-auto p-6">
              {samaReportStep === 1 && (
                <div className="space-y-6">
                  <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                    <h3 className="font-bold text-emerald-800 mb-1">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                    <p className="text-sm text-emerald-600">ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ SAMA CSF</p>
                  </div>
                  <div className="grid grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± *</label>
                      <select value={samaReportForm.reportType} onChange={(e) => setSamaReportForm({ ...samaReportForm, reportType: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:outline-none">
                        <option value="initial">ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„ÙŠ (Initial Report) - Ø®Ù„Ø§Ù„ 2 Ø³Ø§Ø¹Ø©</option>
                        <option value="update">ØªÙ‚Ø±ÙŠØ± ØªØ­Ø¯ÙŠØ«ÙŠ (Update Report)</option>
                        <option value="final">ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ (Final Report) - Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ…</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ø¯Ø«Ø© (SAMA) *</label>
                      <select value={samaReportForm.incidentCategory} onChange={(e) => setSamaReportForm({ ...samaReportForm, incidentCategory: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:outline-none">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
                        <option value="malware">Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø®Ø¨ÙŠØ«Ø© (Malware/Ransomware)</option>
                        <option value="phishing">ØªØµÙŠØ¯ Ø§Ø­ØªÙŠØ§Ù„ÙŠ (Phishing/Social Engineering)</option>
                        <option value="unauthorized">ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ (Unauthorized Access)</option>
                        <option value="data_breach">ØªØ³Ø±ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª (Data Breach/Leakage)</option>
                        <option value="ddos">Ù‡Ø¬ÙˆÙ… Ø­Ø¬Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© (DDoS)</option>
                        <option value="fraud">Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ (Financial Fraud)</option>
                        <option value="insider">ØªÙ‡Ø¯ÙŠØ¯ Ø¯Ø§Ø®Ù„ÙŠ (Insider Threat)</option>
                        <option value="third_party">Ø§Ø®ØªØ±Ø§Ù‚ Ø·Ø±Ù Ø«Ø§Ù„Ø« (Third-party Breach)</option>
                        <option value="system">ÙØ´Ù„ Ù†Ø¸Ø§Ù… Ø­Ø±Ø¬ (Critical System Failure)</option>
                        <option value="other">Ø£Ø®Ø±Ù‰ (Other)</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù *</label>
                      <select value={samaReportForm.discoveryMethod} onChange={(e) => setSamaReportForm({ ...samaReportForm, discoveryMethod: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:outline-none">
                        <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</option>
                        <option value="siem">Ù†Ø¸Ø§Ù… SIEM/SOC</option>
                        <option value="ids">Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªØ³Ù„Ù„ (IDS/IPS)</option>
                        <option value="antivirus">Ù…ÙƒØ§ÙØ­ Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª</option>
                        <option value="user_report">Ø¨Ù„Ø§Øº Ù…ÙˆØ¸Ù/Ø¹Ù…ÙŠÙ„</option>
                        <option value="audit">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù…Ù†ÙŠØ©/ØªØ¯Ù‚ÙŠÙ‚</option>
                        <option value="third_party">Ø¥Ø¨Ù„Ø§Øº Ø·Ø±Ù Ø«Ø§Ù„Ø«</option>
                        <option value="law_enforcement">Ø¬Ù‡Ø© Ø¥Ù†ÙØ§Ø° Ù‚Ø§Ù†ÙˆÙ†</option>
                        <option value="monitoring">Ù…Ø±Ø§Ù‚Ø¨Ø© ÙŠØ¯ÙˆÙŠØ©</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">Ù†Ø§Ù‚Ù„ Ø§Ù„Ù‡Ø¬ÙˆÙ… (Attack Vector)</label>
                      <select value={samaReportForm.attackVector} onChange={(e) => setSamaReportForm({ ...samaReportForm, attackVector: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 focus:outline-none">
                        <option value="">Ø§Ø®ØªØ± Ù†Ø§Ù‚Ù„ Ø§Ù„Ù‡Ø¬ÙˆÙ…</option>
                        <option value="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                        <option value="web">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆÙŠØ¨</option>
                        <option value="network">Ø§Ù„Ø´Ø¨ÙƒØ©</option>
                        <option value="removable">ÙˆØ³Ø§Ø¦Ø· Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø²Ø§Ù„Ø©</option>
                        <option value="physical">ÙˆØµÙˆÙ„ ÙÙŠØ²ÙŠØ§Ø¦ÙŠ</option>
                        <option value="supply_chain">Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯</option>
                        <option value="api">ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© (API)</option>
                        <option value="mobile">ØªØ·Ø¨ÙŠÙ‚ Ø¬ÙˆØ§Ù„</option>
                        <option value="unknown">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</option>
                      </select>
                    </div> </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-xs text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</p>
                      <p className="font-bold text-slate-800">{new Date(selectedIncident.detectedDate).toLocaleString('ar-SA')}</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-xs text-slate-500">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</p>
                      <p className="font-bold text-slate-800">{SEVERITY_LEVELS[selectedIncident.severity]?.label} ({selectedIncident.severity})</p>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-4">
                      <p className="text-xs text-slate-500">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                      <p className="font-bold text-slate-800">{INCIDENT_STATUSES[selectedIncident.status]?.label}</p>
                    </div> </div> </div>
              )}

              {samaReportStep === 2 && (
                <div className="space-y-6">
                  <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                    <h3 className="font-bold text-blue-800 mb-1">Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
                    <p className="text-sm text-blue-600">ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ‘¤ Ø¹Ù…Ù„Ø§Ø¡ Ø£ÙØ±Ø§Ø¯ Ù…ØªØ£Ø«Ø±ÙŠÙ†</label>
                      <input type="number" value={samaReportForm.affectedCustomersIndividual} onChange={(e) => setSamaReportForm({ ...samaReportForm, affectedCustomersIndividual: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-2xl font-bold text-center" />
                    </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ¢ Ø¹Ù…Ù„Ø§Ø¡ Ø´Ø±ÙƒØ§Øª Ù…ØªØ£Ø«Ø±ÙŠÙ†</label>
                      <input type="number" value={samaReportForm.affectedCustomersCorporate} onChange={(e) => setSamaReportForm({ ...samaReportForm, affectedCustomersCorporate: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-2xl font-bold text-center" />
                    </div>
                    <div className="bg-white rounded-xl border-2 border-slate-200 p-4">
                      <label className="block text-sm font-bold text-slate-700 mb-2">â­ Ø¹Ù…Ù„Ø§Ø¡ VIP Ù…ØªØ£Ø«Ø±ÙŠÙ†</label>
                      <input type="number" value={samaReportForm.affectedCustomersVIP} onChange={(e) => setSamaReportForm({ ...samaReportForm, affectedCustomersVIP: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl text-2xl font-bold text-center" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-3">ğŸ“Š Ù†ÙˆØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                    <div className="grid grid-cols-4 gap-3">
                      {['Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡ÙˆÙŠØ©', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø§ØªØµØ§Ù„', 'Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø§Ù„ÙŠØ©', 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø£Ø®Ø±Ù‰'].map(item => (
                        <label key={item} className={`flex items-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${samaReportForm.customerDataExposed.includes(item) ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-slate-300'
                          }`}>
                          <input type="checkbox" checked={samaReportForm.customerDataExposed.includes(item)}
                            onChange={(e) => {
                              if (e.target.checked) {
                                setSamaReportForm({ ...samaReportForm, customerDataExposed: [...samaReportForm.customerDataExposed, item] });
                              } else {
                                setSamaReportForm({ ...samaReportForm, customerDataExposed: samaReportForm.customerDataExposed.filter(i => i !== item) });
                              }
                            }}
                            className="w-4 h-4 text-blue-500" />
                          <span className="text-sm font-medium">{item}</span>
                        </label>
                      ))}
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-3">ğŸ¦ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                    <div className="grid grid-cols-4 gap-3">
                      {['Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ§Ù„', 'Ø§Ù„ØµØ±Ø§Ù Ø§Ù„Ø¢Ù„ÙŠ (ATM)', 'Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ (POS)', 'Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©', 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª', 'Ø§Ù„Ù‚Ø±ÙˆØ¶ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„'].map(item => (
                        <label key={item} className={`flex items-center gap-2 p-3 rounded-xl border-2 cursor-pointer transition-all ${samaReportForm.servicesAffected.includes(item) ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 hover:border-slate-300'
                          }`}>
                          <input type="checkbox" checked={samaReportForm.servicesAffected.includes(item)}
                            onChange={(e) => {
                              if (e.target.checked) {
                                setSamaReportForm({ ...samaReportForm, servicesAffected: [...samaReportForm.servicesAffected, item] });
                              } else {
                                setSamaReportForm({ ...samaReportForm, servicesAffected: samaReportForm.servicesAffected.filter(i => i !== item) });
                              }
                            }}
                            className="w-4 h-4 text-emerald-500" />
                          <span className="text-sm font-medium">{item}</span>
                        </label>
                      ))}
                    </div> </div> </div>
              )}

              {samaReportStep === 3 && (
                <div className="space-y-6">
                  <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                    <h3 className="font-bold text-amber-800 mb-1">Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ÙŠ</h3>
                    <p className="text-sm text-amber-600">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</p>
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-red-50 rounded-xl border-2 border-red-200 p-5">
                      <label className="block text-sm font-bold text-red-700 mb-2">ğŸ’¸ Ø®Ø³Ø§Ø¦Ø± Ù…Ø§Ù„ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© (Ø±ÙŠØ§Ù„)</label>
                      <input type="number" value={samaReportForm.directFinancialLoss} onChange={(e) => setSamaReportForm({ ...samaReportForm, directFinancialLoss: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-red-200 rounded-xl text-xl font-bold" placeholder="0" />
                    </div>
                    <div className="bg-orange-50 rounded-xl border-2 border-orange-200 p-5">
                      <label className="block text-sm font-bold text-orange-700 mb-2">ğŸ“‰ Ø®Ø³Ø§Ø¦Ø± Ù…Ø­ØªÙ…Ù„Ø© (Ø±ÙŠØ§Ù„)</label>
                      <input type="number" value={samaReportForm.potentialFinancialLoss} onChange={(e) => setSamaReportForm({ ...samaReportForm, potentialFinancialLoss: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-orange-200 rounded-xl text-xl font-bold" placeholder="0" />
                    </div>
                    <div className="bg-purple-50 rounded-xl border-2 border-purple-200 p-5">
                      <label className="block text-sm font-bold text-purple-700 mb-2">ğŸš¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„ (Ø±ÙŠØ§Ù„)</label>
                      <input type="number" value={samaReportForm.fraudAmount} onChange={(e) => setSamaReportForm({ ...samaReportForm, fraudAmount: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl text-xl font-bold" placeholder="0" />
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">â±ï¸ ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ (Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª)</label>
                      <input type="number" value={samaReportForm.operationalDowntime} onChange={(e) => setSamaReportForm({ ...samaReportForm, operationalDowntime: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ”¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
                      <input type="number" value={samaReportForm.transactionsAffected} onChange={(e) => setSamaReportForm({ ...samaReportForm, transactionsAffected: parseInt(e.target.value) || 0 })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-3">ğŸ“Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù…Ø¹Ø©</label>
                    <div className="grid grid-cols-4 gap-3">
                      {[
                        { value: 'None', label: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯', color: 'emerald' },
                        { value: 'Low', label: 'Ù…Ù†Ø®ÙØ¶', color: 'blue' },
                        { value: 'Medium', label: 'Ù…ØªÙˆØ³Ø·', color: 'amber' },
                        { value: 'High', label: 'Ø¹Ø§Ù„ÙŠ', color: 'red' },
                      ].map(item => (
                        <button key={item.value} type="button" onClick={() => setSamaReportForm({ ...samaReportForm, reputationalImpact: item.value })}
                          className={`p-4 rounded-xl border-2 font-bold transition-all ${samaReportForm.reputationalImpact === item.value
                            ? `border-${item.color}-500 bg-${item.color}-50 text-${item.color}-700`
                            : 'border-slate-200 hover:border-slate-300'
                            }`}>
                          {item.label}
                        </button>
                      ))}
                    </div> </div> </div>
              )}

              {samaReportStep === 4 && (
                <div className="space-y-6">
                  <div className="bg-teal-50 rounded-xl p-4 border border-teal-200">
                    <h3 className="font-bold text-teal-800 mb-1">Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ</h3>
                    <p className="text-sm text-teal-600">ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø© ÙˆØ®Ø·Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ</p>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ›¡ï¸ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù…ØªØ®Ø°Ø© *</label>
                    <textarea value={samaReportForm.containmentActions.join('\n')}
                      onChange={(e) => setSamaReportForm({ ...samaReportForm, containmentActions: e.target.value.split('\n').filter(a => a.trim()) })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-28 resize-none"
                      placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø¥Ø¬Ø±Ø§Ø¡ ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„:&#10;- Ø¹Ø²Ù„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©&#10;- Ø­Ø¸Ø± Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©&#10;- ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ±Ù‚Ø©" />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ”„ Ø®Ø·Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ Ø§Ù„Ù…ÙØµÙ„Ø© *</label>
                    <textarea value={samaReportForm.recoveryPlan} onChange={(e) => setSamaReportForm({ ...samaReportForm, recoveryPlan: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-28 resize-none"
                      placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ø®Ø·Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª..." />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø± Ù„Ù„ØªØ¹Ø§ÙÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</label>
                      <select value={samaReportForm.estimatedRecoveryTime} onChange={(e) => setSamaReportForm({ ...samaReportForm, estimatedRecoveryTime: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</option>
                        <option value="1-4h">1-4 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="4-12h">4-12 Ø³Ø§Ø¹Ø©</option>
                        <option value="12-24h">12-24 Ø³Ø§Ø¹Ø©</option>
                        <option value="1-3d">1-3 Ø£ÙŠØ§Ù…</option>
                        <option value="3-7d">3-7 Ø£ÙŠØ§Ù…</option>
                        <option value="1-2w">1-2 Ø£Ø³Ø¨ÙˆØ¹</option>
                        <option value="2w+">Ø£ÙƒØ«Ø± Ù…Ù† Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ“ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©</label>
                      <textarea value={samaReportForm.lessonsLearned} onChange={(e) => setSamaReportForm({ ...samaReportForm, lessonsLearned: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ¹Ù„Ù…Ù†Ø§Ù‡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©ØŸ" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ›¡ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</label>
                    <textarea value={samaReportForm.preventiveMeasures} onChange={(e) => setSamaReportForm({ ...samaReportForm, preventiveMeasures: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­Ø§Ø¯Ø«Ø©..." />
                  </div> </div>
              )}

              {samaReportStep === 5 && (
                <div className="space-y-6">
                  <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                    <h3 className="font-bold text-indigo-800 mb-1">Ø§Ù„Ø®Ø·ÙˆØ© 5: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª</h3>
                    <p className="text-sm text-indigo-600">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ SAMA</p>
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ‘¤ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ *</label>
                      <input type="text" value={samaReportForm.primaryContact} onChange={(e) => setSamaReportForm({ ...samaReportForm, primaryContact: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *</label>
                      <input type="tel" value={samaReportForm.primaryContactPhone} onChange={(e) => setSamaReportForm({ ...samaReportForm, primaryContactPhone: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="05xxxxxxxx" dir="ltr" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                      <input type="email" value={samaReportForm.primaryContactEmail} onChange={(e) => setSamaReportForm({ ...samaReportForm, primaryContactEmail: e.target.value })}
                        className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="email@bank.com" dir="ltr" />
                    </div> </div>
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2">ğŸ‘” Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªØµØ¹ÙŠØ¯ (Escalation Contact)</label>
                    <input type="text" value={samaReportForm.escalationContact} onChange={(e) => setSamaReportForm({ ...samaReportForm, escalationContact: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø§Ø³Ù… ÙˆÙ…Ù†ØµØ¨ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªØµØ¹ÙŠØ¯" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <label className={`flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer ${samaReportForm.ceoNotified ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200'}`}>
                      <input type="checkbox" checked={samaReportForm.ceoNotified} onChange={(e) => setSamaReportForm({ ...samaReportForm, ceoNotified: e.target.checked })} className="w-5 h-5" />
                      <span className="font-bold">âœ“ ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø±Ø¦ÙŠØ³ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ (CEO)</span>
                    </label>
                    <label className={`flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer ${samaReportForm.boardNotified ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200'}`}>
                      <input type="checkbox" checked={samaReportForm.boardNotified} onChange={(e) => setSamaReportForm({ ...samaReportForm, boardNotified: e.target.checked })} className="w-5 h-5" />
                      <span className="font-bold">âœ“ ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
                    </label>
                  </div>
                  <div className="bg-slate-50 rounded-xl p-6 border-2 border-dashed border-slate-300">
                    <div className="text-center">
                      <Upload className="w-12 h-12 text-slate-400 mx-auto mb-3" />
                      <p className="font-bold text-slate-700 mb-1">Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø¯Ø§Ø¹Ù…Ø©</p>
                      <p className="text-sm text-slate-500 mb-3">Ø³Ø¬Ù„Ø§ØªØŒ Ù„Ù‚Ø·Ø§Øª Ø´Ø§Ø´Ø©ØŒ ØªÙ‚Ø§Ø±ÙŠØ± ØªØ­Ù‚ÙŠÙ‚ØŒ Ø£Ø¯Ù„Ø©</p>
                      <button type="button" className="px-6 py-2 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300">
                        Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª
                      </button> </div> </div>
                  <div className="bg-emerald-50 rounded-xl p-5 border border-emerald-200">
                    <h4 className="font-bold text-emerald-800 mb-3">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h4>
                    <div className="grid grid-cols-4 gap-4 text-sm">
                      <div><span className="text-emerald-600">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†:</span> <span className="font-bold">{samaReportForm.affectedCustomersIndividual + samaReportForm.affectedCustomersCorporate}</span></div>
                      <div><span className="text-emerald-600">Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:</span> <span className="font-bold">{samaReportForm.directFinancialLoss.toLocaleString()} Ø±ÙŠØ§Ù„</span></div>
                      <div><span className="text-emerald-600">ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ù:</span> <span className="font-bold">{samaReportForm.operationalDowntime} Ø³Ø§Ø¹Ø©</span></div>
                      <div><span className="text-emerald-600">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</span> <span className="font-bold">{samaReportForm.servicesAffected.length}</span></div>
                    </div> </div> </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => samaReportStep > 1 ? setSamaReportStep(samaReportStep - 1) : setShowSAMAReportModal(false)}
                className="flex items-center gap-2 px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-100">
                <ChevronRight className="w-5 h-5" />
                {samaReportStep > 1 ? 'Ø§Ù„Ø³Ø§Ø¨Ù‚' : 'Ø¥Ù„ØºØ§Ø¡'}
              </button>
              <div className="text-sm text-slate-500">Ø§Ù„Ø®Ø·ÙˆØ© {samaReportStep} Ù…Ù† 5</div>
              {samaReportStep < 5 ? (
                <button onClick={() => setSamaReportStep(samaReportStep + 1)}
                  className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:shadow-lg">
                  Ø§Ù„ØªØ§Ù„ÙŠ <ChevronLeft className="w-5 h-5" />
                </button>
              ) : (
                <button onClick={() => { submitSAMAReport(); setSamaReportStep(1); }}
                  className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-bold hover:shadow-lg">
                  <Send className="w-5 h-5" />Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ SAMA
                </button>
              )}
            </div> </div> </div>
      )}

      {showLessonModal && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Lightbulb className="w-6 h-6" /></div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ù…Ø³ØªÙØ§Ø¯</h2>
                    <p className="text-amber-200 text-sm">ÙˆØ«Ù‘Ù‚ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹</p>
                  </div> </div>
                <button onClick={() => setShowLessonModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© *</label>
                  <select value={lessonFormData.incidentId} onChange={(e) => setLessonFormData({ ...lessonFormData, incidentId: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</option>
                    {incidents.map(inc => <option key={inc.id} value={inc.id}>{inc.id} - {inc.title}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                  <select value={lessonFormData.priority} onChange={(e) => setLessonFormData({ ...lessonFormData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ *</label>
                <textarea value={lessonFormData.lesson} onChange={(e) => setLessonFormData({ ...lessonFormData, lesson: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ¹Ù„Ù…Ù†Ø§Ù‡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø¯Ø«Ø©ØŸ" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙˆØµÙŠØ© *</label>
                <textarea value={lessonFormData.recommendation} onChange={(e) => setLessonFormData({ ...lessonFormData, recommendation: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" placeholder="Ù…Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø§ØªØ®Ø§Ø°Ù‡Ø§ØŸ" />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                  <input type="text" value={lessonFormData.assignedTo} onChange={(e) => setLessonFormData({ ...lessonFormData, assignedTo: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø£Ùˆ Ø§Ù„Ø´Ø®Øµ" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                  <input type="date" value={lessonFormData.dueDate} onChange={(e) => setLessonFormData({ ...lessonFormData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowLessonModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleAddLesson} className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold">
                <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³
              </button> </div> </div> </div>
      )}

      {showEditLessonModal && selectedLesson && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center"><Edit className="w-6 h-6" /></div>
                  <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯</h2>
                </div>
                <button onClick={() => setShowEditLessonModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯</label>
                <textarea value={lessonFormData.lesson} onChange={(e) => setLessonFormData({ ...lessonFormData, lesson: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„ØªÙˆØµÙŠØ©</label>
                <textarea value={lessonFormData.recommendation} onChange={(e) => setLessonFormData({ ...lessonFormData, recommendation: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-20 resize-none" />
              </div> </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowEditLessonModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleEditLesson} className="flex items-center gap-2 px-8 py-3 bg-blue-500 text-white rounded-xl font-bold">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button> </div> </div> </div>
      )}

      {showDeleteLessonModal && selectedLesson && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div className="text-center">
              <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-8 h-8 text-red-500" />
              </div>
              <h3 className="text-xl font-bold text-slate-800 mb-2">Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯</h3>
              <p className="text-slate-600 mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ</p>
              <div className="flex gap-3">
                <button onClick={() => setShowDeleteLessonModal(false)} className="flex-1 px-4 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                <button onClick={handleDeleteLesson} className="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-bold">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
              </div> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          REGULATORY REPORTS MODALS: View, Edit, Delete
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}

      {showViewReportModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden flex flex-col">
            <div className={`px-6 py-5 text-white ${selectedReport.authority === 'NCA' ? 'bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600' : 'bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600'}`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center">
                    <span className="text-2xl font-black">{selectedReport.authority}</span>
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>
                    <p className="text-white/80">{selectedReport.referenceNumber} - {selectedReport.incidentId}</p>
                  </div> </div>
                <div className="flex items-center gap-3">
                  <span className={`px-4 py-2 rounded-xl text-sm font-bold ${getReportStatusColor(selectedReport.status)}`}>
                    {getReportStatusLabel(selectedReport.status)}
                  </span>
                  <button onClick={() => setShowViewReportModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                    <X className="w-6 h-6" />
                  </button> </div> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-6">
              <div className="bg-gradient-to-r from-slate-50 to-slate-100 rounded-2xl border-2 border-slate-200 p-5">
                <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg">
                  <span className="w-8 h-8 bg-indigo-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">1</span>
                  Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
                </h4>
                <div className="grid grid-cols-4 gap-4 mb-4">
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</p>
                    <p className="font-bold text-indigo-600">{selectedReport.incidentId}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</p>
                    <p className="font-bold">{selectedReport.reportType === 'initial' ? 'ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„ÙŠ' : selectedReport.reportType === 'update' ? 'ğŸ”„ ØªÙ‚Ø±ÙŠØ± ØªØ­Ø¯ÙŠØ«' : 'âœ… ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ'}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</p>
                    <p className="font-bold">{new Date(selectedReport.submittedDate).toLocaleString('ar-SA')}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø¨Ù„Ø§Øº</p>
                    <p className="font-bold">{selectedReport.submittedBy}</p>
                  </div> </div>
                <div className="grid grid-cols-4 gap-4">
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">ÙØ¦Ø© Ø§Ù„Ø­Ø§Ø¯Ø«Ø©</p>
                    <p className="font-bold text-slate-800">{selectedReport.incidentCategory || '-'}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</p>
                    <p className="font-bold text-slate-800">{selectedReport.incidentSubCategory || '-'}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù</p>
                    <p className="font-bold text-slate-800">{selectedReport.discoveryMethod || '-'}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200">
                    <p className="text-xs text-slate-500 mb-1">Ù†Ø§Ù‚Ù„ Ø§Ù„Ù‡Ø¬ÙˆÙ…</p>
                    <p className="font-bold text-slate-800">{selectedReport.attackVector || '-'}</p>
                  </div> </div> </div>
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 p-5">
                <h4 className="font-bold text-blue-800 mb-4 flex items-center gap-2 text-lg">
                  <span className="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">2</span>
                  ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª
                </h4>
                <div className="grid grid-cols-5 gap-4 mb-4">
                  <div className="bg-white rounded-xl p-4 border border-blue-200 text-center">
                    <p className="text-3xl font-black text-blue-600">{selectedReport.affectedCustomersIndividual || 0}</p>
                    <p className="text-xs text-slate-500 mt-1">ğŸ‘¤ Ø¹Ù…Ù„Ø§Ø¡ Ø£ÙØ±Ø§Ø¯</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-blue-200 text-center">
                    <p className="text-3xl font-black text-purple-600">{selectedReport.affectedCustomersCorporate || 0}</p>
                    <p className="text-xs text-slate-500 mt-1">ğŸ¢ Ø¹Ù…Ù„Ø§Ø¡ Ø´Ø±ÙƒØ§Øª</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-blue-200 text-center">
                    <p className="text-3xl font-black text-amber-600">{selectedReport.affectedCustomersVIP || 0}</p>
                    <p className="text-xs text-slate-500 mt-1">â­ Ø¹Ù…Ù„Ø§Ø¡ VIP</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-blue-200 text-center">
                    <p className="text-3xl font-black text-slate-700">{selectedReport.affectedUsers || 0}</p>
                    <p className="text-xs text-slate-500 mt-1">ğŸ‘¥ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ØªØ£Ø«Ø±ÙŠÙ†</p>
                  </div>
                  <div className="bg-indigo-100 rounded-xl p-4 border border-indigo-300 text-center">
                    <p className="text-3xl font-black text-indigo-700">{(selectedReport.affectedCustomersIndividual || 0) + (selectedReport.affectedCustomersCorporate || 0) + (selectedReport.affectedCustomersVIP || 0)}</p>
                    <p className="text-xs text-indigo-600 mt-1 font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                  </div> </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white rounded-xl p-4 border border-blue-200">
                    <p className="text-xs text-slate-500 mb-2">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©</p>
                    <div className="flex flex-wrap gap-2">
                      {(selectedReport.customerDataExposed || []).map((data, i) => (
                        <span key={i} className="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold">{data}</span>
                      ))}
                      {(!selectedReport.customerDataExposed || selectedReport.customerDataExposed.length === 0) && <span className="text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>}
                    </div> </div>
                  <div className="bg-white rounded-xl p-4 border border-blue-200">
                    <p className="text-xs text-slate-500 mb-2">ğŸ”§ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                    <div className="flex flex-wrap gap-2">
                      {(selectedReport.servicesAffected || []).map((svc, i) => (
                        <span key={i} className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">{svc}</span>
                      ))}
                      {(!selectedReport.servicesAffected || selectedReport.servicesAffected.length === 0) && <span className="text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>}
                    </div> </div> </div>
                <div className="mt-4 bg-white rounded-xl p-4 border border-blue-200">
                  <p className="text-xs text-slate-500 mb-2">ğŸ–¥ï¸ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                  <p className="font-bold text-slate-800">{selectedReport.affectedSystems?.join(' â€¢ ') || '-'}</p>
                </div> </div>
              <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl border-2 border-red-200 p-5">
                <h4 className="font-bold text-red-800 mb-4 flex items-center gap-2 text-lg">
                  <span className="w-8 h-8 bg-red-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">3</span>
                  Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ÙŠ
                </h4>
                <div className="grid grid-cols-3 gap-4 mb-4">
                  <div className="bg-white rounded-xl p-5 border-2 border-red-200 text-center">
                    <p className="text-xs text-slate-500 mb-2">ğŸ’¸ Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</p>
                    <p className="text-2xl font-black text-red-600">{(selectedReport.directFinancialLoss || 0).toLocaleString()}</p>
                    <p className="text-xs text-slate-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                  </div>
                  <div className="bg-white rounded-xl p-5 border-2 border-amber-200 text-center">
                    <p className="text-xs text-slate-500 mb-2">âš ï¸ Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</p>
                    <p className="text-2xl font-black text-amber-600">{(selectedReport.potentialFinancialLoss || 0).toLocaleString()}</p>
                    <p className="text-xs text-slate-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                  </div>
                  <div className="bg-white rounded-xl p-5 border-2 border-purple-200 text-center">
                    <p className="text-xs text-slate-500 mb-2">ğŸ”“ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„</p>
                    <p className="text-2xl font-black text-purple-600">{(selectedReport.fraudAmount || 0).toLocaleString()}</p>
                    <p className="text-xs text-slate-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                  </div> </div>
                <div className="grid grid-cols-3 gap-4">
                  <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                    <p className="text-xs text-slate-500 mb-1">ğŸ“Š Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</p>
                    <p className="text-xl font-bold text-slate-700">{selectedReport.transactionsAffected || 0}</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                    <p className="text-xs text-slate-500 mb-1">â±ï¸ ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ù</p>
                    <p className="text-xl font-bold text-slate-700">{selectedReport.operationalDowntime || 0} Ø³Ø§Ø¹Ø©</p>
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-slate-200 text-center">
                    <p className="text-xs text-slate-500 mb-1">ğŸ“¢ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù…Ø¹Ø©</p>
                    <span className={`px-3 py-1 rounded-lg text-sm font-bold ${selectedReport.reputationalImpact === 'High' ? 'bg-red-100 text-red-700' :
                      selectedReport.reputationalImpact === 'Medium' ? 'bg-amber-100 text-amber-700' :
                        'bg-emerald-100 text-emerald-700'
                      }`}>{selectedReport.reputationalImpact || 'Low'}</span>
                  </div> </div> </div>
              <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl border-2 border-emerald-200 p-5">
                <h4 className="font-bold text-emerald-800 mb-4 flex items-center gap-2 text-lg">
                  <span className="w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">4</span>
                  Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ
                </h4>
                <div className="space-y-4">
                  <div className="bg-white rounded-xl p-4 border border-emerald-200">
                    <p className="text-xs text-emerald-600 font-bold mb-2">ğŸ›¡ï¸ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡</p>
                    <div className="flex flex-wrap gap-2">
                      {(selectedReport.containmentActions || []).map((action, i) => (
                        <span key={i} className="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm">âœ“ {action}</span>
                      ))}
                    </div>
                    {selectedReport.containmentMeasures && <p className="mt-2 text-slate-600 text-sm">{selectedReport.containmentMeasures}</p>}
                  </div>
                  <div className="bg-white rounded-xl p-4 border border-emerald-200">
                    <p className="text-xs text-emerald-600 font-bold mb-2">ğŸ§¹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø©</p>
                    <div className="flex flex-wrap gap-2">
                      {(selectedReport.eradicationActions || []).map((action, i) => (
                        <span key={i} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm">âœ“ {action}</span>
                      ))}
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-white rounded-xl p-4 border border-emerald-200">
                      <p className="text-xs text-emerald-600 font-bold mb-2">ğŸ”„ Ø®Ø·Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ</p>
                      <p className="text-slate-700">{selectedReport.recoveryPlan || '-'}</p>
                    </div>
                    <div className="bg-white rounded-xl p-4 border border-emerald-200">
                      <p className="text-xs text-emerald-600 font-bold mb-2">â° ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø§ÙÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</p>
                      <p className="text-lg font-bold text-emerald-700">{selectedReport.estimatedRecoveryTime || '-'}</p>
                    </div> </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                      <p className="text-xs text-amber-600 font-bold mb-2">ğŸ’¡ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©</p>
                      <p className="text-slate-700">{selectedReport.lessonsLearned || '-'}</p>
                    </div>
                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                      <p className="text-xs text-blue-600 font-bold mb-2">ğŸ”’ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙˆÙ‚Ø§Ø¦ÙŠØ©</p>
                      <p className="text-slate-700">{selectedReport.preventiveMeasures || '-'}</p>
                    </div> </div> </div> </div>
              <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border-2 border-purple-200 p-5">
                <h4 className="font-bold text-purple-800 mb-4 flex items-center gap-2 text-lg">
                  <span className="w-8 h-8 bg-purple-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">5</span>
                  Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </h4>
                <div className="grid grid-cols-2 gap-4 mb-4">
                  <div className="bg-white rounded-xl p-4 border border-purple-200">
                    <p className="text-xs text-purple-600 font-bold mb-3">ğŸ“ Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                    <div className="space-y-2">
                      <p className="flex items-center gap-2"><span className="text-slate-500">Ø§Ù„Ø§Ø³Ù…:</span> <span className="font-bold">{selectedReport.primaryContact || '-'}</span></p>
                      <p className="flex items-center gap-2"><span className="text-slate-500">Ø§Ù„Ù‡Ø§ØªÙ:</span> <span className="font-bold font-mono">{selectedReport.primaryContactPhone || '-'}</span></p>
                      <p className="flex items-center gap-2"><span className="text-slate-500">Ø§Ù„Ø¨Ø±ÙŠØ¯:</span> <span className="font-bold">{selectedReport.primaryContactEmail || '-'}</span></p>
                    </div> </div>
                  <div className="bg-white rounded-xl p-4 border border-purple-200">
                    <p className="text-xs text-purple-600 font-bold mb-3">ğŸ“¤ Ø¬Ù‡Ø© Ø§Ù„ØªØµØ¹ÙŠØ¯</p>
                    <p className="font-bold text-lg">{selectedReport.escalationContact || '-'}</p>
                    <div className="mt-4 flex gap-4">
                      <div className={`flex items-center gap-2 px-3 py-2 rounded-lg ${selectedReport.ceoNotified ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-500'}`}>
                        {selectedReport.ceoNotified ? 'âœ…' : 'â¬œ'} <span className="text-sm font-bold">CEO</span>
                      </div>
                      <div className={`flex items-center gap-2 px-3 py-2 rounded-lg ${selectedReport.boardNotified ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-500'}`}>
                        {selectedReport.boardNotified ? 'âœ…' : 'â¬œ'} <span className="text-sm font-bold">Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
                      </div> </div> </div> </div>
                {selectedReport.attachments && selectedReport.attachments.length > 0 && (
                  <div className="bg-white rounded-xl p-4 border border-purple-200">
                    <p className="text-xs text-purple-600 font-bold mb-2">ğŸ“ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</p>
                    <div className="flex flex-wrap gap-2">
                      {selectedReport.attachments.map((file, i) => (
                        <span key={i} className="px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg text-sm flex items-center gap-1">
                          ğŸ“„ {file}
                        </span>
                      ))}
                    </div> </div>
                )}
              </div>

              {selectedReport.response && (
                <div className="bg-gradient-to-r from-cyan-50 to-sky-50 rounded-2xl border-2 border-cyan-300 p-5">
                  <h4 className="font-bold text-cyan-800 mb-3 flex items-center gap-2">
                    <span className="text-xl">ğŸ“¨</span> Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
                  </h4>
                  <div className="bg-white rounded-xl p-4 border border-cyan-200">
                    <p className="text-xs text-slate-500 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø¯: {selectedReport.responseDate ? new Date(selectedReport.responseDate).toLocaleString('ar-SA') : '-'}</p>
                    <p className="text-slate-800 font-medium">{selectedReport.response}</p>
                  </div> </div>
              )}
            </div>

            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => { setShowViewReportModal(false); handleEditReportOpen(selectedReport); }}
                className="flex items-center gap-2 px-6 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600">
                <Edit className="w-5 h-5" />ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button>
              <button onClick={() => setShowViewReportModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥ØºÙ„Ø§Ù‚
              </button> </div> </div> </div>
      )}

      {showEditReportModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <div className="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <Edit className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                    <p className="text-amber-200">{selectedReport.referenceNumber}</p>
                  </div> </div>
                <button onClick={() => setShowEditReportModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-6 h-6" />
                </button> </div> </div>
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                  <select value={reportFormData.reportType} onChange={(e) => setReportFormData({ ...reportFormData, reportType: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="initial">ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„ÙŠ</option>
                    <option value="update">ØªÙ‚Ø±ÙŠØ± ØªØ­Ø¯ÙŠØ«</option>
                    <option value="final">ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                  <select value={reportFormData.status} onChange={(e) => setReportFormData({ ...reportFormData, status: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl">
                    <option value="Submitted">Ù…ÙØ±Ø³Ù„</option>
                    <option value="Acknowledged">ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                    <option value="Closed">Ù…ÙØºÙ„Ù‚</option>
                  </select>
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</label>
                  <input type="number" value={reportFormData.directFinancialLoss || 0}
                    onChange={(e) => setReportFormData({ ...reportFormData, directFinancialLoss: parseInt(e.target.value) || 0 })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</label>
                  <input type="number" value={reportFormData.potentialFinancialLoss || 0}
                    onChange={(e) => setReportFormData({ ...reportFormData, potentialFinancialLoss: parseInt(e.target.value) || 0 })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡</label>
                <textarea value={reportFormData.containmentMeasures || ''}
                  onChange={(e) => setReportFormData({ ...reportFormData, containmentMeasures: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-24 resize-none" />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø®Ø·Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ</label>
                <textarea value={reportFormData.recoveryPlan || ''}
                  onChange={(e) => setReportFormData({ ...reportFormData, recoveryPlan: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl h-24 resize-none" />
              </div>
              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„</label>
                  <input type="text" value={reportFormData.primaryContact || ''}
                    onChange={(e) => setReportFormData({ ...reportFormData, primaryContact: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ù‡Ø§ØªÙ</label>
                  <input type="tel" value={reportFormData.primaryContactPhone || ''}
                    onChange={(e) => setReportFormData({ ...reportFormData, primaryContactPhone: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
                  <input type="email" value={reportFormData.primaryContactEmail || ''}
                    onChange={(e) => setReportFormData({ ...reportFormData, primaryContactEmail: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl" />
                </div> </div>
              {reportFormData.response && (
                <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                  <label className="block text-sm font-bold text-emerald-800 mb-2">Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©</label>
                  <p className="text-slate-700">{reportFormData.response}</p>
                </div>
              )}
            </div>
            <div className="border-t border-slate-200 px-6 py-4 bg-slate-50 flex items-center justify-between">
              <button onClick={() => setShowEditReportModal(false)} className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
              <button onClick={handleEditReport} className="flex items-center gap-2 px-8 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600">
                <Save className="w-5 h-5" />Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button> </div> </div> </div>
      )}

      {showDeleteReportModal && selectedReport && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div className="text-center">
              <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-8 h-8 text-red-500" />
              </div>
              <h3 className="text-xl font-bold text-slate-800 mb-2">Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
              <p className="text-slate-600 mb-2">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ</p>
              <p className="font-mono text-indigo-600 font-bold mb-6">{selectedReport.referenceNumber}</p>
              <div className="bg-amber-50 rounded-xl p-3 mb-6">
                <p className="text-sm text-amber-800">âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p>
              </div>
              <div className="flex gap-3">
                <button onClick={() => setShowDeleteReportModal(false)} className="flex-1 px-4 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                <button onClick={handleDeleteReport} className="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-bold">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
              </div> </div> </div> </div>
      )}

      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-[60] px-6 py-3 rounded-xl shadow-lg font-bold flex items-center gap-2 ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'
          }`}>
          {notification.type === 'success' ? <CheckCircle2 className="w-5 h-5" /> : <AlertCircle className="w-5 h-5" />}
          {notification.message}
        </div>
      )}
    </div>);
};

// Module: Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ© (Personal Workspace)
// My Dashboard, My Tasks, My Approvals, Notifications, Calendar

const PersonalWorkspace = () => {
  const { currentUser, can } = useAuth();
  const [activeTab, setActiveTab] = useState('mydashboard');
  const [selectedTask, setSelectedTask] = useState(null);
  const [showTaskModal, setShowTaskModal] = useState(false);
  const [showAssignModal, setShowAssignModal] = useState(false);
  const [showDelegateModal, setShowDelegateModal] = useState(false);
  const [taskFilter, setTaskFilter] = useState('all');
  const [notification, setNotification] = useState(null);
  const [assignFormData, setAssignFormData] = useState({ assigneeId: '', dueDate: '', priority: 'Medium', notes: '' });

  // Current User Info
  const CURRENT_USER = currentUser || { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Compliance Manager', email: 'sara@company.sa' };
  const currentDate = new Date().toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  const currentTime = new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });

  // ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ - Team Members
  const TEAM_MEMBERS = [
    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', email: 'ahmed@company.sa', avatar: 'Ø£', color: 'emerald', workload: 8, capacity: 10 },
    { id: 2, name: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', role: 'Ù…Ø­Ù„Ù„ Ø§Ù…ØªØ«Ø§Ù„', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', email: 'mohammed@company.sa', avatar: 'Ù…', color: 'blue', workload: 6, capacity: 10 },
    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', department: 'Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', email: 'khaled@company.sa', avatar: 'Ø®', color: 'purple', workload: 9, capacity: 10 },
    { id: 4, name: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', role: 'Ù…Ø³Ø¤ÙˆÙ„Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', department: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', email: 'fatima@company.sa', avatar: 'Ù', color: 'pink', workload: 5, capacity: 10 },
    { id: 5, name: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', role: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', department: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', email: 'sara@company.sa', avatar: 'Ø³', color: 'indigo', workload: 7, capacity: 10 },
    { id: 6, name: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Ù…Ø­Ù„Ù„Ø© Ù…Ø®Ø§Ø·Ø±', department: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', email: 'noura@company.sa', avatar: 'Ù†', color: 'amber', workload: 4, capacity: 10 },
    { id: 7, name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø¨ÙŠØ¹ÙŠ', role: 'Ù…Ø¯Ù‚Ù‚ Ø¯Ø§Ø®Ù„ÙŠ', department: 'Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', email: 'abdullah@company.sa', avatar: 'Ø¹', color: 'teal', workload: 6, capacity: 10 },
  ];

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙˆÙƒÙ„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
  const getDateStr = (daysFromNow) => {
    const d = new Date();
    d.setDate(d.getDate() + daysFromNow);
    return d.toISOString().split('T')[0];
  };

  const [myTasks, setMyTasks] = useState(() => {
    // Initialize dates
    const today = new Date();
    const todayStr = today.toISOString().split('T')[0];
    const getDate = (days) => {
      const d = new Date(today);
      d.setDate(d.getDate() + days);
      return d.toISOString().split('T')[0];
    };

    return [
      // Ù…Ù‡Ø§Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª - ØªÙˆØ§Ø±ÙŠØ® Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
      { id: 1, type: 'obligation', refCode: 'SAMA-CYBER-001', title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©', priority: 'High', status: 'InProgress', dueDate: getDate(3), assignedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', assignedById: 1, assignedDate: '2025-02-01', category: 'Review', progress: 60, comments: 2, canDelegate: true, authorityCode: 'SAMA' },
      { id: 2, type: 'obligation', refCode: 'NCA-ECC-003', title: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø«', description: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙˆÙÙ‚ Ù…ØªØ·Ù„Ø¨Ø§Øª NCA', priority: 'Critical', status: 'Open', dueDate: getDate(1), assignedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', assignedById: 3, assignedDate: '2025-01-28', category: 'Update', progress: 0, comments: 0, canDelegate: true, authorityCode: 'NCA' },
      { id: 3, type: 'evidence', refCode: 'EVD-2025-015', title: 'Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', description: 'Ø±ÙØ¹ Ø´Ù‡Ø§Ø¯Ø§Øª ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ', priority: 'Medium', status: 'InProgress', dueDate: getDate(5), assignedBy: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', assignedById: 4, assignedDate: '2025-02-03', category: 'Upload', progress: 30, comments: 1, canDelegate: true, authorityCode: 'NCA' },
      { id: 4, type: 'test', refCode: 'TST-2025-008', title: 'ØªÙ†ÙÙŠØ° Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚', description: 'ØªÙ†ÙÙŠØ° Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø±Ø¬Ø©', priority: 'High', status: 'Scheduled', dueDate: getDate(7), assignedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', assignedById: 2, assignedDate: '2025-02-01', category: 'Execute', progress: 0, comments: 3, canDelegate: false, authorityCode: 'SAMA' },
      { id: 5, type: 'incident', refCode: 'INC-2025-003', title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', description: 'Ø§Ø³ØªÙƒÙ…Ø§Ù„ ØªØ­Ù‚ÙŠÙ‚ Ø­Ø§Ø¯Ø«Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØµÙŠØ¯ Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„ÙŠ', priority: 'Critical', status: 'InProgress', dueDate: todayStr, assignedBy: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', assignedById: 6, assignedDate: '2025-02-05', category: 'Investigate', progress: 75, comments: 5, canDelegate: true, authorityCode: 'NCA' },
      { id: 6, type: 'report', refCode: 'RPT-SAMA-Q1', title: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', description: 'Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ù„Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„', priority: 'High', status: 'Open', dueDate: getDate(14), assignedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', assignedById: 1, assignedDate: '2025-02-01', category: 'Prepare', progress: 10, comments: 0, canDelegate: true, authorityCode: 'SAMA' },
      { id: 7, type: 'violation', refCode: 'VIO-2025-002', title: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©', description: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© CAPA Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„ØªØ£Ø®Ø± ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±', priority: 'High', status: 'InProgress', dueDate: getDate(4), assignedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', assignedById: 3, assignedDate: '2025-02-04', category: 'Remediate', progress: 40, comments: 2, canDelegate: true, authorityCode: 'SAMA' },
      { id: 8, type: 'approval', refCode: 'APR-2025-010', title: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', description: 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©', priority: 'Medium', status: 'PendingApproval', dueDate: getDate(2), assignedBy: 'Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', assignedDate: '2025-02-06', category: 'Approve', progress: 100, comments: 1, authorityCode: 'NDMO' },
      { id: 9, type: 'obligation', refCode: 'NDMO-DG-001', title: 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©', description: 'Ø¥ÙƒÙ…Ø§Ù„ ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙÙ‚ Ù…Ø¹Ø§ÙŠÙŠØ± NDMO', priority: 'High', status: 'Open', dueDate: todayStr, assignedBy: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', assignedById: 4, assignedDate: '2025-02-01', category: 'Execute', progress: 0, comments: 0, canDelegate: true, authorityCode: 'NDMO' },
      { id: 10, type: 'test', refCode: 'TST-NCA-002', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø·Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„', description: 'ØªÙ†ÙÙŠØ° Ø§Ø®ØªØ¨Ø§Ø± Ø³Ù†ÙˆÙŠ Ù„Ø®Ø·Ø© BCP', priority: 'Critical', status: 'Open', dueDate: getDate(6), assignedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', assignedById: 1, assignedDate: '2025-02-01', category: 'Execute', progress: 0, comments: 0, canDelegate: true, authorityCode: 'SAMA' },
    ];
  });

  // Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
  const [pendingApprovals, setPendingApprovals] = useState([
    { id: 1, type: 'evidence', refCode: 'EVD-2025-012', title: 'Ø¯Ù„ÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Q4', requestedBy: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', requestedDate: '2025-02-05', priority: 'High', status: 'PendingReview' },
    { id: 2, type: 'policy', refCode: 'POL-SEC-005', title: 'Ø³ÙŠØ§Ø³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ§Øª ÙˆØ§Ù„ÙˆØµÙˆÙ„', requestedBy: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', requestedDate: '2025-02-04', priority: 'Medium', status: 'PendingReview' },
    { id: 3, type: 'exception', refCode: 'EXC-2025-003', title: 'Ø·Ù„Ø¨ Ø§Ø³ØªØ«Ù†Ø§Ø¡ ØªØ£Ø®ÙŠØ± ØªÙ‚Ø±ÙŠØ± SAMA', requestedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', requestedDate: '2025-02-06', priority: 'Critical', status: 'PendingApproval' },
    { id: 4, type: 'violation_closure', refCode: 'VIO-2025-001', title: 'Ø·Ù„Ø¨ Ø¥ØºÙ„Ø§Ù‚ Ù…Ø®Ø§Ù„ÙØ© BRH-2025-001', requestedBy: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', requestedDate: '2025-02-05', priority: 'High', status: 'PendingApproval' },
  ]);

  // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  const [notifications, setNotifications] = useState([
    { id: 1, type: 'alert', title: 'ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù‚ØªØ±Ø§Ø¨ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚', message: 'Ø§Ù„ØªØ²Ø§Ù… SAMA-CYBER-001 ÙŠØ³ØªØ­Ù‚ Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù…', time: '10 Ø¯Ù‚Ø§Ø¦Ù‚', read: false, priority: 'High' },
    { id: 2, type: 'task', title: 'Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙˆÙƒÙ„Ø© Ø¥Ù„ÙŠÙƒ', message: 'ØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© "ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©" Ø¥Ù„ÙŠÙƒ', time: '30 Ø¯Ù‚ÙŠÙ‚Ø©', read: false, priority: 'Critical' },
    { id: 3, type: 'approval', title: 'Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯', message: 'Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙƒ', time: 'Ø³Ø§Ø¹Ø©', read: false, priority: 'Medium' },
    { id: 4, type: 'comment', title: 'ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ù…Ù‡Ù…ØªÙƒ', message: 'Ø¹Ù„Ù‘Ù‚ Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ Ø¹Ù„Ù‰ Ù…Ù‡Ù…Ø© "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ù†"', time: 'Ø³Ø§Ø¹ØªÙŠÙ†', read: true, priority: 'Low' },
    { id: 5, type: 'system', title: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…', message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª NCA ECC 2.0', time: '3 Ø³Ø§Ø¹Ø§Øª', read: true, priority: 'Info' },
    { id: 6, type: 'deadline', title: 'ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', message: 'Ù…Ù‡Ù…Ø© EVD-2025-010 ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯', time: 'Ø£Ù…Ø³', read: true, priority: 'Critical' },
  ]);

  // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
  const myStats = useMemo(() => {
    const totalTasks = myTasks.length;
    const completedTasks = myTasks.filter(t => t.status === 'Completed').length;
    const inProgressTasks = myTasks.filter(t => t.status === 'InProgress').length;
    const overdueTasks = myTasks.filter(t => new Date(t.dueDate) < new Date() && t.status !== 'Completed').length;
    const criticalTasks = myTasks.filter(t => t.priority === 'Critical' && t.status !== 'Completed').length;
    const todayTasks = myTasks.filter(t => {
      const due = new Date(t.dueDate);
      const today = new Date();
      return due.toDateString() === today.toDateString();
    }).length;
    const thisWeekTasks = myTasks.filter(t => {
      const due = new Date(t.dueDate);
      const today = new Date();
      const weekFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
      return due >= today && due <= weekFromNow && t.status !== 'Completed';
    }).length;
    const unreadNotifications = notifications.filter(n => !n.read).length;
    const pendingApprovalsCount = pendingApprovals.length;

    return {
      totalTasks, completedTasks, inProgressTasks, overdueTasks, criticalTasks,
      todayTasks, thisWeekTasks, unreadNotifications, pendingApprovalsCount,
      completionRate: totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0
    };
  }, [myTasks, notifications, pendingApprovals]);

  // Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  const handleUpdateTaskStatus = (taskId, newStatus, newProgress) => {
    setMyTasks(myTasks.map(t => t.id === taskId ? { ...t, status: newStatus, progress: newProgress || t.progress } : t));
    setNotification({ type: 'success', message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­' });
    setTimeout(() => setNotification(null), 3000);
  };

  const handleApprove = (approvalId, decision, notes) => {
    setPendingApprovals(pendingApprovals.filter(a => a.id !== approvalId));
    setNotification({ type: 'success', message: decision === 'approve' ? 'ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø§Ù„Ø±ÙØ¶' });
    setTimeout(() => setNotification(null), 3000);
  };

  const handleMarkAsRead = (notificationId) => {
    setNotifications(notifications.map(n => n.id === notificationId ? { ...n, read: true } : n));
  };

  const handleMarkAllAsRead = () => {
    setNotifications(notifications.map(n => ({ ...n, read: true })));
  };

  // Ø§Ù„ØªØµÙÙŠØ©
  const filteredTasks = useMemo(() => {
    switch (taskFilter) {
      case 'today': return myTasks.filter(t => new Date(t.dueDate).toDateString() === new Date().toDateString());
      case 'overdue': return myTasks.filter(t => new Date(t.dueDate) < new Date() && t.status !== 'Completed');
      case 'critical': return myTasks.filter(t => t.priority === 'Critical');
      case 'inprogress': return myTasks.filter(t => t.status === 'InProgress');
      case 'pending': return myTasks.filter(t => t.status === 'Open' || t.status === 'Scheduled');
      default: return myTasks;
    }
  }, [myTasks, taskFilter]);

  // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  const tabs = [
    { id: 'mydashboard', label: 'Ù„ÙˆØ­ØªÙŠ', icon: LayoutDashboard },
    { id: 'mytasks', label: 'Ù…Ù‡Ø§Ù…ÙŠ', icon: ClipboardList, count: myStats.inProgressTasks + myTasks.filter(t => t.status === 'Open').length },
    { id: 'approvals', label: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª', icon: CheckCircle2, count: myStats.pendingApprovalsCount },
    { id: 'notifications', label: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', icon: Bell, count: myStats.unreadNotifications },
    { id: 'team', label: 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„', icon: Users },
    { id: 'mycalendar', label: 'ØªÙ‚ÙˆÙŠÙ…ÙŠ', icon: Calendar },
  ];

  // Ù…Ø¹Ø§Ù„Ø¬ ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø©
  const handleDelegateTask = (taskId, newAssigneeId) => {
    const newAssignee = TEAM_MEMBERS.find(m => m.id === newAssigneeId);
    if (!newAssignee) return;

    setMyTasks(myTasks.map(t => t.id === taskId ? {
      ...t,
      delegatedTo: newAssignee.name, delegatedToId: newAssigneeId, delegatedDate: new Date().toISOString().split('T')[0],
      status: 'Delegated'
    } : t));

    setNotification({ type: 'success', message: `ØªÙ… ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ ${newAssignee.name}` });
    setTimeout(() => setNotification(null), 3000);
    setShowDelegateModal(false);
  };

  // Config
  const PRIORITY_CONFIG = {
    Critical: { label: 'Ø­Ø±Ø¬', bg: 'bg-red-500', light: 'bg-red-100', text: 'text-red-700', border: 'border-red-500' },
    High: { label: 'Ø¹Ø§Ù„ÙŠ', bg: 'bg-orange-500', light: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-500' },
    Medium: { label: 'Ù…ØªÙˆØ³Ø·', bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-500' },
    Low: { label: 'Ù…Ù†Ø®ÙØ¶', bg: 'bg-emerald-500', light: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-500' },
    Info: { label: 'Ù…Ø¹Ù„ÙˆÙ…Ø©', bg: 'bg-blue-500', light: 'bg-blue-100', text: 'text-blue-700', border: 'border-blue-500' },
  };

  const STATUS_CONFIG = {
    Open: { label: 'Ø¬Ø¯ÙŠØ¯', bg: 'bg-blue-100', text: 'text-blue-700', icon: Circle },
    InProgress: { label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„', bg: 'bg-amber-100', text: 'text-amber-700', icon: Clock },
    PendingApproval: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', bg: 'bg-purple-100', text: 'text-purple-700', icon: Eye },
    PendingReview: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', bg: 'bg-indigo-100', text: 'text-indigo-700', icon: Eye },
    Scheduled: { label: 'Ù…Ø¬Ø¯ÙˆÙ„', bg: 'bg-cyan-100', text: 'text-cyan-700', icon: Calendar },
    Completed: { label: 'Ù…ÙƒØªÙ…Ù„', bg: 'bg-emerald-100', text: 'text-emerald-700', icon: CheckCircle2 },
  };

  const TYPE_CONFIG = {
    obligation: { label: 'Ø§Ù„ØªØ²Ø§Ù…', icon: FileText, color: 'indigo' },
    evidence: { label: 'Ø¯Ù„ÙŠÙ„', icon: FolderOpen, color: 'emerald' },
    test: { label: 'Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardCheck, color: 'blue' },
    incident: { label: 'Ø­Ø§Ø¯Ø«Ø©', icon: Zap, color: 'red' },
    report: { label: 'ØªÙ‚Ø±ÙŠØ±', icon: BarChart3, color: 'purple' },
    violation: { label: 'Ù…Ø®Ø§Ù„ÙØ©', icon: AlertTriangle, color: 'orange' },
    approval: { label: 'Ù…ÙˆØ§ÙÙ‚Ø©', icon: CheckCircle2, color: 'teal' },
    policy: { label: 'Ø³ÙŠØ§Ø³Ø©', icon: BookOpen, color: 'slate' },
    exception: { label: 'Ø§Ø³ØªØ«Ù†Ø§Ø¡', icon: Shield, color: 'amber' },
    violation_closure: { label: 'Ø¥ØºÙ„Ø§Ù‚ Ù…Ø®Ø§Ù„ÙØ©', icon: XCircle, color: 'rose' },
  };

  // RENDER
  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`}>
          {notification.message}
        </div>
      )}

      <div className="bg-gradient-to-l from-indigo-600 via-purple-600 to-blue-600 rounded-3xl p-6 text-white shadow-xl">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm">
              <User className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-2xl font-black">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {CURRENT_USER.name} ğŸ‘‹</h1>
              <p className="text-indigo-200">{CURRENT_USER.role} â€¢ {currentDate}</p>
            </div> </div>
          <div className="text-left">
            <p className="text-4xl font-black">{currentTime}</p>
            <p className="text-indigo-200">ÙˆÙ‚Øª Ø§Ù„Ø±ÙŠØ§Ø¶</p>
          </div> </div>
        <div className="grid grid-cols-6 gap-4 mt-6">
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
            <p className="text-3xl font-black">{myStats.todayTasks}</p>
            <p className="text-indigo-200 text-sm">Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</p>
          </div>
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
            <p className="text-3xl font-black">{myStats.thisWeekTasks}</p>
            <p className="text-indigo-200 text-sm">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
          </div>
          <div className={`${myStats.overdueTasks > 0 ? 'bg-red-500/50' : 'bg-white/10'} backdrop-blur-sm rounded-xl p-4 text-center`}>
            <p className="text-3xl font-black">{myStats.overdueTasks}</p>
            <p className="text-indigo-200 text-sm">Ù…ØªØ£Ø®Ø±Ø©</p>
          </div>
          <div className={`${myStats.criticalTasks > 0 ? 'bg-orange-500/50' : 'bg-white/10'} backdrop-blur-sm rounded-xl p-4 text-center`}>
            <p className="text-3xl font-black">{myStats.criticalTasks}</p>
            <p className="text-indigo-200 text-sm">Ø­Ø±Ø¬Ø©</p>
          </div>
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
            <p className="text-3xl font-black">{myStats.pendingApprovalsCount}</p>
            <p className="text-indigo-200 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙŠ</p>
          </div>
          <div className={`${myStats.unreadNotifications > 0 ? 'bg-blue-500/50' : 'bg-white/10'} backdrop-blur-sm rounded-xl p-4 text-center`}>
            <p className="text-3xl font-black">{myStats.unreadNotifications}</p>
            <p className="text-indigo-200 text-sm">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
          </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="flex border-b border-slate-200">
          {tabs.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-6 py-4 font-bold transition-all border-b-2 ${activeTab === tab.id ? 'text-indigo-600 border-indigo-500 bg-indigo-50' : 'text-slate-500 border-transparent hover:bg-slate-50'
                }`}>
              <tab.icon className="w-5 h-5" />
              {tab.label}
              {tab.count > 0 && (
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${activeTab === tab.id ? 'bg-indigo-500 text-white' : 'bg-slate-200 text-slate-600'}`}>
                  {tab.count}
                </span>
              )}
            </button>
          ))}
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: MY DASHBOARD
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'mydashboard' && (
          <div className="p-6 space-y-6">
            {(myStats.overdueTasks > 0 || myStats.criticalTasks > 0) && (
              <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-5 border-2 border-red-200">
                <h3 className="font-bold text-red-800 mb-4 flex items-center gap-2">
                  <AlertTriangle className="w-5 h-5" />ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ø§Ø¬Ù„Ø© ØªØªØ·Ù„Ø¨ Ø§Ù†ØªØ¨Ø§Ù‡Ùƒ
                </h3>
                <div className="space-y-3">
                  {myTasks.filter(t => (new Date(t.dueDate) < new Date() && t.status !== 'Completed') || t.priority === 'Critical').slice(0, 3).map(task => (
                    <div key={task.id} className={`flex items-center justify-between p-4 rounded-xl border-2 ${new Date(task.dueDate) < new Date() ? 'bg-red-100 border-red-300' : 'bg-orange-100 border-orange-300'
                      }`}>
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${new Date(task.dueDate) < new Date() ? 'bg-red-500' : 'bg-orange-500'
                          } text-white`}>
                          {React.createElement(TYPE_CONFIG[task.type]?.icon || FileText, { className: 'w-5 h-5' })}
                        </div>
                        <div>
                          <p className="font-bold text-slate-800">{task.title}</p>
                          <p className="text-sm text-slate-500">{task.refCode} â€¢ {new Date(task.dueDate) < new Date() ? 'Ù…ØªØ£Ø®Ø±' : 'Ø­Ø±Ø¬'}</p>
                        </div> </div>
                      <button onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                        className="px-4 py-2 bg-white border-2 border-slate-300 rounded-xl font-bold text-slate-700 hover:bg-slate-50">
                        Ø¹Ø±Ø¶
                      </button> </div>
                  ))}
                </div> </div>
            )}

            <div className="grid grid-cols-4 gap-4">
              <button onClick={() => setActiveTab('mytasks')} className="bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl p-5 text-right hover:shadow-lg transition-all">
                <ClipboardList className="w-8 h-8 mb-3" />
                <p className="text-2xl font-black">{myStats.inProgressTasks}</p>
                <p className="text-blue-100">Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„</p>
              </button>
              <button onClick={() => setActiveTab('approvals')} className="bg-gradient-to-br from-purple-500 to-violet-600 text-white rounded-2xl p-5 text-right hover:shadow-lg transition-all">
                <CheckCircle2 className="w-8 h-8 mb-3" />
                <p className="text-2xl font-black">{myStats.pendingApprovalsCount}</p>
                <p className="text-purple-100">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙŠ</p>
              </button>
              <button onClick={() => setActiveTab('notifications')} className="bg-gradient-to-br from-cyan-500 to-blue-600 text-white rounded-2xl p-5 text-right hover:shadow-lg transition-all">
                <Bell className="w-8 h-8 mb-3" />
                <p className="text-2xl font-black">{myStats.unreadNotifications}</p>
                <p className="text-cyan-100">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
              </button>
              <button onClick={() => setActiveTab('mycalendar')} className="bg-gradient-to-br from-emerald-500 to-teal-600 text-white rounded-2xl p-5 text-right hover:shadow-lg transition-all">
                <Calendar className="w-8 h-8 mb-3" />
                <p className="text-2xl font-black">{myStats.thisWeekTasks}</p>
                <p className="text-emerald-100">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
              </button> </div>
            <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-bold text-slate-800 flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-indigo-500" />Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…
                </h3>
                <button onClick={() => { setTaskFilter('today'); setActiveTab('mytasks'); }}
                  className="text-indigo-600 font-bold text-sm hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
              </div>
              <div className="space-y-3">
                {myTasks.filter(t => new Date(t.dueDate).toDateString() === new Date().toDateString()).length === 0 ? (
                  <div className="text-center py-8 text-slate-400">
                    <CheckCircle2 className="w-12 h-12 mx-auto mb-2 text-emerald-300" />
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø³ØªØ­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ‰</p>
                  </div>
                ) : (
                  myTasks.filter(t => new Date(t.dueDate).toDateString() === new Date().toDateString()).map(task => (
                    <div key={task.id} onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                      className="flex items-center gap-4 p-4 bg-slate-50 rounded-xl border border-slate-200 hover:border-indigo-300 cursor-pointer transition-all">
                      <div className={`w-12 h-12 rounded-xl bg-${TYPE_CONFIG[task.type]?.color || 'slate'}-100 flex items-center justify-center`}>
                        {React.createElement(TYPE_CONFIG[task.type]?.icon || FileText, { className: `w-6 h-6 text-${TYPE_CONFIG[task.type]?.color || 'slate'}-600` })}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-mono text-xs font-bold text-slate-500">{task.refCode}</span>
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${PRIORITY_CONFIG[task.priority]?.light} ${PRIORITY_CONFIG[task.priority]?.text}`}>
                            {PRIORITY_CONFIG[task.priority]?.label}
                          </span> </div>
                        <p className="font-bold text-slate-800">{task.title}</p>
                        <div className="flex items-center gap-4 mt-1">
                          <span className={`px-2 py-0.5 rounded text-xs font-bold ${STATUS_CONFIG[task.status]?.bg} ${STATUS_CONFIG[task.status]?.text}`}>
                            {STATUS_CONFIG[task.status]?.label}
                          </span>
                          {task.progress > 0 && (
                            <div className="flex items-center gap-2">
                              <div className="w-20 h-2 bg-slate-200 rounded-full">
                                <div className="h-full bg-indigo-500 rounded-full" style={{ width: `${task.progress}%` }} />
                              </div>
                              <span className="text-xs font-bold text-slate-500">{task.progress}%</span>
                            </div>
                          )}
                        </div> </div>
                      <ChevronLeft className="w-5 h-5 text-slate-400" />
                    </div>))
                )}
              </div> </div>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-bold text-slate-800 flex items-center gap-2">
                    <Bell className="w-5 h-5 text-blue-500" />Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                  </h3>
                  <button onClick={() => setActiveTab('notifications')}
                    className="text-indigo-600 font-bold text-sm hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
                </div>
                <div className="space-y-2">
                  {notifications.slice(0, 4).map(notif => (
                    <div key={notif.id} className={`p-3 rounded-xl border ${notif.read ? 'bg-slate-50 border-slate-200' : 'bg-blue-50 border-blue-200'}`}>
                      <div className="flex items-start gap-3">
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${PRIORITY_CONFIG[notif.priority]?.light}`}>
                          <Bell className={`w-4 h-4 ${PRIORITY_CONFIG[notif.priority]?.text}`} />
                        </div>
                        <div className="flex-1">
                          <p className={`font-bold text-sm ${notif.read ? 'text-slate-600' : 'text-slate-800'}`}>{notif.title}</p>
                          <p className="text-xs text-slate-500">{notif.time}</p>
                        </div>
                        {!notif.read && <div className="w-2 h-2 bg-blue-500 rounded-full" />}
                      </div> </div>
                  ))}
                </div> </div>
              <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-bold text-slate-800 flex items-center gap-2">
                    <CheckCircle2 className="w-5 h-5 text-purple-500" />Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙŠ
                  </h3>
                  <button onClick={() => setActiveTab('approvals')}
                    className="text-indigo-600 font-bold text-sm hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
                </div>
                <div className="space-y-2">
                  {pendingApprovals.slice(0, 4).map(approval => (
                    <div key={approval.id} className="p-3 rounded-xl border border-slate-200 bg-slate-50">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`w-8 h-8 rounded-lg bg-${TYPE_CONFIG[approval.type]?.color || 'slate'}-100 flex items-center justify-center`}>
                            {React.createElement(TYPE_CONFIG[approval.type]?.icon || FileText, { className: `w-4 h-4 text-${TYPE_CONFIG[approval.type]?.color || 'slate'}-600` })}
                          </div>
                          <div>
                            <p className="font-bold text-sm text-slate-800">{approval.title}</p>
                            <p className="text-xs text-slate-500">Ù…Ù†: {approval.requestedBy}</p>
                          </div> </div>
                        <span className={`px-2 py-0.5 rounded text-xs font-bold ${PRIORITY_CONFIG[approval.priority]?.light} ${PRIORITY_CONFIG[approval.priority]?.text}`}>
                          {PRIORITY_CONFIG[approval.priority]?.label}
                        </span> </div> </div>
                  ))}
                </div> </div> </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: MY TASKS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'mytasks' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <div className="flex gap-2">
                {[
                  { id: 'all', label: 'Ø§Ù„ÙƒÙ„', count: myTasks.length },
                  { id: 'today', label: 'Ø§Ù„ÙŠÙˆÙ…', count: myTasks.filter(t => new Date(t.dueDate).toDateString() === new Date().toDateString()).length },
                  { id: 'overdue', label: 'Ù…ØªØ£Ø®Ø±Ø©', count: myStats.overdueTasks },
                  { id: 'critical', label: 'Ø­Ø±Ø¬Ø©', count: myStats.criticalTasks },
                  { id: 'inprogress', label: 'Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„', count: myStats.inProgressTasks },
                  { id: 'pending', label: 'Ù…Ø¹Ù„Ù‚Ø©', count: myTasks.filter(t => t.status === 'Open' || t.status === 'Scheduled').length },
                ].map(filter => (
                  <button key={filter.id} onClick={() => setTaskFilter(filter.id)}
                    className={`px-4 py-2 rounded-xl font-bold transition-all ${taskFilter === filter.id ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                      }`}>
                    {filter.label} ({filter.count})
                  </button>
                ))}
              </div> </div>
            <div className="space-y-3">
              {filteredTasks.length === 0 ? (
                <div className="text-center py-16 text-slate-400">
                  <CheckCircle2 className="w-16 h-16 mx-auto mb-4 text-emerald-300" />
                  <p className="text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</p>
                </div>
              ) : (
                filteredTasks.map(task => {
                  const isOverdue = new Date(task.dueDate) < new Date() && task.status !== 'Completed';
                  const daysUntilDue = Math.ceil((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24));

                  return (
                    <div key={task.id}
                      className={`bg-white rounded-2xl border-2 p-5 transition-all hover:shadow-lg cursor-pointer ${isOverdue ? 'border-red-300 bg-red-50' : 'border-slate-200 hover:border-indigo-300'
                        }`}
                      onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}>
                      <div className="flex items-start gap-4">
                        <div className={`w-14 h-14 rounded-2xl bg-${TYPE_CONFIG[task.type]?.color || 'slate'}-100 flex items-center justify-center flex-shrink-0`}>
                          {React.createElement(TYPE_CONFIG[task.type]?.icon || FileText, { className: `w-7 h-7 text-${TYPE_CONFIG[task.type]?.color || 'slate'}-600` })}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-sm font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">{task.refCode}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${PRIORITY_CONFIG[task.priority]?.light} ${PRIORITY_CONFIG[task.priority]?.text}`}>
                              {PRIORITY_CONFIG[task.priority]?.label}
                            </span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold bg-${TYPE_CONFIG[task.type]?.color || 'slate'}-100 text-${TYPE_CONFIG[task.type]?.color || 'slate'}-700`}>
                              {TYPE_CONFIG[task.type]?.label}
                            </span> </div>
                          <h4 className="font-bold text-slate-800 text-lg">{task.title}</h4>
                          <p className="text-slate-500 text-sm mt-1">{task.description}</p>

                          <div className="flex items-center gap-6 mt-3">
                            <span className={`px-3 py-1 rounded-lg text-sm font-bold ${STATUS_CONFIG[task.status]?.bg} ${STATUS_CONFIG[task.status]?.text}`}>
                              {STATUS_CONFIG[task.status]?.label}
                            </span>
                            <span className={`text-sm font-bold ${isOverdue ? 'text-red-600' : daysUntilDue <= 3 ? 'text-orange-600' : 'text-slate-500'}`}>
                              <Clock className="w-4 h-4 inline ml-1" />
                              {isOverdue ? `Ù…ØªØ£Ø®Ø± ${Math.abs(daysUntilDue)} ÙŠÙˆÙ…` : daysUntilDue === 0 ? 'Ø§Ù„ÙŠÙˆÙ…' : `${daysUntilDue} ÙŠÙˆÙ…`}
                            </span>
                            <span className="text-sm text-slate-500">
                              <User className="w-4 h-4 inline ml-1" />{task.assignedBy}
                            </span>
                            {task.comments > 0 && (
                              <span className="text-sm text-slate-500">
                                <MessageSquare className="w-4 h-4 inline ml-1" />{task.comments} ØªØ¹Ù„ÙŠÙ‚
                              </span>
                            )}
                          </div>

                          {task.progress > 0 && (
                            <div className="mt-3 flex items-center gap-3">
                              <div className="flex-1 h-2 bg-slate-100 rounded-full">
                                <div className={`h-full rounded-full ${task.progress === 100 ? 'bg-emerald-500' : 'bg-indigo-500'}`}
                                  style={{ width: `${task.progress}%` }} />
                              </div>
                              <span className="text-sm font-bold text-slate-600">{task.progress}%</span>
                            </div>
                          )}
                        </div>
                        <ChevronLeft className="w-6 h-6 text-slate-300" />
                      </div> </div>);
                })
              )}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: APPROVALS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'approvals' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-xl font-bold text-slate-800">Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙŠ</h3>
              <span className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-bold">
                {pendingApprovals.length} Ø·Ù„Ø¨
              </span> </div>
            {pendingApprovals.length === 0 ? (
              <div className="text-center py-16 text-slate-400">
                <CheckCircle2 className="w-16 h-16 mx-auto mb-4 text-emerald-300" />
                <p className="text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© ğŸ‰</p>
              </div>
            ) : (
              <div className="space-y-4">
                {pendingApprovals.map(approval => (
                  <div key={approval.id} className="bg-white rounded-2xl border-2 border-slate-200 p-6">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-4">
                        <div className={`w-14 h-14 rounded-2xl bg-${TYPE_CONFIG[approval.type]?.color || 'slate'}-100 flex items-center justify-center`}>
                          {React.createElement(TYPE_CONFIG[approval.type]?.icon || FileText, { className: `w-7 h-7 text-${TYPE_CONFIG[approval.type]?.color || 'slate'}-600` })}
                        </div>
                        <div>
                          <div className="flex items-center gap-2 mb-1">
                            <span className="font-mono text-sm font-bold text-purple-600 bg-purple-50 px-2 py-0.5 rounded">{approval.refCode}</span>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${PRIORITY_CONFIG[approval.priority]?.light} ${PRIORITY_CONFIG[approval.priority]?.text}`}>
                              {PRIORITY_CONFIG[approval.priority]?.label}
                            </span> </div>
                          <h4 className="font-bold text-slate-800 text-lg">{approval.title}</h4>
                          <p className="text-slate-500 mt-1">
                            Ø·Ù„Ø¨ Ù…Ù†: <strong>{approval.requestedBy}</strong> â€¢ {approval.requestedDate}
                          </p> </div> </div>
                      <div className="flex items-center gap-3">
                        <button onClick={() => handleApprove(approval.id, 'reject', '')}
                          className="px-5 py-2.5 border-2 border-red-300 text-red-600 rounded-xl font-bold hover:bg-red-50">
                          <XCircle className="w-5 h-5 inline ml-2" />Ø±ÙØ¶
                        </button>
                        <button onClick={() => handleApprove(approval.id, 'approve', '')}
                          className="px-5 py-2.5 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600">
                          <CheckCircle2 className="w-5 h-5 inline ml-2" />Ø§Ø¹ØªÙ…Ø§Ø¯
                        </button> </div> </div> </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: NOTIFICATIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'notifications' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-xl font-bold text-slate-800">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
              <button onClick={handleMarkAllAsRead}
                className="px-4 py-2 text-indigo-600 font-bold hover:bg-indigo-50 rounded-xl">
                ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
              </button> </div>
            <div className="space-y-3">
              {notifications.map(notif => (
                <div key={notif.id}
                  onClick={() => handleMarkAsRead(notif.id)}
                  className={`p-5 rounded-2xl border-2 cursor-pointer transition-all ${notif.read ? 'bg-slate-50 border-slate-200' : 'bg-blue-50 border-blue-200 hover:border-blue-300'
                    }`}>
                  <div className="flex items-start gap-4">
                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${PRIORITY_CONFIG[notif.priority]?.light}`}>
                      <Bell className={`w-6 h-6 ${PRIORITY_CONFIG[notif.priority]?.text}`} />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <h4 className={`font-bold ${notif.read ? 'text-slate-600' : 'text-slate-800'}`}>{notif.title}</h4>
                        {!notif.read && <div className="w-2 h-2 bg-blue-500 rounded-full" />}
                      </div>
                      <p className="text-slate-500">{notif.message}</p>
                      <p className="text-sm text-slate-400 mt-2">{notif.time}</p>
                    </div>
                    <span className={`px-2 py-1 rounded text-xs font-bold ${PRIORITY_CONFIG[notif.priority]?.light} ${PRIORITY_CONFIG[notif.priority]?.text}`}>
                      {PRIORITY_CONFIG[notif.priority]?.label}
                    </span> </div> </div>
              ))}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: TEAM - ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'team' && (
          <div className="p-6 space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-xl font-bold text-slate-800">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</h3>
              <button onClick={() => setShowAssignModal(true)}
                className="flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg">
                <UserPlus className="w-5 h-5" />Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button> </div>
            <div className="grid grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-5 text-white">
                <Users className="w-8 h-8 mb-2 text-white/80" />
                <p className="text-3xl font-black">{TEAM_MEMBERS.length}</p>
                <p className="text-indigo-100">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
                <CheckCircle2 className="w-8 h-8 mb-2 text-white/80" />
                <p className="text-3xl font-black">{TEAM_MEMBERS.filter(m => m.workload < m.capacity * 0.7).length}</p>
                <p className="text-emerald-100">Ù…ØªØ§Ø­ Ù„Ù„Ù…Ù‡Ø§Ù…</p>
              </div>
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
                <Clock className="w-8 h-8 mb-2 text-white/80" />
                <p className="text-3xl font-black">{TEAM_MEMBERS.filter(m => m.workload >= m.capacity * 0.7 && m.workload < m.capacity).length}</p>
                <p className="text-amber-100">Ø­Ù…Ù„ Ø¹Ù…Ù„ Ù…Ø±ØªÙØ¹</p>
              </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-5 text-white">
                <AlertTriangle className="w-8 h-8 mb-2 text-white/80" />
                <p className="text-3xl font-black">{TEAM_MEMBERS.filter(m => m.workload >= m.capacity).length}</p>
                <p className="text-red-100">Ø³Ø¹Ø© ÙƒØ§Ù…Ù„Ø©</p>
              </div> </div>
            <div className="grid grid-cols-2 gap-4">
              {TEAM_MEMBERS.map(member => {
                const workloadPercent = Math.round((member.workload / member.capacity) * 100);
                const workloadColor = workloadPercent >= 90 ? 'red' : workloadPercent >= 70 ? 'amber' : 'emerald';

                return (
                  <div key={member.id} className="bg-white rounded-2xl border-2 border-slate-200 p-5 hover:shadow-lg transition-all">
                    <div className="flex items-start gap-4">
                      <div className={`w-14 h-14 rounded-2xl bg-${member.color}-100 flex items-center justify-center text-${member.color}-600 font-black text-xl`}>
                        {member.avatar}
                      </div>
                      <div className="flex-1">
                        <h4 className="font-bold text-slate-800 text-lg">{member.name}</h4>
                        <p className="text-slate-500 text-sm">{member.role}</p>
                        <p className="text-slate-400 text-xs">{member.department}</p>

                        <div className="mt-3">
                          <div className="flex items-center justify-between mb-1">
                            <span className="text-xs text-slate-500">Ø­Ù…Ù„ Ø§Ù„Ø¹Ù…Ù„</span>
                            <span className={`text-xs font-bold text-${workloadColor}-600`}>{member.workload}/{member.capacity} Ù…Ù‡Ø§Ù…</span>
                          </div>
                          <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div className={`h-full bg-${workloadColor}-500 rounded-full transition-all`}
                              style={{ width: `${workloadPercent}%` }} />
                          </div> </div> </div>
                      <button
                        onClick={() => { setAssignFormData({ ...assignFormData, assigneeId: member.id }); setShowAssignModal(true); }}
                        className={`px-3 py-2 rounded-xl font-bold text-sm transition-all ${workloadPercent >= 100
                          ? 'bg-slate-100 text-slate-400 cursor-not-allowed'
                          : 'bg-indigo-100 text-indigo-600 hover:bg-indigo-200'
                          }`}
                        disabled={workloadPercent >= 100}>
                        <Plus className="w-4 h-4" />
                      </button> </div> </div>);
              })}
            </div> </div>
        )}

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TAB: MY CALENDAR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {activeTab === 'mycalendar' && (
          <div className="p-6 space-y-6">
            <h3 className="text-xl font-bold text-slate-800">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)</h3>

            <div className="space-y-4">
              {[...Array(7)].map((_, dayOffset) => {
                const date = new Date();
                date.setDate(date.getDate() + dayOffset);
                const dateStr = date.toISOString().split('T')[0];
                const dayTasks = myTasks.filter(t => t.dueDate === dateStr);
                const isToday = dayOffset === 0;

                return (
                  <div key={dayOffset} className={`rounded-2xl border-2 p-5 ${isToday ? 'border-indigo-300 bg-indigo-50' : 'border-slate-200 bg-white'}`}>
                    <div className="flex items-center gap-4 mb-4">
                      <div className={`w-14 h-14 rounded-2xl flex flex-col items-center justify-center ${isToday ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600'}`}>
                        <span className="text-xs font-bold">{date.toLocaleDateString('ar-SA', { weekday: 'short' })}</span>
                        <span className="text-lg font-black">{date.getDate()}</span>
                      </div>
                      <div>
                        <p className={`font-bold ${isToday ? 'text-indigo-700' : 'text-slate-700'}`}>
                          {isToday ? 'Ø§Ù„ÙŠÙˆÙ…' : date.toLocaleDateString('ar-SA', { weekday: 'long' })}
                        </p>
                        <p className="text-sm text-slate-500">{dayTasks.length} Ù…Ù‡Ø§Ù…</p>
                      </div> </div>
                    {dayTasks.length > 0 ? (
                      <div className="space-y-2 mr-18">
                        {dayTasks.map(task => (
                          <div key={task.id} onClick={() => { setSelectedTask(task); setShowTaskModal(true); }}
                            className="flex items-center gap-3 p-3 bg-white rounded-xl border border-slate-200 hover:border-indigo-300 cursor-pointer">
                            <div className={`w-3 h-3 rounded-full ${PRIORITY_CONFIG[task.priority]?.bg}`} />
                            <div className="flex-1">
                              <p className="font-bold text-slate-800 text-sm">{task.title}</p>
                              <p className="text-xs text-slate-500">{task.refCode}</p>
                            </div>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold ${STATUS_CONFIG[task.status]?.bg} ${STATUS_CONFIG[task.status]?.text}`}>
                              {STATUS_CONFIG[task.status]?.label}
                            </span> </div>
                        ))}
                      </div>
                    ) : (
                      <p className="text-slate-400 text-sm mr-18">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</p>
                    )}
                  </div>);
              })}
            </div> </div>
        )}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          TASK DETAIL MODAL
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showTaskModal && selectedTask && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <div className={`bg-gradient-to-l from-${TYPE_CONFIG[selectedTask.type]?.color || 'slate'}-500 to-${TYPE_CONFIG[selectedTask.type]?.color || 'slate'}-600 px-6 py-5 text-white`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center">
                    {React.createElement(TYPE_CONFIG[selectedTask.type]?.icon || FileText, { className: 'w-7 h-7' })}
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-mono text-sm bg-white/20 px-2 py-0.5 rounded">{selectedTask.refCode}</span>
                      <span className={`px-2 py-0.5 rounded text-xs font-bold bg-white/30`}>
                        {TYPE_CONFIG[selectedTask.type]?.label}
                      </span> </div>
                    <h2 className="text-xl font-bold">{selectedTask.title}</h2>
                  </div> </div>
                <button onClick={() => setShowTaskModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 max-h-[60vh] overflow-y-auto space-y-6">
              <div className="flex items-center gap-4">
                <span className={`px-4 py-2 rounded-xl font-bold ${STATUS_CONFIG[selectedTask.status]?.bg} ${STATUS_CONFIG[selectedTask.status]?.text}`}>
                  {STATUS_CONFIG[selectedTask.status]?.label}
                </span>
                <span className={`px-4 py-2 rounded-xl font-bold ${PRIORITY_CONFIG[selectedTask.priority]?.light} ${PRIORITY_CONFIG[selectedTask.priority]?.text}`}>
                  Ø£ÙˆÙ„ÙˆÙŠØ©: {PRIORITY_CONFIG[selectedTask.priority]?.label}
                </span>
                <span className="px-4 py-2 bg-slate-100 text-slate-700 rounded-xl font-bold">
                  Ø§Ù„ÙØ¦Ø©: {selectedTask.category}
                </span> </div>
              <div className="bg-slate-50 rounded-xl p-4">
                <h4 className="font-bold text-slate-700 mb-2">Ø§Ù„ÙˆØµÙ</h4>
                <p className="text-slate-600">{selectedTask.description}</p>
              </div>

              {selectedTask.progress !== undefined && (
                <div>
                  <div className="flex items-center justify-between mb-2">
                    <h4 className="font-bold text-slate-700">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h4>
                    <span className="font-bold text-indigo-600">{selectedTask.progress}%</span>
                  </div>
                  <div className="h-4 bg-slate-100 rounded-full">
                    <div className={`h-full rounded-full ${selectedTask.progress === 100 ? 'bg-emerald-500' : 'bg-indigo-500'}`}
                      style={{ width: `${selectedTask.progress}%` }} />
                  </div> </div>
              )}

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</p>
                  <p className={`font-bold ${new Date(selectedTask.dueDate) < new Date() ? 'text-red-600' : 'text-slate-800'}`}>
                    {selectedTask.dueDate}
                  </p> </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ù…ÙˆÙƒÙ„Ø© Ù…Ù†</p>
                  <p className="font-bold text-slate-800">{selectedTask.assignedBy}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯</p>
                  <p className="font-bold text-slate-800">{selectedTask.assignedDate}</p>
                </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</p>
                  <p className="font-bold text-slate-800">{selectedTask.comments} ØªØ¹Ù„ÙŠÙ‚</p>
                </div> </div>
              <div className="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                <h4 className="font-bold text-indigo-800 mb-3">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</h4>
                <div className="flex gap-2 flex-wrap">
                  {['Open', 'InProgress', 'PendingApproval', 'Completed'].map(status => (
                    <button key={status}
                      onClick={() => {
                        handleUpdateTaskStatus(selectedTask.id, status, status === 'Completed' ? 100 : selectedTask.progress);
                        setSelectedTask({ ...selectedTask, status, progress: status === 'Completed' ? 100 : selectedTask.progress });
                      }}
                      className={`px-4 py-2 rounded-xl font-bold transition-all ${selectedTask.status === status
                        ? 'bg-indigo-500 text-white'
                        : 'bg-white border border-slate-200 text-slate-600 hover:border-indigo-300'
                        }`}>
                      {STATUS_CONFIG[status]?.label}
                    </button>
                  ))}
                </div> </div>
              <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <h4 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                  <MessageSquare className="w-4 h-4" />Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ({selectedTask.comments})
                </h4>
                <div className="space-y-3 max-h-32 overflow-y-auto mb-3">
                  {selectedTask.comments > 0 ? (
                    <>
                      <div className="bg-white rounded-lg p-3 border border-slate-200">
                        <div className="flex items-center gap-2 mb-1">
                          <div className="w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold">Ø£</div>
                          <span className="font-bold text-sm text-slate-700">Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</span>
                          <span className="text-xs text-slate-400">â€¢ Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†</span>
                        </div>
                        <p className="text-sm text-slate-600 mr-8">ØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«.</p>
                      </div>
                      {selectedTask.comments > 1 && (
                        <div className="bg-white rounded-lg p-3 border border-slate-200">
                          <div className="flex items-center gap-2 mb-1">
                            <div className="w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 text-xs font-bold">Ø³</div>
                            <span className="font-bold text-sm text-slate-700">Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ</span>
                            <span className="text-xs text-slate-400">â€¢ Ù…Ù†Ø° 30 Ø¯Ù‚ÙŠÙ‚Ø©</span>
                          </div>
                          <p className="text-sm text-slate-600 mr-8">ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚ÙŠ.</p>
                        </div>
                      )}
                    </>
                  ) : (
                    <p className="text-sm text-slate-400 text-center py-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª</p>
                  )}
                </div>
                <div className="flex gap-2">
                  <input type="text" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..."
                    className="flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:border-indigo-500 focus:outline-none" />
                  <button className="px-4 py-2 bg-indigo-500 text-white rounded-lg font-bold text-sm hover:bg-indigo-600">
                    <Send className="w-4 h-4" />
                  </button> </div> </div>
              {selectedTask.canDelegate && (
                <button onClick={() => { setShowDelegateModal(true); }}
                  className="w-full py-3 bg-amber-100 text-amber-700 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-amber-200 border-2 border-amber-200">
                  <RefreshCw className="w-5 h-5" />ØªÙÙˆÙŠØ¶ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ø´Ø®Øµ Ø¢Ø®Ø±
                </button>
              )}
            </div>

            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowTaskModal(false)}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥ØºÙ„Ø§Ù‚
              </button>
              <button onClick={() => { setShowTaskModal(false); }}
                className="px-6 py-3 bg-indigo-500 text-white rounded-xl font-bold">
                Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          TASK ASSIGNMENT MODAL - Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showAssignModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-indigo-500 to-purple-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <UserPlus className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                    <p className="text-indigo-200">ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù…Ø© Ù„Ø£Ø­Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</p>
                  </div> </div>
                <button onClick={() => setShowAssignModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5 max-h-[60vh] overflow-y-auto">
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <div className="grid grid-cols-4 gap-2">
                  {[
                    { id: 'obligation', label: 'Ø§Ù„ØªØ²Ø§Ù…', icon: FileText, color: 'indigo' },
                    { id: 'evidence', label: 'Ø¯Ù„ÙŠÙ„', icon: FolderOpen, color: 'emerald' },
                    { id: 'test', label: 'Ø§Ø®ØªØ¨Ø§Ø±', icon: ClipboardCheck, color: 'blue' },
                    { id: 'review', label: 'Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: Eye, color: 'purple' },
                  ].map(type => (
                    <button key={type.id}
                      onClick={() => setAssignFormData({ ...assignFormData, taskType: type.id })}
                      className={`p-3 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${assignFormData.taskType === type.id
                        ? `border-${type.color}-500 bg-${type.color}-50`
                        : 'border-slate-200 hover:border-slate-300'
                        }`}>
                      <type.icon className={`w-6 h-6 text-${type.color}-600`} />
                      <span className="text-sm font-bold">{type.label}</span>
                    </button>
                  ))}
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <input type="text" value={assignFormData.title || ''}
                  onChange={(e) => setAssignFormData({ ...assignFormData, title: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none"
                  placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©" />
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ø¥Ø³Ù†Ø§Ø¯ Ø¥Ù„Ù‰</label>
                <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
                  {TEAM_MEMBERS.filter(m => m.id !== CURRENT_USER.id).map(member => {
                    const workloadPercent = Math.round((member.workload / member.capacity) * 100);
                    const isSelected = assignFormData.assigneeId === member.id;
                    return (
                      <button key={member.id}
                        onClick={() => setAssignFormData({ ...assignFormData, assigneeId: member.id })}
                        disabled={workloadPercent >= 100}
                        className={`p-3 rounded-xl border-2 flex items-center gap-3 transition-all text-right ${isSelected ? 'border-indigo-500 bg-indigo-50' :
                          workloadPercent >= 100 ? 'border-slate-200 bg-slate-50 opacity-50' :
                            'border-slate-200 hover:border-indigo-300'
                          }`}>
                        <div className={`w-10 h-10 rounded-xl bg-${member.color}-100 flex items-center justify-center text-${member.color}-600 font-bold`}>
                          {member.avatar}
                        </div>
                        <div className="flex-1">
                          <p className="font-bold text-slate-800 text-sm">{member.name}</p>
                          <p className="text-xs text-slate-500">{member.workload}/{member.capacity} Ù…Ù‡Ø§Ù…</p>
                        </div>
                        {isSelected && <CheckCircle2 className="w-5 h-5 text-indigo-500" />}
                      </button>);
                  })}
                </div> </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                  <input type="date" value={assignFormData.dueDate || ''}
                    onChange={(e) => setAssignFormData({ ...assignFormData, dueDate: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-2">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                  <select value={assignFormData.priority || 'Medium'}
                    onChange={(e) => setAssignFormData({ ...assignFormData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                    <option value="Critical">Ø­Ø±Ø¬</option><option value="High">Ø¹Ø§Ù„ÙŠ</option><option value="Medium">Ù…ØªÙˆØ³Ø·</option><option value="Low">Ù…Ù†Ø®ÙØ¶</option>
                  </select>
                </div> </div>
              <div>
                <label className="block text-sm font-bold text-slate-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea value={assignFormData.notes || ''}
                  onChange={(e) => setAssignFormData({ ...assignFormData, notes: e.target.value })}
                  rows={3}
                  className="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none resize-none"
                  placeholder="Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ù…ÙƒÙ„Ù" />
              </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50 flex justify-between">
              <button onClick={() => setShowAssignModal(false)}
                className="px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onClick={() => {
                const assignee = TEAM_MEMBERS.find(m => m.id === assignFormData.assigneeId);
                if (assignee && assignFormData.title) {
                  setNotification({ type: 'success', message: `ØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ ${assignee.name} Ø¨Ù†Ø¬Ø§Ø­` });
                  setTimeout(() => setNotification(null), 3000);
                  setShowAssignModal(false);
                  setAssignFormData({ assigneeId: '', dueDate: '', priority: 'Medium', notes: '' });
                }
              }}
                disabled={!assignFormData.assigneeId || !assignFormData.title}
                className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 ${assignFormData.assigneeId && assignFormData.title
                  ? 'bg-indigo-500 text-white hover:bg-indigo-600'
                  : 'bg-slate-200 text-slate-400 cursor-not-allowed'
                  }`}>
                <Send className="w-5 h-5" />Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø©
              </button> </div> </div> </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          DELEGATE MODAL - ØªÙÙˆÙŠØ¶ Ù…Ù‡Ù…Ø©
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
      {showDelegateModal && selectedTask && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-hidden">
            <div className="bg-gradient-to-l from-amber-500 to-orange-600 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <RefreshCw className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
                    <p className="text-amber-100">{selectedTask.refCode}</p>
                  </div> </div>
                <button onClick={() => setShowDelegateModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-5">
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <p className="font-bold text-amber-800">{selectedTask.title}</p>
                <p className="text-sm text-amber-600 mt-1">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: {selectedTask.dueDate}</p>
              </div>

              <div>
                <label className="block text-sm font-bold text-slate-700 mb-3">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø®Øµ Ù„Ù„ØªÙÙˆÙŠØ¶</label>
                <div className="space-y-2 max-h-64 overflow-y-auto">
                  {TEAM_MEMBERS.filter(m => m.id !== CURRENT_USER.id && m.workload < m.capacity).map(member => (
                    <button key={member.id}
                      onClick={() => handleDelegateTask(selectedTask.id, member.id)}
                      className="w-full p-4 rounded-xl border-2 border-slate-200 flex items-center gap-4 hover:border-amber-300 hover:bg-amber-50 transition-all">
                      <div className={`w-12 h-12 rounded-xl bg-${member.color}-100 flex items-center justify-center text-${member.color}-600 font-bold text-lg`}>
                        {member.avatar}
                      </div>
                      <div className="flex-1 text-right">
                        <p className="font-bold text-slate-800">{member.name}</p>
                        <p className="text-sm text-slate-500">{member.role}</p>
                      </div>
                      <div className="text-left">
                        <p className="text-sm font-bold text-slate-600">{member.workload}/{member.capacity}</p>
                        <p className="text-xs text-slate-400">Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ©</p>
                      </div> </button>
                  ))}
                </div> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => setShowDelegateModal(false)}
                className="w-full px-6 py-3 border-2 border-slate-300 text-slate-700 rounded-xl font-bold">
                Ø¥Ù„ØºØ§Ø¡
              </button> </div> </div> </div>
      )}
    </div>);
};

// Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Main Application)

// Module: Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Audit Trail) - FULLY INTERACTIVE

const AuditTrailModule = ({ auditTrail, setAuditTrail, currentUser }) => {
  // States for filtering and search
  const [searchQuery, setSearchQuery] = useState('');
  const [filterAction, setFilterAction] = useState('all');
  const [filterModule, setFilterModule] = useState('all');
  const [filterUser, setFilterUser] = useState('all');
  const [filterDateFrom, setFilterDateFrom] = useState('');
  const [filterDateTo, setFilterDateTo] = useState('');
  const [selectedLog, setSelectedLog] = useState(null);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [notification, setNotification] = useState(null);
  const itemsPerPage = 10;

  // Action types
  const ACTION_TYPES = [
    { id: 'CREATE', label: 'Ø¥Ù†Ø´Ø§Ø¡', color: 'emerald' },
    { id: 'UPDATE', label: 'ØªØ­Ø¯ÙŠØ«', color: 'blue' },
    { id: 'DELETE', label: 'Ø­Ø°Ù', color: 'red' },
    { id: 'APPROVE', label: 'Ø§Ø¹ØªÙ…Ø§Ø¯', color: 'purple' },
    { id: 'REJECT', label: 'Ø±ÙØ¶', color: 'rose' },
    { id: 'ASSIGN', label: 'Ø¥Ø³Ù†Ø§Ø¯', color: 'amber' },
    { id: 'UPLOAD', label: 'Ø±ÙØ¹', color: 'cyan' },
    { id: 'DOWNLOAD', label: 'ØªØ­Ù…ÙŠÙ„', color: 'teal' },
    { id: 'LOGIN', label: 'Ø¯Ø®ÙˆÙ„', color: 'indigo' },
    { id: 'LOGOUT', label: 'Ø®Ø±ÙˆØ¬', color: 'slate' },
  ];

  // Module types
  const MODULE_TYPES = ['obligations', 'evidence', 'violations', 'tasks', 'policies', 'tests', 'incidents', 'users'];

  // Get unique users from audit trail
  const uniqueUsers = [...new Set(auditTrail.map(log => log.userName))];

  const filteredLogs = useMemo(() => {
    return auditTrail.filter(log => {
      // Search filter
      const matchesSearch = searchQuery === '' ||
        log.details?.toLowerCase().includes(searchQuery.toLowerCase()) ||
        log.itemId?.toLowerCase().includes(searchQuery.toLowerCase()) ||
        log.userName?.toLowerCase().includes(searchQuery.toLowerCase());

      // Action filter
      const matchesAction = filterAction === 'all' || log.action === filterAction;

      // Module filter
      const matchesModule = filterModule === 'all' || log.module === filterModule;

      // User filter
      const matchesUser = filterUser === 'all' || log.userName === filterUser;

      // Date filter
      const logDate = new Date(log.timestamp);
      const matchesDateFrom = !filterDateFrom || logDate >= new Date(filterDateFrom);
      const matchesDateTo = !filterDateTo || logDate <= new Date(filterDateTo + 'T23:59:59');

      return matchesSearch && matchesAction && matchesModule && matchesUser && matchesDateFrom && matchesDateTo;
    });
  }, [auditTrail, searchQuery, filterAction, filterModule, filterUser, filterDateFrom, filterDateTo]);

  // Pagination
  const totalPages = Math.ceil(filteredLogs.length / itemsPerPage);
  const paginatedLogs = filteredLogs.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

  const stats = useMemo(() => ({
    total: filteredLogs.length,
    create: filteredLogs.filter(l => l.action === 'CREATE').length,
    update: filteredLogs.filter(l => l.action === 'UPDATE').length,
    approve: filteredLogs.filter(l => l.action === 'APPROVE').length,
    assign: filteredLogs.filter(l => l.action === 'ASSIGN').length,
    delete: filteredLogs.filter(l => l.action === 'DELETE').length,
  }), [filteredLogs]);

  // Export to CSV
  const handleExportCSV = () => {
    const data = filteredLogs.map(log => ({
      'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(log.timestamp).toLocaleDateString('ar-SA'),
      'Ø§Ù„ÙˆÙ‚Øª': new Date(log.timestamp).toLocaleTimeString('ar-SA'),
      'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': log.userName,
      'Ø§Ù„Ø¹Ù…Ù„ÙŠØ©': ACTION_TYPES.find(a => a.id === log.action)?.label || log.action,
      'Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„': log.module, 'Ø§Ù„Ø¹Ù†ØµØ±': log.itemId,
      'Ø§Ù„ØªÙØ§ØµÙŠÙ„': log.details
    }));
    ExportUtils.toCSV(data, `audit-trail-${new Date().toISOString().split('T')[0]}.csv`);
    setNotification({ type: 'success', message: 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­' });
    setTimeout(() => setNotification(null), 3000);
  };

  // Export to PDF
  const handleExportPDF = () => {
    const headers = ['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„', 'Ø§Ù„Ø¹Ù†ØµØ±', 'Ø§Ù„ØªÙØ§ØµÙŠÙ„'];
    const rows = filteredLogs.slice(0, 50).map(log => [
      new Date(log.timestamp).toLocaleDateString('ar-SA'),
      log.userName,
      ACTION_TYPES.find(a => a.id === log.action)?.label || log.action,
      log.module,
      log.itemId,
      log.details?.substring(0, 50) || ''
    ]);
    const tableHtml = ExportUtils.createTable(headers, rows);
    ExportUtils.toPDF('Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', `<p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${filteredLogs.length}</p>${tableHtml}`);
  };

  // Clear filters
  const clearFilters = () => {
    setSearchQuery('');
    setFilterAction('all');
    setFilterModule('all');
    setFilterUser('all');
    setFilterDateFrom('');
    setFilterDateTo('');
    setCurrentPage(1);
  };

  // Add test log (for demo)
  const addTestLog = () => {
    const actions = ['CREATE', 'UPDATE', 'APPROVE', 'ASSIGN', 'UPLOAD'];
    const modules = ['obligations', 'evidence', 'violations', 'tasks'];
    const newLog = {
      id: auditTrail.length + 1,
      action: actions[Math.floor(Math.random() * actions.length)],
      module: modules[Math.floor(Math.random() * modules.length)],
      itemId: `TST-${Date.now().toString().slice(-6)}`, itemTitle: 'Ø¹Ù†ØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠ', userId: currentUser?.id || 5,
      userName: currentUser?.name || 'Ù…Ø³ØªØ®Ø¯Ù…', timestamp: new Date(),
      details: 'Ø¹Ù…Ù„ÙŠØ© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… - ' + new Date().toLocaleTimeString('ar-SA')
    };
    setAuditTrail([newLog, ...auditTrail]);
    setNotification({ type: 'success', message: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯' });
    setTimeout(() => setNotification(null), 3000);
  };

  return (
    <div className="space-y-6">
      {notification && (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg font-bold ${notification.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'
          }`}>
          {notification.message}
        </div>
      )}

      <div className="bg-gradient-to-l from-slate-700 via-slate-800 to-slate-900 rounded-3xl p-6 text-white shadow-xl">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-sm">
              <History className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-2xl font-black">Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h1>
              <p className="text-slate-300">Audit Trail - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            </div> </div>
          <div className="flex items-center gap-3">
            <button onClick={addTestLog}
              className="flex items-center gap-2 px-4 py-2 bg-emerald-500 rounded-xl hover:bg-emerald-600 font-bold">
              <Plus className="w-5 h-5" />Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ
            </button>
            <button onClick={handleExportCSV}
              className="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-xl hover:bg-white/20 font-bold">
              <Download className="w-5 h-5" />CSV
            </button>
            <button onClick={handleExportPDF}
              className="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-xl hover:bg-white/20 font-bold">
              <FileText className="w-5 h-5" />PDF
            </button> </div> </div> </div>
      <div className="bg-white rounded-2xl border-2 border-slate-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <h3 className="font-bold text-slate-800 flex items-center gap-2">
            <Filter className="w-5 h-5 text-slate-500" />Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©
          </h3>
          <button onClick={clearFilters} className="text-indigo-600 font-bold text-sm hover:underline">
            Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
          </button> </div>
        <div className="grid grid-cols-6 gap-4">
          <div className="col-span-2">
            <label className="block text-sm font-bold text-slate-600 mb-1">Ø¨Ø­Ø«</label>
            <div className="relative">
              <Search className="w-5 h-5 absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" />
              <input type="text" value={searchQuery} onChange={(e) => { setSearchQuery(e.target.value); setCurrentPage(1); }}
                placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª..."
                className="w-full pr-10 pl-4 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
            </div> </div>
          <div>
            <label className="block text-sm font-bold text-slate-600 mb-1">Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
            <select value={filterAction} onChange={(e) => { setFilterAction(e.target.value); setCurrentPage(1); }}
              className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
              <option value="all">Ø§Ù„ÙƒÙ„</option>
              {ACTION_TYPES.map(action => (
                <option key={action.id} value={action.id}>{action.label}</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-bold text-slate-600 mb-1">Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„</label>
            <select value={filterModule} onChange={(e) => { setFilterModule(e.target.value); setCurrentPage(1); }}
              className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none">
              <option value="all">Ø§Ù„ÙƒÙ„</option>
              {MODULE_TYPES.map(mod => (
                <option key={mod} value={mod}>{mod}</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-bold text-slate-600 mb-1">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
            <input type="date" value={filterDateFrom} onChange={(e) => { setFilterDateFrom(e.target.value); setCurrentPage(1); }}
              className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
          </div>
          <div>
            <label className="block text-sm font-bold text-slate-600 mb-1">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
            <input type="date" value={filterDateTo} onChange={(e) => { setFilterDateTo(e.target.value); setCurrentPage(1); }}
              className="w-full px-3 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none" />
          </div> </div>
        {(searchQuery || filterAction !== 'all' || filterModule !== 'all' || filterDateFrom || filterDateTo) && (
          <div className="mt-4 pt-4 border-t border-slate-200">
            <div className="flex items-center gap-2 flex-wrap">
              <span className="text-sm text-slate-500">Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù†Ø´Ø·Ø©:</span>
              {searchQuery && (
                <span className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-bold flex items-center gap-1">
                  Ø¨Ø­Ø«: {searchQuery}
                  <button onClick={() => setSearchQuery('')}><X className="w-4 h-4" /></button>
                </span>
              )}
              {filterAction !== 'all' && (
                <span className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-bold flex items-center gap-1">
                  Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: {ACTION_TYPES.find(a => a.id === filterAction)?.label}
                  <button onClick={() => setFilterAction('all')}><X className="w-4 h-4" /></button>
                </span>
              )}
              {filterModule !== 'all' && (
                <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold flex items-center gap-1">
                  Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„: {filterModule}
                  <button onClick={() => setFilterModule('all')}><X className="w-4 h-4" /></button>
                </span>
              )}
              <span className="text-sm font-bold text-slate-700 mr-4">
                Ø§Ù„Ù†ØªØ§Ø¦Ø¬: {filteredLogs.length} Ù…Ù† {auditTrail.length}
              </span> </div> </div>
        )}
      </div>

      <div className="grid grid-cols-6 gap-4">
        {[
          { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª', value: stats.total, color: 'slate' },
          { label: 'Ø¹Ù…Ù„ÙŠØ§Øª Ø¥Ù†Ø´Ø§Ø¡', value: stats.create, color: 'emerald' },
          { label: 'Ø¹Ù…Ù„ÙŠØ§Øª ØªØ­Ø¯ÙŠØ«', value: stats.update, color: 'blue' },
          { label: 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ø¹ØªÙ…Ø§Ø¯', value: stats.approve, color: 'purple' },
          { label: 'Ø¹Ù…Ù„ÙŠØ§Øª Ø¥Ø³Ù†Ø§Ø¯', value: stats.assign, color: 'amber' },
          { label: 'Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø°Ù', value: stats.delete, color: 'red' },
        ].map((stat, idx) => (
          <div key={idx} className="bg-white rounded-2xl border-2 border-slate-200 p-5">
            <p className={`text-3xl font-black text-${stat.color}-600`}>{stat.value}</p>
            <p className="text-slate-500 text-sm">{stat.label}</p>
          </div>
        ))}
      </div>

      <div className="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden">
        <div className="p-4 border-b border-slate-200 bg-slate-50 flex items-center justify-between">
          <h3 className="font-bold text-slate-800">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ({filteredLogs.length})</h3>
          <span className="text-sm text-slate-500">
            ØµÙØ­Ø© {currentPage} Ù…Ù† {totalPages || 1}
          </span> </div>
        {paginatedLogs.length === 0 ? (
          <div className="p-12 text-center">
            <History className="w-16 h-16 text-slate-300 mx-auto mb-4" />
            <p className="text-slate-500 text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>
            <button onClick={clearFilters} className="mt-4 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-bold">
              Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
            </button> </div>
        ) : (
          <>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-50">
                  <tr>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ØªÙˆÙ‚ÙŠØª</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„Ø¹Ù†ØµØ±</th>
                    <th className="px-4 py-3 text-right text-sm font-bold text-slate-600">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                    <th className="px-4 py-3 text-center text-sm font-bold text-slate-600">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr> </thead>
                <tbody className="divide-y divide-slate-100">
                  {paginatedLogs.map(log => {
                    const actionConfig = ACTION_TYPES.find(a => a.id === log.action);
                    return (
                      <tr key={log.id} className="hover:bg-slate-50">
                        <td className="px-4 py-3 text-sm">
                          <div className="font-mono text-slate-600">{new Date(log.timestamp).toLocaleDateString('ar-SA')}</div>
                          <div className="text-xs text-slate-400">{new Date(log.timestamp).toLocaleTimeString('ar-SA')}</div>
                        </td>
                        <td className="px-4 py-3">
                          <div className="flex items-center gap-2">
                            <div className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-sm">
                              {log.userName?.charAt(0)}
                            </div>
                            <span className="font-bold text-slate-700">{log.userName}</span>
                          </div> </td>
                        <td className="px-4 py-3">
                          <span className={`px-3 py-1 rounded-lg text-xs font-bold bg-${actionConfig?.color || 'slate'}-100 text-${actionConfig?.color || 'slate'}-700`}>
                            {actionConfig?.label || log.action}
                          </span> </td>
                        <td className="px-4 py-3">
                          <span className="px-2 py-1 bg-slate-100 rounded text-sm font-bold text-slate-600">{log.module}</span>
                        </td>
                        <td className="px-4 py-3">
                          <span className="font-mono text-sm text-indigo-600">{log.itemId}</span>
                        </td>
                        <td className="px-4 py-3 text-sm text-slate-600 max-w-xs truncate">{log.details}</td>
                        <td className="px-4 py-3 text-center">
                          <button onClick={() => { setSelectedLog(log); setShowDetailModal(true); }}
                            className="p-2 hover:bg-indigo-100 rounded-lg text-indigo-600" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <Eye className="w-4 h-4" />
                          </button> </td> </tr>);
                  })}
                </tbody> </table> </div>
            {totalPages > 1 && (
              <div className="p-4 border-t border-slate-200 flex items-center justify-between">
                <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1}
                  className={`px-4 py-2 rounded-xl font-bold ${currentPage === 1 ? 'bg-slate-100 text-slate-400' : 'bg-indigo-100 text-indigo-700 hover:bg-indigo-200'}`}>
                  Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <div className="flex items-center gap-2">
                  {[...Array(Math.min(5, totalPages))].map((_, idx) => {
                    const pageNum = idx + 1;
                    return (
                      <button key={pageNum} onClick={() => setCurrentPage(pageNum)}
                        className={`w-10 h-10 rounded-xl font-bold ${currentPage === pageNum ? 'bg-indigo-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                        {pageNum}
                      </button>);
                  })}
                </div>
                <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages}
                  className={`px-4 py-2 rounded-xl font-bold ${currentPage === totalPages ? 'bg-slate-100 text-slate-400' : 'bg-indigo-100 text-indigo-700 hover:bg-indigo-200'}`}>
                  Ø§Ù„ØªØ§Ù„ÙŠ
                </button> </div>
            )}
          </>
        )}
      </div>

      {showDetailModal && selectedLog && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div className="bg-gradient-to-l from-slate-700 to-slate-800 px-6 py-5 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center">
                    <History className="w-6 h-6" />
                  </div>
                  <div>
                    <h2 className="text-xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„</h2>
                    <p className="text-slate-300">{selectedLog.itemId}</p>
                  </div> </div>
                <button onClick={() => setShowDetailModal(false)} className="w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-xl">
                  <X className="w-5 h-5" />
                </button> </div> </div>
            <div className="p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</p>
                  <p className="font-bold text-slate-800">
                    {new Date(selectedLog.timestamp).toLocaleDateString('ar-SA')} - {new Date(selectedLog.timestamp).toLocaleTimeString('ar-SA')}
                  </p> </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                  <div className="flex items-center gap-2">
                    <div className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-sm">
                      {selectedLog.userName?.charAt(0)}
                    </div>
                    <p className="font-bold text-slate-800">{selectedLog.userName}</p>
                  </div> </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</p>
                  <span className={`px-3 py-1 rounded-lg text-sm font-bold bg-${ACTION_TYPES.find(a => a.id === selectedLog.action)?.color || 'slate'}-100 text-${ACTION_TYPES.find(a => a.id === selectedLog.action)?.color || 'slate'}-700`}>
                    {ACTION_TYPES.find(a => a.id === selectedLog.action)?.label || selectedLog.action}
                  </span> </div>
                <div className="bg-slate-50 rounded-xl p-4">
                  <p className="text-sm text-slate-500 mb-1">Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„</p>
                  <p className="font-bold text-slate-800">{selectedLog.module}</p>
                </div> </div>
              <div className="bg-slate-50 rounded-xl p-4">
                <p className="text-sm text-slate-500 mb-1">Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù†ØµØ±</p>
                <p className="font-mono font-bold text-indigo-600">{selectedLog.itemId}</p>
              </div>
              <div className="bg-slate-50 rounded-xl p-4">
                <p className="text-sm text-slate-500 mb-1">Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
                <p className="font-bold text-slate-800">{selectedLog.details}</p>
              </div>
              <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                <p className="text-sm text-amber-700 font-bold flex items-center gap-2">
                  <Info className="w-4 h-4" />Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ Ù…Ø­ÙÙˆØ¸ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø£Ùˆ Ø­Ø°ÙÙ‡ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </p> </div> </div>
            <div className="border-t-2 border-slate-200 px-6 py-4 bg-slate-50">
              <button onClick={() => setShowDetailModal(false)}
                className="w-full px-6 py-3 bg-slate-700 text-white rounded-xl font-bold hover:bg-slate-800">
                Ø¥ØºÙ„Ø§Ù‚
              </button> </div> </div> </div>
      )}
    </div>);
};

const CompliancePlatformInner = () => {
  const [activeScreen, setActiveScreen] = useState('workspace');
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [showNotificationPanel, setShowNotificationPanel] = useState(false);
  const [showQuickActions, setShowQuickActions] = useState(false);

  // CENTRAL NOTIFICATION SYSTEM - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
  const [centralNotifications, setCentralNotifications] = useState([
    { id: 1, type: 'deadline', title: 'ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù‚ØªØ±Ø§Ø¨ Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚', message: 'Ø§Ù„ØªØ²Ø§Ù… SAMA-CYBER-001 ÙŠØ³ØªØ­Ù‚ Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù…', time: new Date(Date.now() - 10 * 60 * 1000), read: false, priority: 'High', link: { screen: 'obligations', id: 1 } },
    { id: 2, type: 'task', title: 'Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙˆÙƒÙ„Ø© Ø¥Ù„ÙŠÙƒ', message: 'ØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© "ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©" Ø¥Ù„ÙŠÙƒ', time: new Date(Date.now() - 30 * 60 * 1000), read: false, priority: 'Critical', link: { screen: 'workspace', tab: 'mytasks' } },
    { id: 3, type: 'approval', title: 'Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯', message: 'Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø³ÙŠØ§Ø³Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙƒ', time: new Date(Date.now() - 60 * 60 * 1000), read: false, priority: 'Medium', link: { screen: 'workspace', tab: 'approvals' } },
    { id: 4, type: 'violation', title: 'Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø³Ø¬Ù„Ø©', message: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ© BRH-2025-006 ÙˆØªÙ… Ø¥Ø³Ù†Ø§Ø¯Ù‡Ø§ Ø¥Ù„ÙŠÙƒ', time: new Date(Date.now() - 2 * 60 * 60 * 1000), read: false, priority: 'Critical', link: { screen: 'violations', id: 6 } },
    { id: 5, type: 'test', title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙØ´Ù„', message: 'ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± TST-2025-003 - ÙŠØªØ·Ù„Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© ÙÙˆØ±ÙŠØ©', time: new Date(Date.now() - 3 * 60 * 60 * 1000), read: true, priority: 'High', link: { screen: 'tests', id: 3 } },
    { id: 6, type: 'evidence', title: 'Ø¯Ù„ÙŠÙ„ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', message: 'ØªÙ… Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ EVD-2025-020 ÙˆÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹ØªÙƒ', time: new Date(Date.now() - 4 * 60 * 60 * 1000), read: true, priority: 'Medium', link: { screen: 'evidence', id: 20 } },
    { id: 7, type: 'system', title: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…', message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ù…ØªØ·Ù„Ø¨Ø§Øª NCA ECC 2.0 Ø¨Ù†Ø¬Ø§Ø­', time: new Date(Date.now() - 24 * 60 * 60 * 1000), read: true, priority: 'Info', link: null },
  ]);

  // AUDIT TRAIL SYSTEM - Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  const [auditTrail, setAuditTrail] = useState([
    { id: 1, action: 'CREATE', module: 'obligations', itemId: 'OBL-001', itemTitle: 'Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯', userId: 5, userName: 'Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000), details: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ²Ø§Ù… SAMA-CYBER-001' },
    { id: 2, action: 'UPDATE', module: 'evidence', itemId: 'EVD-015', itemTitle: 'ØªØ­Ø¯ÙŠØ« Ø¯Ù„ÙŠÙ„', userId: 3, userName: 'Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ', timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), details: 'ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¥Ù„Ù‰ "Ù…Ù‚Ø¨ÙˆÙ„"' },
    { id: 3, action: 'APPROVE', module: 'violations', itemId: 'VIO-001', itemTitle: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥ØºÙ„Ø§Ù‚', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', timestamp: new Date(Date.now() - 3 * 60 * 60 * 1000), details: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© BRH-2025-001' },
    { id: 4, action: 'ASSIGN', module: 'tasks', itemId: 'TSK-010', itemTitle: 'Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø©', userId: 1, userName: 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000), details: 'Ø¥Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…Ø© Ù„Ù€ Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ' },
    { id: 5, action: 'UPLOAD', module: 'evidence', itemId: 'EVD-020', itemTitle: 'Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„', userId: 4, userName: 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø£Ø­Ù…Ø¯', timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000), details: 'Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†' },
  ]);

  // Add to audit trail
  const addAuditLog = (action, module, itemId, itemTitle, details) => {
    const newLog = {
      id: auditTrail.length + 1,
      action,
      module,
      itemId,
      itemTitle,
      userId: currentUser?.id, userName: currentUser?.name, timestamp: new Date(),
      details
    };
    setAuditTrail([newLog, ...auditTrail]);
  };

  // LOCAL STORAGE PERSISTENCE - Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
  useEffect(() => {
    // Save notifications to localStorage
    try {
      localStorage.setItem('grc_notifications', JSON.stringify(centralNotifications));
    } catch (e) { /* localStorage not available */ }
  }, [centralNotifications]);

  useEffect(() => {
    // Load notifications from localStorage on mount
    try {
      const saved = localStorage.getItem('grc_notifications');
      if (saved) {
        const parsed = JSON.parse(saved);
        // Convert date strings back to Date objects
        const withDates = parsed.map(n => ({ ...n, time: new Date(n.time) }));
        setCentralNotifications(withDates);
      }
    } catch (e) { /* localStorage not available */ }
  }, []);

  useEffect(() => {
    // Save audit trail to localStorage
    try {
      localStorage.setItem('grc_audit_trail', JSON.stringify(auditTrail.slice(0, 100))); // Keep last 100
    } catch (e) { /* localStorage not available */ }
  }, [auditTrail]);

  useEffect(() => {
    // Save last active screen
    try {
      localStorage.setItem('grc_last_screen', activeScreen);
    } catch (e) { /* localStorage not available */ }
  }, [activeScreen]);

  // Mark notification as read
  const markNotificationRead = (id) => {
    setCentralNotifications(centralNotifications.map(n => n.id === id ? { ...n, read: true } : n));
  };

  // Mark all notifications as read
  const markAllNotificationsRead = () => {
    setCentralNotifications(centralNotifications.map(n => ({ ...n, read: true })));
  };

  // Get unread count
  const unreadCount = centralNotifications.filter(n => !n.read).length;

  // Format time ago
  const formatTimeAgo = (date) => {
    const seconds = Math.floor((new Date() - date) / 1000);
    if (seconds < 60) return 'Ø§Ù„Ø¢Ù†';
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `${hours} Ø³Ø§Ø¹Ø©`;
    const days = Math.floor(hours / 24);
    return `${days} ÙŠÙˆÙ…`;
  };

  // Use AuthContext
  const { currentUser, can, switchUser, selectEntity, entityContext, getAccessibleEntities, selectedEntityId } = useAuth();

  // Get user's role for display
  const getUserRole = () => {
    const assignments = PermissionService.getUserRoleAssignments(currentUser?.id);
    if (assignments.length === 0) return 'Ù…Ø³ØªØ®Ø¯Ù…';
    const role = IAM_API.roles.find(r => r.id === assignments[0].roleId);
    return role?.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
  };

  // Menu Items - Professional GRC Workflow Order (Sales Ready)
  // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ: Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ â† Ø§Ù„Ø±Ø¨Ø· â† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© â† Ø§Ù„Ù…Ø®Ø§Ø·Ø± â† Ø§Ù„ØªÙˆØ§ØµÙ„ â† Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
  const menuItems = [
    // Ø§Ù„Ù‚Ø³Ù… 0: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©
    // Ø§Ù„Ù‚Ø³Ù… 0: Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ©
    { id: 'workspace', label: 'Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ©', icon: User, num: 0, group: 'personal', highlight: true },

    // Ø§Ù„Ù‚Ø³Ù… 1: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©
    { id: 'dashboard', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', icon: LayoutDashboard, num: 1, group: 'control' },
    { id: 'iam', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', icon: Lock, num: 2, requiredPermission: 'IAM_VIEW', group: 'control' },

    // Ø§Ù„Ù‚Ø³Ù… 1: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    { id: 'divider1', type: 'divider', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„', group: 'compliance' },
    { id: 'saudipack', label: 'Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', icon: Globe, num: 3, group: 'compliance' },
    { id: 'obligations', label: 'Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', icon: FileText, num: 4, group: 'compliance' },
    { id: 'policies', label: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', icon: BookOpen, num: 5, group: 'compliance' },
    { id: 'mapping', label: 'Ø±Ø¨Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¨Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: Link2, num: 6, group: 'compliance' },
    { id: 'evidence', label: 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚', icon: FolderOpen, num: 7, group: 'compliance' },

    // Ø§Ù„Ù‚Ø³Ù… 2: Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±
    { id: 'divider2', type: 'divider', label: 'Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±', group: 'monitoring' },
    { id: 'calendar', label: 'ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', icon: Calendar, num: 8, group: 'monitoring' },
    { id: 'tests', label: 'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø·', icon: ClipboardCheck, num: 9, group: 'monitoring' },
    { id: 'maturity', label: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¶Ø¬ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ', icon: TrendingUp, num: 10, group: 'monitoring' },

    // Ø§Ù„Ù‚Ø³Ù… 3: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø­ÙˆØ§Ø¯Ø«
    { id: 'divider3', type: 'divider', label: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø­ÙˆØ§Ø¯Ø«', group: 'risk' },
    { id: 'incidents', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©', icon: Zap, num: 11, group: 'risk' },
    { id: 'violations', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', icon: AlertTriangle, num: 12, group: 'risk' },

    // Ø§Ù„Ù‚Ø³Ù… 4: Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©
    { id: 'divider4', type: 'divider', label: 'Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', group: 'changes' },
    { id: 'changes', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', icon: RefreshCw, num: 13, group: 'changes' },

    // Ø§Ù„Ù‚Ø³Ù… 5: Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©
    { id: 'divider5', type: 'divider', label: 'Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', group: 'regulatory' },
    { id: 'contact', label: 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ù‚Ø§Ø¨ÙŠØ©', icon: MessageSquare, num: 14, group: 'regulatory' },
    { id: 'inspection', label: 'Ù…Ø±ÙƒØ² Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„ØªÙØªÙŠØ´', icon: Shield, num: 15, group: 'regulatory' },

    // Ø§Ù„Ù‚Ø³Ù… 6: Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    { id: 'divider6', type: 'divider', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', group: 'reports' },
    { id: 'reportsmanagement', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©', icon: FileText, num: 16, group: 'reports' },
    { id: 'institutional', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­ÙŠØ©', icon: BarChart3, num: 17, group: 'reports' },

    // Ø§Ù„Ù‚Ø³Ù… 7: Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    { id: 'divider7', type: 'divider', label: 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', group: 'system' },
    { id: 'audittrail', label: 'Ø³Ø¬Ù„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: History, num: 18, group: 'system' },
  ];

  const renderScreen = () => {
    switch (activeScreen) {
      case 'iam':
        // Route guard for IAM - Admin only
        return can('IAM_VIEW') ? <IdentityAccessManagement /> : (
          <div className="flex flex-col items-center justify-center h-96 text-center">
            <Lock className="w-16 h-16 text-red-300 mb-4" />
            <h2 className="text-xl font-bold text-slate-700 mb-2">ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„</h2>
            <p className="text-slate-500">ÙŠØªØ·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p>
          </div>);
      case 'workspace': return <PersonalWorkspace />;
      case 'dashboard': return <Dashboard />;
      case 'obligations': return <ObligationsRegistry />;
      case 'policies': return <PoliciesStandards />;
      case 'mapping': return <ObligationsMapping />;
      case 'calendar': return <ComplianceCalendar />;
      case 'evidence': return <EvidenceRepository />;
      case 'tests': return <ComplianceTests />;
      case 'violations': return <ViolationsManagement />;
      case 'changes': return <RegulatoryChanges />;
      case 'contact': return <RegulatoryContact />;
      case 'inspection': return <InspectionReadiness />;
      case 'maturity': return <MaturityAssessment />;
      case 'saudipack': return <SaudiRegulatoryPack />;
      case 'reportsmanagement': return <ReportsManagement />;
      case 'institutional': return <InstitutionalCompliance />;
      case 'audittrail': return <AuditTrailModule auditTrail={auditTrail} setAuditTrail={setAuditTrail} currentUser={currentUser} />;
      case 'incidents': return <IncidentManagement />;
      default: return <Dashboard />;
    }
  };

  // Get entity display name
  const getEntityDisplayName = () => {
    if (selectedEntityId === 'TENANT-001') return IAM_API.tenant.name;
    const entity = IAM_API.legalEntities.find(e => e.id === selectedEntityId);
    return entity?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
  };

  return (
    <div dir="rtl" className="min-h-screen bg-slate-100">
      <header className="fixed top-0 left-0 right-0 h-14 bg-white border-b border-slate-200 z-50 flex items-center justify-between px-4">
        <div className="flex items-center gap-3">
          <div className="w-9 h-9 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/25">
            <Shield className="w-5 h-5 text-white" />
          </div>
          <div className="hidden sm:block">
            <span className="font-bold text-slate-800">Ù…Ù†ØµØ© Ø§Ù„Ø¨ØµÙŠØ±ÙŠ</span>
            <span className="text-slate-400 text-xs mr-2">Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</span>
          </div> </div>
        <div className="flex items-center gap-3">
          <div className="flex items-center gap-2 bg-emerald-50 px-3 py-1.5 rounded-lg border border-emerald-200">
            <Building2 className="w-4 h-4 text-emerald-600" />
            <select
              value={selectedEntityId}
              onChange={(e) => selectEntity(e.target.value)}
              className="bg-transparent text-sm font-bold text-emerald-700 border-none outline-none cursor-pointer max-w-[150px]"
            >
              {getAccessibleEntities().map(entityId => (
                <option key={entityId} value={entityId}>
                  {entityId === 'TENANT-001' ? IAM_API.tenant.name : IAM_API.legalEntities.find(e => e.id === entityId)?.name}
                </option>
              ))}
            </select>
          </div>
          <div className="flex items-center gap-2 bg-purple-50 px-3 py-1.5 rounded-lg border border-purple-200">
            <Users className="w-4 h-4 text-purple-600" />
            <select
              value={currentUser?.id || 5}
              onChange={(e) => switchUser(parseInt(e.target.value))}
              className="bg-transparent text-sm font-bold text-purple-700 border-none outline-none cursor-pointer"
            >
              {IAM_API.users.filter(u => u.status === 'Active').map(user => (
                <option key={user.id} value={user.id}>{user.name}</option>
              ))}
            </select>
          </div>
          <div className="relative">
            <button onClick={() => setShowNotificationPanel(!showNotificationPanel)} className="p-2 hover:bg-slate-100 rounded-lg relative">
              <Bell className="w-5 h-5 text-slate-600" />
              {unreadCount > 0 && (
                <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs font-bold flex items-center justify-center">{unreadCount}</span>
              )}
            </button>

            {showNotificationPanel && (
              <div className="absolute top-full left-0 mt-2 w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 z-50 overflow-hidden">
                <div className="bg-gradient-to-r from-indigo-500 to-purple-600 px-4 py-3 text-white flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Bell className="w-5 h-5" />
                    <span className="font-bold">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                    {unreadCount > 0 && (
                      <span className="px-2 py-0.5 bg-white/20 rounded-full text-xs">{unreadCount} Ø¬Ø¯ÙŠØ¯</span>
                    )}
                  </div>
                  <button onClick={markAllNotificationsRead} className="text-xs hover:underline">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
                </div>
                <div className="max-h-96 overflow-y-auto">
                  {centralNotifications.slice(0, 6).map(notif => (
                    <div key={notif.id}
                      onClick={() => { markNotificationRead(notif.id); if (notif.link) { setActiveScreen(notif.link.screen); setShowNotificationPanel(false); } }}
                      className={`p-4 border-b border-slate-100 cursor-pointer hover:bg-slate-50 transition-all ${!notif.read ? 'bg-blue-50' : ''}`}>
                      <div className="flex items-start gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${notif.priority === 'Critical' ? 'bg-red-100' :
                          notif.priority === 'High' ? 'bg-orange-100' :
                            notif.priority === 'Medium' ? 'bg-amber-100' : 'bg-blue-100'
                          }`}>
                          {notif.type === 'deadline' && <Clock className={`w-5 h-5 ${notif.priority === 'Critical' ? 'text-red-600' : 'text-orange-600'}`} />}
                          {notif.type === 'task' && <ClipboardList className="w-5 h-5 text-blue-600" />}
                          {notif.type === 'approval' && <CheckCircle2 className="w-5 h-5 text-purple-600" />}
                          {notif.type === 'violation' && <AlertTriangle className="w-5 h-5 text-red-600" />}
                          {notif.type === 'test' && <ClipboardCheck className="w-5 h-5 text-orange-600" />}
                          {notif.type === 'evidence' && <FolderOpen className="w-5 h-5 text-emerald-600" />}
                          {notif.type === 'system' && <Settings className="w-5 h-5 text-slate-600" />}
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <p className={`font-bold text-sm truncate ${!notif.read ? 'text-slate-800' : 'text-slate-600'}`}>{notif.title}</p>
                            {!notif.read && <div className="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0" />}
                          </div>
                          <p className="text-xs text-slate-500 truncate">{notif.message}</p>
                          <p className="text-xs text-slate-400 mt-1">{formatTimeAgo(notif.time)}</p>
                        </div> </div> </div>
                  ))}
                </div>
                <div className="p-3 bg-slate-50 border-t border-slate-200">
                  <button onClick={() => { setActiveScreen('workspace'); setShowNotificationPanel(false); }}
                    className="w-full py-2 text-center text-indigo-600 font-bold text-sm hover:bg-indigo-50 rounded-lg">
                    Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                  </button> </div> </div>
            )}
          </div>
          <div className="relative">
            <button onClick={() => setShowQuickActions(!showQuickActions)}
              className="p-2 hover:bg-emerald-50 rounded-lg bg-emerald-100 border border-emerald-200">
              <Plus className="w-5 h-5 text-emerald-600" />
            </button>

            {showQuickActions && (
              <div className="absolute top-full left-0 mt-2 w-64 bg-white rounded-2xl shadow-2xl border border-slate-200 z-50 overflow-hidden">
                <div className="bg-gradient-to-r from-emerald-500 to-teal-600 px-4 py-3 text-white">
                  <span className="font-bold">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</span>
                </div>
                <div className="p-2">
                  {[
                    { icon: FileText, label: 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ²Ø§Ù… Ø¬Ø¯ÙŠØ¯', screen: 'obligations', color: 'indigo' },
                    { icon: FolderOpen, label: 'Ø±ÙØ¹ Ø¯Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯', screen: 'evidence', color: 'emerald' },
                    { icon: AlertTriangle, label: 'ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ©', screen: 'violations', color: 'red' },
                    { icon: Zap, label: 'Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø­Ø§Ø¯Ø«Ø©', screen: 'incidents', color: 'orange' },
                    { icon: ClipboardCheck, label: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±', screen: 'tests', color: 'blue' },
                    { icon: Calendar, label: 'Ø¬Ø¯ÙˆÙ„Ø© Ù…Ù‡Ù…Ø©', screen: 'calendar', color: 'purple' },
                  ].map((action, idx) => (
                    <button key={idx} onClick={() => { setActiveScreen(action.screen); setShowQuickActions(false); }}
                      className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-right hover:bg-${action.color}-50 transition-all`}>
                      <div className={`w-10 h-10 rounded-xl bg-${action.color}-100 flex items-center justify-center`}>
                        <action.icon className={`w-5 h-5 text-${action.color}-600`} />
                      </div>
                      <span className="font-bold text-slate-700">{action.label}</span>
                    </button>
                  ))}
                </div> </div>
            )}
          </div>
          <button className="p-2 hover:bg-slate-100 rounded-lg">
            <Settings className="w-5 h-5 text-slate-600" />
          </button>
          <div className="flex items-center gap-2">
            <div className="w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold text-sm">
              {currentUser?.name?.charAt(0) || '?'}
            </div>
            <div className="hidden md:block text-right">
              <p className="text-sm font-bold text-slate-800">{currentUser?.name || 'Ù…Ø³ØªØ®Ø¯Ù…'}</p>
              <p className="text-xs text-slate-500">{getUserRole()}</p>
            </div> </div> </div> </header>
      <div className="flex pt-14">
        <aside className={`fixed top-14 right-0 bottom-0 bg-slate-900 z-40 transition-all duration-300 ${sidebarOpen ? 'w-64' : 'w-0 overflow-hidden'}`}>
          <button
            onClick={() => setSidebarOpen(!sidebarOpen)}
            className={`absolute top-4 bg-slate-800 text-white p-2 rounded-xl hover:bg-slate-700 transition-all z-50 ${sidebarOpen ? '-left-3' : '-left-12'}`}
          >
            <ChevronRight className={`w-5 h-5 transition-transform ${sidebarOpen ? '' : 'rotate-180'}`} />
          </button>

          <div className="h-full overflow-y-auto p-3" style={{ scrollbarWidth: 'thin', scrollbarColor: 'rgba(255,255,255,0.2) transparent' }}>
            <div className="flex items-center gap-3 px-3 py-4 mb-4 bg-gradient-to-r from-slate-800 to-slate-900 rounded-xl border border-slate-700">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/30">
                <Shield className="w-5 h-5 text-white" />
              </div>
              <div>
                <span className="text-white font-bold text-sm block">Ù…Ù†ØµØ© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span>
                <span className="text-emerald-400 text-[10px] font-medium">GRC Platform v5.52.0</span>
              </div> </div>
            <nav className="space-y-1">
              {menuItems.map((item, index) => {
                // Handle dividers with section colors
                if (item.type === 'divider') {
                  const sectionColors = {
                    'compliance': 'text-emerald-400', 'monitoring': 'text-blue-400', 'risk': 'text-red-400', 'changes': 'text-amber-400',
                    'regulatory': 'text-indigo-400', 'reports': 'text-purple-400', 'system': 'text-slate-400',
                  };
                  return (
                    <div key={item.id} className="pt-5 pb-2 px-3">
                      <div className="flex items-center gap-2">
                        <div className="flex-1 h-px bg-slate-700"></div>
                        <span className={`text-[10px] font-bold uppercase tracking-wider ${sectionColors[item.group] || 'text-slate-500'}`}>{item.label}</span>
                        <div className="flex-1 h-px bg-slate-700"></div>
                      </div> </div>);
                }
                const hasAccess = !item.requiredPermission || can(item.requiredPermission);
                if (!hasAccess && item.requiredPermission === 'IAM_VIEW') return null;

                // Group colors for active state
                const activeColors = {
                  'personal': 'bg-gradient-to-r from-indigo-600 to-purple-600',
                  'control': 'bg-gradient-to-r from-purple-500 to-indigo-600',
                  'compliance': 'bg-gradient-to-r from-emerald-500 to-teal-600',
                  'monitoring': 'bg-gradient-to-r from-blue-500 to-cyan-600', 'risk': 'bg-gradient-to-r from-red-500 to-rose-600',
                  'changes': 'bg-gradient-to-r from-amber-500 to-orange-600',
                  'regulatory': 'bg-gradient-to-r from-indigo-500 to-purple-600',
                  'reports': 'bg-gradient-to-r from-violet-500 to-purple-600',
                  'system': 'bg-gradient-to-r from-slate-600 to-slate-700',
                };

                // Highlight personal workspace
                const isHighlighted = item.highlight && activeScreen !== item.id;

                return (
                  <button
                    key={item.id}
                    onClick={() => setActiveScreen(item.id)}
                    className={`w-full flex items-center gap-2 px-3 py-2.5 rounded-xl transition-all text-sm ${activeScreen === item.id
                      ? `${activeColors[item.group] || activeColors.compliance} text-white shadow-lg shadow-${item.group === 'risk' ? 'red' : item.group === 'control' ? 'purple' : 'emerald'}-500/20`
                      : isHighlighted
                        ? 'bg-gradient-to-r from-indigo-900 to-purple-900 text-white border border-indigo-500/50 shadow-lg shadow-indigo-500/20'
                        : 'text-slate-400 hover:text-white hover:bg-slate-800'
                      }`}
                  >
                    <span className={`w-6 h-6 rounded-lg flex items-center justify-center text-[10px] font-bold ${activeScreen === item.id ? 'bg-white/20' : isHighlighted ? 'bg-indigo-500' : 'bg-slate-800'
                      }`}>{item.num}</span>
                    <item.icon className="w-4 h-4 flex-shrink-0" />
                    <span className="flex-1 text-right truncate">{item.label}</span>
                    {isHighlighted && (
                      <span className="px-1.5 py-0.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white text-[9px] font-bold rounded-full">ğŸ‘¤</span>
                    )}
                    {item.isNew && (
                      <span className="px-1.5 py-0.5 bg-gradient-to-r from-red-500 to-rose-500 text-white text-[9px] font-bold rounded-full animate-pulse">Ø¬Ø¯ÙŠØ¯</span>
                    )}
                  </button>);
              })}
            </nav>

            <div className="mt-6 pt-4 border-t border-slate-800">
              <button className="w-full flex items-center gap-2 px-3 py-2.5 rounded-xl text-slate-400 hover:text-white hover:bg-slate-800 text-sm">
                <LogOut className="w-4 h-4" />
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
              </button> </div> </div> </aside>
        <main className={`flex-1 min-h-screen transition-all duration-300 ${sidebarOpen ? 'mr-64' : 'mr-0'}`}>
          {!sidebarOpen && (
            <button onClick={() => setSidebarOpen(true)} className="fixed top-20 right-4 bg-slate-900 text-white p-3 rounded-xl shadow-lg z-30 hover:bg-slate-800 transition-colors">
              <Menu className="w-5 h-5" />
            </button>
          )}
          <div className="p-6">{renderScreen()}</div>
        </main> </div> </div>);
};

// Wrap with AuthProvider
const CompliancePlatform = () => (
  <AuthProvider initialUserId={5} initialEntityId="TENANT-001">
    <CompliancePlatformInner />
  </AuthProvider>
);

export default CompliancePlatform;
